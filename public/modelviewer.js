/*! For license information please see webviewer.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rsmv=t():e.RSMV=t()}(self,(()=>(()=>{var e={9880:e=>{"use strict"
;e.exports=({onlyFirst:e=!1}={})=>{const t=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|")
;return new RegExp(t,e?void 0:"g")}},4083:(e,t,n)=>{"use strict";e=n.nmd(e);const r=(e,t)=>(...n)=>`\x1b[${e(...n)+t}m`,i=(e,t)=>(...n)=>{const r=e(...n);return`\x1b[${38+t};5;${r}m`},a=(e,t)=>(...n)=>{const r=e(...n)
;return`\x1b[${38+t};2;${r[0]};${r[1]};${r[2]}m`},s=e=>e,o=(e,t,n)=>[e,t,n],l=(e,t,n)=>{Object.defineProperty(e,t,{get:()=>{const r=n();return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0})}
;let c;const u=(e,t,r,i)=>{void 0===c&&(c=n(734));const a=i?10:0,s={};for(const[n,i]of Object.entries(c)){const o="ansi16"===n?"ansi":n;n===t?s[o]=e(r,a):"object"==typeof i&&(s[o]=e(i[t],a))}return s};Object.defineProperty(e,"exports",{enumerable:!0,
get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],
magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],
bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],
bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){
for(const[n,i]of Object.entries(r))t[n]={open:`\x1b[${i[0]}m`,close:`\x1b[${i[1]}m`},r[n]=t[n],e.set(i[0],i[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),
t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",l(t.color,"ansi",(()=>u(r,"ansi16",s,!1))),l(t.color,"ansi256",(()=>u(i,"ansi256",s,!1))),l(t.color,"ansi16m",(()=>u(a,"rgb",o,!1))),l(t.bgColor,"ansi",(()=>u(r,"ansi16",s,!0))),
l(t.bgColor,"ansi256",(()=>u(i,"ansi256",s,!0))),l(t.bgColor,"ansi16m",(()=>u(a,"rgb",o,!0))),t}})},648:e=>{const t=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];let n;const r=e=>e<1e5?e<100?e<10?0:1:e<1e4?e<1e3?2:3:4:e<1e7?e<1e6?5:6:e<1e9?e<1e8?7:8:9
;function i(e,n){if(e===n)return 0;if(~~e===e&&~~n===n){if(0===e||0===n)return e<n?-1:1;if(e<0||n<0){if(n>=0)return-1;if(e>=0)return 1;e=-e,n=-n}const i=r(e),a=r(n);let s=0;return i<a?(e*=t[a-i-1],n/=10,s=-1):i>a&&(n*=t[i-a-1],e/=10,s=1),
e===n?s:e<n?-1:1}const i=String(e),a=String(n);return i===a?0:i<a?-1:1}function a(e,t,r,i){let a=t+1;if(a===r)return 1;if(i(e[a++],e[t])<0){for(;a<r&&i(e[a],e[a-1])<0;)a++;s(e,t,a),s(n,t,a)}else for(;a<r&&i(e[a],e[a-1])>=0;)a++;return a-t}
function s(e,t,n){for(n--;t<n;){const r=e[t];e[t++]=e[n],e[n--]=r}}function o(e,t,r,i,a){for(i===t&&i++;i<r;i++){const r=e[i],s=n[i];let o=t,l=i;for(;o<l;){const t=o+l>>>1;a(r,e[t])<0?l=t:o=t+1}let c=i-o;switch(c){case 3:e[o+3]=e[o+2],n[o+3]=n[o+2]
;case 2:e[o+2]=e[o+1],n[o+2]=n[o+1];case 1:e[o+1]=e[o],n[o+1]=n[o];break;default:for(;c>0;)e[o+c]=e[o+c-1],n[o+c]=n[o+c-1],c--}e[o]=r,n[o]=s}}function l(e,t,n,r,i,a){let s=0,o=0,l=1;if(a(e,t[n+i])>0){for(o=r-i;l<o&&a(e,t[n+i+l])>0;)s=l,l=1+(l<<1),
l<=0&&(l=o);l>o&&(l=o),s+=i,l+=i}else{for(o=i+1;l<o&&a(e,t[n+i-l])<=0;)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);const r=s;s=i-l,l=i-r}for(s++;s<l;){const r=s+(l-s>>>1);a(e,t[n+r])>0?s=r+1:l=r}return l}function c(e,t,n,r,i,a){let s=0,o=0,l=1
;if(a(e,t[n+i])<0){for(o=i+1;l<o&&a(e,t[n+i-l])<0;)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);const r=s;s=i-l,l=i-r}else{for(o=r-i;l<o&&a(e,t[n+i+l])>=0;)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o),s+=i,l+=i}for(s++;s<l;){const r=s+(l-s>>>1)
;a(e,t[n+r])<0?l=r:s=r+1}return l}class u{constructor(e,t){this.array=e,this.compare=t;const{length:n}=e;this.length=n,this.minGallop=7,this.tmpStorageLength=n<512?n>>>1:256,this.tmp=new Array(this.tmpStorageLength),
this.tmpIndex=new Array(this.tmpStorageLength),this.stackLength=n<120?5:n<1542?10:n<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}pushRun(e,t){this.runStart[this.stackSize]=e,
this.runLength[this.stackSize]=t,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2
;if(e>=1&&this.runLength[e-1]<=this.runLength[e]+this.runLength[e+1]||e>=2&&this.runLength[e-2]<=this.runLength[e]+this.runLength[e-1])this.runLength[e-1]<this.runLength[e+1]&&e--;else if(this.runLength[e]>this.runLength[e+1])break;this.mergeAt(e)}}
forceMergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;e>0&&this.runLength[e-1]<this.runLength[e+1]&&e--,this.mergeAt(e)}}mergeAt(e){const{compare:t}=this,{array:n}=this;let r=this.runStart[e],i=this.runLength[e];const a=this.runStart[e+1]
;let s=this.runLength[e+1];this.runLength[e]=i+s,e===this.stackSize-3&&(this.runStart[e+1]=this.runStart[e+2],this.runLength[e+1]=this.runLength[e+2]),this.stackSize--;const o=c(n[a],n,r,i,0,t);r+=o,i-=o,0!==i&&(s=l(n[r+i-1],n,a,s,s-1,t),
0!==s&&(i<=s?this.mergeLow(r,i,a,s):this.mergeHigh(r,i,a,s)))}mergeLow(e,t,r,i){const{compare:a}=this,{array:s}=this,{tmp:o}=this,{tmpIndex:u}=this;let h=0;for(h=0;h<t;h++)o[h]=s[e+h],u[h]=n[e+h];let d=0,p=r,f=e;if(s[f]=s[p],n[f]=n[p],f++,p++,
0==--i){for(h=0;h<t;h++)s[f+h]=o[d+h],n[f+h]=u[d+h];return}if(1===t){for(h=0;h<i;h++)s[f+h]=s[p+h],n[f+h]=n[p+h];return s[f+i]=o[d],void(n[f+i]=u[d])}let{minGallop:m}=this;for(;;){let e=0,r=0,g=!1;do{if(a(s[p],o[d])<0){if(s[f]=s[p],n[f]=n[p],f++,p++,
r++,e=0,0==--i){g=!0;break}}else if(s[f]=o[d],n[f]=u[d],f++,d++,e++,r=0,1==--t){g=!0;break}}while((e|r)<m);if(g)break;do{if(e=c(s[p],o,d,t,0,a),0!==e){for(h=0;h<e;h++)s[f+h]=o[d+h],n[f+h]=u[d+h];if(f+=e,d+=e,(t-=e)<=1){g=!0;break}}if(s[f]=s[p],
n[f]=n[p],f++,p++,0==--i){g=!0;break}if(r=l(o[d],s,p,i,0,a),0!==r){for(h=0;h<r;h++)s[f+h]=s[p+h],n[f+h]=n[p+h];if(f+=r,p+=r,0==(i-=r)){g=!0;break}}if(s[f]=o[d],n[f]=u[d],f++,d++,1==--t){g=!0;break}m--}while(e>=7||r>=7);if(g)break;m<0&&(m=0),m+=2}
if(this.minGallop=m,m<1&&(this.minGallop=1),1===t){for(h=0;h<i;h++)s[f+h]=s[p+h],n[f+h]=n[p+h];s[f+i]=o[d],n[f+i]=u[d]}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(h=0;h<t;h++)s[f+h]=o[d+h],n[f+h]=u[d+h]}}
mergeHigh(e,t,r,i){const{compare:a}=this,{array:s}=this,{tmp:o}=this,{tmpIndex:u}=this;let h=0;for(h=0;h<i;h++)o[h]=s[r+h],u[h]=n[r+h];let d=e+t-1,p=i-1,f=r+i-1,m=0,g=0;if(s[f]=s[d],n[f]=n[d],f--,d--,0==--t){for(m=f-(i-1),h=0;h<i;h++)s[m+h]=o[h],
n[m+h]=u[h];return}if(1===i){for(f-=t,d-=t,g=f+1,m=d+1,h=t-1;h>=0;h--)s[g+h]=s[m+h],n[g+h]=n[m+h];return s[f]=o[p],void(n[f]=u[p])}let{minGallop:_}=this;for(;;){let r=0,v=0,y=!1;do{if(a(o[p],s[d])<0){if(s[f]=s[d],n[f]=n[d],f--,d--,r++,v=0,0==--t){
y=!0;break}}else if(s[f]=o[p],n[f]=u[p],f--,p--,v++,r=0,1==--i){y=!0;break}}while((r|v)<_);if(y)break;do{if(r=t-c(o[p],s,e,t,t-1,a),0!==r){for(f-=r,d-=r,t-=r,g=f+1,m=d+1,h=r-1;h>=0;h--)s[g+h]=s[m+h],n[g+h]=n[m+h];if(0===t){y=!0;break}}if(s[f]=o[p],
n[f]=u[p],f--,p--,1==--i){y=!0;break}if(v=i-l(s[d],o,0,i,i-1,a),0!==v){for(f-=v,p-=v,i-=v,g=f+1,m=p+1,h=0;h<v;h++)s[g+h]=o[m+h],n[g+h]=u[m+h];if(i<=1){y=!0;break}}if(s[f]=s[d],n[f]=n[d],f--,d--,0==--t){y=!0;break}_--}while(r>=7||v>=7);if(y)break
;_<0&&(_=0),_+=2}if(this.minGallop=_,_<1&&(this.minGallop=1),1===i){for(f-=t,d-=t,g=f+1,m=d+1,h=t-1;h>=0;h--)s[g+h]=s[m+h],n[g+h]=n[m+h];s[f]=o[p],n[f]=u[p]}else{if(0===i)throw new Error("mergeHigh preconditions were not respected");for(m=f-(i-1),
h=0;h<i;h++)s[m+h]=o[h],n[m+h]=u[h]}}}e.exports={sort:function(e,t,r,s){if(!Array.isArray(e))throw new TypeError(`The "array" argument must be an array. Received ${e}`);n=[];const{length:l}=e;let c=0;for(;c<l;)n[c]=c++;t?"function"!=typeof t&&(s=r,
r=t,t=i):t=i,r||(r=0),s||(s=l);let h=s-r;if(h<2)return n;let d=0;if(h<32)return d=a(e,r,s,t),o(e,r,s,r+d,t),n;const p=new u(e,t),f=function(e){let t=0;for(;e>=32;)t|=1&e,e>>=1;return e+t}(h);do{if(d=a(e,r,s,t),d<f){let n=h;n>f&&(n=f),
o(e,r,r+n,r+d,t),d=n}p.pushRun(r,d),p.mergeRuns(),h-=d,r+=d}while(0!==h);return p.forceMergeRuns(),n}}},4148:(e,t,n)=>{"use strict";var r=n(5606);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){
return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}
var a,s,o=n(9597).codes,l=o.ERR_AMBIGUOUS_ARGUMENT,c=o.ERR_INVALID_ARG_TYPE,u=o.ERR_INVALID_ARG_VALUE,h=o.ERR_INVALID_RETURN_VALUE,d=o.ERR_MISSING_ARGS,p=n(3918),f=n(537).inspect,m=n(537).types,g=m.isPromise,_=m.isRegExp,v=Object.assign?Object.assign:n(9491).assign,y=Object.is?Object.is:n(7653)
;function b(){var e=n(2299);a=e.isDeepEqual,s=e.isDeepStrictEqual}new Map;var x=!1,E=e.exports=A,w={};function S(e){if(e.message instanceof Error)throw e.message;throw new p(e)}function T(e,t,n,r){if(!n){var i=!1;if(0===t)i=!0,
r="No value argument passed to `assert.ok()`";else if(r instanceof Error)throw r;var a=new p({actual:n,expected:!0,message:r,operator:"==",stackStartFn:e});throw a.generatedMessage=i,a}}function A(){
for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[A,t.length].concat(t))}E.fail=function e(t,n,i,a,s){var o,l=arguments.length;if(0===l?o="Failed":1===l?(i=t,t=void 0):(!1===x&&(x=!0,
(r.emitWarning?r.emitWarning:console.warn.bind(console))("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")),2===l&&(a="!=")),
i instanceof Error)throw i;var c={actual:t,expected:n,operator:void 0===a?"fail":a,stackStartFn:s||e};void 0!==i&&(c.message=i);var u=new p(c);throw o&&(u.message=o,u.generatedMessage=!0),u},E.AssertionError=p,E.ok=A,E.equal=function e(t,n,r){
if(arguments.length<2)throw new d("actual","expected");t!=n&&S({actual:t,expected:n,message:r,operator:"==",stackStartFn:e})},E.notEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");t==n&&S({actual:t,expected:n,message:r,
operator:"!=",stackStartFn:e})},E.deepEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),a(t,n)||S({actual:t,expected:n,message:r,operator:"deepEqual",stackStartFn:e})},E.notDeepEqual=function e(t,n,r){
if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),a(t,n)&&S({actual:t,expected:n,message:r,operator:"notDeepEqual",stackStartFn:e})},E.deepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected")
;void 0===a&&b(),s(t,n)||S({actual:t,expected:n,message:r,operator:"deepStrictEqual",stackStartFn:e})},E.notDeepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),s(t,n)&&S({actual:t,expected:n,
message:r,operator:"notDeepStrictEqual",stackStartFn:e})},E.strictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");y(t,n)||S({actual:t,expected:n,message:r,operator:"strictEqual",stackStartFn:e})},
E.notStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");y(t,n)&&S({actual:t,expected:n,message:r,operator:"notStrictEqual",stackStartFn:e})};var C=function e(t,n,r){var i=this;!function(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.forEach((function(e){e in t&&(void 0!==r&&"string"==typeof r[e]&&_(t[e])&&t[e].test(r[e])?i[e]=r[e]:i[e]=t[e])}))};function M(e,t,n,r){if("function"!=typeof t){
if(_(t))return t.test(e);if(2===arguments.length)throw new c("expected",["Function","RegExp"],t);if("object"!==i(e)||null===e){var o=new p({actual:e,expected:t,message:n,operator:"deepStrictEqual",stackStartFn:r});throw o.operator=r.name,o}
var l=Object.keys(t);if(t instanceof Error)l.push("name","message");else if(0===l.length)throw new u("error",t,"may not be an empty object");return void 0===a&&b(),l.forEach((function(i){
"string"==typeof e[i]&&_(t[i])&&t[i].test(e[i])||function(e,t,n,r,i,a){if(!(n in e)||!s(e[n],t[n])){if(!r){var o=new C(e,i),l=new C(t,i,e),c=new p({actual:o,expected:l,operator:"deepStrictEqual",stackStartFn:a});throw c.actual=e,c.expected=t,
c.operator=a.name,c}S({actual:e,expected:t,message:r,operator:a.name,stackStartFn:a})}}(e,t,i,n,l,r)})),!0}return void 0!==t.prototype&&e instanceof t||!Error.isPrototypeOf(t)&&!0===t.call({},e)}function I(e){
if("function"!=typeof e)throw new c("fn","Function",e);try{e()}catch(e){return e}return w}function R(e){return g(e)||null!==e&&"object"===i(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function k(e){
return Promise.resolve().then((function(){var t;if("function"==typeof e){if(!R(t=e()))throw new h("instance of Promise","promiseFn",t)}else{if(!R(e))throw new c("promiseFn",["Function","Promise"],e);t=e}return Promise.resolve().then((function(){
return t})).then((function(){return w})).catch((function(e){return e}))}))}function N(e,t,n,r){if("string"==typeof n){if(4===arguments.length)throw new c("error",["Object","Error","Function","RegExp"],n);if("object"===i(t)&&null!==t){
if(t.message===n)throw new l("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===n)throw new l("error/message",'The error "'.concat(t,'" is identical to the message.'));r=n,n=void 0
}else if(null!=n&&"object"!==i(n)&&"function"!=typeof n)throw new c("error",["Object","Error","Function","RegExp"],n);if(t===w){var a="";n&&n.name&&(a+=" (".concat(n.name,")")),a+=r?": ".concat(r):".";var s="rejects"===e.name?"rejection":"exception"
;S({actual:void 0,expected:n,operator:e.name,message:"Missing expected ".concat(s).concat(a),stackStartFn:e})}if(n&&!M(t,n,r,e))throw t}function D(e,t,n,r){if(t!==w){if("string"==typeof n&&(r=n,n=void 0),!n||M(t,n)){
var i=r?": ".concat(r):".",a="doesNotReject"===e.name?"rejection":"exception";S({actual:t,expected:n,operator:e.name,message:"Got unwanted ".concat(a).concat(i,"\n")+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}function L(){
for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[L,t.length].concat(t))}E.throws=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];N.apply(void 0,[e,I(t)].concat(r))
},E.rejects=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return k(t).then((function(t){return N.apply(void 0,[e,t].concat(r))}))},E.doesNotThrow=function e(t){
for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];D.apply(void 0,[e,I(t)].concat(r))},E.doesNotReject=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i]
;return k(t).then((function(t){return D.apply(void 0,[e,t].concat(r))}))},E.ifError=function e(t){if(null!=t){var n="ifError got unwanted exception: "
;"object"===i(t)&&"string"==typeof t.message?0===t.message.length&&t.constructor?n+=t.constructor.name:n+=t.message:n+=f(t);var r=new p({actual:t,expected:null,operator:"ifError",message:n,stackStartFn:e}),a=t.stack;if("string"==typeof a){
var s=a.split("\n");s.shift();for(var o=r.stack.split("\n"),l=0;l<s.length;l++){var c=o.indexOf(s[l]);if(-1!==c){o=o.slice(0,c);break}}r.stack="".concat(o.join("\n"),"\n").concat(s.join("\n"))}throw r}},E.strict=v(L,E,{equal:E.strictEqual,
deepEqual:E.deepStrictEqual,notEqual:E.notStrictEqual,notDeepEqual:E.notDeepStrictEqual}),E.strict.strict=E.strict},3918:(e,t,n)=>{"use strict";var r=n(5606);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,
configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){
var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n
;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return l(e,arguments,u(this).constructor)}
return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)},o(e)}function l(e,t,n){return l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1
;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t)
;var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i},l.apply(null,arguments)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){
return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){
return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}var d=n(537).inspect,p=n(9597).codes.ERR_INVALID_ARG_TYPE;function f(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),
e.substring(n-t.length,n)===t}var m="",g="",_="",v="",y={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',
deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',
notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',
notIdentical:"Values identical but not reference-equal:"};function b(e){var t=Object.keys(e),n=Object.create(Object.getPrototypeOf(e));return t.forEach((function(t){n[t]=e[t]})),Object.defineProperty(n,"message",{value:e.message}),n}function x(e){
return d(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}var E=function(e){function t(e){var n;if(function(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==h(e)||null===e)throw new p("options","Object",e);var i=e.message,o=e.operator,l=e.stackStartFn,c=e.actual,d=e.expected,E=Error.stackTraceLimit
;if(Error.stackTraceLimit=0,null!=i)n=a(this,u(t).call(this,String(i)));else if(r.stderr&&r.stderr.isTTY&&(r.stderr&&r.stderr.getColorDepth&&1!==r.stderr.getColorDepth()?(m="\x1b[34m",g="\x1b[32m",v="\x1b[39m",_="\x1b[31m"):(m="",g="",v="",_="")),
"object"===h(c)&&null!==c&&"object"===h(d)&&null!==d&&"stack"in c&&c instanceof Error&&"stack"in d&&d instanceof Error&&(c=b(c),d=b(d)),"deepStrictEqual"===o||"strictEqual"===o)n=a(this,u(t).call(this,function(e,t,n){
var i="",a="",s=0,o="",l=!1,c=x(e),u=c.split("\n"),d=x(t).split("\n"),p=0,b="";if("strictEqual"===n&&"object"===h(e)&&"object"===h(t)&&null!==e&&null!==t&&(n="strictEqualObject"),1===u.length&&1===d.length&&u[0]!==d[0]){var E=u[0].length+d[0].length
;if(E<=10){if(!("object"===h(e)&&null!==e||"object"===h(t)&&null!==t||0===e&&0===t))return"".concat(y[n],"\n\n")+"".concat(u[0]," !== ").concat(d[0],"\n")}else if("strictEqualObject"!==n&&E<(r.stderr&&r.stderr.isTTY?r.stderr.columns:80)){
for(;u[0][p]===d[0][p];)p++;p>2&&(b="\n  ".concat(function(e,t){if(t=Math.floor(t),0==e.length||0==t)return"";var n=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+e.substring(0,n-e.length)}(" ",p),"^"),p=0)}}
for(var w=u[u.length-1],S=d[d.length-1];w===S&&(p++<2?o="\n  ".concat(w).concat(o):i=w,u.pop(),d.pop(),0!==u.length&&0!==d.length);)w=u[u.length-1],S=d[d.length-1];var T=Math.max(u.length,d.length);if(0===T){var A=c.split("\n")
;if(A.length>30)for(A[26]="".concat(m,"...").concat(v);A.length>27;)A.pop();return"".concat(y.notIdentical,"\n\n").concat(A.join("\n"),"\n")}p>3&&(o="\n".concat(m,"...").concat(v).concat(o),l=!0),""!==i&&(o="\n  ".concat(i).concat(o),i="")
;var C=0,M=y[n]+"\n".concat(g,"+ actual").concat(v," ").concat(_,"- expected").concat(v),I=" ".concat(m,"...").concat(v," Lines skipped");for(p=0;p<T;p++){var R=p-s;if(u.length<p+1)R>1&&p>2&&(R>4?(a+="\n".concat(m,"...").concat(v),
l=!0):R>3&&(a+="\n  ".concat(d[p-2]),C++),a+="\n  ".concat(d[p-1]),C++),s=p,i+="\n".concat(_,"-").concat(v," ").concat(d[p]),C++;else if(d.length<p+1)R>1&&p>2&&(R>4?(a+="\n".concat(m,"...").concat(v),l=!0):R>3&&(a+="\n  ".concat(u[p-2]),C++),
a+="\n  ".concat(u[p-1]),C++),s=p,a+="\n".concat(g,"+").concat(v," ").concat(u[p]),C++;else{var k=d[p],N=u[p],D=N!==k&&(!f(N,",")||N.slice(0,-1)!==k);D&&f(k,",")&&k.slice(0,-1)===N&&(D=!1,N+=","),D?(R>1&&p>2&&(R>4?(a+="\n".concat(m,"...").concat(v),
l=!0):R>3&&(a+="\n  ".concat(u[p-2]),C++),a+="\n  ".concat(u[p-1]),C++),s=p,a+="\n".concat(g,"+").concat(v," ").concat(N),i+="\n".concat(_,"-").concat(v," ").concat(k),C+=2):(a+=i,i="",1!==R&&0!==p||(a+="\n  ".concat(N),C++))}
if(C>20&&p<T-2)return"".concat(M).concat(I,"\n").concat(a,"\n").concat(m,"...").concat(v).concat(i,"\n")+"".concat(m,"...").concat(v)}return"".concat(M).concat(l?I:"","\n").concat(a).concat(i).concat(o).concat(b)
}(c,d,o)));else if("notDeepStrictEqual"===o||"notStrictEqual"===o){var w=y[o],S=x(c).split("\n");if("notStrictEqual"===o&&"object"===h(c)&&null!==c&&(w=y.notStrictEqualObject),S.length>30)for(S[26]="".concat(m,"...").concat(v);S.length>27;)S.pop()
;n=1===S.length?a(this,u(t).call(this,"".concat(w," ").concat(S[0]))):a(this,u(t).call(this,"".concat(w,"\n\n").concat(S.join("\n"),"\n")))}else{var T=x(c),A="",C=y[o]
;"notDeepEqual"===o||"notEqual"===o?(T="".concat(y[o],"\n\n").concat(T)).length>1024&&(T="".concat(T.slice(0,1021),"...")):(A="".concat(x(d)),T.length>512&&(T="".concat(T.slice(0,509),"...")),A.length>512&&(A="".concat(A.slice(0,509),"...")),
"deepEqual"===o||"equal"===o?T="".concat(C,"\n\n").concat(T,"\n\nshould equal\n\n"):A=" ".concat(o," ").concat(A)),n=a(this,u(t).call(this,"".concat(T).concat(A)))}return Error.stackTraceLimit=E,n.generatedMessage=!i,
Object.defineProperty(s(n),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),n.code="ERR_ASSERTION",n.actual=c,n.expected=d,n.operator=o,Error.captureStackTrace&&Error.captureStackTrace(s(n),l),n.stack,
n.name="AssertionError",a(n)}var n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,
configurable:!0}}),t&&c(e,t)}(t,e),n=t,o=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:d.custom,value:function(e,t){return d(this,function(e){for(var t=1;t<arguments.length;t++){
var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),
r.forEach((function(t){i(e,t,n[t])}))}return e}({},t,{customInspect:!1,depth:0}))}}],o&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)
}}(n.prototype,o),t}(o(Error));e.exports=E},9597:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){
return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}
function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}var s,o,l={};function c(e,t,n){n||(n=Error);var s=function(n){function s(n,a,o){var l;return function(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),l=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){
if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,i(s).call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,a,o))),l.code=e,l}return function(e,t){
if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(s,n),s}(n);l[e]=s}function u(e,t){
if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),
n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}
c("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),c("ERR_INVALID_ARG_TYPE",(function(e,t,i){var a,o,l,c;if(void 0===s&&(s=n(4148)),s("string"==typeof e,"'name' must be a string"),
"string"==typeof t&&"not "===t.substr(0,4)?(a="must not be",t=t.replace(/^not /,"")):a="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length)," argument"===e.substring(n-9,n)
}(e))o="The ".concat(e," ").concat(a," ").concat(u(t,"type"));else{var h=("number"!=typeof c&&(c=0),c+1>(l=e).length||-1===l.indexOf(".",c)?"argument":"property");o='The "'.concat(e,'" ').concat(h," ").concat(a," ").concat(u(t,"type"))}
return o+". Received type ".concat(r(i))}),TypeError),c("ERR_INVALID_ARG_VALUE",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===o&&(o=n(537));var i=o.inspect(t)
;return i.length>128&&(i="".concat(i.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(i)}),TypeError,RangeError),c("ERR_INVALID_RETURN_VALUE",(function(e,t,n){var i
;return i=n&&n.constructor&&n.constructor.name?"instance of ".concat(n.constructor.name):"type ".concat(r(n)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(i,".")}),TypeError),
c("ERR_MISSING_ARGS",(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];void 0===s&&(s=n(4148)),s(t.length>0,"At least one arg needs to be specified");var i="The ",a=t.length;switch(t=t.map((function(e){
return'"'.concat(e,'"')})),a){case 1:i+="".concat(t[0]," argument");break;case 2:i+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:i+=t.slice(0,a-1).join(", "),i+=", and ".concat(t[a-1]," arguments")}
return"".concat(i," must be specified")}),TypeError),e.exports.codes=l},2299:(e,t,n)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{
for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}(e,t)||function(){
throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){
return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var a=void 0!==/a/g.flags,s=function(e){var t=[];return e.forEach((function(e){return t.push(e)})),t},o=function(e){var t=[]
;return e.forEach((function(e,n){return t.push([n,e])})),t},l=Object.is?Object.is:n(7653),c=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},u=Number.isNaN?Number.isNaN:n(4133);function h(e){return e.call.bind(e)}
var d=h(Object.prototype.hasOwnProperty),p=h(Object.prototype.propertyIsEnumerable),f=h(Object.prototype.toString),m=n(537).types,g=m.isAnyArrayBuffer,_=m.isArrayBufferView,v=m.isDate,y=m.isMap,b=m.isRegExp,x=m.isSet,E=m.isNativeError,w=m.isBoxedPrimitive,S=m.isNumberObject,T=m.isStringObject,A=m.isBooleanObject,C=m.isBigIntObject,M=m.isSymbolObject,I=m.isFloat32Array,R=m.isFloat64Array
;function k(e){if(0===e.length||e.length>10)return!0;for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<48||n>57)return!0}return 10===e.length&&e>=Math.pow(2,32)}function N(e){
return Object.keys(e).filter(k).concat(c(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}function D(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}
function L(e,t,n,r){if(e===t)return 0!==e||!n||l(e,t);if(n){if("object"!==i(e))return"number"==typeof e&&u(e)&&u(t);if("object"!==i(t)||null===e||null===t)return!1;if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{
if(null===e||"object"!==i(e))return(null===t||"object"!==i(t))&&e==t;if(null===t||"object"!==i(t))return!1}var s,o,c,h,d=f(e);if(d!==f(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var p=N(e),m=N(t)
;return p.length===m.length&&P(e,t,n,r,1,p)}if("[object Object]"===d&&(!y(e)&&y(t)||!x(e)&&x(t)))return!1;if(v(e)){if(!v(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(b(e)){if(!b(t)||(c=e,h=t,
!(a?c.source===h.source&&c.flags===h.flags:RegExp.prototype.toString.call(c)===RegExp.prototype.toString.call(h))))return!1}else if(E(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else{if(_(e)){if(n||!I(e)&&!R(e)){
if(!function(e,t){return e.byteLength===t.byteLength&&0===D(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e,t))return!1}else if(!function(e,t){if(e.byteLength!==t.byteLength)return!1
;for(var n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e,t))return!1;var k=N(e),L=N(t);return k.length===L.length&&P(e,t,n,r,0,k)}if(x(e))return!(!x(t)||e.size!==t.size)&&P(e,t,n,r,2);if(y(e))return!(!y(t)||e.size!==t.size)&&P(e,t,n,r,3)
;if(g(e)){if(o=t,(s=e).byteLength!==o.byteLength||0!==D(new Uint8Array(s),new Uint8Array(o)))return!1}else if(w(e)&&!function(e,t){
return S(e)?S(t)&&l(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):T(e)?T(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):A(e)?A(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):C(e)?C(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):M(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)
}(e,t))return!1}return P(e,t,n,r,0)}function O(e,t){return t.filter((function(t){return p(e,t)}))}function P(e,t,n,a,l,u){if(5===arguments.length){u=Object.keys(e);var h=Object.keys(t);if(u.length!==h.length)return!1}
for(var f=0;f<u.length;f++)if(!d(t,u[f]))return!1;if(n&&5===arguments.length){var m=c(e);if(0!==m.length){var g=0;for(f=0;f<m.length;f++){var _=m[f];if(p(e,_)){if(!p(t,_))return!1;u.push(_),g++}else if(p(t,_))return!1}var v=c(t)
;if(m.length!==v.length&&O(t,v).length!==g)return!1}else{var y=c(t);if(0!==y.length&&0!==O(t,y).length)return!1}}if(0===u.length&&(0===l||1===l&&0===e.length||0===e.size))return!0;if(void 0===a)a={val1:new Map,val2:new Map,position:0};else{
var b=a.val1.get(e);if(void 0!==b){var x=a.val2.get(t);if(void 0!==x)return b===x}a.position++}a.val1.set(e,a.position),a.val2.set(t,a.position);var E=function(e,t,n,a,l,c){var u=0;if(2===c){if(!function(e,t,n,r){
for(var a=null,o=s(e),l=0;l<o.length;l++){var c=o[l];if("object"===i(c)&&null!==c)null===a&&(a=new Set),a.add(c);else if(!t.has(c)){if(n)return!1;if(!B(e,t,c))return!1;null===a&&(a=new Set),a.add(c)}}if(null!==a){for(var u=s(t),h=0;h<u.length;h++){
var d=u[h];if("object"===i(d)&&null!==d){if(!F(a,d,n,r))return!1}else if(!n&&!e.has(d)&&!F(a,d,n,r))return!1}return 0===a.size}return!0}(e,t,n,l))return!1}else if(3===c){if(!function(e,t,n,a){for(var s=null,l=o(e),c=0;c<l.length;c++){
var u=r(l[c],2),h=u[0],d=u[1];if("object"===i(h)&&null!==h)null===s&&(s=new Set),s.add(h);else{var p=t.get(h);if(void 0===p&&!t.has(h)||!L(d,p,n,a)){if(n)return!1;if(!z(e,t,h,d,a))return!1;null===s&&(s=new Set),s.add(h)}}}if(null!==s){
for(var f=o(t),m=0;m<f.length;m++){var g=r(f[m],2),_=(h=g[0],g[1]);if("object"===i(h)&&null!==h){if(!G(s,e,h,_,n,a))return!1}else if(!(n||e.has(h)&&L(e.get(h),_,!1,a)||G(s,e,h,_,!1,a)))return!1}return 0===s.size}return!0}(e,t,n,l))return!1
}else if(1===c)for(;u<e.length;u++){if(!d(e,u)){if(d(t,u))return!1;for(var h=Object.keys(e);u<h.length;u++){var p=h[u];if(!d(t,p)||!L(e[p],t[p],n,l))return!1}return h.length===Object.keys(t).length}if(!d(t,u)||!L(e[u],t[u],n,l))return!1}
for(u=0;u<a.length;u++){var f=a[u];if(!L(e[f],t[f],n,l))return!1}return!0}(e,t,n,u,a,l);return a.val1.delete(e),a.val2.delete(t),E}function F(e,t,n,r){for(var i=s(e),a=0;a<i.length;a++){var o=i[a];if(L(t,o,n,r))return e.delete(o),!0}return!1}
function U(e){switch(i(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(u(e))return!1}return!0}function B(e,t,n){var r=U(n);return null!=r?r:t.has(r)&&!e.has(r)}function z(e,t,n,r,i){
var a=U(n);if(null!=a)return a;var s=t.get(a);return!(void 0===s&&!t.has(a)||!L(r,s,!1,i))&&!e.has(a)&&L(r,s,!1,i)}function G(e,t,n,r,i,a){for(var o=s(e),l=0;l<o.length;l++){var c=o[l];if(L(n,c,i,a)&&L(r,t.get(c),i,a))return e.delete(c),!0}return!1}
e.exports={isDeepEqual:function(e,t){return L(e,t,!1)},isDeepStrictEqual:function(e,t){return L(e,t,!0)}}},7526:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){
var t,n,a=o(e),s=a[0],l=a[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,l)),u=0,h=l>0?s-4:s;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,
c[u++]=255&t;return 2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){
for(var t,r=e.length,i=r%3,a=[],s=16383,o=0,c=r-i;o<c;o+=s)a.push(l(e,o,o+s>c?c:o+s));return 1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")}
;for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function o(e){var t=e.length
;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,r){for(var i,a,s=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),
s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},5974:(e,t,n)=>{"use strict";var r=n(8287).Buffer,i=n(5606),a=n(4148),s=n(4442),o=n(8411),l=n(1447),c=n(9681)
;for(var u in c)t[u]=c[u];function h(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,
this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,h.prototype.close=function(){
this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,a(this.init_done,"close before init"),a(this.mode<=t.UNZIP),
this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||l.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},
h.prototype.write=function(e,t,n,r,i,a,s){return this._write(!0,e,t,n,r,i,a,s)},h.prototype.writeSync=function(e,t,n,r,i,a,s){return this._write(!1,e,t,n,r,i,a,s)},h.prototype._write=function(e,n,s,o,l,c,u,h){if(a.equal(arguments.length,8),
a(this.init_done,"write before init"),a(this.mode!==t.NONE,"already finalized"),a.equal(!1,this.write_in_progress,"write already in progress"),a.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,
a.equal(!1,void 0===n,"must provide flush value"),this.write_in_progress=!0,n!==t.Z_NO_FLUSH&&n!==t.Z_PARTIAL_FLUSH&&n!==t.Z_SYNC_FLUSH&&n!==t.Z_FULL_FLUSH&&n!==t.Z_FINISH&&n!==t.Z_BLOCK)throw new Error("Invalid flush value")
;if(null==s&&(s=r.alloc(0),l=0,o=0),this.strm.avail_in=l,this.strm.input=s,this.strm.next_in=o,this.strm.avail_out=h,this.strm.output=c,this.strm.next_out=u,this.flush=n,!e)return this._process(),this._checkError()?this._afterSync():void 0;var d=this
;return i.nextTick((function(){d._process(),d._after()})),this},h.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},h.prototype._process=function(){var e=null;switch(this.mode){
case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){
this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:
throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=l.inflate(this.strm,this.flush),
this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=l.inflateSetDictionary(this.strm,this.dictionary),
this.err===t.Z_OK?this.err=l.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),
this.err=l.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},h.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:
if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1
;default:return this._error("Zlib error"),!1}return!0},h.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},
h.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},h.prototype.init=function(e,n,r,i,s){
a(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),a(e>=8&&e<=15,"invalid windowBits"),a(n>=-1&&n<=9,"invalid compression level"),a(r>=1&&r<=9,"invalid memlevel"),
a(i===t.Z_FILTERED||i===t.Z_HUFFMAN_ONLY||i===t.Z_RLE||i===t.Z_FIXED||i===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,r,i,s),this._setDictionary()},h.prototype.params=function(){throw new Error("deflateParams Not supported")},
h.prototype.reset=function(){this._reset(),this._setDictionary()},h.prototype._init=function(e,n,r,i,a){switch(this.level=e,this.windowBits=n,this.memLevel=r,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,
this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case t.DEFLATE:case t.GZIP:
case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=l.inflateInit2(this.strm,this.windowBits);break
;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=a,this.write_in_progress=!1,this.init_done=!0},h.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,
this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},h.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:
case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=l.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=h},8559:(e,t,n)=>{"use strict"
;var r=n(5606),i=n(8287).Buffer,a=n(8310).Transform,s=n(5974),o=n(537),l=n(4148).ok,c=n(8287).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+c.toString(16)+" bytes";s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,
s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=1/0,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION
;for(var h=Object.keys(s),d=0;d<h.length;d++){var p=h[d];p.match(/^Z/)&&Object.defineProperty(t,p,{enumerable:!0,value:s[p],writable:!1})}for(var f={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,
Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},m=Object.keys(f),g=0;g<m.length;g++){var _=m[g];f[f[_]]=_}function v(e,t,n){var r=[],a=0;function s(){
for(var t;null!==(t=e.read());)r.push(t),a+=t.length;e.once("readable",s)}function o(){var t,s=null;a>=c?s=new RangeError(u):t=i.concat(r,a),r=[],e.close(),n(s,t)}e.on("error",(function(t){e.removeListener("end",o),e.removeListener("readable",s),n(t)
})),e.on("end",o),e.end(t),s()}function y(e,t){if("string"==typeof t&&(t=i.from(t)),!i.isBuffer(t))throw new TypeError("Not a string or buffer");var n=e._finishFlushFlag;return e._processChunk(t,n)}function b(e){
if(!(this instanceof b))return new b(e);M.call(this,e,s.DEFLATE)}function x(e){if(!(this instanceof x))return new x(e);M.call(this,e,s.INFLATE)}function E(e){if(!(this instanceof E))return new E(e);M.call(this,e,s.GZIP)}function w(e){
if(!(this instanceof w))return new w(e);M.call(this,e,s.GUNZIP)}function S(e){if(!(this instanceof S))return new S(e);M.call(this,e,s.DEFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);M.call(this,e,s.INFLATERAW)}function A(e){
if(!(this instanceof A))return new A(e);M.call(this,e,s.UNZIP)}function C(e){return e===s.Z_NO_FLUSH||e===s.Z_PARTIAL_FLUSH||e===s.Z_SYNC_FLUSH||e===s.Z_FULL_FLUSH||e===s.Z_FINISH||e===s.Z_BLOCK}function M(e,n){var r=this;if(this._opts=e=e||{},
this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,a.call(this,e),e.flush&&!C(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!C(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush)
;if(this._flushFlag=e.flush||s.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:s.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize)
;if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits)
;if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel)
;if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy)
;if(e.dictionary&&!i.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new s.Zlib(n);var o=this;this._hadError=!1,this._handle.onerror=function(e,n){I(o),o._hadError=!0;var r=new Error(e)
;r.errno=n,r.code=t.codes[n],o.emit("error",r)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var c=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(c=e.strategy),
this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,c,e.dictionary),this._buffer=i.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=c,this.once("end",this.close),
Object.defineProperty(this,"_closed",{get:function(){return!r._handle},configurable:!0,enumerable:!0})}function I(e,t){t&&r.nextTick(t),e._handle&&(e._handle.close(),e._handle=null)}function R(e){e.emit("close")}Object.defineProperty(t,"codes",{
enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=b,t.Inflate=x,t.Gzip=E,t.Gunzip=w,t.DeflateRaw=S,t.InflateRaw=T,t.Unzip=A,t.createDeflate=function(e){return new b(e)},t.createInflate=function(e){return new x(e)},
t.createDeflateRaw=function(e){return new S(e)},t.createInflateRaw=function(e){return new T(e)},t.createGzip=function(e){return new E(e)},t.createGunzip=function(e){return new w(e)},t.createUnzip=function(e){return new A(e)},
t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new b(t),e,n)},t.deflateSync=function(e,t){return y(new b(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new E(t),e,n)},t.gzipSync=function(e,t){
return y(new E(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new S(t),e,n)},t.deflateRawSync=function(e,t){return y(new S(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new A(t),e,n)},
t.unzipSync=function(e,t){return y(new A(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new x(t),e,n)},t.inflateSync=function(e,t){return y(new x(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),
v(new w(t),e,n)},t.gunzipSync=function(e,t){return y(new w(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new T(t),e,n)},t.inflateRawSync=function(e,t){return y(new T(t),e)},o.inherits(M,a),
M.prototype.params=function(e,n,i){if(e<t.Z_MIN_LEVEL||e>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e)
;if(n!=t.Z_FILTERED&&n!=t.Z_HUFFMAN_ONLY&&n!=t.Z_RLE&&n!=t.Z_FIXED&&n!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==e||this._strategy!==n){var a=this;this.flush(s.Z_SYNC_FLUSH,(function(){
l(a._handle,"zlib binding closed"),a._handle.params(e,n),a._hadError||(a._level=e,a._strategy=n,i&&i())}))}else r.nextTick(i)},M.prototype.reset=function(){return l(this._handle,"zlib binding closed"),this._handle.reset()},
M.prototype._flush=function(e){this._transform(i.alloc(0),"",e)},M.prototype.flush=function(e,t){var n=this,a=this._writableState;("function"==typeof e||void 0===e&&!t)&&(t=e,e=s.Z_FULL_FLUSH),
a.ended?t&&r.nextTick(t):a.ending?t&&this.once("end",t):a.needDrain?t&&this.once("drain",(function(){return n.flush(e,t)})):(this._flushFlag=e,this.write(i.alloc(0),"",t))},M.prototype.close=function(e){I(this,e),r.nextTick(R,this)},
M.prototype._transform=function(e,t,n){var r,a=this._writableState,o=(a.ending||a.ended)&&(!e||a.length===e.length);return null===e||i.isBuffer(e)?this._handle?(o?r=this._finishFlushFlag:(r=this._flushFlag,
e.length>=a.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH)),void this._processChunk(e,r,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},M.prototype._processChunk=function(e,t,n){
var r=e&&e.length,a=this._chunkSize-this._offset,s=0,o=this,h="function"==typeof n;if(!h){var d,p=[],f=0;this.on("error",(function(e){d=e})),l(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,s,r,this._buffer,this._offset,a)
}while(!this._hadError&&v(m[0],m[1]));if(this._hadError)throw d;if(f>=c)throw I(this),new RangeError(u);var g=i.concat(p,f);return I(this),g}l(this._handle,"zlib binding closed");var _=this._handle.write(t,e,s,r,this._buffer,this._offset,a)
;function v(c,u){if(this&&(this.buffer=null,this.callback=null),!o._hadError){var d=a-u;if(l(d>=0,"have should not go down"),d>0){var m=o._buffer.slice(o._offset,o._offset+d);o._offset+=d,h?o.push(m):(p.push(m),f+=m.length)}
if((0===u||o._offset>=o._chunkSize)&&(a=o._chunkSize,o._offset=0,o._buffer=i.allocUnsafe(o._chunkSize)),0===u){if(s+=r-c,r=c,!h)return!0;var g=o._handle.write(t,e,s,r,o._buffer,o._offset,o._chunkSize);return g.callback=v,void(g.buffer=e)}
if(!h)return!1;n()}}_.buffer=e,_.callback=v},o.inherits(b,M),o.inherits(x,M),o.inherits(E,M),o.inherits(w,M),o.inherits(S,M),o.inherits(T,M),o.inherits(A,M)},8287:(e,t,n)=>{"use strict"
;const r=n(7526),i=n(251),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647
;function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){
if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),
!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let r=o(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e)
;return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)
;if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return p(e,t,n)
;if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);const i=function(e){if(l.isBuffer(e)){
const t=0|f(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||K(e.length)?o(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i
;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n)
;throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number')
;if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),o(e<0?0:0|f(e))}function d(e){const t=e.length<0?0:0|f(e.length),n=o(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){
if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r
;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function f(e){
if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength
;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){
case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(i)return r?-1:$(e).length
;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":
return R(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return M(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,n);default:
if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,
n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),
l.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i)
;throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){let a,s=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1
;s=2,o/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let r=-1;for(a=n;a<o;a++)if(c(e,a)===c(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===l)return r*s}else-1!==r&&(a-=a-r),r=-1}else for(n+l>o&&(n=o-l),a=n;a>=0;a--){let n=!0
;for(let r=0;r<l;r++)if(c(e,a+r)!==c(t,r)){n=!1;break}if(n)return a}return-1}function b(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let s;for(r>a/2&&(r=a/2),s=0;s<r;++s){
const r=parseInt(t.substr(2*s,2),16);if(K(r))return s;e[n+s]=r}return s}function x(e,t,n,r){return X($(t,e.length-n),e,n,r)}function E(e,t,n,r){return X(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)
}function w(e,t,n,r){return X(q(t),e,n,r)}function S(e,t,n,r){return X(function(e,t){let n,r,i;const a=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function T(e,t,n){
return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=n){let n,r,o,l;switch(s){case 1:
t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(a=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],
128==(192&n)&&128==(192&r)&&128==(192&o)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return function(e){const t=e.length
;if(t<=C)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}}
;return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),
l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),
Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,
l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return u(e),
e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},l.allocUnsafe=function(e){return h(e)},l.allocUnsafeSlow=function(e){return h(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},
l.compare=function(e,t){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),
!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}
return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},
l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=l.allocUnsafe(t);let i=0
;for(n=0;n<e.length;++n){let t=e[n];if(Y(t,Uint8Array))i+t.length>r.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers')
;t.copy(r,i)}i+=t.length}return r},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)_(this,t,t+1);return this},
l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length
;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length
;return 0===e?"":0===arguments.length?A(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer")
;return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},
a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,i){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),
!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),
t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0)
;const o=Math.min(a,s),c=this.slice(r,i),u=e.slice(t,n);for(let e=0;e<o;++e)if(c[e]!==u[e]){a=c[e],s=u[e];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){
return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{
if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),
e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":case"latin1":
case"binary":return E(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},
l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function M(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){
let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=J[e[r]];return i}function k(e,t,n){
const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint")
;if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,r,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds')
;if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r,i){V(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,
s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function O(e,t,n,r,i){V(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,
e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function P(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,a){return t=+t,n>>>=0,a||P(e,0,n,4),
i.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,a){return t=+t,n>>>=0,a||P(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),
t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r
},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,
t||N(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,
t||N(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},
l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=Z((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7]
;void 0!==t&&void 0!==n||j(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=Z((function(e){
H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),
l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length)
;let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},
l.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);const n=this[e+1]|this[e]<<8
;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),
this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=Z((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24)
;return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=Z((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8)
;const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!0,23,4)},
l.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,
t||N(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||D(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},
l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||D(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},
l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=255&e,
this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,
t>>>=0,n||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t]=e>>>24,
this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=Z((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=Z((function(e,t=0){
return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}let i=0,a=1,s=0
;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}let i=n-1,a=1,s=0
;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},
l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},
l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,
n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=Z((function(e,t=0){
return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=Z((function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){
return F(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},
l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0
;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n)
;const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,
n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){
const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,
n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=l.isBuffer(e)?e:l.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"')
;for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};const B={};function z(e,t,n){B[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),
this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}
function G(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function V(e,t,n,r,i,a){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i
;throw i=a>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(a+1)}${r}`:`>= -(2${r} ** ${8*(a+1)-1}${r}) and < 2 ** ${8*(a+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new B.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){H(t,"offset"),
void 0!==e[t]&&void 0!==e[t+n]||j(t,e.length-(n+1))}(r,i,a)}function H(e,t){if("number"!=typeof e)throw new B.ERR_INVALID_ARG_TYPE(t,"number",e)}function j(e,t,n){if(Math.floor(e)!==e)throw H(e,n),new B.ERR_OUT_OF_RANGE(n||"offset","an integer",e)
;if(t<0)throw new B.ERR_BUFFER_OUT_OF_BOUNDS;throw new B.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}z("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"
}),RangeError),z("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),z("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n
;return Number.isInteger(n)&&Math.abs(n)>2**32?i=G(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=G(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const W=/[^+/0-9A-Za-z-_]/g
;function $(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n
;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)
}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function q(e){
return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function X(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Y(e,t){
return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n
;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function Z(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}},3144:(e,t,n)=>{"use strict";var r=n(6743),i=n(1002),a=n(76),s=n(7119)
;e.exports=s||r.call(a,i)},1002:e=>{"use strict";e.exports=Function.prototype.apply},76:e=>{"use strict";e.exports=Function.prototype.call},3126:(e,t,n)=>{"use strict";var r=n(6743),i=n(9675),a=n(76),s=n(3144);e.exports=function(e){
if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return s(r,a,e)}},7119:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},8075:(e,t,n)=>{"use strict"
;var r=n(453),i=n(487),a=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?i(n):n}},487:(e,t,n)=>{"use strict"
;var r=n(6743),i=n(453),a=i("%Function.prototype.apply%"),s=i("%Function.prototype.call%"),o=i("%Reflect.apply%",!0)||r.call(s,a),l=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(c)try{c({},"a",{
value:1})}catch(e){c=null}e.exports=function(e){var t=o(r,s,arguments);return l&&c&&l(t,"length").configurable&&c(t,"length",{value:1+u(0,e.length-(arguments.length-1))}),t};var h=function(){return o(r,a,arguments)};c?c(e.exports,"apply",{value:h
}):e.exports.apply=h},5248:(e,t,n)=>{"use strict";const r=n(4083),{stdout:i,stderr:a}=n(2747),{stringReplaceAll:s,stringEncaseCRLFWithFirstIndex:o}=n(4058),{isArray:l}=Array,c=["ansi","ansi","ansi256","ansi16m"],u=Object.create(null);class h{
constructor(e){return d(e)}}const d=e=>{const t={};return((e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const n=i?i.level:0
;e.level=void 0===t.level?n:t.level})(t,e),t.template=(...e)=>b(t.template,...e),Object.setPrototypeOf(t,p.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=()=>{
throw new Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},t.template.Instance=h,t.template};function p(e){return d(e)}for(const[e,t]of Object.entries(r))u[e]={get(){
const n=_(this,g(t.open,t.close,this._styler),this._isEmpty);return Object.defineProperty(this,e,{value:n}),n}};u.visible={get(){const e=_(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}}
;const f=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(const e of f)u[e]={get(){const{level:t}=this;return function(...n){const i=g(r.color[c[t]][e](...n),r.color.close,this._styler);return _(this,i,this._isEmpty)}}}
;for(const e of f)u["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const{level:t}=this;return function(...n){const i=g(r.bgColor[c[t]][e](...n),r.bgColor.close,this._styler);return _(this,i,this._isEmpty)}}};const m=Object.defineProperties((()=>{}),{
...u,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),g=(e,t,n)=>{let r,i;return void 0===n?(r=e,i=t):(r=n.openAll+e,i=t+n.closeAll),{open:e,close:t,openAll:r,closeAll:i,parent:n}},_=(e,t,n)=>{
const r=(...e)=>l(e[0])&&l(e[0].raw)?v(r,b(r,...e)):v(r,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(r,m),r._generator=e,r._styler=t,r._isEmpty=n,r},v=(e,t)=>{if(e.level<=0||!t)return e._isEmpty?"":t;let n=e._styler
;if(void 0===n)return t;const{openAll:r,closeAll:i}=n;if(-1!==t.indexOf("\x1b"))for(;void 0!==n;)t=s(t,n.close,n.open),n=n.parent;const a=t.indexOf("\n");return-1!==a&&(t=o(t,i,r,a)),r+t+i};let y;const b=(e,...t)=>{const[r]=t
;if(!l(r)||!l(r.raw))return t.join(" ");const i=t.slice(1),a=[r.raw[0]];for(let e=1;e<r.length;e++)a.push(String(i[e-1]).replace(/[{}\\]/g,"\\$&"),String(r.raw[e]));return void 0===y&&(y=n(2991)),y(e,a.join(""))}
;Object.defineProperties(p.prototype,u);const x=p();x.supportsColor=i,x.stderr=p({level:a?a.level:0}),x.stderr.supportsColor=a,e.exports=x},2991:e=>{"use strict"
;const t=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,n=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,r=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,i=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,a=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e","\x1b"],["a","\x07"]])
;function s(e){const t="u"===e[0],n="{"===e[1];return t&&!n&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):t&&n?String.fromCodePoint(parseInt(e.slice(2,-1),16)):a.get(e)||e}function o(e,t){
const n=[],a=t.trim().split(/\s*,\s*/g);let o;for(const t of a){const a=Number(t);if(Number.isNaN(a)){if(!(o=t.match(r)))throw new Error(`Invalid Chalk template style argument: ${t} (in style '${e}')`);n.push(o[2].replace(i,((e,t,n)=>t?s(t):n)))
}else n.push(a)}return n}function l(e){n.lastIndex=0;const t=[];let r;for(;null!==(r=n.exec(e));){const e=r[1];if(r[2]){const n=o(e,r[2]);t.push([e].concat(n))}else t.push([e])}return t}function c(e,t){const n={}
;for(const e of t)for(const t of e.styles)n[t[0]]=e.inverse?null:t.slice(1);let r=e;for(const[e,t]of Object.entries(n))if(Array.isArray(t)){if(!(e in r))throw new Error(`Unknown Chalk style: ${e}`);r=t.length>0?r[e](...t):r[e]}return r}
e.exports=(e,n)=>{const r=[],i=[];let a=[];if(n.replace(t,((t,n,o,u,h,d)=>{if(n)a.push(s(n));else if(u){const t=a.join("");a=[],i.push(0===r.length?t:c(e,r)(t)),r.push({inverse:o,styles:l(u)})}else if(h){
if(0===r.length)throw new Error("Found extraneous } in Chalk template literal");i.push(c(e,r)(a.join(""))),a=[],r.pop()}else a.push(d)})),i.push(a.join("")),r.length>0){
const e=`Chalk template literal is missing ${r.length} closing bracket${1===r.length?"":"s"} (\`}\`)`;throw new Error(e)}return i.join("")}},4058:e=>{"use strict";e.exports={stringReplaceAll:(e,t,n)=>{let r=e.indexOf(t);if(-1===r)return e
;const i=t.length;let a=0,s="";do{s+=e.substr(a,r-a)+t+n,a=r+i,r=e.indexOf(t,a)}while(-1!==r);return s+=e.substr(a),s},stringEncaseCRLFWithFirstIndex:(e,t,n,r)=>{let i=0,a="";do{const s="\r"===e[r-1];a+=e.substr(i,(s?r-1:r)-i)+t+(s?"\r\n":"\n")+n,
i=r+1,r=e.indexOf("\n",i)}while(-1!==r);return a+=e.substr(i),a}}},2485:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var a=typeof n
;if("string"===a||"number"===a)e.push(n);else if(Array.isArray(n)){if(n.length){var s=i.apply(null,n);s&&e.push(s)}}else if("object"===a)if(n.toString===Object.prototype.toString)for(var o in n)r.call(n,o)&&n[o]&&e.push(o);else e.push(n.toString())}}
return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},5659:(e,t,n)=>{const r=n(8156),i={};for(const e of Object.keys(r))i[r[e]]=e;const a={rgb:{channels:3,labels:"rgb"},hsl:{
channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{
channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=a
;for(const e of Object.keys(a)){if(!("channels"in a[e]))throw new Error("missing channels property: "+e);if(!("labels"in a[e]))throw new Error("missing channel labels property: "+e)
;if(a[e].labels.length!==a[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:n}=a[e];delete a[e].channels,delete a[e].labels,Object.defineProperty(a[e],"channels",{value:t}),
Object.defineProperty(a[e],"labels",{value:n})}a.rgb.hsl=function(e){const t=e[0]/255,n=e[1]/255,r=e[2]/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=a-i;let o,l;a===i?o=0:t===a?o=(n-r)/s:n===a?o=2+(r-t)/s:r===a&&(o=4+(t-n)/s),o=Math.min(60*o,360),
o<0&&(o+=360);const c=(i+a)/2;return l=a===i?0:c<=.5?s/(a+i):s/(2-a-i),[o,100*l,100*c]},a.rgb.hsv=function(e){let t,n,r,i,a;const s=e[0]/255,o=e[1]/255,l=e[2]/255,c=Math.max(s,o,l),u=c-Math.min(s,o,l),h=function(e){return(c-e)/6/u+.5}
;return 0===u?(i=0,a=0):(a=u/c,t=h(s),n=h(o),r=h(l),s===c?i=r-n:o===c?i=1/3+t-r:l===c&&(i=2/3+n-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*a,100*c]},a.rgb.hwb=function(e){const t=e[0],n=e[1];let r=e[2]
;const i=a.rgb.hsl(e)[0],s=1/255*Math.min(t,Math.min(n,r));return r=1-1/255*Math.max(t,Math.max(n,r)),[i,100*s,100*r]},a.rgb.cmyk=function(e){const t=e[0]/255,n=e[1]/255,r=e[2]/255,i=Math.min(1-t,1-n,1-r)
;return[100*((1-t-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*((1-r-i)/(1-i)||0),100*i]},a.rgb.keyword=function(e){const t=i[e];if(t)return t;let n,a=1/0;for(const t of Object.keys(r)){const i=(o=r[t],((s=e)[0]-o[0])**2+(s[1]-o[1])**2+(s[2]-o[2])**2)
;i<a&&(a=i,n=t)}var s,o;return n},a.keyword.rgb=function(e){return r[e]},a.rgb.xyz=function(e){let t=e[0]/255,n=e[1]/255,r=e[2]/255;return t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,
r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,[100*(.4124*t+.3576*n+.1805*r),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]},a.rgb.lab=function(e){const t=a.rgb.xyz(e);let n=t[0],r=t[1],i=t[2];return n/=95.047,r/=100,i/=108.883,
n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,[116*r-16,500*(n-r),200*(r-i)]},a.hsl.rgb=function(e){const t=e[0]/360,n=e[1]/100,r=e[2]/100;let i,a,s;if(0===n)return s=255*r,[s,s,s]
;i=r<.5?r*(1+n):r+n-r*n;const o=2*r-i,l=[0,0,0];for(let e=0;e<3;e++)a=t+1/3*-(e-1),a<0&&a++,a>1&&a--,s=6*a<1?o+6*(i-o)*a:2*a<1?i:3*a<2?o+(i-o)*(2/3-a)*6:o,l[e]=255*s;return l},a.hsl.hsv=function(e){const t=e[0];let n=e[1]/100,r=e[2]/100,i=n
;const a=Math.max(r,.01);return r*=2,n*=r<=1?r:2-r,i*=a<=1?a:2-a,[t,100*(0===r?2*i/(a+i):2*n/(r+n)),(r+n)/2*100]},a.hsv.rgb=function(e){const t=e[0]/60,n=e[1]/100;let r=e[2]/100
;const i=Math.floor(t)%6,a=t-Math.floor(t),s=255*r*(1-n),o=255*r*(1-n*a),l=255*r*(1-n*(1-a));switch(r*=255,i){case 0:return[r,l,s];case 1:return[o,r,s];case 2:return[s,r,l];case 3:return[s,o,r];case 4:return[l,s,r];case 5:return[r,s,o]}},
a.hsv.hsl=function(e){const t=e[0],n=e[1]/100,r=e[2]/100,i=Math.max(r,.01);let a,s;s=(2-n)*r;const o=(2-n)*i;return a=n*i,a/=o<=1?o:2-o,a=a||0,s/=2,[t,100*a,100*s]},a.hwb.rgb=function(e){const t=e[0]/360;let n=e[1]/100,r=e[2]/100;const i=n+r;let a
;i>1&&(n/=i,r/=i);const s=Math.floor(6*t),o=1-r;a=6*t-s,1&s&&(a=1-a);const l=n+a*(o-n);let c,u,h;switch(s){default:case 6:case 0:c=o,u=l,h=n;break;case 1:c=l,u=o,h=n;break;case 2:c=n,u=o,h=l;break;case 3:c=n,u=l,h=o;break;case 4:c=l,u=n,h=o;break
;case 5:c=o,u=n,h=l}return[255*c,255*u,255*h]},a.cmyk.rgb=function(e){const t=e[0]/100,n=e[1]/100,r=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},a.xyz.rgb=function(e){
const t=e[0]/100,n=e[1]/100,r=e[2]/100;let i,a,s;return i=3.2406*t+-1.5372*n+-.4986*r,a=-.9689*t+1.8758*n+.0415*r,s=.0557*t+-.204*n+1.057*r,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,
s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,i=Math.min(Math.max(0,i),1),a=Math.min(Math.max(0,a),1),s=Math.min(Math.max(0,s),1),[255*i,255*a,255*s]},a.xyz.lab=function(e){let t=e[0],n=e[1],r=e[2];return t/=95.047,n/=100,r/=108.883,
t=t>.008856?t**(1/3):7.787*t+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,[116*n-16,500*(t-n),200*(n-r)]},a.lab.xyz=function(e){let t,n,r;n=(e[0]+16)/116,t=e[1]/500+n,r=n-e[2]/200;const i=n**3,a=t**3,s=r**3
;return n=i>.008856?i:(n-16/116)/7.787,t=a>.008856?a:(t-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,t*=95.047,n*=100,r*=108.883,[t,n,r]},a.lab.lch=function(e){const t=e[0],n=e[1],r=e[2];let i;return i=360*Math.atan2(r,n)/2/Math.PI,i<0&&(i+=360),
[t,Math.sqrt(n*n+r*r),i]},a.lch.lab=function(e){const t=e[0],n=e[1],r=e[2]/360*2*Math.PI;return[t,n*Math.cos(r),n*Math.sin(r)]},a.rgb.ansi16=function(e,t=null){const[n,r,i]=e;let s=null===t?a.rgb.hsv(e)[2]:t;if(s=Math.round(s/50),0===s)return 30
;let o=30+(Math.round(i/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return 2===s&&(o+=60),o},a.hsv.ansi16=function(e){return a.rgb.ansi16(a.hsv.rgb(e),e[2])},a.rgb.ansi256=function(e){const t=e[0],n=e[1],r=e[2]
;return t===n&&n===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},a.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t]
;const n=.5*(1+~~(e>50));return[(1&t)*n*255,(t>>1&1)*n*255,(t>>2&1)*n*255]},a.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;return e-=16,[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},
a.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},a.hex.rgb=function(e){
const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let n=t[0];3===t[0].length&&(n=n.split("").map((e=>e+e)).join(""));const r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},a.rgb.hcg=function(e){
const t=e[0]/255,n=e[1]/255,r=e[2]/255,i=Math.max(Math.max(t,n),r),a=Math.min(Math.min(t,n),r),s=i-a;let o,l;return o=s<1?a/(1-s):0,l=s<=0?0:i===t?(n-r)/s%6:i===n?2+(r-t)/s:4+(t-n)/s,l/=6,l%=1,[360*l,100*s,100*o]},a.hsl.hcg=function(e){
const t=e[1]/100,n=e[2]/100,r=n<.5?2*t*n:2*t*(1-n);let i=0;return r<1&&(i=(n-.5*r)/(1-r)),[e[0],100*r,100*i]},a.hsv.hcg=function(e){const t=e[1]/100,n=e[2]/100,r=t*n;let i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},a.hcg.rgb=function(e){
const t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0===n)return[255*r,255*r,255*r];const i=[0,0,0],a=t%1*6,s=a%1,o=1-s;let l=0;switch(Math.floor(a)){case 0:i[0]=1,i[1]=s,i[2]=0;break;case 1:i[0]=o,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=s;break;case 3:
i[0]=0,i[1]=o,i[2]=1;break;case 4:i[0]=s,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=o}return l=(1-n)*r,[255*(n*i[0]+l),255*(n*i[1]+l),255*(n*i[2]+l)]},a.hcg.hsv=function(e){const t=e[1]/100,n=t+e[2]/100*(1-t);let r=0;return n>0&&(r=t/n),
[e[0],100*r,100*n]},a.hcg.hsl=function(e){const t=e[1]/100,n=e[2]/100*(1-t)+.5*t;let r=0;return n>0&&n<.5?r=t/(2*n):n>=.5&&n<1&&(r=t/(2*(1-n))),[e[0],100*r,100*n]},a.hcg.hwb=function(e){const t=e[1]/100,n=t+e[2]/100*(1-t)
;return[e[0],100*(n-t),100*(1-n)]},a.hwb.hcg=function(e){const t=e[1]/100,n=1-e[2]/100,r=n-t;let i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},a.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},
a.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},a.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},a.gray.hsl=function(e){return[0,0,e[0]]},a.gray.hsv=a.gray.hsl,a.gray.hwb=function(e){
return[0,100,e[0]]},a.gray.cmyk=function(e){return[0,0,0,e[0]]},a.gray.lab=function(e){return[e[0],0,0]},a.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(n.length)+n
},a.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},734:(e,t,n)=>{const r=n(5659),i=n(8507),a={};Object.keys(r).forEach((e=>{a[e]={},Object.defineProperty(a[e],"channels",{value:r[e].channels}),Object.defineProperty(a[e],"labels",{
value:r[e].labels});const t=i(e);Object.keys(t).forEach((n=>{const r=t[n];a[e][n]=function(e){const t=function(...t){const n=t[0];if(null==n)return n;n.length>1&&(t=n);const r=e(t)
;if("object"==typeof r)for(let e=r.length,t=0;t<e;t++)r[t]=Math.round(r[t]);return r};return"conversion"in e&&(t.conversion=e.conversion),t}(r),a[e][n].raw=function(e){const t=function(...t){const n=t[0];return null==n?n:(n.length>1&&(t=n),e(t))}
;return"conversion"in e&&(t.conversion=e.conversion),t}(r)}))})),e.exports=a},8507:(e,t,n)=>{const r=n(5659);function i(e,t){return function(n){return t(e(n))}}function a(e,t){const n=[t[e].parent,e];let a=r[t[e].parent][e],s=t[e].parent
;for(;t[s].parent;)n.unshift(t[s].parent),a=i(r[t[s].parent][s],a),s=t[s].parent;return a.conversion=n,a}e.exports=function(e){const t=function(e){const t=function(){const e={},t=Object.keys(r);for(let n=t.length,r=0;r<n;r++)e[t[r]]={distance:-1,
parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;){const e=n.pop(),i=Object.keys(r[e]);for(let r=i.length,a=0;a<r;a++){const r=i[a],s=t[r];-1===s.distance&&(s.distance=t[e].distance+1,s.parent=e,n.unshift(r))}}return t
}(e),n={},i=Object.keys(t);for(let e=i.length,r=0;r<e;r++){const e=i[r];null!==t[e].parent&&(n[e]=a(e,t))}return n}},8156:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],
azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],
chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],
darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],
darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],
floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],
honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],
lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],
lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],
mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],
mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],
orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],
plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],
seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],
teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},3527:(e,t,n)=>{
const{isArray:r}=n(5622),{sort:i}=n(648),{SYMBOL_PREFIXES:a,UNDEFINED:s,symbol:o,copy_comments:l,swap_comments:c}=n(4373),u=(e,t,n,r,i)=>{l(e,t,n+r,n,i)},h=(e,t,n,r,i,a)=>{if(i>0){let s=r;for(;s-- >0;)u(e,t,n+s,i,a);return}let s=0;for(;s<r;){
const r=s++;u(e,t,n+r,i,a)}},d=(e,t)=>{a.forEach((n=>{const r=o(n,t);delete e[r]}))};class p extends Array{splice(...e){const{length:t}=this,n=super.splice(...e);let[r,i,...a]=e;r<0&&(r+=t),i=1===arguments.length?t-r:Math.min(t-r,i)
;const{length:s}=a,o=r+i;return h(this,this,o,t-o,s-i,!0),n}slice(...e){const{length:t}=this,n=super.slice(...e);if(!n.length)return new p;let[r,i]=e;return i===s?i=t:i<0&&(i+=t),r<0?r+=t:r===s&&(r=0),h(n,this,r,i-r,-r),n}unshift(...e){
const{length:t}=this,n=super.unshift(...e),{length:r}=e;return r>0&&h(this,this,0,t,r,!0),n}shift(){const e=super.shift(),{length:t}=this;return d(this,0),h(this,this,1,t,-1,!0),e}reverse(){return super.reverse(),(e=>{const{length:t}=e;let n=0
;const r=t/2;for(;n<r;n++)c(e,n,t-n-1)})(this),this}pop(){const e=super.pop();return d(this,this.length),e}concat(...e){let{length:t}=this;const n=super.concat(...e);return e.length?(h(n,this,0,this.length,0),e.forEach((e=>{const i=t
;t+=r(e)?e.length:1,e instanceof p&&h(n,e,0,e.length,i)})),n):n}sort(...e){const t=i(this,...e.slice(0,1)),n=Object.create(null);return t.forEach(((e,t)=>{if(e===t)return;const r=((e,t)=>{let n=t;for(;n in e;)n=e[n];return n})(n,e);r!==t&&(n[t]=r,
c(this,t,r))})),this}}e.exports={CommentArray:p}},4373:(e,t,n)=>{
const r=n(6288),{isObject:i,isArray:a,isString:s,isNumber:o}=n(5622),l="before",c="after-prop",u="after-colon",h="after-value",d="after",p="before-all",f="after-all",m=[l,c,u,h,d],g=[l,p,f].map(Symbol.for),_=void 0,v=(e,t)=>Symbol.for(e+":"+t),y=(e,t,n)=>Object.defineProperty(e,t,{
value:n,writable:!0,configurable:!0}),b=(e,t,n,i,a,s)=>{const o=v(a,i);if(!r(t,o))return;const l=n===i?o:v(a,n);y(e,l,t[o]),s&&delete t[o]},x=(e,t,n,r,i)=>{m.forEach((a=>{b(e,t,n,r,a,i)}))},E=(e,t)=>{g.forEach((n=>{const r=t[n];r&&y(e,n,r)}))}
;e.exports={SYMBOL_PREFIXES:m,PREFIX_BEFORE:l,PREFIX_AFTER_PROP:c,PREFIX_AFTER_COLON:u,PREFIX_AFTER_VALUE:h,PREFIX_AFTER:d,PREFIX_BEFORE_ALL:p,PREFIX_AFTER_ALL:f,BRACKET_OPEN:"[",BRACKET_CLOSE:"]",CURLY_BRACKET_OPEN:"{",CURLY_BRACKET_CLOSE:"}",
COLON:":",COMMA:",",MINUS:"-",EMPTY:"",UNDEFINED:_,symbol:v,define:y,copy_comments:x,swap_comments:(e,t,n)=>{t!==n&&m.forEach((i=>{const a=v(i,n);if(!r(e,a))return void b(e,e,n,t,i,!0);const s=e[a];delete e[a],b(e,e,n,t,i,!0),y(e,v(i,t),s)}))},
assign_non_prop_comments:E,assign(e,t,n){if(!i(e))throw new TypeError("Cannot convert undefined or null to object");if(!i(t))return e;if(n===_)n=Object.keys(t),E(e,t);else{if(!a(n))throw new TypeError("keys must be array or undefined")
;0===n.length&&E(e,t)}return((e,t,n)=>(n.forEach((n=>{(s(n)||o(n))&&r(t,n)&&(e[n]=t[n],x(e,t,n,n))})),e))(e,t,n)}}},6698:(e,t,n)=>{const{parse:r,tokenize:i}=n(25),a=n(7559),{CommentArray:s}=n(3527),{assign:o}=n(4373);e.exports={parse:r,stringify:a,
tokenize:i,CommentArray:s,assign:o}},25:(e,t,n)=>{
const r=n(1206),{CommentArray:i}=n(3527),{PREFIX_BEFORE:a,PREFIX_AFTER_PROP:s,PREFIX_AFTER_COLON:o,PREFIX_AFTER_VALUE:l,PREFIX_AFTER:c,PREFIX_BEFORE_ALL:u,PREFIX_AFTER_ALL:h,BRACKET_OPEN:d,BRACKET_CLOSE:p,CURLY_BRACKET_OPEN:f,CURLY_BRACKET_CLOSE:m,COLON:g,COMMA:_,MINUS:v,EMPTY:y,UNDEFINED:b,define:x,assign_non_prop_comments:E}=n(4373),w=e=>r.tokenize(e,{
comment:!0,loc:!0}),S=[];let T=null,A=null;const C=[];let M,I,R=!1,k=!1,N=null,D=null,L=null,O=null;const P=()=>{C.length=S.length=0,D=null,M=b},F=e=>Symbol.for(M!==b?e+g+M:e),U=(e,t)=>O?O(e,t):t,B=()=>{
const e=new SyntaxError(`Unexpected token ${L.value.slice(0,1)}`);throw Object.assign(e,L.loc.start),e},z=()=>{const e=new SyntaxError("Unexpected end of JSON input");throw Object.assign(e,D?D.loc.end:{line:1,column:0}),e},G=()=>{const e=N[++I]
;k=L&&e&&L.loc.end.line===e.loc.start.line||!1,D=L,L=e},V=()=>(L||z(),"Punctuator"===L.type?L.value:L.type),H=e=>V()===e,j=e=>{H(e)||B()},W=e=>{S.push(T),T=e},$=()=>{T=S.pop()},q=()=>{if(!A)return;const e=[];for(const t of A){if(!t.inline)break
;e.push(t)}const{length:t}=e;t&&(t===A.length?A=null:A.splice(0,t),x(T,F(c),e))},X=e=>{A&&(x(T,F(e),A),A=null)},Y=e=>{const t=[];for(;L&&(H("LineComment")||H("BlockComment"));){const e={...L,inline:k};t.push(e),G()}R||t.length&&(e?x(T,F(e),t):A=t)
},K=(e,t)=>{t&&C.push(M),M=e},J=()=>{M=C.pop()};function Z(){let e=V();if(e===f)return G(),(()=>{const e={};W(e),K(b,!0);let t,n=!1;for(Y();!(H(m)||n&&(X(l),j(_),G(),Y(),q(),H(m)));)n=!0,j("String"),t=JSON.parse(L.value),K(t),X(a),G(),Y(s),j(g),G(),
Y(o),e[t]=U(t,Z()),Y();return n&&X(c),G(),M=void 0,n||X(a),$(),J(),e})();if(e===d)return G(),(()=>{const e=new i;W(e),K(b,!0);let t=!1,n=0;for(Y();!(H(p)||t&&(X(l),j(_),G(),Y(),q(),H(p)));)t=!0,K(n),X(a),e[n]=U(n,Z()),n++,Y();return t&&X(c),G(),
M=void 0,t||X(a),$(),J(),e})();let t,n=y;switch(e===v&&(G(),e=V(),n=v),e){case"String":case"Boolean":case"Null":case"Numeric":return t=L.value,G(),JSON.parse(n+t)}}e.exports={parse:(e,t,n)=>{P(),N=w(e),O=t,R=n,N.length||z(),I=-1,G(),W({}),Y(u)
;let r=Z();var i;return Y(h),L&&B(),n||null===r||(i=r,Object(i)!==i&&(r=new Object(r)),E(r,T)),$(),r=U("",r),P(),N.length=0,A=T=N=D=L=O=null,r},tokenize:w}},7559:(e,t,n)=>{
const{isArray:r,isObject:i,isFunction:a,isNumber:s,isString:o}=n(5622),l=n(5208),{PREFIX_BEFORE_ALL:c,PREFIX_BEFORE:u,PREFIX_AFTER_PROP:h,PREFIX_AFTER_COLON:d,PREFIX_AFTER_VALUE:p,PREFIX_AFTER:f,PREFIX_AFTER_ALL:m,BRACKET_OPEN:g,BRACKET_CLOSE:_,CURLY_BRACKET_OPEN:v,CURLY_BRACKET_CLOSE:y,COLON:b,COMMA:x,EMPTY:E,UNDEFINED:w}=n(4373),S=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,T="\n",A="null",C=e=>`${u}:${e}`,M=e=>`${p}:${e}`,I=e=>`${f}:${e}`,R={
"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k=e=>`"${(e=>(S.lastIndex=0,S.test(e)?e.replace(S,(e=>{const t=R[e];return"string"==typeof t?t:e})):e))(e)}"`,N=(e,t,n,r)=>{const i=e[Symbol.for(t)]
;if(!i||!i.length)return E;let a=!1;const s=i.reduce(((e,{inline:t,type:r,value:i})=>(a="LineComment"===r,e+(t?" ":T+n)+((e,t)=>t?`//${e}`:`/*${e}*/`)(i,a))),E);return r||a?s+T+n:s};let D=null,L=E
;const O=(e,t,n)=>e?t?e+t.trim()+T+n:e.trimRight()+T+n:t?t.trimRight()+T+n:E,P=(e,t,n)=>{const r=N(t,u,n+L,!0);return O(r,e,n)};function F(e,t,n){let s=t[e];switch(i(s)&&a(s.toJSON)&&(s=s.toJSON(e)),a(D)&&(s=D.call(t,e,s)),typeof s){case"string":
return k(s);case"number":return Number.isFinite(s)?String(s):A;case"boolean":case"null":return String(s);case"object":return r(s)?((e,t)=>{const n=t+L,{length:r}=e;let i=E,a=E;for(let t=0;t<r;t++)0!==t&&(i+=x),i+=O(a,N(e,C(t),n),n)||T+n,
i+=F(t,e,n)||A,i+=N(e,M(t),n),a=N(e,I(t),n);return i+=O(a,N(e,f,n),n),g+P(i,e,t)+_})(s,n):((e,t)=>{if(!e)return"null";const n=t+L;let i=E,a=E,s=!0;return(r(D)?D:Object.keys(e)).forEach((t=>{const r=F(t,e,n);if(r===w)return;s||(i+=x),s=!1
;const o=O(a,N(e,C(t),n),n);i+=o||T+n,i+=k(t)+N(e,`${h}:${t}`,n)+b+N(e,`${d}:${t}`,n)+" "+r+N(e,M(t),n),a=N(e,I(t),n)})),i+=O(a,N(e,f,n),n),v+P(i,e,t)+y})(s,n)}}
const{toString:U}=Object.prototype,B=["[object Number]","[object String]","[object Boolean]"];e.exports=(e,t,n)=>{const u=(e=>o(e)?e:s(e)?l(" ",e):E)(n);if(!u)return JSON.stringify(e,t);a(t)||r(t)||(t=null),D=t,L=u;const h=(e=>{
if("object"!=typeof e)return!1;const t=U.call(e);return B.includes(t)})(e)?JSON.stringify(e):F("",{"":e},E);return D=null,L=E,i(e)?N(e,c,E).trimLeft()+h+N(e,m,E).trimRight():h}},5622:(e,t,n)=>{function r(e){return Object.prototype.toString.call(e)}
t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){
return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){
return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){
return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(8287).Buffer.isBuffer},7833:(e,t,n)=>{var r=n(5606);t.formatArgs=function(t){
if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0
;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}
return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0
;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e
;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)
},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,
console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),
t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],
t.log=console.debug||console.log||(()=>{}),e.exports=n(736)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},736:(e,t,n)=>{e.exports=function(e){function t(e){
let n,i,a,s=null;function o(...e){if(!o.enabled)return;const r=o,i=Number(new Date),a=i-(n||i);r.diff=a,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{
if("%%"===n)return"%";s++;const a=t.formatters[i];if("function"==typeof a){const t=e[s];n=a.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return o.namespace=e,o.useColors=t.useColors(),
o.color=t.selectColor(e),o.extend=r,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}
function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e,t){let n=0,r=0,i=-1,a=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(i=r,a=n,r++):(n++,r++);else{if(-1===i)return!1;r=i+1,
a++,n=a}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",")
;return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},
t.enabled=function(e){for(const n of t.skips)if(i(e,n))return!1;for(const n of t.names)if(i(e,n))return!0;return!1},t.humanize=n(6585),t.destroy=function(){
console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},
t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},8452:(e,t,n)=>{"use strict"
;var r=n(1189),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),a=Object.prototype.toString,s=Array.prototype.concat,o=Object.defineProperty,l=o&&function(){var e={};try{for(var t in o(e,"x",{enumerable:!1,value:e}),e)return!1
;return e.x===e}catch(e){return!1}}(),c=function(e,t,n,r){var i;(!(t in e)||"function"==typeof(i=r)&&"[object Function]"===a.call(i)&&r())&&(l?o(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},u=function(e,t){
var n=arguments.length>2?arguments[2]:{},a=r(t);i&&(a=s.call(a,Object.getOwnPropertySymbols(t)));for(var o=0;o<a.length;o+=1)c(e,a[o],t[a[o]],n[a[o]])};u.supportsDescriptors=!!l,e.exports=u},1492:e=>{!function(){"use strict";function t(e,n,i){
if(!e)return null;t.caseSensitive||(e=e.toLowerCase());var a,s=null===t.threshold?null:t.threshold*e.length,o=t.thresholdAbsolute;a=null!==s&&null!==o?Math.min(s,o):null!==s?s:null!==o?o:null;var l,c,u,h,d=n.length;for(h=0;h<d;h++)if(c=n[h],
i&&(c=c[i]),c&&(u=r(e,t.caseSensitive?c:c.toLowerCase(),a),(null===a||u<a)&&(a=u,l=i&&t.returnWinningObject?n[h]:c,t.returnFirstMatch)))return l;return l||t.nullResultValue}t.threshold=.4,t.thresholdAbsolute=20,t.caseSensitive=!1,
t.nullResultValue=null,t.returnWinningObject=null,t.returnFirstMatch=!1,e.exports?e.exports=t:window.didYouMean=t;var n=Math.pow(2,32)-1;function r(e,t,r){r=r||0===r?r:n;var i=e.length,a=t.length;if(0===i)return Math.min(r+1,a)
;if(0===a)return Math.min(r+1,i);if(Math.abs(i-a)>r)return r+1;var s,o,l,c,u,h=[];for(s=0;s<=a;s++)h[s]=[s];for(o=0;o<=i;o++)h[0][o]=o;for(s=1;s<=a;s++){for(l=n,c=1,s>r&&(c=s-r),(u=a+1)>r+s&&(u=r+s),
o=1;o<=i;o++)o<c||o>u?h[s][o]=r+1:t.charAt(s-1)===e.charAt(o-1)?h[s][o]=h[s-1][o-1]:h[s][o]=Math.min(h[s-1][o-1]+1,Math.min(h[s][o-1]+1,h[s-1][o]+1)),h[s][o]<l&&(l=h[s][o]);if(l>r)return r+1}return h[a][i]}}()},7176:(e,t,n)=>{"use strict"
;var r,i=n(3126),a=n(5795);try{r=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var s=!!r&&a&&a(Object.prototype,"__proto__"),o=Object,l=o.getPrototypeOf
;e.exports=s&&"function"==typeof s.get?i([s.get]):"function"==typeof l&&function(e){return l(null==e?e:o(e))}},655:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},1237:e=>{"use strict"
;e.exports=EvalError},9383:e=>{"use strict";e.exports=Error},9290:e=>{"use strict";e.exports=RangeError},9538:e=>{"use strict";e.exports=ReferenceError},8068:e=>{"use strict";e.exports=SyntaxError},9675:e=>{"use strict";e.exports=TypeError},5345:e=>{
"use strict";e.exports=URIError},9612:e=>{"use strict";e.exports=Object},9491:e=>{"use strict";function t(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){
var i=arguments[r];if(null!=i)for(var a=Object.keys(Object(i)),s=0,o=a.length;s<o;s++){var l=a[s],c=Object.getOwnPropertyDescriptor(i,l);void 0!==c&&c.enumerable&&(n[l]=i[l])}}return n}e.exports={assign:t,polyfill:function(){
Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}}},1206:function(e){var t;t=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,
loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(3),a=n(8),s=n(15);function o(e,t,n){
var s=null,o=function(e,t){n&&n(e,t),s&&s.visit(e,t)},l="function"==typeof n?o:null,c=!1;if(t){c="boolean"==typeof t.comment&&t.comment;var u="boolean"==typeof t.attachComment&&t.attachComment;(c||u)&&((s=new r.CommentHandler).attach=u,t.comment=!0,
l=o)}var h,d=!1;t&&"string"==typeof t.sourceType&&(d="module"===t.sourceType),h=t&&"boolean"==typeof t.jsx&&t.jsx?new i.JSXParser(e,t,l):new a.Parser(e,t,l);var p=d?h.parseModule():h.parseScript();return c&&s&&(p.comments=s.comments),
h.config.tokens&&(p.tokens=h.tokens),h.config.tolerant&&(p.errors=h.errorHandler.errors),p}t.parse=o,t.parseModule=function(e,t,n){var r=t||{};return r.sourceType="module",o(e,r,n)},t.parseScript=function(e,t,n){var r=t||{}
;return r.sourceType="script",o(e,r,n)},t.tokenize=function(e,t,n){var r,i=new s.Tokenizer(e,t);r=[];try{for(;;){var a=i.getNextToken();if(!a)break;n&&(a=n(a)),r.push(a)}}catch(e){i.errorHandler.tolerate(e)}
return i.errorHandler.tolerant&&(r.errors=i.errors()),r};var l=n(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(){this.attach=!1,
this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===r.Syntax.BlockStatement&&0===e.body.length){for(var n=[],i=this.leading.length-1;i>=0;--i){var a=this.leading[i]
;t.end.offset>=a.start&&(n.unshift(a.comment),this.leading.splice(i,1),this.trailing.splice(i,1))}n.length&&(e.innerComments=n)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){
for(var n=this.trailing.length-1;n>=0;--n){var r=this.trailing[n];r.start>=e.end.offset&&t.unshift(r.comment)}return this.trailing.length=0,t}var i=this.stack[this.stack.length-1];if(i&&i.node.trailingComments){var a=i.node.trailingComments[0]
;a&&a.range[0]>=e.end.offset&&(t=i.node.trailingComments,delete i.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,n=[];this.stack.length>0&&(a=this.stack[this.stack.length-1])&&a.start>=e.start.offset;)t=a.node,
this.stack.pop();if(t){for(var r=(t.leadingComments?t.leadingComments.length:0)-1;r>=0;--r){var i=t.leadingComments[r];i.range[1]<=e.start.offset&&(n.unshift(i),t.leadingComments.splice(r,1))}
return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,n}for(r=this.leading.length-1;r>=0;--r){var a;(a=this.leading[r]).start<=e.start.offset&&(n.unshift(a.comment),this.leading.splice(r,1))}return n},
e.prototype.visitNode=function(e,t){if(!(e.type===r.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var n=this.findTrailingComments(t),i=this.findLeadingComments(t);i.length>0&&(e.leadingComments=i),n.length>0&&(e.trailingComments=n),
this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var n="L"===e.type[0]?"Line":"Block",r={type:n,value:e.value};if(e.range&&(r.range=e.range),e.loc&&(r.loc=e.loc),this.comments.push(r),this.attach){var i={
comment:{type:n,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(i.comment.loc=e.loc),e.type=n,this.leading.push(i),this.trailing.push(i)}},e.prototype.visit=function(e,t){
"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={
AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",
BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",
ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",
ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",
ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",
ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",
MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",
SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",
TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",
VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]
}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})
;Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(5),o=n(6),l=n(7),c=n(8),u=n(13),h=n(14);function d(e){var t;switch(e.type){case o.JSXSyntax.JSXIdentifier:t=e.name;break;case o.JSXSyntax.JSXNamespacedName:var n=e
;t=d(n.namespace)+":"+d(n.name);break;case o.JSXSyntax.JSXMemberExpression:var r=e;t=d(r.object)+"."+d(r.property)}return t}u.TokenName[100]="JSXIdentifier",u.TokenName[101]="JSXText";var p=function(e){function t(t,n,r){
return e.call(this,t,n,r)||this}return i(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){
this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){
this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},
t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){
for(var t="&",n=!0,r=!1,i=!1,s=!1;!this.scanner.eof()&&n&&!r;){var o=this.scanner.source[this.scanner.index];if(o===e)break;if(r=";"===o,t+=o,++this.scanner.index,!r)switch(t.length){case 2:i="#"===o;break;case 3:
i&&(n=(s="x"===o)||a.Character.isDecimalDigit(o.charCodeAt(0)),i=i&&!s);break;default:n=(n=n&&!(i&&!a.Character.isDecimalDigit(o.charCodeAt(0))))&&!(s&&!a.Character.isHexDigit(o.charCodeAt(0)))}}if(n&&r&&t.length>2){var l=t.substr(1,t.length-2)
;i&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):s&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):i||s||!h.XHTMLEntities[l]||(t=h.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){
var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:o=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,
start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){
for(var t=this.scanner.index,n=this.scanner.source[this.scanner.index++],r="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==n;)r+="&"===l?this.scanXHTMLEntity(n):l;return{type:8,value:r,lineNumber:this.scanner.lineNumber,
lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var i=this.scanner.source.charCodeAt(this.scanner.index+1),s=this.scanner.source.charCodeAt(this.scanner.index+2),o=46===i&&46===s?"...":".";return t=this.scanner.index,
this.scanner.index+=o.length,{type:7,value:o,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,
start:this.scanner.index,end:this.scanner.index};if(a.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index)
;if(a.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,
start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,
this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,
this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart
;for(var e=this.scanner.index,t="";!this.scanner.eof();){var n=this.scanner.source[this.scanner.index];if("{"===n||"<"===n)break;++this.scanner.index,t+=n,a.Character.isLineTerminator(n.charCodeAt(0))&&(++this.scanner.lineNumber,
"\r"===n&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,
this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var r={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index}
;return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(r)),r},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},
t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){
var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new s.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier()
;if(this.matchJSX(":")){var n=t;this.expectJSX(":");var r=this.parseJSXIdentifier();t=this.finalize(e,new s.JSXNamespacedName(n,r))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var i=t;this.expectJSX(".");var a=this.parseJSXIdentifier()
;t=this.finalize(e,new s.JSXMemberExpression(i,a))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),n=this.parseJSXIdentifier();if(this.matchJSX(":")){var r=n;this.expectJSX(":");var i=this.parseJSXIdentifier()
;e=this.finalize(t,new s.JSXNamespacedName(r,i))}else e=n;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var n=this.getTokenRaw(t)
;return this.finalize(e,new l.Literal(t.value,n))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),
this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXExpressionContainer(t))},
t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){
var e=this.createJSXNode(),t=this.parseJSXAttributeName(),n=null;return this.matchJSX("=")&&(this.expectJSX("="),n=this.parseJSXAttributeValue()),this.finalize(e,new s.JSXAttribute(t,n))},t.prototype.parseJSXSpreadAttribute=function(){
var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){
for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode()
;this.expectJSX("<");var t=this.parseJSXElementName(),n=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(t,r,n))},t.prototype.parseJSXBoundaryElement=function(){
var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new s.JSXClosingElement(t))}
var n=this.parseJSXElementName(),r=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(n,i,r))},t.prototype.parseJSXEmptyExpression=function(){
var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,
this.finalize(e,new s.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),
e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new s.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),n=this.nextJSXText();if(n.start<n.end){
var r=this.getTokenRaw(n),i=this.finalize(t,new s.JSXText(n.value,r));e.push(i)}if("{"!==this.scanner.source[this.scanner.index])break;var a=this.parseJSXExpressionContainer();e.push(a)}return e},t.prototype.parseComplexJSXElement=function(e){
for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var n=this.createJSXChildNode(),r=this.parseJSXBoundaryElement();if(r.type===o.JSXSyntax.JSXOpeningElement){var i=r;if(i.selfClosing){
var a=this.finalize(n,new s.JSXElement(i,[],null));e.children.push(a)}else t.push(e),e={node:n,opening:i,closing:null,children:[]}}if(r.type===o.JSXSyntax.JSXClosingElement){e.closing=r;var l=d(e.opening.name)
;if(l!==d(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;a=this.finalize(e.node,new s.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(a),t.pop()}}return e},
t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),n=[],r=null;if(!t.selfClosing){var i=this.parseComplexJSXElement({node:e,opening:t,closing:r,children:n});n=i.children,r=i.closing}
return this.finalize(e,new s.JSXElement(t,n,r))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){
return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(c.Parser);t.JSXParser=p},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={
NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,
NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/
};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){
return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},
isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){
return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&n.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){
return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.JSXClosingElement=function(e){
this.type=r.JSXSyntax.JSXClosingElement,this.name=e},t.JSXElement=function(e,t,n){this.type=r.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=n},t.JSXEmptyExpression=function(){this.type=r.JSXSyntax.JSXEmptyExpression},
t.JSXExpressionContainer=function(e){this.type=r.JSXSyntax.JSXExpressionContainer,this.expression=e},t.JSXIdentifier=function(e){this.type=r.JSXSyntax.JSXIdentifier,this.name=e},t.JSXMemberExpression=function(e,t){
this.type=r.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t},t.JSXAttribute=function(e,t){this.type=r.JSXSyntax.JSXAttribute,this.name=e,this.value=t},t.JSXNamespacedName=function(e,t){this.type=r.JSXSyntax.JSXNamespacedName,
this.namespace=e,this.name=t},t.JSXOpeningElement=function(e,t,n){this.type=r.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=n},t.JSXSpreadAttribute=function(e){this.type=r.JSXSyntax.JSXSpreadAttribute,this.argument=e},
t.JSXText=function(e,t){this.type=r.JSXSyntax.JSXText,this.value=e,this.raw=t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",
JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",
JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.ArrayExpression=function(e){
this.type=r.Syntax.ArrayExpression,this.elements=e},t.ArrayPattern=function(e){this.type=r.Syntax.ArrayPattern,this.elements=e},t.ArrowFunctionExpression=function(e,t,n){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,
this.body=t,this.generator=!1,this.expression=n,this.async=!1},t.AssignmentExpression=function(e,t,n){this.type=r.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=n},t.AssignmentPattern=function(e,t){
this.type=r.Syntax.AssignmentPattern,this.left=e,this.right=t},t.AsyncArrowFunctionExpression=function(e,t,n){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!0},
t.AsyncFunctionDeclaration=function(e,t,n){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0},t.AsyncFunctionExpression=function(e,t,n){this.type=r.Syntax.FunctionExpression,
this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0},t.AwaitExpression=function(e){this.type=r.Syntax.AwaitExpression,this.argument=e},t.BinaryExpression=function(e,t,n){var i="||"===e||"&&"===e
;this.type=i?r.Syntax.LogicalExpression:r.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=n},t.BlockStatement=function(e){this.type=r.Syntax.BlockStatement,this.body=e},t.BreakStatement=function(e){this.type=r.Syntax.BreakStatement,
this.label=e},t.CallExpression=function(e,t){this.type=r.Syntax.CallExpression,this.callee=e,this.arguments=t},t.CatchClause=function(e,t){this.type=r.Syntax.CatchClause,this.param=e,this.body=t},t.ClassBody=function(e){this.type=r.Syntax.ClassBody,
this.body=e},t.ClassDeclaration=function(e,t,n){this.type=r.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=n},t.ClassExpression=function(e,t,n){this.type=r.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=n},
t.ComputedMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t},t.ConditionalExpression=function(e,t,n){this.type=r.Syntax.ConditionalExpression,this.test=e,this.consequent=t,
this.alternate=n},t.ContinueStatement=function(e){this.type=r.Syntax.ContinueStatement,this.label=e},t.DebuggerStatement=function(){this.type=r.Syntax.DebuggerStatement},t.Directive=function(e,t){this.type=r.Syntax.ExpressionStatement,
this.expression=e,this.directive=t},t.DoWhileStatement=function(e,t){this.type=r.Syntax.DoWhileStatement,this.body=e,this.test=t},t.EmptyStatement=function(){this.type=r.Syntax.EmptyStatement},t.ExportAllDeclaration=function(e){
this.type=r.Syntax.ExportAllDeclaration,this.source=e},t.ExportDefaultDeclaration=function(e){this.type=r.Syntax.ExportDefaultDeclaration,this.declaration=e},t.ExportNamedDeclaration=function(e,t,n){this.type=r.Syntax.ExportNamedDeclaration,
this.declaration=e,this.specifiers=t,this.source=n},t.ExportSpecifier=function(e,t){this.type=r.Syntax.ExportSpecifier,this.exported=t,this.local=e},t.ExpressionStatement=function(e){this.type=r.Syntax.ExpressionStatement,this.expression=e},
t.ForInStatement=function(e,t,n){this.type=r.Syntax.ForInStatement,this.left=e,this.right=t,this.body=n,this.each=!1},t.ForOfStatement=function(e,t,n){this.type=r.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=n},
t.ForStatement=function(e,t,n,i){this.type=r.Syntax.ForStatement,this.init=e,this.test=t,this.update=n,this.body=i},t.FunctionDeclaration=function(e,t,n,i){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=i,
this.expression=!1,this.async=!1},t.FunctionExpression=function(e,t,n,i){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=i,this.expression=!1,this.async=!1},t.Identifier=function(e){
this.type=r.Syntax.Identifier,this.name=e},t.IfStatement=function(e,t,n){this.type=r.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=n},t.ImportDeclaration=function(e,t){this.type=r.Syntax.ImportDeclaration,this.specifiers=e,
this.source=t},t.ImportDefaultSpecifier=function(e){this.type=r.Syntax.ImportDefaultSpecifier,this.local=e},t.ImportNamespaceSpecifier=function(e){this.type=r.Syntax.ImportNamespaceSpecifier,this.local=e},t.ImportSpecifier=function(e,t){
this.type=r.Syntax.ImportSpecifier,this.local=e,this.imported=t},t.LabeledStatement=function(e,t){this.type=r.Syntax.LabeledStatement,this.label=e,this.body=t},t.Literal=function(e,t){this.type=r.Syntax.Literal,this.value=e,this.raw=t},
t.MetaProperty=function(e,t){this.type=r.Syntax.MetaProperty,this.meta=e,this.property=t},t.MethodDefinition=function(e,t,n,i,a){this.type=r.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=n,this.kind=i,this.static=a},
t.Module=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="module"},t.NewExpression=function(e,t){this.type=r.Syntax.NewExpression,this.callee=e,this.arguments=t},t.ObjectExpression=function(e){this.type=r.Syntax.ObjectExpression,
this.properties=e},t.ObjectPattern=function(e){this.type=r.Syntax.ObjectPattern,this.properties=e},t.Property=function(e,t,n,i,a,s){this.type=r.Syntax.Property,this.key=t,this.computed=n,this.value=i,this.kind=e,this.method=a,this.shorthand=s},
t.RegexLiteral=function(e,t,n,i){this.type=r.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:n,flags:i}},t.RestElement=function(e){this.type=r.Syntax.RestElement,this.argument=e},t.ReturnStatement=function(e){
this.type=r.Syntax.ReturnStatement,this.argument=e},t.Script=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="script"},t.SequenceExpression=function(e){this.type=r.Syntax.SequenceExpression,this.expressions=e},
t.SpreadElement=function(e){this.type=r.Syntax.SpreadElement,this.argument=e},t.StaticMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t},t.Super=function(){this.type=r.Syntax.Super},
t.SwitchCase=function(e,t){this.type=r.Syntax.SwitchCase,this.test=e,this.consequent=t},t.SwitchStatement=function(e,t){this.type=r.Syntax.SwitchStatement,this.discriminant=e,this.cases=t},t.TaggedTemplateExpression=function(e,t){
this.type=r.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t},t.TemplateElement=function(e,t){this.type=r.Syntax.TemplateElement,this.value=e,this.tail=t},t.TemplateLiteral=function(e,t){this.type=r.Syntax.TemplateLiteral,this.quasis=e,
this.expressions=t},t.ThisExpression=function(){this.type=r.Syntax.ThisExpression},t.ThrowStatement=function(e){this.type=r.Syntax.ThrowStatement,this.argument=e},t.TryStatement=function(e,t,n){this.type=r.Syntax.TryStatement,this.block=e,
this.handler=t,this.finalizer=n},t.UnaryExpression=function(e,t){this.type=r.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0},t.UpdateExpression=function(e,t,n){this.type=r.Syntax.UpdateExpression,this.operator=e,
this.argument=t,this.prefix=n},t.VariableDeclaration=function(e,t){this.type=r.Syntax.VariableDeclaration,this.declarations=e,this.kind=t},t.VariableDeclarator=function(e,t){this.type=r.Syntax.VariableDeclarator,this.id=e,this.init=t},
t.WhileStatement=function(e,t){this.type=r.Syntax.WhileStatement,this.test=e,this.body=t},t.WithStatement=function(e,t){this.type=r.Syntax.WithStatement,this.object=e,this.body=t},t.YieldExpression=function(e,t){this.type=r.Syntax.YieldExpression,
this.argument=e,this.delegate=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(10),a=n(11),s=n(7),o=n(12),l=n(2),c=n(13),u="ArrowParameterPlaceHolder",h=function(){function e(e,t,n){void 0===t&&(t={}),
this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},
this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=n,this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new o.Scanner(e,this.errorHandler),
this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},
this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,
isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,
column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]
;var i=Array.prototype.slice.call(arguments,1),a=e.replace(/%(\d)/g,(function(e,t){return r.assert(t<i.length,"Message reference must be in range"),i[t]})),s=this.lastMarker.index,o=this.lastMarker.line,l=this.lastMarker.column+1
;throw this.errorHandler.createError(s,o,l,a)},e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=Array.prototype.slice.call(arguments,1),a=e.replace(/%(\d)/g,(function(e,t){
return r.assert(t<i.length,"Message reference must be in range"),i[t]})),s=this.lastMarker.index,o=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(s,o,l,a)},e.prototype.unexpectedTokenError=function(e,t){
var n,r=t||a.Messages.UnexpectedToken
;if(e?(t||(r=2===e.type?a.Messages.UnexpectedEOS:3===e.type?a.Messages.UnexpectedIdentifier:6===e.type?a.Messages.UnexpectedNumber:8===e.type?a.Messages.UnexpectedString:10===e.type?a.Messages.UnexpectedTemplate:a.Messages.UnexpectedToken,
4===e.type&&(this.scanner.isFutureReservedWord(e.value)?r=a.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(r=a.Messages.StrictReservedWord))),n=e.value):n="ILLEGAL",r=r.replace("%0",n),
e&&"number"==typeof e.lineNumber){var i=e.start,s=e.lineNumber,o=this.lastMarker.index-this.lastMarker.column,l=e.start-o+1;return this.errorHandler.createError(i,s,l,r)}return i=this.lastMarker.index,s=this.lastMarker.line,
l=this.lastMarker.column+1,this.errorHandler.createError(i,s,l,r)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){
this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var n=e[t],r=void 0;r={
type:n.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(n.slice[0],n.slice[1])},this.config.range&&(r.range=n.range),this.config.loc&&(r.loc=n.loc);var i={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]
},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(r,i)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){
var t={type:c.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,
column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var n=e.pattern,r=e.flags;t.regex={pattern:n,flags:r}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,
this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,
this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,
t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments()
;var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,
line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var n=e.start-e.lineStart,r=e.lineNumber;return n<0&&(n+=t,r--),{index:e.start,line:r,column:n}},e.prototype.finalize=function(e,t){
if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),
this.delegate){var n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},e.prototype.expect=function(e){var t=this.nextToken()
;7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),
this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,a.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},
e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){
return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value
;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){
var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null
;var i=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,
this.context.firstCoverInitializedNameError=r,i},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,
this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var i=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,
this.context.firstCoverInitializedNameError=r||this.context.firstCoverInitializedNameError,i},e.prototype.consumeSemicolon=function(){
this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,
this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,n,r=this.createNode();switch(this.lookahead.type){case 3:
(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(r,new s.Identifier(this.nextToken().value));break
;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,a.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),
e=this.finalize(r,new s.Literal(t.value,n));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(r,new s.Literal("true"===t.value,n));break;case 5:
this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(r,new s.Literal(null,n));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":
this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":
this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),n=this.getTokenRaw(t),e=this.finalize(r,new s.RegexLiteral(t.regex,n,t.pattern,t.flags));break;default:
e=this.throwUnexpectedToken(this.nextToken())}break;case 4:
!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(r,new s.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,
this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),
e=this.finalize(r,new s.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},
e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new s.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){
var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var n=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,
this.context.isBindingElement=!1,this.expect(",")),t.push(n)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new s.ArrayExpression(t))},
e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,n=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple
;var r=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),
this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=n,r},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield
;this.context.allowYield=!0;var n=this.parseFormalParameters(),r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,r,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){
var e=this.createNode(),t=this.context.allowYield,n=this.context.await;this.context.allowYield=!1,this.context.await=!0;var r=this.parseFormalParameters(),i=this.parsePropertyMethod(r);return this.context.allowYield=t,this.context.await=n,
this.finalize(e,new s.AsyncFunctionExpression(null,r.params,i))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),n=this.nextToken();switch(n.type){case 8:case 6:
this.context.strict&&n.octal&&this.tolerateUnexpectedToken(n,a.Messages.StrictOctalLiteral);var r=this.getTokenRaw(n);e=this.finalize(t,new s.Literal(n.value,r));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new s.Identifier(n.value));break
;case 7:"["===n.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(n);break;default:e=this.throwUnexpectedToken(n)}return e},e.prototype.isPropertyKey=function(e,t){
return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,n=this.createNode(),r=this.lookahead,i=null,o=null,l=!1,c=!1,u=!1,h=!1;if(3===r.type){var d=r.value
;this.nextToken(),l=this.match("["),i=(h=!(this.hasLineTerminator||"async"!==d||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(n,new s.Identifier(d))
}else this.match("*")?this.nextToken():(l=this.match("["),i=this.parseObjectPropertyKey());var p=this.qualifiedPropertyName(this.lookahead);if(3===r.type&&!h&&"get"===r.value&&p)t="get",l=this.match("["),i=this.parseObjectPropertyKey(),
this.context.allowYield=!1,o=this.parseGetterMethod();else if(3===r.type&&!h&&"set"===r.value&&p)t="set",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseSetterMethod();else if(7===r.type&&"*"===r.value&&p)t="init",l=this.match("["),
i=this.parseObjectPropertyKey(),o=this.parseGeneratorMethod(),c=!0;else if(i||this.throwUnexpectedToken(this.lookahead),t="init",
this.match(":")&&!h)!l&&this.isPropertyKey(i,"__proto__")&&(e.value&&this.tolerateError(a.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),
o=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))o=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0;else if(3===r.type)if(d=this.finalize(n,new s.Identifier(r.value)),
this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),u=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);o=this.finalize(n,new s.AssignmentPattern(d,f))}else u=!0,
o=d;else this.throwUnexpectedToken(this.nextToken());return this.finalize(n,new s.Property(t,i,l,o,c,u))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],n={value:!1
};!this.match("}");)t.push(this.parseObjectProperty(n)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new s.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){
r.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new s.TemplateElement({raw:n,cooked:i},t.tail))},
e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),n=t.value,r=t.cooked;return this.finalize(e,new s.TemplateElement({raw:n,cooked:r},t.tail))},
e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],n=[],r=this.parseTemplateHead();for(n.push(r);!r.tail;)t.push(this.parseExpression()),r=this.parseTemplateElement(),n.push(r);return this.finalize(e,new s.TemplateLiteral(n,t))
},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,
this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break
;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,
this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:u,params:[],async:!1};else{var t=this.lookahead,n=[]
;if(this.match("..."))e=this.parseRestElement(n),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:u,params:[e],async:!1};else{var r=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),
this.match(",")){var i=[];for(this.context.isAssignmentTarget=!1,i.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var a=0;a<i.length;a++)this.reinterpretExpressionAsPattern(i[a]);r=!0,e={
type:u,params:i,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),i.push(this.parseRestElement(n)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,
a=0;a<i.length;a++)this.reinterpretExpressionAsPattern(i[a]);r=!0,e={type:u,params:i,async:!1}}else i.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(r)break}r||(e=this.finalize(this.startNode(t),new s.SequenceExpression(i)))}
if(!r){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(r=!0,e={type:u,params:[e],async:!1}),!r)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),
e.type===l.Syntax.SequenceExpression)for(a=0;a<e.expressions.length;a++)this.reinterpretExpressionAsPattern(e.expressions[a]);else this.reinterpretExpressionAsPattern(e);var o=e.type===l.Syntax.SequenceExpression?e.expressions:[e];e={type:u,params:o,
async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){
var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},
e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),
this.finalize(e,new s.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),n=this.parseIdentifierName();if(r.assert("new"===n.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),
3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var i=this.parseIdentifierName();e=new s.MetaProperty(n,i)}else this.throwUnexpectedToken(this.lookahead);else{
var a=this.isolateCoverGrammar(this.parseLeftHandSideExpression),o=this.match("(")?this.parseArguments():[];e=new s.NewExpression(a,o),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},
e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){
var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},
e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,n=this.matchContextualKeyword("async"),r=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),
this.nextToken(),
e=this.finalize(e,new s.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){
this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var i=this.parseIdentifierName();e=this.finalize(this.startNode(t),new s.StaticMemberExpression(e,i))}else if(this.match("(")){
var a=n&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var o=a?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new s.CallExpression(e,o)),
a&&this.match("=>")){for(var l=0;l<o.length;++l)this.reinterpretExpressionAsPattern(o[l]);e={type:u,params:o,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),
i=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new s.ComputedMemberExpression(e,i));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var c=this.parseTemplateLiteral()
;e=this.finalize(this.startNode(t),new s.TaggedTemplateExpression(e,c))}return this.context.allowIn=r,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),
this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new s.Super)},e.prototype.parseLeftHandSideExpression=function(){r.assert(this.context.allowIn,"callee of new expression always allow in keyword.")
;for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){
this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new s.ComputedMemberExpression(t,n))
}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),n=this.parseIdentifierName(),t=this.finalize(e,new s.StaticMemberExpression(t,n));else{
if(10!==this.lookahead.type||!this.lookahead.head)break;var i=this.parseTemplateLiteral();t=this.finalize(e,new s.TaggedTemplateExpression(t,i))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead
;if(this.match("++")||this.match("--")){var n=this.startNode(t),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),
this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(a.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment);var i=!0
;e=this.finalize(n,new s.UpdateExpression(r.value,e,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),
!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(a.Messages.StrictLHSPostfix),
this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var o=this.nextToken().value;i=!1,
e=this.finalize(this.startNode(t),new s.UpdateExpression(o,e,i))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new s.AwaitExpression(t))},
e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){
var t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new s.UnaryExpression(n.value,e)),
this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(a.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1
}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){
var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1
;var n=t,r=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new s.BinaryExpression("**",n,r))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value
;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){
var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),n=this.lookahead,r=this.binaryPrecedence(n);if(r>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1
;for(var i=[e,this.lookahead],a=t,o=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[a,n.value,o],c=[r];!((r=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&r<=c[c.length-1];){o=l.pop();var u=l.pop();c.pop(),a=l.pop(),
i.pop();var h=this.startNode(i[i.length-1]);l.push(this.finalize(h,new s.BinaryExpression(u,a,o)))}l.push(this.nextToken().value),c.push(r),i.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var d=l.length-1
;t=l[d];for(var p=i.pop();d>1;){var f=i.pop(),m=p&&p.lineStart;h=this.startNode(f,m),u=l[d-1],t=this.finalize(h,new s.BinaryExpression(u,l[d-2],t)),d-=2,p=f}}return t},e.prototype.parseConditionalExpression=function(){
var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var n=this.context.allowIn;this.context.allowIn=!0;var r=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=n,
this.expect(":");var i=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new s.ConditionalExpression(t,r,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},
e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:
this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var n=0;n<t.elements.length;n++)null!==t.elements[n]&&this.checkPatternParam(e,t.elements[n]);break;case l.Syntax.ObjectPattern:
for(n=0;n<t.properties.length;n++)this.checkPatternParam(e,t.properties[n].value)}e.simple=e.simple&&t instanceof s.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,n=[e],r=!1;switch(e.type){case l.Syntax.Identifier:break
;case u:n=e.params,r=e.async;break;default:return null}t={simple:!0,paramSet:{}}
;for(var i=0;i<n.length;++i)(s=n[i]).type===l.Syntax.AssignmentPattern?s.right.type===l.Syntax.YieldExpression&&(s.right.argument&&this.throwUnexpectedToken(this.lookahead),s.right.type=l.Syntax.Identifier,s.right.name="yield",
delete s.right.argument,delete s.right.delegate):r&&s.type===l.Syntax.Identifier&&"await"===s.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,s),n[i]=s;if(this.context.strict||!this.context.allowYield)for(i=0;i<n.length;++i){
var s;(s=n[i]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===a.Messages.StrictParamDupe){var o=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(o,t.message)}return{simple:t.simple,
params:n,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{
var t=this.lookahead,n=t;if(e=this.parseConditionalExpression(),3===n.type&&n.lineNumber===this.lookahead.lineNumber&&"async"===n.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var r=this.parsePrimaryExpression()
;this.reinterpretExpressionAsPattern(r),e={type:u,params:[r],async:!0}}if(e.type===u||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var i=e.async,o=this.reinterpretAsCoverFormalsList(e);if(o){
this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var c=this.context.strict,h=this.context.allowStrictDirective;this.context.allowStrictDirective=o.simple
;var d=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=i;var f=this.startNode(t);this.expect("=>");var m=void 0;if(this.match("{")){var g=this.context.allowIn;this.context.allowIn=!0,
m=this.parseFunctionSourceElements(),this.context.allowIn=g}else m=this.isolateCoverGrammar(this.parseAssignmentExpression);var _=m.type!==l.Syntax.BlockStatement
;this.context.strict&&o.firstRestricted&&this.throwUnexpectedToken(o.firstRestricted,o.message),this.context.strict&&o.stricted&&this.tolerateUnexpectedToken(o.stricted,o.message),
e=i?this.finalize(f,new s.AsyncArrowFunctionExpression(o.params,m,_)):this.finalize(f,new s.ArrowFunctionExpression(o.params,m,_)),this.context.strict=c,this.context.allowStrictDirective=h,this.context.allowYield=d,this.context.await=p}
}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e
;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(n,a.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(n,a.Messages.StrictReservedWord)}
this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(n=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression)
;e=this.finalize(this.startNode(t),new s.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression)
;if(this.match(",")){var n=[];for(n.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),n.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new s.SequenceExpression(n))}return t},
e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":
this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,a.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":
this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,a.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":
e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()
}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new s.BlockStatement(t))},
e.prototype.parseLexicalBinding=function(e,t){var n=this.createNode(),r=this.parsePattern([],e);this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(a.Messages.StrictVarName);var i=null
;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),
i=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(a.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&r.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),
i=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(n,new s.VariableDeclarator(r,i))},e.prototype.parseBindingList=function(e,t){for(var n=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),
n.push(this.parseLexicalBinding(e,t));return n},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),
3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),n=this.nextToken().value
;r.assert("let"===n||"const"===n,"Lexical declaration must be either let or const");var i=this.parseBindingList(n,e);return this.consumeSemicolon(),this.finalize(t,new s.VariableDeclaration(i,n))},e.prototype.parseBindingRestElement=function(e,t){
var n=this.createNode();this.expect("...");var r=this.parsePattern(e,t);return this.finalize(n,new s.RestElement(r))},e.prototype.parseArrayPattern=function(e,t){var n=this.createNode();this.expect("[")
;for(var r=[];!this.match("]");)if(this.match(","))this.nextToken(),r.push(null);else{if(this.match("...")){r.push(this.parseBindingRestElement(e,t));break}r.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}
return this.expect("]"),this.finalize(n,new s.ArrayPattern(r))},e.prototype.parsePropertyPattern=function(e,t){var n,r,i=this.createNode(),a=!1,o=!1;if(3===this.lookahead.type){var l=this.lookahead;n=this.parseVariableIdentifier()
;var c=this.finalize(i,new s.Identifier(l.value));if(this.match("=")){e.push(l),o=!0,this.nextToken();var u=this.parseAssignmentExpression();r=this.finalize(this.startNode(l),new s.AssignmentPattern(c,u))}else this.match(":")?(this.expect(":"),
r=this.parsePatternWithDefault(e,t)):(e.push(l),o=!0,r=c)}else a=this.match("["),n=this.parseObjectPropertyKey(),this.expect(":"),r=this.parsePatternWithDefault(e,t);return this.finalize(i,new s.Property("init",n,a,r,!1,o))},
e.prototype.parseObjectPattern=function(e,t){var n=this.createNode(),r=[];for(this.expect("{");!this.match("}");)r.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(n,new s.ObjectPattern(r))
},e.prototype.parsePattern=function(e,t){var n
;return this.match("[")?n=this.parseArrayPattern(e,t):this.match("{")?n=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,a.Messages.LetInLexicalBinding),
e.push(this.lookahead),n=this.parseVariableIdentifier(t)),n},e.prototype.parsePatternWithDefault=function(e,t){var n=this.lookahead,r=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var i=this.context.allowYield;this.context.allowYield=!0
;var a=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=i,r=this.finalize(this.startNode(n),new s.AssignmentPattern(r,a))}return r},e.prototype.parseVariableIdentifier=function(e){
var t=this.createNode(),n=this.nextToken()
;return 4===n.type&&"yield"===n.value?this.context.strict?this.tolerateUnexpectedToken(n,a.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(n):3!==n.type?this.context.strict&&4===n.type&&this.scanner.isStrictModeReservedWord(n.value)?this.tolerateUnexpectedToken(n,a.Messages.StrictReservedWord):(this.context.strict||"let"!==n.value||"var"!==e)&&this.throwUnexpectedToken(n):(this.context.isModule||this.context.await)&&3===n.type&&"await"===n.value&&this.tolerateUnexpectedToken(n),
this.finalize(t,new s.Identifier(n.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),n=this.parsePattern([],"var")
;this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(a.Messages.StrictVarName);var r=null;return this.match("=")?(this.nextToken(),
r=this.isolateCoverGrammar(this.parseAssignmentExpression)):n.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new s.VariableDeclarator(n,r))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},n=[]
;for(n.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),n.push(this.parseVariableDeclaration(t));return n},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var")
;var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new s.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),
this.finalize(e,new s.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ExpressionStatement(t))},
e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(a.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),n=null
;this.expectKeyword("if"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),
e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(t,new s.IfStatement(r,e,n))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do")
;var t=this.context.inIteration;this.context.inIteration=!0;var n=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var r=this.parseExpression()
;return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new s.DoWhileStatement(n,r))},e.prototype.parseWhileStatement=function(){
var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement);else{
this.expect(")");var r=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=r}return this.finalize(t,new s.WhileStatement(n,e))},e.prototype.parseForStatement=function(){
var e,t,n,r=null,i=null,o=null,c=!0,u=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){r=this.createNode(),this.nextToken();var h=this.context.allowIn
;this.context.allowIn=!1;var d=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=h,1===d.length&&this.matchKeyword("in")){var p=d[0]
;p.init&&(p.id.type===l.Syntax.ArrayPattern||p.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(a.Messages.ForInOfLoopInitializer,"for-in"),r=this.finalize(r,new s.VariableDeclaration(d,"var")),this.nextToken(),e=r,
t=this.parseExpression(),r=null}else 1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new s.VariableDeclaration(d,"var")),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,
c=!1):(r=this.finalize(r,new s.VariableDeclaration(d,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){r=this.createNode();var f=this.nextToken().value
;this.context.strict||"in"!==this.lookahead.value?(h=this.context.allowIn,this.context.allowIn=!1,d=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=h,
1===d.length&&null===d[0].init&&this.matchKeyword("in")?(r=this.finalize(r,new s.VariableDeclaration(d,f)),this.nextToken(),e=r,t=this.parseExpression(),
r=null):1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new s.VariableDeclaration(d,f)),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,c=!1):(this.consumeSemicolon(),
r=this.finalize(r,new s.VariableDeclaration(d,f)))):(r=this.finalize(r,new s.Identifier(f)),this.nextToken(),e=r,t=this.parseExpression(),r=null)}else{var m=this.lookahead;if(h=this.context.allowIn,this.context.allowIn=!1,
r=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(a.Messages.InvalidLHSInForIn),this.nextToken(),
this.reinterpretExpressionAsPattern(r),e=r,t=this.parseExpression(),r=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(a.Messages.InvalidLHSInForLoop),
this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseAssignmentExpression(),r=null,c=!1;else{if(this.match(",")){for(var g=[r];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression))
;r=this.finalize(this.startNode(m),new s.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(i=this.parseExpression()),this.expect(";"),this.match(")")||(o=this.parseExpression())),
!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),n=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var _=this.context.inIteration;this.context.inIteration=!0,
n=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=_}return void 0===e?this.finalize(u,new s.ForStatement(r,i,o,n)):c?this.finalize(u,new s.ForInStatement(e,t,n)):this.finalize(u,new s.ForOfStatement(e,t,n))},
e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier();t=n;var r="$"+n.name
;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(a.Messages.UnknownLabel,n.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(a.Messages.IllegalContinue),
this.finalize(e,new s.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){
var n=this.parseVariableIdentifier(),r="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(a.Messages.UnknownLabel,n.name),t=n}return this.consumeSemicolon(),
null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(a.Messages.IllegalBreak),this.finalize(e,new s.BreakStatement(t))},e.prototype.parseReturnStatement=function(){
this.context.inFunctionBody||this.tolerateError(a.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return")
;var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ReturnStatement(t))},
e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(a.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var n=this.parseExpression()
;return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new s.WithStatement(n,e))},
e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":")
;for(var n=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)n.push(this.parseStatementListItem());return this.finalize(t,new s.SwitchCase(e,n))},e.prototype.parseSwitchStatement=function(){var e=this.createNode()
;this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var n=this.context.inSwitch;this.context.inSwitch=!0;var r=[],i=!1;for(this.expect("{");!this.match("}");){var o=this.parseSwitchCase()
;null===o.test&&(i&&this.throwError(a.Messages.MultipleDefaultsInSwitch),i=!0),r.push(o)}return this.expect("}"),this.context.inSwitch=n,this.finalize(e,new s.SwitchStatement(t,r))},e.prototype.parseLabelledStatement=function(){
var e,t=this.createNode(),n=this.parseExpression();if(n.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var r=n,i="$"+r.name
;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)&&this.throwError(a.Messages.Redeclaration,"Label",r.name),this.context.labelSet[i]=!0;var o=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),
o=this.parseClassDeclaration();else if(this.matchKeyword("function")){var c=this.lookahead,u=this.parseFunctionDeclaration()
;this.context.strict?this.tolerateUnexpectedToken(c,a.Messages.StrictFunction):u.generator&&this.tolerateUnexpectedToken(c,a.Messages.GeneratorInLegacyContext),o=u}else o=this.parseStatement();delete this.context.labelSet[i],
e=new s.LabeledStatement(r,o)}else this.consumeSemicolon(),e=new s.ExpressionStatement(n);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),
this.hasLineTerminator&&this.throwError(a.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode()
;this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],n=this.parsePattern(t),r={},i=0;i<t.length;i++){var o="$"+t[i].value
;Object.prototype.hasOwnProperty.call(r,o)&&this.tolerateError(a.Messages.DuplicateBinding,t[i].value),r[o]=!0}
this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(a.Messages.StrictCatchVariable),this.expect(")");var c=this.parseBlock();return this.finalize(e,new s.CatchClause(n,c))},
e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try")
;var t=this.parseBlock(),n=this.matchKeyword("catch")?this.parseCatchClause():null,r=this.matchKeyword("finally")?this.parseFinallyClause():null;return n||r||this.throwError(a.Messages.NoCatchOrFinally),this.finalize(e,new s.TryStatement(t,n,r))},
e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new s.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){
case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value
;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break
;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":
e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":
e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:
e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{")
;var t=this.parseDirectivePrologues(),n=this.context.labelSet,r=this.context.inIteration,i=this.context.inSwitch,a=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,
this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=n,this.context.inIteration=r,this.context.inSwitch=i,this.context.inFunctionBody=a,
this.finalize(e,new s.BlockStatement(t))},e.prototype.validateParam=function(e,t,n){var r="$"+n;this.context.strict?(this.scanner.isRestrictedWord(n)&&(e.stricted=t,e.message=a.Messages.StrictParamName),
Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=a.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(n)?(e.firstRestricted=t,
e.message=a.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(n)?(e.firstRestricted=t,e.message=a.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=a.Messages.StrictParamDupe)),
"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,r,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[r]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...")
;var n=this.parsePattern(e);return this.match("=")&&this.throwError(a.Messages.DefaultRestParameter),this.match(")")||this.throwError(a.Messages.ParameterAfterRestParameter),this.finalize(t,new s.RestElement(n))},
e.prototype.parseFormalParameter=function(e){for(var t=[],n=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),r=0;r<t.length;r++)this.validateParam(e,t[r],t[r].value);e.simple=e.simple&&n instanceof s.Identifier,
e.params.push(n)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),
!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){
var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var n=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===n.lineNumber&&4===n.type&&"function"===n.value}return e},
e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),n=this.matchContextualKeyword("async");n&&this.nextToken(),this.expectKeyword("function");var r,i=!n&&this.match("*");i&&this.nextToken();var o=null,l=null
;if(!e||!this.match("(")){var c=this.lookahead;o=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,a.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(l=c,
r=a.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(l=c,r=a.Messages.StrictReservedWord)}var u=this.context.await,h=this.context.allowYield;this.context.await=n,this.context.allowYield=!i
;var d=this.parseFormalParameters(l),p=d.params,f=d.stricted;l=d.firstRestricted,d.message&&(r=d.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=d.simple
;var _=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,r),this.context.strict&&f&&this.tolerateUnexpectedToken(f,r),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=u,
this.context.allowYield=h,n?this.finalize(t,new s.AsyncFunctionDeclaration(o,p,_)):this.finalize(t,new s.FunctionDeclaration(o,p,_,i))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async")
;t&&this.nextToken(),this.expectKeyword("function");var n,r=!t&&this.match("*");r&&this.nextToken();var i,o=null,l=this.context.await,c=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!r,!this.match("(")){var u=this.lookahead
;o=this.context.strict||r||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),
this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,a.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(i=u,
n=a.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(i=u,n=a.Messages.StrictReservedWord)}var h=this.parseFormalParameters(i),d=h.params,p=h.stricted;i=h.firstRestricted,h.message&&(n=h.message)
;var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&i&&this.throwUnexpectedToken(i,n),
this.context.strict&&p&&this.tolerateUnexpectedToken(p,n),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=c,
t?this.finalize(e,new s.AsyncFunctionExpression(o,d,g)):this.finalize(e,new s.FunctionExpression(o,d,g,r))},e.prototype.parseDirective=function(){
var e=this.lookahead,t=this.createNode(),n=this.parseExpression(),r=n.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,r?new s.Directive(n,r):new s.ExpressionStatement(n))},
e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var n=this.lookahead;if(8!==n.type)break;var r=this.parseDirective();t.push(r);var i=r.directive;if("string"!=typeof i)break;"use strict"===i?(this.context.strict=!0,
e&&this.tolerateUnexpectedToken(e,a.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(n,a.Messages.IllegalLanguageModeDirective)):!e&&n.octal&&(e=n)}return t},e.prototype.qualifiedPropertyName=function(e){
switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0
;var n=this.parseFormalParameters();n.params.length>0&&this.tolerateError(a.Messages.BadGetterArity);var r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,r,!1))},
e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters()
;1!==n.params.length?this.tolerateError(a.Messages.BadSetterArity):n.params[0]instanceof s.RestElement&&this.tolerateError(a.Messages.BadSetterRestParameter);var r=this.parsePropertyMethod(n);return this.context.allowYield=t,
this.finalize(e,new s.FunctionExpression(null,n.params,r,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();this.context.allowYield=!1
;var r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,r,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:
e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}
return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,n=!1;if(!this.hasLineTerminator){var r=this.context.allowYield;this.context.allowYield=!1,(n=this.match("*"))?(this.nextToken(),
t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=r}return this.finalize(e,new s.YieldExpression(t,n))},e.prototype.parseClassElement=function(e){
var t=this.lookahead,n=this.createNode(),r="",i=null,o=null,l=!1,c=!1,u=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),
"static"===(i=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,u=!0,l=this.match("["),this.match("*")?this.nextToken():i=this.parseObjectPropertyKey()),
3===t.type&&!this.hasLineTerminator&&"async"===t.value){var d=this.lookahead.value;":"!==d&&"("!==d&&"*"!==d&&(h=!0,t=this.lookahead,i=this.parseObjectPropertyKey(),
3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,a.Messages.ConstructorIsAsync))}var p=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&p?(r="get",l=this.match("["),i=this.parseObjectPropertyKey(),
this.context.allowYield=!1,o=this.parseGetterMethod()):"set"===t.value&&p&&(r="set",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseSetterMethod()):7===t.type&&"*"===t.value&&p&&(r="init",l=this.match("["),
i=this.parseObjectPropertyKey(),o=this.parseGeneratorMethod(),c=!0),!r&&i&&this.match("(")&&(r="init",o=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0),r||this.throwUnexpectedToken(this.lookahead),
"init"===r&&(r="method"),l||(u&&this.isPropertyKey(i,"prototype")&&this.throwUnexpectedToken(t,a.Messages.StaticPrototype),
!u&&this.isPropertyKey(i,"constructor")&&(("method"!==r||!c||o&&o.generator)&&this.throwUnexpectedToken(t,a.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,a.Messages.DuplicateConstructor):e.value=!0,r="constructor")),
this.finalize(n,new s.MethodDefinition(i,l,o,r,u))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e
},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new s.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),n=this.context.strict
;this.context.strict=!0,this.expectKeyword("class");var r=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall))
;var a=this.parseClassBody();return this.context.strict=n,this.finalize(t,new s.ClassDeclaration(r,i,a))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class")
;var n=3===this.lookahead.type?this.parseVariableIdentifier():null,r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var i=this.parseClassBody();return this.context.strict=t,
this.finalize(e,new s.ClassExpression(n,r,i))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0
;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Module(t))},e.prototype.parseScript=function(){
for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode()
;8!==this.lookahead.type&&this.throwError(a.Messages.InvalidModuleSpecifier);var t=this.nextToken(),n=this.getTokenRaw(t);return this.finalize(e,new s.Literal(t.value,n))},e.prototype.parseImportSpecifier=function(){var e,t,n=this.createNode()
;return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),
t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(n,new s.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),
this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new s.ImportDefaultSpecifier(t))},
e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(a.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName()
;return this.finalize(e,new s.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(a.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import")
;var n=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{
if(this.match("{")?n=n.concat(this.parseNamedImports()):this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(n.push(this.parseImportDefaultSpecifier()),
this.match(",")&&(this.nextToken(),this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.match("{")?n=n.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),
!this.matchContextualKeyword("from")){var r=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),
this.finalize(t,new s.ImportDeclaration(n,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),n=t;return this.matchContextualKeyword("as")&&(this.nextToken(),n=this.parseIdentifierName()),
this.finalize(e,new s.ExportSpecifier(t,n))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(a.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),
this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var n=this.parseFunctionDeclaration(!0);e=this.finalize(t,new s.ExportDefaultDeclaration(n))}else this.matchKeyword("class")?(n=this.parseClassDeclaration(!0),
e=this.finalize(t,new s.ExportDefaultDeclaration(n))):this.matchContextualKeyword("async")?(n=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),
e=this.finalize(t,new s.ExportDefaultDeclaration(n))):(this.matchContextualKeyword("from")&&this.throwError(a.Messages.UnexpectedToken,this.lookahead.value),
n=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new s.ExportDefaultDeclaration(n)));else if(this.match("*")){if(this.nextToken(),
!this.matchContextualKeyword("from")){var r=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken();var i=this.parseModuleSpecifier();this.consumeSemicolon(),
e=this.finalize(t,new s.ExportAllDeclaration(i))}else if(4===this.lookahead.type){switch(n=void 0,this.lookahead.value){case"let":case"const":n=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":
n=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new s.ExportNamedDeclaration(n,[],null))}else if(this.matchAsyncFunction())n=this.parseFunctionDeclaration(),
e=this.finalize(t,new s.ExportNamedDeclaration(n,[],null));else{var o=[],l=null,c=!1;for(this.expect("{");!this.match("}");)c=c||this.matchKeyword("default"),o.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),
this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):c?(r=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause,
this.throwError(r,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new s.ExportNamedDeclaration(null,o,l))}return e},e}();t.Parser=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){
if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},
e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var n=new Error(e);try{throw n}catch(e){Object.create&&Object.defineProperty&&(n=Object.create(e),
Object.defineProperty(n,"column",{value:t}))}return n},e.prototype.createError=function(e,t,n,r){var i="Line "+t+": "+r,a=this.constructError(i,n);return a.index=e,a.lineNumber=t,a.description=r,a},e.prototype.throwError=function(e,t,n,r){
throw this.createError(e,t,n,r)},e.prototype.tolerateError=function(e,t,n,r){var i=this.createError(e,t,n,r);if(!this.tolerant)throw i;this.recordError(i)},e}();t.ErrorHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{
value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",
ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",
DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",
ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",
IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",
IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",
InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",
LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",
NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",
StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",
StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",
StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",
StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",
StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",
StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",
UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",
UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(4),a=n(11);function s(e){
return"0123456789abcdef".indexOf(e.toLowerCase())}function o(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,
this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,
this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),
this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),
this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,n,r=[];for(this.trackComment&&(r=[],t=this.index-e,n={start:{line:this.lineNumber,
column:this.index-this.lineStart-e},end:{}});!this.eof();){var a=this.source.charCodeAt(this.index);if(++this.index,i.Character.isLineTerminator(a)){if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart-1};var s={
multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:n};r.push(s)}return 13===a&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,r}}return this.trackComment&&(n.end={line:this.lineNumber,
column:this.index-this.lineStart},s={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:n},r.push(s)),r},e.prototype.skipMultiLineComment=function(){var e,t,n=[];for(this.trackComment&&(n=[],e=this.index-2,t={start:{line:this.lineNumber,
column:this.index-this.lineStart-2},end:{}});!this.eof();){var r=this.source.charCodeAt(this.index);if(i.Character.isLineTerminator(r))13===r&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,
this.lineStart=this.index;else if(42===r){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var a={multiLine:!0,slice:[e+2,this.index-2],
range:[e,this.index],loc:t};n.push(a)}return n}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},a={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},n.push(a)),
this.tolerateUnexpectedToken(),n},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var n=this.source.charCodeAt(this.index)
;if(i.Character.isWhiteSpace(n))++this.index;else if(i.Character.isLineTerminator(n))++this.index,13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,
t=!0;else if(47===n)if(47===(n=this.source.charCodeAt(this.index+1))){this.index+=2;var r=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(r)),t=!0}else{if(42!==n)break;this.index+=2,r=this.skipMultiLineComment(),
this.trackComment&&(e=e.concat(r))}else if(t&&45===n){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,r=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(r))}else{
if(60!==n||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,r=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(r))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){
case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":
case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:
return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:
return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:
return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e)
;if(t>=55296&&t<=56319){var n=this.source.charCodeAt(e+1);n>=56320&&n<=57343&&(t=1024*(t-55296)+n-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,n=0,r=0;r<t;++r){
if(this.eof()||!i.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;n=16*n+s(this.source[this.index++])}return String.fromCharCode(n)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0
;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],i.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+s(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),i.Character.fromCodePoint(t)},
e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier()
;if(!i.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),n=i.Character.fromCodePoint(t);for(this.index+=n.length,
92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,
e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),n=e);!this.eof()&&(t=this.codePointAt(this.index),
i.Character.isIdentifierPart(t));)n+=e=i.Character.fromCodePoint(t),this.index+=e.length,92===t&&(n=n.substr(0,n.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,
e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),n+=e);return n},e.prototype.octalToDecimal=function(e){var t="0"!==e,n=o(e)
;return!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,n=8*n+o(this.source[this.index++]),
"0123".indexOf(e)>=0&&!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(n=8*n+o(this.source[this.index++]))),{code:n,octal:t}},e.prototype.scanIdentifier=function(){
var e,t=this.index,n=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===n.length?3:this.isKeyword(n)?4:"null"===n?5:"true"===n||"false"===n?1:3)&&t+n.length!==this.index){var r=this.index;this.index=t,
this.tolerateUnexpectedToken(a.Messages.InvalidEscapedReservedWord),this.index=r}return{type:e,value:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){
var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":
++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:
">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],
"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){
for(var t="";!this.eof()&&i.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),
i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){
for(var t,n="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)n+=this.source[this.index++];return 0===n.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),
(i.Character.isIdentifierStart(t)||i.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(n,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){
var n="",r=!1;for(i.Character.isOctalDigit(e.charCodeAt(0))?(r=!0,n="0"+this.source[this.index++]):++this.index;!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++]
;return r||0!==n.length||this.throwUnexpectedToken(),(i.Character.isIdentifierStart(this.source.charCodeAt(this.index))||i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(n,8),octal:r,
lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1
;if(!i.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e]
;r.assert(i.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){
if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e)
;if(t&&i.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){
for(n+=this.source[this.index++];i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],
"+"!==(t=this.source[this.index])&&"-"!==t||(n+=this.source[this.index++]),
i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken()
;return i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){
var e=this.index,t=this.source[e];r.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var n=!1,s="";!this.eof();){var o=this.source[this.index++];if(o===t){t="";break}
if("\\"===o)if((o=this.source[this.index++])&&i.Character.isLineTerminator(o.charCodeAt(0)))++this.lineNumber,"\r"===o&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(o){case"u":
if("{"===this.source[this.index])++this.index,s+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(o);null===l&&this.throwUnexpectedToken(),s+=l}break;case"x":var c=this.scanHexEscape(o)
;null===c&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),s+=c;break;case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;case"8":case"9":s+=o,
this.tolerateUnexpectedToken();break;default:if(o&&i.Character.isOctalDigit(o.charCodeAt(0))){var u=this.octalToDecimal(o);n=u.octal||n,s+=String.fromCharCode(u.code)}else s+=o}else{if(i.Character.isLineTerminator(o.charCodeAt(0)))break;s+=o}}
return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:s,octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){
var e="",t=!1,n=this.index,r="`"===this.source[n],s=!1,o=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){o=1,s=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break
}e+=l}else if("\\"===l)if(l=this.source[this.index++],i.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":
e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var c=this.index,u=this.scanHexEscape(l);null!==u?e+=u:(this.index=c,e+=l)}break;case"x":var h=this.scanHexEscape(l)
;null===h&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:
"0"===l?(i.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral),e+="\0"):i.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral):e+=l
}else i.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),r||this.curlyStack.pop(),{type:10,
value:this.source.slice(n+1,this.index-o),cooked:e,head:r,tail:s,lineNumber:this.lineNumber,lineStart:this.lineStart,start:n,end:this.index}},e.prototype.testRegExp=function(e,t){var n=e,r=this
;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(e,t,n){var i=parseInt(t||n,16);return i>1114111&&r.throwUnexpectedToken(a.Messages.InvalidRegExp),i<=65535?String.fromCharCode(i):"\uffff"
})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"\uffff"));try{RegExp(n)}catch(e){this.throwUnexpectedToken(a.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index]
;r.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],n=!1,s=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],
i.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),
t+=e;else if(i.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(a.Messages.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){s=!0;break}"["===e&&(n=!0)}
return s||this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!i.Character.isIdentifierPart(t.charCodeAt(0)))break
;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var n=this.index,r=this.scanHexEscape("u");if(null!==r)for(e+=r;n<this.index;++n)this.source[n];else this.index=n,e+="u";this.tolerateUnexpectedToken()
}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),n=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:n,regex:this.testRegExp(t,n),lineNumber:this.lineNumber,
lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index)
;return i.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?i.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():i.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&i.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()
},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",
t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",
apos:"'",gt:">",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",
sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",
AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",times:"\xd7",
Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",
ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",divide:"\xf7",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",
uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",
Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",
Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",
rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",
lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",
Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",frasl:"\u2044",euro:"\u20ac",image:"\u2111",weierp:"\u2118",real:"\u211c",trade:"\u2122",alefsym:"\u2135",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",
crarr:"\u21b5",lArr:"\u21d0",uArr:"\u21d1",rArr:"\u21d2",dArr:"\u21d3",hArr:"\u21d4",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",
lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",
sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",
diams:"\u2666",lang:"\u27e8",rang:"\u27e9"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(12),a=n(13),s=function(){function e(){this.values=[],this.curly=this.paren=-1}
return e.prototype.beforeFunctionExpression=function(e){
return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0
},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var n=this.values[this.paren-1];t="if"===n||"while"===n||"for"===n||"with"===n;break;case"}":if(t=!1,
"function"===this.values[this.curly-3])t=!!(r=this.values[this.curly-4])&&!this.beforeFunctionExpression(r);else if("function"===this.values[this.curly-4]){var r;t=!(r=this.values[this.curly-5])||!this.beforeFunctionExpression(r)}}return t},
e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),o=function(){function e(e,t){
this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new i.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,
this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new s}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){
if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var n=e[t],r=this.scanner.source.slice(n.slice[0],n.slice[1]),i={type:n.multiLine?"BlockComment":"LineComment",value:r}
;this.trackRange&&(i.range=n.range),this.trackLoc&&(i.loc=n.loc),this.buffer.push(i)}if(!this.scanner.eof()){var s=void 0;this.trackLoc&&(s={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}})
;var o="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(o);var l={type:a.TokenName[o.type],value:this.scanner.source.slice(o.start,o.end)}
;if(this.trackRange&&(l.range=[o.start,o.end]),this.trackLoc&&(s.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=s),9===o.type){var c=o.pattern,u=o.flags;l.regex={pattern:c,flags:u}}this.buffer.push(l)}}
return this.buffer.shift()},e}();t.Tokenizer=o}])},e.exports=t()},7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)}
;t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){
return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),
n([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10
;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){
var i,a,s,c;if(o(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]),void 0===s)s=a[t]=n,
++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0
;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,
console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}
function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t]
;return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e]
;if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{
if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}
Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){
if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){
void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){
if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},
a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s
;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,u=f(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},
a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},
a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,a,s;if(o(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this
;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,
a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),
void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this
;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n)
;for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}
if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){
return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7593:e=>{
var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString;e.exports=function(e,r,i){if("[object Function]"!==n.call(r))throw new TypeError("iterator must be a function");var a=e.length
;if(a===+a)for(var s=0;s<a;s++)r.call(i,e[s],s,e);else for(var o in e)t.call(e,o)&&r.call(i,e[o],o,e)}},9353:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,r=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r]
;for(var i=0;i<t.length;i+=1)n[i+e.length]=t[i];return n};e.exports=function(e){var i=this;if("function"!=typeof i||"[object Function]"!==t.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var a,s=function(e){
for(var t=[],n=1,r=0;n<e.length;n+=1,r+=1)t[r]=e[n];return t}(arguments),o=n(0,i.length-s.length),l=[],c=0;c<o;c++)l[c]="$"+c;if(a=Function("binder","return function ("+function(e){for(var t="",n=0;n<e.length;n+=1)t+=e[n],n+1<e.length&&(t+=",")
;return t}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof a){var t=i.apply(this,r(s,arguments));return Object(t)===t?t:this}return i.apply(e,r(s,arguments))})),i.prototype){var u=function(){};u.prototype=i.prototype,
a.prototype=new u,u.prototype=null}return a}},6743:(e,t,n)=>{"use strict";var r=n(9353);e.exports=Function.prototype.bind||r},453:(e,t,n)=>{"use strict"
;var r,i=n(9612),a=n(9383),s=n(1237),o=n(9290),l=n(9538),c=n(8068),u=n(9675),h=n(5345),d=n(1514),p=n(8968),f=n(6188),m=n(8002),g=n(5880),_=n(414),v=n(3093),y=Function,b=function(e){try{return y('"use strict"; return ('+e+").constructor;")()
}catch(e){}},x=n(5795),E=n(655),w=function(){throw new u},S=x?function(){try{return w}catch(e){try{return x(arguments,"callee").get}catch(e){return w}}
}():w,T=n(4039)(),A=n(3628),C=n(1064),M=n(8648),I=n(1002),R=n(76),k={},N="undefined"!=typeof Uint8Array&&A?A(Uint8Array):r,D={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,
"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":T&&A?A([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":k,"%AsyncGenerator%":k,"%AsyncGeneratorFunction%":k,
"%AsyncIteratorPrototype%":k,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,
"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,
"%encodeURIComponent%":encodeURIComponent,"%Error%":a,"%eval%":eval,"%EvalError%":s,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,
"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":y,"%GeneratorFunction%":k,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,
"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":T&&A?A(A([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,
"%MapIteratorPrototype%":"undefined"!=typeof Map&&T&&A?A((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":x,"%parseFloat%":parseFloat,"%parseInt%":parseInt,
"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":o,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,
"%SetIteratorPrototype%":"undefined"!=typeof Set&&T&&A?A((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":T&&A?A(""[Symbol.iterator]()):r,
"%Symbol%":T?Symbol:r,"%SyntaxError%":c,"%ThrowTypeError%":S,"%TypedArray%":N,"%TypeError%":u,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,
"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":h,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,
"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet,"%Function.prototype.call%":R,"%Function.prototype.apply%":I,"%Object.defineProperty%":E,"%Object.getPrototypeOf%":C,"%Math.abs%":d,"%Math.floor%":p,"%Math.max%":f,"%Math.min%":m,"%Math.pow%":g,
"%Math.round%":_,"%Math.sign%":v,"%Reflect.getPrototypeOf%":M};if(A)try{null.error}catch(e){var L=A(A(e));D["%Error.prototype%"]=L}var O=function e(t){var n
;if("%AsyncFunction%"===t)n=b("async function () {}");else if("%GeneratorFunction%"===t)n=b("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=b("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%")
;r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&A&&(n=A(i.prototype))}return D[t]=n,n},P={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],
"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],
"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],
"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],
"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],
"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],
"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],
"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],
"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],
"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],
"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],
"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]
},F=n(6743),U=n(9957),B=F.call(R,Array.prototype.concat),z=F.call(I,Array.prototype.splice),G=F.call(R,String.prototype.replace),V=F.call(R,String.prototype.slice),H=F.call(R,RegExp.prototype.exec),j=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,W=/\\(\\)?/g,$=function(e,t){
var n,r=e;if(U(P,r)&&(r="%"+(n=P[r])[0]+"%"),U(D,r)){var i=D[r];if(i===k&&(i=O(r)),void 0===i&&!t)throw new u("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}
throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new u("intrinsic name must be a non-empty string")
;if(arguments.length>1&&"boolean"!=typeof t)throw new u('"allowMissing" argument must be a boolean');if(null===H(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){
var t=V(e,0,1),n=V(e,-1);if("%"===t&&"%"!==n)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var r=[];return G(e,j,(function(e,t,n,i){
r[r.length]=n?G(i,W,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",i=$("%"+r+"%",t),a=i.name,s=i.value,o=!1,l=i.alias;l&&(r=l[0],z(n,B([0,1],l)));for(var h=1,d=!0;h<n.length;h+=1){var p=n[h],f=V(p,0,1),m=V(p,-1)
;if(('"'===f||"'"===f||"`"===f||'"'===m||"'"===m||"`"===m)&&f!==m)throw new c("property names with quotes must have matching quotes");if("constructor"!==p&&d||(o=!0),U(D,a="%"+(r+="."+p)+"%"))s=D[a];else if(null!=s){if(!(p in s)){
if(!t)throw new u("base intrinsic for "+e+" exists, but the property is not available.");return}if(x&&h+1>=n.length){var g=x(s,p);s=(d=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:s[p]}else d=U(s,p),s=s[p];d&&!o&&(D[a]=s)}}return s}},
1064:(e,t,n)=>{"use strict";var r=n(9612);e.exports=r.getPrototypeOf||null},8648:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},3628:(e,t,n)=>{"use strict";var r=n(8648),i=n(1064),a=n(7176)
;e.exports=r?function(e){return r(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return i(e)}:a?function(e){return a(e)}:null},6549:e=>{"use strict"
;e.exports=Object.getOwnPropertyDescriptor},5795:(e,t,n)=>{"use strict";var r=n(6549);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},6288:e=>{"use strict";const t=Object.prototype.hasOwnProperty;e.exports=(e,n)=>t.call(e,n)},4039:(e,t,n)=>{
"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(1333);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},1333:e=>{"use strict";e.exports=function(){
if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1
;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1
;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1
;if("function"==typeof Object.getOwnPropertyDescriptor){var a=Object.getOwnPropertyDescriptor(e,t);if(42!==a.value||!0!==a.enumerable)return!1}return!0}},9092:(e,t,n)=>{"use strict";var r=n(1333);e.exports=function(){return r()&&!!Symbol.toStringTag}
},9957:(e,t,n)=>{"use strict";var r=Function.prototype.call,i=Object.prototype.hasOwnProperty,a=n(6743);e.exports=a.call(r,i)},251:(e,t)=>{t.read=function(e,t,n,r,i){var a,s,o=8*i-r-1,l=(1<<o)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,
a=p&(1<<-u)-1,p>>=-u,u+=o;u>0;a=256*a+e[t+h],h+=d,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),a-=c}return(p?-1:1)*s*Math.pow(2,a-r)},
t.write=function(e,t,n,r,i,a){var s,o,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),
t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(o=0,s=u):s+h>=1?(o=(t*l-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&o,p+=f,o/=256,i-=8);for(s=s<<i|o,
c+=i;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},4317:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))
}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},7244:(e,t,n)=>{"use strict";var r=n(9092)(),i=n(8075)("Object.prototype.toString"),a=function(e){
return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===i(e)},s=function(e){return!!a(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"[object Function]"===i(e.callee)
},o=function(){return a(arguments)}();a.isLegacyArguments=s,e.exports=o?a:s},8184:(e,t,n)=>{"use strict";var r,i=Object.prototype.toString,a=Function.prototype.toString,s=/^\s*(?:function)?\*/,o=n(9092)(),l=Object.getPrototypeOf
;e.exports=function(e){if("function"!=typeof e)return!1;if(s.test(a.call(e)))return!0;if(!o)return"[object GeneratorFunction]"===i.call(e);if(!l)return!1;if(void 0===r){var t=function(){if(!o)return!1;try{return Function("return function*() {}")()
}catch(e){}}();r=!!t&&l(t)}return l(e)===r}},3003:e=>{"use strict";e.exports=function(e){return e!=e}},4133:(e,t,n)=>{"use strict";var r=n(487),i=n(8452),a=n(3003),s=n(6642),o=n(2464),l=r(s(),Number);i(l,{getPolyfill:s,implementation:a,shim:o}),
e.exports=l},6642:(e,t,n)=>{"use strict";var r=n(3003);e.exports=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:r}},2464:(e,t,n)=>{"use strict";var r=n(8452),i=n(6642);e.exports=function(){var e=i()
;return r(Number,{isNaN:e},{isNaN:function(){return Number.isNaN!==e}}),e}},5680:(e,t,n)=>{"use strict"
;var r=n(7593),i=n(9209),a=n(8075),s=a("Object.prototype.toString"),o=n(9092)(),l="undefined"==typeof globalThis?n.g:globalThis,c=i(),u=a("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1
},h=a("String.prototype.slice"),d={},p=n(8957),f=Object.getPrototypeOf;o&&p&&f&&r(c,(function(e){var t=new l[e];if(Symbol.toStringTag in t){var n=f(t),r=p(n,Symbol.toStringTag);if(!r){var i=f(n);r=p(i,Symbol.toStringTag)}d[e]=r.get}})),
e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!o||!(Symbol.toStringTag in e)){var t=h(s(e),8,-1);return u(c,t)>-1}return!!p&&function(e){var t=!1;return r(d,(function(n,r){if(!t)try{t=n.call(e)===r}catch(e){}})),t}(e)}},
5543:function(e,t){var n;n=function(){return function(){var e=n;e.Integer={type:"integer"};var t={String,Boolean,Number,Object,Array,Date};function n(e,t){return n(e,t,{changing:!1})}e.validate=n,e.checkPropertyChange=function(e,t,r){return n(e,t,{
changing:r||"property"})};var n=e._validate=function(e,n,r){r||(r={});var i=r.changing;function a(e){return e.type||t[e.name]==e&&e.name.toLowerCase()}var s=[];function o(e,t,n,l){var c;function u(e){s.push({property:n,message:e})}
if(n+=n?"number"==typeof l?"["+l+"]":void 0===l?"":"."+l:l,
("object"!=typeof t||t instanceof Array)&&(n||"function"!=typeof t)&&(!t||!a(t)))return"function"==typeof t?e instanceof t||u("is not an instance of the class/constructor "+t.name):t&&u("Invalid schema/property definition "+t),null;function h(e,t){
if(e){if(!("string"!=typeof e||"any"==e||("null"==e?null===t:typeof t==e)||t instanceof Array&&"array"==e||t instanceof Date&&"date"==e||"integer"==e&&t%1==0))return[{property:n,message:t+" - "+typeof t+" value found, but a "+e+" is required"}]
;if(e instanceof Array){for(var r=[],i=0;i<e.length&&(r=h(e[i],t)).length;i++);if(r.length)return r}else if("object"==typeof e){var a=s;s=[],o(t,e,n);var l=s;return s=a,l}}return[]}if(i&&t.readonly&&u("is a readonly field, it can not be changed"),
t.extends&&o(e,t.extends,n,l),void 0===e)t.required&&u("is missing and it is required");else if(s=s.concat(h(a(t),e)),t.disallow&&!h(t.disallow,e).length&&u(" disallowed value was matched"),null!==e){if(e instanceof Array){if(t.items){
var d=t.items instanceof Array,p=t.items;for(l=0,c=e.length;l<c;l+=1)d&&(p=t.items[l]),r.coerce&&(e[l]=r.coerce(e[l],p)),s.concat(o(e[l],p,n,l))}t.minItems&&e.length<t.minItems&&u("There must be a minimum of "+t.minItems+" in the array"),
t.maxItems&&e.length>t.maxItems&&u("There must be a maximum of "+t.maxItems+" in the array")}else(t.properties||t.additionalProperties)&&s.concat(function(e,t,n,a){if("object"==typeof t)for(var l in("object"!=typeof e||e instanceof Array)&&s.push({
property:n,message:"an object is required"}),t)if(t.hasOwnProperty(l)&&"__proto__"!=l&&"constructor"!=l){var c=e.hasOwnProperty(l)?e[l]:void 0;if(void 0===c&&r.existingOnly)continue;var u=t[l];void 0===c&&u.default&&(c=e[l]=u.default),
r.coerce&&l in e&&(c=e[l]=r.coerce(c,u)),o(c,u,n,l)}for(l in e){if(e.hasOwnProperty(l)&&("_"!=l.charAt(0)||"_"!=l.charAt(1))&&t&&!t[l]&&!1===a){if(r.filter){delete e[l];continue}s.push({property:n,
message:"The property "+l+" is not defined in the schema and the schema does not allow additional properties"})}var h=t&&t[l]&&t[l].requires;h&&!(h in e)&&s.push({property:n,
message:"the presence of the property "+l+" requires that "+h+" also be present"}),c=e[l],!a||t&&"object"==typeof t&&l in t||(r.coerce&&(c=e[l]=r.coerce(c,a)),o(c,a,n,l)),!i&&c&&c.$schema&&(s=s.concat(o(c,c.$schema,n,l)))}return s
}(e,t.properties,n,t.additionalProperties));if(t.pattern&&"string"==typeof e&&!e.match(t.pattern)&&u("does not match the regex pattern "+t.pattern),
t.maxLength&&"string"==typeof e&&e.length>t.maxLength&&u("may only be "+t.maxLength+" characters long"),t.minLength&&"string"==typeof e&&e.length<t.minLength&&u("must be at least "+t.minLength+" characters long"),
void 0!==t.minimum&&typeof e==typeof t.minimum&&t.minimum>e&&u("must have a minimum value of "+t.minimum),void 0!==t.maximum&&typeof e==typeof t.maximum&&t.maximum<e&&u("must have a maximum value of "+t.maximum),t.enum){var f,m=t.enum;c=m.length
;for(var g=0;g<c;g++)if(m[g]===e){f=1;break}f||u("does not have a value in the enumeration "+m.join(", "))}
"number"==typeof t.maxDecimal&&e.toString().match(new RegExp("\\.[0-9]{"+(t.maxDecimal+1)+",}"))&&u("may only have "+t.maxDecimal+" digits of decimal places")}return null}return n&&o(e,n,"",i||""),!i&&e&&e.$schema&&o(e,e.$schema,"",""),{
valid:!s.length,errors:s}};return e.mustBeValid=function(e){if(!e.valid)throw new TypeError(e.errors.map((function(e){return"for property "+e.property+": "+e.message})).join(", \n"))},e}()}.apply(t,[]),void 0===n||(e.exports=n)},611:function(){
var e=function(){"use strict";var t="function"==typeof setImmediate?setImmediate:setTimeout,n=4294967296,r=[4294967295,-n],i=[0,-0x8000000000000000],a=[0,0],s=[1,0];function o(e,t){postMessage({action:3,cbn:t,result:e})}function l(e){var t=[]
;return t[e-1]=void 0,t}function c(e,t){return d(e[0]+t[0],e[1]+t[1])}function u(e,t){return r=Math.max(Math.min(e[1]/n,2147483647),-2147483648)&Math.max(Math.min(t[1]/n,2147483647),-2147483648),a=i=m(e)&m(t),i<0&&(a+=n),[a,r*n];var r,i,a}
function h(e,t){var n,r;return e[0]==t[0]&&e[1]==t[1]?0:(n=e[1]<0,r=t[1]<0,n&&!r?-1:!n&&r?1:y(e,t)[1]<0?-1:1)}function d(e,t){var r,i;for(e%=0x10000000000000000,t=(t%=0x10000000000000000)-(r=t%n)+(i=Math.floor(e/n)*n),e=e-i+r;e<0;)e+=n,t-=n
;for(;e>4294967295;)e-=n,t+=n;for(t%=0x10000000000000000;t>0x7fffffff00000000;)t-=0x10000000000000000;for(;t<-0x8000000000000000;)t+=0x10000000000000000;return[e,t]}function p(e,t){return e[0]==t[0]&&e[1]==t[1]}function f(e){
return e>=0?[e,0]:[e+n,-n]}function m(e){return e[0]>=2147483648?~~Math.max(Math.min(e[0]-n,2147483647),-2147483648):~~Math.max(Math.min(e[0],2147483647),-2147483648)}function g(e){return e<=30?1<<e:g(30)*g(e-30)}function _(e,t){var r,s,o,l;if(t&=63,
p(e,i))return t?a:e;if(e[1]<0)throw new Error("Neg");return l=g(t),s=e[1]*l%0x10000000000000000,(s+=r=(o=e[0]*l)-o%n)>=0x8000000000000000&&(s-=0x10000000000000000),[o-=r,s]}function v(e,t){var n;return n=g(t&=63),d(Math.floor(e[0]/n),e[1]/n)}
function y(e,t){return d(e[0]-t[0],e[1]-t[1])}function b(e,t){return e.buf=t,e.pos=0,e.count=t.length,e}function x(e){return e.pos>=e.count?-1:255&e.buf[e.pos++]}function E(e,t,n,r){return e.pos>=e.count?-1:(r=Math.min(r,e.count-e.pos),
C(e.buf,e.pos,t,n,r),e.pos+=r,r)}function w(e){return e.buf=l(32),e.count=0,e}function S(e){var t=e.buf;return t.length=e.count,t}function T(e,t){e.buf[e.count++]=t<<24>>24}function A(e,t,n,r){C(t,n,e.buf,e.count,r),e.count+=r}function C(e,t,n,r,i){
for(var a=0;a<i;++a)n[r+a]=e[t+a]}function M(t,n,i){return t.output=w({}),function(t,n,i,s,o){var c,u;if(h(s,r)<0)throw new Error("invalid length "+s);for(t.length_0=s,c=function(e){var t;for(e._repDistances=l(4),e._optimum=[],e._rangeEncoder={},
e._isMatch=l(192),e._isRep=l(12),e._isRepG0=l(12),e._isRepG1=l(12),e._isRepG2=l(12),e._isRep0Long=l(192),e._posSlotEncoder=[],e._posEncoders=l(114),e._posAlignEncoder=xe({},4),e._lenEncoder=ue({}),e._repMatchLenEncoder=ue({}),e._literalEncoder={},
e._matchDistances=[],e._posSlotPrices=[],e._distancesPrices=[],e._alignPrices=l(16),e.reps=l(4),e.repLens=l(4),e.processedInSize=[a],e.processedOutSize=[a],e.finished=[0],e.properties=l(5),e.tempPrices=l(128),e._longestMatchLength=0,
e._matchFinderType=1,e._numDistancePairs=0,e._numFastBytesPrev=-1,e.backRes=0,t=0;t<4096;++t)e._optimum[t]={};for(t=0;t<4;++t)e._posSlotEncoder[t]=xe({},6);return e}({}),function(e,t){!function(e,t){e._dictionarySize=t;for(var n=0;t>1<<n;++n);
e._distTableSize=2*n}(t,1<<e.s),t._numFastBytes=e.f,function(e,t){var n=e._matchFinderType;e._matchFinderType=t,e._matchFinder&&n!=e._matchFinderType&&(e._dictionarySizePrev=-1,e._matchFinder=null)}(t,e.m),t._numLiteralPosStateBits=0,
t._numLiteralContextBits=3,t._posStateBits=2,t._posStateMask=3}(o,c),c._writeEndMark=void 0===e.disableEndMark,function(e,t){e.properties[0]=9*(5*e._posStateBits+e._numLiteralPosStateBits)+e._numLiteralContextBits<<24>>24
;for(var n=0;n<4;++n)e.properties[1+n]=e._dictionarySize>>8*n<<24>>24;A(t,e.properties,0,5)}(c,i),u=0;u<64;u+=8)T(i,255&m(v(s,u)));t.chunker=(c._needReleaseMFStream=0,c._inStream=n,c._finished=0,function(e){var t,n;e._matchFinder||(t={},n=4,
e._matchFinderType||(n=2),function(e,t){e.HASH_ARRAY=t>2,e.HASH_ARRAY?(e.kNumHashDirectBytes=0,e.kMinMatchCheck=4,e.kFixHashSize=66560):(e.kNumHashDirectBytes=2,e.kMinMatchCheck=3,e.kFixHashSize=0)}(t,n),e._matchFinder=t),function(e,t,n){var r,i
;if(null==e.m_Coders||e.m_NumPrevBits!=n||e.m_NumPosBits!=t)for(e.m_NumPosBits=t,e.m_PosMask=(1<<t)-1,e.m_NumPrevBits=n,i=1<<e.m_NumPrevBits+e.m_NumPosBits,e.m_Coders=l(i),r=0;r<i;++r)e.m_Coders[r]=ge({})
}(e._literalEncoder,e._numLiteralPosStateBits,e._numLiteralContextBits),(e._dictionarySize!=e._dictionarySizePrev||e._numFastBytesPrev!=e._numFastBytes)&&(function(e,t,n,r){var i,a;t<1073741567&&(e._cutValue=16+(r>>1),function(e,t,n,r){var i
;e._keepSizeBefore=t,e._keepSizeAfter=n,i=t+n+r,(null==e._bufferBase||e._blockSize!=i)&&(e._bufferBase=null,e._blockSize=i,e._bufferBase=l(e._blockSize)),e._pointerToLastSafePosition=e._blockSize-n}(e,t+4096,r+274,256+~~((t+4096+r+274)/2)),
e._matchMaxLen=r,i=t+1,e._cyclicBufferSize!=i&&(e._son=l(2*(e._cyclicBufferSize=i))),a=65536,e.HASH_ARRAY&&(a=t-1,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a>>=1,(a|=65535)>16777216&&(a>>=1),e._hashMask=a,++a,a+=e.kFixHashSize),
a!=e._hashSizeSum&&(e._hash=l(e._hashSizeSum=a)))}(e._matchFinder,e._dictionarySize,0,e._numFastBytes),e._dictionarySizePrev=e._dictionarySize,e._numFastBytesPrev=e._numFastBytes)}(c),c._rangeEncoder.Stream=i,function(e){(function(e){e._state=0,
e._previousByte=0;for(var t=0;t<4;++t)e._repDistances[t]=0})(e),function(e){e._position=a,e.Low=a,e.Range=-1,e._cacheSize=1,e._cache=0}(e._rangeEncoder),Ie(e._isMatch),Ie(e._isRep0Long),Ie(e._isRep),Ie(e._isRepG0),Ie(e._isRepG1),Ie(e._isRepG2),
Ie(e._posEncoders),function(e){var t,n=1<<e.m_NumPrevBits+e.m_NumPosBits;for(t=0;t<n;++t)Ie(e.m_Coders[t].m_Encoders)}(e._literalEncoder);for(var t=0;t<4;++t)Ie(e._posSlotEncoder[t].Models);oe(e._lenEncoder,1<<e._posStateBits),
oe(e._repMatchLenEncoder,1<<e._posStateBits),Ie(e._posAlignEncoder.Models),e._longestMatchWasFound=0,e._optimumEndIndex=0,e._optimumCurrentIndex=0,e._additionalOffset=0}(c),Z(c),J(c),c._lenEncoder._tableSize=c._numFastBytes+1-2,
de(c._lenEncoder,1<<c._posStateBits),c._repMatchLenEncoder._tableSize=c._numFastBytes+1-2,de(c._repMatchLenEncoder,1<<c._posStateBits),c.nowPos64=a,function(e,t){return e.encoder=t,e.decoder=null,e.alive=1,e}({},c))
}(t,b({},n),t.output,f(n.length),i),t}function I(e,t){return e.output=w({}),function(e,t,n){var i,s,o,c,u="",h=[];for(s=0;s<5;++s){if(-1==(o=x(t)))throw new Error("truncated input");h[s]=o<<24>>24}if(i=function(e){e.m_OutWindow={},
e.m_RangeDecoder={},e.m_IsMatchDecoders=l(192),e.m_IsRepDecoders=l(12),e.m_IsRepG0Decoders=l(12),e.m_IsRepG1Decoders=l(12),e.m_IsRepG2Decoders=l(12),e.m_IsRep0LongDecoders=l(192),e.m_PosSlotDecoder=l(4),e.m_PosDecoders=l(114),
e.m_PosAlignDecoder=ye({},4),e.m_LenDecoder=$({}),e.m_RepLenDecoder=$({}),e.m_LiteralDecoder={};for(var t=0;t<4;++t)e.m_PosSlotDecoder[t]=ye({},6);return e}({}),!function(e,t){var n,r,i,a,s,o,c;if(t.length<5)return 0;for(i=(c=255&t[0])%9,
a=(o=~~(c/9))%5,s=~~(o/5),n=0,r=0;r<4;++r)n+=(255&t[1+r])<<8*r;return n>99999999||!function(e,t,n,r){if(t>8||n>4||r>4)return 0;!function(e,t,n){var r,i;if(null==e.m_Coders||e.m_NumPrevBits!=n||e.m_NumPosBits!=t)for(e.m_NumPosBits=t,
e.m_PosMask=(1<<t)-1,e.m_NumPrevBits=n,i=1<<e.m_NumPrevBits+e.m_NumPosBits,e.m_Coders=l(i),r=0;r<i;++r)e.m_Coders[r]=X({})}(e.m_LiteralDecoder,n,t);var i=1<<r;return j(e.m_LenDecoder,i),j(e.m_RepLenDecoder,i),e.m_PosStateMask=i-1,1
}(e,i,a,s)?0:function(e,t){return t<0?0:(e.m_DictionarySize!=t&&(e.m_DictionarySize=t,e.m_DictionarySizeCheck=Math.max(e.m_DictionarySize,1),function(e,t){null!=e._buffer&&e._windowSize==t||(e._buffer=l(t)),e._windowSize=t,e._pos=0,e._streamPos=0
}(e.m_OutWindow,Math.max(e.m_DictionarySizeCheck,4096))),1)}(e,n)}(i,h))throw new Error("corrupted input");for(s=0;s<64;s+=8){if(-1==(o=x(t)))throw new Error("truncated input");1==(o=o.toString(16)).length&&(o="0"+o),u=o+""+u}
/^0+$|^f+$/i.test(u)?e.length_0=r:(c=parseInt(u,16),e.length_0=c>4294967295?r:f(c)),e.chunker=function(e,t,n,r){return e.m_RangeDecoder.Stream=t,z(e.m_OutWindow),e.m_OutWindow._stream=n,function(e){e.m_OutWindow._streamPos=0,e.m_OutWindow._pos=0,
Ie(e.m_IsMatchDecoders),Ie(e.m_IsRep0LongDecoders),Ie(e.m_IsRepDecoders),Ie(e.m_IsRepG0Decoders),Ie(e.m_IsRepG1Decoders),Ie(e.m_IsRepG2Decoders),Ie(e.m_PosDecoders),function(e){var t,n;for(n=1<<e.m_NumPrevBits+e.m_NumPosBits,
t=0;t<n;++t)Ie(e.m_Coders[t].m_Decoders)}(e.m_LiteralDecoder);for(var t=0;t<4;++t)Ie(e.m_PosSlotDecoder[t].Models);q(e.m_LenDecoder),q(e.m_RepLenDecoder),Ie(e.m_PosAlignDecoder.Models),function(e){e.Code=0,e.Range=-1
;for(var t=0;t<5;++t)e.Code=e.Code<<8|x(e.Stream)}(e.m_RangeDecoder)}(e),e.state=0,e.rep0=0,e.rep1=0,e.rep2=0,e.rep3=0,e.outSize=r,e.nowPos64=a,e.prevByte=0,function(e,t){return e.decoder=t,e.encoder=null,e.alive=1,e}({},e)}(i,t,n,e.length_0)
}(e,b({},t),e.output),e}function R(e,t){return e._bufferBase[e._bufferOffset+e._pos+t]}function k(e,t,n,r){var i,a;for(e._streamEndWasReached&&e._pos+t+r>e._streamPos&&(r=e._streamPos-(e._pos+t)),++n,a=e._bufferOffset+e._pos+t,
i=0;i<r&&e._bufferBase[a+i]==e._bufferBase[a+i-n];++i);return i}function N(e){return e._streamPos-e._pos}function D(e){var t,n;if(!e._streamEndWasReached)for(;;){if(!(n=-e._bufferOffset+e._blockSize-e._streamPos))return
;if(-1==(t=E(e._stream,e._bufferBase,e._bufferOffset+e._streamPos,n)))return e._posLimit=e._streamPos,e._bufferOffset+e._posLimit>e._pointerToLastSafePosition&&(e._posLimit=e._pointerToLastSafePosition-e._bufferOffset),void(e._streamEndWasReached=1)
;e._streamPos+=t,e._streamPos>=e._pos+e._keepSizeAfter&&(e._posLimit=e._streamPos-e._keepSizeAfter)}}function L(e,t){e._bufferOffset+=t,e._posLimit-=t,e._pos-=t,e._streamPos-=t}var O=function(){var e,t,n,r=[];for(e=0;e<256;++e){for(n=e,
t=0;t<8;++t)1&n?n=n>>>1^-306674912:n>>>=1;r[e]=n}return r}();function P(e){var t;++e._cyclicBufferPos>=e._cyclicBufferSize&&(e._cyclicBufferPos=0),function(e){++e._pos,
e._pos>e._posLimit&&(e._bufferOffset+e._pos>e._pointerToLastSafePosition&&function(e){var t,n,r;for((r=e._bufferOffset+e._pos-e._keepSizeBefore)>0&&--r,n=e._bufferOffset+e._streamPos-r,t=0;t<n;++t)e._bufferBase[t]=e._bufferBase[r+t]
;e._bufferOffset-=r}(e),D(e))}(e),1073741823==e._pos&&(t=e._pos-e._cyclicBufferSize,F(e._son,2*e._cyclicBufferSize,t),F(e._hash,e._hashSizeSum,t),L(e,t))}function F(e,t,n){var r,i;for(r=0;r<t;++r)(i=e[r]||0)<=n?i=0:i-=n,e[r]=i}function U(e){
var t=e._pos-e._streamPos;t&&(A(e._stream,e._buffer,e._streamPos,t),e._pos>=e._windowSize&&(e._pos=0),e._streamPos=e._pos)}function B(e,t){var n=e._pos-t-1;return n<0&&(n+=e._windowSize),e._buffer[n]}function z(e){U(e),e._stream=null}function G(e){
return(e-=2)<4?e:3}function V(e){return e<4?0:e<10?e-3:e-6}function H(e){if(!e.alive)throw new Error("bad state");return e.encoder?function(e){(function(e,t,n,r){var i,o,l,u,d,g,_,v,b,x,E,w,S,T,A;if(t[0]=a,n[0]=a,r[0]=1,
e._inStream&&(e._matchFinder._stream=e._inStream,function(e){e._bufferOffset=0,e._pos=0,e._streamPos=0,e._streamEndWasReached=0,D(e),e._cyclicBufferPos=0,L(e,-1)}(e._matchFinder),e._needReleaseMFStream=1,e._inStream=null),!e._finished){
if(e._finished=1,T=e.nowPos64,p(e.nowPos64,a)){if(!N(e._matchFinder))return void Q(e,m(e.nowPos64));ie(e),S=m(e.nowPos64)&e._posStateMask,ke(e._rangeEncoder,e._isMatch,(e._state<<4)+S,0),e._state=V(e._state),l=R(e._matchFinder,-e._additionalOffset),
fe(pe(e._literalEncoder,m(e.nowPos64),e._previousByte),e._rangeEncoder,l),e._previousByte=l,--e._additionalOffset,e.nowPos64=c(e.nowPos64,s)}if(N(e._matchFinder))for(;;){if(_=ee(e,m(e.nowPos64)),x=e.backRes,S=m(e.nowPos64)&e._posStateMask,
o=(e._state<<4)+S,1==_&&-1==x)ke(e._rangeEncoder,e._isMatch,o,0),l=R(e._matchFinder,-e._additionalOffset),A=pe(e._literalEncoder,m(e.nowPos64),e._previousByte),
e._state<7?fe(A,e._rangeEncoder,l):(b=R(e._matchFinder,-e._repDistances[0]-1-e._additionalOffset),me(A,e._rangeEncoder,b,l)),e._previousByte=l,e._state=V(e._state);else{if(ke(e._rangeEncoder,e._isMatch,o,1),x<4){
if(ke(e._rangeEncoder,e._isRep,e._state,1),x?(ke(e._rangeEncoder,e._isRepG0,e._state,1),1==x?ke(e._rangeEncoder,e._isRepG1,e._state,0):(ke(e._rangeEncoder,e._isRepG1,e._state,1),
ke(e._rangeEncoder,e._isRepG2,e._state,x-2))):(ke(e._rangeEncoder,e._isRepG0,e._state,0),ke(e._rangeEncoder,e._isRep0Long,o,1==_?0:1)),1==_?e._state=e._state<7?9:11:(ce(e._repMatchLenEncoder,e._rangeEncoder,_-2,S),e._state=e._state<7?8:11),
u=e._repDistances[x],0!=x){for(g=x;g>=1;--g)e._repDistances[g]=e._repDistances[g-1];e._repDistances[0]=u}}else{for(ke(e._rangeEncoder,e._isRep,e._state,0),e._state=e._state<7?7:10,ce(e._lenEncoder,e._rangeEncoder,_-2,S),w=se(x-=4),v=G(_),
Ee(e._posSlotEncoder[v],e._rangeEncoder,w),w>=4&&(E=x-(i=(2|1&w)<<(d=(w>>1)-1)),w<14?Ae(e._posEncoders,i-w-1,e._rangeEncoder,d,E):(Ne(e._rangeEncoder,E>>4,d-4),Se(e._posAlignEncoder,e._rangeEncoder,15&E),++e._alignPriceCount)),u=x,
g=3;g>=1;--g)e._repDistances[g]=e._repDistances[g-1];e._repDistances[0]=u,++e._matchPriceCount}e._previousByte=R(e._matchFinder,_-1-e._additionalOffset)}if(e._additionalOffset-=_,e.nowPos64=c(e.nowPos64,f(_)),!e._additionalOffset){
if(e._matchPriceCount>=128&&Z(e),e._alignPriceCount>=16&&J(e),t[0]=e.nowPos64,n[0]=De(e._rangeEncoder),!N(e._matchFinder))return void Q(e,m(e.nowPos64));if(h(y(e.nowPos64,T),[4096,0])>=0)return e._finished=0,void(r[0]=0)}}else Q(e,m(e.nowPos64))}
})(e.encoder,e.encoder.processedInSize,e.encoder.processedOutSize,e.encoder.finished),e.inBytesProcessed=e.encoder.processedInSize[0],e.encoder.finished[0]&&(function(e){ae(e),e._rangeEncoder.Stream=null}(e.encoder),e.alive=0)}(e):function(e){
var t=function(e){var t,n,r,i,a,o;if(o=m(e.nowPos64)&e.m_PosStateMask,Me(e.m_RangeDecoder,e.m_IsMatchDecoders,(e.state<<4)+o)){if(Me(e.m_RangeDecoder,e.m_IsRepDecoders,e.state))r=0,
Me(e.m_RangeDecoder,e.m_IsRepG0Decoders,e.state)?(Me(e.m_RangeDecoder,e.m_IsRepG1Decoders,e.state)?(Me(e.m_RangeDecoder,e.m_IsRepG2Decoders,e.state)?(n=e.rep3,e.rep3=e.rep2):n=e.rep2,e.rep2=e.rep1):n=e.rep1,e.rep1=e.rep0,
e.rep0=n):Me(e.m_RangeDecoder,e.m_IsRep0LongDecoders,(e.state<<4)+o)||(e.state=e.state<7?9:11,r=1),r||(r=W(e.m_RepLenDecoder,e.m_RangeDecoder,o)+2,e.state=e.state<7?8:11);else if(e.rep3=e.rep2,e.rep2=e.rep1,e.rep1=e.rep0,
r=2+W(e.m_LenDecoder,e.m_RangeDecoder,o),e.state=e.state<7?7:10,(a=be(e.m_PosSlotDecoder[G(r)],e.m_RangeDecoder))>=4){if(i=(a>>1)-1,e.rep0=(2|1&a)<<i,a<14)e.rep0+=function(e,t,n,r){var i,a,s=1,o=0;for(a=0;a<r;++a)i=Me(n,e,t+s),s<<=1,s+=i,o|=i<<a
;return o}(e.m_PosDecoders,e.rep0-a-1,e.m_RangeDecoder,i);else if(e.rep0+=function(e,t){var n,r,i=0;for(n=t;0!=n;--n)e.Range>>>=1,r=e.Code-e.Range>>>31,e.Code-=e.Range&r-1,i=i<<1|1-r,-16777216&e.Range||(e.Code=e.Code<<8|x(e.Stream),e.Range<<=8)
;return i}(e.m_RangeDecoder,i-4)<<4,e.rep0+=function(e,t){var n,r,i=1,a=0;for(r=0;r<e.NumBitLevels;++r)n=Me(t,e.Models,i),i<<=1,i+=n,a|=n<<r;return a}(e.m_PosAlignDecoder,e.m_RangeDecoder),e.rep0<0)return-1==e.rep0?1:-1}else e.rep0=a
;if(h(f(e.rep0),e.nowPos64)>=0||e.rep0>=e.m_DictionarySizeCheck)return-1;!function(e,t,n){var r=e._pos-t-1;for(r<0&&(r+=e._windowSize);0!=n;--n)r>=e._windowSize&&(r=0),e._buffer[e._pos++]=e._buffer[r++],e._pos>=e._windowSize&&U(e)
}(e.m_OutWindow,e.rep0,r),e.nowPos64=c(e.nowPos64,f(r)),e.prevByte=B(e.m_OutWindow,0)}else t=function(e,t,n){return e.m_Coders[((t&e.m_PosMask)<<e.m_NumPrevBits)+((255&n)>>>8-e.m_NumPrevBits)]}(e.m_LiteralDecoder,m(e.nowPos64),e.prevByte),
e.state<7?e.prevByte=function(e,t){var n=1;do{n=n<<1|Me(t,e.m_Decoders,n)}while(n<256);return n<<24>>24}(t,e.m_RangeDecoder):e.prevByte=function(e,t,n){var r,i,a=1;do{if(i=n>>7&1,n<<=1,a=a<<1|(r=Me(t,e.m_Decoders,(1+i<<8)+a)),i!=r){
for(;a<256;)a=a<<1|Me(t,e.m_Decoders,a);break}}while(a<256);return a<<24>>24}(t,e.m_RangeDecoder,B(e.m_OutWindow,e.rep0)),function(e,t){e._buffer[e._pos++]=t,e._pos>=e._windowSize&&U(e)}(e.m_OutWindow,e.prevByte),e.state=V(e.state),
e.nowPos64=c(e.nowPos64,s);return 0}(e.decoder);if(-1==t)throw new Error("corrupted input");e.inBytesProcessed=r,e.outBytesProcessed=e.decoder.nowPos64,
(t||h(e.decoder.outSize,a)>=0&&h(e.decoder.nowPos64,e.decoder.outSize)>=0)&&(U(e.decoder.m_OutWindow),z(e.decoder.m_OutWindow),e.decoder.m_RangeDecoder.Stream=null,e.alive=0)}(e),e.alive}function j(e,t){
for(;e.m_NumPosStates<t;++e.m_NumPosStates)e.m_LowCoder[e.m_NumPosStates]=ye({},3),e.m_MidCoder[e.m_NumPosStates]=ye({},3)}function W(e,t,n){if(!Me(t,e.m_Choice,0))return be(e.m_LowCoder[n],t);var r=8
;return Me(t,e.m_Choice,1)?r+=8+be(e.m_HighCoder,t):r+=be(e.m_MidCoder[n],t),r}function $(e){return e.m_Choice=l(2),e.m_LowCoder=l(16),e.m_MidCoder=l(16),e.m_HighCoder=ye({},8),e.m_NumPosStates=0,e}function q(e){Ie(e.m_Choice)
;for(var t=0;t<e.m_NumPosStates;++t)Ie(e.m_LowCoder[t].Models),Ie(e.m_MidCoder[t].Models);Ie(e.m_HighCoder.Models)}function X(e){return e.m_Decoders=l(768),e}var Y=function(){var e,t,n,r=2,i=[0,1];for(n=2;n<22;++n)for(t=1<<(n>>1)-1,e=0;e<t;++e,
++r)i[r]=n<<24>>24;return i}();function K(e,t){var n,r,i,a;e._optimumEndIndex=t,i=e._optimum[t].PosPrev,r=e._optimum[t].BackPrev;do{e._optimum[t].Prev1IsChar&&(ve(e._optimum[i]),e._optimum[i].PosPrev=i-1,
e._optimum[t].Prev2&&(e._optimum[i-1].Prev1IsChar=0,e._optimum[i-1].PosPrev=e._optimum[t].PosPrev2,e._optimum[i-1].BackPrev=e._optimum[t].BackPrev2)),a=i,n=r,r=e._optimum[a].BackPrev,i=e._optimum[a].PosPrev,e._optimum[a].BackPrev=n,
e._optimum[a].PosPrev=t,t=a}while(t>0);return e.backRes=e._optimum[0].BackPrev,e._optimumCurrentIndex=e._optimum[0].PosPrev,e._optimumCurrentIndex}function J(e){for(var t=0;t<16;++t)e._alignPrices[t]=Te(e._posAlignEncoder,t);e._alignPriceCount=0}
function Z(e){var t,n,r,i,a,s,o,l;for(i=4;i<128;++i)t=(2|1&(s=se(i)))<<(r=(s>>1)-1),e.tempPrices[i]=Ce(e._posEncoders,t-s-1,r,i-t);for(a=0;a<4;++a){for(n=e._posSlotEncoder[a],o=a<<6,s=0;s<e._distTableSize;++s)e._posSlotPrices[o+s]=we(n,s)
;for(s=14;s<e._distTableSize;++s)e._posSlotPrices[o+s]+=(s>>1)-1-4<<6;for(l=128*a,i=0;i<4;++i)e._distancesPrices[l+i]=e._posSlotPrices[o+i];for(;i<128;++i)e._distancesPrices[l+i]=e._posSlotPrices[o+se(i)]+e.tempPrices[i]}e._matchPriceCount=0}
function Q(e,t){ae(e),function(e,t){if(e._writeEndMark){ke(e._rangeEncoder,e._isMatch,(e._state<<4)+t,1),ke(e._rangeEncoder,e._isRep,e._state,0),e._state=e._state<7?7:10,ce(e._lenEncoder,e._rangeEncoder,0,t);var n=G(2)
;Ee(e._posSlotEncoder[n],e._rangeEncoder,63),Ne(e._rangeEncoder,67108863,26),Se(e._posAlignEncoder,e._rangeEncoder,15)}}(e,t&e._posStateMask);for(var n=0;n<5;++n)Le(e._rangeEncoder)}function ee(e,t){
var n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,_,v,y,b,x,E,w,S,T,A,C,M,I,D,L,O,P,F,U,B,z,G,H,j,W,$,q,X,Y;if(e._optimumEndIndex!=e._optimumCurrentIndex)return f=e._optimum[e._optimumCurrentIndex].PosPrev-e._optimumCurrentIndex,
e.backRes=e._optimum[e._optimumCurrentIndex].BackPrev,e._optimumCurrentIndex=e._optimum[e._optimumCurrentIndex].PosPrev,f;if(e._optimumCurrentIndex=e._optimumEndIndex=0,e._longestMatchWasFound?(p=e._longestMatchLength,
e._longestMatchWasFound=0):p=ie(e),C=e._numDistancePairs,(T=N(e._matchFinder)+1)<2)return e.backRes=-1,1;for(T>273&&(T=273),j=0,u=0;u<4;++u)e.reps[u]=e._repDistances[u],e.repLens[u]=k(e._matchFinder,-1,e.reps[u],273),e.repLens[u]>e.repLens[j]&&(j=u)
;if(e.repLens[j]>=e._numFastBytes)return e.backRes=j,re(e,(f=e.repLens[j])-1),f;if(p>=e._numFastBytes)return e.backRes=e._matchDistances[C-1]+4,re(e,p-1),p;if(l=R(e._matchFinder,-1),v=R(e._matchFinder,-e._repDistances[0]-1-1),
p<2&&l!=v&&e.repLens[j]<2)return e.backRes=-1,1;if(e._optimum[0].State=e._state,F=t&e._posStateMask,e._optimum[1].Price=Re[e._isMatch[(e._state<<4)+F]>>>2]+_e(pe(e._literalEncoder,t,e._previousByte),e._state>=7,v,l),ve(e._optimum[1]),
H=(y=Re[2048-e._isMatch[(e._state<<4)+F]>>>2])+Re[2048-e._isRep[e._state]>>>2],v==l&&(W=H+function(e,t,n){return Re[e._isRepG0[t]>>>2]+Re[e._isRep0Long[(t<<4)+n]>>>2]}(e,e._state,F),W<e._optimum[1].Price&&(e._optimum[1].Price=W,function(e){
e.BackPrev=0,e.Prev1IsChar=0}(e._optimum[1]))),(d=p>=e.repLens[j]?p:e.repLens[j])<2)return e.backRes=e._optimum[1].BackPrev,1;e._optimum[1].PosPrev=0,e._optimum[0].Backs0=e.reps[0],e._optimum[0].Backs1=e.reps[1],e._optimum[0].Backs2=e.reps[2],
e._optimum[0].Backs3=e.reps[3],h=d;do{e._optimum[h--].Price=268435455}while(h>=2);for(u=0;u<4;++u)if(!((G=e.repLens[u])<2)){B=H+ne(e,u,e._state,F);do{(a=B+he(e._repMatchLenEncoder,G-2,F))<(L=e._optimum[G]).Price&&(L.Price=a,L.PosPrev=0,L.BackPrev=u,
L.Prev1IsChar=0)}while(--G>=2)}if(S=y+Re[e._isRep[e._state]>>>2],(h=e.repLens[0]>=2?e.repLens[0]+1:2)<=p){for(M=0;h>e._matchDistances[M];)M+=2;for(;(a=S+te(e,c=e._matchDistances[M+1],h,F))<(L=e._optimum[h]).Price&&(L.Price=a,L.PosPrev=0,
L.BackPrev=c+4,L.Prev1IsChar=0),h!=e._matchDistances[M]||(M+=2)!=C;++h);}for(n=0;;){if(++n==d)return K(e,n);if(b=ie(e),C=e._numDistancePairs,b>=e._numFastBytes)return e._longestMatchLength=b,e._longestMatchWasFound=1,K(e,n);if(++t,
P=e._optimum[n].PosPrev,e._optimum[n].Prev1IsChar?(--P,e._optimum[n].Prev2?(q=e._optimum[e._optimum[n].PosPrev2].State,q=e._optimum[n].BackPrev2<4?q<7?8:11:q<7?7:10):q=e._optimum[P].State,q=V(q)):q=e._optimum[P].State,
P==n-1?q=e._optimum[n].BackPrev?V(q):q<7?9:11:(e._optimum[n].Prev1IsChar&&e._optimum[n].Prev2?(P=e._optimum[n].PosPrev2,O=e._optimum[n].BackPrev2,q=q<7?8:11):q=(O=e._optimum[n].BackPrev)<4?q<7?8:11:q<7?7:10,D=e._optimum[P],
O<4?O?1==O?(e.reps[0]=D.Backs1,e.reps[1]=D.Backs0,e.reps[2]=D.Backs2,e.reps[3]=D.Backs3):2==O?(e.reps[0]=D.Backs2,e.reps[1]=D.Backs0,e.reps[2]=D.Backs1,e.reps[3]=D.Backs3):(e.reps[0]=D.Backs3,e.reps[1]=D.Backs0,e.reps[2]=D.Backs1,
e.reps[3]=D.Backs2):(e.reps[0]=D.Backs0,e.reps[1]=D.Backs1,e.reps[2]=D.Backs2,e.reps[3]=D.Backs3):(e.reps[0]=O-4,e.reps[1]=D.Backs0,e.reps[2]=D.Backs1,e.reps[3]=D.Backs2)),e._optimum[n].State=q,e._optimum[n].Backs0=e.reps[0],
e._optimum[n].Backs1=e.reps[1],e._optimum[n].Backs2=e.reps[2],e._optimum[n].Backs3=e.reps[3],o=e._optimum[n].Price,l=R(e._matchFinder,-1),v=R(e._matchFinder,-e.reps[0]-1-1),F=t&e._posStateMask,x=0,
(r=o+Re[e._isMatch[(q<<4)+F]>>>2]+_e(pe(e._literalEncoder,t,R(e._matchFinder,-2)),q>=7,v,l))<(E=e._optimum[n+1]).Price&&(E.Price=r,E.PosPrev=n,E.BackPrev=-1,E.Prev1IsChar=0,x=1),H=(y=o+Re[2048-e._isMatch[(q<<4)+F]>>>2])+Re[2048-e._isRep[q]>>>2],
v!=l||E.PosPrev<n&&!E.BackPrev||(W=H+(Re[e._isRepG0[q]>>>2]+Re[e._isRep0Long[(q<<4)+F]>>>2]))<=E.Price&&(E.Price=W,E.PosPrev=n,E.BackPrev=0,E.Prev1IsChar=0,x=1),!((T=A=4095-n<(A=N(e._matchFinder)+1)?4095-n:A)<2)){
if(T>e._numFastBytes&&(T=e._numFastBytes),!x&&v!=l&&(Y=Math.min(A-1,e._numFastBytes),(g=k(e._matchFinder,0,e.reps[0],Y))>=2)){for(X=V(q),U=t+1&e._posStateMask,w=r+Re[2048-e._isMatch[(X<<4)+U]>>>2]+Re[2048-e._isRep[X]>>>2],
I=n+1+g;d<I;)e._optimum[++d].Price=268435455;(a=w+(he(e._repMatchLenEncoder,g-2,U)+ne(e,0,X,U)))<(L=e._optimum[I]).Price&&(L.Price=a,L.PosPrev=n+1,L.BackPrev=0,L.Prev1IsChar=1,L.Prev2=0)}for($=2,
z=0;z<4;++z)if(!((m=k(e._matchFinder,-1,e.reps[z],T))<2)){_=m;do{for(;d<n+m;)e._optimum[++d].Price=268435455;(a=H+(he(e._repMatchLenEncoder,m-2,F)+ne(e,z,q,F)))<(L=e._optimum[n+m]).Price&&(L.Price=a,L.PosPrev=n,L.BackPrev=z,L.Prev1IsChar=0)
}while(--m>=2);if(m=_,z||($=m+1),m<A&&(Y=Math.min(A-1-m,e._numFastBytes),(g=k(e._matchFinder,m,e.reps[z],Y))>=2)){for(X=q<7?8:11,U=t+m&e._posStateMask,
i=H+(he(e._repMatchLenEncoder,m-2,F)+ne(e,z,q,F))+Re[e._isMatch[(X<<4)+U]>>>2]+_e(pe(e._literalEncoder,t+m,R(e._matchFinder,m-1-1)),1,R(e._matchFinder,m-1-(e.reps[z]+1)),R(e._matchFinder,m-1)),X=V(X),U=t+m+1&e._posStateMask,
w=i+Re[2048-e._isMatch[(X<<4)+U]>>>2]+Re[2048-e._isRep[X]>>>2],I=m+1+g;d<n+I;)e._optimum[++d].Price=268435455;(a=w+(he(e._repMatchLenEncoder,g-2,U)+ne(e,0,X,U)))<(L=e._optimum[n+I]).Price&&(L.Price=a,L.PosPrev=n+m+1,L.BackPrev=0,L.Prev1IsChar=1,
L.Prev2=1,L.PosPrev2=n,L.BackPrev2=z)}}if(b>T){for(b=T,C=0;b>e._matchDistances[C];C+=2);e._matchDistances[C]=b,C+=2}if(b>=$){for(S=y+Re[e._isRep[q]>>>2];d<n+b;)e._optimum[++d].Price=268435455;for(M=0;$>e._matchDistances[M];)M+=2
;for(m=$;;++m)if((a=S+te(e,s=e._matchDistances[M+1],m,F))<(L=e._optimum[n+m]).Price&&(L.Price=a,L.PosPrev=n,L.BackPrev=s+4,L.Prev1IsChar=0),m==e._matchDistances[M]){if(m<A&&(Y=Math.min(A-1-m,e._numFastBytes),(g=k(e._matchFinder,m,s,Y))>=2)){
for(X=q<7?7:10,U=t+m&e._posStateMask,i=a+Re[e._isMatch[(X<<4)+U]>>>2]+_e(pe(e._literalEncoder,t+m,R(e._matchFinder,m-1-1)),1,R(e._matchFinder,m-(s+1)-1),R(e._matchFinder,m-1)),X=V(X),U=t+m+1&e._posStateMask,
w=i+Re[2048-e._isMatch[(X<<4)+U]>>>2]+Re[2048-e._isRep[X]>>>2],I=m+1+g;d<n+I;)e._optimum[++d].Price=268435455;(a=w+(he(e._repMatchLenEncoder,g-2,U)+ne(e,0,X,U)))<(L=e._optimum[n+I]).Price&&(L.Price=a,L.PosPrev=n+m+1,L.BackPrev=0,L.Prev1IsChar=1,
L.Prev2=1,L.PosPrev2=n,L.BackPrev2=s+4)}if((M+=2)==C)break}}}}}function te(e,t,n,r){var i=G(n);return(t<128?e._distancesPrices[128*i+t]:e._posSlotPrices[(i<<6)+function(e){return e<131072?Y[e>>6]+12:e<134217728?Y[e>>16]+32:Y[e>>26]+52
}(t)]+e._alignPrices[15&t])+he(e._lenEncoder,n-2,r)}function ne(e,t,n,r){var i;return t?(i=Re[2048-e._isRepG0[n]>>>2],1==t?i+=Re[e._isRepG1[n]>>>2]:(i+=Re[2048-e._isRepG1[n]>>>2],i+=Oe(e._isRepG2[n],t-2))):(i=Re[e._isRepG0[n]>>>2],
i+=Re[2048-e._isRep0Long[(n<<4)+r]>>>2]),i}function re(e,t){t>0&&(function(e,t){var n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,_,v;do{if(e._pos+e._matchMaxLen<=e._streamPos)p=e._matchMaxLen;else if((p=e._streamPos-e._pos)<e.kMinMatchCheck){P(e);continue}
for(f=e._pos>e._cyclicBufferSize?e._pos-e._cyclicBufferSize:0,r=e._bufferOffset+e._pos,e.HASH_ARRAY?(o=1023&(v=O[255&e._bufferBase[r]]^255&e._bufferBase[r+1]),e._hash[o]=e._pos,l=65535&(v^=(255&e._bufferBase[r+2])<<8),e._hash[1024+l]=e._pos,
c=(v^O[255&e._bufferBase[r+3]]<<5)&e._hashMask):c=255&e._bufferBase[r]^(255&e._bufferBase[r+1])<<8,i=e._hash[e.kFixHashSize+c],e._hash[e.kFixHashSize+c]=e._pos,g=1+(e._cyclicBufferPos<<1),_=e._cyclicBufferPos<<1,h=d=e.kNumHashDirectBytes,
n=e._cutValue;;){if(i<=f||0==n--){e._son[g]=e._son[_]=0;break}if(a=((s=e._pos-i)<=e._cyclicBufferPos?e._cyclicBufferPos-s:e._cyclicBufferPos-s+e._cyclicBufferSize)<<1,m=e._bufferOffset+i,u=h<d?h:d,e._bufferBase[m+u]==e._bufferBase[r+u]){
for(;++u!=p&&e._bufferBase[m+u]==e._bufferBase[r+u];);if(u==p){e._son[_]=e._son[a],e._son[g]=e._son[a+1];break}}(255&e._bufferBase[m+u])<(255&e._bufferBase[r+u])?(e._son[_]=i,_=a+1,i=e._son[_],d=u):(e._son[g]=i,g=a,i=e._son[g],h=u)}P(e)}while(0!=--t)
}(e._matchFinder,t),e._additionalOffset+=t)}function ie(e){var t=0;return e._numDistancePairs=function(e,t){var n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,_,v,y,b,x,E
;if(e._pos+e._matchMaxLen<=e._streamPos)m=e._matchMaxLen;else if((m=e._streamPos-e._pos)<e.kMinMatchCheck)return P(e),0;for(v=0,g=e._pos>e._cyclicBufferSize?e._pos-e._cyclicBufferSize:0,r=e._bufferOffset+e._pos,_=1,c=0,u=0,
e.HASH_ARRAY?(c=1023&(E=O[255&e._bufferBase[r]]^255&e._bufferBase[r+1]),u=65535&(E^=(255&e._bufferBase[r+2])<<8),h=(E^O[255&e._bufferBase[r+3]]<<5)&e._hashMask):h=255&e._bufferBase[r]^(255&e._bufferBase[r+1])<<8,i=e._hash[e.kFixHashSize+h]||0,
e.HASH_ARRAY&&(a=e._hash[c]||0,s=e._hash[1024+u]||0,e._hash[c]=e._pos,e._hash[1024+u]=e._pos,a>g&&e._bufferBase[e._bufferOffset+a]==e._bufferBase[r]&&(t[v++]=_=2,t[v++]=e._pos-a-1),
s>g&&e._bufferBase[e._bufferOffset+s]==e._bufferBase[r]&&(s==a&&(v-=2),t[v++]=_=3,t[v++]=e._pos-s-1,a=s),0!=v&&a==i&&(v-=2,_=1)),e._hash[e.kFixHashSize+h]=e._pos,b=1+(e._cyclicBufferPos<<1),x=e._cyclicBufferPos<<1,p=f=e.kNumHashDirectBytes,
0!=e.kNumHashDirectBytes&&i>g&&e._bufferBase[e._bufferOffset+i+e.kNumHashDirectBytes]!=e._bufferBase[r+e.kNumHashDirectBytes]&&(t[v++]=_=e.kNumHashDirectBytes,t[v++]=e._pos-i-1),n=e._cutValue;;){if(i<=g||0==n--){e._son[b]=e._son[x]=0;break}
if(o=((l=e._pos-i)<=e._cyclicBufferPos?e._cyclicBufferPos-l:e._cyclicBufferPos-l+e._cyclicBufferSize)<<1,y=e._bufferOffset+i,d=p<f?p:f,e._bufferBase[y+d]==e._bufferBase[r+d]){for(;++d!=m&&e._bufferBase[y+d]==e._bufferBase[r+d];);if(_<d&&(t[v++]=_=d,
t[v++]=l-1,d==m)){e._son[x]=e._son[o],e._son[b]=e._son[o+1];break}}(255&e._bufferBase[y+d])<(255&e._bufferBase[r+d])?(e._son[x]=i,x=o+1,i=e._son[x],f=d):(e._son[b]=i,b=o,i=e._son[b],p=d)}return P(e),v}(e._matchFinder,e._matchDistances),
e._numDistancePairs>0&&(t=e._matchDistances[e._numDistancePairs-2])==e._numFastBytes&&(t+=k(e._matchFinder,t-1,e._matchDistances[e._numDistancePairs-1],273-t)),++e._additionalOffset,t}function ae(e){
e._matchFinder&&e._needReleaseMFStream&&(e._matchFinder._stream=null,e._needReleaseMFStream=0)}function se(e){return e<2048?Y[e]:e<2097152?Y[e>>10]+20:Y[e>>20]+40}function oe(e,t){Ie(e._choice);for(var n=0;n<t;++n)Ie(e._lowCoder[n].Models),
Ie(e._midCoder[n].Models);Ie(e._highCoder.Models)}function le(e,t,n,r,i){var a,s,o,l,c;for(a=Re[e._choice[0]>>>2],o=(s=Re[2048-e._choice[0]>>>2])+Re[e._choice[1]>>>2],l=s+Re[2048-e._choice[1]>>>2],c=0,c=0;c<8;++c){if(c>=n)return
;r[i+c]=a+we(e._lowCoder[t],c)}for(;c<16;++c){if(c>=n)return;r[i+c]=o+we(e._midCoder[t],c-8)}for(;c<n;++c)r[i+c]=l+we(e._highCoder,c-8-8)}function ce(e,t,n,r){!function(e,t,n,r){n<8?(ke(t,e._choice,0,0),Ee(e._lowCoder[r],t,n)):(n-=8,
ke(t,e._choice,0,1),n<8?(ke(t,e._choice,1,0),Ee(e._midCoder[r],t,n)):(ke(t,e._choice,1,1),Ee(e._highCoder,t,n-8)))}(e,t,n,r),0==--e._counters[r]&&(le(e,r,e._tableSize,e._prices,272*r),e._counters[r]=e._tableSize)}function ue(e){return function(e){
e._choice=l(2),e._lowCoder=l(16),e._midCoder=l(16),e._highCoder=xe({},8);for(var t=0;t<16;++t)e._lowCoder[t]=xe({},3),e._midCoder[t]=xe({},3)}(e),e._prices=[],e._counters=[],e}function he(e,t,n){return e._prices[272*n+t]}function de(e,t){
for(var n=0;n<t;++n)le(e,n,e._tableSize,e._prices,272*n),e._counters[n]=e._tableSize}function pe(e,t,n){return e.m_Coders[((t&e.m_PosMask)<<e.m_NumPrevBits)+((255&n)>>>8-e.m_NumPrevBits)]}function fe(e,t,n){var r,i,a=1;for(i=7;i>=0;--i)r=n>>i&1,
ke(t,e.m_Encoders,a,r),a=a<<1|r}function me(e,t,n,r){var i,a,s,o,l=1,c=1;for(a=7;a>=0;--a)i=r>>a&1,o=c,l&&(o+=1+(s=n>>a&1)<<8,l=s==i),ke(t,e.m_Encoders,o,i),c=c<<1|i}function ge(e){return e.m_Encoders=l(768),e}function _e(e,t,n,r){var i,a,s=1,o=7,l=0
;if(t)for(;o>=0;--o)if(a=n>>o&1,i=r>>o&1,l+=Oe(e.m_Encoders[(1+a<<8)+s],i),s=s<<1|i,a!=i){--o;break}for(;o>=0;--o)i=r>>o&1,l+=Oe(e.m_Encoders[s],i),s=s<<1|i;return l}function ve(e){e.BackPrev=-1,e.Prev1IsChar=0}function ye(e,t){
return e.NumBitLevels=t,e.Models=l(1<<t),e}function be(e,t){var n,r=1;for(n=e.NumBitLevels;0!=n;--n)r=(r<<1)+Me(t,e.Models,r);return r-(1<<e.NumBitLevels)}function xe(e,t){return e.NumBitLevels=t,e.Models=l(1<<t),e}function Ee(e,t,n){var r,i,a=1
;for(i=e.NumBitLevels;0!=i;)r=n>>>--i&1,ke(t,e.Models,a,r),a=a<<1|r}function we(e,t){var n,r,i=1,a=0;for(r=e.NumBitLevels;0!=r;)n=t>>>--r&1,a+=Oe(e.Models[i],n),i=(i<<1)+n;return a}function Se(e,t,n){var r,i,a=1;for(i=0;i<e.NumBitLevels;++i)r=1&n,
ke(t,e.Models,a,r),a=a<<1|r,n>>=1}function Te(e,t){var n,r,i=1,a=0;for(r=e.NumBitLevels;0!=r;--r)n=1&t,t>>>=1,a+=Oe(e.Models[i],n),i=i<<1|n;return a}function Ae(e,t,n,r,i){var a,s,o=1;for(s=0;s<r;++s)ke(n,e,t+o,a=1&i),o=o<<1|a,i>>=1}
function Ce(e,t,n,r){var i,a,s=1,o=0;for(a=n;0!=a;--a)i=1&r,r>>>=1,o+=Re[(2047&(e[t+s]-i^-i))>>>2],s=s<<1|i;return o}function Me(e,t,n){var r,i=t[n];return r=(e.Range>>>11)*i,(-2147483648^e.Code)<(-2147483648^r)?(e.Range=r,
t[n]=i+(2048-i>>>5)<<16>>16,-16777216&e.Range||(e.Code=e.Code<<8|x(e.Stream),e.Range<<=8),0):(e.Range-=r,e.Code-=r,t[n]=i-(i>>>5)<<16>>16,-16777216&e.Range||(e.Code=e.Code<<8|x(e.Stream),e.Range<<=8),1)}function Ie(e){
for(var t=e.length-1;t>=0;--t)e[t]=1024}var Re=function(){var e,t,n,r=[];for(t=8;t>=0;--t)for(e=1<<9-t,n=1<<9-t-1;n<e;++n)r[n]=(t<<6)+(e-n<<6>>>9-t-1);return r}();function ke(e,t,n,r){var i,a=t[n];i=(e.Range>>>11)*a,
r?(e.Low=c(e.Low,u(f(i),[4294967295,0])),e.Range-=i,t[n]=a-(a>>>5)<<16>>16):(e.Range=i,t[n]=a+(2048-a>>>5)<<16>>16),-16777216&e.Range||(e.Range<<=8,Le(e))}function Ne(e,t,n){for(var r=n-1;r>=0;--r)e.Range>>>=1,
1==(t>>>r&1)&&(e.Low=c(e.Low,f(e.Range))),-16777216&e.Range||(e.Range<<=8,Le(e))}function De(e){return c(c(f(e._cacheSize),e._position),[4,0])}function Le(e){var t,n,r,i,a=m((r=32,i=v(n=e.Low,r&=63),n[1]<0&&(i=c(i,_([2,0],31))),i))
;if(0!=a||h(e.Low,[4278190080,0])<0){e._position=c(e._position,f(e._cacheSize)),t=e._cache;do{T(e.Stream,t+a),t=255}while(0!=--e._cacheSize);e._cache=m(e.Low)>>>24}++e._cacheSize,e.Low=_(u(e.Low,[16777215,0]),8)}function Oe(e,t){
return Re[(2047&(e-t^-t))>>>2]}function Pe(e){for(var t,n,r,i=0,a=0,s=e.length,o=[],l=[];i<s;++i,++a){if(128&(t=255&e[i]))if(192==(224&t)){if(i+1>=s)return e;if(128!=(192&(n=255&e[++i])))return e;l[a]=(31&t)<<6|63&n}else{if(224!=(240&t))return e
;if(i+2>=s)return e;if(128!=(192&(n=255&e[++i])))return e;if(128!=(192&(r=255&e[++i])))return e;l[a]=(15&t)<<12|(63&n)<<6|63&r}else{if(!t)return e;l[a]=t}16383==a&&(o.push(String.fromCharCode.apply(String,l)),a=-1)}return a>0&&(l.length=a,
o.push(String.fromCharCode.apply(String,l))),o.join("")}function Fe(e){var t,n,r,i=[],a=0,s=e.length;if("object"==typeof e)return e;for(function(e,t,n,r,i){var a;for(a=0;a<n;++a)r[i++]=e.charCodeAt(a)}(e,0,s,i,0),
r=0;r<s;++r)(t=i[r])>=1&&t<=127?++a:a+=!t||t>=128&&t<=2047?2:3;for(n=[],a=0,r=0;r<s;++r)(t=i[r])>=1&&t<=127?n[a++]=t<<24>>24:!t||t>=128&&t<=2047?(n[a++]=(192|t>>6&31)<<24>>24,n[a++]=(128|63&t)<<24>>24):(n[a++]=(224|t>>12&15)<<24>>24,
n[a++]=(128|t>>6&63)<<24>>24,n[a++]=(128|63&t)<<24>>24);return n}function Ue(e){return e[1]+e[0]}var Be,ze=(Be=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,
f:255,m:1}],function(e){return Be[e-1]||Be[6]});return"undefined"==typeof onmessage||"undefined"!=typeof window&&void 0!==window.document||(onmessage=function(t){
t&&t.data&&(2==t.data.action?e.decompress(t.data.data,t.data.cbn):1==t.data.action&&e.compress(t.data.data,t.data.mode,t.data.cbn))}),{compress:function(e,n,r,i){var a,s,l={},c=void 0===r&&void 0===i;if("function"!=typeof r&&(s=r,r=i=0),
i=i||function(e){if(void 0!==s)return o(e,s)},r=r||function(e,t){if(void 0!==s)return postMessage({action:1,cbn:s,result:e,error:t})},c){for(l.c=M({},Fe(e),ze(n));H(l.c.chunker););return S(l.c.output)}try{l.c=M({},Fe(e),ze(n)),i(0)}catch(e){
return r(null,e)}t((function e(){try{for(var n,s=(new Date).getTime();H(l.c.chunker);)if(a=Ue(l.c.chunker.inBytesProcessed)/Ue(l.c.length_0),(new Date).getTime()-s>200)return i(a),t(e,0),0;i(1),n=S(l.c.output),t(r.bind(null,n),0)}catch(e){r(null,e)}
}),0)},decompress:function(e,n,r){var i,a,s,l,c={},u=void 0===n&&void 0===r;if("function"!=typeof n&&(a=n,n=r=0),r=r||function(e){if(void 0!==a)return o(s?e:-1,a)},n=n||function(e,t){if(void 0!==a)return postMessage({action:2,cbn:a,result:e,error:t})
},u){for(c.d=I({},e);H(c.d.chunker););return Pe(S(c.d.output))}try{c.d=I({},e),l=Ue(c.d.length_0),s=l>-1,r(0)}catch(e){return n(null,e)}t((function e(){try{
for(var a,o=0,u=(new Date).getTime();H(c.d.chunker);)if(++o%1e3==0&&(new Date).getTime()-u>200)return s&&(i=Ue(c.d.chunker.decoder.nowPos64)/l,r(i)),t(e,0),0;r(1),a=Pe(S(c.d.output)),t(n.bind(null,a),0)}catch(e){n(null,e)}}),0)}}}();this.j=e},
1514:e=>{"use strict";e.exports=Math.abs},8968:e=>{"use strict";e.exports=Math.floor},4459:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},6188:e=>{"use strict";e.exports=Math.max},8002:e=>{"use strict";e.exports=Math.min},
5880:e=>{"use strict";e.exports=Math.pow},414:e=>{"use strict";e.exports=Math.round},3093:(e,t,n)=>{"use strict";var r=n(4459);e.exports=function(e){return r(e)||0===e?e:e<0?-1:1}},6585:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function a(e,t,n,r){
var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,s){s=s||{};var o,l,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){
var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var s=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":
case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n
;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===c&&isFinite(e))return s.long?(o=e,
(l=Math.abs(o))>=i?a(o,l,i,"day"):l>=r?a(o,l,r,"hour"):l>=n?a(o,l,n,"minute"):l>=t?a(o,l,t,"second"):o+" ms"):function(e){var a=Math.abs(e)
;return a>=i?Math.round(e/i)+"d":a>=r?Math.round(e/r)+"h":a>=n?Math.round(e/n)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3092:(e,t)=>{"use strict"
;var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),
t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},9211:e=>{"use strict";var t=function(e){return e!=e};e.exports=function(e,n){return 0===e&&0===n?1/e==1/n:e===n||!(!t(e)||!t(n))}},7653:(e,t,n)=>{"use strict"
;var r=n(8452),i=n(487),a=n(9211),s=n(9394),o=n(6576),l=i(s(),Object);r(l,{getPolyfill:s,implementation:a,shim:o}),e.exports=l},9394:(e,t,n)=>{"use strict";var r=n(9211);e.exports=function(){return"function"==typeof Object.is?Object.is:r}},
6576:(e,t,n)=>{"use strict";var r=n(9394),i=n(8452);e.exports=function(){var e=r();return i(Object,{is:e},{is:function(){return Object.is!==e}}),e}},8875:(e,t,n)=>{"use strict";var r;if(!Object.keys){
var i=Object.prototype.hasOwnProperty,a=Object.prototype.toString,s=n(1093),o=Object.prototype.propertyIsEnumerable,l=!o.call({toString:null
},"toString"),c=o.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,
$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,
$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&i.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{
h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();r=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===a.call(e),r=s(e),o=t&&"[object String]"===a.call(e),d=[]
;if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var f=c&&n;if(o&&e.length>0&&!i.call(e,0))for(var m=0;m<e.length;++m)d.push(String(m))
;if(r&&e.length>0)for(var g=0;g<e.length;++g)d.push(String(g));else for(var _ in e)f&&"prototype"===_||!i.call(e,_)||d.push(String(_));if(l)for(var v=function(e){if("undefined"==typeof window||!p)return h(e);try{return h(e)}catch(e){return!1}
}(e),y=0;y<u.length;++y)v&&"constructor"===u[y]||!i.call(e,u[y])||d.push(u[y]);return d}}e.exports=r},1189:(e,t,n)=>{"use strict";var r=Array.prototype.slice,i=n(1093),a=Object.keys,s=a?function(e){return a(e)}:n(8875),o=Object.keys
;s.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return i(e)?o(r.call(e)):o(e)})}else Object.keys=s;return Object.keys||s},e.exports=s},1093:e=>{
"use strict";var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),r="[object Arguments]"===n
;return r||(r="[object Array]"!==n&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),r}},9805:(e,t)=>{"use strict"
;var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){
var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={
arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,s;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,
n=e.length;t<n;t++)a=e[t],s.set(a,i),i+=a.length;return s}},a={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,
t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(n)},3269:e=>{"use strict";e.exports=function(e,t,n,r){for(var i=65535&e,a=e>>>16&65535,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0
}while(--s);i%=65521,a%=65521}return i|a<<16}},9681:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,
Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},4823:e=>{"use strict"
;var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,n,r,i){var a=t,s=i+r;e^=-1;for(var o=i;o<s;o++)e=e>>>8^a[255&(e^n[o])];return~e}},8411:(e,t,n)=>{"use strict"
;var r,i=n(9805),a=n(3665),s=n(3269),o=n(4823),l=n(4674),c=-2,u=258,h=262,d=103,p=113,f=666;function m(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function _(e){for(var t=e.length;--t>=0;)e[t]=0}function v(e){
var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}
function y(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,v(e.strm)}function b(e,t){e.pending_buf[e.pending++]=t}function x(e,t){e.pending_buf[e.pending++]=t>>>8&255,
e.pending_buf[e.pending++]=255&t}function E(e,t){var n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-h?e.strstart-(e.w_size-h):0,c=e.window,d=e.w_mask,p=e.prev,f=e.strstart+u,m=c[a+s-1],g=c[a+s]
;e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(n=t)+s]===g&&c[n+s-1]===m&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++
;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<f);if(r=u-(f-a),a=f-u,r>s){if(e.match_start=t,s=r,r>=o)break;m=c[a+s-1],g=c[a+s]}}
}while((t=p[t&d])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function w(e){var t,n,r,a,l,c,u,d,p,f,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-h)){i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,
e.block_start-=m,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=m?r-m:0}while(--n);t=n=m;do{r=e.prev[--t],e.prev[t]=r>=m?r-m:0}while(--n);a+=m}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,p=a,f=void 0,
(f=c.avail_in)>p&&(f=p),n=0===f?0:(c.avail_in-=f,i.arraySet(u,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=s(c.adler,u,f,d):2===c.state.wrap&&(c.adler=o(c.adler,u,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,
e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],
e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<h&&0!==e.strm.avail_in)}function S(e,t){for(var n,r;;){if(e.lookahead<h){if(w(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(n=0,
e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-h&&(e.match_length=E(e,n)),
e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,
e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,
e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(y(e,!1),0===e.strm.avail_out))return 1}
return e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function T(e,t){for(var n,r,i;;){if(e.lookahead<h){if(w(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}
if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,
0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-h&&(e.match_length=E(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){
i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,
n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(y(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){
if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&y(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),
e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}
function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,
this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,
this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),
this.bl_tree=new i.Buf16(78),_(this.dyn_ltree),_(this.dyn_dtree),_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),_(this.heap),this.heap_len=0,this.heap_max=0,
this.depth=new i.Buf16(573),_(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t
;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:p,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,c)}function I(e){var t,n=M(e)
;return 0===n&&((t=e.state).window_size=2*t.w_size,_(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,
t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function R(e,t,n,r,a,s){if(!e)return c;var o=1;if(-1===t&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||s<0||s>4)return m(e,c)
;8===r&&(r=9);var l=new C;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),
l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,
l.level=t,l.strategy=s,l.method=n,I(e)}r=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(w(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,
e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,y(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-h&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,
4===t?(y(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(y(e,!1),e.strm.avail_out),1)
})),new A(4,4,8,4,S),new A(4,5,16,8,S),new A(4,6,32,32,S),new A(4,4,16,16,T),new A(8,16,32,32,T),new A(8,16,128,128,T),new A(8,32,128,256,T),new A(32,128,258,1024,T),new A(32,258,258,4096,T)],t.deflateInit=function(e,t){return R(e,t,8,15,8,0)},
t.deflateInit2=R,t.deflateReset=I,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?c:(e.state.gzhead=t,0):c},t.deflate=function(e,t){var n,i,s,l;if(!e||!e.state||t>5||t<0)return e?m(e,c):c;if(i=e.state,
!e.output||!e.input&&0!==e.avail_in||i.status===f&&4!==t)return m(e,0===e.avail_out?-5:c);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,b(i,31),b(i,139),b(i,8),
i.gzhead?(b(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),b(i,255&i.gzhead.time),b(i,i.gzhead.time>>8&255),b(i,i.gzhead.time>>16&255),b(i,i.gzhead.time>>24&255),
b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(b(i,255&i.gzhead.extra.length),b(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=o(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,
i.status=69):(b(i,0),b(i,0),b(i,0),b(i,0),b(i,0),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,3),i.status=p);else{var h=8+(i.w_bits-8<<4)<<8;h|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,
i.status=p,x(i,h),0!==i.strstart&&(x(i,e.adler>>>16),x(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){
for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),v(e),s=i.pending,
i.pending!==i.pending_buf_size));)b(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73
;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),v(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}
l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91
;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),v(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}
l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.status=d)}else i.status=d
;if(i.status===d&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&v(e),i.pending+2<=i.pending_buf_size&&(b(i,255&e.adler),b(i,e.adler>>8&255),e.adler=0,i.status=p)):i.status=p),0!==i.pending){if(v(e),0===e.avail_out)return i.last_flush=-1,0
}else if(0===e.avail_in&&g(t)<=g(n)&&4!==t)return m(e,-5);if(i.status===f&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==f){var E=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(w(e),
0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),
0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,s,o=e.window;;){if(e.lookahead<=u){if(w(e),e.lookahead<=u&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,
e.lookahead>=3&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){s=e.strstart+u;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);e.match_length=u-(s-i),
e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,
e.strstart++),n&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==E&&4!==E||(i.status=f),
1===E||3===E)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===E&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(_(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),v(e),0===e.avail_out))return i.last_flush=-1,
0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(b(i,255&e.adler),b(i,e.adler>>8&255),b(i,e.adler>>16&255),b(i,e.adler>>24&255),b(i,255&e.total_in),b(i,e.total_in>>8&255),b(i,e.total_in>>16&255),b(i,e.total_in>>24&255)):(x(i,e.adler>>>16),
x(i,65535&e.adler)),v(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==d&&t!==p&&t!==f?m(e,c):(e.state=null,t===p?m(e,-3):0):c},
t.deflateSetDictionary=function(e,t){var n,r,a,o,l,u,h,d,p=t.length;if(!e||!e.state)return c;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return c;for(1===o&&(e.adler=s(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===o&&(_(n.head),
n.strstart=0,n.block_start=0,n.insert=0),d=new i.Buf8(n.w_size),i.arraySet(d,t,p-n.w_size,n.w_size,0),t=d,p=n.w_size),l=e.avail_in,u=e.next_in,h=e.input,e.avail_in=p,e.next_in=0,e.input=t,w(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{
n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,w(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,
n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=h,e.avail_in=l,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},7293:e=>{"use strict";e.exports=function(e,t){
var n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,_,v,y,b,x,E,w,S,T,A;n=e.state,r=e.next_in,T=e.input,i=r+(e.avail_in-5),a=e.next_out,A=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,p=n.hold,f=n.bits,
m=n.lencode,g=n.distcode,_=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{f<15&&(p+=T[r++]<<f,f+=8,p+=T[r++]<<f,f+=8),y=m[p&_];t:for(;;){if(p>>>=b=y>>>24,f-=b,0==(b=y>>>16&255))A[a++]=65535&y;else{if(!(16&b)){if(!(64&b)){y=m[(65535&y)+(p&(1<<b)-1)]
;continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&y,(b&=15)&&(f<b&&(p+=T[r++]<<f,f+=8),x+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=T[r++]<<f,f+=8,p+=T[r++]<<f,f+=8),y=g[p&v];n:for(;;){if(p>>>=b=y>>>24,f-=b,
!(16&(b=y>>>16&255))){if(!(64&b)){y=g[(65535&y)+(p&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(E=65535&y,f<(b&=15)&&(p+=T[r++]<<f,(f+=8)<b&&(p+=T[r++]<<f,f+=8)),(E+=p&(1<<b)-1)>l){e.msg="invalid distance too far back",
n.mode=30;break e}if(p>>>=b,f-=b,E>(b=a-s)){if((b=E-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=0,S=d,0===h){if(w+=c-b,b<x){x-=b;do{A[a++]=d[w++]}while(--b);w=a-E,S=A}}else if(h<b){if(w+=c+h-b,(b-=h)<x){x-=b;do{
A[a++]=d[w++]}while(--b);if(w=0,h<x){x-=b=h;do{A[a++]=d[w++]}while(--b);w=a-E,S=A}}}else if(w+=h-b,b<x){x-=b;do{A[a++]=d[w++]}while(--b);w=a-E,S=A}for(;x>2;)A[a++]=S[w++],A[a++]=S[w++],A[a++]=S[w++],x-=3;x&&(A[a++]=S[w++],x>1&&(A[a++]=S[w++]))}else{
w=a-E;do{A[a++]=A[w++],A[a++]=A[w++],A[a++]=A[w++],x-=3}while(x>2);x&&(A[a++]=A[w++],x>1&&(A[a++]=A[w++]))}break}}break}}while(r<i&&a<o);r-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),
e.avail_out=a<o?o-a+257:257-(a-o),n.hold=p,n.bits=f}},1447:(e,t,n)=>{"use strict";var r=n(9805),i=n(3269),a=n(4823),s=n(7293),o=n(1998),l=-2,c=12,u=30;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function d(){
this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,
this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,
this.back=0,this.was=0}function p(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,
t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):l}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,p(e)):l}function m(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,
t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,f(e))):l}function g(e,t){var n,r;return e?(r=new d,e.state=r,r.window=null,0!==(n=m(e,t))&&(e.state=null),n):l}var _,v,y=!0
;function b(e){if(y){var t;for(_=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,_,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5
;o(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=_,e.lenbits=9,e.distcode=v,e.distbits=5}function x(e,t,n,i){var a,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),
i>=s.wsize?(r.arraySet(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>i&&(a=i),r.arraySet(s.window,t,n-i,a,s.wnext),(i-=a)?(r.arraySet(s.window,t,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=a,
s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}t.inflateReset=f,t.inflateReset2=m,t.inflateResetKeep=p,t.inflateInit=function(e){return g(e,15)},t.inflateInit2=g,t.inflate=function(e,t){
var n,d,p,f,m,g,_,v,y,E,w,S,T,A,C,M,I,R,k,N,D,L,O,P,F=0,U=new r.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===c&&(n.mode=13),m=e.next_out,p=e.output,
_=e.avail_out,f=e.next_in,d=e.input,g=e.avail_in,v=n.hold,y=n.bits,E=g,w=_,L=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;y<16;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(2&n.wrap&&35615===v){n.check=0,U[0]=255&v,
U[1]=v>>>8&255,n.check=a(n.check,U,2,0),v=0,y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=u;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=u;break}
if(y-=4,D=8+(15&(v>>>=4)),0===n.wbits)n.wbits=D;else if(D>n.wbits){e.msg="invalid window size",n.mode=u;break}n.dmax=1<<D,e.adler=n.check=1,n.mode=512&v?10:c,v=0,y=0;break;case 2:for(;y<16;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(n.flags=v,
8!=(255&n.flags)){e.msg="unknown compression method",n.mode=u;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=u;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(U[0]=255&v,U[1]=v>>>8&255,n.check=a(n.check,U,2,0)),v=0,y=0,n.mode=3
;case 3:for(;y<32;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}n.head&&(n.head.time=v),512&n.flags&&(U[0]=255&v,U[1]=v>>>8&255,U[2]=v>>>16&255,U[3]=v>>>24&255,n.check=a(n.check,U,4,0)),v=0,y=0,n.mode=4;case 4:for(;y<16;){if(0===g)break e;g--,
v+=d[f++]<<y,y+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(U[0]=255&v,U[1]=v>>>8&255,n.check=a(n.check,U,2,0)),v=0,y=0,n.mode=5;case 5:if(1024&n.flags){for(;y<16;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}n.length=v,
n.head&&(n.head.extra_len=v),512&n.flags&&(U[0]=255&v,U[1]=v>>>8&255,n.check=a(n.check,U,2,0)),v=0,y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((S=n.length)>g&&(S=g),S&&(n.head&&(D=n.head.extra_len-n.length,
n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,d,f,S,D)),512&n.flags&&(n.check=a(n.check,d,S,f)),g-=S,f+=S,n.length-=S),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;S=0;do{
D=d[f+S++],n.head&&D&&n.length<65536&&(n.head.name+=String.fromCharCode(D))}while(D&&S<g);if(512&n.flags&&(n.check=a(n.check,d,S,f)),g-=S,f+=S,D)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;S=0
;do{D=d[f+S++],n.head&&D&&n.length<65536&&(n.head.comment+=String.fromCharCode(D))}while(D&&S<g);if(512&n.flags&&(n.check=a(n.check,d,S,f)),g-=S,f+=S,D)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;y<16;){
if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=u;break}v=0,y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=c;break;case 10:for(;y<32;){if(0===g)break e;g--,
v+=d[f++]<<y,y+=8}e.adler=n.check=h(v),v=0,y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=m,e.avail_out=_,e.next_in=f,e.avail_in=g,n.hold=v,n.bits=y,2;e.adler=n.check=1,n.mode=c;case c:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&y,
y-=7&y,n.mode=27;break}for(;y<3;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}switch(n.last=1&v,y-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6===t){v>>>=2,y-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",
n.mode=u}v>>>=2,y-=2;break;case 14:for(v>>>=7&y,y-=7&y;y<32;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=u;break}if(n.length=65535&v,v=0,y=0,n.mode=15,6===t)break e;case 15:
n.mode=16;case 16:if(S=n.length){if(S>g&&(S=g),S>_&&(S=_),0===S)break e;r.arraySet(p,d,f,S,m),g-=S,f+=S,_-=S,m+=S,n.length-=S;break}n.mode=c;break;case 17:for(;y<14;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(n.nlen=257+(31&v),v>>>=5,y-=5,
n.ndist=1+(31&v),v>>>=5,y-=5,n.ncode=4+(15&v),v>>>=4,y-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=u;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;y<3;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}
n.lens[B[n.have++]]=7&v,v>>>=3,y-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,O={bits:n.lenbits},L=o(0,n.lens,0,19,n.lencode,0,n.work,O),n.lenbits=O.bits,L){e.msg="invalid code lengths set",n.mode=u;break}n.have=0,
n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(F=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,I=65535&F,!((C=F>>>24)<=y);){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(I<16)v>>>=C,y-=C,n.lens[n.have++]=I;else{if(16===I){for(P=C+2;y<P;){
if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(v>>>=C,y-=C,0===n.have){e.msg="invalid bit length repeat",n.mode=u;break}D=n.lens[n.have-1],S=3+(3&v),v>>>=2,y-=2}else if(17===I){for(P=C+3;y<P;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}y-=C,D=0,
S=3+(7&(v>>>=C)),v>>>=3,y-=3}else{for(P=C+7;y<P;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}y-=C,D=0,S=11+(127&(v>>>=C)),v>>>=7,y-=7}if(n.have+S>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=u;break}for(;S--;)n.lens[n.have++]=D}}
if(n.mode===u)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=u;break}if(n.lenbits=9,O={bits:n.lenbits},L=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,O),n.lenbits=O.bits,L){e.msg="invalid literal/lengths set",n.mode=u;break}
if(n.distbits=6,n.distcode=n.distdyn,O={bits:n.distbits},L=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,O),n.distbits=O.bits,L){e.msg="invalid distances set",n.mode=u;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&_>=258){
e.next_out=m,e.avail_out=_,e.next_in=f,e.avail_in=g,n.hold=v,n.bits=y,s(e,w),m=e.next_out,p=e.output,_=e.avail_out,f=e.next_in,d=e.input,g=e.avail_in,v=n.hold,y=n.bits,n.mode===c&&(n.back=-1);break}
for(n.back=0;M=(F=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,I=65535&F,!((C=F>>>24)<=y);){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(M&&!(240&M)){for(R=C,k=M,N=I;M=(F=n.lencode[N+((v&(1<<R+k)-1)>>R)])>>>16&255,I=65535&F,!(R+(C=F>>>24)<=y);){
if(0===g)break e;g--,v+=d[f++]<<y,y+=8}v>>>=R,y-=R,n.back+=R}if(v>>>=C,y-=C,n.back+=C,n.length=I,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=c;break}if(64&M){e.msg="invalid literal/length code",n.mode=u;break}n.extra=15&M,n.mode=22;case 22:
if(n.extra){for(P=n.extra;y<P;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(F=n.distcode[v&(1<<n.distbits)-1])>>>16&255,I=65535&F,
!((C=F>>>24)<=y);){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(!(240&M)){for(R=C,k=M,N=I;M=(F=n.distcode[N+((v&(1<<R+k)-1)>>R)])>>>16&255,I=65535&F,!(R+(C=F>>>24)<=y);){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}v>>>=R,y-=R,n.back+=R}if(v>>>=C,y-=C,
n.back+=C,64&M){e.msg="invalid distance code",n.mode=u;break}n.offset=I,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(P=n.extra;y<P;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}
if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=u;break}n.mode=25;case 25:if(0===_)break e;if(S=w-_,n.offset>S){if((S=n.offset-S)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=u;break}S>n.wnext?(S-=n.wnext,
T=n.wsize-S):T=n.wnext-S,S>n.length&&(S=n.length),A=n.window}else A=p,T=m-n.offset,S=n.length;S>_&&(S=_),_-=S,n.length-=S;do{p[m++]=A[T++]}while(--S);0===n.length&&(n.mode=21);break;case 26:if(0===_)break e;p[m++]=n.length,_--,n.mode=21;break
;case 27:if(n.wrap){for(;y<32;){if(0===g)break e;g--,v|=d[f++]<<y,y+=8}if(w-=_,e.total_out+=w,n.total+=w,w&&(e.adler=n.check=n.flags?a(n.check,p,w,m-w):i(n.check,p,w,m-w)),w=_,(n.flags?v:h(v))!==n.check){e.msg="incorrect data check",n.mode=u;break}
v=0,y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;y<32;){if(0===g)break e;g--,v+=d[f++]<<y,y+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=u;break}v=0,y=0}n.mode=29;case 29:L=1;break e;case u:L=-3;break e;case 31:return-4
;default:return l}return e.next_out=m,e.avail_out=_,e.next_in=f,e.avail_in=g,n.hold=v,n.bits=y,(n.wsize||w!==e.avail_out&&n.mode<u&&(n.mode<27||4!==t))&&x(e,e.output,e.next_out,w-e.avail_out)?(n.mode=31,-4):(E-=e.avail_in,w-=e.avail_out,
e.total_in+=E,e.total_out+=w,n.total+=w,n.wrap&&w&&(e.adler=n.check=n.flags?a(n.check,p,w,e.next_out-w):i(n.check,p,w,e.next_out-w)),e.data_type=n.bits+(n.last?64:0)+(n.mode===c?128:0)+(20===n.mode||15===n.mode?256:0),
(0===E&&0===w||4===t)&&0===L&&(L=-5),L)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state&&2&(n=e.state).wrap?(n.head=t,
t.done=!1,0):l},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&i(1,t,r,0)!==n.check?-3:x(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):l},
t.inflateInfo="pako inflate (from Nodeca project)"},1998:(e,t,n)=>{"use strict"
;var r=n(9805),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]
;e.exports=function(e,t,n,l,c,u,h,d){var p,f,m,g,_,v,y,b,x,E=d.bits,w=0,S=0,T=0,A=0,C=0,M=0,I=0,R=0,k=0,N=0,D=null,L=0,O=new r.Buf16(16),P=new r.Buf16(16),F=null,U=0;for(w=0;w<=15;w++)O[w]=0;for(S=0;S<l;S++)O[t[n+S]]++;for(C=E,
A=15;A>=1&&0===O[A];A--);if(C>A&&(C=A),0===A)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(T=1;T<A&&0===O[T];T++);for(C<T&&(C=T),R=1,w=1;w<=15;w++)if(R<<=1,(R-=O[w])<0)return-1;if(R>0&&(0===e||1!==A))return-1;for(P[1]=0,
w=1;w<15;w++)P[w+1]=P[w]+O[w];for(S=0;S<l;S++)0!==t[n+S]&&(h[P[t[n+S]]++]=S);if(0===e?(D=F=h,v=19):1===e?(D=i,L-=257,F=a,U-=257,v=256):(D=s,F=o,v=-1),N=0,S=0,w=T,_=u,M=C,I=0,m=-1,g=(k=1<<C)-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){y=w-I,
h[S]<v?(b=0,x=h[S]):h[S]>v?(b=F[U+h[S]],x=D[L+h[S]]):(b=96,x=0),p=1<<w-I,T=f=1<<M;do{c[_+(N>>I)+(f-=p)]=y<<24|b<<16|x}while(0!==f);for(p=1<<w-1;N&p;)p>>=1;if(0!==p?(N&=p-1,N+=p):N=0,S++,0==--O[w]){if(w===A)break;w=t[n+h[S]]}if(w>C&&(N&g)!==m){
for(0===I&&(I=C),_+=T,R=1<<(M=w-I);M+I<A&&!((R-=O[M+I])<=0);)M++,R<<=1;if(k+=1<<M,1===e&&k>852||2===e&&k>592)return 1;c[m=N&g]=C<<24|M<<16|_-u}}return 0!==N&&(c[_+N]=w-I<<24|64<<16),d.bits=C,0}},4674:e=>{"use strict";e.exports={2:"need dictionary",
1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},3665:(e,t,n)=>{"use strict";var r=n(9805);function i(e){for(var t=e.length;--t>=0;)e[t]=0}
var a=15,s=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576)
;i(u);var h=new Array(60);i(h);var d=new Array(512);i(d);var p=new Array(256);i(p);var f=new Array(29);i(f);var m,g,_,v=new Array(30);function y(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,
this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?d[e]:d[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,n){
e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){w(e,n[2*t],n[2*t+1])}function T(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0)
;return n>>>1}function A(e,t,n){var r,i,s=new Array(16),o=0;for(r=1;r<=a;r++)s[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var l=e[2*i+1];0!==l&&(e[2*i]=T(s[l]++,l))}}function C(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0
;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){e.bi_valid>8?E(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,n,r){
var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function R(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}
function k(e,t,n){var r,i,a,l,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===r?S(e,i,t):(S(e,(a=p[i])+256+1,t),0!==(l=s[a])&&w(e,i-=f[a],l),S(e,a=x(--r),n),
0!==(l=o[a])&&w(e,r-=v[a],l))}while(c<e.last_lit);S(e,256,t)}function N(e,t){var n,r,i,s=t.dyn_tree,o=t.stat_desc.static_tree,l=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,
n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,l&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)R(e,s,n);i=c;do{
n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],R(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,R(e,s,1)
}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,s,o,l,c=t.dyn_tree,u=t.max_code,h=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0
;for(s=0;s<=a;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=c[2*c[2*(r=e.heap[n])+1]+1]+1)>m&&(s=m,g++),c[2*r+1]=s,r>u||(e.bl_count[s]++,o=0,r>=f&&(o=p[r-f]),l=c[2*r],e.opt_len+=l*(s+o),
d&&(e.static_len+=l*(h[2*r+1]+o)));if(0!==g){do{for(s=m-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[m]--,g-=2}while(g>0)
;for(s=m;0!==s;s--)for(r=e.bl_count[s];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),r--)}}(e,t),A(s,u,e.bl_count)}function D(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(n+1)+1]=65535,
r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++o<l&&i===s||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4))}function L(e,t,n){
var r,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(o<c)do{S(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),o--),S(e,16,e.bl_tree),w(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),
w(e,o-3,3)):(S(e,18,e.bl_tree),w(e,o-11,7));o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4)}}i(v);var O=!1;function P(e,t,n,i){w(e,0+(i?1:0),3),function(e,t,n){M(e),E(e,n),E(e,~n),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n
}(e,t,n)}t._tr_init=function(e){O||(function(){var e,t,n,r,i,c=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,e=0;e<1<<s[r];e++)p[n++]=r;for(p[n-1]=r,i=0,r=0;r<16;r++)for(v[r]=i,e=0;e<1<<o[r];e++)d[i++]=r;for(i>>=7;r<30;r++)for(v[r]=i<<7,
e=0;e<1<<o[r]-7;e++)d[256+i++]=r;for(t=0;t<=a;t++)c[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,c[8]++;for(;e<=255;)u[2*e+1]=9,e++,c[9]++;for(;e<=279;)u[2*e+1]=7,e++,c[7]++;for(;e<=287;)u[2*e+1]=8,e++,c[8]++;for(A(u,287,c),e=0;e<30;e++)h[2*e+1]=5,
h[2*e]=T(e,5);m=new y(u,s,257,286,a),g=new y(h,o,0,30,a),_=new y(new Array(0),l,0,19,7)}(),O=!0),e.l_desc=new b(e.dyn_ltree,m),e.d_desc=new b(e.dyn_dtree,g),e.bl_desc=new b(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,C(e)},t._tr_stored_block=P,
t._tr_flush_block=function(e,t,n,r){var i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0
;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),N(e,e.l_desc),N(e,e.d_desc),s=function(e){var t;for(D(e,e.dyn_ltree,e.l_desc.max_code),
D(e,e.dyn_dtree,e.d_desc.max_code),N(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,
n+4<=i&&-1!==t?P(e,t,n,r):4===e.strategy||a===i?(w(e,2+(r?1:0),3),k(e,u,h)):(w(e,4+(r?1:0),3),function(e,t,n,r){var i;for(w(e,t-257,5),w(e,n-1,5),w(e,r-4,4),i=0;i<r;i++)w(e,e.bl_tree[2*c[i]+1],3);L(e,e.dyn_ltree,t-1),L(e,e.dyn_dtree,n-1)
}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),k(e,e.dyn_ltree,e.dyn_dtree)),C(e),r&&M(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,
e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(p[n]+256+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){w(e,2,3),S(e,256,u),function(e){
16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},4442:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,
this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},5606:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}
function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){
return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o,l=[],c=!1,u=-1;function h(){c&&o&&(c=!1,o.length?l=o.concat(l):u=-1,
l.length&&d())}function d(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(o=l,l=[];++u<t;)o&&o[u].run();u=-1,t=l.length}o=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,
clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1)
;if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",
r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){
throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},2551:(e,t,n)=>{"use strict";var r=n(6540),i=n(9982);function a(e){
for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])
;return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,
e=0;e<t.length;e++)s.add(t[e])}
var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={}
;function m(e,t,n,r,i,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={}
;"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),
[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){
g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),
"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){
g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),
["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}
function y(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){
case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:
return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))
}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,
r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}
"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){
var t=e.replace(_,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),
["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),
g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}))
;var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),E=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),C=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),N=Symbol.for("react.lazy")
;Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function O(e){
return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var P,F=Object.assign;function U(e){if(void 0===P)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}
var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),
"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){
if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o]){
var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}
function G(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return z(e.type,!1);case 11:return z(e.type.render,!1);case 1:return z(e.type,!0)
;default:return""}}function V(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case w:return"Fragment";case E:return"Portal";case T:return"Profiler";case S:
return"StrictMode";case I:return"Suspense";case R:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case M:var t=e.render
;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return V(e(t))}catch(e){}}return null}
function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:
return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:
return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:
if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){
var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){
var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{
configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){
e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){
if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,
checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,
controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=j(t.value),r=t.type
;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value")
;t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){
if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}
""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){
"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0
;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0))
;null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){
var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:j(n)}}function ae(e,t){
var n=j(t.value),r=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent
;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}
function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){
if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild)
;for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild
;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,
columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,
fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0
},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){
var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=F({menuitem:!0},{
area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e))
;if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}
function ye(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1
;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ee=null,we=null,Se=null;function Te(e){if(e=yi(e)){
if("function"!=typeof Ee)throw Error(a(280));var t=e.stateNode;t&&(t=xi(t),Ee(e.stateNode,e.type,t))}}function Ae(e){we?Se?Se.push(e):Se=[e]:we=e}function Ce(){if(we){var e=we,t=Se;if(Se=we=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}
function Me(e,t){return e(t)}function Ie(){}var Re=!1;function ke(e,t,n){if(Re)return e(t,n);Re=!0;try{return Me(e,t,n)}finally{Re=!1,(null!==we||null!==Se)&&(Ie(),Ce())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n)
;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":
case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var De=!1
;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){De=!1}function Oe(e,t,n,r,i,a,s,o,l){
var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Pe=!1,Fe=null,Ue=!1,Be=null,ze={onError:function(e){Pe=!0,Fe=e}};function Ge(e,t,n,r,i,a,s,o,l){Pe=!1,Fe=null,Oe.apply(ze,arguments)}function Ve(e){
var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState
;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function je(e){if(Ve(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){
if(null===(t=Ve(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return je(i),e
;if(s===r)return je(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}
if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?$e(e):null}function $e(e){if(5===e.tag||6===e.tag)return e
;for(e=e.child;null!==e;){var t=$e(e);if(null!==t)return t;e=e.sibling}return null}
var qe=i.unstable_scheduleCallback,Xe=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Ke=i.unstable_requestPaint,Je=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Qe=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null,st=Math.clz32?Math.clz32:function(e){
return 0==(e>>>=0)?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2,ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:
case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e
;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0
;var r=0,i=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~i;0!==o?r=ht(o):0!=(a&=s)&&(r=ht(a))}else 0!=(s=n&~i)?r=ht(s):0!==a&&(r=ht(a));if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&4194240&a))return t
;if(!!(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:
case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}
function mt(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}
function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var yt=0;function bt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}
var xt,Et,wt,St,Tt,At=!1,Ct=[],Mt=null,It=null,Rt=null,kt=new Map,Nt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ")
;function Ot(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":
case"lostpointercapture":Nt.delete(t.pointerId)}}function Pt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&null!==(t=yi(t))&&Et(t),
e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ft(e){var t=vi(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,
void Tt(e.priority,(function(){wt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1
;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yi(n))&&Et(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),
be=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function zt(){At=!1,null!==Mt&&Ut(Mt)&&(Mt=null),null!==It&&Ut(It)&&(It=null),null!==Rt&&Ut(Rt)&&(Rt=null),kt.forEach(Bt),Nt.forEach(Bt)}function Gt(e,t){
e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,zt)))}function Vt(e){function t(t){return Gt(t,e)}if(0<Ct.length){Gt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n]
;r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Mt&&Gt(Mt,e),null!==It&&Gt(It,e),null!==Rt&&Gt(Rt,e),kt.forEach(t),Nt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ft(n),
null===n.blockedOn&&Dt.shift()}var Ht=b.ReactCurrentBatchConfig,jt=!0;function Wt(e,t,n,r){var i=yt,a=Ht.transition;Ht.transition=null;try{yt=1,qt(e,t,n,r)}finally{yt=i,Ht.transition=a}}function $t(e,t,n,r){var i=yt,a=Ht.transition;Ht.transition=null
;try{yt=4,qt(e,t,n,r)}finally{yt=i,Ht.transition=a}}function qt(e,t,n,r){if(jt){var i=Yt(e,t,n,r);if(null===i)jr(e,t,r,Xt,n),Ot(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Mt=Pt(Mt,e,t,n,r,i),!0;case"dragenter":
return It=Pt(It,e,t,n,r,i),!0;case"mouseover":return Rt=Pt(Rt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return kt.set(a,Pt(kt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Nt.set(a,Pt(Nt.get(a)||null,e,t,n,r,i)),!0}
return!1}(i,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var a=yi(i);if(null!==a&&xt(a),null===(a=Yt(e,t,n,r))&&jr(e,t,r,Xt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else jr(e,t,r,null,n)}}var Xt=null
;function Yt(e,t,n,r){if(Xt=null,null!==(e=vi(e=xe(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){
if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":
case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":
case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":
case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":
case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":
case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,Qt=null;function en(){
if(Qt)return Qt;var e,t,n=Zt,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return Qt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode
;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,
this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}
return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){
var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,
timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),hn=F({},cn,{view:0,detail:0}),dn=an(hn),pn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,
getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){
return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),fn=an(pn),mn=an(F({},pn,{dataTransfer:0
})),gn=an(F({},hn,{relatedTarget:0})),_n=an(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(vn),bn=an(F({},cn,{data:0})),xn={
Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",
13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",
115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent
;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Tn(){return Sn}var An=F({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}
return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?En[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,
charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}
}),Cn=an(An),Mn=an(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=an(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,
getModifierState:Tn})),Rn=an(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=F({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){
return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=an(kn),Dn=[9,13,27,32],Ln=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode)
;var Pn=u&&"TextEvent"in window&&!On,Fn=u&&(!Ln||On&&8<On&&11>=On),Un=String.fromCharCode(32),Bn=!1;function zn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":
case"focusout":return!0;default:return!1}}function Gn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1,Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,
text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ae(r),0<(t=$r(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({
event:n,listeners:t}))}var $n=null,qn=null;function Xn(e){Ur(e,0)}function Yn(e){if(q(bi(e)))return e}function Kn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Zn;if(u){var Qn="oninput"in document;if(!Qn){var er=document.createElement("div")
;er.setAttribute("oninput","return;"),Qn="function"==typeof er.oninput}Zn=Qn}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){$n&&($n.detachEvent("onpropertychange",nr),qn=$n=null)}function nr(e){
if("value"===e.propertyName&&Yn(qn)){var t=[];Wn(t,qn,e,xe(e)),ke(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,($n=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){
if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(qn)}function ar(e,t){if("click"===e)return Yn(t)}function sr(e,t){if("input"===e||"change"===e)return Yn(t)}var or="function"==typeof Object.is?Object.is:function(e,t){
return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(or(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){
var i=n[r];if(!h.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e}
;e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){
return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){
for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase()
;return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange
;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,
n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,
r=a,a=i),i=ur(n,a);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),
e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),
n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,_r=null,vr=null,yr=!1;function br(e,t,n){
var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==X(r)||(r="selectionStart"in(r=gr)&&pr(r)?{start:r.selectionStart,end:r.selectionEnd}:{
anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,
0<(r=$r(_r,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Er={
animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},wr={},Sr={};function Tr(e){if(wr[e])return wr[e]
;if(!Er[e])return e;var t,n=Er[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return wr[e]=n[t];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,
delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition)
;var Ar=Tr("animationend"),Cr=Tr("animationiteration"),Mr=Tr("animationstart"),Ir=Tr("transitionend"),Rr=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ")
;function Nr(e,t){Rr.set(e,t),l(t,[e])}for(var Dr=0;Dr<kr.length;Dr++){var Lr=kr[Dr];Nr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Nr(Ar,"onAnimationEnd"),Nr(Cr,"onAnimationIteration"),Nr(Mr,"onAnimationStart"),
Nr("dblclick","onDoubleClick"),Nr("focusin","onFocus"),Nr("focusout","onBlur"),Nr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),
c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),
l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),
l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),
l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "))
;var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or))
;function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,o,l,c){if(Ge.apply(this,arguments),Pe){if(!Pe)throw Error(a(198));var u=Fe;Pe=!1,Fe=null,Ue||(Ue=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){
t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&i.isPropagationStopped())break e;Fr(i,o,c),a=l
}else for(s=0;s<r.length;s++){if(l=(o=r[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&i.isPropagationStopped())break e;Fr(i,o,c),a=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Br(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble"
;n.has(r)||(Hr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Gr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Gr]){e[Gr]=!0,s.forEach((function(t){"selectionchange"!==t&&(Pr.has(t)||zr(t,!1,e),
zr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gr]||(t[Gr]=!0,zr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Kt(t)){case 1:var i=Wt;break;case 4:i=$t;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,
!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function jr(e,t,n,r,i){
var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag
;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==o;){if(null===(s=vi(o)))return;if(5===(l=s.tag)||6===l){r=a=s;continue e}o=o.parentNode}}r=r.return}ke((function(){
var r=a,i=xe(n),s=[];e:{var o=Rr.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":
case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":
case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ar:case Cr:case Mr:l=_n;break;case Ir:l=Rn;break;case"scroll":l=dn;break
;case"wheel":l=Nn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mn}
var u=!!(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Ne(f,d))&&u.push(Wr(f,m,p))),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,i),
s.push({event:o,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,
(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!vi(c)&&!c[fi])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,
null!==(c=(c=n.relatedTarget||n.toElement)?vi(c):null)&&(c!==(h=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Mn,m="onPointerLeave",
d="onPointerEnter",f="pointer"),h=null==l?o:bi(l),p=null==c?o:bi(c),(o=new u(m,f+"leave",l,n,i)).target=h,o.relatedTarget=p,m=null,vi(i)===r&&((u=new u(d,f+"enter",c,n,i)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=qr(p))f++
;for(p=0,m=d;m;m=qr(m))p++;for(;0<f-p;)u=qr(u),f--;for(;0<p-f;)d=qr(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=qr(u),d=qr(d)}u=null}else u=null;null!==l&&Xr(s,o,l,u,!1),null!==c&&null!==h&&Xr(s,h,c,u,!0)}
if("select"===(l=(o=r?bi(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Kn;else if(jn(o))if(Jn)g=sr;else{g=ir;var _=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=ar)
;switch(g&&(g=g(e,r))?Wn(s,g,n,i):(_&&_(e,o,r),"focusout"===e&&(_=o._wrapperState)&&_.controlled&&"number"===o.type&&ee(o,"number",o.value)),_=r?bi(r):window,e){case"focusin":(jn(_)||"true"===_.contentEditable)&&(gr=_,_r=r,vr=null);break
;case"focusout":vr=_r=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,br(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(s,n,i)}var v;if(Ln)e:{switch(e){case"compositionstart":
var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Vn?zn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart")
;y&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Vn&&(v=en()):(Zt="value"in(Jt=i)?Jt.value:Jt.textContent,Vn=!0)),0<(_=$r(r,y)).length&&(y=new bn(y,e,null,n,i),s.push({event:y,listeners:_}),
(v||null!==(v=Gn(n)))&&(y.data=v))),(v=Pn?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){
if(Vn)return"compositionend"===e||!Ln&&zn(e,t)?(e=en(),Qt=Zt=Jt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char
;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=$r(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),
i.data=v)}Ur(s,t)}))}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function $r(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Ne(e,n))&&r.unshift(Wr(e,a,i)),
null!=(a=Ne(e,t))&&r.push(Wr(e,a,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode
;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=Ne(n,a))&&s.unshift(Wr(n,l,o)):i||null!=(l=Ne(n,a))&&s.push(Wr(n,l,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Yr=/\r\n?/g,Kr=/\u0000|\uFFFD/g;function Jr(e){
return("string"==typeof e?e:""+e).replace(Yr,"\n").replace(Kr,"")}function Zr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function Qr(){}var ei=null,ti=null;function ni(e,t){
return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}
var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,ai="function"==typeof Promise?Promise:void 0,si="function"==typeof queueMicrotask?queueMicrotask:void 0!==ai?function(e){
return ai.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t)
;r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){
e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}
var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,pi="__reactProps$"+hi,fi="__reactContainer$"+hi,mi="__reactEvents$"+hi,gi="__reactListeners$"+hi,_i="__reactHandles$"+hi;function vi(e){var t=e[di];if(t)return t
;for(var n=e.parentNode;n;){if(t=n[fi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[di])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function yi(e){
return!(e=e[di]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function xi(e){return e[pi]||null}var Ei=[],wi=-1;function Si(e){return{current:e}}
function Ti(e){0>wi||(e.current=Ei[wi],Ei[wi]=null,wi--)}function Ai(e,t){wi++,Ei[wi]=e.current,e.current=t}var Ci={},Mi=Si(Ci),Ii=Si(!1),Ri=Ci;function ki(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode
;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,
e.__reactInternalMemoizedMaskedChildContext=a),a}function Ni(e){return null!=e.childContextTypes}function Di(){Ti(Ii),Ti(Mi)}function Li(e,t,n){if(Mi.current!==Ci)throw Error(a(168));Ai(Mi,t),Ai(Ii,n)}function Oi(e,t,n){var r=e.stateNode
;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,H(e)||"Unknown",i));return F({},n,r)}function Pi(e){
return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Ri=Mi.current,Ai(Mi,e),Ai(Ii,Ii.current),!0}function Fi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Oi(e,t,Ri),r.__reactInternalMemoizedMergedChildContext=e,Ti(Ii),
Ti(Mi),Ai(Mi,e)):Ti(Ii),Ai(Ii,n)}var Ui=null,Bi=!1,zi=!1;function Gi(e){null===Ui?Ui=[e]:Ui.push(e)}function Vi(){if(!zi&&null!==Ui){zi=!0;var e=0,t=yt;try{var n=Ui;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Bi=!1
}catch(t){throw null!==Ui&&(Ui=Ui.slice(e+1)),qe(Qe,Vi),t}finally{yt=t,zi=!1}}return null}var Hi=b.ReactCurrentBatchConfig;function ji(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}
var Wi=Si(null),$i=null,qi=null,Xi=null;function Yi(){Xi=qi=$i=null}function Ki(e){var t=Wi.current;Ti(Wi),e._currentValue=t}function Ji(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,
null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Zi(e,t){$i=e,Xi=qi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(Eo=!0),e.firstContext=null)}function Qi(e){
var t=e._currentValue;if(Xi!==e)if(e={context:e,memoizedValue:t,next:null},null===qi){if(null===$i)throw Error(a(308));qi=e,$i.dependencies={lanes:0,firstContext:e}}else qi=qi.next=e;return t}var ea=null,ta=!1;function na(e){e.updateQueue={
baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ra(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,
firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ia(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function aa(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,
nc(e)?(null===(e=n.interleaved)?(t.next=t,null===ea?ea=[n]:ea.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function sa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,
4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function oa(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,
tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},
void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function la(e,t,n,r){var i=e.updateQueue;ta=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null
;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&(o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l)}if(null!==a){var h=i.baseState;for(s=0,u=c=l=null,o=a;;){
var d=o.lane,p=o.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(d=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f
;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,h,d):f))break e;h=F({},h,d);break e;case 2:ta=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[o]:d.push(o))
}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(d=o).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}
if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Ll|=s,e.lanes=s,e.memoizedState=h}}function ca(e,t,n){if(e=t.effects,
t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var ua=(new r.Component).refs;function ha(e,t,n,r){
n=null==(n=n(r,t=e.memoizedState))?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var da={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals
;var r=Zl(),i=Ql(e),a=ia(r,i);a.payload=t,null!=n&&(a.callback=n),aa(e,a),null!==(t=ec(e,i,r))&&sa(t,e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zl(),i=Ql(e),a=ia(r,i);a.tag=1,a.payload=t,null!=n&&(a.callback=n),aa(e,a),
null!==(t=ec(e,i,r))&&sa(t,e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zl(),r=Ql(e),i=ia(n,r);i.tag=2,null!=t&&(i.callback=t),aa(e,i),null!==(t=ec(e,r,n))&&sa(t,e,r)}};function pa(e,t,n,r,i,a,s){
return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!(t.prototype&&t.prototype.isPureReactComponent&&lr(n,r)&&lr(i,a))}function fa(e,t,n){var r=!1,i=Ci,a=t.contextType
;return"object"==typeof a&&null!==a?a=Qi(a):(i=Ni(t)?Ri:Mi.current,a=(r=null!=(r=t.contextTypes))?ki(e,i):Ci),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=da,e.stateNode=t,t._reactInternals=e,
r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ma(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),
"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&da.enqueueReplaceState(t,t.state,null)}function ga(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ua,na(e)
;var a=t.contextType;"object"==typeof a&&null!==a?i.context=Qi(a):(a=Ni(t)?Ri:Mi.current,i.context=ki(e,a)),i.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(ha(e,t,a,n),i.state=e.memoizedState),
"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,
"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&da.enqueueReplaceState(i,i.state,null),la(e,n,i,r),i.state=e.memoizedState),
"function"==typeof i.componentDidMount&&(e.flags|=4194308)}var _a=[],va=0,ya=null,ba=0,xa=[],Ea=0,wa=null,Sa=1,Ta="";function Aa(e,t){_a[va++]=ba,_a[va++]=ya,ya=e,ba=t}function Ca(e,t,n){xa[Ea++]=Sa,xa[Ea++]=Ta,xa[Ea++]=wa,wa=e;var r=Sa;e=Ta
;var i=32-st(r)-1;r&=~(1<<i),n+=1;var a=32-st(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Sa=1<<32-st(t)+i|n<<i|r,Ta=a+e}else Sa=1<<a|n<<i|r,Ta=e}function Ma(e){null!==e.return&&(Aa(e,1),Ca(e,1,0))}function Ia(e){
for(;e===ya;)ya=_a[--va],_a[va]=null,ba=_a[--va],_a[va]=null;for(;e===wa;)wa=xa[--Ea],xa[Ea]=null,Ta=xa[--Ea],xa[Ea]=null,Sa=xa[--Ea],xa[Ea]=null}var Ra=null,ka=null,Na=!1,Da=null;function La(e,t){var n=kc(5,null,null,0);n.elementType="DELETED",
n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Oa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,Ra=e,
ka=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,Ra=e,ka=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==wa?{id:Sa,overflow:Ta}:null,e.memoizedState={dehydrated:t,
treeContext:n,retryLane:1073741824},(n=kc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Ra=e,ka=null,!0);default:return!1}}function Pa(e){return!(!(1&e.mode)||128&e.flags)}function Fa(e){if(Na){var t=ka;if(t){var n=t;if(!Oa(e,t)){
if(Pa(e))throw Error(a(418));t=ci(n.nextSibling);var r=Ra;t&&Oa(e,t)?La(r,n):(e.flags=-4097&e.flags|2,Na=!1,Ra=e)}}else{if(Pa(e))throw Error(a(418));e.flags=-4097&e.flags|2,Na=!1,Ra=e}}}function Ua(e){
for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ra=e}function Ba(e){if(e!==Ra)return!1;if(!Na)return Ua(e),Na=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),
t&&(t=ka)){if(Pa(e)){for(e=ka;e;)e=ci(e.nextSibling);throw Error(a(418))}for(;t;)La(e,t),t=ci(t.nextSibling)}if(Ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){
if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ka=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ka=null}}else ka=Ra?ci(e.stateNode.nextSibling):null;return!0}function za(){ka=Ra=null,Na=!1}function Ga(e){
null===Da?Da=[e]:Da.push(e)}function Va(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e
;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===ua&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(a(284))
;if(!n._owner)throw Error(a(290,e))}return e}function Ha(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ja(e){return(0,e._init)(e._payload)}
function Wa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){
for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,
n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type
;return a===w?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===N&&ja(a)===t.type)?((r=i(t,n.props)).ref=Va(e,t,n),r.return=e,r):((r=Lc(n.type,n.key,n.props,null,e.mode,r)).ref=Va(e,t,n),
r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){
return null===t||7!==t.tag?((t=Oc(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){
case x:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=Va(e,null,t),n.return=e,n;case E:return(t=Uc(t,e.mode,n)).return=e,t;case N:return d(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Ha(e,t)}return null}
function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case E:
return n.key===i?u(e,t,n,r):null;case N:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||O(n))return null!==i?null:h(e,t,n,r,null);Ha(e,n)}return null}function f(e,t,n,r,i){
if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case E:
return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case N:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||O(r))return h(t,e=e.get(n)||null,r,i,null);Ha(t,r)}return null}function m(i,a,o,l){
for(var c=null,u=null,h=a,m=a=0,g=null;null!==h&&m<o.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var _=p(i,h,o[m],l);if(null===_){null===h&&(h=g);break}e&&h&&null===_.alternate&&t(i,h),a=s(_,a,m),null===u?c=_:u.sibling=_,u=_,h=g}
if(m===o.length)return n(i,h),Na&&Aa(i,m),c;if(null===h){for(;m<o.length;m++)null!==(h=d(i,o[m],l))&&(a=s(h,a,m),null===u?c=h:u.sibling=h,u=h);return Na&&Aa(i,m),c}
for(h=r(i,h);m<o.length;m++)null!==(g=f(h,i,m,o[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=s(g,a,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(i,e)})),Na&&Aa(i,m),c}function g(i,o,l,c){var u=O(l)
;if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,m=o,g=o=0,_=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var y=p(i,m,v.value,c);if(null===y){
null===m&&(m=_);break}e&&m&&null===y.alternate&&t(i,m),o=s(y,o,g),null===h?u=y:h.sibling=y,h=y,m=_}if(v.done)return n(i,m),Na&&Aa(i,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(i,v.value,c))&&(o=s(v,o,g),null===h?u=v:h.sibling=v,h=v)
;return Na&&Aa(i,g),u}for(m=r(i,m);!v.done;g++,v=l.next())null!==(v=f(m,i,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),o=s(v,o,g),null===h?u=v:h.sibling=v,h=v);return e&&m.forEach((function(e){return t(i,e)})),Na&&Aa(i,g),u}
return function e(r,a,s,l){if("object"==typeof s&&null!==s&&s.type===w&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=a;null!==u;){if(u.key===c){if((c=s.type)===w){if(7===u.tag){
n(r,u.sibling),(a=i(u,s.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===N&&ja(c)===u.type){n(r,u.sibling),(a=i(u,s.props)).ref=Va(r,u,s),a.return=r,r=a;break e}n(r,u);break}t(r,u),
u=u.sibling}s.type===w?((a=Oc(s.props.children,r.mode,l,s.key)).return=r,r=a):((l=Lc(s.type,s.key,s.props,null,r.mode,l)).ref=Va(r,a,s),l.return=r,r=l)}return o(r);case E:e:{for(u=s.key;null!==a;){if(a.key===u){
if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=i(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Uc(s,r.mode,l)).return=r,r=a}return o(r);case N:
return e(r,a,(u=s._init)(s._payload),l)}if(te(s))return m(r,a,s,l);if(O(s))return g(r,a,s,l);Ha(r,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,s)).return=r,r=a):(n(r,a),
(a=Fc(s,r.mode,l)).return=r,r=a),o(r)):n(r,a)}}var $a=Wa(!0),qa=Wa(!1),Xa={},Ya=Si(Xa),Ka=Si(Xa),Ja=Si(Xa);function Za(e){if(e===Xa)throw Error(a(174));return e}function Qa(e,t){switch(Ai(Ja,t),Ai(Ka,e),Ai(Ya,Xa),e=t.nodeType){case 9:case 11:
t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ti(Ya),Ai(Ya,t)}function es(){Ti(Ya),Ti(Ka),Ti(Ja)}function ts(e){Za(Ja.current);var t=Za(Ya.current),n=le(t,e.type)
;t!==n&&(Ai(Ka,e),Ai(Ya,n))}function ns(e){Ka.current===e&&(Ti(Ya),Ti(Ka))}var rs=Si(0);function is(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t
}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}
t.sibling.return=t.return,t=t.sibling}return null}var as=[];function ss(){for(var e=0;e<as.length;e++)as[e]._workInProgressVersionPrimary=null;as.length=0}
var os=b.ReactCurrentDispatcher,ls=b.ReactCurrentBatchConfig,cs=0,us=null,hs=null,ds=null,ps=!1,fs=!1,ms=0,gs=0;function _s(){throw Error(a(321))}function vs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1
;return!0}function ys(e,t,n,r,i,s){if(cs=s,us=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,os.current=null===e||null===e.memoizedState?no:ro,e=n(r,i),fs){s=0;do{if(fs=!1,ms=0,25<=s)throw Error(a(301));s+=1,ds=hs=null,t.updateQueue=null,
os.current=io,e=n(r,i)}while(fs)}if(os.current=to,t=null!==hs&&null!==hs.next,cs=0,ds=hs=us=null,ps=!1,t)throw Error(a(300));return e}function bs(){var e=0!==ms;return ms=0,e}function xs(){var e={memoizedState:null,baseState:null,baseQueue:null,
queue:null,next:null};return null===ds?us.memoizedState=ds=e:ds=ds.next=e,ds}function Es(){if(null===hs){var e=us.alternate;e=null!==e?e.memoizedState:null}else e=hs.next;var t=null===ds?us.memoizedState:ds.next;if(null!==t)ds=t,hs=e;else{
if(null===e)throw Error(a(310));e={memoizedState:(hs=e).memoizedState,baseState:hs.baseState,baseQueue:hs.baseQueue,queue:hs.queue,next:null},null===ds?us.memoizedState=ds=e:ds=ds.next=e}return ds}function ws(e,t){return"function"==typeof t?t(e):t}
function Ss(e){var t=Es(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=hs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,
r=r.baseState;var l=o=null,c=null,u=s;do{var h=u.lane;if((cs&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,
action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,us.lanes|=h,Ll|=h}u=u.next}while(null!==u&&u!==s);null===c?o=r:c.next=l,or(r,t.memoizedState)||(Eo=!0),t.memoizedState=r,t.baseState=o,
t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,us.lanes|=s,Ll|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ts(e){var t=Es(),n=t.queue;if(null===n)throw Error(a(311))
;n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);or(s,t.memoizedState)||(Eo=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),
n.lastRenderedState=s}return[s,r]}function As(){}function Cs(e,t){var n=us,r=Es(),i=t(),s=!or(r.memoizedState,i);if(s&&(r.memoizedState=i,Eo=!0),r=r.queue,Us(Rs.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ds&&1&ds.memoizedState.tag){
if(n.flags|=2048,Ds(9,Is.bind(null,n,r,i,t),void 0,null),null===Cl)throw Error(a(349));30&cs||Ms(n,t,i)}return i}function Ms(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=us.updateQueue)?(t={lastEffect:null,stores:null},us.updateQueue=t,
t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Is(e,t,n,r){t.value=n,t.getSnapshot=r,ks(t)&&ec(e,1,-1)}function Rs(e,t,n){return n((function(){ks(t)&&ec(e,1,-1)}))}function ks(e){var t=e.getSnapshot;e=e.value;try{var n=t()
;return!or(e,n)}catch(e){return!0}}function Ns(e){var t=xs();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ws,lastRenderedState:e},t.queue=e,
e=e.dispatch=Ks.bind(null,us,e),[t.memoizedState,e]}function Ds(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=us.updateQueue)?(t={lastEffect:null,stores:null},us.updateQueue=t,
t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ls(){return Es().memoizedState}function Os(e,t,n,r){var i=xs();us.flags|=e,i.memoizedState=Ds(1|t,n,void 0,void 0===r?null:r)}
function Ps(e,t,n,r){var i=Es();r=void 0===r?null:r;var a=void 0;if(null!==hs){var s=hs.memoizedState;if(a=s.destroy,null!==r&&vs(r,s.deps))return void(i.memoizedState=Ds(t,n,a,r))}us.flags|=e,i.memoizedState=Ds(1|t,n,a,r)}function Fs(e,t){
return Os(8390656,8,e,t)}function Us(e,t){return Ps(2048,8,e,t)}function Bs(e,t){return Ps(4,2,e,t)}function zs(e,t){return Ps(4,4,e,t)}function Gs(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,
function(){t.current=null}):void 0}function Vs(e,t,n){return n=null!=n?n.concat([e]):null,Ps(4,4,Gs.bind(null,t,e),n)}function Hs(){}function js(e,t){var n=Es();t=void 0===t?null:t;var r=n.memoizedState
;return null!==r&&null!==t&&vs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ws(e,t){var n=Es();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&vs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function $s(e,t,n){
return 21&cs?(or(n,t)||(n=mt(),us.lanes|=n,Ll|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Eo=!0),e.memoizedState=n)}function qs(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=ls.transition;ls.transition={};try{e(!1),t()}finally{yt=n,
ls.transition=r}}function Xs(){return Es().memoizedState}function Ys(e,t,n){var r=Ql(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Js(e)?Zs(t,n):(Qs(e,t,n),null!==(e=ec(e,r,n=Zl()))&&eo(e,t,r))}function Ks(e,t,n){var r=Ql(e),i={
lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Js(e))Zs(t,i);else{Qs(e,t,i);var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,
i.eagerState=o,or(o,s))return}catch(e){}null!==(e=ec(e,r,n=Zl()))&&eo(e,t,r)}}function Js(e){var t=e.alternate;return e===us||null!==t&&t===us}function Zs(e,t){fs=ps=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}
function Qs(e,t,n){nc(e)?(null===(e=t.interleaved)?(n.next=n,null===ea?ea=[t]:ea.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function eo(e,t,n){if(4194240&n){var r=t.lanes
;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var to={readContext:Qi,useCallback:_s,useContext:_s,useEffect:_s,useImperativeHandle:_s,useInsertionEffect:_s,useLayoutEffect:_s,useMemo:_s,useReducer:_s,useRef:_s,useState:_s,useDebugValue:_s,
useDeferredValue:_s,useTransition:_s,useMutableSource:_s,useSyncExternalStore:_s,useId:_s,unstable_isNewReconciler:!1},no={readContext:Qi,useCallback:function(e,t){return xs().memoizedState=[e,void 0===t?null:t],e},useContext:Qi,useEffect:Fs,
useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Os(4194308,4,Gs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Os(4194308,4,e,t)},useInsertionEffect:function(e,t){return Os(4,2,e,t)},useMemo:function(e,t){var n=xs()
;return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=xs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t
},r.queue=e,e=e.dispatch=Ys.bind(null,us,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},xs().memoizedState=e},useState:Ns,useDebugValue:Hs,useDeferredValue:function(e){return xs().memoizedState=e},useTransition:function(){
var e=Ns(!1),t=e[0];return e=qs.bind(null,e[1]),xs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=us,i=xs();if(Na){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Cl)throw Error(a(349))
;30&cs||Ms(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Fs(Rs.bind(null,r,s,e),[e]),r.flags|=2048,Ds(9,Is.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=xs(),t=Cl.identifierPrefix;if(Na){var n=Ta
;t=":"+t+"R"+(n=(Sa&~(1<<32-st(Sa)-1)).toString(32)+n),0<(n=ms++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=gs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ro={readContext:Qi,useCallback:js,useContext:Qi,
useEffect:Us,useImperativeHandle:Vs,useInsertionEffect:Bs,useLayoutEffect:zs,useMemo:Ws,useReducer:Ss,useRef:Ls,useState:function(){return Ss(ws)},useDebugValue:Hs,useDeferredValue:function(e){return $s(Es(),hs.memoizedState,e)},
useTransition:function(){return[Ss(ws)[0],Es().memoizedState]},useMutableSource:As,useSyncExternalStore:Cs,useId:Xs,unstable_isNewReconciler:!1},io={readContext:Qi,useCallback:js,useContext:Qi,useEffect:Us,useImperativeHandle:Vs,
useInsertionEffect:Bs,useLayoutEffect:zs,useMemo:Ws,useReducer:Ts,useRef:Ls,useState:function(){return Ts(ws)},useDebugValue:Hs,useDeferredValue:function(e){var t=Es();return null===hs?t.memoizedState=e:$s(t,hs.memoizedState,e)},
useTransition:function(){return[Ts(ws)[0],Es().memoizedState]},useMutableSource:As,useSyncExternalStore:Cs,useId:Xs,unstable_isNewReconciler:!1};function ao(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var i=n}catch(e){
i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}function so(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var oo,lo,co,uo,ho="function"==typeof WeakMap?WeakMap:Map
;function po(e,t,n){(n=ia(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Hl=r),so(0,t)},n}function fo(e,t,n){(n=ia(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value
;n.payload=function(){return r(i)},n.callback=function(){so(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){so(0,t),"function"!=typeof r&&(null===jl?jl=new Set([this]):jl.add(this))
;var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function mo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),
e=Tc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _o(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,
e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=ia(-1,1)).tag=2,aa(n,t))),n.lanes|=1),e)}function vo(e,t){if(!Na)switch(e.tailMode){case"hidden":t=e.tail
;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling
;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function yo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,
r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function bo(e,t,n){var r=t.pendingProps;switch(Ia(t),t.tag){
case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yo(t),null;case 1:case 17:return Ni(t.type)&&Di(),yo(t),null;case 3:return r=t.stateNode,es(),Ti(Ii),Ti(Mi),ss(),r.pendingContext&&(r.context=r.pendingContext,
r.pendingContext=null),null!==e&&null!==e.child||(Ba(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==Da&&(sc(Da),Da=null))),lo(e,t),yo(t),null;case 5:ns(t);var i=Za(Ja.current);if(n=t.type,
null!==e&&null!=t.stateNode)co(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return yo(t),null}if(e=Za(Ya.current),Ba(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[di]=t,
r[pi]=s,e=!!(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Or.length;i++)Br(Or[i],r);break;case"source":Br("error",r);break;case"img":
case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":K(r,s),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Br("invalid",r);break;case"textarea":ie(r,s),Br("invalid",r)}
for(var l in ve(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),
i=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(n){case"input":$(r),Q(r,s,!0);break
;case"textarea":$(r),se(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=Qr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),
"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,
r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[di]=t,e[pi]=r,oo(e,t,!1,!1),t.stateNode=e;e:{switch(l=ye(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r
;break;case"video":case"audio":for(i=0;i<Or.length;i++)Br(Or[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":K(e,r),
i=Y(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(s in ve(n,i),
c=i)if(c.hasOwnProperty(s)){var u=c[s]
;"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"==typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"==typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Br("scroll",e):null!=u&&y(e,s,u,l))
}switch(n){case"input":$(e),Q(e,r,!1);break;case"textarea":$(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+j(r.value));break;case"select":e.multiple=!!r.multiple,
null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Qr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e
;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return yo(t),null;case 6:if(e&&null!=t.stateNode)uo(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166))
;if(n=Za(Ja.current),Za(Ya.current),Ba(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(s=r.nodeValue!==n)&&null!==(e=Ra))switch(e.tag){case 3:Zr(r.nodeValue,n,!!(1&e.mode));break;case 5:
!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,!!(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return yo(t),null;case 13:if(Ti(rs),r=t.memoizedState,
Na&&null!==ka&&1&t.mode&&!(128&t.flags)){for(r=ka;r;)r=ci(r.nextSibling);return za(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Ba(t),null===e){if(!r)throw Error(a(318))
;if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[di]=t}else za(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return yo(t),null}return null!==Da&&(sc(Da),Da=null),128&t.flags?(t.lanes=n,t):(r=null!==r,n=!1,
null===e?Ba(t):n=null!==e.memoizedState,r!==n&&r&&(t.child.flags|=8192,!!(1&t.mode)&&(null===e||1&rs.current?0===Nl&&(Nl=3):mc())),null!==t.updateQueue&&(t.flags|=4),yo(t),null);case 4:return es(),lo(e,t),null===e&&Vr(t.stateNode.containerInfo),
yo(t),null;case 10:return Ki(t.type._context),yo(t),null;case 19:if(Ti(rs),null===(s=t.memoizedState))return yo(t),null;if(r=!!(128&t.flags),null===(l=s.rendering))if(r)vo(s,!1);else{if(0!==Nl||null!==e&&128&e.flags)for(e=t.child;null!==e;){
if(null!==(l=is(e))){for(t.flags|=128,vo(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,
s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,
s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ai(rs,1&rs.current|2),t.child}e=e.sibling}
null!==s.tail&&Je()>zl&&(t.flags|=128,r=!0,vo(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=is(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),vo(s,!0),
null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!Na)return yo(t),null}else 2*Je()-s.renderingStartTime>zl&&1073741824!==n&&(t.flags|=128,r=!0,vo(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,
t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Je(),t.sibling=null,n=rs.current,Ai(rs,r?1&n|2:1&n),t):(yo(t),null);case 22:case 23:return hc(),
r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Rl)&&(yo(t),6&t.subtreeFlags&&(t.flags|=8192)):yo(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}oo=function(e,t){
for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}
n.sibling.return=n.return,n=n.sibling}},lo=function(){},co=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Za(Ya.current);var a,s=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),s=[];break;case"select":i=F({},i,{value:void 0}),r=F({},r,{
value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Qr)}for(u in ve(n,r),n=null,
i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")
}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,
r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(u,n)),
n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,
l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Br("scroll",e),
s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},uo=function(e,t,n,r){n!==r&&(t.flags|=4)};var xo=b.ReactCurrentOwner,Eo=!1;function wo(e,t,n,r){
t.child=null===e?qa(t,null,n,r):$a(t,e.child,n,r)}function So(e,t,n,r,i){n=n.render;var a=t.ref;return Zi(t,i),r=ys(e,t,n,r,a,i),n=bs(),null===e||Eo?(Na&&n&&Ma(t),t.flags|=1,wo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,
e.lanes&=~i,Wo(e,t,i))}function To(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||Nc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,
t.type=a,Ao(e,t,a,r,i))}if(a=e.child,!(e.lanes&i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Wo(e,t,i)}return t.flags|=1,(e=Dc(a,r)).ref=t.ref,e.return=t,t.child=e}function Ao(e,t,n,r,i){if(null!==e){
var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=r=a,!(e.lanes&i))return t.lanes=e.lanes,Wo(e,t,i);131072&e.flags&&(Eo=!0)}}return Io(e,t,n,r,i)}function Co(e,t,n){
var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},
t.updateQueue=null,Ai(kl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ai(kl,Rl),Rl|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(kl,Rl),
Rl|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ai(kl,Rl),Rl|=r;return wo(e,t,i,n),t.child}function Mo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Io(e,t,n,r,i){
var a=Ni(n)?Ri:Mi.current;return a=ki(t,a),Zi(t,i),n=ys(e,t,n,r,a,i),r=bs(),null===e||Eo?(Na&&r&&Ma(t),t.flags|=1,wo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wo(e,t,i))}function Ro(e,t,n,r,i){if(Ni(n)){var a=!0;Pi(t)
}else a=!1;if(Zi(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),fa(t,n,r),ga(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType
;c="object"==typeof c&&null!==c?Qi(c):ki(t,c=Ni(n)?Ri:Mi.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate
;h||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==r||l!==c)&&ma(t,s,r,c),ta=!1;var d=t.memoizedState;s.state=d,la(t,r,s,i),l=t.memoizedState,
o!==r||d!==l||Ii.current||ta?("function"==typeof u&&(ha(t,n,u,r),l=t.memoizedState),
(o=ta||pa(t,n,o,r,d,l,c))?(h||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),
"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,
s.state=l,s.context=c,r=o):("function"==typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,ra(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:ji(t.type,o),s.props=c,h=t.pendingProps,d=s.context,
l="object"==typeof(l=n.contextType)&&null!==l?Qi(l):ki(t,l=Ni(n)?Ri:Mi.current);var p=n.getDerivedStateFromProps
;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==h||d!==l)&&ma(t,s,r,l),ta=!1,d=t.memoizedState,s.state=d,la(t,r,s,i)
;var f=t.memoizedState;o!==h||d!==f||Ii.current||ta?("function"==typeof p&&(ha(t,n,p,r),f=t.memoizedState),
(c=ta||pa(t,n,c,r,d,f,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),
"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),
"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),
"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,
r=c):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return ko(e,t,n,r,a,i)}
function ko(e,t,n,r,i,a){Mo(e,t);var s=!!(128&t.flags);if(!r&&!s)return i&&Fi(t,n,!1),Wo(e,t,a);r=t.stateNode,xo.current=t;var o=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,
null!==e&&s?(t.child=$a(t,e.child,null,a),t.child=$a(t,null,o,a)):wo(e,t,o,a),t.memoizedState=r.state,i&&Fi(t,n,!0),t.child}function No(e){var t=e.stateNode
;t.pendingContext?Li(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Li(0,t.context,!1),Qa(e,t.containerInfo)}function Do(e,t,n,r,i){return za(),Ga(i),t.flags|=256,wo(e,t,n,r),t.child}var Lo={dehydrated:null,treeContext:null,retryLane:0}
;function Oo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Po(e,t){return{baseLanes:e.baseLanes|t,cachePool:null,transitions:e.transitions}}function Fo(e,t,n){var r,i=t.pendingProps,s=rs.current,o=!1,l=!!(128&t.flags)
;if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ai(rs,1&s),null===e)return Fa(t),
null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},1&i||null===o?o=Pc(s,i,0,null):(o.childLanes=0,
o.pendingProps=s),e=Oc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Oo(n),t.memoizedState=Lo,e):Uo(t,s));if(null!==(s=e.memoizedState)){if(null!==(r=s.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,
Go(e,t,n,Error(a(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,s=t.mode,i=Pc({mode:"visible",children:i.children},s,0,null),(o=Oc(o,s,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,
!!(1&t.mode)&&$a(t,e.child,null,n),t.child.memoizedState=Oo(n),t.memoizedState=Lo,o);if(1&t.mode)if("$!"===r.data)t=Go(e,t,n,Error(a(419)));else if(i=!!(n&e.childLanes),Eo||i){if(null!==(i=Cl)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:
case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break
;case 536870912:o=268435456;break;default:o=0}0!==(i=o&(i.suspendedLanes|n)?0:o)&&i!==s.retryLane&&(s.retryLane=i,ec(e,i,-1))}mc(),t=Go(e,t,n,Error(a(421)))}else"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),r._reactRetry=t,
t=null):(n=s.treeContext,ka=ci(r.nextSibling),Ra=t,Na=!0,Da=null,null!==n&&(xa[Ea++]=Sa,xa[Ea++]=Ta,xa[Ea++]=wa,Sa=n.id,Ta=n.overflow,wa=t),(t=Uo(t,t.pendingProps.children)).flags|=4096);else t=Go(e,t,n,null);return t}
return o?(i=zo(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Oo(n):Po(s,n),o.childLanes=e.childLanes&~n,t.memoizedState=Lo,i):(n=Bo(e,t,i.children,n),t.memoizedState=null,n)}
return o?(i=zo(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Oo(n):Po(s,n),o.childLanes=e.childLanes&~n,t.memoizedState=Lo,i):(n=Bo(e,t,i.children,n),t.memoizedState=null,n)}function Uo(e,t){return(t=Pc({
mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,r){var i=e.child;return e=i.sibling,n=Dc(i,{mode:"visible",children:n}),!(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,
null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function zo(e,t,n,r,i){var a=t.mode,s=(e=e.child).sibling,o={mode:"hidden",children:n}
;return 1&a||t.child===e?(n=Dc(e,o)).subtreeFlags=14680064&e.subtreeFlags:((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null),null!==s?r=Dc(s,r):(r=Oc(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Go(e,t,n,r){
return null!==r&&Ga(r),$a(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ji(e.return,t,n)}function Ho(e,t,n,r,i){var a=e.memoizedState
;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function jo(e,t,n){
var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(wo(e,t,r.children,n),2&(r=rs.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){
if(13===e.tag)null!==e.memoizedState&&Vo(e,n,t);else if(19===e.tag)Vo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}
e.sibling.return=e.return,e=e.sibling}r&=1}if(Ai(rs,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===is(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),
Ho(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===is(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ho(t,!0,n,null,a);break;case"together":Ho(t,!1,null,null,void 0);break;default:
t.memoizedState=null}else t.memoizedState=null;return t.child}function Wo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ll|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){
for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function $o(e,t){switch(Ia(t),t.tag){case 1:return Ni(t.type)&&Di(),
65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return es(),Ti(Ii),Ti(Mi),ss(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ns(t),null;case 13:if(Ti(rs),null!==(e=t.memoizedState)&&null!==e.dehydrated){
if(null===t.alternate)throw Error(a(340));za()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ti(rs),null;case 4:return es(),null;case 10:return Ki(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}
var qo=!1,Xo=!1,Yo="function"==typeof WeakSet?WeakSet:Set,Ko=null;function Jo(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Sc(e,t,n)}else n.current=null}function Zo(e,t,n){try{n()}catch(n){Sc(e,t,n)}}var Qo=!1
;function el(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&Zo(t,n,a)}i=i.next}while(i!==r)}}function tl(e,t){
if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function nl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,
"function"==typeof t?t(e):t.current=e}}function rl(e){var t=e.alternate;null!==t&&(e.alternate=null,rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[di],delete t[pi],delete t[mi],delete t[gi],
delete t[_i]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function il(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){
for(;null===e.sibling;){if(null===e.return||il(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}
if(!(2&e.flags))return e.stateNode}}function sl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),
null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Qr));else if(4!==r&&null!==(e=e.child))for(sl(e,t,n),e=e.sibling;null!==e;)sl(e,t,n),e=e.sibling}function ol(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,
t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ol(e,t,n),e=e.sibling;null!==e;)ol(e,t,n),e=e.sibling}var ll=null,cl=!1;function ul(e,t,n){for(n=n.child;null!==n;)hl(e,t,n),n=n.sibling}function hl(e,t,n){
if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(e){}switch(n.tag){case 5:Xo||Jo(n,t);case 6:var r=ll,i=cl;ll=null,ul(e,t,n),cl=i,null!==(ll=r)&&(cl?(e=ll,n=n.stateNode,
8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ll.removeChild(n.stateNode));break;case 18:null!==ll&&(cl?(e=ll,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Vt(e)):li(ll,n.stateNode));break;case 4:r=ll,i=cl,
ll=n.stateNode.containerInfo,cl=!0,ul(e,t,n),ll=r,cl=i;break;case 0:case 11:case 14:case 15:if(!Xo&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var a=i,s=a.destroy;a=a.tag,void 0!==s&&(!!(2&a)||!!(4&a))&&Zo(n,t,s),i=i.next
}while(i!==r)}ul(e,t,n);break;case 1:if(!Xo&&(Jo(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Sc(n,t,e)}ul(e,t,n);break;case 21:ul(e,t,n);break
;case 22:1&n.mode?(Xo=(r=Xo)||null!==n.memoizedState,ul(e,t,n),Xo=r):ul(e,t,n);break;default:ul(e,t,n)}}function dl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Yo),t.forEach((function(t){
var r=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ll=l.stateNode,cl=!1;break e;case 3:case 4:
ll=l.stateNode.containerInfo,cl=!0;break e}l=l.return}if(null===ll)throw Error(a(160));hl(s,o,i),ll=null,cl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){Sc(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),
t=t.sibling}function fl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),ml(e),4&r){try{el(3,e,e.return),tl(3,e)}catch(t){Sc(e,e.return,t)}try{el(5,e,e.return)}catch(t){Sc(e,e.return,t)}}break;case 1:pl(t,e),
ml(e),512&r&&null!==n&&Jo(n,n.return);break;case 5:if(pl(t,e),ml(e),512&r&&null!==n&&Jo(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(t){Sc(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){
var s=e.memoizedProps,o=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&J(i,s),ye(l,o);var u=ye(l,s);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1]
;"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):y(i,h,d,u)}switch(l){case"input":Z(i,s);break;case"textarea":ae(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple
;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(t){Sc(e,e.return,t)}}break;case 6:if(pl(t,e),ml(e),4&r){
if(null===e.stateNode)throw Error(a(162));u=e.stateNode,h=e.memoizedProps;try{u.nodeValue=h}catch(t){Sc(e,e.return,t)}}break;case 3:if(pl(t,e),ml(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(t){Sc(e,e.return,t)}break
;case 4:default:pl(t,e),ml(e);break;case 13:pl(t,e),ml(e),8192&(u=e.child).flags&&null!==u.memoizedState&&(null===u.alternate||null===u.alternate.memoizedState)&&(Bl=Je()),4&r&&dl(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,
1&e.mode?(Xo=(h=Xo)||u,pl(t,e),Xo=h):pl(t,e),ml(e),8192&r){h=null!==e.memoizedState;e:for(d=null,p=e;;){if(5===p.tag){if(null===d){d=p;try{i=p.stateNode,
h?"function"==typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=p.stateNode,o=null!=(c=p.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(t){
Sc(e,e.return,t)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=h?"":p.memoizedProps}catch(t){Sc(e,e.return,t)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===e)&&null!==p.child){p.child.return=p,p=p.child;continue}
if(p===e)break e;for(;null===p.sibling;){if(null===p.return||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}if(h&&!u&&1&e.mode)for(Ko=e,e=e.child;null!==e;){for(u=Ko=e;null!==Ko;){
switch(d=(h=Ko).child,h.tag){case 0:case 11:case 14:case 15:el(4,h,h.return);break;case 1:if(Jo(h,h.return),"function"==typeof(s=h.stateNode).componentWillUnmount){p=h,f=h.return;try{i=p,s.props=i.memoizedProps,s.state=i.memoizedState,
s.componentWillUnmount()}catch(e){Sc(p,f,e)}}break;case 5:Jo(h,h.return);break;case 22:if(null!==h.memoizedState){yl(u);continue}}null!==d?(d.return=h,Ko=d):yl(u)}e=e.sibling}}break;case 19:pl(t,e),ml(e),4&r&&dl(e);case 21:}}function ml(e){
var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(il(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),ol(e,al(e),i);break;case 3:case 4:
var s=r.stateNode.containerInfo;sl(e,al(e),s);break;default:throw Error(a(161))}}catch(t){Sc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gl(e,t,n){Ko=e,_l(e,t,n)}function _l(e,t,n){for(var r=!!(1&e.mode);null!==Ko;){var i=Ko,a=i.child
;if(22===i.tag&&r){var s=null!==i.memoizedState||qo;if(!s){var o=i.alternate,l=null!==o&&null!==o.memoizedState||Xo;o=qo;var c=Xo;if(qo=s,(Xo=l)&&!c)for(Ko=i;null!==Ko;)l=(s=Ko).child,22===s.tag&&null!==s.memoizedState?bl(i):null!==l?(l.return=s,
Ko=l):bl(i);for(;null!==a;)Ko=a,_l(a,t,n),a=a.sibling;Ko=i,qo=o,Xo=c}vl(e)}else 8772&i.subtreeFlags&&null!==a?(a.return=i,Ko=a):vl(e)}}function vl(e){for(;null!==Ko;){var t=Ko;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){
case 0:case 11:case 15:Xo||tl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ji(t.type,n.memoizedProps)
;r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&ca(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}
ca(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:
case 19:case 17:case 21:case 22:case 23:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(a(163))}Xo||512&t.flags&&nl(t)}catch(e){
Sc(t,t.return,e)}}if(t===e){Ko=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ko=n;break}Ko=t.return}}function yl(e){for(;null!==Ko;){var t=Ko;if(t===e){Ko=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ko=n;break}Ko=t.return}}
function bl(e){for(;null!==Ko;){var t=Ko;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{tl(4,t)}catch(e){Sc(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()
}catch(e){Sc(t,i,e)}}var a=t.return;try{nl(t)}catch(e){Sc(t,a,e)}break;case 5:var s=t.return;try{nl(t)}catch(e){Sc(t,s,e)}}}catch(e){Sc(t,t.return,e)}if(t===e){Ko=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Ko=o;break}Ko=t.return}}
var xl,El=Math.ceil,wl=b.ReactCurrentDispatcher,Sl=b.ReactCurrentOwner,Tl=b.ReactCurrentBatchConfig,Al=0,Cl=null,Ml=null,Il=0,Rl=0,kl=Si(0),Nl=0,Dl=null,Ll=0,Ol=0,Pl=0,Fl=null,Ul=null,Bl=0,zl=1/0,Gl=null,Vl=!1,Hl=null,jl=null,Wl=!1,$l=null,ql=0,Xl=0,Yl=null,Kl=-1,Jl=0
;function Zl(){return 6&Al?Je():-1!==Kl?Kl:Kl=Je()}function Ql(e){return 1&e.mode?2&Al&&0!==Il?Il&-Il:null!==Hi.transition?(0===Jl&&(Jl=mt()),Jl):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Kt(e.type):1}function ec(e,t,n){if(50<Xl)throw Xl=0,Yl=null,
Error(a(185));var r=tc(e,t);return null===r?null:(_t(r,t,n),!!(2&Al)&&r===Cl||(r===Cl&&(!(2&Al)&&(Ol|=t),4===Nl&&oc(r,Il)),rc(r,n),1===t&&0===Al&&!(1&e.mode)&&(zl=Je()+500,Bi&&Vi())),r)}function tc(e,t){e.lanes|=t;var n=e.alternate
;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function nc(e){return!(null===Cl&&null===ea||!(1&e.mode)||2&Al)}function rc(e,t){
var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),o=1<<s,l=i[s];-1===l?!!(o&n)&&!(o&r)||(i[s]=pt(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t)
;var r=dt(e,e===Cl?Il:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Bi=!0,Gi(e)}(lc.bind(null,e)):Gi(lc.bind(null,e)),si((function(){
0===Al&&Vi()})),n=null;else{switch(bt(r)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ic(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Kl=-1,Jl=0,6&Al)throw Error(a(327))
;var n=e.callbackNode;if(Ec()&&e.callbackNode!==n)return null;var r=dt(e,e===Cl?Il:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=gc(e,r);else{t=r;var i=Al;Al|=2;var s=fc();for(Cl===e&&Il===t||(Gl=null,zl=Je()+500,dc(e,t));;)try{vc();break
}catch(t){pc(e,t)}Yi(),wl.current=s,Al=i,null!==Ml?t=0:(Cl=null,Il=0,t=Nl)}if(0!==t){if(2===t&&0!==(i=ft(e))&&(r=i,t=ac(e,i)),1===t)throw n=Dl,dc(e,0),oc(e,r),rc(e,Je()),n;if(6===t)oc(e,r);else{if(i=e.current.alternate,!(30&r||function(e){
for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!or(a(),i))return!1}catch(e){return!1}}}if(n=t.child,
16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(2===(t=gc(e,r))&&0!==(s=ft(e))&&(r=s,t=ac(e,s)),
1!==t)))throw n=Dl,dc(e,0),oc(e,r),rc(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:xc(e,Ul,Gl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Bl+500-Je())){if(0!==dt(e,0))break
;if(((i=e.suspendedLanes)&r)!==r){Zl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xc.bind(null,e,Ul,Gl),t);break}xc(e,Ul,Gl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-st(r);s=1<<o,
(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=ri(xc.bind(null,e,Ul,Gl),r);break}xc(e,Ul,Gl);break;default:throw Error(a(329))}}}return rc(e,Je()),
e.callbackNode===n?ic.bind(null,e):null}function ac(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&sc(t)),e}function sc(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){
for(t&=~Pl,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(6&Al)throw Error(a(327));Ec();var t=dt(e,0);if(!(1&t))return rc(e,Je()),null;var n=gc(e,t);if(0!==e.tag&&2===n){
var r=ft(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Dl,dc(e,0),oc(e,t),rc(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,Ul,Gl),rc(e,Je()),null}function cc(e,t){var n=Al;Al|=1;try{return e(t)
}finally{0===(Al=n)&&(zl=Je()+500,Bi&&Vi())}}function uc(e){null!==$l&&0===$l.tag&&!(6&Al)&&Ec();var t=Al;Al|=1;var n=Tl.transition,r=yt;try{if(Tl.transition=null,yt=1,e)return e()}finally{yt=r,Tl.transition=n,!(6&(Al=t))&&Vi()}}function hc(){
Rl=kl.current,Ti(kl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Ml)for(n=Ml.return;null!==n;){var r=n;switch(Ia(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Di()
;break;case 3:es(),Ti(Ii),Ti(Mi),ss();break;case 5:ns(r);break;case 4:es();break;case 13:case 19:Ti(rs);break;case 10:Ki(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Cl=e,Ml=e=Dc(e.current,null),Il=Rl=t,Nl=0,Dl=null,Pl=Ol=Ll=0,
Ul=Fl=null,null!==ea){for(t=0;t<ea.length;t++)if(null!==(r=(n=ea[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=i,r.next=s}n.pending=r}ea=null}return e}function pc(e,t){for(;;){var n=Ml;try{if(Yi(),
os.current=to,ps){for(var r=us.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ps=!1}if(cs=0,ds=hs=us=null,fs=!1,ms=0,Sl.current=null,null===n||null===n.return){Nl=1,Dl=t,Ml=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Il,
l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,h=l,d=h.tag;if(!(1&h.mode||0!==d&&11!==d&&15!==d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,
h.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,_o(f,o,l,0,t),1&f.mode&&mo(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(!(1&t)){mo(s,u,t),mc();break e}c=Error(a(426))
}else if(Na&&1&l.mode){var _=go(o);if(null!==_){!(65536&_.flags)&&(_.flags|=256),_o(_,o,l,0,t),Ga(c);break e}}s=c,4!==Nl&&(Nl=2),null===Fl?Fl=[s]:Fl.push(s),c=ao(c,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,oa(l,po(0,c,t));break e
;case 1:s=c;var v=l.type,y=l.stateNode;if(!(128&l.flags||"function"!=typeof v.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==jl&&jl.has(y)))){l.flags|=65536,t&=-t,l.lanes|=t,oa(l,fo(l,s,t));break e}}l=l.return
}while(null!==l)}bc(n)}catch(e){t=e,Ml===n&&null!==n&&(Ml=n=n.return);continue}break}}function fc(){var e=wl.current;return wl.current=to,null===e?to:e}function mc(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),
null===Cl||!(268435455&Ll)&&!(268435455&Ol)||oc(Cl,Il)}function gc(e,t){var n=Al;Al|=2;var r=fc();for(Cl===e&&Il===t||(Gl=null,dc(e,t));;)try{_c();break}catch(t){pc(e,t)}if(Yi(),Al=n,wl.current=r,null!==Ml)throw Error(a(261));return Cl=null,Il=0,Nl}
function _c(){for(;null!==Ml;)yc(Ml)}function vc(){for(;null!==Ml&&!Ye();)yc(Ml)}function yc(e){var t=xl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?bc(e):Ml=t,Sl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,
32768&t.flags){if(null!==(n=$o(n,t)))return n.flags&=32767,void(Ml=n);if(null===e)return Nl=6,void(Ml=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=bo(n,t,Rl)))return void(Ml=n);if(null!==(t=t.sibling))return void(Ml=t)
;Ml=t=e}while(null!==t);0===Nl&&(Nl=5)}function xc(e,t,n){var r=yt,i=Tl.transition;try{Tl.transition=null,yt=1,function(e,t,n,r){do{Ec()}while(null!==$l);if(6&Al)throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null
;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,
e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,s),e===Cl&&(Ml=Cl=null,Il=0),
!(2064&n.subtreeFlags)&&!(2064&n.flags)||Wl||(Wl=!0,Ic(tt,(function(){return Ec(),null}))),s=!!(15990&n.flags),15990&n.subtreeFlags||s){s=Tl.transition,Tl.transition=null;var o=yt;yt=1;var l=Al;Al|=4,Sl.current=null,function(e,t){if(ei=jt,
pr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode
;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(e){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(l=o+i),d!==s||0!==r&&3!==d.nodeType||(c=o+r),
3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===i&&(l=o),p===s&&++h===r&&(c=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}
n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},jt=!1,Ko=t;null!==Ko;)if(e=(t=Ko).child,1028&t.subtreeFlags&&null!==e)e.return=t,Ko=e;else for(;null!==Ko;){t=Ko;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:
case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ji(t.type,g),_);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:
var b=t.stateNode.containerInfo;if(1===b.nodeType)b.textContent="";else if(9===b.nodeType){var x=b.body;null!=x&&(x.textContent="")}break;default:throw Error(a(163))}}catch(e){Sc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Ko=e;break}
Ko=t.return}m=Qo,Qo=!1}(e,n),fl(n,e),fr(ti),jt=!!ei,ti=ei=null,e.current=n,gl(n,e,i),Ke(),Al=l,yt=o,Tl.transition=s}else e.current=n;if(Wl&&(Wl=!1,$l=e,ql=i),0===(s=e.pendingLanes)&&(jl=null),function(e){
if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),rc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r(t[n]);if(Vl)throw Vl=!1,e=Hl,Hl=null,e
;!!(1&ql)&&0!==e.tag&&Ec(),1&(s=e.pendingLanes)?e===Yl?Xl++:(Xl=0,Yl=e):Xl=0,Vi()}(e,t,n,r)}finally{Tl.transition=i,yt=r}return null}function Ec(){if(null!==$l){var e=bt(ql),t=Tl.transition,n=yt;try{if(Tl.transition=null,yt=16>e?16:e,
null===$l)var r=!1;else{if(e=$l,$l=null,ql=0,6&Al)throw Error(a(331));var i=Al;for(Al|=4,Ko=e.current;null!==Ko;){var s=Ko,o=s.child;if(16&Ko.flags){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ko=u;null!==Ko;){var h=Ko
;switch(h.tag){case 0:case 11:case 15:el(8,h,s)}var d=h.child;if(null!==d)d.return=h,Ko=d;else for(;null!==Ko;){var p=(h=Ko).sibling,f=h.return;if(rl(h),h===u){Ko=null;break}if(null!==p){p.return=f,Ko=p;break}Ko=f}}}var m=s.alternate;if(null!==m){
var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Ko=s}}if(2064&s.subtreeFlags&&null!==o)o.return=s,Ko=o;else e:for(;null!==Ko;){if(2048&(s=Ko).flags)switch(s.tag){case 0:case 11:case 15:el(9,s,s.return)}
var v=s.sibling;if(null!==v){v.return=s.return,Ko=v;break e}Ko=s.return}}var y=e.current;for(Ko=y;null!==Ko;){var b=(o=Ko).child;if(2064&o.subtreeFlags&&null!==b)b.return=o,Ko=b;else e:for(o=y;null!==Ko;){if(2048&(l=Ko).flags)try{switch(l.tag){
case 0:case 11:case 15:tl(9,l)}}catch(e){Sc(l,l.return,e)}if(l===o){Ko=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Ko=x;break e}Ko=l.return}}if(Al=i,Vi(),at&&"function"==typeof at.onPostCommitFiberRoot)try{
at.onPostCommitFiberRoot(it,e)}catch(e){}r=!0}return r}finally{yt=n,Tl.transition=t}}return!1}function wc(e,t,n){aa(e,t=po(0,t=ao(n,t),1)),t=Zl(),null!==(e=tc(e,1))&&(_t(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)wc(e,e,n);else for(;null!==t;){
if(3===t.tag){wc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===jl||!jl.has(r))){aa(t,e=fo(t,e=ao(n,e),1)),e=Zl(),null!==(t=tc(t,1))&&(_t(t,1,e),
rc(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zl(),e.pingedLanes|=e.suspendedLanes&n,Cl===e&&(Il&n)===n&&(4===Nl||3===Nl&&(130023424&Il)===Il&&500>Je()-Bl?dc(e,0):Pl|=n),rc(e,t)}function Ac(e,t){
0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=Zl();null!==(e=tc(e,t))&&(_t(e,t,n),rc(e,n))}function Cc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:
var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ac(e,n)}function Ic(e,t){return qe(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,
this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,
this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,n,r){return new Rc(e,t,n,r)}function Nc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate
;return null===n?((n=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,
n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},
n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,r,i,s){var o=2;if(r=e,"function"==typeof e)Nc(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case w:return Oc(n.children,i,s,t);case S:o=8,i|=8;break;case T:
return(e=kc(12,n,t,2|i)).elementType=T,e.lanes=s,e;case I:return(e=kc(13,n,t,i)).elementType=I,e.lanes=s,e;case R:return(e=kc(19,n,t,i)).elementType=R,e.lanes=s,e;case D:return Pc(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){
case A:o=10;break e;case C:o=9;break e;case M:o=11;break e;case k:o=14;break e;case N:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=kc(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Oc(e,t,n,r){
return(e=kc(7,e,r,t)).lanes=n,e}function Pc(e,t,n,r){return(e=kc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={},e}function Fc(e,t,n){return(e=kc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){
return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,i){this.tag=t,this.containerInfo=e,
this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),
this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,
this.mutableSourceEagerHydrationData=null}function zc(e,t,n,r,i,a,s,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=kc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,
pendingSuspenseBoundaries:null},na(a),e}function Gc(e){if(!e)return Ci;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ni(t.type)){
t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ni(n))return Oi(e,n,t)}return t}function Vc(e,t,n,r,i,a,s,o,l){
return(e=zc(n,r,!0,e,0,a,0,o,l)).context=Gc(null),n=e.current,(a=ia(r=Zl(),i=Ql(n))).callback=null!=t?t:null,aa(n,a),e.current.lanes=i,_t(e,i,r),rc(e,r),e}function Hc(e,t,n,r){var i=t.current,a=Zl(),s=Ql(i);return n=Gc(n),
null===t.context?t.context=n:t.pendingContext=n,(t=ia(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),aa(i,t),null!==(e=ec(i,s,a))&&sa(e,i,s),s}function jc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}
function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function $c(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}xl=function(e,t,n){
if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)Eo=!0;else{if(!(e.lanes&n||128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:No(t),za();break;case 5:ts(t);break;case 1:Ni(t.type)&&Pi(t);break;case 4:
Qa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ai(Wi,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ai(rs,1&rs.current),t.flags|=128,
null):n&t.child.childLanes?Fo(e,t,n):(Ai(rs,1&rs.current),null!==(e=Wo(e,t,n))?e.sibling:null);Ai(rs,1&rs.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return jo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,
i.tail=null,i.lastEffect=null),Ai(rs,rs.current),r)break;return null;case 22:case 23:return t.lanes=0,Co(e,t,n)}return Wo(e,t,n)}(e,t,n);Eo=!!(131072&e.flags)}else Eo=!1,Na&&1048576&t.flags&&Ca(t,ba,t.index);switch(t.lanes=0,t.tag){case 2:
var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var i=ki(t,Mi.current);Zi(t,n),i=ys(null,t,r,e,i,n);var s=bs();return t.flags|=1,
"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ni(r)?(s=!0,Pi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,na(t),i.updater=da,t.stateNode=i,
i._reactInternals=t,ga(t,r,e,n),t=ko(null,t,r,!0,s,n)):(t.tag=0,Na&&s&&Ma(t),wo(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,
i=t.tag=function(e){if("function"==typeof e)return Nc(e)?1:0;if(null!=e){if((e=e.$$typeof)===M)return 11;if(e===k)return 14}return 2}(r),e=ji(r,e),i){case 0:t=Io(null,t,r,e,n);break e;case 1:t=Ro(null,t,r,e,n);break e;case 11:t=So(null,t,r,e,n)
;break e;case 14:t=To(null,t,r,ji(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Io(e,t,r,i=t.elementType===r?i:ji(r,i),n);case 1:return r=t.type,i=t.pendingProps,
Ro(e,t,r,i=t.elementType===r?i:ji(r,i),n);case 3:e:{if(No(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,ra(e,t),la(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,
cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Do(e,t,r,n,i=Error(a(423)));break e}if(r!==i){t=Do(e,t,r,n,i=Error(a(424)));break e}
for(ka=ci(t.stateNode.containerInfo.firstChild),Ra=t,Na=!0,Da=null,n=qa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(za(),r===i){t=Wo(e,t,n);break e}wo(e,t,r,n)}t=t.child}return t;case 5:return ts(t),null===e&&Fa(t),r=t.type,
i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==s&&ni(r,s)&&(t.flags|=32),Mo(e,t),wo(e,t,o,n),t.child;case 6:return null===e&&Fa(t),null;case 13:return Fo(e,t,n);case 4:return Qa(t,t.stateNode.containerInfo),
r=t.pendingProps,null===e?t.child=$a(t,null,r,n):wo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,So(e,t,r,i=t.elementType===r?i:ji(r,i),n);case 7:return wo(e,t,t.pendingProps,n),t.child;case 8:case 12:
return wo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,Ai(Wi,r._currentValue),r._currentValue=o,null!==s)if(or(s.value,o)){if(s.children===i.children&&!Ii.current){t=Wo(e,t,n)
;break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=ia(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){
var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ji(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){
if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ji(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break
}o=o.return}s=o}wo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Zi(t,n),r=r(i=Qi(i)),t.flags|=1,wo(e,t,r,n),t.child;case 14:return i=ji(r=t.type,t.pendingProps),To(e,t,r,i=ji(r.type,i),n);case 15:
return Ao(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ji(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Ni(r)?(e=!0,Pi(t)):e=!1,Zi(t,n),fa(t,r,i),ga(t,r,i,n),ko(null,t,r,!0,e,n)
;case 19:return jo(e,t,n);case 22:return Co(e,t,n)}throw Error(a(156,t.tag))};var qc="function"==typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){
return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function Qc(e,t,n,r,i){
var a=n._reactRootContainer;if(a){var s=a;if("function"==typeof i){var o=i;i=function(){var e=jc(s);o.call(e)}}Hc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"==typeof r){var a=r;r=function(){var e=jc(s);a.call(e)}}
var s=Vc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[fi]=s.current,Vr(8===e.nodeType?e.parentNode:e),uc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var o=r;r=function(){var e=jc(l);o.call(e)}}
var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[fi]=l.current,Vr(8===e.nodeType?e.parentNode:e),uc((function(){Hc(t,l,n,r)})),l}(n,t,e,i,r);return jc(s)}Yc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot
;if(null===t)throw Error(a(409));Hc(e,t,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc((function(){Hc(null,e,null,null)})),t[fi]=null}},
Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ft(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode
;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Je()),!(6&Al)&&(zl=Je()+500,Vi()))}break;case 13:var r=Zl();uc((function(){return ec(e,1,r)})),$c(e,1)}},Et=function(e){13===e.tag&&(ec(e,134217728,Zl()),
$c(e,134217728))},wt=function(e){if(13===e.tag){var t=Zl(),n=Ql(e);ec(e,n,t),$c(e,n)}},St=function(){return yt},Tt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Ee=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,
"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(a(90));q(r),Z(r,i)}
}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Me=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[yi,bi,xi,Ae,Ce,cc]},tu={findFiberByHostInstance:vi,bundleType:0,version:"18.1.0",
rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,
overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){
return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,
reconcilerVersion:"18.1.0-next-22edb9f77-20220426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),at=ru}catch(ue){}}
t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(a(200));return function(e,t,n){
var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(a(299));var n=!1,r="",i=qc
;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Xc(t)
},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}
return null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(a(200));return Qc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(a(405))
;var r=null!=n&&n.hydratedSources||null,i=!1,s="",o=qc;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),
t=Vc(t,null,e,1,null!=n?n:null,i,0,s,o),e[fi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i)
;return new Yc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(a(200));return Qc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(a(40));return!!e._reactRootContainer&&(uc((function(){Qc(null,null,e,!1,(function(){
e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Qc(e,t,n,!1,r)},
t.version="18.1.0-next-22edb9f77-20220426"},5338:(e,t,n)=>{"use strict";var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{"use strict";!function e(){
if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(2551)},5287:(e,t)=>{"use strict"
;var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,f={
isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}
function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){
if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},
_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var b=y.prototype=new v;b.constructor=y,m(b,_.prototype),b.isPureReactComponent=!0
;var x=Array.isArray,E=Object.prototype.hasOwnProperty,w={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var i,a={},s=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),
t)E.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i])
;return{$$typeof:n,type:e,key:s,ref:o,props:a,_owner:w.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"}
;return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,i,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break
;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===a?"."+M(l,0):a,x(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),I(s,t,i,"",(function(e){return e}))):null!=s&&(A(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,
ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(l=0,a=""===a?".":a+":",x(e))for(var c=0;c<e.length;c++){var u=a+M(o=e[c],c);l+=I(o,t,i,u,s)}else if(u=function(e){
return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,i,u=a+M(o,c++),s);else if("object"===o)throw t=String(e),
Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,n){
if(null==e)return e;var r=[],i=0;return I(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){
0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},D={transition:null},L={ReactCurrentDispatcher:N,
ReactCurrentBatchConfig:D,ReactCurrentOwner:w};t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e
}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=s,t.PureComponent=y,t.StrictMode=a,t.Suspense=u,
t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,s=e.ref,o=e._owner
;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=w.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)E.call(t,c)&&!S.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2
;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:a,ref:s,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,
_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{
current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},
t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){
return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},
t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){
return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){
return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.1.0"},6540:(e,t,n)=>{"use strict";e.exports=n(5287)},
5208:e=>{"use strict";var t,n="";e.exports=function(e,r){if("string"!=typeof e)throw new TypeError("expected a string");if(1===r)return e;if(2===r)return e+e;var i=e.length*r;if(t!==e||void 0===t)t=e,n="";else if(n.length>=i)return n.substr(0,i)
;for(;i>n.length&&r>1;)1&r&&(n+=e),r>>=1,e+=e;return n=(n+=e).substr(0,i)}},2861:(e,t,n)=>{var r=n(8287),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}
i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=s),a(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){
if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number")
;return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},7463:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r]
;if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c]
;if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}
if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}
var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,_="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){
if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!m)if(null!==r(c))m=!0,D(E);else{var t=r(u);null!==t&&L(x,t.startTime-e)}}function E(e,n){m=!1,g&&(g=!1,v(A),A=-1),
f=!0;var a=p;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var s=d.callback;if("function"==typeof s){d.callback=null,p=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),
"function"==typeof o?d.callback=o:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&L(x,h.startTime-n),l=!1}return l}finally{d=null,p=a,f=!1}}
"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,S=!1,T=null,A=-1,C=5,M=-1;function I(){return!(t.unstable_now()-M<C)}
function R(){if(null!==T){var e=t.unstable_now();M=e;var n=!0;try{n=T(!0,e)}finally{n?w():(S=!1,T=null)}}else S=!1}if("function"==typeof y)w=function(){y(R)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,N=k.port2
;k.port1.onmessage=R,w=function(){N.postMessage(null)}}else w=function(){_(R,0)};function D(e){T=e,S||(S=!0,w())}function L(e,n){A=_((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,
t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(E))},
t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},
t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},
t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},
t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}
return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(v(A),A=-1):g=!0,L(x,a-s))):(e.sortIndex=o,n(c,e),m||f||(m=!0,D(E))),e},t.unstable_shouldYield=I,
t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},9982:(e,t,n)=>{"use strict";e.exports=n(7463)},8310:(e,t,n)=>{e.exports=i;var r=n(7007).EventEmitter;function i(){
r.call(this)}n(4317)(i,r),i.Readable=n(6891),i.Writable=n(1999),i.Duplex=n(8101),i.Transform=n(9083),i.PassThrough=n(3681),i.finished=n(4257),i.pipeline=n(5267),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){
e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",o),n.on("close",l));var s=!1;function o(){s||(s=!0,e.end())}function l(){s||(s=!0,
"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",a),n.removeListener("end",o),n.removeListener("close",l),
n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},
2463:e=>{"use strict";var t={};function n(e,n,r){r||(r=Error);var i=function(e){var t,r;function i(t,r,i){return e.call(this,function(e,t,r){return"string"==typeof n?n:n(e,t,r)}(t,r,i))||this}return r=e,(t=i).prototype=Object.create(r.prototype),
t.prototype.constructor=t,t.__proto__=r,i}(r);i.prototype.name=r.name,i.prototype.code=e,t[e]=i}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),
n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}
n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,a,s,o;if("string"==typeof t&&"not "===t.substr(0,4)?(i="must not be",
t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length)," argument"===e.substring(n-9,n)}(e))a="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var l=("number"!=typeof o&&(o=0),
o+1>(s=e).length||-1===s.indexOf(".",o)?"argument":"property");a='The "'.concat(e,'" ').concat(l," ").concat(i," ").concat(r(t,"type"))}return a+". Received type ".concat(typeof n)}),TypeError),
n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){
return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),
n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.F=t},
8101:(e,t,n)=>{"use strict";var r=n(5606),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var a=n(6891),s=n(1999);n(4317)(u,a);for(var o=i(s.prototype),l=0;l<o.length;l++){var c=o[l]
;u.prototype[c]||(u.prototype[c]=s.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);a.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),
!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){
return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{
enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){
return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,
this._writableState.destroyed=e)}})},3681:(e,t,n)=>{"use strict";e.exports=i;var r=n(9083);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n(4317)(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},6891:(e,t,n)=>{
"use strict";var r,i=n(5606);e.exports=T,T.ReadableState=S,n(7007).EventEmitter;var a,s=function(e,t){return e.listeners(t).length
},o=n(1396),l=n(8287).Buffer,c=(void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},u=n(7199);a=u&&u.debuglog?u.debuglog("stream"):function(){}
;var h,d,p,f=n(1766),m=n(4347),g=n(6644).getHighWaterMark,_=n(2463).F,v=_.ERR_INVALID_ARG_TYPE,y=_.ERR_STREAM_PUSH_AFTER_EOF,b=_.ERR_METHOD_NOT_IMPLEMENTED,x=_.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(4317)(T,o)
;var E=m.errorOrDestroy,w=["error","close","destroy","pause","resume"];function S(e,t,i){r=r||n(8101),e=e||{},"boolean"!=typeof i&&(i=t instanceof r),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),
this.highWaterMark=g(this,e,"readableHighWaterMark",i),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,
this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,
this.decoder=null,this.encoding=null,e.encoding&&(h||(h=n(3141).I),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function T(e){if(r=r||n(8101),!(this instanceof T))return new T(e);var t=this instanceof r
;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function A(e,t,n,r,i){a("readableAddChunk",t);var s,o=e._readableState
;if(null===t)o.reading=!1,function(e,t){if(a("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?R(e):(t.needReadable=!1,
t.emittedReadable||(t.emittedReadable=!0,k(e)))}}(e,o);else if(i||(s=function(e,t){var n,r;return r=t,l.isBuffer(r)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new v("chunk",["string","Buffer","Uint8Array"],t)),n}(o,t)),
s)E(e,s);else if(o.objectMode||t&&t.length>0)if("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),r)o.endEmitted?E(e,new x):C(e,o,t,!0);else if(o.ended)E(e,new y);else{
if(o.destroyed)return!1;o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?C(e,o,t,!1):N(e,o)):C(e,o,t,!1)}else r||(o.reading=!1,N(e,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function C(e,t,n,r){
t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&R(e)),N(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){
return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=m.destroy,T.prototype._undestroy=m.undestroy,T.prototype._destroy=function(e,t){t(e)},
T.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),A(this,e,t,!1,n)},T.prototype.unshift=function(e){return A(this,e,null,!0,!1)},
T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){h||(h=n(3141).I);var t=new h(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding
;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var M=1073741824;function I(e,t){
return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),
e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e){var t=e._readableState;a("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(a("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(k,e))}
function k(e){var t=e._readableState;a("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,F(e)}function N(e,t){
t.readingMore||(t.readingMore=!0,i.nextTick(D,e,t))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(a("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}
function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function O(e){a("readable nexttick read 0"),e.read(0)}function P(e,t){
a("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),F(e),t.flowing&&!t.reading&&e.read(0)}function F(e){var t=e._readableState;for(a("flow",t.flowing);t.flowing&&null!==e.read(););}function U(e,t){
return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function B(e){
var t=e._readableState;a("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(z,t,e))}function z(e,t){if(a("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){
var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function G(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}T.prototype.read=function(e){a("read",e),e=parseInt(e,10);var t=this._readableState,n=e
;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return a("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):R(this),null
;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&B(this),null;var r,i=t.needReadable;return a("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&a("length less than watermark",i=!0),
t.ended||t.reading?a("reading or ended",i=!1):i&&(a("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(r=e>0?U(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,
e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&B(this)),null!==r&&this.emit("data",r),r},T.prototype._read=function(e){E(this,new b("_read()"))},T.prototype.pipe=function(e,t){
var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,a("pipe count=%d opts=%j",r.pipesCount,t);var o=t&&!1===t.end||e===i.stdout||e===i.stderr?m:l
;function l(){a("onend"),e.end()}r.endEmitted?i.nextTick(o):n.once("end",o),e.on("unpipe",(function t(i,s){a("onunpipe"),i===n&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,a("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),
e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),n.removeListener("end",l),n.removeListener("end",m),n.removeListener("data",h),u=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}))
;var c=function(e){return function(){var t=e._readableState;a("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,F(e))}}(n);e.on("drain",c);var u=!1;function h(t){a("ondata");var i=e.write(t)
;a("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==G(r.pipes,e))&&!u&&(a("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function d(t){a("onerror",t),m(),e.removeListener("error",d),
0===s(e,"error")&&E(e,t)}function p(){e.removeListener("finish",f),m()}function f(){a("onfinish"),e.removeListener("close",p),m()}function m(){a("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,n){
if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",p),e.once("finish",f),
e.emit("pipe",n),r.flowing||(a("pipe resume"),n.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,
t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=G(t.pipes,e)
;return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},T.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t),r=this._readableState
;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,
a("on readable",r.length,r.reading),r.length?R(this):r.reading||i.nextTick(O,this))),n},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var n=o.prototype.removeListener.call(this,e,t)
;return"readable"===e&&i.nextTick(L,this),n},T.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(L,this),t},T.prototype.resume=function(){
var e=this._readableState;return e.flowing||(a("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(P,e,t))}(this,e)),e.paused=!1,this},T.prototype.pause=function(){
return a("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(a("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){
var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(a("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){a("wrapped data"),
n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i))
;for(var s=0;s<w.length;s++)e.on(w[s],this.emit.bind(this,w[s]));return this._read=function(t){a("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=n(5034)),
d(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){
return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),
T._fromList=U,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===p&&(p=n(968)),p(T,e,t)})},9083:(e,t,n)=>{"use strict"
;e.exports=u;var r=n(2463).F,i=r.ERR_METHOD_NOT_IMPLEMENTED,a=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=r.ERR_TRANSFORM_WITH_LENGTH_0,l=n(8101);function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb
;if(null===r)return this.emit("error",new a);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){
if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,
this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this
;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,n){d(e,t,n)}))}function d(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o
;if(e._transformState.transforming)throw new s;return e.push(null)}n(4317)(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){
n(new i("_transform()"))},u.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState
;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,
this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},1999:(e,t,n)=>{"use strict";var r,i=n(5606);function a(e){var t=this;this.next=null,
this.entry=null,this.finish=function(){!function(e,t){var n=e.entry;for(e.entry=null;n;){var r=n.callback;t.pendingcb--,r(void 0),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=T,T.WritableState=S;var s,o={deprecate:n(4643)
},l=n(1396),c=n(8287).Buffer,u=(void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},h=n(4347),d=n(6644).getHighWaterMark,p=n(2463).F,f=p.ERR_INVALID_ARG_TYPE,m=p.ERR_METHOD_NOT_IMPLEMENTED,g=p.ERR_MULTIPLE_CALLBACK,_=p.ERR_STREAM_CANNOT_PIPE,v=p.ERR_STREAM_DESTROYED,y=p.ERR_STREAM_NULL_VALUES,b=p.ERR_STREAM_WRITE_AFTER_END,x=p.ERR_UNKNOWN_ENCODING,E=h.errorOrDestroy
;function w(){}function S(e,t,s){r=r||n(8101),e=e||{},"boolean"!=typeof s&&(s=t instanceof r),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",s),
this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,
this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,a=n.writecb;if("function"!=typeof a)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),
t)!function(e,t,n,r,a){--t.pendingcb,n?(i.nextTick(a,r),i.nextTick(k,e,t),e._writableState.errorEmitted=!0,E(e,r)):(a(r),e._writableState.errorEmitted=!0,E(e,r),k(e,t))}(e,n,r,t,a);else{var s=I(n)||e.destroyed
;s||n.corked||n.bufferProcessing||!n.bufferedRequest||M(e,n),r?i.nextTick(C,e,n,s,a):C(e,n,s,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,
this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function T(e){var t=this instanceof(r=r||n(8101));if(!t&&!s.call(T,this))return new T(e)
;this._writableState=new S(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),
"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function A(e,t,n,r,i,a,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new v("write")):n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}
function C(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),k(e,t)}function M(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){
var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var o=0,l=!0;n;)i[o]=n,n.isBuf||(l=!1),n=n.next,o+=1;i.allBuffers=l,A(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,
s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,h=n.callback;if(A(e,t,!1,t.objectMode?1:c.length,c,u,h),n=n.next,t.bufferedRequestCount--,t.writing)break
}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function R(e,t){e._final((function(n){t.pendingcb--,n&&E(e,n),
t.prefinished=!0,e.emit("prefinish"),k(e,t)}))}function k(e,t){var n=I(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,
i.nextTick(R,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}n(4317)(T,l),S.prototype.getBuffer=function(){
for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()
}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),
"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){
return!!s.call(this,e)||this===T&&e&&e._writableState instanceof S}})):s=function(e){return e instanceof this},T.prototype.pipe=function(){E(this,new _)},T.prototype.write=function(e,t,n){var r,a=this._writableState,s=!1,o=!a.objectMode&&(r=e,
c.isBuffer(r)||r instanceof u);return o&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=w),a.ending?function(e,t){var n=new b;E(e,n),
i.nextTick(t,n)}(this,n):(o||function(e,t,n,r){var a;return null===n?a=new y:"string"==typeof n||t.objectMode||(a=new f("chunk",["string","Buffer"],n)),!a||(E(e,a),i.nextTick(r,a),!1)}(this,a,e,n))&&(a.pendingcb++,s=function(e,t,n,r,i,a){if(!n){
var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var o=t.objectMode?1:r.length;t.length+=o;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),
t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else A(e,t,!1,o,r,i,a);return l
}(this,a,o,e,t,n)),s},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||M(this,e))},
T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new x(e)
;return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),
Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,n){n(new m("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,n){
var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,k(e,t),
n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),
Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=h.destroy,
T.prototype._undestroy=h.undestroy,T.prototype._destroy=function(e,t){t(e)}},5034:(e,t,n)=>{"use strict";var r,i=n(5606);function a(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive]
;if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,
enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n(4257),o=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function f(e,t){return{value:e,
done:t}}function m(e){var t=e[o];if(null!==t){var n=e[p].read();null!==n&&(e[h]=null,e[o]=null,e[l]=null,t(f(n,!1)))}}function g(e){i.nextTick(m,e)}var _=Object.getPrototypeOf((function(){})),v=Object.setPrototypeOf((a(r={get stream(){return this[p]
},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(f(void 0,!0));if(this[p].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[c]?n(e[c]):t(f(void 0,!0))}))}))
;var n,r=this[h];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[u]?n(f(void 0,!0)):t[d](n,r)}),r)}}(r,this));else{var a=this[p].read();if(null!==a)return Promise.resolve(f(a,!1));n=new Promise(this[d])}return this[h]=n,n}
},Symbol.asyncIterator,(function(){return this})),a(r,"return",(function(){var e=this;return new Promise((function(t,n){e[p].destroy(null,(function(e){e?n(e):t(f(void 0,!0))}))}))})),r),_);e.exports=function(e){var t,n=Object.create(v,(a(t={},p,{
value:e,writable:!0}),a(t,o,{value:null,writable:!0}),a(t,l,{value:null,writable:!0}),a(t,c,{value:null,writable:!0}),a(t,u,{value:e._readableState.endEmitted,writable:!0}),a(t,d,{value:function(e,t){var r=n[p].read();r?(n[h]=null,n[o]=null,
n[l]=null,e(f(r,!1))):(n[o]=e,n[l]=t)},writable:!0}),t));return n[h]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[l];return null!==t&&(n[h]=null,n[o]=null,n[l]=null,t(e)),void(n[c]=e)}var r=n[o];null!==r&&(n[h]=null,
n[o]=null,n[l]=null,r(f(void 0,!0))),n[u]=!0})),e.on("readable",g.bind(null,n)),n}},1766:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){
return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])
})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){
return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string")
;if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var o=n(8287).Buffer,l=n(3779).inspect,c=l&&l.custom||"inspect";e.exports=function(){
function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null}
;this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){
var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return""
;for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,n,r,i=o.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,n=i,r=s,o.prototype.copy.call(t,n,r),
s+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),
this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data
;for(e-=r.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?r+=i:r+=i.slice(0,e),0==(e-=a)){a===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++n}return this.length-=n,r}},{
key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++r,
n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(a));break}++r}return this.length-=r,t}},{key:c,value:function(e,t){return l(this,i(i({},t),{},{depth:0,customInspect:!1}))}}])&&function(e,t){for(var n=0;n<t.length;n++){
var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},4347:(e,t,n)=>{"use strict";var r=n(5606)
;function i(e,t){s(e,t),a(e)}function a(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){
var n=this,o=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return o||l?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,
r.nextTick(s,this,e)):r.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){
!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(a,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(a,n),t(e)):r.nextTick(a,n)})),this)},undestroy:function(){
this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,
this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState
;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},4257:(e,t,n)=>{"use strict";var r=n(2463).F.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,a){if("function"==typeof n)return e(t,null,n);n||(n={}),a=function(e){
var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(a||i);var s=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,l=function(){
t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){o=!1,c=!0,s||a.call(t)},h=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,h=!0,o||a.call(t)},p=function(e){a.call(t,e)},f=function(){var e
;return s&&!h?(t._readableState&&t._readableState.ended||(e=new r),a.call(t,e)):o&&!c?(t._writableState&&t._writableState.ended||(e=new r),a.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return function(e){
return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)):o&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",d),t.on("finish",u),!1!==n.error&&t.on("error",p),t.on("close",f),
function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",d),
t.removeListener("error",p),t.removeListener("close",f)}}},968:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},5267:(e,t,n)=>{"use strict";var r,i=n(2463).F,a=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED
;function o(e){if(e)throw e}function l(e){e()}function c(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var u,h=function(e){
return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var d=t.map((function(e,i){var a=i<t.length-1;return function(e,t,i,a){a=function(e){var t=!1;return function(){
t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;e.on("close",(function(){o=!0})),void 0===r&&(r=n(4257)),r(e,{readable:t,writable:i},(function(e){if(e)return a(e);o=!0,a()}));var l=!1;return function(t){if(!o&&!l)return l=!0,function(e){
return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new s("pipe"))}}(e,a,i>0,(function(e){u||(u=e),e&&d.forEach(l),a||(d.forEach(l),h(u))}))}));return t.reduce(c)}},6644:(e,t,n)=>{
"use strict";var r=n(2463).F.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var a=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=a){
if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new r(i?n:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}},1396:(e,t,n)=>{e.exports=n(7007).EventEmitter},3141:(e,t,n)=>{"use strict"
;var r=n(2861).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}}
;function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":
return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":
this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){
return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,
"\ufffd";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),
this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1)
;if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],
e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3
;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){
var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.I=a,a.prototype.write=function(e){
if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){
var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),
i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed)
;return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)
;e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},6231:(e,t,n)=>{"use strict";const r=n(9880);e.exports=e=>"string"==typeof e?e.replace(r(),""):e},2747:e=>{"use strict";e.exports={stdout:!1,stderr:!1}},7996:e=>{
"use strict";var t=new Uint8Array(1e7),n={array:function(e){var t=0,n=0,r=[0,1,3,7,15,31,63,127,255];return function(i){for(var a=0;i>0;){var s=8-t;i>=s?(a<<=s,a|=r[s]&e[n++],t=0,i-=s):(a<<=i,a|=(e[n]&r[i]<<8-i-t)>>8-i-t,t+=i,i=0)}return a}},
simple:function(e){var t,r,i=n.header(e),a=[],s=0;do{-1!=(r=n.decompress(e,i))&&(a.push(r),s+=r.byteLength)}while(-1!=r);t=new Uint8Array(s),s=0;for(var o=0;o<a.length;++o)r=a[o],t.set(r,s),s+=r.byteLength;return t},header:function(e){
if(4348520!=e(24))throw"No magic number found";var t=e(8)-48;if(t<1||t>9)throw"Not a BZIP archive";return t},decompress:function(e,n,r){for(var i=9e5,a="",s=0;s<6;s++)a+=e(8).toString(16);if("177245385090"==a)return-1
;if("314159265359"!=a)throw"eek not valid bzip data";if(e(32),e(1))throw"unsupported obsolete version";var o=e(24);if(o>i)throw"Initial position larger than buffer size";var l=e(16),c=new Uint8Array(256),u=0;for(s=0;s<16;s++)if(l&1<<15-s){var h=e(16)
;for(g=0;g<16;g++)h&1<<15-g&&(c[u++]=16*s+g)}var d=e(3);if(d<2||d>6)throw"another error";var p=e(15);if(0==p)throw"meh";var f=[];for(s=0;s<d;s++)f[s]=s;var m=new Uint8Array(32768);for(s=0;s<p;s++){
for(var g=0;e(1);g++)if(g>=d)throw"whoops another error";var _=f[g];f.splice(g,1),f.splice(0,0,_),m[s]=_}var v=u+2,y=[];for(g=0;g<d;g++){var b,x,E,w=new Uint8Array(258),S=new Uint8Array(21);for(l=e(5),s=0;s<v;s++){for(;;){
if(l<1||l>20)throw"I gave up a while ago on writing error messages";if(!e(1))break;e(1)?l--:l++}w[s]=l}for(b=x=w[0],s=1;s<v;s++)w[s]>x?x=w[s]:w[s]<b&&(b=w[s]);(E=y[g]={}).permute=new Uint32Array(258),E.limit=new Uint32Array(21),
E.base=new Uint32Array(21),E.minLen=b,E.maxLen=x;var T=E.base.subarray(1),A=E.limit.subarray(1),C=0;for(s=b;s<=x;s++)for(l=0;l<v;l++)w[l]==s&&(E.permute[C++]=l);for(s=b;s<=x;s++)S[s]=A[s]=0;for(s=0;s<v;s++)S[w[s]]++;for(C=l=0,s=b;s<x;s++)C+=S[s],
A[s]=C-1,C<<=1,T[s+1]=C-(l+=S[s]);A[x]=C+S[x]-1,T[b]=0}var M,I,R,k=new Uint32Array(256);for(s=0;s<256;s++)f[s]=s;M=I=v=R=0;for(var N=new Uint32Array(i);;){if(!v--){if(v=49,R>=p)throw"meow i'm a kitty, that's an error"
;T=(E=y[m[R++]]).base.subarray(1),A=E.limit.subarray(1)}for(g=e(s=E.minLen);;){if(s>E.maxLen)throw"rawr i'm a dinosaur";if(g<=A[s])break;s++,g=g<<1|e(1)}if((g-=T[s])<0||g>=258)throw"moo i'm a cow";var D=E.permute[g];if(0!=D&&1!=D){if(M){if(M=0,
I+l>=i)throw"Boom.";for(k[_=c[f[0]]]+=l;l--;)N[I++]=_}if(D>u)break;if(I>=i)throw"I can't think of anything. Error";_=f[s=D-1],f.splice(s,1),f.splice(0,0,_),k[_=c[_]]++,N[I++]=_}else M||(M=1,l=0),l+=0==D?M:2*M,M<<=1}
if(o<0||o>=I)throw"I'm a monkey and I'm throwing something at someone, namely you";for(g=0,s=0;s<256;s++)h=g+k[s],k[s]=g,g=h;for(s=0;s<I;s++)N[k[_=255&N[s]]]|=s<<8,k[_]++;var L,O,P,F=0,U=0,B=0;I&&(U=255&(F=N[o]),F>>=8,B=-1);var z=0
;for(r||(r=1/0);I;){for(I--,O=U,U=255&(F=N[F]),F>>=8,3==B++?(L=U,P=O,U=-1):(L=1,P=U);L--;)if(t[z++]=P,! --r)return t;U!=O&&(B=0)}if(z>t.length)throw new Error("not enough memory reserved");return t.slice(0,z)}};e.exports=n},4643:(e,t,n)=>{
function r(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){
if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},1135:e=>{e.exports=function(e){
return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},9032:(e,t,n)=>{"use strict";var r=n(7244),i=n(8184),a=n(5767),s=n(5680);function o(e){return e.call.bind(e)}
var l="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,u=o(Object.prototype.toString),h=o(Number.prototype.valueOf),d=o(String.prototype.valueOf),p=o(Boolean.prototype.valueOf);if(l)var f=o(BigInt.prototype.valueOf)
;if(c)var m=o(Symbol.prototype.valueOf);function g(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function _(e){return"[object Map]"===u(e)}function v(e){return"[object Set]"===u(e)}function y(e){
return"[object WeakMap]"===u(e)}function b(e){return"[object WeakSet]"===u(e)}function x(e){return"[object ArrayBuffer]"===u(e)}function E(e){return"undefined"!=typeof ArrayBuffer&&(x.working?x(e):e instanceof ArrayBuffer)}function w(e){
return"[object DataView]"===u(e)}function S(e){return"undefined"!=typeof DataView&&(w.working?w(e):e instanceof DataView)}t.isArgumentsObject=r,t.isGeneratorFunction=i,t.isTypedArray=s,t.isPromise=function(e){
return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){
return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):s(e)||S(e)},t.isUint8Array=function(e){return"Uint8Array"===a(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===a(e)},t.isUint16Array=function(e){
return"Uint16Array"===a(e)},t.isUint32Array=function(e){return"Uint32Array"===a(e)},t.isInt8Array=function(e){return"Int8Array"===a(e)},t.isInt16Array=function(e){return"Int16Array"===a(e)},t.isInt32Array=function(e){return"Int32Array"===a(e)},
t.isFloat32Array=function(e){return"Float32Array"===a(e)},t.isFloat64Array=function(e){return"Float64Array"===a(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===a(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===a(e)},
_.working="undefined"!=typeof Map&&_(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(_.working?_(e):e instanceof Map)},v.working="undefined"!=typeof Set&&v(new Set),t.isSet=function(e){
return"undefined"!=typeof Set&&(v.working?v(e):e instanceof Set)},y.working="undefined"!=typeof WeakMap&&y(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(y.working?y(e):e instanceof WeakMap)},
b.working="undefined"!=typeof WeakSet&&b(new WeakSet),t.isWeakSet=function(e){return b(e)},x.working="undefined"!=typeof ArrayBuffer&&x(new ArrayBuffer),t.isArrayBuffer=E,
w.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&w(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=S;var T="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function A(e){
return"[object SharedArrayBuffer]"===u(e)}function C(e){return void 0!==T&&(void 0===A.working&&(A.working=A(new T)),A.working?A(e):e instanceof T)}function M(e){return g(e,h)}function I(e){return g(e,d)}function R(e){return g(e,p)}function k(e){
return l&&g(e,f)}function N(e){return c&&g(e,m)}t.isSharedArrayBuffer=C,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===u(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===u(e)},t.isSetIterator=function(e){
return"[object Set Iterator]"===u(e)},t.isGeneratorObject=function(e){return"[object Generator]"===u(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===u(e)},t.isNumberObject=M,t.isStringObject=I,t.isBooleanObject=R,
t.isBigIntObject=k,t.isSymbolObject=N,t.isBoxedPrimitive=function(e){return M(e)||I(e)||R(e)||k(e)||N(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(E(e)||C(e))},
["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})}))},537:(e,t,n)=>{
var r=n(5606),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},a=/%[sdj%]/g;t.format=function(e){if(!y(e)){
for(var t=[],n=0;n<arguments.length;n++)t.push(c(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,s=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":
return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),o=r[n];n<i;o=r[++n])_(o)||!E(o)?s+=" "+o:s+=" "+c(o);return s},t.deprecate=function(e,n){if(void 0!==r&&!0===r.noDeprecation)return e
;if(void 0===r)return function(){return t.deprecate(e,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),i=!0}return e.apply(this,arguments)}}
;var s={},o=/^$/;if(r.env.NODE_DEBUG){var l=r.env.NODE_DEBUG;l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+l+"$","i")}function c(e,n){var r={seen:[],stylize:h}
;return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),
b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),d(r,e,r.depth)}function u(e,t){var n=c.styles[t];return n?"\x1b["+c.colors[n][0]+"m"+e+"\x1b["+c.colors[n][1]+"m":e}function h(e,t){return e}function d(e,n,r){
if(e.customInspect&&n&&T(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return y(i)||(i=d(e,i,r)),i}var a=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(y(t)){
var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):_(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a
;var s=Object.keys(n),o=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),S(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return p(n);if(0===s.length){if(T(n)){
var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(x(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(S(n))return p(n)}
var c,u="",h=!1,E=["{","}"];return m(n)&&(h=!0,E=["[","]"]),T(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]"),x(n)&&(u=" "+RegExp.prototype.toString.call(n)),w(n)&&(u=" "+Date.prototype.toUTCString.call(n)),S(n)&&(u=" "+p(n)),
0!==s.length||h&&0!=n.length?r<0?x(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=h?function(e,t,n,r,i){
for(var a=[],s=0,o=t.length;s<o;++s)I(t,String(s))?a.push(f(e,t,n,r,String(s),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(f(e,t,n,r,i,!0))})),a}(e,n,r,o,s):s.map((function(t){return f(e,n,r,o,t,h)})),e.seen.pop(),
function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,u,E)):E[0]+u+E[1]}function p(e){
return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,a){var s,o,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]
}).get?o=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(o=e.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),
o||(e.seen.indexOf(l.value)<0?(o=_(n)?d(e,l.value,null):d(e,l.value,n-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e
})).join("\n")):o=e.stylize("[Circular]","special")),b(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),
s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function m(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function _(e){return null===e}
function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return void 0===e}function x(e){return E(e)&&"[object RegExp]"===A(e)}function E(e){return"object"==typeof e&&null!==e}function w(e){
return E(e)&&"[object Date]"===A(e)}function S(e){return E(e)&&("[object Error]"===A(e)||e instanceof Error)}function T(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function C(e){
return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(e=e.toUpperCase(),!s[e])if(o.test(e)){var n=r.pid;s[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else s[e]=function(){};return s[e]},
t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",
boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=n(9032),t.isArray=m,t.isBoolean=g,t.isNull=_,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=y,t.isSymbol=function(e){
return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=x,t.types.isRegExp=x,t.isObject=E,t.isDate=w,t.types.isDate=w,t.isError=S,t.types.isNativeError=S,t.isFunction=T,t.isPrimitive=function(e){
return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(1135);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(e,t){
return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(n=[C((e=new Date).getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":"),[e.getDate(),M[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},
t.inherits=n(4317),t._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function k(e,t){if(!e){
var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t
;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){
for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),
R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=R,t.callbackify=function(e){
if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var i=t.pop()
;if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,s=function(){return i.apply(a,arguments)};e.apply(this,t).then((function(e){r.nextTick(s.bind(null,null,e))}),(function(e){
r.nextTick(k.bind(null,e,s))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},5767:(e,t,n)=>{"use strict"
;var r=n(7593),i=n(9209),a=n(8075),s=a("Object.prototype.toString"),o=n(9092)(),l="undefined"==typeof globalThis?n.g:globalThis,c=i(),u=a("String.prototype.slice"),h={},d=n(8957),p=Object.getPrototypeOf;o&&d&&p&&r(c,(function(e){
if("function"==typeof l[e]){var t=new l[e];if(Symbol.toStringTag in t){var n=p(t),r=d(n,Symbol.toStringTag);if(!r){var i=p(n);r=d(i,Symbol.toStringTag)}h[e]=r.get}}}));var f=n(5680);e.exports=function(e){
return!!f(e)&&(o&&Symbol.toStringTag in e?function(e){var t=!1;return r(h,(function(n,r){if(!t)try{var i=n.call(e);i===r&&(t=i)}catch(e){}})),t}(e):u(s(e),8,-1))}},5872:e=>{!function(){class t{static copy$byte_A$int$byte_A$int$int(e,t,n,r,i){
if(e===n){if(t===r)return;if(r>t&&r<t+i){let a=t+--i,s=r+i;for(i=a-i,i+=7;a>=i;){let t=s-1,r=a-1;n[s]=e[a],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],s=t-1,a=r-1,n[t]=e[r]}for(i-=7;a>=i;)n[s--]=e[a--];return}}
for(i+=t,i-=7;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}for(i+=7;t<i;)n[r++]=e[t++]}static copy(e,n,r,i,a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||"number"==typeof r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||"number"==typeof r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||"number"==typeof r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||"number"==typeof r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||"number"==typeof r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||null!=e[0])||null===e)||"number"!=typeof n&&null!==n||!(null!=r&&r instanceof Array&&(0==r.length||null==r[0]||null!=r[0])||null===r)||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a)throw new Error("invalid overload")
;return t.copy$java_lang_Object_A$int$java_lang_Object_A$int$int(e,n,r,i,a)}return t.copy$float_A$int$float_A$int$int(e,n,r,i,a)}return t.copy$long_A$int$long_A$int$int(e,n,r,i,a)}return t.copy$int_A$int$int_A$int$int(e,n,r,i,a)}
return t.copy$short_A$int$short_A$int$int(e,n,r,i,a)}return t.copy$byte_A$int$byte_A$int$int(e,n,r,i,a)}static copy$short_A$int$short_A$int$int(e,t,n,r,i){if(e===n){if(t===r)return;if(r>t&&r<t+i){let a=t+--i,s=r+i;for(i=a-i,i+=7;a>=i;){
let t=s-1,r=a-1;n[s]=e[a],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],s=t-1,a=r-1,n[t]=e[r]}for(i-=7;a>=i;)n[s--]=e[a--];return}}for(i+=t,i-=7;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],
n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}for(i+=7;t<i;)n[r++]=e[t++]}static copy$int_A$int$int_A$int$int(e,t,n,r,i){if(e===n){if(t===r)return;if(r>t&&r<t+i){let a=t+--i,s=r+i;for(i=a-i,i+=7;a>=i;){let t=s-1,r=a-1
;n[s]=e[a],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],s=t-1,a=r-1,n[t]=e[r]}for(i-=7;a>=i;)n[s--]=e[a--];return}}for(i+=t,i-=7;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],
n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}for(i+=7;t<i;)n[r++]=e[t++]}static copy$long_A$int$long_A$int$int(e,t,n,r,i){if(e===n){if(t===r)return;if(r>t&&r<t+i){let a=t+--i,s=r+i;for(i=a-i,i+=3;a>=i;){let t=s-1,r=a-1;n[s]=e[a],
n[t--]=e[r--],n[t--]=e[r--],s=t-1,a=r-1,n[t]=e[r]}for(i-=3;a>=i;)n[s--]=e[a--];return}}for(i+=t,i-=3;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}for(i+=3;t<i;)n[r++]=e[t++]}
static copy$float_A$int$float_A$int$int(e,t,n,r,i){if(e!==n){for(i-=7;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}for(i+=7;t<i;)n[r++]=e[t++]}}
static copy$java_lang_Object_A$int$java_lang_Object_A$int$int(e,t,n,r,i){if(e===n){if(t===r)return;if(r>t&&r<t+i){let a=t+--i,s=r+i;for(i=a-i,i+=7;a>=i;){let t=s-1,r=a-1;n[s]=e[a],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],n[t--]=e[r--],
n[t--]=e[r--],s=t-1,a=r-1,n[t]=e[r]}for(i-=7;a>=i;)n[s--]=e[a--];return}}for(i+=t,i-=7;t<i;){let i=r+1,a=t+1;n[r]=e[t],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],n[i++]=e[a++],r=i+1,t=a+1,n[i]=e[a]}
for(i+=7;t<i;)n[r++]=e[t++]}static clear(e,t,n){for(n-=7;t<n;){let n=t+1;e[t]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,e[n++]=0,t=n+1,e[n]=0}for(n+=7;t<n;)e[t++]=0}static fill$short_A$int$int$short(e,t,n,r){for(n-=7;t<n;){let n=t+1;e[t]=r,
e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,t=n+1,e[n]=r}for(n+=7;t<n;)e[t++]=r}static fill(e,n,r,i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i)throw new Error("invalid overload")
;return t.fill$int_A$int$int$int(e,n,r,i)}return t.fill$short_A$int$int$short(e,n,r,i)}static fill$int_A$int$int$int(e,t,n,r){for(n=t+n-7;t<n;){let n=t+1;e[t]=r,e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,e[n++]=r,t=n+1,e[n]=r}for(n+=7;t<n;)e[t++]=r
}static sort$int_A$java_lang_Object_A(e,n){t.sort$int_A$java_lang_Object_A$int$int(e,n,0,e.length-1)}static sort$int_A$java_lang_Object_A$int$int(e,n,r,i){if(i<=r)return;const a=(r+i)/2|0;let s=r;const o=e[a];e[a]=e[i],e[i]=o;const l=n[a];n[a]=n[i],
n[i]=l;for(let t=r;t<i;t++)if(o+(1&t)>e[t]){const r=e[t];e[t]=e[s],e[s]=r;const i=n[t];n[t]=n[s],n[s++]=i}e[i]=e[s],e[s]=o,n[i]=n[s],n[s]=l,t.sort$int_A$java_lang_Object_A$int$int(e,n,r,s-1),t.sort$int_A$java_lang_Object_A$int$int(e,n,s+1,i)}
static sort(e,n,r,i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||!(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||null!=n[0])||null===n)||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"string"==typeof e[0])||null===e)||!(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||"number"==typeof n[0])||null===n)||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||!(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||null!=n[0])||null===n)||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||!(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||"number"==typeof n[0])||null===n)||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||!(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||"number"==typeof n[0])||null===n)||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i){
if((null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)&&(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||null!=n[0])||null===n)&&void 0===r&&void 0===i)return t.sort$int_A$java_lang_Object_A(e,n)
;if((null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"string"==typeof e[0])||null===e)&&(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||"number"==typeof n[0])||null===n)&&void 0===r&&void 0===i)return t.sort$java_lang_String_A$short_A(e,n)
;if((null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)&&(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||null!=n[0])||null===n)&&void 0===r&&void 0===i)return t.sort$long_A$java_lang_Object_A(e,n)
;if((null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)&&(null!=n&&n instanceof Array&&(0==n.length||null==n[0]||"number"==typeof n[0])||null===n)&&void 0===r&&void 0===i)return t.sort$long_A$int_A(e,n)
;throw new Error("invalid overload")}return t.sort$int_A$int_A$int$int(e,n,r,i)}return t.sort$long_A$int_A$int$int(e,n,r,i)}return t.sort$long_A$java_lang_Object_A$int$int(e,n,r,i)}return t.sort$java_lang_String_A$short_A$int$int(e,n,r,i)}
return t.sort$int_A$java_lang_Object_A$int$int(e,n,r,i)}static sort$java_lang_String_A$short_A(e,n){t.sort$java_lang_String_A$short_A$int$int(e,n,0,e.length-1)}static sort$java_lang_String_A$short_A$int$int(e,n,r,i){if(i<=r)return;const a=(r+i)/2|0
;let s=r;const o=e[a];e[a]=e[i],e[i]=o;const l=n[a];n[a]=n[i],n[i]=l;for(let t=r;t<i;t++)if(null==o||null!=e[t]&&e[t].localeCompare(o)<(1&t)){const r=e[t];e[t]=e[s],e[s]=r;const i=n[t];n[t]=n[s],n[s++]=i}e[i]=e[s],e[s]=o,n[i]=n[s],n[s]=l,
t.sort$java_lang_String_A$short_A$int$int(e,n,r,s-1),t.sort$java_lang_String_A$short_A$int$int(e,n,s+1,i)}static copyOfNullable$short_A(e){if(null==e)return null;{const n=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(e.length)
;return t.copy$short_A$int$short_A$int$int(e,0,n,0,e.length),n}}static copyOfNullable(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return t.copyOfNullable$short_A(e)
;if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return t.copyOfNullable$int_A(e);throw new Error("invalid overload")}static copyOf$short_A$int(e,n){const r=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(n)
;return t.copy$short_A$int$short_A$int$int(e,0,r,0,n),r}static copyOf(e,n){if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof n&&null!==n)throw new Error("invalid overload");return t.copyOf$float_A$int(e,n)}return t.copyOf$short_A$int(e,n)}
static copyOfNullable$int_A(e){if(null==e)return null;{const n=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(e.length);return t.copy$int_A$int$int_A$int$int(e,0,n,0,e.length),n}}static copyOf$float_A$int(e,n){const r=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(n);return t.copy$float_A$int$float_A$int$int(e,0,r,0,n),r}static sort$long_A$java_lang_Object_A$int$int(e,n,r,i){if(r>=i)return;const a=(i+r)/2|0;let s=r;const o=e[a];e[a]=e[i],e[i]=o;const l=n[a];n[a]=n[i],n[i]=l
;for(let t=r;t<i;t++)if(e[t]<((c=1&t)<0?Math.ceil(c):Math.floor(c))+o){const r=e[t];e[t]=e[s],e[s]=r;const i=n[t];n[t]=n[s],n[s++]=i}var c;e[i]=e[s],e[s]=o,n[i]=n[s],n[s]=l,t.sort$long_A$java_lang_Object_A$int$int(e,n,r,s-1),
t.sort$long_A$java_lang_Object_A$int$int(e,n,s+1,i)}static sort$long_A$java_lang_Object_A(e,n){t.sort$long_A$java_lang_Object_A$int$int(e,n,0,e.length-1)}static sort$long_A$int_A$int$int(e,n,r,i){if(i<=r)return;const a=(i+r)/2|0;let s=r;const o=e[a]
;e[a]=e[i],e[i]=o;const l=n[a];n[a]=n[i],n[i]=l;for(let t=r;t<i;t++)if(e[t]<((c=1&t)<0?Math.ceil(c):Math.floor(c))+o){const r=e[t];e[t]=e[s],e[s]=r;const i=n[t];n[t]=n[s],n[s++]=i}var c;e[i]=e[s],e[s]=o,n[i]=n[s],n[s]=l,
t.sort$long_A$int_A$int$int(e,n,r,s-1),t.sort$long_A$int_A$int$int(e,n,s+1,i)}static sort$long_A$int_A(e,n){t.sort$long_A$int_A$int$int(e,n,0,e.length-1)}static fillRange(e,t,n,r){const i=--n-7;let a=t-1;for(;a<i;)e[t=a+1]=r,e[++t]=r,e[++t]=r,
e[++t]=r,e[++t]=r,e[++t]=r,e[++t]=r,a=t+1,e[a]=r;for(;a<n;)a++,e[a]=r}static sort$int_A$int_A$int$int(e,n,r,i){if(r>=i)return;let a=r;const s=(i+r)/2|0,o=e[s];e[s]=e[i],e[i]=o;const l=n[s];n[s]=n[i],n[i]=l;for(let t=r;t<i;t++)if(e[t]>(1&t)+o){
const r=e[t];e[t]=e[a],e[a]=r;const i=n[t];n[t]=n[a],n[a++]=i}e[i]=e[a],e[a]=o,n[i]=n[a],n[a]=l,t.sort$int_A$int_A$int$int(e,n,r,a-1),t.sort$int_A$int_A$int$int(e,n,a+1,i)}}t.__class="ArrayUtils";class n{static smallBuffers_$LI$(){
return null==n.smallBuffers&&(n.smallBuffers=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(1e3)),n.smallBuffers}static mediumBuffers_$LI$(){return null==n.mediumBuffers&&(n.mediumBuffers=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(250)),
n.mediumBuffers}static largeBuffers_$LI$(){return null==n.largeBuffers&&(n.largeBuffers=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(50)),n.largeBuffers}static allocate(e){if(100===e&&n.smallBufferCount>0){
const e=n.smallBuffers_$LI$()[--n.smallBufferCount];return n.smallBuffers_$LI$()[n.smallBufferCount]=null,e}if(5e3===e&&n.mediumBufferCount>0){const e=n.mediumBuffers_$LI$()[--n.mediumBufferCount]
;return n.mediumBuffers_$LI$()[n.mediumBufferCount]=null,e}if(3e4===e&&n.largeBufferCount>0){const e=n.largeBuffers_$LI$()[--n.largeBufferCount];return n.largeBuffers_$LI$()[n.largeBufferCount]=null,e}return(e=>{let t=[];for(;e-- >0;)t.push(0)
;return t})(e)}}n.smallBufferCount=0,n.mediumBufferCount=0,n.largeBufferCount=0,n.__class="BufferPool";class r{constructor(e,t,n){this.singleRow=-1,this.size=0,this.recentlyUsed=new s,this.invalid=!1,void 0===this.capacity&&(this.capacity=0),
void 0===this.height&&(this.height=0),void 0===this.entries&&(this.entries=null),void 0===this.pixels&&(this.pixels=null),this.capacity=e,this.height=t,this.entries=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(this.height),
this.pixels=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([this.capacity,3,n])}clear(){for(let e=0;e<this.capacity;e++)this.pixels[e][0]=null,
this.pixels[e][1]=null,this.pixels[e][2]=null,this.pixels[e]=null;this.pixels=null,this.entries=null,this.recentlyUsed.clear(),this.recentlyUsed=null}get$(){
if(this.capacity!==this.height)throw Object.defineProperty(new Error("Can only retrieve a full image cache"),"__classes",{configurable:!0,value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})
;for(let e=0;e<this.capacity;e++)this.entries[e]=g.VALID_$LI$();return this.pixels}get$int(e){if(this.height===this.capacity)return this.invalid=null==this.entries[e],this.entries[e]=g.VALID_$LI$(),this.pixels[e]
;if(1===this.capacity)return this.invalid=e!==this.singleRow,this.singleRow=e,this.pixels[0];{let t=this.entries[e];if(null==t){if(this.invalid=!0,this.capacity<=this.size){const n=this.recentlyUsed.tail();t=new g(e,n.index),this.entries[n.row]=null,
n.unlink()}else t=new g(e,this.size),this.size++;this.entries[e]=t}else this.invalid=!1;return this.recentlyUsed.addHead(t),this.pixels[t.index]}}get(e){if("number"==typeof e||null===e)return this.get$int(e);if(void 0===e)return this.get$()
;throw new Error("invalid overload")}}r.__class="ColorImageCache";class i{constructor(e){void 0===this.searchCursor&&(this.searchCursor=null),void 0===this.searchKey&&(this.searchKey=0),void 0===this.iteratorCursor&&(this.iteratorCursor=null),
this.iteratorBucket=0,void 0===this.buckets&&(this.buckets=null),void 0===this.bucketCount&&(this.bucketCount=0),this.buckets=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(e),this.bucketCount=e;for(let t=0;t<e;t++){const e=this.buckets[t]=new c
;e.prev=e,e.next=e}}getBucketCount(){return this.bucketCount}put(e,t){null!=t.prev&&t.unlink();const n=this.buckets[e&(r=this.bucketCount-1,r<0?Math.ceil(r):Math.floor(r))];var r;t.key=e,t.next=n,t.prev=n.prev,t.prev.next=t,t.next.prev=t}size(){
let e=0;for(let t=0;t<this.bucketCount;t++){const n=this.buckets[t];for(let t=n.next;t!==n;t=t.next)e++}return e}head(){return this.iteratorBucket=0,this.next()}next(){
if(this.iteratorBucket>0&&this.buckets[this.iteratorBucket-1]!==this.iteratorCursor){const e=this.iteratorCursor;return this.iteratorCursor=e.next,e}let e;do{if(this.iteratorBucket>=this.bucketCount)return null
;e=this.buckets[this.iteratorBucket++].next}while(e===this.buckets[this.iteratorBucket-1]);return this.iteratorCursor=e.next,e}get(e){this.searchKey=e;const t=this.buckets[e&(n=this.bucketCount-1,n<0?Math.ceil(n):Math.floor(n))];var n
;for(this.searchCursor=t.next;this.searchCursor!==t;this.searchCursor=this.searchCursor.next)if(this.searchCursor.key===e){const e=this.searchCursor;return this.searchCursor=this.searchCursor.next,e}return this.searchCursor=null,null}toArray(e){
let t=0;for(let n=0;n<this.bucketCount;n++){const r=this.buckets[n];for(let n=r.next;n!==r;n=n.next)e[t++]=n}return t}nextWithKey(){if(null==this.searchCursor)return null;const e=this.buckets[0|(t=this.bucketCount-1,
(t<0?Math.ceil(t):Math.floor(t))&this.searchKey)];for(var t;e!==this.searchCursor;){if(this.searchKey===this.searchCursor.key){const e=this.searchCursor;return this.searchCursor=this.searchCursor.next,e}this.searchCursor=this.searchCursor.next}
return this.searchCursor=null,null}clear(){for(let e=0;e<this.bucketCount;e++){const t=this.buckets[e];for(;;){const e=t.next;if(e===t)break;e.unlink()}}this.iteratorCursor=null,this.searchCursor=null}}i.__class="HashTable";class a{static clp2(e){
return e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,1+((e|=e>>>8)|e>>>16)}static flp2(e){let t=e>>>1;return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,e&~t}static isPowerOfTwo(e){return e===(e&-e)}static bitCount(e){let t=0;return(e<0||e>=65536)&&(e>>>=16,
t+=16),e>=256&&(e>>>=8,t+=8),e>=16&&(e>>>=4,t+=4),e>=4&&(t+=2,e>>>=2),e>=1&&(t++,e>>>=1),t+e}static bitCountFast(e){return e=((e=(858993459&(e=(e>>>1&1431655765)+(1431655765&e)))+(e>>>2&-1288490189))>>>4)+e&252645135,255&(e+=e>>>8)+(e>>>16)}
static signum(e){return e>0?1:e<0?-1:0}static toString(e){return e<0?""+e:a.toStringInternal(e)}static toStringInternal(e){if(e<0)return""+e;let t=2;for(let r=e/10|0;0!==r;r=(n=r/10)<0?Math.ceil(n):Math.floor(n))t++;var n;const r=(e=>{let t=[]
;for(;e-- >0;)t.push(null);return t})(t);r[0]="+";for(let n=t-1;n>0;n--){const t=e-10*(e=(e=>e<0?Math.ceil(e):Math.floor(e))(e/10));r[n]=t>=10?String.fromCharCode(t+87):String.fromCharCode(t+48)}return r.join("")}static bitReverse(e,t){let n=0
;for(;t>0;)n=1&e|n<<1,e>>>=1,t--;return n}static pow(e,t){let n=1;for(;t>1;)!!(1&t)&&(n*=e),t>>=1,e*=e;return 1===t?e*n:n}static clamp(e,t,n){return e<t?t:e>n?n:e}}a.__class="IntUtils";class s{constructor(){void 0===this.cursor&&(this.cursor=null),
this.sentinel=new c,this.sentinel.next=this.sentinel,this.sentinel.prev=this.sentinel}static insertBefore(e,t){null!=e.prev&&e.unlink(),e.next=t,e.prev=t.prev,e.prev.next=e,e.next.prev=e}clear(){for(;;){const e=this.sentinel.next
;if(this.sentinel===e)return void(this.cursor=null);e.unlink()}}addHead(e){null!=e.prev&&e.unlink(),e.prev=this.sentinel,e.next=this.sentinel.next,e.prev.next=e,e.next.prev=e}removeHead(){const e=this.sentinel.next
;return e===this.sentinel?null:(e.unlink(),e)}isEmpty(){return this.sentinel.next===this.sentinel}head(){const e=this.sentinel.next;return e===this.sentinel?(this.cursor=null,null):(this.cursor=e.next,e)}addTail(e){null!=e.prev&&e.unlink(),
e.prev=this.sentinel.prev,e.next=this.sentinel,e.prev.next=e,e.next.prev=e}tail(){const e=this.sentinel.prev;return e===this.sentinel?(this.cursor=null,null):(this.cursor=e.prev,e)}prev(){const e=this.cursor
;return e===this.sentinel?(this.cursor=null,null):(this.cursor=e.prev,e)}next(){const e=this.cursor;return this.sentinel===e?(this.cursor=null,null):(this.cursor=e.next,e)}}s.__class="LinkedList";class o{constructor(e){let t
;for(this.aClass4_Sub3_18=new v,this.queue=new d,void 0===this.available&&(this.available=0),void 0===this.capacity&&(this.capacity=0),void 0===this.table&&(this.table=null),this.available=e,t=1;t+t<e;t+=t);this.capacity=e,this.table=new i(t)}head(){
return this.table.head()}put(e,t){if(0===this.available){const e=this.queue.removeHead();if(e.unlink(),e.unlinkSecondary(),this.aClass4_Sub3_18===e){const e=this.queue.removeHead();e.unlink(),e.unlinkSecondary()}}else this.available--
;this.table.put(e,t),this.queue.addTail(t)}get(e){const t=this.table.get(e);return null!=t&&this.queue.addTail(t),t}next(){return this.table.next()}clear(){this.queue.clear(),this.table.clear(),this.aClass4_Sub3_18=new v,this.available=this.capacity}
}o.__class="LruHashTable";class l{static sub10_method283(e,t,n,r,i,a,s,o,c){if(c===i&&n===o&&a===s&&t===e)return void l.sub9_method280(e,c,n,r,s);let u=c,h=n
;const d=3*c,p=3*n,f=3*i,m=3*a,g=3*o,_=3*t,v=f+s-c-m,y=g+e-_-n,b=m+d-f-f,x=_+p-g-g,E=g-p,w=f-d;for(let e=128;e<=4096;e+=128){const t=e*e>>12,i=e*t>>12,a=(w*e+t*b+i*v>>12)+c,s=(E*e+y*i+x*t>>12)+n;l.sub9_method280(s,u,h,r,a),u=a,h=s}}
static sub22_method4693(e,t,n,r,i,a,s,o,c){
l.sub2_anInt902<=c&&c<=l.sub3_anInt2553&&l.sub2_anInt902<=e&&l.sub3_anInt2553>=e&&l.sub2_anInt902<=r&&l.sub3_anInt2553>=r&&l.sub2_anInt902<=i&&i<=l.sub3_anInt2553&&a>=l.sub4_anInt3086&&a<=l.sub5_anInt4230&&t>=l.sub4_anInt3086&&l.sub5_anInt4230>=t&&o>=l.sub4_anInt3086&&l.sub5_anInt4230>=o&&l.sub4_anInt3086<=s&&l.sub5_anInt4230>=s?l.sub10_method283(s,o,a,n,e,r,i,t,c):l.sub31_method3662(c,o,i,e,t,a,s,n,r)
}static sub9_method280(e,t,n,r,i){let a=e-n,s=i-t;if(0===s)0!==a&&l.sub10_method306(t,r,e,n);else if(0===a)l.sub20_method1975(t,i,r,n);else{s<0&&(s=-s),a<0&&(a=-a);const o=a>s;if(o){const r=t;t=n,n=r;const a=i;i=e,e=a}if(i<t){const r=t;t=i;const a=n
;n=e,e=a,i=r}let c=n;const u=i-t;let h=e-n;const d=e>n?1:-1;h<0&&(h=-h);let p=-(u>>1);if(o)for(let e=t;e<=i;e++)p+=h,l.sub5_anIntArrayArray36[e][c]=r,p>0&&(c+=d,p-=u);else for(let e=t;e<=i;e++)p+=h,l.sub5_anIntArrayArray36[c][e]=r,p>0&&(c+=d,p-=u)}}
static sub10_method306(e,t,n,r){if(n>=r)for(let i=r;i<n;i++)l.sub5_anIntArrayArray36[i][e]=t;else for(let i=n;i<r;i++)l.sub5_anIntArrayArray36[i][e]=t}static sub20_method1975(e,n,r,i){
n>=e?t.fillRange(l.sub5_anIntArrayArray36[i],e,n,r):t.fillRange(l.sub5_anIntArrayArray36[i],n,e,r)}static sub31_method3662(e,t,n,r,i,a,s,o,c){if(r===e&&i===a&&c===n&&t===s)return void l.sub32_method4022(a,s,o,e,n);let u=e,h=a
;const d=3*e,p=3*i,f=3*r,m=3*c,g=n+f-e-m,_=3*a,v=d+m-f-f,y=3*t,b=y+_-p-p,x=p+s-a-y,E=f-d,w=p-_;for(let t=128;t<=4096;t+=128){const n=t*t>>12,r=t*n>>12,i=(E*t+n*v+r*g>>12)+e,s=(w*t+x*r+b*n>>12)+a;l.sub32_method4022(h,s,o,u,i),h=s,u=i}}
static sub32_method4022(e,t,n,r,i){const a=i-r,s=t-e;if(0===a)0!==s&&l.sub20_method1930(r,e,t,n);else if(0===s)l.sub13_method1015(r,i,n,e);else{const o=(s<<12)/a|0,c=e-(r*o>>12);let u,h,d,p;r<l.sub2_anInt902?(h=c+(l.sub2_anInt902*o>>12),
u=l.sub2_anInt902):l.sub3_anInt2553>=r?(u=r,h=e):(u=l.sub3_anInt2553,h=(l.sub3_anInt2553*o>>12)+c),i<l.sub2_anInt902?(d=l.sub2_anInt902,p=c+(l.sub2_anInt902*o>>12)):i<=l.sub3_anInt2553?(d=i,p=t):(d=l.sub3_anInt2553,p=(o*l.sub3_anInt2553>>12)+c),
l.sub4_anInt3086>p?(d=(l.sub4_anInt3086-c<<12)/o|0,p=l.sub4_anInt3086):l.sub5_anInt4230<p&&(d=(l.sub5_anInt4230-c<<12)/o|0,p=l.sub5_anInt4230),l.sub4_anInt3086>h?(u=(l.sub4_anInt3086-c<<12)/o|0,
h=l.sub4_anInt3086):h>l.sub5_anInt4230&&(h=l.sub5_anInt4230,u=(l.sub5_anInt4230-c<<12)/o|0),l.sub9_method280(p,u,h,n,d)}}static sub20_method1930(e,t,n,r){l.sub2_anInt902<=e&&l.sub3_anInt2553>=e&&(t=a.clamp(t,l.sub4_anInt3086,l.sub5_anInt4230),
n=a.clamp(n,l.sub4_anInt3086,l.sub5_anInt4230),l.sub10_method306(e,r,n,t))}static sub13_method1015(e,t,n,r){l.sub4_anInt3086<=r&&r<=l.sub5_anInt4230&&(e=a.clamp(e,l.sub2_anInt902,l.sub3_anInt2553),t=a.clamp(t,l.sub2_anInt902,l.sub3_anInt2553),
l.sub20_method1975(e,t,n,r))}static sub36_method4566(e,t,n,r,i,a,s){e>=l.sub2_anInt902&&a<=l.sub3_anInt2553&&l.sub4_anInt3086<=s&&i<=l.sub5_anInt4230?l.sub9_method758(t,a,s,e,i,n,r):l.sub22_method2190(i,r,n,t,e,a,s)}
static sub9_method758(e,n,r,i,a,s,o){const c=r+o,u=a-o,h=i+o,d=n-o;for(let a=r;a<c;a++)t.fillRange(l.sub5_anIntArrayArray36[a],i,n,e);for(let r=a;r>u;r--)t.fillRange(l.sub5_anIntArrayArray36[r],i,n,e);for(let r=c;r<=u;r++){
const a=l.sub5_anIntArrayArray36[r];t.fillRange(a,i,h,e),t.fillRange(a,h,d,s),t.fillRange(a,d,n,e)}}static sub22_method2190(e,n,r,i,s,o,c){
const u=a.clamp(c,l.sub4_anInt3086,l.sub5_anInt4230),h=a.clamp(e,l.sub4_anInt3086,l.sub5_anInt4230),d=a.clamp(s,l.sub2_anInt902,l.sub3_anInt2553),p=a.clamp(o,l.sub2_anInt902,l.sub3_anInt2553),f=a.clamp(c+n,l.sub4_anInt3086,l.sub5_anInt4230),m=a.clamp(e-n,l.sub4_anInt3086,l.sub5_anInt4230)
;for(let e=u;e<f;e++)t.fillRange(l.sub5_anIntArrayArray36[e],d,p,i);for(let e=h;e>m;e--)t.fillRange(l.sub5_anIntArrayArray36[e],d,p,i);const g=a.clamp(s+n,l.sub2_anInt902,l.sub3_anInt2553),_=a.clamp(o-n,l.sub2_anInt902,l.sub3_anInt2553)
;for(let e=f;e<=m;e++){const n=l.sub5_anIntArrayArray36[e];t.fillRange(n,d,g,i),t.fillRange(n,g,_,r),t.fillRange(n,_,p,i)}}static sub32_method3997(e,t,n,r,i,a){
e>=l.sub2_anInt902&&l.sub3_anInt2553>=a&&n>=l.sub4_anInt3086&&l.sub5_anInt4230>=i?1===r?l.sub27_method4706(t,e,a,n,i):l.sub14_method1200(t,e,i,a,r,n):1===r?l.sub27_method4241(a,i,n,t,e):l.sub31_method3781(a,t,r,e,n,i)}
static sub31_method3781(e,n,r,i,s,o){
const c=a.clamp(s,l.sub4_anInt3086,l.sub5_anInt4230),u=a.clamp(o,l.sub4_anInt3086,l.sub5_anInt4230),h=a.clamp(i,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(e,l.sub2_anInt902,l.sub3_anInt2553),p=a.clamp(r+s,l.sub4_anInt3086,l.sub5_anInt4230),f=a.clamp(o-r,l.sub4_anInt3086,l.sub5_anInt4230)
;for(let e=c;e<p;e++)t.fillRange(l.sub5_anIntArrayArray36[e],h,d,n);for(let e=u;e>f;e--)t.fillRange(l.sub5_anIntArrayArray36[e],h,d,n);const m=a.clamp(i+r,l.sub2_anInt902,l.sub3_anInt2553),g=a.clamp(e-r,l.sub2_anInt902,l.sub3_anInt2553)
;for(let e=p;e<=f;e++){const r=l.sub5_anIntArrayArray36[e];t.fillRange(r,h,m,n),t.fillRange(r,g,d,n)}}static sub27_method4241(e,n,r,i,a){if(l.sub5_anInt4230<r||l.sub4_anInt3086>n)return;let s,o,c,u;if(l.sub2_anInt902>a?(a=l.sub2_anInt902,
s=!1):a>l.sub3_anInt2553?(a=l.sub3_anInt2553,s=!1):s=!0,e<l.sub2_anInt902?(e=l.sub2_anInt902,o=!1):l.sub3_anInt2553<e?(e=l.sub3_anInt2553,o=!1):o=!0,l.sub4_anInt3086<=r?(c=r+1,t.fillRange(l.sub5_anIntArrayArray36[r],a,e,i)):c=l.sub4_anInt3086,
l.sub5_anInt4230<n?u=l.sub5_anInt4230:(u=n-1,t.fillRange(l.sub5_anIntArrayArray36[n],a,e,i)),s&&o)for(let t=c;t<=u;t++){const n=l.sub5_anIntArrayArray36[t];n[a]=n[e]=i
}else if(s)for(let e=c;e<=u;e++)l.sub5_anIntArrayArray36[e][a]=i;else if(o)for(let t=c;t<=u;t++)l.sub5_anIntArrayArray36[t][e]=i}static sub27_method4706(e,n,r,i,a){t.fillRange(l.sub5_anIntArrayArray36[i++],n,r,e),
t.fillRange(l.sub5_anIntArrayArray36[a--],n,r,e);for(let t=i;t<=a;t++){const i=l.sub5_anIntArrayArray36[t];i[n]=i[r]=e}}static sub14_method1200(e,n,r,i,a,s){const o=a+s,c=r-a,u=a+n;for(let r=s;r<o;r++)t.fillRange(l.sub5_anIntArrayArray36[r],n,i,e)
;for(let a=r;a>c;a--)t.fillRange(l.sub5_anIntArrayArray36[a],n,i,e);const h=i-a;for(let r=o;r<=c;r++){const a=l.sub5_anIntArrayArray36[r];t.fillRange(a,n,u,e),t.fillRange(a,h,i,e)}}static sub29_method3429(e,t,n,r,i){
l.sub2_anInt902<=e&&n<=l.sub3_anInt2553&&l.sub4_anInt3086<=r&&t<=l.sub5_anInt4230?l.sub15_method1477(r,e,t,i,n):l.sub22_method4701(e,n,r,i,t)}static sub15_method1477(e,n,r,i,a){for(let s=e;s<=r;s++)t.fillRange(l.sub5_anIntArrayArray36[s],n,a,i)}
static sub22_method4701(e,n,r,i,s){const o=a.clamp(r,l.sub4_anInt3086,l.sub5_anInt4230),c=a.clamp(s,l.sub4_anInt3086,l.sub5_anInt4230),u=a.clamp(e,l.sub2_anInt902,l.sub3_anInt2553),h=a.clamp(n,l.sub2_anInt902,l.sub3_anInt2553)
;for(let e=o;e<=c;e++)t.fillRange(l.sub5_anIntArrayArray36[e],u,h,i)}static sub18_method1745(e,t,n,r,i,a,s){
e===s?l.sub8_method100(e,r,a,t,n,i):n-e>=l.sub2_anInt902&&l.sub3_anInt2553>=e+n&&a-s>=l.sub4_anInt3086&&s+a<=l.sub5_anInt4230?l.sub10_method388(n,i,r,a,e,t,s):l.sub32_method4031(t,r,n,s,a,e,i)}static sub32_method4031(e,n,r,i,s,o,c){let u=0
;const h=i-c;let d=i,p=0;const f=o-c,m=o*o,g=i*i,_=f*f,v=g<<1,y=h*h,b=m<<1,x=y<<1,E=_<<1,w=i<<1,S=h<<1;let T=v+(1-w)*m,A=g-(w-1)*b,C=_*(1-S)+x;const M=m<<2;let I=y-E*(S-1);const R=g<<2,k=_<<2,N=y<<2
;let D=3*v,L=3*x,O=b*(w-3),P=R,F=(S-3)*E,U=M*(i-1),B=N,z=(h-1)*k;if(s>=l.sub4_anInt3086&&l.sub5_anInt4230>=s){
const i=l.sub5_anIntArrayArray36[s],c=a.clamp(r-o,l.sub2_anInt902,l.sub3_anInt2553),u=a.clamp(r+o,l.sub2_anInt902,l.sub3_anInt2553),h=a.clamp(r-f,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(r+f,l.sub2_anInt902,l.sub3_anInt2553);t.fillRange(i,c,h,n),
t.fillRange(i,h,d,e),t.fillRange(i,d,u,n)}for(;d>0;){if(T<0)for(;T<0;)T+=D,u++,D+=R,A+=P,P+=R;A<0&&(u++,T+=D,D+=R,A+=P,P+=R);const i=h>=d;if(A+=-O,d--,i){if(C<0)for(;C<0;)C+=L,I+=B,L+=N,B+=N,p++;I<0&&(C+=L,L+=N,I+=B,B+=N,p++),I+=-F,F-=k,C+=-z,z-=k}
T+=-U;const o=d+s,c=s-d;if(U-=M,O-=M,o>=l.sub4_anInt3086&&l.sub5_anInt4230>=c){const s=a.clamp(u+r,l.sub2_anInt902,l.sub3_anInt2553),h=a.clamp(r-u,l.sub2_anInt902,l.sub3_anInt2553);if(i){
const i=a.clamp(r+p,l.sub2_anInt902,l.sub3_anInt2553),u=a.clamp(r-p,l.sub2_anInt902,l.sub3_anInt2553);if(l.sub4_anInt3086<=c){const r=l.sub5_anIntArrayArray36[c];t.fillRange(r,h,u,n),t.fillRange(r,u,i,e),t.fillRange(r,i,s,n)}if(l.sub5_anInt4230>=o){
const r=l.sub5_anIntArrayArray36[o];t.fillRange(r,h,u,n),t.fillRange(r,u,i,e),t.fillRange(r,i,s,n)}}else c>=l.sub4_anInt3086&&t.fillRange(l.sub5_anIntArrayArray36[c],h,s,n),l.sub5_anInt4230>=o&&t.fillRange(l.sub5_anIntArrayArray36[o],h,s,n)}}}
static sub10_method388(e,n,r,i,a,s,o){let c=0,u=o;const h=a-n;let d=0;const p=o-n,f=a*a,m=o*o,g=h*h,_=p*p,v=m<<1,y=_<<1,b=f<<1,x=g<<1,E=o<<1,w=p<<1;let S=f*(1-E)+v,T=m-b*(E-1),A=y+(1-w)*g,C=_-x*(w-1);const M=f<<2,I=m<<2,R=_<<2,k=g<<2
;let N=3*v,D=b*(E-3),L=3*y,O=I,P=(w-3)*x,F=R,U=(o-1)*M,B=k*(p-1);const z=l.sub5_anIntArrayArray36[i];for(t.fillRange(z,e-a,e-h,r),t.fillRange(z,e-h,h+e,s),t.fillRange(z,h+e,e+a,r);u>0;){if(S<0)for(;S<0;)S+=N,N+=I,c++,T+=O,O+=I;T<0&&(S+=N,T+=O,N+=I,
c++,O+=I),S+=-U;const n=e-c,a=p>=u,o=e+c;U-=M,u--,T+=-D;const h=u+i;if(D-=M,a){if(A<0)for(;A<0;)d++,C+=F,A+=L,F+=R,L+=R;C<0&&(A+=L,L+=R,d++,C+=F,F+=R),C+=-P,A+=-B,B-=k,P-=k}const f=i-u;if(a){const i=e-d;t.fillRange(l.sub5_anIntArrayArray36[f],n,i,r)
;const a=e+d;t.fillRange(l.sub5_anIntArrayArray36[f],i,a,s),t.fillRange(l.sub5_anIntArrayArray36[f],a,o,r),t.fillRange(l.sub5_anIntArrayArray36[h],n,i,r),t.fillRange(l.sub5_anIntArrayArray36[h],i,a,s),t.fillRange(l.sub5_anIntArrayArray36[h],a,o,r)
}else t.fillRange(l.sub5_anIntArrayArray36[f],n,o,r),t.fillRange(l.sub5_anIntArrayArray36[h],n,o,r)}}static sub8_method100(e,t,n,r,i,a){
l.sub2_anInt902<=i-e&&e+i<=l.sub3_anInt2553&&n-e>=l.sub4_anInt3086&&l.sub5_anInt4230>=e+n?l.sub10_method896(a,t,e,r,i,n):l.sub14_method1082(e,a,i,t,r,n)}static sub32_method3885(e){
(null==l.sub7_anIntArray678||l.sub7_anIntArray678.length<e)&&(l.sub7_anIntArray678=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(e))}static sub14_method1082(e,n,r,i,s,o){l.sub32_method3885(e);let c=e-n,u=e,h=0,d=-e;c<0&&(c=0);let p=c
;if(l.sub4_anInt3086<=o&&o<=l.sub5_anInt4230){
const n=l.sub5_anIntArrayArray36[o],u=a.clamp(r-e,l.sub2_anInt902,l.sub3_anInt2553),h=a.clamp(e+r,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(r-c,l.sub2_anInt902,l.sub3_anInt2553),p=a.clamp(r+c,l.sub2_anInt902,l.sub3_anInt2553);t.fillRange(n,u,d,i),
t.fillRange(n,d,p,s),t.fillRange(n,p,h,i)}let f=-c,m=-1,g=-1;for(;h<u;){if(m+=2,f+=m,g+=2,f>=0&&p>=1&&(p--,f-=p<<1,l.sub7_anIntArray678[p]=h),h++,d+=g,d>=0){u--,d-=u<<1;const e=o-u,n=o+u;if(l.sub4_anInt3086<=n&&e<=l.sub5_anInt4230)if(u>=c){
const s=a.clamp(r+h,l.sub2_anInt902,l.sub3_anInt2553),o=a.clamp(r-h,l.sub2_anInt902,l.sub3_anInt2553);l.sub5_anInt4230>=n&&t.fillRange(l.sub5_anIntArrayArray36[n],o,s,i),e>=l.sub4_anInt3086&&t.fillRange(l.sub5_anIntArrayArray36[e],o,s,i)}else{
const o=l.sub7_anIntArray678[u],c=a.clamp(r+h,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(r-h,l.sub2_anInt902,l.sub3_anInt2553),p=a.clamp(r+o,l.sub2_anInt902,l.sub3_anInt2553),f=a.clamp(r-o,l.sub2_anInt902,l.sub3_anInt2553);if(l.sub5_anInt4230>=n){
const e=l.sub5_anIntArrayArray36[n];t.fillRange(e,d,f,i),t.fillRange(e,f,p,s),t.fillRange(e,p,c,i)}if(l.sub4_anInt3086<=e){const n=l.sub5_anIntArrayArray36[e];t.fillRange(n,d,f,i),t.fillRange(n,f,p,s),t.fillRange(n,p,c,i)}}}const e=o+h,n=o-h
;if(l.sub4_anInt3086<=e&&l.sub5_anInt4230>=n){const o=u+r,d=r-u;if(o>=l.sub2_anInt902&&l.sub3_anInt2553>=d){const u=a.clamp(o,l.sub2_anInt902,l.sub3_anInt2553),f=a.clamp(d,l.sub2_anInt902,l.sub3_anInt2553)
;if(h>=c)l.sub5_anInt4230>=e&&t.fillRange(l.sub5_anIntArrayArray36[e],f,u,i),l.sub4_anInt3086<=n&&t.fillRange(l.sub5_anIntArrayArray36[n],f,u,i);else{
const o=p>=h?p:l.sub7_anIntArray678[h],c=a.clamp(r+o,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(r-o,l.sub2_anInt902,l.sub3_anInt2553);if(l.sub5_anInt4230>=e){const n=l.sub5_anIntArrayArray36[e];t.fillRange(n,f,d,i),t.fillRange(n,d,c,s),
t.fillRange(n,c,u,i)}if(l.sub4_anInt3086<=n){const e=l.sub5_anIntArrayArray36[n];t.fillRange(e,f,d,i),t.fillRange(e,d,c,s),t.fillRange(e,c,u,i)}}}}}}static sub10_method896(e,n,r,i,a,s){l.sub32_method3885(r);let o=0,c=-r,u=r-e,h=r,d=-1,p=-1
;const f=l.sub5_anIntArrayArray36[s];u<0&&(u=0);let m=u;const g=a-u;t.fillRange(f,a-r,g,n);const _=u+a;let v=-u;for(t.fillRange(f,g,_,i),t.fillRange(f,_,a+r,n);h>o;){if(p+=2,c+=p,d+=2,v+=d,v>=0&&m>=1&&(l.sub7_anIntArray678[m]=o,m--,v-=m<<1),o++,
c>=0){if(h--,h>=u){const e=l.sub5_anIntArrayArray36[s+h],r=a+o,i=l.sub5_anIntArrayArray36[s-h],c=a-o;t.fillRange(e,c,r,n),t.fillRange(i,c,r,n)}else{
const e=l.sub5_anIntArrayArray36[h+s],r=l.sub7_anIntArray678[h],c=l.sub5_anIntArrayArray36[s-h],u=o+a,d=a-r,p=r+a,f=a-o;t.fillRange(e,f,d,n),t.fillRange(e,d,p,i),t.fillRange(e,p,u,n),t.fillRange(c,f,d,n),t.fillRange(c,d,p,i),t.fillRange(c,p,u,n)}
c-=h<<1}const e=l.sub5_anIntArrayArray36[s+o],r=l.sub5_anIntArrayArray36[s-o],f=h+a,g=a-h;if(u<=o)t.fillRange(e,g,f,n),t.fillRange(r,g,f,n);else{const s=o>m?l.sub7_anIntArray678[o]:m,c=s+a,u=a-s;t.fillRange(e,g,u,n),t.fillRange(e,u,c,i),
t.fillRange(e,c,f,n),t.fillRange(r,g,u,n),t.fillRange(r,u,c,i),t.fillRange(r,c,f,n)}}}static sub28_method3323(e,t,n,r,i){
e===i?l.sub32_method4032(i,n,r,t):l.sub2_anInt902<=t-i&&l.sub3_anInt2553>=t+i&&r-e>=l.sub4_anInt3086&&l.sub5_anInt4230>=r+e?l.sub19_method4379(e,t,n,r,i):l.sub26_method4814(r,e,n,i,t)}static sub32_method4032(e,t,n,r){
r-e>=l.sub2_anInt902&&l.sub3_anInt2553>=r+e&&n-e>=l.sub4_anInt3086&&n+e<=l.sub5_anInt4230?l.sub11_method565(n,r,e,t):l.sub29_method3463(n,r,e,t)}static sub29_method3463(e,n,r,i){let s=0,o=r,c=-1,u=-r
;const h=a.clamp(r+n,l.sub2_anInt902,l.sub3_anInt2553),d=a.clamp(n-r,l.sub2_anInt902,l.sub3_anInt2553);for(t.fillRange(l.sub5_anIntArrayArray36[e],d,h,i);o>s;){if(c+=2,u+=c,u>0){o--,u-=o<<1;const r=e-o,c=o+e
;if(c>=l.sub4_anInt3086&&r<=l.sub5_anInt4230){const e=a.clamp(n+s,l.sub2_anInt902,l.sub3_anInt2553),o=a.clamp(n-s,l.sub2_anInt902,l.sub3_anInt2553);l.sub5_anInt4230>=c&&t.fillRange(l.sub5_anIntArrayArray36[c],o,e,i),
l.sub4_anInt3086<=r&&t.fillRange(l.sub5_anIntArrayArray36[r],o,e,i)}}s++;const r=e-s,h=e+s;if(l.sub4_anInt3086<=h&&r<=l.sub5_anInt4230){const e=a.clamp(n+o,l.sub2_anInt902,l.sub3_anInt2553),s=a.clamp(n-o,l.sub2_anInt902,l.sub3_anInt2553)
;h<=l.sub5_anInt4230&&t.fillRange(l.sub5_anIntArrayArray36[h],s,e,i),l.sub4_anInt3086<=r&&t.fillRange(l.sub5_anIntArrayArray36[r],s,e,i)}}}static sub11_method565(e,n,r,i){t.fillRange(l.sub5_anIntArrayArray36[e],n-r,r+n,i);let a=0,s=r,o=-r,c=-1
;for(;s>a;){if(c+=2,a++,o+=c,o>=0){s--,o-=s<<1;const r=l.sub5_anIntArrayArray36[e-s],c=l.sub5_anIntArrayArray36[e+s],u=n-a,h=n+a;t.fillRange(c,u,h,i),t.fillRange(r,u,h,i)}
const r=n+s,u=n-s,h=l.sub5_anIntArrayArray36[e+a],d=l.sub5_anIntArrayArray36[e-a];t.fillRange(h,u,r,i),t.fillRange(d,u,r,i)}}static sub19_method4379(e,n,r,i,a){t.fillRange(l.sub5_anIntArrayArray36[i],n-a,a+n,r);let s=0,o=e
;const c=a*a,u=e*e,h=c<<1,d=e<<1,p=u<<1;let f=u-h*(d-1),m=p+(1-d)*c;const g=c<<2;let _=3*p,v=h*((e<<1)-3);const y=u<<2;let b=y,x=(e-1)*g;for(;o>0;){if(m<0)for(;m<0;)s++,m+=_,f+=b,b+=y,_+=y;o--,f<0&&(f+=b,m+=_,_+=y,b+=y,s++);const e=i-o;m+=-x
;const a=n+s;x-=g;const c=o+i;f+=-v,v-=g;const u=n-s;t.fillRange(l.sub5_anIntArrayArray36[e],u,a,r),t.fillRange(l.sub5_anIntArrayArray36[c],u,a,r)}}static sub26_method4814(e,n,r,i,s){let o=n,c=0;const u=n*n,h=i*i,d=h<<1,p=u<<1,f=n<<1
;let m=u-(f-1)*d,g=(1-f)*h+p;const _=h<<2,v=u<<2;let y=3*p,b=v,x=((n<<1)-3)*d;if(e>=l.sub4_anInt3086&&l.sub5_anInt4230>=e){const n=a.clamp(s+i,l.sub2_anInt902,l.sub3_anInt2553),o=a.clamp(s-i,l.sub2_anInt902,l.sub3_anInt2553)
;t.fillRange(l.sub5_anIntArrayArray36[e],o,n,r)}let E=_*(n-1);for(;o>0;){if(g<0)for(;g<0;)g+=y,m+=b,b+=v,y+=v,c++;o--,m<0&&(m+=b,b+=v,g+=y,c++,y+=v),g+=-E;const n=e-o;m+=-x,E-=_;const i=o+e;if(x-=_,i>=l.sub4_anInt3086&&l.sub5_anInt4230>=n){
const e=a.clamp(c+s,l.sub2_anInt902,l.sub3_anInt2553),o=a.clamp(s-c,l.sub2_anInt902,l.sub3_anInt2553);l.sub4_anInt3086<=n&&t.fillRange(l.sub5_anIntArrayArray36[n],o,e,r),i<=l.sub5_anInt4230&&t.fillRange(l.sub5_anIntArrayArray36[i],o,e,r)}}}
static sub18_method4374(e,t){l.sub5_anInt4230=e,l.sub3_anInt2553=t,l.sub4_anInt3086=0,l.sub2_anInt902=0}static sub35_method4335(e){l.sub5_anIntArrayArray36=e}}l.sub5_anInt4230=100,l.sub4_anInt3086=0,l.sub7_anIntArray678=null,l.sub3_anInt2553=100,
l.sub2_anInt902=0,l.sub5_anIntArrayArray36=null,l.__class="MergedStatics";class c{constructor(){void 0===this.prev&&(this.prev=null),void 0===this.next&&(this.next=null),void 0===this.key&&(this.key=0)}isLinked(){return null!=this.prev}unlink(){
null!=this.prev&&(this.prev.next=this.next,this.next.prev=this.prev,this.prev=null,this.next=null)}}c.__class="Node";class u{constructor(e){if("number"==typeof e||null===e)void 0===this.nextNextGaussian&&(this.nextNextGaussian=0),
void 0===this.seedhi&&(this.seedhi=0),void 0===this.seedlo&&(this.seedlo=0),this.haveNextNextGaussian=!1,this.setSeed$long(e);else{if(void 0!==e)throw new Error("invalid overload");{void 0===this.nextNextGaussian&&(this.nextNextGaussian=0),
void 0===this.seedhi&&(this.seedhi=0),void 0===this.seedlo&&(this.seedlo=0),this.haveNextNextGaussian=!1;const e=u.uniqueSeed+++Date.now(),t=16777215&Math.floor(e*u.twoToTheMinus24),n=e-t*u.twoToThe24|0;this.setSeed$int$int(t,n)}}}
static __static_initialize(){u.__static_initialized||(u.__static_initialized=!0,u.__static_initializer_0())}static twoToTheXMinus24_$LI$(){return u.__static_initialize(),null==u.twoToTheXMinus24&&(u.twoToTheXMinus24=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(25)),u.twoToTheXMinus24}static twoToTheXMinus48_$LI$(){return u.__static_initialize(),null==u.twoToTheXMinus48&&(u.twoToTheXMinus48=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(33)),u.twoToTheXMinus48}
static __static_initializer_0(){let e=152587890625e-16;for(let t=32;t>=0;t--)u.twoToTheXMinus48_$LI$()[t]=e,e*=.5;let t=1;for(let e=24;e>=0;e--)u.twoToTheXMinus24_$LI$()[e]=t,t*=.5}nextBoolean(){return 0!==this.nextInternal(1)}nextBytes(e){
let t=0,n=0,r=0;for(;n<e.length;)0===r?(t=0|this.nextInternal(32),r=3):r--,e[n++]=0|t,t>>=8}nextDouble(){return this.nextInternal(26)*u.twoToTheMinus26+this.nextInternal(27)*u.twoToTheMinus53}nextFloat(){
return Math.fround(this.nextInternal(24)*u.twoToTheMinus24)}nextGaussian(){if(this.haveNextNextGaussian)return this.haveNextNextGaussian=!1,this.nextNextGaussian;let e,t,n;do{e=2*this.nextDouble()-1,t=2*this.nextDouble()-1,n=e*e+t*t}while(n>=1)
;const r=0===n?0:Math.sqrt(-2*Math.log(n)/n);return this.nextNextGaussian=t*r,this.haveNextNextGaussian=!0,e*r}nextInt(){return 0|this.nextInternal(32)}nextLong(){
return(((e=this.nextInternal(32))<0?Math.ceil(e):Math.floor(e))<<32)+(e=>e<0?Math.ceil(e):Math.floor(e))(this.nextInternal(32));var e}setSeed$long(e){this.setSeed$int$int(e>>24&16777215,16777215&e)}next(e){return 0|this.nextInternal(e)}
nextInternal(e){let t=this.seedhi*u.multiplierLo+this.seedlo*u.multiplierHi,n=this.seedlo*u.multiplierLo+11;const r=Math.floor(n*u.twoToTheMinus24);if(t+=r,n-=r*u.twoToThe24,t%=u.twoToThe24,this.seedhi=t,this.seedlo=n,
e<=24)return Math.floor(this.seedhi*u.twoToTheXMinus24_$LI$()[e]);{let t=this.seedhi*(1<<e-24)+Math.floor(this.seedlo*u.twoToTheXMinus48_$LI$()[e]);return t>=u.twoToThe31&&(t-=u.twoToThe32),t}}setSeed$int$int(e,t){this.seedhi=1502^e,
this.seedlo=15525485^t,this.haveNextNextGaussian=!1}setSeed(e,t){if("number"!=typeof e&&null!==e||"number"!=typeof t&&null!==t){if("number"!=typeof e&&null!==e||void 0!==t)throw new Error("invalid overload");return this.setSeed$long(e)}
return this.setSeed$int$int(e,t)}}u.__static_initialized=!1,u.multiplierHi=1502,u.multiplierLo=15525485,u.twoToThe24=16777216,u.twoToThe31=2147483648,u.twoToThe32=4294967296,u.twoToTheMinus24=5.960464477539063e-8,
u.twoToTheMinus26=1.4901161193847656e-8,u.twoToTheMinus31=4.656612873077393e-10,u.twoToTheMinus53=11102230246251565e-32,u.uniqueSeed=0,u.__class="Random";class h{static nextInt(e,t){if(t<=0)throw Object.defineProperty(new Error,"__classes",{
configurable:!0,value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.IllegalArgumentException","java.lang.Exception"]});if(a.isPowerOfTwo(t))return e.nextInt()&t-1;{
const r=-2147483648-(4294967296%((n=t)<0?Math.ceil(n):Math.floor(n))|0)|0;let i;do{i=e.nextInt()}while(i>=r);return h.method3538(i,t)}var n}static method3538(e,t){return(e>>31&t-1)+(e+(e>>>31))%t}}h.__class="RandomUtils";class d{constructor(){
void 0===this.cursor&&(this.cursor=null),this.sentinel=new v,this.sentinel.secondaryPrev=this.sentinel,this.sentinel.secondaryNext=this.sentinel}static insertAfter(e,t){null!=e.secondaryPrev&&e.unlinkSecondary(),e.secondaryNext=t.secondaryNext,
e.secondaryPrev=t,e.secondaryPrev.secondaryNext=e,e.secondaryNext.secondaryPrev=e}head(){const e=this.sentinel.secondaryNext;return e===this.sentinel?(this.cursor=null,null):(this.cursor=e.secondaryNext,e)}addTail(e){
null!=e.secondaryPrev&&e.unlinkSecondary(),e.secondaryNext=this.sentinel,e.secondaryPrev=this.sentinel.secondaryPrev,e.secondaryPrev.secondaryNext=e,e.secondaryNext.secondaryPrev=e}size(){let e=0,t=this.sentinel.secondaryNext
;for(;this.sentinel!==t;)t=t.secondaryNext,e++;return e}removeHead(){const e=this.sentinel.secondaryNext;return this.sentinel===e?null:(e.unlinkSecondary(),e)}clear(){for(;;){const e=this.sentinel.secondaryNext
;if(e===this.sentinel)return void(this.cursor=null);e.unlinkSecondary()}}next(){const e=this.cursor;return this.sentinel===e?(this.cursor=null,null):(this.cursor=e.secondaryNext,e)}}d.__class="SecondaryLinkedList";class p{
static __static_initialize(){p.__static_initialized||(p.__static_initialized=!0,p.__static_initializer_0())}static INVERSE_SQUARE_ROOT_$LI$(){return p.__static_initialize(),null==p.INVERSE_SQUARE_ROOT&&(p.INVERSE_SQUARE_ROOT=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(32896)),p.INVERSE_SQUARE_ROOT}static __static_initializer_0(){let e=0;for(let t=0;t<256;t++)for(let n=0;n<=t;n++)p.INVERSE_SQUARE_ROOT_$LI$()[e++]=255/Math.sqrt(Math.fround((t*t+n*n+65535)/65535))|0}}
p.__static_initialized=!1,p.__class="TextureMathUtils";class f{constructor(e,t,n){void 0===this.fillColor&&(this.fillColor=0),void 0===this.outlineWidth&&(this.outlineWidth=0),void 0===this.outlineColor&&(this.outlineColor=0),this.fillColor=e,
this.outlineWidth=n,this.outlineColor=t}}f.__class="TextureOpRasterizerShape";class m extends c{constructor(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)super(),void 0===this.bytes&&(this.bytes=null),
void 0===this.position&&(this.position=0),this.bytes=e,this.position=0;else{if("number"!=typeof e&&null!==e)throw new Error("invalid overload");{let e=arguments[0];super(),void 0===this.bytes&&(this.bytes=null),
void 0===this.position&&(this.position=0),this.bytes=n.allocate(e),this.position=0}}}static crc32$byte_A$int$int(e,t,n){throw Object.defineProperty(new Error("removed"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})}static crc32(e,t,n){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof t&&null!==t||"number"!=typeof n&&null!==n){
if(!(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)||"number"!=typeof t&&null!==t||void 0!==n)throw new Error("invalid overload");return m.crc32$byte_A$int(e,t)}return m.crc32$byte_A$int$int(e,t,n)}
static crc32$byte_A$int(e,t){return m.crc32$byte_A$int$int(e,0,t)}static getStringLength(e){return e.length+1}writeString(e){throw Object.defineProperty(new Error("removed"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})}readShort(){this.position+=2;let e=((255&this.bytes[this.position-2])<<8)+(255&this.bytes[this.position-1]);return e>32767&&(e-=65536),e}
writeUnsignedShortSmart(e){if(e>=0&&e<128)this.writeByte(e);else{if(!(e>=0&&e<32768))throw Object.defineProperty(new Error,"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.IllegalArgumentException","java.lang.Exception"]});this.writeShort(e+32768)}}writeByteC(e){this.bytes[this.position++]=0|-e}readUnsignedShortSmart(){
return(255&this.bytes[this.position])<128?this.readUnsignedByte():this.readUnsignedShort()-32768}writeVarInt(e){!!(-128&e)&&(!!(-16384&e)&&(!!(-2097152&e)&&(!!(-268435456&e)&&this.writeByte(e>>>28|128),this.writeByte(e>>>21|128)),
this.writeByte(e>>>14|128)),this.writeByte(e>>>7|128)),this.writeByte(127&e)}writeByte(e){this.bytes[this.position++]=0|e}writeLong(e){this.bytes[this.position++]=e>>56,this.bytes[this.position++]=e>>48,this.bytes[this.position++]=e>>40,
this.bytes[this.position++]=e>>32,this.bytes[this.position++]=e>>24,this.bytes[this.position++]=e>>16,this.bytes[this.position++]=e>>8,this.bytes[this.position++]=0|e}readIntAlt3Reverse(){return this.position+=4,
((255&this.bytes[this.position-1])<<16)+((255&this.bytes[this.position-2])<<24)+((255&this.bytes[this.position-4])<<8)+(255&this.bytes[this.position-3])}writeIntAlt3(e){this.bytes[this.position++]=e>>16,this.bytes[this.position++]=e>>24,
this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>8}readShortLE(){this.position+=2;let e=((255&this.bytes[this.position-1])<<8)+(255&this.bytes[this.position-2]);return e>32767&&(e-=65536),e}writeByteS(e){
this.bytes[this.position++]=128-e|0}readIntAlt3(){return this.position+=4,(255&this.bytes[this.position-2])+((255&this.bytes[this.position-4])<<16)+((255&this.bytes[this.position-3])<<24)+((255&this.bytes[this.position-1])<<8)}readUnsignedShortLEA(){
return this.position+=2,((255&this.bytes[this.position-1])<<8)+(this.bytes[this.position-2]-128&255)}readUnsignedByteC(){return 255&-this.bytes[this.position++]}method4590(){return this.position+=3,
((255&this.bytes[this.position-2])<<16)+((255&this.bytes[this.position-3])<<8)+(255&this.bytes[this.position-1])}writeIntAlt3Reverse(e){this.bytes[this.position++]=e>>8,this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>24,
this.bytes[this.position++]=e>>16}readString(){throw Object.defineProperty(new Error("removed"),"__classes",{configurable:!0,value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})}writeBytes(e,t){
for(let n=0;n<t;n++)this.bytes[this.position++]=e[n]}readInt(){return this.position+=4,(255&this.bytes[this.position-1])+((255&this.bytes[this.position-4])<<24)+((255&this.bytes[this.position-3])<<16)+((255&this.bytes[this.position-2])<<8)}
readVarLong(e){if(--e<0||e>7)throw Object.defineProperty(new Error,"__classes",{configurable:!0,value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.IllegalArgumentException","java.lang.Exception"]});let t=0
;for(let r=8*e;r>=0;r-=8)t|=(255&((n=this.bytes[this.position++])<0?Math.ceil(n):Math.floor(n)))<<r;var n;return t}readShortSmart(){return(255&this.bytes[this.position])<128?this.readUnsignedByte()-64:this.readUnsignedShort()-49152}
readUnsignedMultiSmart(){let e,t=0;for(e=this.readUnsignedShortSmart();32767===e;e=this.readUnsignedShortSmart())t+=32767;return t+e}writeIntLE(e){this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>8,this.bytes[this.position++]=e>>16,
this.bytes[this.position++]=e>>24}readBytesA(e,t){for(let n=0;n<t;n++)e[n]=this.bytes[this.position++]-128|0}verifyCrc32(){return this.position-=4,m.crc32$byte_A$int$int(this.bytes,0,this.position)===this.readInt()}writeMedium(e){
this.bytes[this.position++]=e>>16,this.bytes[this.position++]=e>>8,this.bytes[this.position++]=0|e}writeShortLE(e){this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>8}writeFloat(e){const t=(e=>{let t=new ArrayBuffer(4)
;return new Float32Array(t)[0]=e,new Uint32Array(t)[0]})(e);this.bytes[this.position++]=t>>24,this.bytes[this.position++]=t>>16,this.bytes[this.position++]=t>>8,this.bytes[this.position++]=0|t}readUnsignedByteS(){
return 128-this.bytes[this.position++]&255}writeVarLong(e,t){if(--t<0||t>7)throw Object.defineProperty(new Error,"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.IllegalArgumentException","java.lang.Exception"]});for(let n=8*t;n>=0;n-=8)this.bytes[this.position++]=e>>n}xteaDecrypt(e,t){const n=(t-5)/8|0,r=this.position
;this.position=5;for(let t=0;t<n;t++){let t=this.readInt(),n=this.readInt(),r=-957401312,i=32;for(;i-- >0;)n-=(t<<4^t>>>5)+t^e[r>>>11&3]+r,r-=-1640531527,t-=(n<<4^n>>>5)+n^r+e[3&r];this.position-=8,this.writeInt(t),this.writeInt(n)}this.position=r}
readByteS(){return 128-this.bytes[this.position++]|0}readVarInt(){let e=this.bytes[this.position++],t=0;for(;e<0;)t=(127&e|t)<<7,e=this.bytes[this.position++];return t|e}writeIntLength(e){this.bytes[this.position-e-4]=e>>24,
this.bytes[this.position-e-3]=e>>16,this.bytes[this.position-e-2]=e>>8,this.bytes[this.position-e-1]=0|e}writeByteA(e){this.bytes[this.position++]=e+128|0}readBytes(e,t){for(let n=0;n<t;n++)e[n]=this.bytes[this.position++]}writeShortLE2(e){
this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>8}writeShortA(e){this.bytes[this.position++]=e>>8,this.bytes[this.position++]=e+128|0}readByteC(){return 0|-this.bytes[this.position++]}readUnsignedShort(){return this.position+=2,
(255&this.bytes[this.position-1])+((255&this.bytes[this.position-2])<<8)}writeInt(e){this.bytes[this.position++]=e>>24,this.bytes[this.position++]=e>>16,this.bytes[this.position++]=e>>8,this.bytes[this.position++]=0|e}readUnsignedMedium(){
return this.position+=3,(255&this.bytes[this.position-1])+((255&this.bytes[this.position-3])<<16)+((255&this.bytes[this.position-2])<<8)}readIntLE(){return this.position+=4,
(255&this.bytes[this.position-4])+((255&this.bytes[this.position-1])<<24)+((255&this.bytes[this.position-2])<<16)+((255&this.bytes[this.position-3])<<8)}writeCrc32(e){const t=m.crc32$byte_A$int$int(this.bytes,e,this.position);return this.writeInt(t),
t}readLong(){const e=4294967295&((t=this.readInt())<0?Math.ceil(t):Math.floor(t));var t;const n=4294967295&(e=>e<0?Math.ceil(e):Math.floor(e))(this.readInt());return(e<<32)+n}readUnsignedByteA(){return this.bytes[this.position++]-128&255}
writeIntLE2(e){this.bytes[this.position++]=0|e,this.bytes[this.position++]=e>>8,this.bytes[this.position++]=e>>16,this.bytes[this.position++]=e>>24}readStringFast(){return 0===this.bytes[this.position]?(this.position++,null):this.readString()}
readShortA(){this.position+=2;let e=(this.bytes[this.position-1]-128&255)+((255&this.bytes[this.position-2])<<8);return e>32767&&(e-=65536),e}xteaEncrypt(e){const t=this.position/8|0;this.position=0;for(let n=0;n<t;n++){
let t=this.readInt(),n=this.readInt(),r=0,i=32;for(;i-- >0;)t+=n+(n<<4^n>>>5)^r+e[3&r],r+=-1640531527,n+=r+e[r>>>11&-1354760189]^(t>>>5^t<<4)+t;this.position-=8,this.writeInt(t),this.writeInt(n)}}readUnsignedByte(){
return 255&this.bytes[this.position++]}readUnsignedShortA(){return this.position+=2,((255&this.bytes[this.position-2])<<8)+(this.bytes[this.position-1]-128&255)}writeShort(e){this.bytes[this.position++]=e>>8,this.bytes[this.position++]=0|e}
writeFloatLE(e){const t=(e=>{let t=new ArrayBuffer(4);return new Float32Array(t)[0]=e,new Uint32Array(t)[0]})(e);this.bytes[this.position++]=0|t,this.bytes[this.position++]=t>>8,this.bytes[this.position++]=t>>16,this.bytes[this.position++]=t>>24}
readVersionedString(){throw Object.defineProperty(new Error("removed"),"__classes",{configurable:!0,value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})}readBytesReverse(e,t){
for(let n=t-1;n>=0;n--)e[n]=this.bytes[this.position++]}readUnsignedShortLE(){return this.position+=2,((255&this.bytes[this.position-1])<<8)+(255&this.bytes[this.position-2])}writeShortLEA(e){this.bytes[this.position++]=e+128|0,
this.bytes[this.position++]=e>>8}readByte(){return this.bytes[this.position++]}writeByteLength(e){this.bytes[this.position-e-1]=0|e}}m.__class="Buffer";class g extends c{constructor(e,t){super(),void 0===this.row&&(this.row=0),
void 0===this.index&&(this.index=0),this.row=e,this.index=t}static VALID_$LI$(){return null==g.VALID&&(g.VALID=new g(0,0)),g.VALID}}g.__class="ColorImageCacheEntry";class _ extends c{constructor(e,t){super(),void 0===this.row&&(this.row=0),
void 0===this.index&&(this.index=0),this.row=e,this.index=t}static VALID_$LI$(){return null==_.VALID&&(_.VALID=new _(0,0)),_.VALID}}_.__class="MonochromeImageCacheEntry";class v extends c{constructor(){super(),
void 0===this.secondaryPrev&&(this.secondaryPrev=null),void 0===this.secondaryKey&&(this.secondaryKey=0),void 0===this.secondaryNext&&(this.secondaryNext=null)}unlinkSecondary(){
null!=this.secondaryPrev&&(this.secondaryPrev.secondaryNext=this.secondaryNext,this.secondaryNext.secondaryPrev=this.secondaryPrev,this.secondaryPrev=null,this.secondaryNext=null)}isSecondaryLinked(){return null!=this.secondaryPrev}}
v.__class="SecondaryNode";class y extends c{constructor(e,t){super(),void 0===this.colorImageCache&&(this.colorImageCache=null),void 0===this.monochromeImageCache&&(this.monochromeImageCache=null),
void 0===this.imageCacheCapacity&&(this.imageCacheCapacity=0),void 0===this.monochrome&&(this.monochrome=!1),void 0===this.childOps&&(this.childOps=null),this.monochrome=t,this.childOps=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(e)}
static permutations_$LI$(){return null==y.permutations&&(y.permutations=new o(16)),y.permutations}static createTrigonometryTables(){if(null==y.SINE||null==y.COSINE){y.COSINE=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(256),y.SINE=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(256);for(let e=0;e<256;e++){const t=e/255*6.283185307179586;y.SINE[e]=4096*Math.sin(t)|0,y.COSINE[e]=4096*Math.cos(t)|0}}}static getPermutation(e){let t=y.permutations_$LI$().get(e);if(null==t){const n=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(512),r=new u(e);for(let e=0;e<255;e++)n[e]=0|e;for(let e=0;e<255;e++){const t=255-e,i=h.nextInt(r,t),a=n[i];n[i]=n[t],n[t]=n[511-e]=a}t=new S(n),y.permutations_$LI$().put(e,t)}return t.value}static perlinFade(e){
return((e*e>>12)*e>>12)*(40960+(e*(6*e-61440|0)>>12)|0)>>12}static decode(e){e.readUnsignedByte();const t=e.readUnsignedByte(),n=y.create(t);n.imageCacheCapacity=e.readUnsignedByte();const r=e.readUnsignedByte();for(let t=0;t<r;t++){
const t=e.readUnsignedByte();n.decode(e,t)}return n.postDecode(),n}static create(e){
return 0===e?new Z:1===e?new L:2===e?new V:3===e?new le:4===e?new R:5===e?new I:6===e?new N:7===e?new F:8===e?new U:9===e?new z:10===e?new O:11===e?new P:12===e?new ue:13===e?new Q:14===e?new he:15===e?new ce:16===e?new G:17===e?new H:18===e?new de:19===e?new te:20===e?new oe:21===e?new j:22===e?new W:23===e?new q:24===e?new K:25===e?new k:26===e?new M:27===e?new ae:28===e?new $:29===e?new re:30===e?new ne:31===e?new Y:32===e?new B:33===e?new D:34===e?new ee:35===e?new J:36===e?new se:37===e?new C:38===e?new X:39===e?new ie:null
}getChildColorOutput(e,t){if(!this.childOps[e].monochrome)return this.childOps[e].getColorOutput(t);const n=[null,null,null],r=this.childOps[e].getMonochromeOutput(t);return n[0]=r,n[2]=r,n[1]=r,n}decode(e,t){}getSpriteId(){return-1}getTextureId(){
return-1}getMonochromeOutput(e){throw Object.defineProperty(new Error("This operation does not have a monochrome output"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.IllegalStateException","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})}getColorOutput(e){
throw Object.defineProperty(new Error("This operation does not have a colour output"),"__classes",{configurable:!0,value:["java.lang.Throwable","java.lang.IllegalStateException","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]})
}clearImageCache(){this.monochrome?(this.monochromeImageCache.clear(),this.monochromeImageCache=null):(this.colorImageCache.clear(),this.colorImageCache=null)}createImageCache(e,t){const n=255===this.imageCacheCapacity?e:this.imageCacheCapacity
;this.monochrome?this.monochromeImageCache=new A(n,e,t):this.colorImageCache=new r(n,e,t)}getChildMonochromeOutput(e,t){return this.childOps[e].monochrome?this.childOps[e].getMonochromeOutput(t):this.childOps[e].getColorOutput(t)[0]}postDecode(){}}
y.COSINE=null,y.SINE=null,y.__class="TextureOp";class b extends f{constructor(e,t,n,r,i,a,s,o,l,c){super(-1,l,c),void 0===this.y1&&(this.y1=0),void 0===this.x0&&(this.x0=0),void 0===this.y0&&(this.y0=0),void 0===this.x1&&(this.x1=0),
void 0===this.x2&&(this.x2=0),void 0===this.y2&&(this.y2=0),void 0===this.x3&&(this.x3=0),void 0===this.y3&&(this.y3=0),this.y1=r,this.x0=e,this.y0=t,this.x1=n,this.x2=i,this.y2=a,this.x3=s,this.y3=o}static create(e){
return new b(e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readUnsignedMedium(),e.readUnsignedByte())}renderOutline(e,t){
const n=e*this.x0>>12,r=e*this.x1>>12,i=t*this.y1>>12,a=e*this.x2>>12,s=t*this.y0>>12,o=t*this.y2>>12,c=t*this.y3>>12,u=e*this.x3>>12;l.sub22_method4693(r,i,this.outlineColor,a,u,s,c,o,n)}renderFill(e,t){}render(e,t){}}
b.__class="TextureOpRasterizerBezierCurve";class x extends f{constructor(e,t,n,r,i,a,s){super(i,a,s),void 0===this.x&&(this.x=0),void 0===this.horizontalRadius&&(this.horizontalRadius=0),void 0===this.y&&(this.y=0),
void 0===this.verticalRadius&&(this.verticalRadius=0),this.x=e,this.horizontalRadius=n,this.y=t,this.verticalRadius=r}static create(e){
return new x(e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readUnsignedMedium(),e.readUnsignedMedium(),e.readUnsignedByte())}render(e,t){const n=this.x*e>>12,r=this.horizontalRadius*e>>12,i=this.verticalRadius*t>>12,a=this.y*t>>12
;l.sub18_method1745(r,this.fillColor,n,this.outlineColor,this.outlineWidth,a,i)}renderFill(e,t){const n=this.x*e>>12,r=this.horizontalRadius*e>>12,i=this.verticalRadius*t>>12,a=this.y*t>>12;l.sub28_method3323(i,n,this.fillColor,a,r)}
renderOutline(e,t){}}x.__class="TextureOpRasterizerEllipse";class E extends f{constructor(e,t,n,r,i,a){super(-1,i,a),void 0===this.x1&&(this.x1=0),void 0===this.y0&&(this.y0=0),void 0===this.x0&&(this.x0=0),void 0===this.y1&&(this.y1=0),this.x1=n,
this.y0=t,this.x0=e,this.y1=r}static create(e){return new E(e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readUnsignedMedium(),e.readUnsignedByte())}renderFill(e,t){}renderOutline(e,t){
const n=this.x0*e>>12,r=this.x1*e>>12,i=this.y1*t>>12,a=this.y0*t>>12;l.sub32_method4022(a,i,this.outlineColor,n,r)}render(e,t){}}E.__class="TextureOpRasterizerLine";class w extends f{constructor(e,t,n,r,i,a,s){super(i,a,s),
void 0===this.x1&&(this.x1=0),void 0===this.y1&&(this.y1=0),void 0===this.x0&&(this.x0=0),void 0===this.y0&&(this.y0=0),this.x1=n,this.y1=r,this.x0=e,this.y0=t}static create(e){
return new w(e.readShort(),e.readShort(),e.readShort(),e.readShort(),e.readUnsignedMedium(),e.readUnsignedMedium(),e.readUnsignedByte())}render(e,t){const n=this.x0*e>>12,r=this.y0*t>>12,i=this.x1*e>>12,a=this.y1*t>>12
;l.sub36_method4566(n,this.outlineColor,this.fillColor,this.outlineWidth,a,i,r)}renderOutline(e,t){const n=this.x0*e>>12,r=this.x1*e>>12,i=this.y0*t>>12,a=this.y1*t>>12;l.sub32_method3997(n,this.outlineColor,i,this.outlineWidth,a,r)}renderFill(e,t){
const n=this.x0*e>>12,r=this.x1*e>>12,i=this.y0*t>>12,a=this.y1*t>>12;l.sub29_method3429(n,a,r,i,this.fillColor)}}w.__class="TextureOpRasterizerRectangle";class S extends v{constructor(e){super(),void 0===this.value&&(this.value=null),this.value=e}}
S.__class="ByteArraySecondaryNode",class extends v{constructor(){super(),void 0===this.innerWidth&&(this.innerWidth=0),void 0===this.yOffset&&(this.yOffset=0),void 0===this.xOffset&&(this.xOffset=0),void 0===this.height&&(this.height=0),
void 0===this.width&&(this.width=0),void 0===this.innerHeight&&(this.innerHeight=0)}renderRotatedScaledTransparent$int$int$int$int$int$int(e,t,n,r,i,a){throw new Error("cannot invoke abstract overloaded method... check your argument(s) type(s)")}
renderRotatedScaledTransparent(e,t,n,r,i,a){if("number"!=typeof e&&null!==e||"number"!=typeof t&&null!==t||"number"!=typeof n&&null!==n||"number"!=typeof r&&null!==r||"number"!=typeof i&&null!==i||"number"!=typeof a&&null!==a){
if("number"!=typeof e&&null!==e||"number"!=typeof t&&null!==t||"number"!=typeof n&&null!==n||"number"!=typeof r&&null!==r||void 0!==i||void 0!==a)throw new Error("invalid overload");return this.renderRotatedScaledTransparent$int$int$int$int(e,t,n,r)}
return this.renderRotatedScaledTransparent$int$int$int$int$int$int(e,t,n,r,i,a)}renderRotatedScaledTransparent$int$int$int$int(e,t,n,r){const i=this.innerWidth<<3;n=(15&i)+(n<<4);const a=this.innerHeight<<3;e=(15&a)+(e<<4),
this.renderRotatedScaledTransparent$int$int$int$int$int$int(i,a,n,e,t,r)}}.__class="Sprite";class T extends v{constructor(e){super(),void 0===this.spriteIds&&(this.spriteIds=null),void 0===this.textureIds&&(this.textureIds=null),
void 0===this.brightnessOp&&(this.brightnessOp=null),void 0===this.colorOp&&(this.colorOp=null),void 0===this.alphaOp&&(this.alphaOp=null),void 0===this.ops&&(this.ops=null);let t=0;const n=e.readUnsignedByte();this.ops=(e=>{let t=[]
;for(;e-- >0;)t.push(null);return t})(n);let r=0;const i=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(n);for(let a=0;a<n;a++){const n=y.decode(e);n.getSpriteId()>=0&&t++,n.getTextureId()>=0&&r++;const s=n.childOps.length;i[a]=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(s);for(let t=0;t<s;t++)i[a][t]=e.readUnsignedByte();this.ops[a]=n}this.textureIds=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(r);let a=0;this.spriteIds=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(t);let s=0
;for(let e=0;e<n;e++){const t=this.ops[e],n=t.childOps.length;for(let r=0;r<n;r++)t.childOps[r]=this.ops[i[e][r]];const r=t.getSpriteId(),o=t.getTextureId();r>0&&(this.spriteIds[s++]=r),o>0&&(this.textureIds[a++]=o),i[e]=null}
this.colorOp=this.ops[e.readUnsignedByte()],this.alphaOp=this.ops[e.readUnsignedByte()],this.brightnessOp=this.ops[e.readUnsignedByte()]}static brightnessMap_$LI$(){return null==T.brightnessMap&&(T.brightnessMap=(e=>{let t=[];for(;e-- >0;)t.push(0)
;return t})(256)),T.brightnessMap}static setBrightness(e){if(T.brightness!==e){for(let t=0;t<256;t++){const n=255*Math.pow(t/255,e)|0;T.brightnessMap_$LI$()[t]=n>255?255:n}T.brightness=e}}static setSize(e,t){if(e!==T.width){T.normalisedX=(e=>{
let t=[];for(;e-- >0;)t.push(0);return t})(e);for(let t=0;t<e;t++)T.normalisedX[t]=(t<<12)/e|0;T.widthMask=e-1,T.width=e,T.widthTimes32=32*e}if(t!==T.height){if(t===T.width)T.normalisedY=T.normalisedX;else{T.normalisedY=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(t);for(let e=0;e<t;e++)T.normalisedY[e]=(e<<12)/t|0}T.heightMask=t-1,T.height=t}}getPixels(e,t,n,r,i,a){T.setBrightness(r),T.setSize(e,t);const s=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(e*t)
;for(let n=0;n<this.ops.length;n++)this.ops[n].createImageCache(t,e);let o,l,c;T.loadedTextures=n,a?(c=e-1,o=-1,l=-1):(l=1,o=e,c=0);let u=0;for(let n=0;n<t;n++){let t,r,a;if(i&&(u=n),this.colorOp.monochrome){
const e=this.colorOp.getMonochromeOutput(n);r=e,a=e,t=e}else{const e=this.colorOp.getColorOutput(n);t=e[0],a=e[2],r=e[1]}for(let n=c;n!==o;n+=l){let o=t[n]>>4,l=r[n]>>4;l>255&&(l=255);let c=a[n]>>4;o>255&&(o=255),c>255&&(c=255),l<0&&(l=0),o<0&&(o=0)
;const h=T.brightnessMap_$LI$()[l],d=T.brightnessMap_$LI$()[o];c<0&&(c=0);const p=T.brightnessMap_$LI$()[c];s[u++]=p+(d<<16)+(h<<8),i&&(u+=e-1)}}for(let e=0;e<this.ops.length;e++)this.ops[e].clearImageCache();return s}}T.loadedTextures=null,
T.spriteGroupId=-1,T.brightness=-1,T.width=0,T.height=0,T.widthMask=0,T.heightMask=0,T.normalisedX=null,T.normalisedY=null,T.widthTimes32=0,T.__class="Texture";class A{constructor(e,t,n){this.size=0,this.singleRow=-1,this.recentlyUsed=new s,
this.invalid=!1,void 0===this.height&&(this.height=0),void 0===this.entries&&(this.entries=null),void 0===this.capacity&&(this.capacity=0),void 0===this.pixels&&(this.pixels=null),this.height=t,this.entries=(e=>{let t=[];for(;e-- >0;)t.push(null)
;return t})(this.height),this.capacity=e,this.pixels=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([this.capacity,n])}static __static_initialize(){
A.__static_initialized||(A.__static_initialized=!0,A.__static_initializer_0())}static PERLIN_FADE_$LI$(){return A.__static_initialize(),null==A.PERLIN_FADE&&(A.PERLIN_FADE=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(4096)),A.PERLIN_FADE}
static __static_initializer_0(){for(let e=0;e<4096;e++)A.PERLIN_FADE_$LI$()[e]=y.perlinFade(e)}get$(){if(this.capacity!==this.height)throw Object.defineProperty(new Error("Can only retrieve a full image cache"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]});for(let e=0;e<this.capacity;e++)this.entries[e]=_.VALID_$LI$();return this.pixels}get$int(e){
if(this.capacity===this.height)return this.invalid=null==this.entries[e],this.entries[e]=_.VALID_$LI$(),this.pixels[e];if(1===this.capacity)return this.invalid=e!==this.singleRow,this.singleRow=e,this.pixels[0];{let t=this.entries[e];if(null==t){
if(this.invalid=!0,this.capacity>this.size)t=new _(e,this.size),this.size++;else{const n=this.recentlyUsed.tail();t=new _(e,n.index),this.entries[n.row]=null,n.unlink()}this.entries[e]=t}else this.invalid=!1;return this.recentlyUsed.addHead(t),
this.pixels[t.index]}}get(e){if("number"==typeof e||null===e)return this.get$int(e);if(void 0===e)return this.get$();throw new Error("invalid overload")}clear(){for(let e=0;e<this.capacity;e++)this.pixels[e]=null;this.pixels=null,this.entries=null,
this.recentlyUsed.clear(),this.recentlyUsed=null}}A.__static_initialized=!1,A.__class="MonochromeImageCache";class C extends y{constructor(){super(0,!0),this.anInt4505=0,this.anInt4503=8192,this.anInt4508=2048,this.anInt4504=0,this.anInt4515=2048,
this.anInt4507=12288,this.anInt4517=4096}method3687(e,t){const n=(t-e)*this.anInt4507>>12;let r=y.COSINE[255*n>>12&255];return r=(r<<12)/this.anInt4507|0,r=(r<<12)/this.anInt4503|0,r=this.anInt4517*r>>12,r>e+t&&-r<e+t}method3690(e,t){
const n=(t+e)*this.anInt4507>>12;let r=y.COSINE[255*n>>12&255];return r=(r<<12)/this.anInt4507|0,r=(r<<12)/this.anInt4503|0,r=r*this.anInt4517>>12,r>t-e&&t-e>-r}postDecode(){y.createTrigonometryTables()}decode(e,t){
0===t?this.anInt4508=e.readUnsignedShort():1===t?this.anInt4505=e.readUnsignedShort():2===t?this.anInt4504=e.readUnsignedShort():3===t?this.anInt4515=e.readUnsignedShort():4===t?this.anInt4507=e.readUnsignedShort():5===t?this.anInt4517=e.readUnsignedShort():6===t&&(this.anInt4503=e.readUnsignedShort())
}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=T.normalisedY[e]-2048;for(let e=0;e<T.width;e++){const r=T.normalisedX[e]-2048;let i=r+this.anInt4508;i=i>=-2048?i:i+4096
;let a=n+this.anInt4505;i=i<=2048?i:i-4096,a=a>=-2048?a:a+4096,a=a<=2048?a:a-4096;let s=r+this.anInt4504,o=n+this.anInt4515;s=s>=-2048?s:s+4096,s=s<=2048?s:s-4096,o=o>=-2048?o:o+4096,o=o<=2048?o:o-4096,
t[e]=this.method3687(i,a)||this.method3690(s,o)?4096:0}}return t}}C.__class="TextureOp37";class M extends y{constructor(){super(1,!0),this.minValue=0,this.maxValue=4096}decode(e,t){
0===t?this.minValue=e.readUnsignedShort():1===t&&(this.maxValue=e.readUnsignedShort())}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(0,e)
;for(let e=0;e<T.width;e++){const r=n[e];t[e]=r>=this.minValue&&r<=this.maxValue?4096:0}}return t}}M.__class="TextureOpBinary";class I extends y{constructor(){super(1,!1),this.radiusY=1,this.radiusX=1}getColorOutput(e){
const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=this.radiusY+this.radiusY+1,r=65536/n|0,i=65536/(this.radiusX+this.radiusX+1)|0,a=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(n)
;for(let t=e-this.radiusY;t<=e+this.radiusY;t++){const n=this.getChildColorOutput(0,t&T.heightMask),r=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([3,T.width])
;let s=0,o=0;const l=n[0];let c=0;const u=n[2],h=n[1];for(let e=-this.radiusX;e<=this.radiusX;e++){const t=T.widthMask&e;c+=h[t],s+=l[t],o+=u[t]}const d=r[0],p=r[1],f=r[2];let m=0;for(;T.width>m;){d[m]=i*s>>16,p[m]=c*i>>16,f[m]=i*o>>16
;let e=m-this.radiusX&T.widthMask;const t=c-h[e],n=s-l[e];m++;const r=o-u[e];e=m+this.radiusX&T.widthMask,s=n+l[e],c=t+h[e],o=r+u[e]}a[t+this.radiusY-e]=r}const s=t[1],o=t[2],l=t[0];for(let e=0;e<T.width;e++){let t=0,i=0,c=0;for(let r=0;r<n;r++){
const n=a[r];c+=n[2][e],t+=n[0][e],i+=n[1][e]}l[e]=r*t>>16,s[e]=r*i>>16,o[e]=c*r>>16}}return t}decode(e,t){0===t?this.radiusX=e.readUnsignedByte():1===t?this.radiusY=e.readUnsignedByte():2===t&&(this.monochrome=1===e.readUnsignedByte())}
getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.radiusY+this.radiusY+1,r=65536/n|0,i=65536/(this.radiusX+this.radiusX+1)|0,a=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(n)
;for(let t=e-this.radiusY;t<=e+this.radiusY;t++){const n=this.getChildMonochromeOutput(0,T.heightMask&t),r=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(T.width);let s=0;for(let e=-this.radiusX;e<=this.radiusX;e++)s+=n[e&T.widthMask];let o=0
;for(;o<T.width;){r[o]=s*i>>16;const e=s-n[o-this.radiusX&T.widthMask];o++,s=e+n[T.widthMask&o+this.radiusX]}a[t+this.radiusY-e]=r}for(let e=0;e<T.width;e++){let i=0;for(let t=0;t<n;t++)i+=a[t][e];t[e]=i*r>>16}}return t}}I.__class="TextureOpBoxBlur"
;class R extends y{constructor(){super(0,!0),void 0===this.anInt4937&&(this.anInt4937=0),void 0===this.anIntArrayArray41&&(this.anIntArrayArray41=null),void 0===this.anInt4948&&(this.anInt4948=0),
void 0===this.anIntArray536&&(this.anIntArray536=null),void 0===this.anInt4949&&(this.anInt4949=0),void 0===this.anIntArrayArray42&&(this.anIntArrayArray42=null),this.anInt4935=81,this.anInt4943=4,this.anInt4944=0,this.anInt4942=1024,
this.anInt4941=1024,this.anInt4945=409,this.anInt4954=204,this.anInt4936=8}method4057(){const e=new u(this.anInt4936);this.anInt4937=4096/this.anInt4936|0,this.anIntArray536=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(this.anInt4936+1),
this.anIntArrayArray41=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([this.anInt4936,this.anInt4943+1]),this.anIntArrayArray42=function(e){let t=function(e){
if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([this.anInt4936,this.anInt4943]),this.anIntArray536[0]=0,this.anInt4949=4096/this.anInt4943|0;const t=this.anInt4949/2|0
;this.anInt4948=this.anInt4935/2|0;const n=this.anInt4937/2|0;for(let r=0;r<this.anInt4936;r++){if(r>0){let t=this.anInt4937;t+=((h.nextInt(e,4096)-2048)*this.anInt4954>>12)*n>>12,this.anIntArray536[r]=t+this.anIntArray536[r-1]}
this.anIntArrayArray41[r][0]=0;for(let n=0;n<this.anInt4943;n++){if(n>0){let i=this.anInt4949;i+=t*((h.nextInt(e,4096)-2048)*this.anInt4945>>12)>>12,this.anIntArrayArray41[r][n]=this.anIntArrayArray41[r][n-1]+i}
this.anIntArrayArray42[r][n]=this.anInt4941<=0?4096:4096-h.nextInt(e,this.anInt4941)}this.anIntArrayArray41[r][this.anInt4943]=4096}this.anIntArray536[this.anInt4936]=4096}postDecode(){this.method4057()}decode(e,t){
0===t?this.anInt4943=e.readUnsignedByte():1===t?this.anInt4936=e.readUnsignedByte():2===t?this.anInt4945=e.readUnsignedShort():3===t?this.anInt4954=e.readUnsignedShort():4===t?this.anInt4942=e.readUnsignedShort():5===t?this.anInt4944=e.readUnsignedShort():6===t?this.anInt4935=e.readUnsignedShort():7===t&&(this.anInt4941=e.readUnsignedShort())
}getMonochromeOutput(e){const n=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){let r,i=0;for(r=this.anInt4944+T.normalisedY[e];r<0;r+=4096);for(;r>4096;)r-=4096;for(;this.anInt4936>i&&r>=this.anIntArray536[i];)i++
;const a=i-1,s=this.anIntArray536[i],o=!(1&i);if(this.anIntArray536[i-1]+this.anInt4948<r&&r<s-this.anInt4948)for(let e=0;e<T.width;e++){const t=o?this.anInt4942:-this.anInt4942;let r=T.normalisedX[e]+(t*this.anInt4949>>12),i=0;for(;r<0;)r+=4096
;for(;r>4096;)r-=4096;for(;i<this.anInt4943&&r>=this.anIntArrayArray41[a][i];)i++;const s=this.anIntArrayArray41[a][i],l=i-1;this.anIntArrayArray41[a][l]+this.anInt4948<r&&s-this.anInt4948>r?n[e]=this.anIntArrayArray42[a][l]:n[e]=0
}else t.fill$int_A$int$int$int(n,0,T.width,0)}return n}}R.__class="TextureOpBricks";class k extends y{constructor(){super(1,!1),this.maxValue=409,this.redFactor=4096,this.blueFactor=4096,this.colorDelta=[0,0,0],this.greenFactor=4096}
getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=this.getChildColorOutput(0,e),r=n[0],i=n[1],a=n[2],s=t[1],o=t[0],l=t[2];for(let e=0;e<T.width;e++){const t=r[e];let n=t-this.colorDelta[0]
;if(n<0&&(n=-n),n<=this.maxValue){const n=i[e];let r=n-this.colorDelta[1];if(r<0&&(r=-r),r<=this.maxValue){const r=a[e];let i=r-this.colorDelta[2];i<0&&(i=-i),i<=this.maxValue?(o[e]=t*this.redFactor>>12,s[e]=n*this.greenFactor>>12,
l[e]=r*this.blueFactor>>12):(o[e]=t,s[e]=n,l[e]=r)}else o[e]=t,s[e]=n,l[e]=a[e]}else o[e]=t,s[e]=i[e],l[e]=a[e]}}return t}decode(e,t){
if(0===t)this.maxValue=e.readUnsignedShort();else if(1===t)this.blueFactor=e.readUnsignedShort();else if(2===t)this.greenFactor=e.readUnsignedShort();else if(3===t)this.redFactor=e.readUnsignedShort();else if(4===t){const t=e.readUnsignedMedium()
;this.colorDelta[0]=(16711680&t)<<4,this.colorDelta[2]=0,this.colorDelta[1]=t>>4&4080}}}k.__class="TextureOpBrightness";class N extends y{constructor(){super(1,!1),this.minValue=0,this.maxValue=4096}decode(e,t){
0===t?this.minValue=e.readUnsignedShort():1===t?this.maxValue=e.readUnsignedShort():2===t&&(this.monochrome=1===e.readUnsignedByte())}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){
const n=this.getChildMonochromeOutput(0,e);for(let e=0;e<T.width;e++){const r=n[e];r<this.minValue?t[e]=this.minValue:r>this.maxValue?t[e]=this.maxValue:t[e]=r}}return t}getColorOutput(e){const t=this.colorImageCache.get$int(e)
;if(this.colorImageCache.invalid){const n=this.getChildColorOutput(0,e),r=n[0],i=n[1],a=t[0],s=n[2],o=t[1],l=t[2];for(let e=0;e<T.width;e++){const t=i[e],n=r[e],c=s[e];n<this.minValue?a[e]=this.minValue:n>this.maxValue?a[e]=this.maxValue:a[e]=n,
t<this.minValue?o[e]=this.minValue:t>this.maxValue?o[e]=this.maxValue:o[e]=t,c<this.minValue?l[e]=this.minValue:c>this.maxValue?l[e]=this.maxValue:l[e]=c}}return t}}N.__class="TextureOpClamp";class D extends y{constructor(){super(1,!1),
this.anInt3634=4096,this.aBoolean263=!0}decode(e,t){0===t?this.anInt3634=e.readUnsignedShort():1===t&&(this.aBoolean263=1===e.readUnsignedByte())}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildMonochromeOutput(0,T.heightMask&e-1),r=this.getChildMonochromeOutput(0,e),i=this.getChildMonochromeOutput(0,e+1&T.heightMask),a=t[0],s=t[1],o=t[2];for(let e=0;e<T.width;e++){
const t=(i[e]-n[e])*this.anInt3634,l=this.anInt3634*(r[e+1&T.widthMask]-r[e-1&T.widthMask]),c=t>>12,u=l>>12,h=c*c>>12,d=u*u>>12,p=4096*Math.sqrt(Math.fround((h+d+4096)/4096))|0;let f,m,g;0===p?(m=0,g=0,f=0):(m=t/p|0,g=16777216/p|0,f=l/p|0),
this.aBoolean263&&(f=2048+(f>>1),m=2048+(m>>1),g=2048+(g>>1)),a[e]=f,s[e]=m,o[e]=g}}return t}}D.__class="TextureOpColorEdgeDetector";class L extends y{constructor(e){if("number"==typeof e||null===e)super(0,!1),void 0===this.blue&&(this.blue=0),
void 0===this.green&&(this.green=0),void 0===this.red&&(this.red=0),this.setColor(e);else{if(void 0!==e)throw new Error("invalid overload");{let e=0;super(0,!1),void 0===this.blue&&(this.blue=0),void 0===this.green&&(this.green=0),
void 0===this.red&&(this.red=0),this.setColor(e)}void 0===this.blue&&(this.blue=0),void 0===this.green&&(this.green=0),void 0===this.red&&(this.red=0)}}decode(e,t){0===t&&this.setColor(e.readUnsignedMedium())}getColorOutput(e){
const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const e=t[1],n=t[0],r=t[2];for(let t=0;t<T.width;t++)n[t]=this.red,e[t]=this.green,r[t]=this.blue}return t}setColor(e){this.green=e>>4&4080,this.red=e>>12&4080,
this.blue=(255&e)<<4}}L.__class="TextureOpColorFill";class O extends y{constructor(){super(1,!1),void 0===this.samples&&(this.samples=null),this.colors=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(257)}setPreset(e){
if(0!==e)if(1===e)this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[];for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([2,4])}(),this.samples[0][0]=0,this.samples[0][3]=0,this.samples[0][1]=0,
this.samples[1][0]=4096,this.samples[0][2]=0,this.samples[1][2]=4096,this.samples[1][1]=4096,this.samples[1][3]=4096;else if(2===e)this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[]
;for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([8,4])}(),this.samples[0][0]=0,this.samples[0][1]=2650,this.samples[0][2]=2602,this.samples[1][0]=2867,this.samples[2][0]=3072,this.samples[1][2]=1799,this.samples[1][1]=2313,
this.samples[2][2]=1734,this.samples[3][2]=1220,this.samples[4][2]=963,this.samples[0][3]=2361,this.samples[5][2]=2152,this.samples[3][0]=3276,this.samples[2][1]=2618,this.samples[6][2]=1060,this.samples[4][0]=3481,this.samples[1][3]=1558,
this.samples[7][2]=1413,this.samples[5][0]=3686,this.samples[6][0]=3891,this.samples[7][0]=4096,this.samples[3][1]=2296,this.samples[2][3]=1413,this.samples[3][3]=947,this.samples[4][1]=2072,this.samples[5][1]=2730,this.samples[6][1]=2232,
this.samples[7][1]=1686,this.samples[4][3]=722,this.samples[5][3]=1766,this.samples[6][3]=915,this.samples[7][3]=1140;else if(3===e)this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[]
;for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([7,4])}(),this.samples[0][3]=4096,this.samples[0][2]=0,this.samples[1][3]=4096,this.samples[2][3]=0,this.samples[0][0]=0,this.samples[3][3]=0,this.samples[4][3]=0,
this.samples[1][2]=4096,this.samples[2][2]=4096,this.samples[5][3]=4096,this.samples[3][2]=4096,this.samples[0][1]=0,this.samples[1][0]=663,this.samples[1][1]=0,this.samples[6][3]=4096,this.samples[2][1]=0,this.samples[4][2]=0,this.samples[5][2]=0,
this.samples[2][0]=1363,this.samples[3][0]=2048,this.samples[3][1]=4096,this.samples[4][0]=2727,this.samples[6][2]=0,this.samples[4][1]=4096,this.samples[5][0]=3411,this.samples[6][0]=4096,this.samples[5][1]=4096,
this.samples[6][1]=0;else if(4===e)this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[];for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([6,4])}(),this.samples[0][0]=0,this.samples[0][1]=0,this.samples[0][2]=0,
this.samples[1][2]=0,this.samples[0][3]=0,this.samples[1][0]=1843,this.samples[1][1]=0,this.samples[2][0]=2457,this.samples[1][3]=1493,this.samples[2][1]=0,this.samples[3][1]=0,this.samples[2][2]=0,this.samples[3][2]=1124,this.samples[3][0]=2781,
this.samples[2][3]=2939,this.samples[3][3]=3565,this.samples[4][0]=3481,this.samples[5][0]=4096,this.samples[4][3]=4031,this.samples[4][2]=3084,this.samples[4][1]=546,this.samples[5][2]=4096,this.samples[5][3]=4096,
this.samples[5][1]=4096;else if(5===e)this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[];for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([16,4])}(),this.samples[0][2]=192,this.samples[0][1]=80,
this.samples[0][3]=321,this.samples[0][0]=0,this.samples[1][2]=449,this.samples[1][1]=321,this.samples[2][1]=578,this.samples[1][3]=562,this.samples[2][2]=690,this.samples[2][3]=803,this.samples[3][3]=1140,this.samples[3][1]=947,
this.samples[3][2]=995,this.samples[1][0]=155,this.samples[2][0]=389,this.samples[3][0]=671,this.samples[4][2]=1397,this.samples[5][2]=1429,this.samples[4][0]=897,this.samples[4][3]=1509,this.samples[6][2]=1461,this.samples[5][3]=1413,
this.samples[4][1]=1285,this.samples[6][3]=1333,this.samples[5][0]=1175,this.samples[7][3]=1702,this.samples[8][3]=2056,this.samples[6][0]=1368,this.samples[9][3]=2666,this.samples[10][3]=3276,this.samples[5][1]=1525,this.samples[7][0]=1507,
this.samples[7][2]=1525,this.samples[6][1]=1734,this.samples[11][3]=3228,this.samples[8][0]=1736,this.samples[9][0]=2088,this.samples[7][1]=1413,this.samples[8][2]=1590,this.samples[9][2]=2056,this.samples[8][1]=1108,this.samples[10][0]=2355,
this.samples[9][1]=1766,this.samples[11][0]=2691,this.samples[10][1]=2409,this.samples[12][0]=3031,this.samples[13][0]=3522,this.samples[10][2]=2586,this.samples[11][1]=3116,this.samples[11][2]=3148,this.samples[12][3]=3196,this.samples[14][0]=3727,
this.samples[15][0]=4096,this.samples[12][2]=3710,this.samples[13][3]=3019,this.samples[13][2]=3421,this.samples[12][1]=3806,this.samples[14][3]=3228,this.samples[15][3]=2746,this.samples[13][1]=3437,this.samples[14][1]=3116,this.samples[15][1]=2377,
this.samples[14][2]=3148,this.samples[15][2]=2505;else{if(6!==e)throw Object.defineProperty(new Error("Invalid gradient preset"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]});this.samples=function(){let e=function(t){if(0===t.length)return 0;{let n=[];for(let r=0;r<t[0];r++)n.push(e(t.slice(1)));return n}};return e([4,4])
}(),this.samples[0][3]=0,this.samples[0][1]=0,this.samples[1][3]=0,this.samples[0][2]=4096,this.samples[1][2]=4096,this.samples[2][3]=0,this.samples[2][2]=4096,this.samples[0][0]=2048,this.samples[3][3]=0,this.samples[1][1]=4096,this.samples[3][2]=0,
this.samples[1][0]=2867,this.samples[2][1]=4096,this.samples[3][1]=4096,this.samples[2][0]=3276,this.samples[3][0]=4096}}interpolate(){const e=this.samples.length;if(!(e<=0))for(let t=0;t<257;t++){let n=0;const r=t<<4
;for(let t=0;t<e&&r>=this.samples[t][0];t++)n++;let i,a,s;if(n>=e){const t=this.samples[e-1];s=t[3],i=t[1],a=t[2]}else{const e=this.samples[n];if(n<=0)a=e[2],i=e[1],s=e[3];else{const t=this.samples[n-1],o=(r-t[0]<<12)/(e[0]-t[0])|0,l=4096-o
;a=e[2]*o+t[2]*l>>12,i=e[1]*o+t[1]*l>>12,s=e[3]*o+t[3]*l>>12}}let o=a>>4;o<0?o=0:o>255&&(o=255);let l=s>>4,c=i>>4;c<0?c=0:c>255&&(c=255),l<0?l=0:l>255&&(l=255),this.colors[t]=l|o<<8|c<<16}}postDecode(){null==this.samples&&this.setPreset(1),
this.interpolate()}decode(e,t){if(0!==t)return;const n=e.readUnsignedByte();if(0===n){this.samples=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)
}([e.readUnsignedByte(),4]);for(let t=0;t<this.samples.length;t++)this.samples[t][0]=e.readUnsignedShort(),this.samples[t][1]=e.readUnsignedByte()<<4,this.samples[t][2]=e.readUnsignedByte()<<4,this.samples[t][3]=e.readUnsignedByte()<<4
}else this.setPreset(n)}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=this.getChildMonochromeOutput(0,e),r=t[1],i=t[2],a=t[0];for(let e=0;e<T.width;e++){let t=n[e]>>4;t<0&&(t=0),t>256&&(t=256)
;const s=this.colors[t];a[e]=s>>12&4080,r[e]=s>>4&4080,i[e]=(255&s)<<4}}return t}}O.__class="TextureOpColorGradient";class P extends y{constructor(){super(1,!1),this.green=4096,this.red=4096,this.blue=4096}decode(e,t){
0===t?this.red=e.readUnsignedShort():1===t?this.green=e.readUnsignedShort():2===t&&(this.blue=e.readUnsignedShort())}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildColorOutput(0,e),r=n[1],i=n[0],a=t[0],s=t[1],o=n[2],l=t[2];for(let e=0;e<T.width;e++){const t=i[e],n=o[e],c=r[e];t===n&&n===c?(a[e]=this.red*t>>12,s[e]=this.green*n>>12,l[e]=this.blue*c>>12):(a[e]=this.red,s[e]=this.green,
l[e]=this.blue)}}return t}}P.__class="TextureOpColorize";class F extends y{constructor(){super(2,!1),this.function=6}decode(e,t){0===t?this.function=e.readUnsignedByte():1===t&&(this.monochrome=1===e.readUnsignedByte())}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(0,e),r=this.getChildMonochromeOutput(1,e),i=this.function
;if(1===i)for(let e=0;e<T.width;e++)t[e]=r[e]+n[e];else if(2===i)for(let e=0;e<T.width;e++)t[e]=n[e]-r[e];else if(3===i)for(let e=0;e<T.width;e++)t[e]=n[e]*r[e]>>12;else if(4===i)for(let e=0;e<T.width;e++){const i=r[e];t[e]=0===i?4096:(n[e]<<12)/i|0
}else if(5===i)for(let e=0;e<T.width;e++)t[e]=4096-((4096-n[e])*(4096-r[e])>>12);else if(6===i)for(let e=0;e<T.width;e++){const i=r[e];t[e]=i>=2048?4096-((4096-i)*(4096-n[e])>>11):i*n[e]>>11}else if(7===i)for(let e=0;e<T.width;e++){const i=n[e]
;t[e]=4096===i?4096:(r[e]<<12)/(4096-i)|0}else if(8===i)for(let e=0;e<T.width;e++){const i=n[e];t[e]=0===i?0:4096-((4096-r[e]<<12)/i|0)}else if(9===i)for(let e=0;e<T.width;e++){const i=n[e],a=r[e];t[e]=i<a?i:a
}else if(10===i)for(let e=0;e<T.width;e++){const i=n[e],a=r[e];t[e]=i<=a?a:i}else if(11===i)for(let e=0;e<T.width;e++){const i=r[e],a=n[e];t[e]=a>i?a-i:i-a}else if(12===i)for(let e=0;e<T.width;e++){const i=n[e],a=r[e];t[e]=i+a-(i*a>>11)}}return t}
getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=this.getChildColorOutput(0,e),r=this.getChildColorOutput(1,e),i=t[0],a=t[1],s=n[0],o=t[2],l=n[1],c=r[2],u=n[2],h=r[1],d=r[0],p=this.function
;if(1===p)for(let e=0;e<T.width;e++)i[e]=s[e]+d[e],a[e]=l[e]+h[e],o[e]=u[e]+c[e];else if(2===p)for(let e=0;e<T.width;e++)i[e]=s[e]-d[e],a[e]=l[e]-h[e],o[e]=u[e]-c[e];else if(3===p)for(let e=0;e<T.width;e++)i[e]=s[e]*d[e]>>12,a[e]=h[e]*l[e]>>12,
o[e]=c[e]*u[e]>>12;else if(4===p)for(let e=0;e<T.width;e++){const t=h[e],n=d[e],r=c[e];i[e]=0===n?4096:(s[e]<<12)/n|0,a[e]=0===t?4096:(l[e]<<12)/t|0,o[e]=0===r?4096:(u[e]<<12)/r|0
}else if(5===p)for(let e=0;e<T.width;e++)i[e]=4096-((4096-s[e])*(4096-d[e])>>12),a[e]=4096-((4096-l[e])*(4096-h[e])>>12),o[e]=4096-((4096-u[e])*(4096-c[e])>>12);else if(6===p)for(let e=0;e<T.width;e++){const t=h[e],n=d[e],r=c[e]
;i[e]=n>=2048?4096-((4096-s[e])*(4096-n)>>11):n*s[e]>>11,a[e]=t>=2048?4096-((4096-l[e])*(4096-t)>>11):l[e]*t>>11,o[e]=r>=2048?4096-((4096-u[e])*(4096-r)>>11):u[e]*r>>11}else if(7===p)for(let e=0;e<T.width;e++){const t=u[e],n=l[e],r=s[e]
;i[e]=4096===r?4096:(d[e]<<12)/(4096-r)|0,a[e]=4096===n?4096:(h[e]<<12)/(4096-n)|0,o[e]=4096===t?4096:(c[e]<<12)/(4096-t)|0}else if(8===p)for(let e=0;e<T.width;e++){const t=l[e],n=u[e],r=s[e];i[e]=0===r?0:4096-((4096-d[e]<<12)/r|0),
a[e]=0===t?0:4096-((4096-h[e]<<12)/t|0),o[e]=0===n?0:4096-((4096-c[e]<<12)/n|0)}else if(9===p)for(let e=0;e<T.width;e++){const t=u[e],n=c[e],r=h[e],p=d[e],f=s[e],m=l[e];i[e]=f<p?f:p,a[e]=m<r?m:r,o[e]=t<n?t:n}else if(10===p)for(let e=0;e<T.width;e++){
const t=s[e],n=u[e],r=c[e],p=d[e],f=h[e],m=l[e];i[e]=t>p?t:p,a[e]=m>f?m:f,o[e]=n>r?n:r}else if(11===p)for(let e=0;e<T.width;e++){const t=d[e],n=h[e],r=u[e],p=c[e],f=s[e],m=l[e];i[e]=f<=t?t-f:f-t,a[e]=m<=n?n-m:m-n,o[e]=r<=p?p-r:r-p
}else if(12===p)for(let e=0;e<T.width;e++){const t=l[e],n=u[e],r=d[e],p=c[e],f=s[e],m=h[e];i[e]=r+f-(f*r>>11),a[e]=t+m-(t*m>>11),o[e]=n+p-(n*p>>11)}}return t}}F.__class="TextureOpCombine";class U extends y{constructor(){super(1,!0),
void 0===this.markers&&(this.markers=null),void 0===this.firstMarker&&(this.firstMarker=null),void 0===this.lastMarker&&(this.lastMarker=null),this.aShortArray73=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(257),this.anInt3819=0}getMarker(e){
return e<0?this.firstMarker:e<this.markers.length?this.markers[e]:this.lastMarker}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(0,e)
;for(let e=0;e<T.width;e++){let r=n[e]>>4;r<0&&(r=0),r>256&&(r=256),t[e]=this.aShortArray73[r]}}return t}method3182(){const e=this.anInt3819;if(2===e)for(let e=0;e<257;e++){const t=e<<4;let n
;for(n=1;n<this.markers.length-1&&t>=this.markers[n][0];n++);const r=this.markers[n],i=this.markers[n-1],a=this.getMarker(n-2)[1],s=r[1],o=i[1],l=s-a,c=this.getMarker(n+1)[1],u=(t-i[0]<<12)/(r[0]-i[0])|0,h=c+o-a-s,d=u*u>>12
;let p=((u*h>>12)*d>>12)+(d*(a-o-h)>>12)+(u*l>>12)+o;p<=-32768&&(p=-32767),p>=32768&&(p=32767),this.aShortArray73[e]=0|p}else if(1===e)for(let e=0;e<257;e++){const t=e<<4;let n;for(n=1;this.markers.length-1>n&&this.markers[n][0]<=t;n++);
const r=this.markers[n-1],i=this.markers[n],a=(t-r[0]<<12)/(i[0]-r[0])|0,s=4096-y.COSINE[a>>5&255]>>1,o=4096-s;let l=s*i[1]+o*r[1]>>12;l<=-32768&&(l=-32767),l>=32768&&(l=32767),this.aShortArray73[e]=0|l}else for(let e=0;e<257;e++){const t=e<<4;let n
;for(n=1;this.markers.length-1>n&&t>=this.markers[n][0];n++);const r=this.markers[n-1],i=this.markers[n],a=(t-r[0]<<12)/(i[0]-r[0])|0,s=4096-a;let o=i[1]*a+s*r[1]>>12;o<=-32768&&(o=-32767),o>=32768&&(o=32767),this.aShortArray73[e]=0|o}}method3183(){
const e=this.markers[0],t=this.markers[1],n=this.markers[this.markers.length-1],r=this.markers[this.markers.length-2];this.lastMarker=[r[0]+r[0]-n[0],r[1]+r[1]-n[1]],this.firstMarker=[e[0]+e[0]-t[0],e[1]+e[1]-t[1]]}postDecode(){
if(null==this.markers&&(this.markers=[[0,0],[4096,4096]]),this.markers.length<2)throw Object.defineProperty(new Error("Curve operation requires at least two markers"),"__classes",{configurable:!0,
value:["java.lang.Throwable","java.lang.Object","java.lang.RuntimeException","java.lang.Exception"]});2===this.anInt3819&&this.method3183(),y.createTrigonometryTables(),this.method3182()}decode(e,t){if(0===t){this.anInt3819=e.readUnsignedByte(),
this.markers=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([e.readUnsignedByte(),2])
;for(let t=0;t<this.markers.length;t++)this.markers[t][0]=e.readUnsignedShort(),this.markers[t][1]=e.readUnsignedShort()}}}U.__class="TextureOpCurve";class B extends y{constructor(){super(1,!0),this.azimuth=3216,this.elevation=3216,this.depth=4096,
this.anIntArray57=[0,0,0]}decode(e,t){0===t?this.depth=e.readUnsignedShort():1===t?this.azimuth=e.readUnsignedShort():2===t&&(this.elevation=e.readUnsignedShort())}postDecode(){this.method642()}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){
const n=T.widthTimes32*this.depth>>12,r=this.getChildMonochromeOutput(0,e-1&T.heightMask),i=this.getChildMonochromeOutput(0,e),a=this.getChildMonochromeOutput(0,T.heightMask&e+1);for(let e=0;e<T.width;e++){
const s=n*(i[T.widthMask&e-1]-i[T.widthMask&e+1])>>12;let o=s>>4;const l=(a[e]-r[e])*n>>12;o<0&&(o=-o);let c=l>>4;c<0&&(c=-c),c>255&&(c=255),o>255&&(o=255);const u=255&p.INVERSE_SQUARE_ROOT_$LI$()[o+((c+1)*c>>1)];let h=s*u>>8,d=u*l>>8
;h=this.anIntArray57[0]*h>>12;let f=4096*u>>8;d=this.anIntArray57[1]*d>>12,f=this.anIntArray57[2]*f>>12,t[e]=f+d+h}}return t}method642(){const e=Math.cos(Math.fround(this.elevation/4096))
;this.anIntArray57[0]=4096*Math.sin(Math.fround(this.azimuth/4096))*e|0,this.anIntArray57[1]=Math.cos(Math.fround(this.azimuth/4096))*e*4096|0,this.anIntArray57[2]=4096*Math.sin(Math.fround(this.elevation/4096))|0
;const t=this.anIntArray57[0]*this.anIntArray57[0]>>12,n=this.anIntArray57[2]*this.anIntArray57[2]>>12,r=this.anIntArray57[1]*this.anIntArray57[1]>>12,i=4096*Math.sqrt(n+t+r>>12)|0;0!==i&&(this.anIntArray57[0]=(this.anIntArray57[0]<<12)/i|0,
this.anIntArray57[2]=(this.anIntArray57[2]<<12)/i|0,this.anIntArray57[1]=(this.anIntArray57[1]<<12)/i|0)}}B.__class="TextureOpEmboss";class z extends y{constructor(){super(1,!1),this.flipVertical=!0,this.flipHorizontal=!0}getMonochromeOutput(e){
const n=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const r=this.getChildMonochromeOutput(0,this.flipVertical?T.heightMask-e:e)
;if(this.flipHorizontal)for(let e=0;e<T.width;e++)n[e]=r[T.widthMask-e];else t.copy$int_A$int$int_A$int$int(r,0,n,0,T.width)}return n}decode(e,t){
0===t?this.flipHorizontal=1===e.readUnsignedByte():1===t?this.flipVertical=1===e.readUnsignedByte():2===t&&(this.monochrome=1===e.readUnsignedByte())}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildColorOutput(0,this.flipVertical?T.heightMask-e:e),r=n[0],i=n[1],a=t[0],s=n[2],o=t[1],l=t[2];if(this.flipHorizontal)for(let e=0;e<T.width;e++)a[e]=r[T.widthMask-e],o[e]=i[T.widthMask-e],
l[e]=s[T.widthMask-e];else for(let e=0;e<T.width;e++)a[e]=r[e],o[e]=i[e],l[e]=s[e]}return t}}z.__class="TextureOpFlip";class G extends y{constructor(){super(0,!0),this.scaleX=1,this.ratio=204,this.scaleY=1}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid)for(let n=0;n<T.width;n++){const r=T.normalisedX[n];let i=r*this.scaleX>>12;const a=T.normalisedY[e],s=a*this.scaleY>>12,o=this.scaleX*(r%(4096/this.scaleX|0))
;if(a%(4096/this.scaleY|0)*this.scaleY<this.ratio){for(i-=s;i<0;i+=4);for(;i>3;)i-=4;if(1!==i){t[n]=0;continue}if(o<this.ratio){t[n]=0;continue}}if(o<this.ratio){let e;for(e=i-s;e<0;e+=4);for(;e>3;)e-=4;if(e>0){t[n]=0;continue}}t[n]=4096}return t}
decode(e,t){0===t?this.scaleX=e.readUnsignedByte():1===t?this.scaleY=e.readUnsignedByte():2===t&&(this.ratio=e.readUnsignedShort())}}G.__class="TextureOpHerringbone";class V extends y{constructor(){super(0,!0)}getMonochromeOutput(e){
return T.normalisedX}}V.__class="TextureOpHorizontalGradient";class H extends y{constructor(){super(1,!1),void 0===this.red&&(this.red=0),void 0===this.green&&(this.green=0),void 0===this.hue&&(this.hue=0),void 0===this.lightness&&(this.lightness=0),
void 0===this.saturation&&(this.saturation=0),void 0===this.blue&&(this.blue=0),this.lightnessDelta=0,this.hueDelta=0,this.saturationDelta=0}hslToRgb(e,t,n){const r=n>2048?t+n-(n*t>>12):n*(t+4096)>>12
;if(r<=0)return void(this.red=this.green=this.blue=n);const i=n+n-r,a=(e*=6)>>12;let s=((r-i<<12)/r|0)*r>>12;s=s*(e-(a<<12))>>12;const o=r-s,l=i+s;0===a?(this.green=l,this.red=r,this.blue=i):1===a?(this.green=r,this.red=o,
this.blue=i):2===a?(this.red=i,this.green=r,this.blue=l):3===a?(this.red=i,this.green=o,this.blue=r):4===a?(this.red=l,this.green=i,this.blue=r):5===a&&(this.green=i,this.red=r,this.blue=o)}decode(e,t){
0===t?this.hueDelta=e.readShort():1===t?this.saturationDelta=(e.readByte()<<12)/100|0:2===t&&(this.lightnessDelta=(e.readByte()<<12)/100|0)}rgbToHsl(e,t,n){let r=e>t?e:t;r=n>r?n:r;let i=e<t?e:t;i=n<i?n:i,this.lightness=(r+i)/2|0;const a=r-i
;if(a<=0)this.hue=0;else{const o=(r-n<<12)/a|0,l=(r-e<<12)/a|0,c=(r-t<<12)/a|0;this.hue=r===e?i===t?o+20480:4096-c:r===t?i===n?l+4096:12288-o:i===e?c+12288:20480-l,this.hue=(s=this.hue/6)<0?Math.ceil(s):Math.floor(s)}var s
;this.lightness>0&&this.lightness<4096?this.saturation=(a<<12)/(this.lightness<=2048?2*this.lightness:8192-2*this.lightness)|0:this.saturation=0}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildColorOutput(0,e),r=n[0],i=n[1],a=t[0],s=n[2],o=t[1],l=t[2];for(let e=0;e<T.width;e++){for(this.rgbToHsl(r[e],i[e],s[e]),this.lightness+=this.lightnessDelta,this.saturation+=this.saturationDelta,
this.saturation<0&&(this.saturation=0),this.hue+=this.hueDelta,this.saturation>4096&&(this.saturation=4096);this.hue<0;)this.hue+=4096;for(this.lightness<0&&(this.lightness=0),this.lightness>4096&&(this.lightness=4096);this.hue>4096;)this.hue-=4096
;this.hslToRgb(this.hue,this.saturation,this.lightness),a[e]=this.red,o[e]=this.green,l[e]=this.blue}}return t}}H.__class="TextureOpHslAdjust";class j extends y{constructor(){super(3,!1)}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(0,e),r=this.getChildMonochromeOutput(1,e),i=this.getChildMonochromeOutput(2,e);for(let e=0;e<T.width;e++){const a=i[e]
;t[e]=4096===a?n[e]:0===a?r[e]:a*n[e]+r[e]*(4096-a)>>12}}return t}decode(e,t){0===t&&(this.monochrome=1===e.readUnsignedByte())}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildMonochromeOutput(2,e),r=this.getChildColorOutput(0,e),i=this.getChildColorOutput(1,e),a=t[0],s=t[1],o=t[2],l=r[1],c=r[0],u=i[1],h=i[0],d=r[2],p=i[2];for(let e=0;e<T.width;e++){const t=n[e];if(4096===t)a[e]=c[e],s[e]=l[e],
o[e]=d[e];else if(0===t)a[e]=h[e],s[e]=u[e],o[e]=p[e];else{const n=4096-t;a[e]=h[e]*n+c[e]*t>>12,s[e]=u[e]*n+t*l[e]>>12,o[e]=d[e]*t+n*p[e]>>12}}}return t}}j.__class="TextureOpInterpolate";class W extends y{constructor(){super(1,!1)}decode(e,t){
0===t&&(this.monochrome=1===e.readUnsignedByte())}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(0,e);for(let e=0;e<T.width;e++)t[e]=4096-n[e]}return t}
getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=this.getChildColorOutput(0,e),r=n[0],i=n[2],a=t[0],s=n[1],o=t[1],l=t[2];for(let e=0;e<T.width;e++)a[e]=4096-r[e],o[e]=4096-s[e],l[e]=4096-i[e]}return t
}}W.__class="TextureOpInvert";class $ extends y{constructor(){super(0,!0),void 0===this.anInt79&&(this.anInt79=0),this.anInt72=409,this.anInt81=1024,this.anInt77=1024,this.anInt82=819,this.anInt76=0,this.anInt75=1024,this.anInt84=1024,this.seed=0,
this.anInt87=2048}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(!this.monochromeImageCache.invalid)return t;let n=0;const r=this.monochromeImageCache.get$();let i=0,a=0,s=0,o=0,l=!0,c=0,d=!0;const p=this.anInt84*T.width>>12
;let f=0;const m=this.anInt72*T.height>>12,g=T.width*this.anInt87>>12,_=this.anInt82*T.height>>12;if(_<=1)return r[e];this.anInt79=(T.width/8|0)*this.anInt81>>12;const v=1+(T.width/p|0),y=new u(this.seed);let b=function(e){let t=function(e){
if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)}([v,3]),x=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)
}([v,3]);for(;;)for(;;){let e,u=p+h.nextInt(y,g-p),v=h.nextInt(y,_-m)+m,E=a+u;if(E>T.width&&(u=T.width-a,E=T.width),l)e=0;else{let t=o;e=x[o][2];let i=0,l=n+E;for(l<0&&(l+=T.width),T.width<l&&(l-=T.width);;){const u=x[t];if(u[0]<=l&&l<=u[1]){
if(t!==o){let t=a+n;t<0&&(t+=T.width),t>T.width&&(t-=T.width);for(let t=1;t<=i;t++){const n=x[(t+o)%c];e=Math.max(e,n[2])}for(let n=0;n<=i;n++){const i=x[(n+o)%c],a=i[2];if(a!==e){const n=i[1],o=i[0];let c,u;t<l?(c=Math.max(t,o),
u=Math.min(l,n)):0===o?(u=Math.min(l,n),c=0):(c=Math.max(t,o),u=T.width),this.method69(e-a,u-c,s+c,a,y,r)}}}o=t;break}t++,t>=c&&(t=0),i++}}if(T.height<v+e?v=T.height-e:d=!1,E===T.width){if(this.method69(v,u,a+i,e,y,r),d)return t;l=!1
;const p=f+1,m=b[f];d=!0,m[1]=E,s=i,c=p,m[0]=a,m[2]=v+e,i=h.nextInt(y,T.width);const g=x;o=0,n=i-s,x=b;let _=n;for(b=g,n<0&&(_=n+T.width),f=0,T.width<_&&(_-=T.width);;){const e=x[o];if(_>=e[0]&&e[1]>=_){a=0;break}o++,c<=o&&(o=0)}}else{const t=b[f++]
;t[1]=E,t[2]=v+e,t[0]=a,this.method69(v,u,i+a,e,y,r),a=E}}}postDecode(){}method69(e,n,r,i,a,s){const o=this.anInt77>0?4096-h.nextInt(a,this.anInt77):4096,l=this.anInt79*this.anInt75>>12,c=this.anInt79-(l>0?h.nextInt(a,l):0)
;if(T.width<=r&&(r-=T.width),c>0){if(e<=0||n<=0)return;const a=n/2|0,l=e/2|0,u=a>=c?c:a,h=c>l?l:c,d=r+u,p=n-2*u;for(let a=0;a<e;a++){const l=s[a+i];if(h<=a){const i=e-a-1;if(h<=i){for(let e=0;e<u;e++)l[T.widthMask&r+e]=l[T.widthMask&n+r-e-1]=o*e/u|0
;if(d+p<=T.width)t.fill$int_A$int$int$int(l,d,p,o);else{const e=T.width-d;t.fill$int_A$int$int$int(l,d,e,o),t.fill$int_A$int$int$int(l,0,p-e,o)}}else{const e=i*o/h|0;if(0===this.anInt76)for(let t=0;t<u;t++){const i=t*o/u|0
;l[T.widthMask&r+t]=l[n+r-t-1&T.widthMask]=e*i>>12}else for(let t=0;t<u;t++){const i=o*t/u|0;l[T.widthMask&t+r]=l[T.widthMask&r+n-t-1]=e>i?i:e}if(T.width<p+d){const n=T.width-d;t.fill$int_A$int$int$int(l,d,n,e),t.fill$int_A$int$int$int(l,0,p-n,e)
}else t.fill$int_A$int$int$int(l,d,p,e)}}else{const e=a*o/h|0;if(0===this.anInt76)for(let t=0;t<u;t++){const i=o*t/u|0;l[T.widthMask&t+r]=l[r+n-t-1&T.widthMask]=i*e>>12}else for(let t=0;t<u;t++){const i=o*t/u|0
;l[t+r&T.widthMask]=l[n+r-t-1&T.widthMask]=e<=i?e:i}if(d+p>T.width){const n=T.width-d;t.fill$int_A$int$int$int(l,d,n,e),t.fill$int_A$int$int$int(l,0,p-n,e)}else t.fill$int_A$int$int$int(l,d,p,e)}}
}else if(T.width>=n+r)for(let a=0;a<e;a++)t.fill$int_A$int$int$int(s[a+i],r,n,o);else{const a=T.width-r;for(let l=0;l<e;l++){const e=s[l+i];t.fill$int_A$int$int$int(e,r,a,o),t.fill$int_A$int$int$int(e,0,n-a,o)}}}decode(e,t){
0===t?this.seed=e.readUnsignedByte():1===t?this.anInt84=e.readUnsignedShort():2===t?this.anInt87=e.readUnsignedShort():3===t?this.anInt72=e.readUnsignedShort():4===t?this.anInt82=e.readUnsignedShort():5===t?this.anInt81=e.readUnsignedShort():6===t?this.anInt76=e.readUnsignedByte():7===t?this.anInt75=e.readUnsignedShort():8===t&&(this.anInt77=e.readUnsignedShort())
}}$.__class="TextureOpIrregularBricks";class q extends y{constructor(){super(1,!1)}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const n=t[0],r=t[1],i=t[2];for(let t=0;t<T.width;t++){this.method4301(t,e)
;const a=this.getChildColorOutput(0,q.y0);n[t]=a[0][q.x0],r[t]=a[1][q.x0],i[t]=a[2][q.x0]}}return t}decode(e,t){0===t&&(this.monochrome=1===e.readUnsignedByte())}method4301(e,t){
const n=T.normalisedX[e],r=T.normalisedY[t],i=Math.fround(Math.atan2(n-2048,r-2048));i>=-3.141592653589793&&i<=-2.356194490192345?(q.x0=e,q.y0=t):i<=-1.5707963267948966&&i>=-2.356194490192345?(q.y0=e,
q.x0=t):i<=-.7853981633974483&&i>=-1.5707963267948966?(q.x0=T.width-t,q.y0=e):i<=0&&i>=-.7853981633974483?(q.y0=T.height-t,q.x0=e):i>=0&&i<=.7853981633974483?(q.x0=T.width-e,
q.y0=T.height-t):i>=.7853981633974483&&i<=1.5707963267948966?(q.x0=T.width-t,q.y0=T.height-e):i>=1.5707963267948966&&i<=2.356194490192345?(q.x0=t,q.y0=T.height-e):i>=2.356194490192345&&i<=3.141592653589793&&(q.y0=t,q.x0=T.width-e),q.x0&=T.widthMask,
q.y0&=T.heightMask}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid)for(let n=0;n<T.width;n++){this.method4301(n,e);const r=this.getChildMonochromeOutput(0,q.y0);t[n]=r[q.x0]}return t}}q.y0=0,
q.x0=0,q.__class="TextureOpKaleidoscope";class X extends y{constructor(){super(0,!0),this.seed=0,this.minAngle=0,this.count=2e3,this.maxAngle=4096,this.length=16}postDecode(){y.createTrigonometryTables()}decode(e,t){
0===t?this.seed=e.readUnsignedByte():1===t?this.count=e.readUnsignedShort():2===t?this.length=e.readUnsignedByte():3===t?this.minAngle=e.readUnsignedShort():4===t&&(this.maxAngle=e.readUnsignedShort())}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const e=this.maxAngle>>1,t=this.monochromeImageCache.get$(),n=new u(this.seed);for(let r=0;r<this.count;r++){
let r=this.maxAngle>0?this.minAngle+h.nextInt(n,this.maxAngle)-e:this.minAngle;r=r>>4&255;let i=h.nextInt(n,T.width),a=h.nextInt(n,T.height),s=i+(y.COSINE[r]*this.length>>12),o=a+(y.SINE[r]*this.length>>12),l=o-a,c=s-i;if(0!==c||0!==l){l<0&&(l=-l),
c<0&&(c=-c);const e=l>c;if(e){const e=s,t=i;i=a,s=o,a=t,o=e}if(i>s){const e=i;i=s;const t=a;s=e,a=o,o=t}let r=a;const u=s-i;let d=-u/2|0,p=o-a;const f=1024-(h.nextInt(n,4096)>>2);p<0&&(p=-p);const m=2048/u|0,g=o<=a?-1:1;for(let n=i;n<s;n++){d+=p
;const a=f+(n-i)*m+1024,s=r&T.heightMask,o=T.widthMask&n;d>0&&(d+=-u,r+=g),e?t[s][o]=a:t[o][s]=a}}}}return t}}X.__class="TextureOpLineNoise";class Y extends y{constructor(){super(0,!0),this.anInt1159=20,this.anInt1157=0,this.anInt1160=1365,
this.anInt1164=0}decode(e,t){0===t?this.anInt1160=e.readUnsignedShort():1===t?this.anInt1159=e.readUnsignedShort():2===t?this.anInt1164=e.readUnsignedShort():3===t&&(this.anInt1157=e.readUnsignedShort())}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid)for(let n=0;n<T.width;n++){const r=this.anInt1164+((T.normalisedX[n]<<12)/this.anInt1160|0),i=this.anInt1157+((T.normalisedY[e]<<12)/this.anInt1160|0)
;let a=i,s=r,o=0,l=r*r>>12,c=i*i>>12;for(;l+c<16384&&o<this.anInt1159;)o++,a=i+2*(a*s>>12),s=r+l-c,c=a*a>>12,l=s*s>>12;t[n]=o>=this.anInt1159-1?0:(o<<12)/this.anInt1159|0}return t}}Y.__class="TextureOpMandelbrot";class K extends y{constructor(){
super(1,!0)}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildColorOutput(0,e),r=n[2],i=n[1],a=n[0];for(let e=0;e<T.width;e++)t[e]=(i[e]+a[e]+r[e])/3|0}return t}}
K.__class="TextureOpMonochrome";class J extends y{constructor(){super(1,!0),this.anInt4832=4096}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){
const n=this.getChildMonochromeOutput(0,e-1&T.heightMask),r=this.getChildMonochromeOutput(0,e),i=this.getChildMonochromeOutput(0,e+1&T.heightMask);for(let e=0;e<T.width;e++){
const a=this.anInt4832*(i[e]-n[e]),s=this.anInt4832*(r[T.widthMask&e+1]-r[T.widthMask&e-1])>>12,o=a>>12,l=o*o>>12,c=s*s>>12,u=4096*Math.sqrt(Math.fround((l+c+4096)/4096))|0,h=0===u?0:16777216/u|0;t[e]=4096-h}}return t}decode(e,t){
0===t&&(this.anInt4832=e.readUnsignedShort())}}J.__class="TextureOpMonochromeEdgeDetector";class Z extends y{constructor(e){if("number"==typeof e||null===e)super(0,!0),void 0===this.value&&(this.value=0),this.value=4096,this.value=e;else{
if(void 0!==e)throw new Error("invalid overload");{let e=4096;super(0,!0),void 0===this.value&&(this.value=0),this.value=4096,this.value=e}void 0===this.value&&(this.value=0)}}decode(e,t){0===t&&(this.value=(e.readUnsignedByte()<<12)/255|0)}
getMonochromeOutput(e){const n=this.monochromeImageCache.get$int(e);return this.monochromeImageCache.invalid&&t.fill$int_A$int$int$int(n,0,T.width,this.value),n}}Z.__class="TextureOpMonochromeFill";class Q extends y{constructor(){super(0,!0)}
noise(e,t){let n=e+57*t;return n^=n<<1,4096-(0|(n*(15731*n*n+789221|0)+1376312589&2147483647)/262144)|0}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=T.normalisedY[e]
;for(let e=0;e<T.width;e++)t[e]=this.noise(T.normalisedX[e],n)%4096}return t}}Q.__class="TextureOpNoise";class ee extends y{constructor(){super(0,!0),void 0===this.aShortArray37&&(this.aShortArray37=null),
void 0===this.aShortArray38&&(this.aShortArray38=null),this.permutation=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(512),this.aBoolean181=!0,this.anInt2620=1638,this.anInt2625=4,this.anInt2628=4,this.seed=0,this.anInt2631=4}method2049(){
if(this.anInt2620>0){this.aShortArray38=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(this.anInt2628),this.aShortArray37=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(this.anInt2628)
;for(let e=0;e<this.anInt2628;e++)this.aShortArray37[e]=4096*Math.pow(Math.fround(this.anInt2620/4096),e)|0,this.aShortArray38[e]=0|Math.pow(2,e)}else if(null!=this.aShortArray37&&this.aShortArray37.length===this.anInt2628){this.aShortArray38=(e=>{
let t=[];for(;e-- >0;)t.push(0);return t})(this.anInt2628);for(let e=0;e<this.anInt2628;e++)this.aShortArray38[e]=0|Math.pow(2,e)}}decode(e,t){
if(0===t)this.aBoolean181=1===e.readUnsignedByte();else if(1===t)this.anInt2628=e.readUnsignedByte();else if(2===t){if(this.anInt2620=e.readShort(),this.anInt2620<0){this.aShortArray37=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(this.anInt2628)
;for(let t=0;t<this.anInt2628;t++)this.aShortArray37[t]=0|e.readShort()}
}else 3===t?this.anInt2631=this.anInt2625=e.readUnsignedByte():4===t?this.seed=e.readUnsignedByte():5===t?this.anInt2631=e.readUnsignedByte():6===t&&(this.anInt2625=e.readUnsignedByte())}method2051(e,t,n,r,i,a){const s=a-4096;let o=e>>12,l=o+1
;o&=255,l>=i&&(l=0);const c=(e&=4095)-4096,u=255&l,h=3&this.permutation[r+o];let d;d=h<=1?0===h?a+e:a-e:2===h?e-a:-a-e;const p=3&this.permutation[r+u],f=A.PERLIN_FADE_$LI$()[e];let m;m=p>1?2===p?c-a:-c-a:0===p?a+c:a-c
;const g=3&this.permutation[o+t],_=d+(f*(m-d)>>12);let v;v=g>1?2===g?e-s:-e-s:0===g?s+e:s-e;const y=3&this.permutation[t+u];let b;return b=y<=1?0===y?s+c:s-c:2===y?c-s:-s-c,_+((v+((b-v)*f>>12)-_)*n>>12)}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);return this.monochromeImageCache.invalid&&this.method2053(t,e),t}method2053(e,t){const n=this.anInt2625*T.normalisedY[t];if(1===this.anInt2628){
const t=this.aShortArray37[0],r=this.aShortArray38[0]<<12,i=r*this.anInt2631>>12,a=this.anInt2625*r>>12;let s=r*n>>12;const o=s>>12;s&=4095;const l=255&this.permutation[255&o],c=A.PERLIN_FADE_$LI$()[s];let u=o+1;a<=u&&(u=0)
;const h=255&this.permutation[255&u];if(this.aBoolean181)for(let n=0;n<T.width;n++){const a=T.normalisedX[n]*this.anInt2631;let o=this.method2051(r*a>>12,h,c,l,i,s);o=o*t>>12,e[n]=2048+(o>>1)}else for(let n=0;n<T.width;n++){
const a=T.normalisedX[n]*this.anInt2631,o=this.method2051(r*a>>12,h,c,l,i,s);e[n]=t*o>>12}return}const r=this.aShortArray37[0];if(r>8||r<-8){const t=this.aShortArray38[0]<<12;let i=t*n>>12;const a=i>>12,s=this.anInt2631*t>>12,o=t*this.anInt2625>>12
;i&=4095;const l=255&this.permutation[255&a],c=A.PERLIN_FADE_$LI$()[i];let u=a+1;u>=o&&(u=0);const h=255&this.permutation[255&u];for(let n=0;n<T.width;n++){const a=this.anInt2631*T.normalisedX[n],o=this.method2051(t*a>>12,h,c,l,s,i);e[n]=r*o>>12}}
for(let t=1;t<this.anInt2628;t++){const r=this.aShortArray37[t];if(r>8||r<-8){const i=this.aShortArray38[t]<<12,a=i*this.anInt2631>>12;let s=n*i>>12;const o=this.anInt2625*i>>12,l=s>>12;let c=l+1;s&=4095;const u=255&this.permutation[255&l]
;c>=o&&(c=0);const h=255&this.permutation[255&c],d=A.PERLIN_FADE_$LI$()[s];if(this.aBoolean181&&t===this.anInt2628-1)for(let t=0;t<T.width;t++){const n=T.normalisedX[t]*this.anInt2631;let o=this.method2051(n*i>>12,h,d,u,a,s);o=e[t]+(r*o>>12),
e[t]=2048+(o>>1)}else for(let t=0;t<T.width;t++){const n=T.normalisedX[t]*this.anInt2631,o=this.method2051(i*n>>12,h,d,u,a,s);e[t]+=r*o>>12}}}}postDecode(){this.permutation=y.getPermutation(this.seed),this.method2049()
;for(let e=this.anInt2628-1;e>=1;e--){const t=this.aShortArray37[e];if(t>8||t<-8)break;this.anInt2628--}}}ee.__class="TextureOpPerlinNoise";class te extends y{constructor(){super(3,!1),this.magnitude=32768}postDecode(){y.createTrigonometryTables()}
getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=this.getChildMonochromeOutput(1,e),r=this.getChildMonochromeOutput(2,e);for(let i=0;i<T.width;i++){
const a=n[i]>>4&255,s=this.magnitude*r[i]>>12,o=s*y.SINE[a]>>12,l=T.heightMask&e+(o>>12),c=s*y.COSINE[a]>>12,u=T.widthMask&i+(c>>12),h=this.getChildMonochromeOutput(0,l);t[i]=h[u]}}return t}decode(e,t){
0===t?this.magnitude=e.readUnsignedShort()<<4:1===t&&(this.monochrome=1===e.readUnsignedByte())}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildMonochromeOutput(1,e),r=this.getChildMonochromeOutput(2,e),i=t[0],a=t[1],s=t[2];for(let t=0;t<T.width;t++){
const o=r[t]*this.magnitude>>12,l=255*n[t]>>12&255,c=o*y.SINE[l]>>12,u=(o*y.COSINE[l]>>12>>12)+t&T.widthMask,h=(c>>12)+e&T.heightMask,d=this.getChildColorOutput(0,h);i[t]=d[0][u],a[t]=d[1][u],s[t]=d[2][u]}}return t}}
te.__class="TextureOpPolarDistortion";class ne extends y{constructor(){super(1,!1),this.range=2048,this.minValue=1024,this.maxValue=3072}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){
const n=this.getChildMonochromeOutput(0,e);for(let e=0;e<T.width;e++)t[e]=this.minValue+(n[e]*this.range>>12)}return t}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){
const n=this.getChildColorOutput(0,e),r=n[0],i=n[1],a=t[0],s=t[2],o=t[1],l=n[2];for(let e=0;e<T.width;e++)a[e]=this.minValue+(this.range*r[e]>>12),o[e]=this.minValue+(this.range*i[e]>>12),s[e]=this.minValue+(this.range*l[e]>>12)}return t}
postDecode(){this.range=this.maxValue-this.minValue}decode(e,t){0===t?this.minValue=e.readUnsignedShort():1===t?this.maxValue=e.readUnsignedShort():2===t&&(this.monochrome=1===e.readUnsignedByte())}}ne.__class="TextureOpRange";class re extends y{
constructor(){super(0,!0),void 0===this.ops&&(this.ops=null)}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);return this.monochromeImageCache.invalid&&this.render(this.monochromeImageCache.get$()),t}getColorOutput(e){
const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid){const e=T.width,t=function(e){let t=function(e){if(0===e.length)return 0;{let n=[];for(let r=0;r<e[0];r++)n.push(t(e.slice(1)));return n}};return t(e)
}([T.height,e]),n=this.colorImageCache.get$();this.render(t);for(let e=0;e<T.height;e++){const r=n[e],i=r[1],a=r[2],s=t[e],o=r[0];for(let e=0;e<T.width;e++){const t=s[e];a[e]=(255&t)<<4,i[e]=t>>4&4080,o[e]=t>>12&4080}}}return t}decode(e,t){if(0===t){
this.ops=(e=>{let t=[];for(;e-- >0;)t.push(null);return t})(e.readUnsignedByte());for(let t=0;t<this.ops.length;t++){const n=e.readUnsignedByte()
;0===n?this.ops[t]=E.create(e):1===n?this.ops[t]=b.create(e):2===n?this.ops[t]=w.create(e):3===n&&(this.ops[t]=x.create(e))}}else 1===t&&(this.monochrome=1===e.readUnsignedByte())}render(e){const t=T.width,n=T.height;if(l.sub35_method4335(e),
l.sub18_method4374(T.heightMask,T.widthMask),null!=this.ops)for(let e=0;e<this.ops.length;e++){const r=this.ops[e],i=r.outlineColor;r.fillColor>=0?i>=0?r.render(t,n):r.renderFill(t,n):i>=0&&r.renderOutline(t,n)}}}re.__class="TextureOpRasterizer"
;class ie extends y{constructor(){super(0,!1),void 0===this.height&&(this.height=0),void 0===this.width&&(this.width=0),void 0===this.pixels&&(this.pixels=null),this.spriteId=-1}loadSprite(){if(null!=this.pixels)return!0;if(this.spriteId>=0){
const e=T.loadedTextures.getSprite(this.spriteId);return this.width=e.width,this.height=e.height,this.pixels=e.data,!0}return!1}decode(e,t){0===t&&(this.spriteId=e.readUnsignedShort())}clearImageCache(){super.clearImageCache(),this.pixels=null}
getSpriteId(){return this.spriteId}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid&&this.loadSprite()){const n=t[0],r=t[1],i=t[2];let a=(T.height===this.height?e:e*this.height/T.height|0)*this.width
;if(this.width===T.width)for(let e=0;e<T.width;e++)n[e]=this.pixels[a++],r[e]=this.pixels[a++],i[e]=this.pixels[a++],a++;else for(let e=0;e<T.width;e++){const t=this.width*e/T.width|0;n[e]=this.pixels[4*(a+t)+0]<<4,r[e]=this.pixels[4*(a+t)+1]<<4,
i[e]=this.pixels[4*(a+t)+2]<<4}}return t}}ie.__class="TextureOpSprite";class ae extends y{constructor(){super(0,!0),void 0===this.anIntArray498&&(this.anIntArray498=null),void 0===this.anIntArray499&&(this.anIntArray499=null),this.frequency=10,
this.ratio=2048,this.mode=0}decode(e,t){0===t?this.frequency=e.readUnsignedByte():1===t?this.ratio=e.readUnsignedShort():2===t&&(this.mode=e.readUnsignedByte())}postDecode(){this.method3784()}method3784(){this.anIntArray498=(e=>{let t=[]
;for(;e-- >0;)t.push(0);return t})(this.frequency+1);const e=4096/this.frequency|0;this.anIntArray499=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(this.frequency+1);const t=e*this.ratio>>12;let n=0
;for(let r=0;r<this.frequency;r++)this.anIntArray498[r]=n,this.anIntArray499[r]=t+n,n+=e;this.anIntArray498[this.frequency]=4096,this.anIntArray499[this.frequency]=this.anIntArray499[0]+4096}getMonochromeOutput(e){
const n=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const r=T.normalisedY[e];if(0===this.mode){let e=0;for(let t=0;t<this.frequency;t++)if(r>=this.anIntArray498[t]&&r<this.anIntArray498[t+1]){
r<this.anIntArray499[t]&&(e=4096);break}t.fill$int_A$int$int$int(n,0,T.width,e)}else for(let e=0;e<T.width;e++){let t=0,i=0;const a=T.normalisedX[e],s=this.mode;1===s?t=a:2===s?t=2048+(r+a-4096>>1):3===s&&(t=2048+(a-r>>1))
;for(let e=0;e<this.frequency;e++)if(this.anIntArray498[e]<=t&&t<this.anIntArray498[e+1]){t<this.anIntArray499[e]&&(i=4096);break}n[e]=i}}return n}}ae.__class="TextureOpSquareWaveform";class se extends y{constructor(){super(0,!1),
void 0===this.width&&(this.width=0),void 0===this.height&&(this.height=0),void 0===this.pixels&&(this.pixels=null),this.textureId=-1}getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid&&this.loadTexture()){
let n=this.width*(T.height===this.height?e:e*this.height/T.height|0);const r=t[0],i=t[2],a=t[1];if(this.width===T.width)for(let e=0;e<T.width;e++){const t=this.pixels[n++];i[e]=(255&t)<<4,a[e]=t>>4&4080,r[e]=t>>12&4080
}else for(let e=0;e<T.width;e++){const t=this.width*e/T.width|0,s=this.pixels[t+n];i[e]=(255&s)<<4,a[e]=s>>4&4080,r[e]=s>>12&4080}}return t}loadTexture(){if(null!=this.pixels)return!0;if(this.textureId>=0){
const e=T.loadedTextures.getTexture(this.textureId);this.width=e.width,this.height=e.height,this.pixels=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(0|e.data.length);const t=e.data
;for(let n=0;n<e.data.length/4;n++)this.pixels[n]=t[4*n+0]<<16|t[4*n+1]<<8|t[4*n+2];return!0}return!1}decode(e,t){0===t&&(this.textureId=e.readUnsignedShort())}clearImageCache(){super.clearImageCache(),this.pixels=null}getTextureId(){
return this.textureId}}se.__class="TextureOpTexture";class oe extends y{constructor(){super(1,!1),this.horizontalTiles=4,this.verticalTiles=4}decode(e,t){0===t?this.horizontalTiles=e.readUnsignedByte():1===t&&(this.verticalTiles=e.readUnsignedByte())
}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=T.width/this.horizontalTiles|0,r=T.height/this.verticalTiles|0;let i;if(r>0){const t=e%r
;i=this.getChildMonochromeOutput(0,T.height*t/r|0)}else i=this.getChildMonochromeOutput(0,0);for(let e=0;e<T.width;e++)if(n>0){const r=e%n;t[e]=i[r*T.width/n|0]}else t[e]=i[0]}return t}getColorOutput(e){const t=this.colorImageCache.get$int(e)
;if(this.colorImageCache.invalid){const n=T.width/this.horizontalTiles|0,r=T.height/this.verticalTiles|0;let i;if(r>0){const t=e%r;i=this.getChildColorOutput(0,t*T.height/r|0)}else i=this.getChildColorOutput(0,0)
;const a=i[0],s=i[1],o=i[2],l=t[0],c=t[1],u=t[2];for(let e=0;e<T.width;e++){let t;if(n<=0)t=0;else{const r=e%n;t=T.width*r/n|0}l[e]=a[t],c[e]=s[t],u[e]=o[t]}}return t}}oe.__class="TextureOpTile";class le extends y{constructor(){super(0,!0)}
getMonochromeOutput(e){const n=this.monochromeImageCache.get$int(e);return this.monochromeImageCache.invalid&&t.fill$int_A$int$int$int(n,0,T.width,T.normalisedY[e]),n}}le.__class="TextureOpVerticalGradient";class ce extends y{constructor(){
super(0,!0),this.aShortArray81=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(512),this.anInt4553=2,this.anInt4552=2048,this.seed=0,this.anInt4548=1,this.anInt4551=5,this.permutation=(e=>{let t=[];for(;e-- >0;)t.push(0);return t})(512),
this.anInt4557=5}postDecode(){this.permutation=y.getPermutation(this.seed),this.method3715()}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){
const n=T.normalisedY[e]*this.anInt4557+2048,r=n>>12,i=r+1;for(let e=0;e<T.width;e++){ce.anInt5205=2147483647,ce.anInt2979=2147483647,ce.anInt2464=2147483647,ce.anInt4260=2147483647;const a=T.normalisedX[e]*this.anInt4551+2048,s=a>>12,o=s+1
;for(let e=r-1;e<=i;e++){const t=255&this.permutation[255&(e>=this.anInt4557?e-this.anInt4557:e)];for(let r=s-1;r<=o;r++){let i=2*(255&this.permutation[t+(this.anInt4551<=r?r-this.anInt4551:r)&255])
;const s=a-(r<<12)-this.aShortArray81[i++],o=n-(e<<12)-this.aShortArray81[i],l=this.anInt4548;let c;if(1===l)c=o*o+s*s>>12;else if(3===l){const e=s>=0?s:-s,t=o<0?-o:o;c=t>=e?t:e}else if(4===l){
const e=4096*Math.sqrt(Math.fround((s<0?-s:s)/4096))|0,t=(4096*Math.sqrt(Math.fround((o>=0?o:-o)/4096))|0)+e;c=t*t>>12}else if(5===l){const e=s*s,t=o*o;c=4096*Math.sqrt(Math.sqrt(Math.fround((e+t)/16777216)))|0
}else c=2===l?(s<0?-s:s)+(o>=0?o:-o):4096*Math.sqrt(Math.fround((s*s+o*o)/16777216))|0;c<ce.anInt4260?(ce.anInt5205=ce.anInt2979,ce.anInt2979=ce.anInt2464,ce.anInt2464=ce.anInt4260,ce.anInt4260=c):c<ce.anInt2464?(ce.anInt5205=ce.anInt2979,
ce.anInt2979=ce.anInt2464,ce.anInt2464=c):c<ce.anInt2979?(ce.anInt5205=ce.anInt2979,ce.anInt2979=c):ce.anInt5205>c&&(ce.anInt5205=c)}}const l=this.anInt4553
;0===l?t[e]=ce.anInt4260:1===l?t[e]=ce.anInt2464:3===l?t[e]=ce.anInt2979:4===l?t[e]=ce.anInt5205:2===l&&(t[e]=ce.anInt2464-ce.anInt4260)}}return t}method3715(){const e=new u(this.seed);if(this.aShortArray81=(e=>{let t=[];for(;e-- >0;)t.push(0)
;return t})(512),this.anInt4552>0)for(let t=0;t<512;t++)this.aShortArray81[t]=0|h.nextInt(e,this.anInt4552)}decode(e,t){
0===t?this.anInt4551=this.anInt4557=e.readUnsignedByte():1===t?this.seed=e.readUnsignedByte():2===t?this.anInt4552=e.readUnsignedShort():3===t?this.anInt4553=e.readUnsignedByte():4===t?this.anInt4548=e.readUnsignedByte():5===t?this.anInt4551=e.readUnsignedByte():6===t&&(this.anInt4557=e.readUnsignedByte())
}}ce.anInt5205=0,ce.anInt2979=0,ce.anInt2464=0,ce.anInt4260=0,ce.__class="TextureOpVoronoiNoise";class ue extends y{constructor(){super(0,!0),this.shape=0,this.frequency=1,this.waveform=0}getMonochromeOutput(e){
const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const n=T.normalisedY[e],r=n-2048>>1;for(let e=0;e<T.width;e++){const i=T.normalisedX[e],a=i-2048>>1;let s;if(0===this.shape)s=(i-n)*this.frequency;else{
const e=r*r+a*a>>12,t=4096*Math.sqrt(Math.fround(e/4096))|0;s=this.frequency*t*3.141592653589793|0}let o=s-(-4096&s);if(0===this.waveform)o=y.SINE[o>>4&255]+4096>>1;else if(2===this.waveform){let e=o-2048;e<0&&(e=-e),o=2048-e<<1}t[e]=o}}return t}
postDecode(){y.createTrigonometryTables()}decode(e,t){0===t?this.shape=e.readUnsignedByte():1===t?this.waveform=e.readUnsignedByte():3===t&&(this.frequency=e.readUnsignedByte())}}ue.__class="TextureOpWaveform";class he extends y{constructor(){
super(0,!0),this.thickness=585}decode(e,t){0===t&&(this.thickness=e.readUnsignedShort())}getMonochromeOutput(e){const t=this.monochromeImageCache.get$int(e);if(this.monochromeImageCache.invalid){const r=T.normalisedY[e];for(let e=0;e<T.width;e++){
const i=T.normalisedX[e];if(this.thickness<i&&4096-this.thickness>i&&r>2048-this.thickness&&this.thickness+2048>r){let r=2048-i;r=r<0?-r:r,r<<=12,r=(n=r/2048-this.thickness)<0?Math.ceil(n):Math.floor(n),t[e]=4096-r
}else if(2048-this.thickness<i&&this.thickness+2048>i){let n=r-2048;n=n>=0?n:-n,n-=this.thickness,n<<=12,t[e]=n/(2048-this.thickness)|0}else if(r<this.thickness||r>4096-this.thickness){let n=i-2048;n=n<0?-n:n,n-=this.thickness,n<<=12,
t[e]=n/(2048-this.thickness)|0}else if(this.thickness<=i&&i<=4096-this.thickness)t[e]=0;else{let n=2048-r;n=n<0?-n:n,n<<=12,n=(e=>e<0?Math.ceil(e):Math.floor(e))(n/2048-this.thickness),t[e]=4096-n}}}var n;return t}}he.__class="TextureOpWeave"
;class de extends ie{getColorOutput(e){const t=this.colorImageCache.get$int(e);if(this.colorImageCache.invalid&&this.loadSprite()){const n=t[1],r=t[2],i=this.height*(e%this.height),a=t[0];for(let e=0;e<T.width;e++){const t=this.pixels[i+e%this.width]
;r[e]=(255&t)<<4,n[e]=t>>4&4080,a[e]=t>>12&4080}}return t}}de.__class="TextureOpTiledSprite",A.PERLIN_FADE_$LI$(),A.__static_initialize(),T.brightnessMap_$LI$(),y.permutations_$LI$(),_.VALID_$LI$(),g.VALID_$LI$(),p.INVERSE_SQUARE_ROOT_$LI$(),
p.__static_initialize(),u.twoToTheXMinus48_$LI$(),u.twoToTheXMinus24_$LI$(),u.__static_initialize(),n.largeBuffers_$LI$(),n.mediumBuffers_$LI$(),n.smallBuffers_$LI$(),e.exports={Texture:T,Buffer:m}}()},8592:(e,t,n)=>{"use strict"
;e.exports=n.p+"generated/0d4d8c5997e9301d25bf.js"},9638:(e,t,n)=>{"use strict";e.exports=n.p+"generated/b582dc588329efcd7868.mp4"},3447:(e,t,n)=>{"use strict";e.exports=n.p+"generated/63f26f290902e5c67e26.mp4"},4094:e=>{"use strict"
;e.exports='\r\n\r\n{\r\n\t"0x01": { "name":                           "name", "read": "paddedstring"},\r\n\t"0x02": { "name":                    "description", "read": ["struct",\r\n\t\t["hasironman", "unsigned byte"],\r\n\t\t["unk0","unsigned byte"],\r\n\t\t["descr","paddedstring"],\r\n\t\t["unk1",["opt",["hasironman",2],"unsigned byte"]],\r\n\t\t["descr_ironman",["opt",["hasironman",2],"paddedstring"]]\r\n\t]},\r\n\t"0x03": { "name":                       "category", "read": "unsigned short"},\r\n\t"0x04": { "name":                       "spriteId", "read": "variable unsigned int"},\r\n\t"0x05": { "name":                      "runescore", "read": "unsigned byte"},\r\n\t"0x06": { "name":                   "unknown_0x06", "read": "unsigned short"},\r\n\t"0x07": { "name":                     "rewardtext", "read": "paddedstring"},\r\n\t"0x08": { "name":                  "subach_skills", "read": ["array","variable unsigned short", ["struct",\r\n\t\t["ironman","unsigned byte"],\r\n\t\t["level","unsigned byte"],\r\n\t\t["text","paddedstring"],\r\n\t\t["unk_0","unsigned byte"],\r\n\t\t["unk_1","unsigned byte"],\r\n\t\t["skill","unsigned byte"]\r\n\t]]},\r\n\t"0x09": { "name":                 "subach_varbits", "read": ["array", ["struct",\r\n\t\t["type","unsigned byte"],\r\n\t\t["value","variable unsigned int"],\r\n\t\t["name","paddedstring"],\r\n\t\t["stepsize","unsigned byte"],\r\n\t\t["varbit","unsigned short"]\r\n\t]]},\r\n\t"0x0A": { "name":           "varbit_partial_state", "read": ["array", ["struct",\r\n\t\t["type","unsigned byte"],\r\n\t\t["value","variable unsigned int"],\r\n\t\t["name","paddedstring"],\r\n\t\t["stepsize","unsigned byte"],\r\n\t\t["varbit","unsigned short"]\r\n\t]]},\r\n\t"0x0B": { "name":          "previous_achievements", "read": ["array", "unsigned tribyte"]},\r\n\t"0x0C": { "name":                   "skill_reqs_2", "read": ["array", "variable unsigned short", ["struct",\r\n\t\t["unk0","unsigned byte"],\r\n\t\t["level","unsigned byte"],\r\n\t\t["name","paddedstring"],\r\n\t\t["unk1","unsigned byte"],\r\n\t\t["skill","unsigned short"]\r\n\t]]},\r\n\t"0x0E": { "name":                "progress_states", "read": ["array", "variable unsigned short", ["struct",\r\n\t\t["unk0","unsigned byte"],\r\n\t\t["value","variable unsigned int"],\r\n\t\t["name","paddedstring"],\r\n\t\t["varbits",["array","unsigned short"]]\r\n\t]]},\r\n\t"0x0D": { "name":                        "subreqs", "read": ["array", "variable unsigned short", ["struct",\r\n\t\t["unk0","unsigned byte"],\r\n\t\t["value","variable unsigned int"],\r\n\t\t["name","paddedstring"],\r\n\t\t["varbits",["array","unsigned short"]]\r\n\t]]},\r\n\t"0x0F": { "name":               "sub_achievements", "read": ["array", "variable unsigned short", ["struct",\r\n\t\t["unk0","unsigned byte"],\r\n\t\t["achievement","unsigned short"]\r\n\t]]},\r\n\t"0x10": { "name":                    "subcategory", "read": "unsigned short"},\r\n\t//only used for subachievements of "find all the hidden Zygomites on Anachronia."\r\n\t"0x11": { "name":                        "unk0x11", "read": "true"},\r\n\t"0x12": { "name":                         "hidden", "read": "unsigned byte"},\r\n\t"0x13": { "name":                            "f2p", "read": "true"},\r\n\t"0x14": { "name":       "quest_req_for_miniquests", "read": ["array", "unsigned tribyte"]},\r\n\t"0x15": { "name":                      "quest_ids", "read": ["array", "unsigned tribyte"]},\r\n\t"0x17": { "name":                         "reqs23", "read": ["array", "variable unsigned short",["struct",\r\n\t\t["type","unsigned byte"],\r\n\t\t["varbit","unsigned short"],\r\n\t\t["stepsize","unsigned byte"],\r\n\t\t["name",["opt",["type",0],"paddedstring"]],\r\n\t\t["requirement",["opt",["type",1],"unsigned short"]],\r\n\t\t["subbit","unsigned byte"]\r\n\t]]},\r\n\t"0x19": { "name":                         "reqs25", "read": ["array", "variable unsigned short",["struct",\r\n\t\t["type","unsigned byte"],\r\n\t\t["varbit","unsigned short"],\r\n\t\t["value","unsigned byte"],\r\n\t\t["name",["opt",["type",0],"paddedstring"]],\r\n\t\t["requirement",["opt",["type",1],"unsigned short"]],\r\n\t\t["subbit","unsigned byte"]\r\n\t]]},\r\n\t"0x1B": { "name":                   "unknown_0x13", "read": "true"},\r\n\t"0x1C": { "name":                "skill_req_count", "read": ["array", "unsigned byte"]},\r\n\t"0x1D": { "name":                   "unknown_0x1D", "read": "unsigned byte"},\r\n\t"0x1E": { "name":                   "subreq_count", "read": ["array", "variable unsigned short"]},\r\n\t"0x1F": { "name":                   "unknown_0x1F", "read": "unsigned byte"},\r\n\t"0x20": { "name":                   "unknown_0x20", "read": "unsigned tribyte"},\r\n\t"0x23": { "name":                   "unknown_0x23", "read": "true"},\r\n\t"0x25": { "name":                   "unknown_0x25", "read": "unsigned byte"},\r\n\t"0x26": { "name":                   "unknown_0x26", "read": "true"}\r\n}\r\n'
},5191:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                            "baseAnims", "read": ["struct",["idle","animid"],["walk","animid"]] },\r\n\t"0x02": { "name":                           "unknown_02", "read": "animid" },//also walk?\r\n\t"0x03": { "name":                           "unknown_03", "read": "animid" },\r\n\t"0x05": { "name":                           "unknown_05", "read": "animid" },\r\n\t"0x04": { "name":                           "unknown_04", "read": "animid" },\r\n\t"0x06": { "name":                                  "run", "read": "animid" },\r\n\t"0x07": { "name":                           "unknown_07", "read": "animid" },\r\n\t"0x08": { "name":                           "unknown_08", "read": "animid" },\r\n\t"0x09": { "name":                           "unknown_09", "read": "animid" },\r\n\t"0x1a": { "name":                           "unknown_1a", "read": ["tuple","ubyte","ubyte"] },\r\n\t"0x1b": { "name":                           "unknown_1b", "read": "animid" },\r\n\t"0x26": { "name":                           "unknown_26", "read": "animid" },//walk\r\n\t"0x27": { "name":                           "unknown_27", "read": "animid" },//walk\r\n\t"0x28": { "name":                           "unknown_28", "read": "animid" },//backward walk??\r\n\t"0x29": { "name":                           "unknown_29", "read": "animid" },//walk sideways left\r\n\t"0x2a": { "name":                           "unknown_2a", "read": "animid" },//walk sideways right\r\n\t"0x2b": { "name":                           "unknown_2b", "read": "animid" },\r\n\t"0x2c": { "name":                           "unknown_2c", "read": "animid" },\r\n\t"0x2d": { "name":                           "unknown_2d", "read": "animid" },\r\n\t"0x2e": { "name":                           "unknown_2e", "read": "animid" },\r\n\t"0x2f": { "name":                           "unknown_2f", "read": "animid" },\r\n\t"0x30": { "name":                           "unknown_30", "read": "animid" },\r\n\t"0x31": { "name":                           "unknown_31", "read": "animid" },\r\n\t"0x32": { "name":                           "unknown_32", "read": "animid" },//also walk\r\n\t"0x33": { "name":                           "unknown_33", "read": "animid" },//also walk\r\n\t"0x34": { "name":                           "idleVariations", "read": ["array","ubyte",["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t["animid","animid"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t["probably_chance","ubyte"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t["always0",["match","buildnr",{">=916":"ubyte","other":0}]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t]] },\r\n\t"0x35": { "name":                           "unknown_35", "read": "true" },\r\n\t"0x36": { "name":                           "unknown_36", "read": ["tuple","ubyte","ubyte"] }\r\n}'
},9694:e=>{"use strict"
;e.exports='["struct",\r\n    ["magic",["buffer",4,"hex"]],//always "JAGA"\r\n    ["unk_1","uint"],\r\n    ["unk_2","uint"],//uncompressed size?\r\n    ["samplefreq","uint"],\r\n    ["unk_3","uint"],\r\n    ["chunks",["chunkedarray","uint",\r\n        [\r\n            ["len","uint"],\r\n            ["fileid","uint"]\r\n        ],[\r\n            ["data",["opt",["fileid",0],["buffer",["ref","len"],"buffer"]]]\r\n        ]\r\n    ]]\r\n]'
},4882:e=>{"use strict"
;e.exports='["struct",\r\n\t["$flags","ushort"],\r\n\t//can\'t use array since i don\'t have a way to ref array index in the flag...\r\n\t["slots",["tuple",\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",0,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",1,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",2,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",3,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",4,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",5,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",6,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",7,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",8,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",9,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",10,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",11,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",12,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",13,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",14,"bitflag"],"playeritemedit"]]\r\n\t\t],\r\n\t\t["struct",\r\n\t\t\t["slot",["itemvar","ref"]],\r\n\t\t\t["cust",["opt",["$flags",15,"bitflag"],"playeritemedit"]]\r\n\t\t]\r\n\t]],\r\n\t["haircol0","ubyte"],\r\n\t["bodycol","ubyte"],\r\n\t["legscol","ubyte"],\r\n\t["bootscol","ubyte"],\r\n\t["skincol0","ubyte"],\r\n\t["skincol1","ubyte"],\r\n\t["haircol1","ubyte"],\r\n\t["unkbuf",["buffer",13,"hex"]],\r\n\t["stance","ushort"]\r\n]'
},466:e=>{"use strict"
;e.exports='["struct",\r\n\t["gender","ubyte"],\r\n\t["$avatype","playeritem"],\r\n\t["player",["opt",["$avatype",-1,"eqnot"],["struct",\r\n\t\t["slots",["tuple",\r\n\t\t\t["ref","$avatype"],\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem",\r\n\t\t\t"playeritem"\r\n\t\t]],\r\n\t\t["rest",["buffer",["bytesleft"],"hex"]]\r\n\t]]],\r\n\t["npc",["opt",["$avatype",-1],["struct",\r\n\t\t["id","ushort"],\r\n\t\t["buf",["buffer",21,"hex"]],\r\n\t\t["unkff","ushort"]\r\n\t]]]\r\n]'
},3417:e=>{"use strict"
;e.exports='["struct",\r\n\t["format","unsigned byte"],\r\n\t["timestamp",["match",["ref","format"],{">=6":"uint","other":0}]],\r\n\t["flags","unsigned byte"],\r\n\t["$minorindex","0"],\r\n\t["indices",["chunkedarray",["match",["ref","format"],{">=7":"varuint","other":"ushort"}],\r\n\t\t[\r\n\t\t\t["minor",["accum","$minorindex","unsigned short"]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["name",["opt",["flags",0,"bitflag"],"unsigned int"]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["crc","unsigned int"]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["uncompressed_crc",["opt",["flags",2,"bitflag"],"unsigned int"]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["size",["opt",["flags",2,"bitflag"],"unsigned int"]],\r\n\t\t\t["uncompressed_size",["opt",["flags",2,"bitflag"],"unsigned int"]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["encryption_or_hash",["opt",["flags",1,"bitflag"],["buffer",64,"hex"]]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["version","unsigned int"]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["subindexcount","variable unsigned int"]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["$subindex","0"],\r\n\t\t\t["subindices",["array",["ref","subindexcount"],["accum","$subindex","unsigned short"]]]\r\n\t\t],\r\n\t\t[\r\n\t\t\t["subnames",["opt",["flags",0,"bitflag"],["array",["ref","subindexcount"],"uint"]]]\r\n\t\t]\r\n\t]]\r\n]'
},5602:e=>{"use strict"
;e.exports='["struct",\r\n    ["vertexcount","ushort"],\r\n    ["facecount","ushort"],\r\n    ["xpos",["array",["ref","vertexcount"],"short"]],\r\n    ["ypos",["array",["ref","vertexcount"],"short"]],\r\n    ["zpos",["array",["ref","vertexcount"],"short"]],\r\n    ["faces",["chunkedarray",["ref","facecount"],[\r\n        ["$nverts","ubyte"]\r\n    ],[\r\n        ["color","ushort"]\r\n    ],[\r\n        ["backcolor","ushort"]\r\n    ],[\r\n        ["intensity","ubyte"]\r\n    ],[\r\n        ["verts",["array",["ref","$nverts"],["match",["ref","vertexcount"],{\r\n            "<256":"ubyte",\r\n            "other":"ushort"\r\n        }]]]\r\n    ]]]\r\n]'
},1910:e=>{"use strict"
;e.exports='["struct",\r\n\t// ["byte0",["match","buildnr",{">458":"ubyte","other":0}]],\r\n\t["byte0","ubyte"],\r\n\t// ["switchsize",["match","buildnr",{">=495":["footer",2,"ushort"],"other":0}]],\r\n\t["switchsize",["footer",2,"ushort"]],\r\n\t["switches",["footer",["ref","switchsize"],\r\n\t\t// ["array",["match","buildnr",{">=495":"ubyte","other":0}],["array","ushort",["struct",\r\n\t\t["array","ubyte",["array","ushort",["struct",\r\n\t\t\t["value","int"],\r\n\t\t\t["jump","uint"]\r\n\t\t]]]\r\n\t]],\r\n\t// ["longargcount",["match","buildnr",{">641":["footer",2,"ushort"],"other":0}]],\r\n\t["longargcount",["footer",2,"ushort"]],\r\n\t["stringargcount",["footer",2,"ushort"]],\r\n\t["intargcount",["footer",2,"ushort"]],\r\n\t// ["locallongcount",["match","buildnr",{">641":["footer",2,"ushort"],"other":0}]],\r\n\t["locallongcount",["footer",2,"ushort"]],\r\n\t["localstringcount",["footer",2,"ushort"]],\r\n\t["localintcount",["footer",2,"ushort"]],\r\n\t["instructioncount",["footer",4,"uint"]],\r\n\t["opcodedata",["array",["ref","instructioncount"],["scriptopt"]]]\r\n]'
},366:e=>{"use strict"
;e.exports='["struct",\r\n\t["byte0",["match","buildnr",{">458":"ubyte","other":0}]],\r\n\t["switchsize",["match","buildnr",{">=495":["footer",2,"ushort"],"other":0}]],\r\n\t["switches",["footer",["ref","switchsize"],\r\n\t\t["array",["match","buildnr",{">=495":"ubyte","other":0}],["array","ushort",["struct",\r\n\t\t\t["value","int"],\r\n\t\t\t["jump","uint"]\r\n\t\t]]]\r\n\t]],\r\n\t["longargcount",["match","buildnr",{">641":["footer",2,"ushort"],"other":0}]],\r\n\t["stringargcount",["footer",2,"ushort"]],\r\n\t["intargcount",["footer",2,"ushort"]],\r\n\t["locallongcount",["match","buildnr",{">641":["footer",2,"ushort"],"other":0}]],\r\n\t["localstringcount",["footer",2,"ushort"]],\r\n\t["localintcount",["footer",2,"ushort"]],\r\n\t["instructioncount",["footer",4,"uint"]],\r\n\t["opcodedata",["buffer",["bytesleft"],"buffer"]]\r\n]'
},7135:e=>{"use strict"
;e.exports='["struct",\r\n\t["version","ubyte"],\r\n\t["width","ushort"],\r\n\t["height","ushort"],\r\n\t["unkhead","ushort"],\r\n\t["elements",["array","ubyte",["struct",\r\n\t\t["name","paddedstring"],\r\n\t\t["start","float"],\r\n\t\t["end","float"],\r\n\t\t["flag0","ubyte"],\r\n\t\t["graphics",["array",["ref","flag0"],["struct",\r\n\t\t\t["spritename","paddedstring"],\r\n\t\t\t["height","ushort"],\r\n\t\t\t["width","ushort"],\r\n\t\t\t["unk","ushort"],\r\n\t\t\t["spriteid","ushort"],\r\n\t\t\t["opacityframes",["array","ubyte",["tuple","float","float"]]],\r\n\t\t\t["rotateframes",["array","ubyte",["tuple","float","float"]]],\r\n\t\t\t["translateframes",["array","ubyte",["tuple","float","float","float"]]],\r\n\t\t\t["scaleframes",["array","ubyte",["tuple","float","float","float"]]]\r\n\t\t]]],\r\n\t\t["flag1","ubyte"],\r\n\t\t["sound",["opt","flag1!=0","paddedstring"]],\r\n\t\t["flag2","ubyte"],\r\n\t\t["subtitle",["opt","flag2!=0","paddedstring"]],\r\n\t\t["unkbyte",["opt","flag0==0","ubyte"]],\r\n\t\t["soundid",["opt","flag0==0","ushort"]],\r\n\t\t["extraflags",["match",["ref","flag0"],{"0":"ubyte","other":0}]],\r\n\t\t["extra_01",["opt","extraflags!=0",["struct",["start","float"],["end","float"]]]]\r\n\t]]],\r\n\t["paddingbytes",["buffer",["bytesleft"],"ubyte"]]\r\n]'
},8795:e=>{"use strict"
;e.exports='{\r\n    "0x03":{"name":"unk01","read":["struct",\r\n        ["cols","ubyte"],\r\n        ["columndata",["nullarray","ubyte",255,["struct",\r\n            ["id",["ref","$opcode",[0,6]]],\r\n            ["flags",["ref","$opcode",[6,2]]],\r\n            ["$rowcount",-1],\r\n            ["columns",["chunkedarray","ubyte",[\r\n                ["type","varushort"]\r\n            ],[\r\n                ["$initrowcount",["match",["ref","$rowcount"],{\r\n                    "-1":["accum","$rowcount","ubyte","hold"],\r\n                    "other":["ref","$rowcount"]\r\n                }]],\r\n                //this is currently wrong, the values are interweaved in the other direction\r\n                ["value",["array",["ref","$rowcount"],["match",["ref","type"],{\r\n                    "0x24":"string",\r\n                    "other":"int"\r\n                }]]]\r\n            ]]]\r\n        ]]]\r\n    ]},\r\n    "0x04":{"name":"table","read":"varushort"}\r\n}'
},1695:e=>{"use strict"
;e.exports='{\r\n    "0x01":{"name":"unk01","read":["struct",\r\n        ["cols","ubyte"],\r\n        ["columndata",["nullarray","ubyte",255,["struct",\r\n            ["id",["ref","$opcode",[0,6]]],\r\n            ["flags",["ref","$opcode",[6,2]]],\r\n            ["$i",0],\r\n            ["columns",["chunkedarray","ubyte",[\r\n                ["type","varushort"]\r\n            ],[\r\n                ["$colindex",["accum","$i",1]],\r\n                ["unk",["opt","$opcode&0x80 && $colindex==1","ubyte"]],//this is dumb, there is currently no way to read a byte between chunkedarray chunks\r\n                ["default",["opt","$opcode&0x80",["match",["ref","type"],{\r\n                    "0x24":"string",\r\n                    "other":"int"\r\n                }]]]\r\n            ]]]\r\n        ]]]\r\n    ]},\r\n    "0x02":{"name":"unk02","read":["struct",\r\n        ["unkint","uint"],\r\n        ["cols","ubyte"],\r\n        ["columndata",["nullarray","ubyte",255,["struct",\r\n            ["id",["ref","$opcode",[0,6]]],\r\n            ["flags",["ref","$opcode",[6,2]]],\r\n            ["$i",0],\r\n            ["$default",0],\r\n            ["unkbyte","ubyte"],\r\n            ["columns",["chunkedarray","ubyte",[\r\n                ["type","varushort"],\r\n                ["$colindex",["accum","$i",1]]\r\n            ],[\r\n                ["hasdefault",["accum","$default",["match",{"$colindex==1":"ubyte","other":0}]]]\r\n            ],[\r\n                ["unk1",["opt","hasdefault&0x02 && $colindex==1","ubyte"]],//this is dumb, there is currently no way to read a byte between chunkedarray chunks\r\n                ["defaultint",["opt","hasdefault&0x02 && type!=0x24","int"]],\r\n                ["defaultstring",["opt","hasdefault&0x02 && type==0x24","string"]],\r\n                ["unk2",["opt","hasdefault&0x02 && $colindex==1","ubyte"]]\r\n            ]]]\r\n        ]]]\r\n    ]}\r\n}\r\n\r\n// alternative if the first byte were a version (it isn\'t because an empty dbtable starts with the 0x00 footer byte)\r\n// ["struct",\r\n//     ["version","ubyte"],\r\n//     ["unkint",["opt","version>=2","uint"]],\r\n//     ["cols","ubyte"],\r\n//     ["columndata",["nullarray","ubyte",255,["struct",\r\n//         ["id",["ref","$opcode",[0,6]]],\r\n//         ["flags",["ref","$opcode",[6,2]]],\r\n//         ["$i",0],\r\n//         ["$default",0],\r\n//         ["unkbyte",["opt","version>=2","ubyte"]],\r\n//         ["columns",["chunkedarray","ubyte",[\r\n//             ["type","varushort"],\r\n//             ["$colindex",["accum","$i",1]]\r\n//         ],[\r\n//             ["flagsbyte",["accum","$default",["match",{"$colindex==1 && version>=2":"ubyte","other":0}]]]\r\n//         ],[\r\n//             ["hasdefault",["match",{"version>=2 && flagsbyte&0x2":1,"version<=1 && id&0x80":1,"other":0}]],\r\n//             ["unk1",["opt","hasdefault==1 && $colindex==1","ubyte"]],//this is dumb, there is currently no way to read a byte between chunkedarray chunks\r\n//             ["defaultint",["opt","hasdefault==1 && type!=0x24","int"]],\r\n//             ["defaultstring",["opt","hasdefault==1 && type==0x24","string"]],\r\n//             ["unk2",["opt","hasdefault==1 && $colindex==1","ubyte"]]\r\n//         ]]]\r\n//     ]]]\r\n// ]'
},2835:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                           "key_type1", "read": "unsigned byte" },\r\n\t"0x02": { "name":                         "value_type1", "read": "unsigned byte" },\r\n\t"0x65": { "name":                           "key_type2", "read": "unsigned byte" },\r\n\t"0x66": { "name":                         "value_type2", "read": "unsigned byte" },\r\n\t"0x03": { "name":                         "stringValue", "read": "string" },\r\n\t"0x04": { "name":                            "intValue", "read": "int" },\r\n\t"0x05": { "name":                   "stringArrayValue1", "read": ["array","unsigned short",["tuple","int","string"]] },\r\n\t"0x06": { "name":                      "intArrayValue1", "read": ["array","unsigned short",["tuple","int","int"]] },\r\n\t"0x07": { "name":                   "stringArrayValue2", "read": ["struct",["max","unsigned short"],["values",["array","unsigned short",["tuple","unsigned short","string"]]]] },\r\n\t"0x08": { "name":                      "intArrayValue2", "read": ["struct",["max","unsigned short"],["values",["array","unsigned short",["tuple","unsigned short","int"]]]] },\r\n\t"0x83": { "name":                          "unknown_83", "read": "true" },\r\n\t"0xd1": { "name":                          "unknown_d1", "read": "true" }\r\n}'
},2536:e=>{"use strict";e.exports='{\r\n\t"0x01": { "name": "unk01", "read":"ushort" },\r\n\t"0x04": { "name": "unk04", "read":"bool" },\r\n\t"0x05": { "name": "model", "read":"varuint" },\r\n\t"0x06": { "name": "unk06", "read":"ushort" }\r\n}'},
9774:e=>{"use strict"
;e.exports='["struct",\r\n\t["data",["chunkedarray","ushort",\r\n\t\t[["type","ubyte"]],\r\n\t\t[["unknown","bool"]],\r\n\t\t[["unknown_always_FFFF","ushort"]],\r\n\t\t[["length","varushort"]],\r\n\t\t[["data",["array",["ref","length"],"varushort"]]]\r\n\t]],\r\n\t["skeleton",["chunkedarray","ushort",\r\n\t\t[\r\n\t\t\t["parentbone","ubyte"],//TODO this is wrong, this byte is part of dataq from the previous bone\r\n\t\t\t["nonskinboneid","ushort"],\r\n\t\t\t["bonematrix",["array",16,"float"]],\r\n\t\t\t//unknown, always the same for all bones in a skeleton\r\n\t\t\t["dataq",["buffer",11,"hex"]]\r\n\t\t]\r\n\t]],\r\n\t\r\n\t//exact use unknown\r\n\t//contains more entries that the skeleton list\r\n\t//seems to be a list of "short le"\r\n\t//highest possible rounded up to 16 for first bone, always counts down to 2 on bones after that\r\n\t//but also some times starts at 0 or a different number and not always unique\r\n\t["activebones",["buffer",["bytesleft"],"hex"]]\r\n]'
},1901:e=>{"use strict";e.exports='["struct",\r\n\t["header_always_2","ubyte"],\r\n\t["probably_framemap_id","ushort"],\r\n\t["flags",["array","ushort","ubyte"]],\r\n\t["animdata",["buffer",["bytesleft"],"ubyte"]]\r\n]'},2230:e=>{"use strict"
;e.exports='{\r\n\t//male   0head,1jaw/beard,2body,3arms,4hands,5legs,6feet,\r\n\t//female 7head,9body,10arms,11hands,12legs,13feet,\r\n\t//also a couple of values in 70-74 range for some reason, bugged?\r\n\t"0x01": { "name":  "bodypart", "read": "ubyte" },\r\n\t"0x02": { "name":    "models", "read": ["array","ubyte","varuint"]},\r\n\t"0x03": { "name":    "iscopy", "read": "true" },\r\n\t"0x28": { "name":   "recolor", "read": ["array","ubyte",["tuple","ushort","ushort"]] },\r\n\t"0x3c": { "name": "headmodel", "read": "varuint" }\r\n}'
},4810:e=>{"use strict"
;e.exports='//works from 500 to 932, system is entirely different below 500\r\n["struct",\r\n    ["version",["match","buildnr",{">500":"byte","other":-1}]],//-1,3,4,5,6,9\r\n    ["type","ubyte"],\r\n    ["name",["opt","type&0x80","string"]],\r\n    ["contenttype","ushort"],\r\n    ["baseposx","short"],\r\n    ["baseposy","short"],\r\n    ["basewidth","short"],\r\n    ["baseheight","short"],\r\n    ["aspectwidthtype","byte"],\r\n    ["aspectheighttype","byte"],\r\n    ["aspectxtype","byte"],\r\n    ["aspectytype","byte"],\r\n    ["parentid","ushort"],\r\n    ["hidden","ubyte"],\r\n    ["containerdata",["opt","type=0",["struct",\r\n        ["layerwidth","ushort"],\r\n        ["layerheight","ushort"],\r\n        ["layerheightextra",["opt","layerheight&0x8000","uint"]],//????\r\n        ["disablehover",["opt","version==-1","bool"]],\r\n        ["v6unk1",["opt","version>=6","uint"]],\r\n        ["v6unk2",["opt","version==6","uint"]]\r\n    ]]],\r\n    ["figuredata",["opt","type=3",["struct",\r\n        ["color","uint"],\r\n        ["filled","ubyte"],//more to this, weird\r\n        ["trans","byte"]\r\n    ]]],\r\n    ["textdata",["opt","type=4",["struct",\r\n        ["fontid","varuint"],\r\n        ["unk1",["match",{"version>=0":"ubyte","other":false}]],\r\n        ["text","string"],\r\n        ["unk2","ubyte"],\r\n        ["alignhor","ubyte"],\r\n        ["alignver","ubyte"],\r\n        ["shadow","bool"],\r\n        ["color","uint"],\r\n        ["trans","ubyte"],\r\n        ["multiline",["opt","version>=0","ubyte"]]\r\n    ]]],\r\n    ["spritedata",["opt","type=5",["struct",\r\n        ["spriteid","int"],\r\n        ["rotation","ushort"],\r\n        ["tiling","ubyte"],\r\n        ["aspectwidthdata",["match",{"aspectwidthtype==4":"uint","other":-1}]],\r\n        ["aspectheightdata",["match",{"aspectheighttype==4":"uint","other":-1}]],\r\n        ["transparency","ubyte"],\r\n        ["borderthickness","ubyte"],\r\n        ["unk2","int"],\r\n        ["vflip","bool"],\r\n        ["hflip","bool"],\r\n        ["color","uint"],\r\n        ["clickmask",["opt","version>=0","ubyte"]],\r\n        ["v6unk",["opt","version>=6","uint"]]\r\n    ]]],\r\n    ["modeldata",["opt","type=6",["struct",\r\n        ["modelid",["match","buildnr",{">616":"varuint","other":"ushort"}]],\r\n        ["mode",["match","buildnr",{">616":"ubyte","other":1}]],\r\n        ["positiondata",["opt","mode!=0",["struct",\r\n            ["translate_x","short"],\r\n            ["translate_y","short"],\r\n            ["unkextra",["opt","mode=2","short"]],\r\n            ["rotate_x","ushort"],\r\n            ["rotate_y","ushort"],\r\n            ["rotate_z","ushort"],\r\n            ["zoom","ushort"]//can be signed? if mode is 2\r\n        ]]],\r\n        ["animid",["match","buildnr",{">616":"varuint","other":"ushort"}]],\r\n        ["unkdata",["match","buildnr",{">616":null,"other":["buffer",6,"hex"]}]],\r\n        ["aspectwidthdata",["match",{"aspectwidthtype!=0":"ushort","other":-1}]],\r\n        ["aspectheightdata",["match",{"aspectheighttype!=0":"ushort","other":-1}]]\r\n    ]]],\r\n    ["linedata",["opt","type=9",["struct",\r\n        ["width","ubyte"],\r\n        ["color","uint"],\r\n        ["dir","bool"]\r\n    ]]],\r\n    ["unk10data",["opt","type=10",["struct",\r\n        ["data",["buffer",41,"hex"]],\r\n        ["str1","string"],\r\n        ["data2",["buffer",10,"hex"]]\r\n    ]]],\r\n    ["unk11data",["opt","type=11",["struct",\r\n        ["data",["buffer",6,"hex"]]\r\n    ]]],\r\n    ["unk12data",["opt","type=12",["struct",\r\n        ["data",["buffer",36,"hex"]],\r\n        ["str","string"],\r\n        ["data2",["buffer",10,"hex"]]\r\n    ]]],\r\n    ["unk13data",["opt","type=13",["struct",\r\n        ["data",["buffer",125,"hex"]]\r\n    ]]],\r\n    ["unk15data",["opt","type=15",["struct",\r\n        ["data",["buffer",10,"hex"]]\r\n    ]]],\r\n    ["unk16data",["opt","type=16",["struct",\r\n        ["data",["buffer",179,"hex"]]//or 188 or 238, no clue how this works\r\n    ]]],\r\n    ["unkffff",["opt","version>=6","uint"]],\r\n\r\n\r\n\r\n    ["optmask","ushort"],\r\n    ["unk2","ubyte"],\r\n    ["unkprepre3",["opt","version>=7","ubyte"]],\r\n    ["unkpre3",["opt","version>=6","ubyte"]],//might be style class\r\n    ["unk3",["match",{\r\n        "version==-1":["nullarray","ubyte",["buffer",3,"hex"]],\r\n        "other":["struct",\r\n            ["op","ubyte"],\r\n            ["data",["opt","op!=0",["buffer",4,"hex"]]\r\n        ]]\r\n    }]],\r\n    ["name2","string"],\r\n    \r\n    ["menucounts","ubyte"],\r\n    ["rightclickopts",["array",["ref","menucounts",[0,4]],"string"]],\r\n    ["rightclickcursors",["array",["ref","menucounts",[4,4]],["struct",\r\n        ["op","ubyte"],\r\n        ["cursor","ushort"]\r\n    ]]],\r\n    ["unkstring1",["opt","optmask!&0x0400","string"]],\r\n    ["unk4","ubyte"],\r\n    ["bit4data",["opt","optmask&0x0400","ubyte"]],\r\n    ["unk5","ubyte"],\r\n    ["unk6","ubyte"],\r\n    ["unkstuff123","string"],\r\n    ["optmask1data_bit40",["opt","optmask&0x0240",["buffer",6,"hex"]]],\r\n    ["cursor",["match",{"version>=0":"ushort","other":-1}]],\r\n    ["unkdata",["opt","version>=0","ushort"]],\r\n    ["unkdatadata",["opt","version>=0 && unkdata!=0",["buffer",6,"hex"]]],\r\n\r\n    ["scripts",["struct",\r\n        ["load","uivalues"],\r\n        ["mousehover","uivalues"],\r\n        ["mouseleave","uivalues"],\r\n        ["unk0","uivalues"],\r\n        ["unk1","uivalues"],\r\n        ["unk2","uivalues"],\r\n        ["unk3","uivalues"],\r\n        ["unk4","uivalues"],\r\n        ["unk5","uivalues"],\r\n        ["unk6","uivalues"],//triggerop\r\n        ["unk7",["opt","version>=0","uivalues"]],\r\n        ["hovertext","uivalues"],\r\n        ["unk8","uivalues"],//mousedown\r\n        ["unk9","uivalues"],\r\n        ["unk10","uivalues"],//mouseup\r\n        ["unk11","uivalues"],\r\n        ["unk12","uivalues"],\r\n        ["unk13","uivalues"],\r\n        ["unk14","uivalues"],\r\n        ["unk15","uivalues"],\r\n        ["unk16","uivalues"],\r\n        ["unk17",["opt","version>=6","uivalues"]],\r\n        ["unk18",["opt","version>=6","uivalues"]],\r\n        ["unk19",["opt","version>=6","uivalues"]],\r\n        ["unk20",["opt","version>=7","uivalues"]],\r\n\r\n        ["v2unk0","uivaluesint"],//"config"\r\n        ["v2unk1","uivaluesint"],\r\n        ["v2unk2","uivaluesint"],\r\n        ["v2unk3","uivaluesint"],\r\n        ["v2unk4","uivaluesint"]\r\n    ]]\r\n]'
},3688:e=>{"use strict"
;e.exports='{\r\n\t"0x00": { "name":                             "nullopt", "read": "true" },\r\n\t"0x01": { "name":                           "baseModel", "read": "item_modelid" },\r\n\t"0x02": { "name":                                "name", "read": "string" },\r\n\t"0x03": { "name":                         "buff_effect", "read": "string" },\r\n\t"0x04": { "name":                          "model_zoom", "read": "unsigned short" },\r\n\t"0x05": { "name":                          "rotation_0", "read": "unsigned short" },\r\n\t"0x06": { "name":                          "rotation_1", "read": "unsigned short" },\r\n\t"0x07": { "name":                    "modelTranslate_0", "read": "short" },\r\n\t"0x08": { "name":                    "modelTranslate_1", "read": "short" },\r\n\t"0x0A": { "name":                          "unknown_0A", "read": "ushort" },\r\n\t"0x0B": { "name":                         "stackable_1", "read": "true" },\r\n\t"0x0C": { "name":                               "value", "read": "int" },\r\n\t"0x0D": { "name":                         "equipSlotId", "read": "unsigned byte" },\r\n\t"0x0E": { "name":                             "equipId", "read": "unsigned byte" },\r\n\t"0x0F": { "name":                          "unknown_0F", "read": "true" },\r\n\t"0x10": { "name":                             "members", "read": "true" },\r\n\t"0x12": { "name":                      "multiStackSize", "read": "unsigned short" },\r\n\t"0x17": { "name":                        "maleModels_0", "read": ["struct",["id","item_modelid"],["type",["match","buildnr",{">=502":0,"other":"ubyte"}]]] },\r\n\t"0x18": { "name":                        "maleModels_1", "read": "item_modelid" },\r\n\t"0x19": { "name":                      "femaleModels_0", "read": ["struct",["id","item_modelid"],["type",["match","buildnr",{">=502":0,"other":"ubyte"}]]] },\r\n\t"0x1A": { "name":                      "femaleModels_1", "read": "item_modelid" },\r\n\t"0x1B": { "name":                          "unknown_1B", "read": "unsigned byte" },\r\n\t"0x1E": { "name":                    "ground_actions_0", "read": "string" },\r\n\t"0x1F": { "name":                    "ground_actions_1", "read": "string" },\r\n\t"0x20": { "name":                    "ground_actions_2", "read": "string" },\r\n\t"0x21": { "name":                    "ground_actions_3", "read": "string" },\r\n\t"0x22": { "name":                    "ground_actions_4", "read": "string" },\r\n\t"0x23": { "name":                    "widget_actions_0", "read": "string" },\r\n\t"0x24": { "name":                    "widget_actions_1", "read": "string" },\r\n\t"0x25": { "name":                    "widget_actions_2", "read": "string" },\r\n\t"0x26": { "name":                    "widget_actions_3", "read": "string" },\r\n\t"0x27": { "name":                    "widget_actions_4", "read": "string" },\r\n\t"0x28": { "name":                  "color_replacements", "read": [ "array", [ "tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x29": { "name":               "material_replacements", "read": [ "array", [ "tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x2A": { "name":                     "recolourPalette", "read": [ "array", [ "tuple", "unsigned byte", "byte"] ] },\r\n\t"0x2B": { "name":                           "nameColor", "read": "int" },\r\n\t"0x2C": { "name":                   "recolorDstIndices", "read": "unsigned short" },\r\n\t"0x2D": { "name":                 "retextureDstIndices", "read": "unsigned short" },\r\n\t"0x41": { "name":                           "tradeable", "read": "true" },\r\n\t"0x45": { "name":                           "buy_limit", "read": "int" },\r\n\t"0x4E": { "name":                        "maleModels_2", "read": "item_modelid" },\r\n\t"0x4F": { "name":                      "femaleModels_2", "read": "item_modelid" },\r\n\t"0x5A": { "name":                         "maleHeads_0", "read": "item_modelid" },\r\n\t"0x5B": { "name":                       "femaleHeads_0", "read": "item_modelid" },\r\n\t"0x5C": { "name":                         "maleHeads_1", "read": "item_modelid" },\r\n\t"0x5D": { "name":                       "femaleHeads_1", "read": "item_modelid" },\r\n\t"0x5E": { "name":                            "category", "read": "unsigned short" },\r\n\t"0x5F": { "name":                          "rotation_2", "read": "unsigned short" },\r\n\t"0x60": { "name":                           "dummyItem", "read": "unsigned byte" },\r\n\t"0x61": { "name":                            "noteData", "read": "unsigned short" },\r\n\t"0x62": { "name":                        "noteTemplate", "read": "unsigned short" },\r\n\t"0x64": { "name":                        "stack_info_0", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x65": { "name":                        "stack_info_1", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x66": { "name":                        "stack_info_2", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x67": { "name":                        "stack_info_3", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x68": { "name":                        "stack_info_4", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x69": { "name":                        "stack_info_5", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x6A": { "name":                        "stack_info_6", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x6B": { "name":                        "stack_info_7", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x6C": { "name":                        "stack_info_8", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x6D": { "name":                        "stack_info_9", "read": [ "tuple", "unsigned short", "unsigned short" ] },\r\n\t"0x6E": { "name":                             "scale_0", "read": "unsigned short" },\r\n\t"0x6F": { "name":                             "scale_1", "read": "unsigned short" },\r\n\t"0x70": { "name":                             "scale_2", "read": "unsigned short" },\r\n\t"0x71": { "name":                            "ambiance", "read": "byte" },\r\n\t"0x72": { "name":                            "contrast", "read": "byte" },\r\n\t"0x73": { "name":                                "team", "read": "unsigned byte" },\r\n\t"0x79": { "name":                              "loanId", "read": "unsigned short" },\r\n\t"0x7A": { "name":                        "loanTemplate", "read": "unsigned short" },\r\n\t"0x7D": { "name":                      "male_translate", "read": [ "tuple", "unsigned byte", "unsigned byte", "unsigned byte" ] },\r\n\t"0x7E": { "name":                    "female_translate", "read": [ "tuple", "unsigned byte", "unsigned byte", "unsigned byte" ] },\r\n\t"0x7F": { "name":                          "unknown_7F", "read": [ "tuple", "unsigned byte", "unsigned short" ] },\r\n\t"0x80": { "name":                          "unknown_80", "read": [ "tuple", "unsigned byte", "unsigned short" ] },\r\n\t"0x81": { "name":                          "unknown_81", "read": [ "tuple", "unsigned byte", "unsigned short" ] },\r\n\t"0x82": { "name":                          "unknown_82", "read": [ "tuple", "unsigned byte", "unsigned short" ] },\r\n\t"0x84": { "name":                              "quests", "read": [ "array", [ "tuple","unsigned byte", "unsigned short"] ] },\r\n\t"0x86": { "name":                       "pickSizeShift", "read": "unsigned byte" },\r\n\t"0x8B": { "name":                            "bindLink", "read": "unsigned short" },\r\n\t"0x8C": { "name":                        "bindTemplate", "read": "unsigned short" },\r\n\t"0x8E": { "name":             "ground_actions_cursor_0", "read": "unsigned short" },\r\n\t"0x8F": { "name":             "ground_actions_cursor_1", "read": "unsigned short" },\r\n\t"0x90": { "name":             "ground_actions_cursor_2", "read": "unsigned short" },\r\n\t"0x91": { "name":             "ground_actions_cursor_3", "read": "unsigned short" },\r\n\t"0x92": { "name":             "ground_actions_cursor_4", "read": "unsigned short" },\r\n\t"0x96": { "name":             "widget_actions_cursor_0", "read": "unsigned short" },\r\n\t"0x97": { "name":             "widget_actions_cursor_1", "read": "unsigned short" },\r\n\t"0x98": { "name":             "widget_actions_cursor_2", "read": "unsigned short" },\r\n\t"0x99": { "name":             "widget_actions_cursor_3", "read": "unsigned short" },\r\n\t"0x9A": { "name":             "widget_actions_cursor_4", "read": "unsigned short" },\r\n\t"0x9C": { "name":                               "dummy", "read": "true" },\r\n\t"0x9D": { "name":                  "randomizeGroundPos", "read": "true" },\r\n\t"0xA1": { "name":                        "combine_info", "read": "unsigned short" },\r\n\t"0xA2": { "name":                    "combine_template", "read": "unsigned short" },\r\n\t"0xA3": { "name":                "combine_num_required", "read": "unsigned short" },\r\n\t"0xA4": { "name":                  "combine_shard_name", "read": "string" },\r\n\t"0xA5": { "name":                      "neverStackable", "read": "true" },\r\n\t"0xA7": { "name":                          "unknown_A7", "read": "true" },\r\n\t"0xA8": { "name":                          "unknown_A8", "read": "true" },\r\n\t"0xB2": { "name":                          "unknown_B2", "read": "true" },//seems to always be set when config has a "big_Value"\r\n\t"0xB5": { "name":                           "big_value", "read": ["tuple","int","int"] },//to be comfirmed if this is int64, or int32*1e9+int32 like the coin pouch is\r\n\t"0xF9": { "name":                               "extra", "read": "extrasmap" }\r\n}'
},4827:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                              "sprite", "read": "varuint" },\r\n\t"0x02": { "name":                        "sprite_hover", "read": "varuint" },\r\n\t"0x03": { "name":                                "text", "read": "string" },\r\n\t"0x04": { "name":                             "color_1", "read": ["tuple","ubyte","ubyte","ubyte"] },\r\n\t"0x05": { "name":                             "color_2", "read": ["tuple","ubyte","ubyte","ubyte"] },\r\n\t"0x06": { "name":                           "font_size", "read": "ubyte" },\r\n\t"0x07": { "name":                          "unknown_07", "read": "ubyte" },\r\n\t"0x08": { "name":                          "unknown_08", "read": "ubyte" },\r\n\t"0x09": { "name":                            "toggle_1", "read": ["struct",\r\n                                                                        ["varbit","ushort"],\r\n                                                                        ["varp","ushort"],\r\n                                                                        ["lower","uint"],\r\n                                                                        ["upper","uint"]\r\n                                                                    ] },\r\n    "0x0a": { "name":                        "rightclick_1", "read": "string" },\r\n    "0x0b": { "name":                          "unktext_0b", "read": "string" },\r\n\t"0x0f": { "name":                             "polygon", "read": ["struct",\r\n                                                                        ["pointcount","ubyte"],\r\n                                                                        ["points",["array",["ref","pointcount"],["struct",\r\n                                                                            ["x","short"],\r\n                                                                            ["y","short"]\r\n                                                                        ]]],\r\n                                                                        ["color",["tuple","ubyte","ubyte","ubyte","ubyte"]],\r\n                                                                        ["always_1",["match","buildnr",{">=623":"ubyte","other":1}]],\r\n                                                                        //back color and color are also flipped before 623\r\n                                                                        ["back_color",["tuple","ubyte","ubyte","ubyte","ubyte"]],\r\n                                                                        ["pointplanes",["match","buildnr",{\r\n                                                                            ">=629":["array",["ref","pointcount"],"ubyte"],\r\n                                                                            "other":null\r\n                                                                        }]]\r\n                                                                    ] },\r\n\t"0x11": { "name":                        "rightclick_2", "read": "string" },\r\n\t"0x13": { "name":                            "category", "read": "ushort" },\r\n\t"0x14": { "name":                            "toggle_2", "read": ["struct",\r\n                                                                        ["varbit","ushort"],\r\n                                                                        ["varp","ushort"],\r\n                                                                        ["lower","uint"],\r\n                                                                        ["upper","uint"]\r\n                                                                    ] },\r\n\t"0x15": { "name":                          "unknown_15", "read": "int" },\r\n\t"0x16": { "name":                          "unknown_16", "read": "int" },\r\n\t"0x19": { "name":                   "background_sprite", "read": "varuint" },\r\n\t"0x1a": { "name":                       "legacy_switch", "read": ["struct",\r\n                                                                        ["varbit","ushort"],\r\n                                                                        ["varp","ushort"],\r\n                                                                        ["value","ubyte"],\r\n                                                                        ["default_ref","ushort"],\r\n                                                                        ["legacy_ref","ushort"]\r\n                                                                    ] },\r\n\t"0x1c": { "name":                          "unknown_1c", "read": "ubyte" },\r\n\t"0x1e": { "name":                          "unknown_1e", "read": "ubyte" },\r\n\t"0xF9": { "name":                               "extra", "read": "extrasmap" }\r\n}'
},1194:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                           "sprite_id", "read": "variable unsigned int" },\r\n\t"0x02": { "name":                           "unknown_2", "read": "unsigned int" },\r\n\t"0x03": { "name":                           "unknown_3", "read": "true" },\r\n\t"0x04": { "name":                           "unknown_4", "read": "true" },\r\n\t"0x05": { "name":                           "unknown_5", "read": "true" }\r\n}'
},6508:e=>{"use strict";e.exports='["struct",\r\n    //TODO\r\n    ["unk","ubyte"]\r\n]'},8707:e=>{"use strict"
;e.exports='["struct",\r\n\t["$idcounter","-1"],\r\n\t["locations",["nullarray","tailed unsigned short",["struct",\r\n\t\t["id",["accum","$idcounter",["ref","$opcode"]]],\r\n\t\t["$location","0"],\r\n\t\t["uses",["nullarray","variable unsigned short",["struct",\r\n\t\t\t["$loc",["accum","$location",["ref","$opcode"],"add-1"]],\r\n\t\t\t["y",["ref","$loc",[0,6]]],\r\n\t\t\t["x",["ref","$loc",[6,6]]],\r\n\t\t\t["plane",["ref","$loc",[12,2]]],\r\n\t\t\t["$data","unsigned byte"],\r\n\t\t\t["rotation",["ref","$data",[0,2]]],\r\n\t\t\t["type",["ref","$data",[2,5]]],\r\n\t\t\t["extra",["opt",["$data",7,"bitflag"],["struct",\r\n\t\t\t\t["flags","unsigned byte"],\r\n\t\t\t\t["rotation",["opt",["flags",0,"bitflag"],["array",4,"short"]]],\r\n\t\t\t\t["translateX",["opt",["flags",1,"bitflag"],"short"]],\r\n\t\t\t\t["translateY",["opt",["flags",2,"bitflag"],"short"]],\r\n\t\t\t\t["translateZ",["opt",["flags",3,"bitflag"],"short"]],\r\n\t\t\t\t["scale",["opt",["flags",4,"bitflag"],"unsigned short"]],\r\n\t\t\t\t["scaleX",["opt",["flags",5,"bitflag"],"unsigned short"]],\r\n\t\t\t\t["scaleY",["opt",["flags",6,"bitflag"],"unsigned short"]],\r\n\t\t\t\t["scaleZ",["opt",["flags",7,"bitflag"],"unsigned short"]]\r\n\t\t\t]]]\r\n\t\t]]]\r\n\t]]]\r\n]'
},5903:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                               "color", "read": ["array",3,"unsigned byte"] },\r\n\t"0x02": { "name":                        "materialbyte", "read": "unsigned byte" },//last used in ~2008\r\n\t"0x03": { "name":                            "material", "read": ["match","buildnr",{">377":"unsigned short","other":0}] },\r\n\t"0x05": { "name":                        "unknown_0x05", "read": "true" },\r\n\t"0x06": { "name":                                "name", "read": "string" },//not used after 2006\r\n\t"0x07": { "name":                    "secondary_colour", "read": ["array",3,"unsigned byte"] },\r\n\t"0x08": { "name":                        "unknown_0x08", "read": "true" },\r\n\t"0x09": { "name":                     "material_tiling", "read": "unsigned short" },\r\n\t"0x0A": { "name":                        "unknown_0x0A", "read": "true" },\r\n\t"0x0B": { "name":                       "bleedpriority", "read": "unsigned byte" },//higher number means that it flows into neighbouring overlays with lower number\r\n\t"0x0C": { "name":                     "bleedToUnderlay", "read": "true" },\r\n\t"0x0D": { "name":                     "tertiary_colour", "read": ["array",3,"unsigned byte"] },\r\n\t"0x0E": { "name":                        "unknown_0x0E", "read": "unsigned byte" },\r\n\t"0x0F": { "name":                        "unknown_0x0F", "read": "unsigned short" },//last used in ~2010\r\n\t"0x10": { "name":                        "unknown_0x10", "read": "unsigned byte" }\r\n}'
},7689:e=>{"use strict"
;e.exports='["struct",\r\n\t["magic",["match","buildnr",{">=936":["tuple","uint","ubyte"],"other":null}]],//always "jagx\\01"\r\n\t["tiles",["array",16384,\r\n\t\t["match","buildnr",{\r\n\t\t\t">=750":["struct",\r\n\t\t\t\t["flags","unsigned byte"],\r\n\t\t\t\t["shape",["opt",["flags",0,"bitflag"],"unsigned byte"]],\r\n\t\t\t\t["overlay",["opt",["flags",0,"bitflag"],"variable unsigned short"]],\r\n\t\t\t\t["settings",["opt",["flags",1,"bitflag"],"unsigned byte"]],\r\n\t\t\t\t["underlay",["opt",["flags",2,"bitflag"],"variable unsigned short"]],\r\n\t\t\t\t["height",["opt",["flags",3,"bitflag"],["match","buildnr",{">=936":"ushort","other":"ubyte"}]]]\r\n\t\t\t],\r\n\t\t\t"other":["legacy_maptile"]\r\n\t\t}]\r\n\t]],\r\n\t["olddata",["match","buildnr",{">=498":null,"other":["buffer",["bytesleft"],"hex"]}]],\r\n\t//1 bit per 8x8 subarea, starting southwest, going north and wrapping east\r\n\t["nonmembarea",["match","buildnr",{">=765":["buffer",8,"hex"],"other":null}]],\r\n\t["extra",{\r\n\t\t"0x00": { "name": "unk00", "read":["struct",\r\n\t\t\t["flags","ubyte"],\r\n\t\t\t["unk01",["opt",["flags",0,"bitflag"],["array",4,"ubyte"]]],//probably sun intensity+color\r\n\t\t\t["unk02",["opt",["flags",1,"bitflag"],"ushort"]],\r\n\t\t\t["unk04",["opt",["flags",2,"bitflag"],"ushort"]],\r\n\t\t\t["unk08",["opt",["flags",3,"bitflag"],"ushort"]],\r\n\t\t\t["unk10",["opt",["flags",4,"bitflag"],["tuple","ushort","ushort","ushort"]]],\r\n\t\t\t["unk20",["opt",["flags",5,"bitflag"],["array",4,"ubyte"]]],\r\n\t\t\t["unk40",["opt",["flags",6,"bitflag"],"ushort"]],\r\n\t\t\t["unk80",["opt",["flags",7,"bitflag"],["match","buildnr",{">=759":"ushort","other":["array",6,"ushort"]}]]]\r\n\t\t]},\r\n\t\t"0x01": { "name": "unk01", "read":["array","ubyte",["struct",\r\n\t\t\t["byte2","ubyte"],\r\n\t\t\t["short0","ushort"],\r\n\t\t\t["short1","ushort"],\r\n\t\t\t["short2","ushort"],\r\n\t\t\t["array5",["array","ubyte",["array",4,"ubyte"]]],\r\n\t\t\t["short3","ushort"],\r\n\t\t\t["short4","ushort"],\r\n\t\t\t["extraflags","ubyte"],\r\n\t\t\t["extra08",["match","buildnr",{">=804":"ushort","other":0}]],//always ffff?\r\n\t\t\t["extra1f",["opt",["extraflags",31,"bitand"],"ushort"]]\r\n\t\t]]},\r\n\t\t"0x02": { "name": "unk02", "read":["array",3,["match","buildnr",{">=780":"float","other":"byte"}]]},\r\n\t\t"0x03": { "name": "unk03", "read":["tuple","short","float"]},\r\n\t\t"0x80": { "name": "unk80", "read":["struct",\r\n\t\t\t["environment","ushort"],\r\n\t\t\t["always00",["buffer",8,"hex"]]\r\n\t\t]},\r\n\t\t"0x81": { "name": "unk81", "read":["array",4,["struct",\r\n\t\t\t["flag","ubyte"],\r\n\t\t\t["data",["opt",["flag",0,"bitflag"],["buffer",256,"hex"]]]\r\n\t\t]]},\r\n\t\t"0x82": { "name": "unk82", "read":"true" }//changable skybox/lighting?\r\n\t}]\r\n]'
},6222:e=>{"use strict"
;e.exports='{\r\n"0x6a":{"name":"magic","read":"uint"},//"jagx\\01" as header for buildnr>=936\r\n"0x00":{"name":"level0","read":["array",4356,["struct",\r\n\t["flags","ubyte"],//1visible,2blocking,4bridge/flag2,8roofed,16water,32forcedraw,64roofoverhang\r\n\t["height",["match","buildnr",{">=936":"ushort","other":"ubyte"}]],\r\n\t["rest",["opt",["flags",0,"bitflag"],["struct",\r\n\t\t["waterheight",["opt","flags&16",["match","buildnr",{">=936":"ushort","other":"ubyte"}]]],\r\n\t\t["underlay","varushort"],\r\n\t\t["underlaycolor",["opt","underlay!=0","ushort"]],\r\n\t\t["overlay","varushort"],\r\n\t\t["overlay_under",["opt","flags&16","varushort"]],\r\n\t\t["shape",["opt","overlay!=0","ubyte"]],\r\n\t\t["underlay_under",["opt","overlay!=0 && flags&16","varushort"]]\r\n\t]]]\r\n]]},\r\n"0x01":{"name":"level1","read":["array",4356,["struct",\r\n\t["flags","ubyte"],//1visible,2blocking,4bridge/flag2,8roofed,16water,32forcedraw,64roofoverhang\r\n\t["height",["match","buildnr",{">=936":"ushort","other":"ubyte"}]],\r\n\t["rest",["opt",["flags",0,"bitflag"],["struct",\r\n\t\t["waterheight",["opt","flags&16",["match","buildnr",{">=936":"ushort","other":"ubyte"}]]],\r\n\t\t["underlay","varushort"],\r\n\t\t["underlaycolor",["opt","underlay!=0","ushort"]],\r\n\t\t["overlay","varushort"],\r\n\t\t["overlay_under",["opt","flags&16","varushort"]],\r\n\t\t["shape",["opt","overlay!=0","ubyte"]],\r\n\t\t["underlay_under",["opt","overlay!=0 && flags&16","varushort"]]\r\n\t]]]\r\n]]},\r\n"0x02":{"name":"level2","read":["array",4356,["struct",\r\n\t["flags","ubyte"],//1visible,2blocking,4bridge/flag2,8roofed,16water,32forcedraw,64roofoverhang\r\n\t["height",["match","buildnr",{">=936":"ushort","other":"ubyte"}]],\r\n\t["rest",["opt",["flags",0,"bitflag"],["struct",\r\n\t\t["waterheight",["opt","flags&16",["match","buildnr",{">=936":"ushort","other":"ubyte"}]]],\r\n\t\t["underlay","varushort"],\r\n\t\t["underlaycolor",["opt","underlay!=0","ushort"]],\r\n\t\t["overlay","varushort"],\r\n\t\t["overlay_under",["opt","flags&16","varushort"]],\r\n\t\t["shape",["opt","overlay!=0","ubyte"]],\r\n\t\t["underlay_under",["opt","overlay!=0 && flags&16","varushort"]]\r\n\t]]]\r\n]]},\r\n"0x03":{"name":"level3","read":["array",4356,["struct",\r\n\t["flags","ubyte"],//1visible,2blocking,4bridge/flag2,8roofed,16water,32forcedraw,64roofoverhang\r\n\t["height",["match","buildnr",{">=936":"ushort","other":"ubyte"}]],\r\n\t["rest",["opt",["flags",0,"bitflag"],["struct",\r\n\t\t["waterheight",["opt","flags&16",["match","buildnr",{">=936":"ushort","other":"ubyte"}]]],\r\n\t\t["underlay","varushort"],\r\n\t\t["underlaycolor",["opt","underlay!=0","ushort"]],\r\n\t\t["overlay","varushort"],\r\n\t\t["overlay_under",["opt","flags&16","varushort"]],\r\n\t\t["shape",["opt","overlay!=0","ubyte"]],\r\n\t\t["underlay_under",["opt","overlay!=0 && flags&16","varushort"]]\r\n\t]]]\r\n]]}\r\n}'
},3653:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                           "color", "read": ["array",3,"unsigned byte"] },\r\n\t"0x02": { "name":                        "material", "read": "unsigned short" },\r\n\t"0x03": { "name":                 "material_tiling", "read": "unsigned short" },\r\n\t"0x04": { "name":                    "unknown_0x04", "read": "true" },\r\n\t"0x05": { "name":                    "unknown_0x05", "read": "true" }\r\n}'
},7421:e=>{"use strict"
;e.exports='["array",4096,["struct",\r\n\t["flags","unsigned byte"],\r\n\t["shape",["opt",["flags",0,"bitflag"],"unsigned byte"]],\r\n\t["overlay",["opt",["flags",0,"bitflag"],"variable unsigned short"]],\r\n\t["settings",["opt",["flags",1,"bitflag"],"unsigned byte"]],\r\n\t["underlay",["opt",["flags",2,"bitflag"],"variable unsigned short"]],\r\n\t["height",["opt",["flags",3,"bitflag"],"unsigned byte"]]\r\n]]'
},6362:e=>{"use strict"
;e.exports='["struct",\r\n\t["internal_name","string"],\r\n\t["name","string"],\r\n\t["center","unsigned int"],\r\n\t["unknown_1","unsigned int"],\r\n\t["show","boolean"],\r\n\t["default_zoom","unsigned byte"],\r\n\t["unknown_2","unsigned byte"],\r\n\t["bounds",["array",["struct",\r\n\t\t["plane","unsigned byte"],\r\n\t\t["src",["struct",\r\n\t\t\t["xstart","unsigned short"],\r\n\t\t\t["zstart","unsigned short"],\r\n\t\t\t["xend","unsigned short"],\r\n\t\t\t["zend","unsigned short"]\r\n\t\t]],\r\n\t\t["dst",["struct",\r\n\t\t\t["xstart","unsigned short"],\r\n\t\t\t["zstart","unsigned short"],\r\n\t\t\t["xend","unsigned short"],\r\n\t\t\t["zend","unsigned short"]\r\n\t\t]]]\r\n\t]]\r\n]'
},6914:e=>{"use strict"
;e.exports='["struct",\r\n\t["version",["match","buildnr",{">=887":"ubyte",">=0":0}]],\r\n\t["v0",["opt",["version",0],["struct",\r\n\t\t["unk0","ubyte"],//always 0-4\r\n\t\t["texsize","ushort"],//256,512,0, but doesn\'t always correspond to actualtex\r\n\r\n\t\t//always 0000 after 2015\r\n\t\t["opt0","ubyte"],\r\n\t\t["opt0data",["opt",["opt0",16],["tuple","ubyte","ushort"]]],\r\n\t\t["arr",["nullarray","ubyte",["struct",\r\n\t\t\t["op",["ref","$opcode"]],\r\n\t\t\t["value","ushort"]\r\n\t\t]]],\r\n\r\n\t\t["textureflags","ubyte"],//always 1,3,9,16\r\n\t\t["diffuse",["opt",["textureflags",17,"bitor"],["match","buildnr",{">=887":"uint",">=0":0}]]],\r\n\t\t["normal",["opt",["textureflags",10,"bitor"],["match","buildnr",{">=887":"uint",">=0":0}]]],\r\n\r\n\t\t["texrepeatflags",["match","buildnr",{">=876":"ubyte",">=0":0}]],\r\n\t\t["unk3_skybox",["match","buildnr",{">=876":["buffer",3,"hex"],">=0":"null"}]],//looks like a bitflag thing, bit weird\r\n\r\n\t\t["flags2","ubyte"],//always 12,13,14,28\r\n\t\t["unkfloats",["opt",["flags2",4,"bitflag"],["tuple","float","float"]]],//always 1; 1,4,32\r\n\r\n\t\t["unk7","ubyte"],//0,1,62,63,64,255\r\n\t\t["weirdshit",["opt",["unk7",255],["buffer",19,"hex"]]],//only one single material that has this\r\n\r\n\t\t["diffuse_related1",["match","buildnr",{">=887":["opt",["textureflags",4,"bitflag"],"ubyte"],">=0":"ubyte"}]],//always 1 or null\r\n\t\t["normal_related",["opt",["textureflags",1,"bitflag"],["buffer",4,"hex"]]],//0x80000000 most of the time\r\n\t\t["diffuse_related2",["match","buildnr",{">=887":["opt",["textureflags",0,"bitflag"],"ubyte"],">=0":"ubyte"}]],//always 1,0 or null\r\n\t\t["diffuse_ralated2_data",["opt",["diffuse_related2",2],"ubyte"]],//last used 2015\r\n\r\n\t\t["alphamode","ubyte"],//0,1 or 2\r\n\t\t["alphacutoff",["opt",["alphamode",1],"ubyte"]],//128 most of the time\r\n\r\n\t\t["animtex","ubyte"],//0123\r\n\t\t["animtexU",["opt",["animtex",0,"bitflag"],["match","buildnr",{">=897":"short",">=0":"byte"}]]],\r\n\t\t["animtexV",["opt",["animtex",1,"bitflag"],["match","buildnr",{">=897":"short",">=0":"byte"}]]],\r\n\r\n\t\t["flagextra","bool"],\r\n\t\t["extra",["opt",["flagextra",1],["struct",\r\n\t\t\t["unk00_flags","ubyte"],//flags 1=alpha channel reuse,2=water/lava/bloom?,4=water/dg water,8=water, all skyboxes have 6\r\n\t\t\t["unk01_flagsornumber","ubyte"],//0123 OR a high number (only 20 uses)\r\n\t\t\t["unk02","ubyte"],//0 if unk01=0123 or number (only 4 uses)\r\n\t\t\t["unknown",["buffer",4,"hex"]],//mostly 0 except for some ~15 water materials\r\n\t\t\t["unk07_bool","bool"],\r\n\t\t\t["unk08_flags","ubyte"],//0=5k,1=1,2=5k\r\n\t\t\t["unk09_bool","bool"],//true=7\r\n\t\t\t["unk0a_bool","bool"],\r\n\t\t\t["specular","ubyte"],\r\n\t\t\t["baseColorFraction","ubyte"],//indicates the mix ratio with colorint and vertex colors\r\n\t\t\t["baseColor","ushort"]\r\n\t\t]]]\r\n\t]]],\r\n\t["v1",["opt",["version",1],["struct",\r\n\t\t["flags","uint"],\r\n\t\t//0,1 unused\r\n\t\t["opaque_2",["ref","flags",[2,1]]],//3061/3250\r\n\t\t["flag3",["ref","flags",[3,1]]],//3095 most mats without are never used in a model\r\n\t\t//4unused\r\n\t\t["hasDiffuse",["ref","flags",[5,1]]],//3250, always true\r\n\t\t["hasNormal",["ref","flags",[6,1]]],//2878\r\n\t\t["hasCompound",["ref","flags",[7,1]]],//2223\r\n\r\n\t\t["hasUVanimU",["ref","flags",[8,1]]],//44 uv anim u?\r\n\t\t["hasUVanimV",["ref","flags",[9,1]]],//49 uv anim v?\r\n\t\t["flag10",["ref","flags",[10,1]]],//282 possibly bloom\r\n\t\t["flag11",["ref","flags",[11,1]]],//41 metalic?\r\n\r\n\t\t["flag12",["ref","flags",[12,1]]],//1 use\r\n\t\t["flag13",["ref","flags",[13,1]]],//73 glasslike diffraction/lensing? https://runescape.wiki/w/Altar_of_War\r\n\t\t["flag14",["ref","flags",[14,1]]],//3179\r\n\t\t["flag15",["ref","flags",[15,1]]],//2 use, skybox and https://runescape.wiki/w/Oathbreaker_Outfit\r\n\r\n\t\t["flag16",["ref","flags",[16,1]]],//3069\r\n\t\t["ignore_vertexcol_17",["ref","flags",[17,1]]],//338\r\n\t\t["flag18",["ref","flags",[18,1]]],//24 uses different skybox? ghostlike stuff https://runescape.wiki/w/Closure%27s_robes\r\n\t\t["flag19",["ref","flags",[19,1]]],//5 use gives aurora effect https://runescape.wiki/w/Bohr\r\n\r\n\t\t["flag20",["ref","flags",[20,1]]],//40 seems to be used on flants/leafs\r\n\t\t["flag21",["ref","flags",[21,1]]],//3250 all materials\r\n\t\t//22+ unused\r\n\t\t\r\n\t\t["diffuse",["opt",["hasDiffuse",1],["struct",\r\n\t\t\t["size","ubyte"],//actual size (some times) equal to 2^(6+size)\r\n\t\t\t["texture","uint"]\r\n\t\t]]],\r\n\t\t["normal",["opt",["hasNormal",1],["struct",\r\n\t\t\t["size","ubyte"],//actual size (some times) equal to 2^(6+size)\r\n\t\t\t["texture","uint"]\r\n\t\t]]],\r\n\t\t["compound",["opt",["hasCompound",1],["struct",\r\n\t\t\t["size","ubyte"],//actual size (some times) equal to 2^(6+size)\r\n\t\t\t["texture","uint"]\r\n\t\t]]],\r\n\t\t["flag13value",["opt",["flag13",1],"float"]],\r\n\t\t["flag14value",["opt",["flag14",1],["tuple","ushort","ushort"]]],//0,8520 or 13083 only, referencing other material?\r\n\t\t["flag15value",["opt",["flag15",1],"float"]],\r\n\t\t["flag18value",["opt",["flag18",1],"float"]],//not sure about location\r\n\t\t["flag16value",["opt",["flag16",1],"float"]],\r\n\t\t["flag12value",["opt",["flag12",1],"float"]],//not sure about location\r\n\t\t["flag11value",["opt",["flag11",1],["tuple","float","float","float"]]],\r\n\t\t["flag19value",["opt",["flag19",1],["tuple","float","float","float","float","float"]]],//location unknown\r\n\t\t["normalScale",["opt",["hasNormal",1],"float"]],\r\n\t\t["flag17value",["opt",["ignore_vertexcol_17",1],"float"]],\r\n\t\t["uvanim_u",["opt",["hasUVanimU",1],"short"]],\r\n\t\t["uvanim_v",["opt",["hasUVanimV",1],"short"]],\r\n\r\n\t\t["always_0x0901",["buffer",2,"hex"]],//only a couple with 0001\r\n\t\t["unknownbyte0","ubyte"],//always 0\r\n\t\t["alphamode","ubyte"],//0,1,2\r\n\t\t["alphacutoff",["opt",["alphamode",1],"ubyte"]],//127 most of the time\r\n\t\t["unkFFFF",["buffer",2,"hex"]],\r\n\t\t["endbyte","ubyte"]//usually equal to max texture size always 0-4\r\n\t]]]\r\n]'
},3908:e=>{"use strict"
;e.exports='["struct",\r\n\t["format","ubyte"],\r\n\t["version","ubyte"],\r\n\t["always_0f","ubyte"],\r\n\r\n\t["meshCount","ubyte"],\r\n\t["unkCount0","ubyte"],\r\n\t["unkCount1","ubyte"],\r\n\t["unkCount2","ubyte"],\r\n\t["unkCount3","ubyte"],\r\n\t["unkCount4",["match",{"version>=5":"ubyte","other":0}]],\r\n\r\n\t["meshes",["opt","version<=3",["array",["ref","meshCount"],["struct",\r\n\t\t["$groupFlags","ubyte"],\r\n\t\t["unkint","uint"],\r\n\t\t["materialArgument","ushort le"],\r\n\t\t["faceCount","ushort le"],\r\n\r\n\t\t["hasVertices",["ref","$groupFlags",[0,1]]],\r\n\t\t["hasVertexAlpha",["ref","$groupFlags",[1,1]]],\r\n\t\t["hasFaceBones",["ref","$groupFlags",[2,1]]],\r\n\t\t["hasBoneIds",["ref","$groupFlags",[3,1]]],\r\n\t\t["isHidden",["ref","$groupFlags",[4,1]]],\r\n\t\t["hasSkin",["ref","$groupFlags",[5,1]]],\r\n\r\n\t\t\r\n\t\t["colourBuffer",["opt",["hasVertices",1],["buffer",["ref","faceCount"],"ushort"]]],\r\n\t\t["alphaBuffer",["opt",["hasVertexAlpha",1],["buffer",["ref","faceCount"],"ubyte"]]],\r\n\t\t["faceboneidBuffer",["opt",["hasFaceBones",1],["buffer",["ref","faceCount"],"ushort"]]],\r\n\r\n\t\t//the length field for the indexbuffer can overflow when the model has >22k faces!!\r\n\t\t//unclear if the the client has some alternative way to get it\r\n\t\t["indexBuffers",["array","ubyte",["buffer","ushort le","ushort"]]],\r\n\r\n\t\t["vertexCount",["match",["ref","hasVertices"],{"=1":"ushort le","=0":0}]],\r\n\t\t["positionBuffer",["opt",["hasVertices",1],["buffer",["ref","vertexCount"],"short",3]]],\r\n\t\t["normalBuffer",["opt",["hasVertices",1],["match","buildnr",{\r\n\t\t\t">=887":["buffer",["ref","vertexCount"],"byte",3],\r\n\t\t\t">=0":["buffer",["ref","vertexCount"],"short",3]\r\n\t\t}]]],\r\n\t\t["tagentBuffer",["opt",["hasVertices",1],["match","buildnr",{\r\n\t\t\t//TODO exact buildnr unknown\r\n\t\t\t">=906":["buffer",["ref","vertexCount"],"short",2],\r\n\t\t\t">=0":"null"\r\n\t\t}]]],\r\n\t\t["uvBuffer",["opt",["hasVertices",1],["match","buildnr",{\r\n\t\t\t">=887":["buffer",["ref","vertexCount"],"ushort",2],\r\n\t\t\t">=0":["buffer",["ref","vertexCount"],"float",2]\r\n\t\t}]]],\r\n\t\t["boneidBuffer",["opt",["hasBoneIds",1],["buffer",["ref","vertexCount"],"ushort"]]],\r\n\t\t\r\n\t\t["skin",["opt",["hasSkin",1],["struct",\r\n\t\t\t["skinWeightCount","uint le"],\r\n\t\t\t["skinBoneBuffer",["buffer",["ref","skinWeightCount"],"ushort",1]],\r\n\t\t\t["skinWeightBuffer",["buffer",["ref","skinWeightCount"],"ubyte",1]]\r\n\t\t]]]\r\n\t]]]],\r\n\t["meshdata",["opt","version>3",["struct",\r\n\t\t["$groupFlags","ubyte"],\r\n\t\t["unkint","ubyte"],\r\n\t\t["faceCount","ushort le"],\r\n\r\n\t\t["hasVertices",["ref","$groupFlags",[0,1]]],\r\n\t\t["hasVertexAlpha",["ref","$groupFlags",[1,1]]],\r\n\t\t["hasFaceBones",["ref","$groupFlags",[2,1]]],\r\n\t\t["hasBoneIds",["ref","$groupFlags",[3,1]]],\r\n\t\t["isHidden",["ref","$groupFlags",[4,1]]],\r\n\t\t["hasSkin",["ref","$groupFlags",[5,1]]],\r\n\r\n\t\t["vertexCount","uint le"],\r\n\t\t["positionBuffer",["opt",["hasVertices",1],["buffer",["ref","vertexCount"],"short",3]]],\r\n\t\t["normalBuffer",["opt",["hasVertices",1],["buffer",["ref","vertexCount"],"byte",3]]],\r\n\t\t["tagentBuffer",["opt",["hasVertices",1],["buffer",["ref","vertexCount"],"short",2]]],\r\n\t\t["uvBuffer",["opt",["hasVertices",1],["buffer",["ref","vertexCount"],"ushort",2]]],\r\n\t\t["boneidBuffer",["opt",["hasBoneIds",1],["buffer",["ref","vertexCount"],"ushort"]]],\r\n\t\t\r\n\t\t["skin",["opt","hasSkin==1",["array",["ref","vertexCount"],["struct",\r\n\t\t\t["ids",["array","ushort le","ushort le"]],\r\n\t\t\t["weights",["array","ushort le","ubyte"]]\r\n\t\t]]]],\r\n\t\t["vertexColours",["opt","hasVertices==1",["buffer",["ref","vertexCount"],"ushort"]]],\r\n\t\t["vertexAlpha",["opt","hasVertices==1",["buffer",["ref","vertexCount"],"ubyte"]]],\r\n\t\t["vertexFacebones",["opt","hasFaceBones==1",["buffer",["ref","vertexCount"],"ushort"]]],\r\n\t\t["renders",["array",["ref","meshCount"],["struct",\r\n\t\t\t["$groupFlags","ubyte"],\r\n\t\t\t["hasVertices",["ref","$groupFlags",[0,1]]],\r\n\t\t\t["hasVertexAlpha",["ref","$groupFlags",[1,1]]],\r\n\t\t\t["hasFaceBones",["ref","$groupFlags",[2,1]]],\r\n\t\t\t["hasBoneIds",["ref","$groupFlags",[3,1]]],\r\n\t\t\t["isHidden",["ref","$groupFlags",[4,1]]],\r\n\t\t\t["hasSkin",["ref","$groupFlags",[5,1]]],\r\n\t\t\t\r\n\t\t\t["unkint","uint"],\r\n\t\t\t["materialArgument","ushort le"],\r\n\t\t\t["unkbyte2","ubyte"],\r\n\t\t\t//this might be groupflags&0x80 for uint indexbuffer\r\n\t\t\t["buf",["match",{\r\n\t\t\t\t"vertexCount<=0xffff":["buffer","ushort le","ushort"],//u16 little endian\r\n\t\t\t\t"other":["buffer","ushort le","uint"]//u32 big endian?????\r\n\t\t\t}]]\r\n\t\t]]]\r\n\t]]],\r\n\r\n\t["unk1Buffer",["array",["ref","unkCount1"],["buffer",["match","buildnr",{">=923":39,">=0":37}],"hex"]]],\r\n\t["unk2Buffer",["array",["ref","unkCount2"],["buffer",["match","buildnr",{">=923":50,">=0":44}],"hex"]]],\r\n\t["unk3Buffer",["array",["ref","unkCount3"],["buffer",["match","buildnr",{">=923":18,">=0":16}],"hex"]]],\r\n\t["unk4Buffer",["array",["ref","unkCount4"],["buffer",0]]]\r\n]'
},5258:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                              "models", "read": [ "array", ["match","buildnr",{">=669":"varuint",">=0":"ushort" }]]},\r\n\t"0x02": { "name":                                "name", "read": "string" },\r\n\t"0x03": { "name":                             "examine", "read": "string" },//last used 2006\r\n\t"0x08": { "name":                          "unknown_08", "read": "unsigned byte" },//might be wrong and part of other op\r\n\t"0x0B": { "name":                          "unknown_0B", "read": "unsigned byte" },//might be wrong and part of other op\r\n\t"0x0C": { "name":                           "boundSize", "read": "unsigned byte" },\r\n\t"0x0D": { "name":                              "unk_0D", "read": "ushort" },//last used 2006\r\n\t"0x0E": { "name":                              "unk_0E", "read": "ushort" },//last used 2006\r\n\t"0x11": { "name":                              "unk_11", "read": ["array",4,"ushort"]},//last used 2006\r\n\t"0x1E": { "name":                           "actions_0", "read": "string" },\r\n\t"0x1F": { "name":                           "actions_1", "read": "string" },\r\n\t"0x20": { "name":                           "actions_2", "read": "string" },\r\n\t"0x21": { "name":                           "actions_3", "read": "string" },\r\n\t"0x22": { "name":                           "actions_4", "read": "string" },\r\n\t"0x28": { "name":                  "color_replacements", "read": [ "array", ["tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x29": { "name":               "material_replacements", "read": [ "array", ["tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x2A": { "name":                     "recolourPalette", "read": [ "array", "byte" ] },\r\n\t"0x2C": { "name":                     "recolor_indices", "read": "unsigned short" },\r\n\t"0x2D": { "name":                   "retexture_indices", "read": "unsigned short" },\r\n\t"0x3C": { "name":                          "headModels", "read": [ "array", ["match","buildnr",{">=669":"varuint",">=0":"ushort" }] ] },\r\n\t"0x5D": { "name":                          "drawMapDot", "read": "false" },\r\n\t"0x5F": { "name":                              "combat", "read": "unsigned short" },\r\n\t"0x61": { "name":                             "scaleXZ", "read": "unsigned short" },\r\n\t"0x62": { "name":                              "scaleY", "read": "unsigned short" },\r\n\t"0x63": { "name":                          "unknown_63", "read": "true" },\r\n\t"0x64": { "name":                            "ambience", "read": "byte" },\r\n\t"0x65": { "name":                       "modelContract", "read": "byte" },\r\n\t"0x66": { "name":                      "head_icon_data", "read": "unsigned short" },\r\n\t"0x67": { "name":                          "unknown_67", "read": "unsigned short" },\r\n\t"0x6A": { "name":                            "morphs_1", "read": [ "struct", \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk1", "unsigned int"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk2", [ "array", ["match","buildnr",{">=910":"varushort",">=0":"ubyte"}], "unsigned short" ]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk3", ["match","buildnr",{">=525":"uint",">=0":"ushort"}]] ] },\r\n\t"0x6B": { "name":                          "unknown_6B", "read": "false" },\r\n\t"0x6D": { "name":                            "slowWalk", "read": "false" },\r\n\t"0x6F": { "name":                         "animateIdle", "read": "false" },\r\n\t"0x71": { "name":                              "shadow", "read": [ "struct", ["SrcColor", "unsigned short"], ["DstColor", "unsigned short"] ] },\r\n\t"0x72": { "name":                "shadowAlphaIntensity", "read": [ "struct", ["Src", "byte"], ["Dst", "byte"] ] },\r\n\t"0x73": { "name":                          "unknown_73", "read": ["tuple","ubyte","ubyte"] },//removed in 2010\r\n\t"0x76": { "name":                            "morphs_2", "read": [ "struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk1", "unsigned int"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk2", "unsigned short"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk3", [ "array",["match","buildnr",{">=910":"varushort",">=0":"ubyte"}], "unsigned short" ]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk4", "unsigned int"] ] },\r\n\t"0x77": { "name":                "movementCapabilities", "read": "byte" },\r\n\t"0x78": { "name":                          "unknown_78", "read": ["tuple","ushort","ushort","ushort","ubyte"] },\r\n\t"0x79": { "name":                        "translations", "read": [ "array", ["buffer",4,"hex"] ] },\r\n\t"0x7A": { "name":                              "unk_7A", "read": "unsigned short" },//removed in 2013\r\n\t"0x7B": { "name":                          "iconHeight", "read": "unsigned short" },\r\n\t"0x7D": { "name":                    "respawnDirection", "read": "byte" },\r\n\t"0x7F": { "name":                     "animation_group", "read": "unsigned short" },\r\n\t"0x80": { "name":                        "movementType", "read": "byte" },\r\n\t"0x86": { "name":                       "ambient_sound", "read": [ "struct", ["unk1", "unsigned short"], ["unk2", "unsigned short"], ["unk3", "unsigned short"], ["unk4", "unsigned short"], ["unk45", "unsigned byte"] ] },\r\n\t"0x87": { "name":                           "oldCursor", "read": [ "struct", ["Op", "unsigned byte"], ["Cursor", "unsigned short"] ] },\r\n\t"0x88": { "name":                          "oldCursor2", "read": [ "struct", ["Op", "unsigned byte"], ["Cursor", "unsigned short"] ] },\r\n\t"0x89": { "name":                        "attackCursor", "read": "unsigned short" },\r\n\t"0x8A": { "name":                            "armyIcon", "read": "variable int" },\r\n\t"0x8C": { "name":                          "unknown_8C", "read": "unsigned byte" },\r\n\t"0x8D": { "name":                          "unknown_8D", "read": "true" },\r\n\t"0x8E": { "name":                         "mapFunction", "read": "unsigned short" },\r\n\t"0x8F": { "name":                          "unknown_8F", "read": "true" },\r\n\t"0x96": { "name":                   "members_actions_0", "read": "string" },\r\n\t"0x97": { "name":                   "members_actions_1", "read": "string" },\r\n\t"0x98": { "name":                   "members_actions_2", "read": "string" },\r\n\t"0x99": { "name":                   "members_actions_3", "read": "string" },\r\n\t"0x9A": { "name":                   "members_actions_4", "read": "string" },\r\n\t"0x9B": { "name":                          "unknown_9B", "read": [ "struct", ["unknown_1", "byte"], ["unknown_2", "byte"], ["unknown_3", "byte"], ["unknown_4", "byte"] ] },\r\n\t"0x9E": { "name":                     "aByte3076_set_1", "read": "true" },\r\n\t"0x9F": { "name":                     "aByte3076_set_0", "read": "false" },\r\n\t"0xA0": { "name":                              "quests", "read": [ "array", "unsigned short" ] },\r\n\t"0xA2": { "name":                             "dummy_1", "read": "true" },\r\n\t"0xA3": { "name":                          "unknown_A3", "read": "unsigned byte" },\r\n\t"0xA4": { "name":                          "unknown_A4", "read": [ "struct", ["unknown_1", "unsigned short"], ["unknown_2", "unsigned short"] ] },\r\n\t"0xA5": { "name":                          "unknown_A5", "read": "unsigned byte" },\r\n\t"0xA8": { "name":                          "unknown_A8", "read": "unsigned byte" },\r\n\t"0xA9": { "name":                          "unknown_A9", "read": "false" },\r\n\t"0xAA": { "name":                    "action_cursors_0", "read": "unsigned short" },\r\n\t"0xAB": { "name":                    "action_cursors_1", "read": "unsigned short" },\r\n\t"0xAC": { "name":                    "action_cursors_2", "read": "unsigned short" },\r\n\t"0xAD": { "name":                    "action_cursors_3", "read": "unsigned short" },\r\n\t"0xAE": { "name":                    "action_cursors_4", "read": "unsigned short" },\r\n\t"0xAF": { "name":                    "action_cursors_5", "read": "unsigned short" },\r\n\t"0xB2": { "name":                             "dummy_2", "read": "true" },\r\n\t"0xB3": { "name":                          "unknown_B3", "read": [ "struct", ["unknown_1", "variable short"], ["unknown_2", "variable short"], ["unknown_3", "variable short"], ["unknown_4", "variable short"], ["unknown_5", "variable short"], ["unknown_6", "variable short"] ] },\r\n\t"0xB4": { "name":                          "unknown_B4", "read": "unsigned byte" },\r\n\t"0xB5": { "name":                          "unknown_B5", "read": [ "struct", ["unknown_1", "unsigned short"], ["unknown_2", "unsigned byte"] ] },\r\n\t"0xB6": { "name":                          "unknown_B6", "read": "true" },\r\n\t"0xB7": { "name":                          "unknown_B7", "read": "unsigned byte" },//might be wrong and part of other op\r\n\t"0xB8": { "name":                          "unknown_B8", "read": "unsigned byte" },\r\n\t"0xB9": { "name":                          "unknown_B9", "read": "true" },\r\n\t"0xDB": { "name":                          "unknown_DB", "read": "ubyte" },//might be wrong and part of other op\r\n\t"0xF9": { "name":                               "extra", "read": "extrasmap" },\r\n\t"0xFD": { "name":                          "unknown_FD", "read": "ubyte" }//probably render priority\r\n}'
},2244:e=>{"use strict"
;e.exports='{\r\n\t//TODO build nr for count arg unknown\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t"0x01": { "name":                              "models", "read":["match","buildnr",{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t">=582":["array","ubyte",["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["type","ubyte"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["values",["array","ubyte","item_modelid"]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"other":["array","ubyte",["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["values",["array",1,"item_modelid"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["type","ubyte"]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]]}]},\r\n\t"0x02": { "name":                                "name", "read": "string" },\r\n\t"0x03": { "name":                             "examine", "read": "string" },//removed in jun 2006\r\n\t//not sure what this is but they seem identical\r\n\t"0x05": { "name":                           "models_05", "read":["match","buildnr",{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t">=582":["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["models", ["array","ubyte",["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["type","ubyte"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["values",["array","ubyte","item_modelid"]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unktail",["array","ubyte",["tuple","item_modelid","item_modelid"]]]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"other":["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["models",["array",1,["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["type",10],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["values",["array","ubyte","item_modelid"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unktail",["array",0,["tuple","item_modelid","item_modelid"]]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]]]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}]},\r\n\t"0x0E": { "name":                               "width", "read": "unsigned byte" },\r\n\t"0x0F": { "name":                              "length", "read": "unsigned byte" },\r\n\t"0x11": { "name":                "probably_nocollision", "read": "true" },\r\n\t"0x12": { "name":            "maybe_allows_lineofsight", "read": "true" },\r\n\t"0x13": { "name":                           "deletable", "read": "boolean" },\r\n\t"0x15": { "name":                 "probably_morphFloor", "read": "true" },\r\n\t"0x16": { "name":                          "unknown_16", "read": "true" },\r\n\t"0x17": { "name":                          "occludes_1", "read": "false" },\r\n\t"0x18": { "name":                  "probably_animation", "read": "variable unsigned int" },\r\n\t"0x1B": { "name":               "maybe_blocks_movement", "read": "true" },\r\n\t"0x1C": { "name":                  "wallkit_related_1C", "read": "unsigned byte" },\r\n\t"0x1D": { "name":                             "ambient", "read": "ubyte" },\r\n\t"0x1E": { "name":                           "actions_0", "read": "string" },\r\n\t"0x1F": { "name":                           "actions_1", "read": "string" },\r\n\t"0x20": { "name":                           "actions_2", "read": "string" },\r\n\t"0x21": { "name":                           "actions_3", "read": "string" },\r\n\t"0x22": { "name":                           "actions_4", "read": "string" },\r\n\t"0x27": { "name":                            "contrast", "read": "byte" },\r\n\t"0x28": { "name":                  "color_replacements", "read": [ "array", ["tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x29": { "name":               "material_replacements", "read": [ "array", ["tuple", "unsigned short", "unsigned short"] ] },\r\n\t"0x2A": { "name":                     "recolourPalette", "read": [ "array", "byte" ] },\r\n\t"0x2C": { "name":                          "unknown_2C", "read": "unsigned short" },\r\n\t"0x2D": { "name":                          "unknown_2D", "read": "unsigned short" },\r\n\t"0x36": { "name":                          "unknown_36", "read": "true" },\r\n\t"0x37": { "name":                          "unknown_37", "read": "true" },\r\n\t"0x38": { "name":                          "unknown_38", "read": "true" },\r\n\t"0x39": { "name":                          "unknown_39", "read": "true" },\r\n\t"0x3C": { "name":                          "unknown_3c", "read": "ushort" },//replaced by mapfunction 6B later in ~2010\r\n\t"0x3E": { "name":                              "mirror", "read": "true" },\r\n\t"0x40": { "name":                          "unknown_40", "read": "true" },\r\n\t"0x41": { "name":                              "scaleX", "read": "short" },\r\n\t"0x42": { "name":                              "scaleY", "read": "short" },\r\n\t"0x43": { "name":                              "scaleZ", "read": "short" },\r\n\t"0x44": { "name":                        "mapscene_old", "read": "unsigned short" },//replaced by 0x66\r\n\t"0x45": { "name":                            "dummy_45", "read": "unsigned byte" },\r\n\t"0x46": { "name":                          "translateX", "read": "short" },\r\n\t"0x47": { "name":                          "translateY", "read": "short" },\r\n\t"0x48": { "name":                          "translateZ", "read": "short" },\r\n\t"0x49": { "name":                          "unknown_49", "read": "true" },\r\n\t"0x4A": { "name":                          "unknown_4A", "read": "true" },\r\n\t"0x4B": { "name":                          "unknown_4B", "read": "unsigned byte" },\r\n\t"0x4D": { "name":                            "morphs_1", "read": [ "struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk1", "unsigned int"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk2", [ "array",["match","buildnr",{">=910":"varushort",">=0":"ubyte"}],"item_modelid"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk3", "item_modelid"] ] },\r\n\t"0x4E": { "name":             "light_source_related_4E", "read": [ "struct", ["maybe_color", "unsigned short"], ["maybe_radius", "unsigned byte"] ] },\r\n\t"0x4F": { "name":                          "unknown_4F", "read": [ "struct", ["unknown_1", "unsigned short"], ["unknown_2", "unsigned short"], ["unknown_3", "unsigned byte"], ["unknown_4", ["array", "unsigned short"]] ] },\r\n\t"0x51": { "name":                          "unknown_51", "read": "unsigned byte" },\r\n\t"0x52": { "name":                          "unknown_52", "read": "true" },\r\n\t"0x58": { "name":                          "is_members", "read": "true" },\r\n\t"0x59": { "name":                          "unknown_59", "read": "true" },\r\n\t"0x5A": { "name":                          "unknown_5A", "read": "true" },\r\n\t"0x5B": { "name":                           "isMembers", "read": "true" },\r\n\t"0x5C": { "name":                            "morphs_2", "read": [ "struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk1", "unsigned int"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk2", "item_modelid"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk3", [ "array", ["match","buildnr",{">=910":"varushort",">=0":"ubyte"}],"item_modelid"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["unk4", "item_modelid"] ] },\r\n\t"0x5D": { "name":                             "tilt_xz", "read": [ "tuple", "byte", "byte"] },\r\n\t"0x5E": { "name":                         "under_water", "read": "true" },\r\n\t"0x5F": { "name":         "probably_morphCeilingOffset", "read": ["match","buildnr",{">=596":"short","other":0}]},//TODO buildnr somewhere between 580-728\r\n\t"0x60": { "name":                          "unknown_60", "read": "true" },\r\n\t"0x61": { "name":        "ground_decoration_related_61", "read": "true" },\r\n\t"0x62": { "name":                "has_animated_texture", "read": "true" },\r\n\t"0x63": { "name":                            "dummy_63", "read": [ "struct", ["unknown_2", "unsigned byte"], ["unknown_1", "unsigned short"] ] },\r\n\t"0x64": { "name":                            "dummy_64", "read": [ "struct", ["unknown_2", "unsigned byte"], ["unknown_1", "unsigned short"] ] },\r\n\t"0x65": { "name":                           "unused_65", "read": "unsigned byte" },\r\n\t"0x66": { "name":                            "mapscene", "read": "unsigned short" },\r\n\t"0x67": { "name":                          "occludes_2", "read": "false" },\r\n\t"0x68": { "name":             "interactable_related_68", "read": "unsigned byte" },\r\n\t"0x69": { "name":                      "invertMapScene", "read": "true" },\r\n\t"0x6A": { "name":                          "headModels", "read": [ "array", ["struct", ["model", "varuint"], ["unknown_2", "unsigned byte"]] ] },\r\n\t"0x6B": { "name":                         "mapFunction", "read": "unsigned short" },\r\n\t"0x71": { "name":                          "unknown_71", "read": "unsigned byte" },\r\n\t"0x96": { "name":                    "members_action_1", "read": "string" },\r\n\t"0x97": { "name":                    "members_action_2", "read": "string" },\r\n\t"0x98": { "name":                    "members_action_3", "read": "string" },\r\n\t"0x99": { "name":                    "members_action_4", "read": "string" },\r\n\t"0x9A": { "name":                    "members_action_5", "read": "string" },\r\n\t"0xA0": { "name":                          "unknown_A0", "read": [ "array", "unsigned short" ] },\r\n\t"0xA2": { "name":                        "singleuse_A2", "read": "int" },\r\n\t"0xA3": { "name":                          "unknown_A3", "read": [ "struct", ["unknown_1", "byte"], ["unknown_2", "byte"], ["unknown_3", "byte"], ["unknown_4", "byte"] ] },\r\n\t"0xA4": { "name":                        "singleuse_A4", "read": "short" },\r\n\t"0xA5": { "name":                        "singleuse_A5", "read": "short" },\r\n\t"0xA6": { "name":                        "singleuse_A6", "read": "unsigned short" },\r\n\t"0xA7": { "name":                     "floor_thickness", "read": "unsigned short" },\r\n\t"0xA8": { "name":                           "unused_a8", "read": "true" },\r\n\t"0xA9": { "name":                           "unused_a9", "read": "true" },\r\n\t"0xAA": { "name":                  "wallkit_related_AA", "read": "variable unsigned short" },\r\n\t"0xAB": { "name":            "possibly_wallkit_skew_AB", "read": "variable unsigned short" },\r\n\t"0xAD": { "name":              "lightsource_related_AD", "read": [ "struct", ["unknown_1", "unsigned short"], ["unknown_2", "unsigned short"] ] },\r\n\t"0xB1": { "name":                    "can_change_color", "read": "true" },\r\n\t"0xB2": { "name":                          "unknown_B2", "read": "unsigned byte" },\r\n\t"0xBA": { "name":                          "unknown_BA", "read": "unsigned byte" },\r\n\t"0xBC": { "name":                            "dummy_bc", "read": "true" },\r\n\t"0xBD": { "name":                   "treerockordoor_BD", "read": "true" },\r\n\t"0xBE": { "name":                    "action_cursors_0", "read": "unsigned short" },\r\n\t"0xBF": { "name":                    "action_cursors_1", "read": "unsigned short" },\r\n\t"0xC0": { "name":                    "action_cursors_2", "read": "unsigned short" },\r\n\t"0xC1": { "name":                    "action_cursors_3", "read": "unsigned short" },\r\n\t"0xC2": { "name":                    "action_cursors_4", "read": "unsigned short" },\r\n\t"0xC3": { "name":                    "action_cursors_5", "read": "unsigned short" },\r\n\t"0xC4": { "name":            "tileplacement_related_c4", "read": "unsigned byte" },\r\n\t"0xC5": { "name":                     "clan_citadel_C5", "read": "unsigned byte" },\r\n\t"0xC6": { "name":                        "invisible_c6", "read": "true" },\r\n\t"0xC7": { "name":                     "flooroverlay_c7", "read": "true" },\r\n\t"0xC8": { "name":                        "singleuse_C8", "read": "true" },\r\n\t"0xC9": { "name":                          "unknown_C9", "read": [ "struct", ["unknown_1", "variable short"], ["unknown_2", "variable short"], ["unknown_3", "variable short"], ["unknown_4", "variable short"], ["unknown_5", "variable short"], ["unknown_6", "variable short"] ] },\r\n\t"0xCA": { "name":\t\t\t\t\t\t "singleuse_CA", "read": "unsigned byte" },\r\n\t"0xCB": { "name":\t\t\t\t\t\t   "unknown_CB", "read": "true" },\r\n\t"0xCC": { "name":\t\t\t\t\t\t   "unknown_CC", "read": ["array","ubyte",["buffer",27,"hex"]] },\r\n\t"0xF9": { "name":                               "extra", "read": "extrasmap" }\r\n}'
},9833:e=>{"use strict"
;e.exports='["struct",\r\n    ["$idcount",0],\r\n    ["mats",["chunkedarray","ushort",\r\n        [["id",["accum","$idcount",1,"postadd"]]],\r\n        [["hasprops","ubyte"]],//always 1, rarely 0\r\n        [["unk1",["opt",["hasprops",0,"eqnot"],"ubyte"]]],//1 or 0\r\n        [["unk2",["opt",["hasprops",0,"eqnot"],"ubyte"]]],//1 or 0       \r\n        [["unk3",["match","buildnr",{">627":null,"other":["opt",["hasprops",0,"eqnot"],"ubyte"]}]]],//mostly 00, 1x 0001 1x 0080\r\n        [["unk4",["opt",["hasprops",0,"eqnot"],"ushort"]]],//mostly 00, 1x 0001 1x 0080\r\n        [["basecolorfraction",["opt",["hasprops",0,"eqnot"],"ubyte"]]],//00, or ff, some in between\r\n        [["unk6",["opt",["hasprops",0,"eqnot"],"ubyte"]]],//0-5\r\n        [["unk7",["opt",["hasprops",0,"eqnot"],"ubyte"]]],//0-4 1x 82\r\n        [["basecolor",["opt",["hasprops",0,"eqnot"],"ushort"]]],\r\n        [["unk10",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk11",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk20",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk21",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk30",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk31",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk32",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk33",["match","buildnr",{">554":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]],\r\n        [["unk40",["match","buildnr",{">578":["opt",["hasprops",0,"eqnot"],["buffer",5,"hex"]],"other":null}]]],\r\n        [["unk41",["match","buildnr",{">597":["opt",["hasprops",0,"eqnot"],"ubyte"],"other":null}]]]\r\n    ]]\r\n]'
},3813:e=>{"use strict"
;e.exports='["struct",\r\n\t["footbytes",["match","buildnr",{">=764":65535,">=0":["footer",2,"ushort"]}]],\r\n\t["colanimcount",["match","buildnr",{">=764":["footer",2,"ushort"],">=0":0}]],\r\n\t["unkcount0",["match","buildnr",{">=764":["footer",2,"ushort"],">=0":0}]],\r\n\t["uvcount",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["footer",2,"ushort"],\r\n\t\t"other":0\r\n\t}]],\r\n\t["indexbufsize",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["footer",2,"ushort"],\r\n\t\t"other":["ref","footbytes"]\r\n\t}]],\r\n\t["zsize",["footer",2,"ushort"]],\r\n\t["ysize",["footer",2,"ushort"]],\r\n\t["xsize",["footer",2,"ushort"]],\r\n\t["hasbones",["footer",1,"bool"]],\r\n\t["hasmaterials",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["footer",1,"bool"],\r\n\t\t"other":false\r\n\t}]],\r\n\t["flag3",["footer",1,"bool"]],//called transgroups in runelite\r\n\t["hasalpha",["footer",1,"bool"]],\r\n\t["priority",["footer",1,"ubyte"]],\r\n\t["extraflags",["footer",1,"ubyte"]],\r\n\t["texmapcount",["match","buildnr",{">=764":["footer",2,"ushort"],">=0":["footer",1,"ubyte"]}]],\r\n\t["facecount",["footer",2,"ushort"]],\r\n\t["vertcount",["footer",2,"ushort"]],\r\n\r\n\t["header1",["match","buildnr",{">=754":"ubyte",">=0":0}]],\r\n\t["header2",["match","buildnr",{">=764":"ubyte",">=0":0}]],\r\n\t["modelversion",["match","buildnr",{\r\n\t\t">=764":"ubyte",\r\n\t\t"other":["match",["ref","extraflags"],{\r\n\t\t\t"&8":["footer",1,"ubyte"],\r\n\t\t\t"other":0\r\n\t\t}]\r\n\t}]],\r\n\t["vertdatasize",["match","buildnr",{\r\n\t\t">=764":["ref","unkcount0"],\r\n\t\t"other":["match",["ref","extraflags"],{\r\n\t\t\t"&0x10":["footer",2,"ushort"],\r\n\t\t\t"other":["ref","vertcount"]\r\n\t\t}]\r\n\t}]],\r\n\r\n\t["texmap_vertcount",0],\r\n\t["texmap_projectioncount",0],\r\n\t["texmap_transsize",0],\r\n\t["texflags",["array",["ref","texmapcount"],\r\n\t\t["match",["match",["ref","footbytes"],{"65535":"ubyte","other":0}],{\r\n\t\t\t"0":["struct",\r\n\t\t\t\t["type",0],\r\n\t\t\t\t["vertindex",["accum","texmap_vertcount",1,"postadd"]]\r\n\t\t\t],\r\n\t\t\t"1":["struct",\r\n\t\t\t\t["type",1],\r\n\t\t\t\t["projection",["accum","texmap_projectioncount",1,"postadd"]],\r\n\t\t\t\t["speed",["accum","texmap_transsize",1,"postadd"]]\r\n\t\t\t],\r\n\t\t\t"2":["struct",\r\n\t\t\t\t["type",2],\r\n\t\t\t\t["projection",["accum","texmap_projectioncount",1,"postadd"]],\r\n\t\t\t\t["speed",["accum","texmap_transsize",3,"postadd"]]\r\n\t\t\t],\r\n\t\t\t"3":["struct",\r\n\t\t\t\t["type",3],\r\n\t\t\t\t["projection",["accum","texmap_projectioncount",1,"postadd"]],\r\n\t\t\t\t["speed",["accum","texmap_transsize",1,"postadd"]]\r\n\t\t\t]\r\n\t\t}]]\r\n\t],\r\n\t["vertflags",["buffer",["ref","vertcount"],"ubyte"]],//0-7 flags, whether xyz are different from previous vertex\r\n\t["mode_1",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["opt",["extraflags",0,"bitflag"],["buffer",["ref","facecount"],"ubyte"]],\r\n\t\t"other":null\r\n\t}]],\r\n\t["tritype",["buffer",["ref","facecount"],"ubyte"]],//1-4 are types, flag 8 grabs a uv pair from the texuvs struct\r\n\t["facepriority",["opt",["priority",255],["buffer",["ref","facecount"],"ubyte"]]],\r\n\t["unk1",["opt",["flag3",1],["buffer",["match","buildnr",{">=764":["ref","colanimcount"],">=0":["ref","facecount"]}]]]],//"transgroups"\r\n\t["mode_2",["match",["ref","footbytes"],{\r\n\t\t"0xffff":null,\r\n\t\t"other":["opt",["extraflags",0,"bitflag"],["buffer",["ref","facecount"],"ubyte"]]\r\n\t}]],\r\n\t["boneids",["opt",["hasbones",1],["buffer",["ref","vertdatasize"]]]],\r\n\t["alpha",["opt",["hasalpha",1],["buffer",["ref","facecount"]]]],\r\n\t["indexbuffer",["buffer",["ref","indexbufsize"]]],\r\n\t["material",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["opt",["hasmaterials",1],["buffer",["ref","facecount"],"ushort"]],\r\n\t\t"other":null\r\n\t}]],\r\n\t["uvs",["buffer",["ref","uvcount"]]],\r\n\t["colors",["buffer",["ref","facecount"],"ushort"]],\r\n\t["texmap_verts_1",["match",["ref","footbytes"],{\r\n\t\t"0xffff":null,\r\n\t\t"other":["array",["ref","texmap_vertcount"],["tuple","ushort","ushort","ushort"]]\r\n\t}]],\r\n\t["posx",["buffer",["ref","xsize"]]],\r\n\t["posy",["buffer",["ref","ysize"]]],\r\n\t["posz",["buffer",["ref","zsize"]]],\r\n\t["texmap_verts_2",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["array",["ref","texmap_vertcount"],["tuple","ushort","ushort","ushort"]],\r\n\t\t"other":null\r\n\t}]],\r\n\t["texmap_projections",["chunkedarray",["ref","texmap_projectioncount"],[\r\n\t\t["normal",["tuple","short","short","short"]]\r\n\t],[\r\n\t\t["scale",["tuple",\r\n\t\t\t["match",["ref","modelversion"],{">=15":"unsigned tribyte",">=0":"ushort"}],\r\n\t\t\t["match",["ref","modelversion"],{">=14":"unsigned tribyte",">=0":"ushort"}],//14 is not a typo\r\n\t\t\t["match",["ref","modelversion"],{">=15":"unsigned tribyte",">=0":"ushort"}]\r\n\t\t]]\r\n\t],[\r\n\t\t["rotation","ubyte"]\r\n\t],[\r\n\t\t["direction","ubyte"]\r\n\t]]],\r\n\t["texmap_translates",["array",["ref","texmap_transsize"],"ubyte"]],\r\n\t["particles",["opt",["extraflags",1,"bitflag"],["array","ubyte",["struct",\r\n\t\t["texture","ushort"],\r\n\t\t["faceid","ushort"]\r\n\t]]]],\r\n\t["effectors",["opt",["extraflags",1,"bitflag"],["array","ubyte",["struct",\r\n\t\t["effector","ushort"],\r\n\t\t["vertex","ushort"]\r\n\t]]]],\r\n\t["billboards",["opt",["extraflags",2,"bitflag"],["array","ubyte",["struct",\r\n\t\t["unk1","ushort"],\r\n\t\t["unk2","ushort"],\r\n\t\t["unk3","ubyte"],\r\n\t\t["unk4","ubyte"]\r\n\t]]]],\r\n\t["texuvs",["opt",["extraflags",7,"bitflag"],["struct",\r\n\t\t["headoffset",["footer",1,"ubyte"]],//always 7?\r\n\t\t["indexsize",["footer",2,"ushort"]],\r\n\t\t["datasize",["footer",2,"ushort"]],\r\n\t\t["coordcount",["footer",2,"ushort"]],\r\n\t\t["index",["buffer",["ref","indexsize"],"ubyte"]],\r\n\t\t["vertex",["buffer",["ref","vertcount"],"ubyte"]],\r\n\t\t["udata",["array",["ref","coordcount"],"short"]],\r\n\t\t["vdata",["array",["ref","coordcount"],"short"]]\r\n\t]]],\r\n\t["unusedendbytes",["match",["ref","footbytes"],{\r\n\t\t"0xffff":["match","buildnr",{\r\n\t\t\t">=526":null,\r\n\t\t\t"other":["array","ubyte",["tuple","ushort","ushort","ushort","int"]]\r\n\t\t}],\r\n\t\t"other":null\r\n\t}]]\r\n]'
},2390:e=>{"use strict";e.exports='["struct",\r\n    ["color","ushort"],\r\n    ["bool0","bool"],\r\n    ["bool1","bool"],//always true\r\n    ["spriteid","ushort"],\r\n    ["always00",["buffer",6,"hex"]]\r\n]'},1140:e=>{"use strict"
;e.exports='{\r\n\t"0x04": { "name":              "unk04", "read": "true" },\r\n\t"0x65": { "name":              "type", "read": ["struct",\r\n\t\t["vartype","varushort"],\r\n\t\t["$primitive","ubyte"],\r\n\t\t["defaultint",["opt",["$primitive",2],"int"]],\r\n\t\t["defaultstring",["opt",["$primitive",5],"string"]]\r\n\t] }\r\n}'
},2872:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                           "unk01", "read": ["array",4,"ushort"] },\r\n\t"0x02": { "name":                           "unk02", "read": ["array",1,"ushort"] },\r\n\t"0x03": { "name":                           "unk03", "read": ["array",4,"ushort"] },\r\n\t"0x04": { "name":                           "unk04", "read": ["array",1,"ushort"] },\r\n\t"0x05": { "name":                           "unk05", "read": ["array",1,"ushort"] },\r\n\t"0x06": { "name":                           "unk06", "read": ["buffer",8,"hex"] },\r\n\t"0x07": { "name":                           "unk07", "read": ["array",2,"ushort"] },\r\n\t"0x08": { "name":                           "unk08", "read": ["array",2,"ushort"] },\r\n\t"0x09": { "name":                           "unk09", "read": ["array","ubyte","ushort"] },\r\n\t"0x0A": { "name":                           "unk0A", "read": ["array","ubyte","ushort"] },\r\n\r\n\t"0x0C": { "name":                           "unk0C", "read": "ubyte" },\r\n\t"0x0D": { "name":                           "unk0D", "read": "ubyte" },\r\n\t"0x0E": { "name":                           "unk0E", "read": "ushort" },\r\n\t"0x0F": { "name":                           "unk0F", "read": "ushort" },\r\n\t"0x10": { "name":                           "unk10", "read": ["tuple","ubyte","short","short","ubyte"] },\r\n\r\n\t"0x12": { "name":                           "unk12", "read": ["buffer",4,"hex"] },\r\n\t"0x13": { "name":                           "unk13", "read": "ubyte" },\r\n\t"0x14": { "name":                           "unk14", "read": "ubyte" },\r\n\t"0x15": { "name":                           "unk15", "read": "ubyte" },\r\n\t"0x16": { "name":                           "unk16", "read": ["array",2,"ushort"] },\r\n\t"0x17": { "name":                           "unk17", "read": "ubyte" },\r\n\t"0x18": { "name":                           "unk18", "read": "ubyte" },\r\n\t"0x19": { "name":                           "unk19", "read": ["array","ubyte","ushort"] },\r\n\t"0x1A": { "name":                           "unk1A", "read": "true" },\r\n\t"0x1B": { "name":                           "unk1B", "read": "ushort" },\r\n\t"0x1C": { "name":                           "unk1C", "read": ["struct",\r\n\t\t["unk0","ubyte"],\r\n\t\t["flags","ubyte"],\r\n\t\t["unkmain",["buffer",4,"hex"]],\r\n\t\t["opt2",["opt",["flags",1,"bitflag"],"ubyte"]],\r\n\t\t["opt4",["opt",["flags",2,"bitflag"],"ushort"]],\r\n\t\t["opt8",["opt",["flags",3,"bitflag"],"ushort"]],\r\n\t\t["opt16",["opt",["flags",4,"bitflag"],["tuple","ushort","ubyte"]]],\r\n\t\t["unk2","ushort"]\r\n\t] },\r\n\t"0x1D": { "name":                           "unk1D", "read": ["struct",\r\n\t\t["unk1",["array","ubyte","ushort"]],\r\n\t\t["unk2","ushort"]\r\n\t] },\r\n\t"0x1E": { "name":                           "unk1E", "read": "true" },\r\n\t"0x1F": { "name":                           "unk1F", "read": ["array",2,"ushort"] },\r\n\t"0x20": { "name":                           "unk20", "read": "true" },\r\n\t"0x21": { "name":                           "unk21", "read": "true" },//always followed by 0x1a\r\n\t"0x22": { "name":                           "unk22", "read": "true" },\r\n\t"0x23": { "name":                           "unk23", "read": ["struct",\r\n\t\t["unk1",["array","ubyte",["tuple","short","ubyte"]]],\r\n\t\t["unk2","ushort"]\r\n\t] },\r\n\t"0x24": { "name":                           "unk24", "read": "true" },\r\n\r\n\t// "0x24": { "name":                           "unk24", "read": "true" },\r\n\r\n\t// "0x22": { "name":                           "unk22", "read": "true" }\r\n}'
},5881:e=>{"use strict"
;e.exports='{\r\n\t//0-7, often 0,-1,-10,-45\r\n\t"0x01": { "name":                           "unk01", "read": ["tuple","ubyte","byte"] },\r\n\r\n\t//weird, often at min or max of int range\r\n\t"0x03": { "name":                           "unk03", "read": ["array",6,"short"] },\r\n\t"0x04": { "name":                           "unk04", "read": ["struct",\r\n\t\t["unk0","ubyte"],//always 1 or 2\r\n\t\t["unk1_0000","ushort"],//always 0\r\n\t\t["unk2","ushort"]//weird, 1-496\r\n\t] },\r\n\r\n\t//always 2\r\n\t"0x06": { "name":                           "unk06", "read": "ubyte" },\r\n\r\n\t//these flags often come together\r\n\t//36/57 uses\r\n\t"0x08": { "name":                           "unk08", "read": "true" },\r\n\t//37/57 uses\r\n\t"0x09": { "name":                           "unk09", "read": "true" },\r\n\t//31/57 uses\r\n\t"0x0A": { "name":                           "unk0A", "read": "true" }\r\n}'
},9193:e=>{"use strict";e.exports='["nullarray",["struct",\r\n    ["op",["ref","$opcode"]],\r\n    ["args",["match",["ref","$opcode"],{\r\n        "0x01":["buffer",8,"hex"]\r\n    }]]\r\n]]'},3599:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                     "text", "read": "string" },\r\n\t"0x02": { "name":            "subcategories", "read": ["array","ubyte",["struct",["id","ushort"],["hotkey","ubyte"]]]},\r\n\t"0x03": { "name":                    "lines", "read": ["array","ubyte",["struct",["id","ushort"],["hotkey","ubyte"]]]},\r\n\t"0x04": { "name":            "nonsearchable", "read": "true" }\r\n}'
},7146:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":               "text", "read": "string" },\r\n\t"0x02": { "name":            "replies", "read": ["array","ubyte","ushort"]},\r\n\t"0x03": { "name":            "inserts", "read": ["array","ubyte",["struct",\r\n\t\t["type","ushort"],\r\n\t\t["pickEnum",["opt",["type",0],"ushort"]],\r\n\t\t["pickTtem",["opt",["type",1],"true"]],\r\n\t\t["skillLevel",["opt",["type",4],"ushort"]],\r\n\t\t["varplayerEnum",["opt",["type",6],["struct",["enum","ushort"],["varbit","ushort"]]]],\r\n\t\t["varplayer",["opt",["type",8],"ushort"]],\r\n\t\t["varbit",["opt",["type",9],"ushort"]],\r\n\t\t["pickTradeableItem",["opt",["type",10],"true"]],\r\n\t\t["skillLevelEnum",["opt",["type",11],["struct",["enum","ushort"],["skill","ushort"]]]],\r\n\t\t["friendsChatCount",["opt",["type",12],"true"]],\r\n\t\t["varWorld",["opt",["type",14],"ushort"]],\r\n\t\t["combatlevel",["opt",["type",15],"true"]],\r\n\t\t["varbitEnumstring",["opt",["type",16],["struct",["enum","ushort"],["varbit","ushort"]]]]\r\n\t]]},\r\n\t"0x04": { "name":      "nonsearchable", "read": "true" }\r\n}'
},1380:e=>{"use strict"
;e.exports='["struct",\r\n\t["$minorindex","-1"],\r\n\t["cachemajors",["match","buildnr",{\r\n\t\t">=605":["array","ubyte",["struct",\r\n\t\t\t["minor",["accum","$minorindex","1"]],\r\n\t\t\t["crc","uint"],\r\n\t\t\t["version","uint"],\r\n\t\t\t["subindexcount",["match","buildnr",{">=816":"uint","other":0}]],\r\n\t\t\t["integer_10",["match","buildnr",{">=816":"uint","other":0}]],\r\n\t\t\t["maybe_checksum1",["buffer",64,"hex"]]\r\n\t\t]],\r\n\t\t"other":["nullarray",["bytesleft"],["struct",\r\n\t\t\t["minor",["accum","$minorindex","1"]],\r\n\t\t\t["crc","uint"],\r\n\t\t\t["version",["match","buildnr",{">=457":"uint","other":0}]],\r\n\t\t\t["subindexcount",0]\r\n\t\t]]\r\n\t}]],\r\n\t//512bytes of data but variable length encoding that makes is 511-513\r\n\t["maybe_proper_checksum",["buffer",["bytesleft"],"hex"]]\r\n]'
},1171:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                              "frames", "read": ["chunkedarray","unsigned short",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["framelength","unsigned short"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["frameidlow","unsigned short"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["frameidhi","unsigned short"]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]},\r\n\t"0x02": { "name":                          "unknown_02", "read": "ushort" },\r\n\t"0x03": { "name":                          "unknown_03", "read": ["array","ubyte","ubyte"] },\r\n\t"0x04": { "name":                          "unknown_04", "read": "true" },\r\n\t"0x05": { "name":                          "unknown_05", "read": "ubyte" },\r\n\t"0x06": { "name":                          "unknown_06", "read": "ushort" },\r\n\t"0x07": { "name":                          "unknown_07", "read": "ushort" },\r\n\t"0x08": { "name":                          "unknown_08", "read": "ubyte" },\r\n\t"0x09": { "name":                          "unknown_09", "read": "ubyte" },\r\n\t"0x0A": { "name":                          "unknown_0A", "read": "ubyte" },\r\n\t"0x0B": { "name":                          "unknown_0B", "read": "ubyte" },\r\n\t"0x0C": { "name":                          "unknown_0C", "read": ["chunkedarray","ubyte",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["framelength","unsigned short"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["frameidlow","unsigned short"]]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]},\r\n\t"0x0D": { "name":                          "unknown_0D", "read": ["array","unsigned short",["struct",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["$keys","unsigned byte"],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["default",["opt",["$keys",0,"eqnot"],"unsigned short"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["weirdbyte",["opt",["$keys",0,"eqnot"],"unsigned byte"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t["extras",["array",["ref","$keys",null,-1],"unsigned short"]] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]]},\r\n\t"0x0E": { "name":                          "unknown_0E", "read": "true" },\r\n\t"0x0F": { "name":                          "unknown_0F", "read": "true" },\r\n\t"0x10": { "name":                          "unknown_10", "read": "true" },\r\n\t"0x11": { "name":                          "unknown_11", "read": "ubyte" },\r\n\t"0x12": { "name":                          "unknown_12", "read": "true" },\r\n\t"0x13": { "name":                          "unknown_13", "read": "unsigned short" },\r\n\t"0x14": { "name":                          "unknown_14", "read": ["buffer",5,"hex"] },\r\n\t"0x16": { "name":                          "unknown_16", "read": "unsigned byte" },\r\n\t"0x18": { "name":                          "unknown_18", "read": "unsigned short" },\r\n\t"0x19": { "name":                  "skeletal_animation", "read": "unsigned short" },\r\n\t"0x1a": { "name":                      "skeletal_range", "read": ["tuple","ushort","ushort"] },\t\r\n\r\n\t"0x70": { "name":                          "unknown_70", "read": ["chunkedarray","unsigned short",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["intlow","unsigned short"]],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[["maybe_file","unsigned short"]]] },\r\n\t"0x77": { "name":                          "unknown_77", "read": ["tuple","unsigned short","unsigned byte"] },\r\n\t"0x78": { "name":                          "unknown_78", "read": ["tuple","unsigned short","unsigned short","unsigned short"] },\r\n\r\n\t"0xF9": { "name":                               "extra", "read": "extrasmap" }\r\n}'
},1092:e=>{"use strict"
;e.exports='["struct",\r\n\t["header","ubyte"],\r\n\t["framebase","ushort"],\r\n\t["endtime","uint"],\r\n\t["unk_always0","ubyte"],\r\n\t["tracks",["array","ushort",["struct",\r\n\t\t//seems to correlate to action type \r\n\t\t//1=standard bone(1-9) 2=unknown(7x 3, 14x 7, 14x 8), 3=unknown(10-15), 3=unknown(16)\r\n\t\t["unk_1to4","ubyte"],\r\n\t\t//boneid+0x40, or boneid+0x4040 if 2 byte//TODO is this smartShortBias?\r\n\t\t["boneid","varushort"],\r\n\t\t//animation type 1-3=rotatexyz, 4-6=translatexyz 7-9=scalexyz\r\n\t\t["type_0to9","ubyte"],\r\n\t\t["$packetlength","ushort"],\r\n\t\t//interpolation mode? 0=euler, 1=linear, 3lin/log???\r\n\t\t//0=rotation (1,2,3), 1=translation (4,5,6,13,14,15,some 16), 3=scale (7,8,9,10,11,12,some 16,some 3)\r\n\t\t["bonetype_01or3","ubyte"],\r\n\t\t["always0","ushort"],\r\n\t\t["flag2","bool"],\r\n\t\t["chunks",["array",["ref","$packetlength"],["struct",\r\n\t\t\t["time","ushort"],\r\n\t\t\t["value",["array",5,"float"]]\r\n\t\t]]]\r\n\t]]]\r\n]'
},1739:e=>{"use strict"
;e.exports='{\r\n\t"0x01": { "name":                           "model", "read": "varuint" },\r\n\t"0x02": { "name":                        "sequence", "read": "varuint" },\r\n\t"0x04": { "name":                          "scaleX", "read": "ushort" },\r\n\t"0x05": { "name":                       "scaleYorZ", "read": "ushort" },\r\n\t"0x06": { "name":                        "rotation", "read": "ushort" },\r\n\t"0x07": { "name":                         "ambient", "read": "ubyte" },\r\n\t"0x08": { "name":                        "contrast", "read": "ubyte" },\r\n\t"0x0a": { "name":                           "unk0a", "read": "true" },\r\n\t"0x28": { "name":                  "replace_colors", "read": ["array","ubyte",["tuple","ushort","ushort"]] },\r\n\t"0x29": { "name":               "replace_materials", "read": ["array","ubyte",["tuple","ushort","ushort"]] },\r\n\t"0x2c": { "name":                           "unk2c", "read": "ushort" },\r\n\t"0x2e": { "name":                           "unk2e", "read": "true" }\r\n}'
},7882:e=>{"use strict";e.exports='{\r\n\t"0xF9": { "name":              "extra", "read": "extrasmap" }\r\n}'},3537:e=>{"use strict"
;e.exports='{\r\n    "variable unsigned long":   "varuint",\r\n    "variable unsigned int":    "varuint",\r\n    "variable unsigned short":  "varushort",\r\n    "unsigned variable long":   "varuint",\r\n    "unsigned variable int":    "varuint",\r\n    "unsigned variable short":  "varushort",\r\n\r\n    "variable long":    "varint",\r\n    "variable int":     "varint",\r\n    "variable short":   "varshort",\r\n\r\n    "unsigned long":    "uint",\r\n    "unsigned int":     "uint",\r\n    "unsigned short":   "ushort",\r\n    "unsigned byte":    "ubyte",\r\n\r\n    "long":             "int",\r\n\t\r\n    "ushort le":        "ushort_le",\r\n    "uint le":          "uint_le",\r\n\r\n\t"playeritem":       ["playeritem"],\r\n\r\n\t"playeritemedit":   ["struct",\r\n\t\t["$type","ubyte"],\r\n\t\t["model",["opt",["$type",0,"bitflag"],["array",["itemvar","modelcount"],"varuint"]]],\r\n\t\t["flag2",["opt",["$type",1,"bitflag"],"true"]],\r\n\t\t["color",["opt",["$type",2,"bitflag"],["struct",\r\n\t\t\t["$coltype","ushort"],\r\n\t\t\t["col2",["opt",["$coltype",12816],["array",["itemvar","colorcount"],"ushort"]]],\r\n\t\t\t["col4",["opt",["$coltype",8719],["array",4,["tuple","ushort","ushort"]]]]\r\n\t\t]]],\r\n\t\t["material",["opt",["$type",3,"bitflag"],["struct",\r\n\t\t\t["header","ubyte"],\r\n\t\t\t["materials",["array",["itemvar","matcount"],"ushort"]]\r\n\t\t]]]\r\n\t],\r\n\r\n\t"ubyte":            "unsigned byte",\r\n\t"ushort":           "unsigned short",\r\n\t"uint":             "unsigned int",\r\n\t"varushort":        "variable unsigned short",\r\n\t"varuint":          "variable unsigned int",\r\n\t"varshort":         "variable short",\r\n\t"varint":           "variable int",\r\n\r\n    "unsigned tribyte": "utribyte",\r\n\t\r\n    "tailed unsigned short":  ["tailed varushort"],\r\n\r\n    "boolean":          "bool",\r\n\r\n    //obsolete backward compat\r\n    "true":             true,\r\n    "false":            false,\r\n    "0":                0,\r\n    "1":                1,\r\n    "-1":               -1,\r\n    "null":             null,\r\n\r\n\t"extrasmap":        [ "array","ubyte",["struct",\r\n\t\t["$type","unsigned byte"],\r\n\t\t["prop","unsigned tribyte"],\r\n\t\t["intvalue",["opt",["$type",0],"int"]],\r\n\t\t["stringvalue",["opt",["$type",1],"string"]]\r\n\t]],\r\n\r\n\t"buildnr":          ["buildnr"],//needs to be in array to get invoked as function\r\n\r\n\t"item_modelid":     ["match","buildnr",{">=670":"varuint",">=0":"ushort"}],\r\n\t"animid":           ["match","buildnr",{">=670":"varnullint",">=0":"ushort"}],\r\n\r\n\t"uivalues":         ["array","ubyte",["match","ubyte",{"0":"int","1":"string"}]],\r\n\t"uivaluesint":\t\t["array","ubyte","int"]\r\n}'
},2938:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define SHADER_TYPE_PIXEL\r\n\r\nout vec4 gl_FragColor;\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define AMBIENT_LIGHTING\r\n#define DIFFUSE_LIGHTING\r\n#define ALBEDO_LIGHTING\r\n#define SUNLIGHT_DIRECT_LIGHTING\r\n#define TEXTURE_ATLAS\r\n#define TEXTURE_FORCED_FLAG\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\n\r\nUNIFORM_BUFFER_BEGIN(Sunlight)\r\nuniform highp vec3 uInvSunDirection;\r\nuniform mediump vec3 uAmbientColour;\r\nuniform mediump vec3 uSunColour;\r\nuniform mediump float uDummy;\r\nUNIFORM_BUFFER_END\r\n#ifndef LIGHT_SCATTERING_VS_UNIFORMS\r\n#define LIGHT_SCATTERING_VS_UNIFORMS\r\nUNIFORM_BUFFER_BEGIN(SimpleScattering)\r\nuniform mediump vec3 uOutscatteringAmount;\r\nuniform mediump vec3 uInscatteringAmount;\r\nuniform mediump vec3 uScatteringTintColour;\r\nuniform highp vec4 uScatteringParameters;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\nuniform highp float uGridSize;\r\nuniform mediump vec4 uAtlasMeta;\r\nuniform sampler2D uTextureAtlas;\r\nuniform sampler2D uTextureAtlasSettings;\r\nin highp vec4 vWorldPos_ViewSpaceDepth;\r\nin vec4 vVertexAlbedo;\r\nin vec3 vWorldNormal;\r\nflat in highp vec4 vMaterialSettingsSlots1D;\r\nflat in highp vec4 vTextureScale;\r\nin vec4 vTextureWeight;\r\nflat in vec4 vMaterialProperties;\r\n#define SRGB_TEXTURES\r\n#define STANDARD_DERIVATIVES\r\n#define TEXTURE_LOD\r\n#define TEXTURE_GRAD\r\n#define TEXTURE_MIP_LIMIT\r\n#define LOOKUP_MODE_REPEAT\r\n\r\n#define TEXTURE_SETTINGS_USE_TEXEL_OFFSETS\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\nfloat getMipMapLevel(vec2 v, vec2 p)\r\n{\r\n    float d = 0.;\r\n#if defined(STANDARD_DERIVATIVES)\r\n    float L = max(dot(v, v), dot(p, p));\r\n    d = .5 * log2(L);\r\n    d = max(0., d);\r\n#endif\r\n    return d;\r\n}\r\n#if defined(DEBUG_TEXEL_DENSITY)\r\nvec3 GetTexelDensityDebugColour(vec2 v, float p, vec3 d)\r\n{\r\n    float t = length(fwidth(v) * p), s = length(fwidth(d)), L = t / s, h = uDebugTexelDensity.s, f = uDebugTexelDensity.t, o = uDebugTexelDensity.p, T = uDebugTexelDensity.q;\r\n    vec3 c;\r\n    c.s = smoothstep(f / (T + 1.), h, L);\r\n    c.t = 1. - smoothstep(0., f * (T + 1.), abs(L - f));\r\n    c.p = smoothstep(1. - (f + o * T), 1. - o, 1. - L);\r\n    c *= c;\r\n    return c;\r\n}\r\n#endif\r\n#if defined(LOOKUP_MODE_DYNAMIC) && !defined(NO_SAMPLER_WRAP)\r\nflat in mediump float vSamplerWrap;\r\n#endif\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid getTexelBias_inner(float v, highp vec2 t, highp vec3 d, highp vec3 p, highp vec3 s, vec4 c, vec2 m, vec2 g, float L, sampler2D f, out vec4 i, out vec4 h, out vec4 o)\r\n{\r\n    float T = c.s;\r\n    highp float q = c.t, l = c.p;\r\n    float P = c.q;\r\n    highp vec3 S = vec3(d.s, p.s, s.s), y = vec3(d.t, p.t, s.t), a = vec3(d.p, p.p, s.p);\r\n    const vec2 u = vec2(1.);\r\n    vec3 D = .5 / a;\r\n    highp vec2 r, C, Y;\r\n#if !defined(LOOKUP_MODE_CLAMP) && !defined(LOOKUP_MODE_REPEAT)\r\n    const float G = .5, e = .25, n = .125, E = .0625;\r\n    vec4 O = step(.5, fract(L * vec4(G, e, n, E)));\r\n#endif\r\n\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n    r = clamp(t, vec2(D.s), u - vec2(D.s));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n    r = mod(t, u);\r\n#else\r\n    const vec2 N = vec2(.5), M = vec2(2.);\r\n    vec2 x = clamp(t, vec2(D.s), u - vec2(D.s)), R = mod(t, u), A = t - M * floor(N * t), U = u - abs(u - A);\r\n    r = O.st * x + O.pq * R + (u - O.st - O.pq) * U;\r\n#endif\r\n    r = r * a.s * l;\r\n    r += vec2(S.s, y.s) * q * l;\r\n    if (v > 1.)\r\n    {\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n        C = clamp(t, vec2(D.t), u - vec2(D.t));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n        C = mod(t, u);\r\n#else\r\n        vec2 I = clamp(t, vec2(D.t), u - vec2(D.t)), K = R, B = U;\r\n        C = O.st * I + O.pq * K + (u - O.st - O.pq) * B;\r\n#endif\r\n        C = C * a.t * l;\r\n        C += vec2(S.t, y.t) * q * l;\r\n        if (v > 2.)\r\n        {\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n            Y = clamp(t, vec2(D.p), u - vec2(D.p));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n            Y = mod(t, u);\r\n#else\r\n            vec2 b = clamp(t, vec2(D.p), u - vec2(D.p)), X = R, V = U;\r\n            Y = O.st * b + O.pq * X + (u - O.st - O.pq) * V;\r\n#endif\r\n            Y = Y * a.p * l;\r\n            Y += vec2(S.p, y.p) * q * l;\r\n        }\r\n    }\r\n    h = vec4(0.);\r\n    o = vec4(0.);\r\n#if defined(TEXTURE_MIP_LIMIT)\r\n\r\n#if defined(TEXTURE_GRAD)\r\n    highp vec2 I = m * l, K = g * l, B = I * a.s, X = K * a.s;\r\n    const vec2 b = vec2(.025);\r\n    B = clamp(B, -b, b);\r\n    X = clamp(X, -b, b);\r\n    i = texture2DGrad(f, r, B, X);\r\n    if (v > 1.)\r\n    {\r\n        B = I * a.t;\r\n        X = K * a.t;\r\n        B = clamp(B, -b, b);\r\n        X = clamp(X, -b, b);\r\n        h = texture2DGrad(f, C, B, X);\r\n        if (v > 2.)\r\n            B = I * a.p, X = K * a.p, B = clamp(B, -b, b), X = clamp(X, -b, b), o = texture2DGrad(f, Y, B, X);\r\n    }\r\n#else\r\n    i = texture2D(f, r);\r\n    if (v > 1.)\r\n    {\r\n        h = texture2D(f, C);\r\n        if (v > 2.)\r\n            o = texture2D(f, Y);\r\n    }\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(TEXTURE_LOD)\r\n    vec2 V = m * a.s, W = g * a.s;\r\n    float F = getMipMapLevel(V, W);\r\n    F = min(F, P);\r\n    i = texture2DLod(f, r, F);\r\n    if (v > 1.)\r\n    {\r\n        V = m * a.t;\r\n        W = g * a.t;\r\n        F = getMipMapLevel(V, W);\r\n        F = min(F, P);\r\n        h = texture2DLod(f, C, F);\r\n        if (v > 2.)\r\n            V = m * a.p, W = g * a.p, F = getMipMapLevel(V, W), F = min(F, P), o = texture2DLod(f, Y, F);\r\n    }\r\n#else\r\n    i = texture2D(f, r);\r\n    if (v > 1.)\r\n    {\r\n        h = texture2D(f, C);\r\n        if (v > 2.)\r\n            o = texture2D(f, Y);\r\n    }\r\n#endif\r\n\r\n#endif\r\n}\r\nvoid getTexel_inner(float v, vec2 f, highp vec3 d, highp vec3 t, highp vec3 p, vec4 s, vec2 h, vec2 o, float b, sampler2D B, out vec4 D, out vec4 L, out vec4 u)\r\n{\r\n    getTexelBias_inner(v, f, d, t, p, s, h, o, b, B, D, L, u);\r\n#if defined(SRGB_TEXTURES)\r\n    if (v > 1.)\r\n        L = vec4(LinearToSRGB(L.stp), L.q);\r\n    if (v > 2.)\r\n        u = vec4(LinearToSRGB(u.stp), u.q);\r\n#else\r\n    D = vec4(SRGBToLinear(D.stp), D.q);\r\n#endif\r\n}\r\nvoid getTexel_inner(float v, vec2 f, highp vec3 d, highp vec3 t, highp vec3 p, vec4 s, float h, sampler2D o, out vec4 b, out vec4 B, out vec4 u)\r\n{\r\n    vec2 X = vec2(0.), i = vec2(0.);\r\n#if defined(STANDARD_DERIVATIVES)\r\n    X = dFdx(f);\r\n    i = dFdy(f);\r\n#endif\r\n    getTexel_inner(v, f, d, t, p, s, X, i, h, o, b, B, u);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, vec4 h, vec2 g, vec2 s, float f, sampler2D e, out vec4 c)\r\n{\r\n    vec3 t = vec3(1.), l = vec3(1.);\r\n    vec4 i = vec4(0.), p = vec4(0.);\r\n    getTexel_inner(1., v, o, t, l, h, g, s, f, e, c, i, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, vec4 h, float g, sampler2D s, out vec4 f)\r\n{\r\n    vec3 e = vec3(1.), l = vec3(1.);\r\n    vec4 t = vec4(0.), p = vec4(0.);\r\n    getTexel_inner(1., v, o, e, l, h, g, s, f, t, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, vec4 g, vec2 s, vec2 f, float e, sampler2D t, out vec4 l, out vec4 p)\r\n{\r\n    vec3 i = vec3(1.);\r\n    vec4 c = vec4(0.);\r\n    getTexel_inner(2., v, o, h, i, g, s, f, e, t, l, p, c);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, vec4 g, float s, sampler2D f, out vec4 e, out vec4 t)\r\n{\r\n    vec3 l = vec3(1.);\r\n    vec4 p = vec4(0.);\r\n    getTexel_inner(2., v, o, h, l, g, s, f, e, t, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, highp vec3 g, vec4 s, vec2 f, vec2 e, float t, sampler2D l, out vec4 p, out vec4 i, out vec4 c) { getTexel_inner(3., v, o, h, g, s, f, e, t, l, p, i, c); }\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, highp vec3 g, vec4 s, float f, sampler2D e, out vec4 t, out vec4 l, out vec4 p) { getTexel_inner(3., v, o, h, g, s, f, e, t, l, p); }\r\n\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#ifndef TEXTURE_SETTINGS_INC\r\n#define TEXTURE_SETTINGS_INC\r\nstruct TextureSettings\r\n{\r\n    highp vec3 textureMeta1;\r\n    highp vec3 textureMeta2;\r\n    highp vec2 uvAnim;\r\n    float wrapping;\r\n    float specular;\r\n    float normalScale;\r\n#if defined(REFRACTION)\r\n    vec4 refraction;\r\n#endif\r\n#if defined(VIEWPORTMAP)\r\n    vec4 viewportMapUVScaleAndAnim;\r\n#endif\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    highp float materialID;\r\n#endif\r\n};\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid getTextureSettings(vec2 s, out TextureSettings v)\r\n{\r\n    const highp float d = 1. / 255., S = 1. / 65535., e = 32767., t = 1. / 32767.;\r\n    const float f = 1. / MATERIAL_SETTINGS_TEXTURE_RESOLUTION;\r\n    vec2 i = (floor(s + .5) * vec2(MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X, MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y) + .5) * f;\r\n    const float u = f;\r\n    vec4 T = texture2DLodCompat(uTextureAtlasSettings, i, 0.), U, n, D, m, a, R;\r\n    float h;\r\n    vec4 r;\r\n#if defined(TEXTURE_SETTINGS_USE_TEXEL_OFFSETS)\r\n\r\n#define SAMPLE_OFFSET_SLOTSIZES_AND_WRAPPING ivec2(2, 0)\r\n\r\n#define SAMPLE_OFFSET_UV_ANIM ivec2(0, 1)\r\n\r\n#define SAMPLE_OFFSET_SPECULAR_NORMAL_SCALE ivec2(1, 1)\r\n\r\n#define SAMPLE_OFFSET_REFRACTION ivec2(0, 2)\r\n\r\n#define SAMPLE_OFFSET_SLOTETC ivec2(1, 2)\r\n\r\n#define SAMPLE_OFFSET_VIEWPORTMAP_UVSCALE ivec2(2, 2)\r\n\r\n#define SAMPLE_OFFSET_VIEWPORTMAP_UVANIMATION ivec2(0, 3)\r\n\r\n#define SAMPLE_OFFSET_DEBUG ivec2(2, 3)\r\n    U = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SLOTSIZES_AND_WRAPPING);\r\n    n = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_UV_ANIM);\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    D = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SPECULAR_NORMAL_SCALE);\r\n#endif\r\n\r\n#if defined(REFRACTION)\r\n    m = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_REFRACTION);\r\n#endif\r\n    h = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SLOTETC).q;\r\n#if defined(VIEWPORTMAP)\r\n    a = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_VIEWPORTMAP_UVSCALE);\r\n    R = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_VIEWPORTMAP_UVANIMATION);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    r = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_DEBUG);\r\n#endif\r\n\r\n#else\r\n    vec2 g = vec2(u * 2., 0.), o = vec2(0., u), M = vec2(u, u), p = vec2(0., u * 2.), X = vec2(u, u * 2.), q = vec2(u * 2., u * 2.), E = vec2(0., u * 3.), A = vec2(u * 2., u * 3.);\r\n    U = texture2DLodCompat(uTextureAtlasSettings, i + g, 0.);\r\n    n = texture2DLodCompat(uTextureAtlasSettings, i + o, 0.);\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    D = texture2DLodCompat(uTextureAtlasSettings, i + M, 0.);\r\n#endif\r\n\r\n#if defined(REFRACTION)\r\n    m = texture2DLodCompat(uTextureAtlasSettings, i + p, 0.);\r\n#endif\r\n    h = texture2DLodCompat(uTextureAtlasSettings, i + X, 0.).q;\r\n#if defined(VIEWPORTMAP)\r\n    a = texture2DLodCompat(uTextureAtlasSettings, i + q, 0.);\r\n    R = texture2DLodCompat(uTextureAtlasSettings, i + E, 0.);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    r = texture2DLodCompat(uTextureAtlasSettings, i + A, 0.);\r\n#endif\r\n\r\n#endif\r\n    T = floor(T * 255. + .5);\r\n    U = floor(U * 255. + .5);\r\n    h = floor(h * 255. + .5);\r\n    const float V = .5, c = .25, L = .125, P = .0625;\r\n    vec4 N = step(.5, fract(h * vec4(V, c, L, P)));\r\n    T += vec4(256.) * N;\r\n    vec2 w = U.st * uAtlasMeta.t;\r\n    v.textureMeta1 = vec3(T.st, w.s);\r\n    v.textureMeta2 = vec3(T.pq, w.t);\r\n    v.wrapping = U.q;\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    v.specular = UnpackVec2ToFloat(D.st) * d;\r\n    v.normalScale = UnpackVec2ToFloat(D.pq) * d;\r\n    v.normalScale = v.normalScale * .1 - 8.;\r\n#else\r\n    v.specular = 0.;\r\n    v.normalScale = 0.;\r\n#endif\r\n    highp vec2 G = vec2(UnpackVec2ToFloat(n.st), UnpackVec2ToFloat(n.pq)) - e;\r\n    G *= step(1.5, abs(G));\r\n    v.uvAnim = G * t * 2.;\r\n#if defined(REFRACTION)\r\n    v.refraction = m;\r\n    v.refraction.t = v.refraction.t * 2. + 1.;\r\n    v.refraction.p = UnpackVec2ToFloat(v.refraction.pq) * S * 10.;\r\n#endif\r\n\r\n#if defined(VIEWPORTMAP)\r\n    highp vec2 C = vec2(UnpackVec2ToFloat(a.st), UnpackVec2ToFloat(a.pq)) - e, Y = vec2(UnpackVec2ToFloat(R.st), UnpackVec2ToFloat(R.pq)) - e;\r\n    C *= step(1.5, abs(C));\r\n    Y *= step(1.5, abs(Y));\r\n    v.viewportMapUVScaleAndAnim = vec4(C * t * 2., Y * t * 2.);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    v.materialID = UnpackVec2ToFloat(r.st);\r\n#endif\r\n}\r\nvoid getTextureSettings1D(float v, out TextureSettings i)\r\n{\r\n    const float d = 1. / MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X;\r\n    float S = floor((v + .5) * d), u = v - S * MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X;\r\n    getTextureSettings(vec2(u, S), i);\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n#ifndef DISTANCE_FOG_UNIFORMS\r\n#define DISTANCE_FOG_UNIFORMS\r\n#if defined(FOG_DISTANCE)\r\nUNIFORM_BUFFER_BEGIN(DistanceFog)\r\nuniform mediump vec4 uFogColour;\r\nuniform highp vec4 uFogParams;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_FUNCTIONS\r\n#define DISTANCE_FOG_FUNCTIONS\r\n#if defined(FOG_DISTANCE)\r\nfloat FogBasedOnDistance(highp float f)\r\n{\r\n    highp float F = (uFogParams.t - f) * uFogParams.s;\r\n    return 1. - clamp(F, 0., 1.);\r\n}\r\nfloat FogBasedOnAngle(highp vec3 f)\r\n{\r\n    highp float F = 1. - clamp(f.t + uFogParams.q, 0., 1.);\r\n    F = pow(F, uFogParams.p);\r\n    return clamp(F, 0., 1.);\r\n}\r\n#endif\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS)\r\nvoid ComputeTangentBitangentFromDerivatives(inout vec3 v, inout vec3 p, highp vec3 h, highp vec3 d, highp vec3 A, highp vec2 r, highp vec2 S)\r\n{\r\n    highp vec3 q = cross(h, d), c = cross(A, h), n = c * r.s + q * S.s, s = c * r.t + q * S.t;\r\n    highp float D = dot(n, n), a = dot(s, s), i = max(D, a), t = inversesqrt(i);\r\n    n *= t;\r\n    s *= t;\r\n    if (isNaN(D + a) || i <= 0.)\r\n        n = s = h;\r\n    v = n;\r\n    p = s;\r\n}\r\nvec3 ComputeBitangent(vec3 v, vec4 h)\r\n{\r\n    highp vec3 p = cross(v, h.stp);\r\n    p *= h.q;\r\n    return p;\r\n}\r\nvec3 ApplyNormalMap(highp vec3 v, highp vec3 h, highp vec3 d, highp vec3 A, highp vec2 p, highp vec2 S)\r\n{\r\n    highp vec3 D, s;\r\n    ComputeTangentBitangentFromDerivatives(D, s, h, d, A, p, S);\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = normalize(D) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = normalize(s) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 r = v.s * D + v.t * s + v.p * h;\r\n    r = normalize(r);\r\n    return abs(r.s) + abs(r.t) + abs(r.p) < .5 ? h : r;\r\n}\r\nvec3 ApplyNormalMap(vec3 v, vec3 A, vec3 s, vec3 S)\r\n{\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = s * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = S * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 p = v.s * s + v.t * S + v.p * A;\r\n    p = normalize(p);\r\n    return p;\r\n}\r\nvec3 ApplyNormalMap(vec3 v, vec3 h, vec4 r)\r\n{\r\n    vec3 p = ComputeBitangent(h, r);\r\n    return ApplyNormalMap(v, h, r.stp, p);\r\n}\r\nvec3 ApplyNormalMapTerrain(vec3 v, highp vec3 h, highp vec3 r, highp vec3 S)\r\n{\r\n    highp vec3 p = cross(h, r), s = cross(S, h), D = s * r.s + p * S.s, n = s * r.p + p * S.p;\r\n    highp float A = inversesqrt(max(dot(D, D), dot(n, n)));\r\n    D *= A;\r\n    n *= A;\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = normalize(D) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = normalize(n) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 d = v.s * D + v.t * n + v.p * h;\r\n    d = normalize(d);\r\n    return isNaN(d.s) ? h : d;\r\n}\r\nvec3 ApplyNormalMapTerrain(vec3 v, vec3 h)\r\n{\r\n    const vec3 p = vec3(0., 0., 1.);\r\n    vec3 D = cross(p, h), s = cross(D, h);\r\n    return ApplyNormalMap(v, h, D, s);\r\n}\r\n\r\nvec3 UnpackCompressedNormal(vec3 U)\r\n{\r\n    vec3 v = vec3(U.ps * 255. / 127. - 1.00787, 0.);\r\n    v.p = sqrt(1. - min(1., dot(v.st, v.st)));\r\n    v.t = -v.t;\r\n    return v;\r\n}\r\nvec3 UnpackNormal(vec3 v, float U)\r\n{\r\n    vec3 t;\r\n#if defined(COMPRESSED_NORMALS)\r\n    t = UnpackCompressedNormal(v);\r\n#else\r\n    t = v.pst * 255. / 127. - 1.00787;\r\n    t.t = -t.t;\r\n#endif\r\n    t.st *= U;\r\n    return t;\r\n}\r\nvec3 UnpackNormal(vec3 U) { return UnpackNormal(U, 1.); }\r\nvec3 UnpackNormal(vec4 v) { return UnpackNormal(v.tpq, 1.); }\r\nvec3 UnpackNormal(vec4 v, float U) { return UnpackNormal(v.tpq, U); }\r\n\r\n#if defined(VIEWPORTMAP)\r\nvec3 SampleViewportMapColour(highp vec2 v, highp vec4 e)\r\n{\r\n    v = v * uViewportLookupScale.st;\r\n    vec2 t;\r\n#if defined(OGLES2_BACKEND)\r\n    t = uViewportMapTextureSize.st;\r\n#else\r\n    t = vec2(textureSize(uViewportMap, 0));\r\n#endif\r\n    v.s *= uViewportLookupScale.p * uViewportLookupScale.t / (t.s / t.t);\r\n    v *= e.st;\r\n    highp float u = uTextureAnimationTime;\r\n    v += e.pq * u;\r\n    return texture2DLodCompat(uViewportMap, v, 0.).stp;\r\n}\r\n#endif\r\n\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS)\r\nvoid SampleTerrainTextures(out vec4 t, out vec2 d, out float p, inout vec3 s, highp vec3 v, highp vec3 u, vec4 a, vec4 r, inout float g)\r\n{\r\n    TextureSettings S;\r\n    getTextureSettings1D(vMaterialSettingsSlots1D[0], S);\r\n    TextureSettings m;\r\n    getTextureSettings1D(vMaterialSettingsSlots1D[1], m);\r\n    TextureSettings e;\r\n    getTextureSettings1D(vMaterialSettingsSlots1D[2], e);\r\n    highp vec3 D = vTextureScale.stp, i = 8. / (D * uGridSize);\r\n    highp vec2 T = v.sp * i[0], h = v.sp * i[1], o = v.sp * i[2];\r\n#if defined(DEBUG_TEXEL_DENSITY)\r\n    gl_FragColor = vec4(0., 0., 0., 1.);\r\n    gl_FragColor.stp += GetTexelDensityDebugColour(T, S.textureMeta1.p, u) * vTextureWeight.s;\r\n    gl_FragColor.stp += GetTexelDensityDebugColour(h, m.textureMeta1.p, u) * vTextureWeight.t;\r\n    gl_FragColor.stp += GetTexelDensityDebugColour(o, e.textureMeta1.p, u) * vTextureWeight.p;\r\n#endif\r\n    T = mod(T, 1.);\r\n    h = mod(h, 1.);\r\n    o = mod(o, 1.);\r\n    highp vec3 f = vec3(0.), G = vec3(0.);\r\n#if defined(STANDARD_DERIVATIVES) && (defined(TEXTURE_LOD) || defined(NORMAL_MAP))\r\n    f = dFdx(u);\r\n    G = dFdy(u);\r\n#endif\r\n    vec2 q = f.sp * i[0], l = G.sp * i[0], n = f.sp * i[1], c = G.sp * i[1], x = f.sp * i[2], M = G.sp * i[2];\r\n    vec3 P = mod(r.stp, vec3(16.)) - vec3(.25),\r\n         A = (r.stp - vec3(.25) - P) / vec3(255.);\r\n    P *= vec3(1. / 15.);\r\n    vec4 E = vec4(vec3(.580392), a.q),\r\n         H = mix(a, E, A.s) * (1. + P.s),\r\n         N = mix(a, E, A.t) * (1. + P.t),\r\n         U = mix(a, E, A.p) * (1. + P.p);\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    H.stp = SRGBToLinear(H.stp);\r\n    N.stp = SRGBToLinear(N.stp);\r\n    U.stp = SRGBToLinear(U.stp);\r\n#endif\r\n    vec4 C, V, Y;\r\n#if defined(HDR_SCALE) || defined(NORMAL_MAP)\r\n    vec4 R, W, L;\r\n#if defined(COMPRESSED_NORMALS)\r\n    R = vec4(0., .5, 0., .5);\r\n    W = vec4(0., .5, 0., .5);\r\n    L = vec4(0., .5, 0., .5);\r\n#else\r\n    R = vec4(0., .5, 1., .5);\r\n    W = vec4(0., .5, 1., .5);\r\n    L = vec4(0., .5, 1., .5);\r\n#endif\r\n    getTexel(T, S.textureMeta1, S.textureMeta2, uAtlasMeta, q, l, 0., uTextureAtlas, C, R);\r\n    getTexel(h, m.textureMeta1, m.textureMeta2, uAtlasMeta, n, c, 0., uTextureAtlas, V, W);\r\n    getTexel(o, e.textureMeta1, e.textureMeta2, uAtlasMeta, x, M, 0., uTextureAtlas, Y, L);\r\n#if defined(ETC_CHANNEL_SWIZZLE)\r\n    R = R.qtps;\r\n    W = W.qtps;\r\n    L = L.qtps;\r\n#endif\r\n\r\n#if defined(HDR_SCALE)\r\n    C = HDRScale(C, R.s);\r\n    V = HDRScale(V, W.s);\r\n    Y = HDRScale(Y, L.s);\r\n#endif\r\n\r\n#if defined(NORMAL_MAP)\r\n    vec3 I = UnpackNormal(R, S.normalScale), F = UnpackNormal(W, m.normalScale), O = UnpackNormal(L, e.normalScale), w = I * vTextureWeight.s + F * vTextureWeight.t + O * vTextureWeight.p;\r\n#if defined(PER_FRAGMENT_TANGENTS)\r\n    s = ApplyNormalMapTerrain(w, s, f, G);\r\n#else\r\n    s = ApplyNormalMapTerrain(w, s);\r\n#endif\r\n\r\n#endif\r\n\r\n#else\r\n    getTexel(T, S.textureMeta1, uAtlasMeta, q, l, 0., uTextureAtlas, C);\r\n    getTexel(h, m.textureMeta1, uAtlasMeta, n, c, 0., uTextureAtlas, V);\r\n    getTexel(o, e.textureMeta1, uAtlasMeta, x, M, 0., uTextureAtlas, Y);\r\n#endif\r\n    C *= H;\r\n    V *= N;\r\n    Y *= U;\r\n#if defined(VIEWPORTMAP)\r\n    float y = step(.001, S.viewportMapUVScaleAndAnim.s), b = step(.001, m.viewportMapUVScaleAndAnim.s), B = step(.001, e.viewportMapUVScaleAndAnim.s);\r\n    C.stp = mix(C.stp, SampleViewportMapColour(gl_FragCoord.st, S.viewportMapUVScaleAndAnim), y);\r\n    V.stp = mix(V.stp, SampleViewportMapColour(gl_FragCoord.st, m.viewportMapUVScaleAndAnim), b);\r\n    Y.stp = mix(Y.stp, SampleViewportMapColour(gl_FragCoord.st, e.viewportMapUVScaleAndAnim), B);\r\n    g = mix(g, 1., y * vTextureWeight.s + b * vTextureWeight.t + B * vTextureWeight.p);\r\n#endif\r\n\r\n#if defined(TEXTURE_FORCED_FLAG)\r\n    C = mix(H, sqrt(C), A.s);\r\n    V = mix(N, sqrt(V), A.t);\r\n    Y = mix(U, sqrt(Y), A.p);\r\n#endif\r\n    t = C * vTextureWeight.s + V * vTextureWeight.t + Y * vTextureWeight.p;\r\n    t.q = 1.;\r\n    vec3 X = step(vec3(.5), fract(r.q * vec3(.25, .125, .0625))), k = vec3(C.q, V.q, Y.q) * vTextureWeight.stp, Z = k * X;\r\n    d.s = Z.s + Z.t + Z.p;\r\n    d.t = max(S.specular, max(m.specular, e.specular));\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    p = (S.materialID == uDebugMaterialHighlight ? 1 : 0) * vTextureWeight.s + (m.materialID == uDebugMaterialHighlight ? 1 : 0) * vTextureWeight.t + (e.materialID == uDebugMaterialHighlight ? 1 : 0) * vTextureWeight.p;\r\n#else\r\n    p = 0.;\r\n#endif\r\n}\r\n#endif\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\nconst highp float CAUSTICS_FIXED_POINT_SCALE = 10000.;\r\n#if defined(CAUSTICS) && !defined(CAUSTICS_COMPUTE) && !defined(CAUSTICS_STENCIL)\r\nfloat CalculateCausticsTerm(highp vec3 u, float t, vec3 e)\r\n{\r\n    float i = 0., s = 0.;\r\n    if (u.t <= uCausticsPlaneHeight)\r\n        s = step(1., t);\r\n    else\r\n    {\r\n#if defined(CAUSTICS_OVERWATER)\r\n        s = clamp(e.t * -1., 0., 1.);\r\n        float d = smoothstep(uCausticsOverWaterFade.s, uCausticsOverWaterFade.t, u.t - uCausticsPlaneHeight);\r\n        s *= 1. - d;\r\n#else\r\n        return 0.0;\r\n#endif\r\n    }\r\n    if (s > 0.)\r\n    {\r\n        highp vec4 C = uCausticsViewProjMatrix * vec4(u, 1.);\r\n        C.st /= 2. * C.q;\r\n        vec2 f = abs(C.st);\r\n        C.st += .5;\r\n        f = smoothstep(.4, .5, f);\r\n        s *= max(0., 1. - (f.s + f.t));\r\n        if (s > 0.)\r\n            i += textureOffset(uCausticsMap, C.st, ivec2(-1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(0, -1)).s, i += texture2D(uCausticsMap, C.st).s * 5., i += textureOffset(uCausticsMap, C.st, ivec2(0, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 1)).s, i *= s / 12.;\r\n    }\r\n    return i;\r\n}\r\n#endif\r\n#if defined(CAUSTICS_COMPUTE)\r\nvoid WriteCausticsRay(vec3 t, float i)\r\n{\r\n    vec2 s = t.sp * i * uCausticsRefractionScale, C = (gl_FragCoord.st + s * 2.) / uCausticsComputeResolution * uCausticsMapSize;\r\n    highp float u = min(uCausticsFade.s / i * uCausticsFade.t, 7. * uCausticsFade.t), f = smoothstep(uCausticsFade.p, uCausticsFade.q, i), E = f * u * CAUSTICS_FIXED_POINT_SCALE;\r\n    if (E >= 1.f)\r\n        imageAtomicAdd(uCausticsIntegerMap, ivec2(C.st), uint(E));\r\n}\r\n#endif\r\n\r\n#ifndef LIGHTING_UTILS_H\r\n#define LIGHTING_UTILS_H\r\n#ifndef LIGHTING_INC\r\n#define LIGHTING_INC\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\n\r\nstruct LightingTerms\r\n{\r\n    vec3 Diffuse;\r\n    vec3 Specular;\r\n};\r\nvoid ClearLightingTerms(inout LightingTerms v) { v.Diffuse = vec3(0., 0., 0.), v.Specular = vec3(0., 0., 0.); }\r\nvoid AddLightingTerms(inout LightingTerms v, LightingTerms L) { v.Diffuse += L.Diffuse, v.Specular += L.Specular; }\r\nvoid EvaluateDirLightRT5(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, float S, float c, float F, float e, float E, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 G = normalize(d + i);\r\n    float r = FresnelSchlick(S, clamp(dot(i, G), 0., 1.), F);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(G, f, L, i, d, E, c, .5, .5);\r\n#else\r\n    vec3 n = vec3(r) * vec3(RunescapeRT5BRDF(G, f, c));\r\n#endif\r\n    n *= A * e;\r\n    v.Specular += n;\r\n#endif\r\n}\r\nvoid EvaluateDirLightRT7(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, vec3 S, float c, float E, float G, float e, float F, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 r = normalize(d + i), n = FresnelSchlick(S, clamp(dot(i, r), 0., 1.), G);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(r, f, L, i, d, F, c, .5, .5);\r\n#else\r\n    vec3 C = CookTorranceBRDF(c, E, n, f, r, d, i, F);\r\n#endif\r\n    C *= A * e;\r\n    v.Specular += C;\r\n#endif\r\n}\r\nfloat SpecularHorizonOcclusion(float L, vec3 i, vec3 v)\r\n{\r\n    vec3 d = reflect(i, v);\r\n    float A = clamp(1. + L * dot(d, v), 0., 1.);\r\n    A *= A;\r\n    return A;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT5(inout int i, inout float E, highp vec4 v, vec3 u, vec3 f, float d, vec3 n, float p, float S, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n    {\r\n        if (L > 0.)\r\n        {\r\n            highp vec4 h = uSunlightViewMatrix * v, e = vec4(u.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(i, v + e, h + e, d, uSunlightShadowMap, uSunlightShadowTranslucencyMap, r);\r\n        }\r\n    }\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, f, n, uInvSunDirection, h, p, 5., L, t, uSunColour);\r\n    return D;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT5(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, float n, float S)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, v, f, uInvSunDirection, h, n, 5., L, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT7(inout int u, inout float E, highp vec4 v, vec3 f, vec3 d, float n, vec3 h, vec3 L, float p, float i, float t, float S)\r\n{\r\n    float D = max(0., dot(f, uInvSunDirection)), e = D;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n    {\r\n        if (D > 0.)\r\n        {\r\n            highp vec4 r = uSunlightViewMatrix * v, a = vec4(f.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(u, v + a, r + a, n, uSunlightShadowMap, uSunlightShadowTranslucencyMap, S);\r\n        }\r\n    }\r\n#endif\r\n    e *= E;\r\n    LightingTerms r;\r\n    ClearLightingTerms(r);\r\n    EvaluateDirLightRT7(r, f, d, h, uInvSunDirection, L, p, i, t, e, D, uSunColour);\r\n    return r;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT7(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, vec3 n, float h, float L, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), p = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT7(D, u, v, f, uInvSunDirection, n, h, L, r, t, p, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef STIPPLE_TRANSPARENCY_UTILS_INC\r\n#define STIPPLE_TRANSPARENCY_UTILS_INC\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR) || defined(STIPPLE_TRANSPARENCY_CLIP_FAR) || defined(STIPPLE_TRANSPARENCY_ALPHA)\r\n#ifndef STIPPLE_COMMON_INC\r\n#define STIPPLE_COMMON_INC\r\nhighp float GetStippleViewSpaceDepthFromPos(vec3 S)\r\n{\r\n    vec3 u = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    return dot(S, u);\r\n}\r\n#endif\r\n\r\n#ifndef NOISE_UTILS_INC\r\n#define NOISE_UTILS_INC\r\nvec4 permute(vec4 t)\r\n{\r\n    return mod((t * 34. + 1.) * t, 289.);\r\n}\r\nvec2 fade(vec2 t) { return t * t * t * (t * (t * 6. - 15.) + 10.); }\r\nfloat cnoise(highp vec2 t)\r\n{\r\n    highp vec4 v = floor(t.stst) + vec4(0., 0., 1., 1.), d = fract(t.stst) - vec4(0., 0., 1., 1.);\r\n    v = mod(v, 289.);\r\n    vec4 p = v.spsp, s = v.ttqq, h = d.spsp, e = d.ttqq, f = permute(permute(p) + s), m = 2. * fract(f * .0243902) - 1., c = abs(m) - .5, q = floor(m + .5);\r\n    m = m - q;\r\n    vec2 N = vec2(m.s, c.s), r = vec2(m.t, c.t), o = vec2(m.p, c.p), a = vec2(m.q, c.q);\r\n    vec4 G = 1.79284 - .853735 * vec4(dot(N, N), dot(o, o), dot(r, r), dot(a, a));\r\n    N *= G.s;\r\n    o *= G.t;\r\n    r *= G.p;\r\n    a *= G.q;\r\n    float i = dot(N, vec2(h.s, e.s)), n = dot(r, vec2(h.t, e.t)), l = dot(o, vec2(h.p, e.p)), I = dot(a, vec2(h.q, e.q));\r\n    vec2 u = fade(d.st), S = mix(vec2(i, l), vec2(n, I), u.s);\r\n    float g = mix(S.s, S.t, u.t);\r\n    return 2.3 * g;\r\n}\r\nhighp float GetInterleavedGradientNoise(highp vec2 t) { return clamp(fract(52.9829 * fract(.0671106 * t.s + .00583715 * t.t)), 0., .999); }\r\n#endif\r\n\r\n#define STIPPLE_TRANSPARENCY_ENABLED\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR) || defined(STIPPLE_TRANSPARENCY_CLIP_FAR)\r\nuniform vec4 uStippleTransparencyClipParams;\r\n#endif\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nfloat GetStippleTransparencyAlpha(float S, inout float R)\r\n{\r\n    float f = 1.;\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR)\r\n    float d = (S - (uZBufferParams.q + uStippleTransparencyClipParams.s)) * uStippleTransparencyClipParams.t;\r\n    f *= clamp(d, 0., 1.);\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_FAR)\r\n    float u = 1. - (S - (abs(uZBufferParams.p) - uStippleTransparencyClipParams.p)) * uStippleTransparencyClipParams.q;\r\n    f *= clamp(u, 0., 1.);\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_ALPHA)\r\n    f *= clamp(R + .005, 0., 1.);\r\n    R = 1.;\r\n#endif\r\n    return f;\r\n}\r\nbool IsStipplePixelVisible(highp vec3 S, highp vec2 R, inout float d)\r\n{\r\n    float u = GetStippleViewSpaceDepthFromPos(S);\r\n    return GetStippleTransparencyAlpha(u, d) > GetInterleavedGradientNoise(R);\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    highp vec3 d = vWorldPos_ViewSpaceDepth.stp;\r\n#if defined(CLIP_PLANE)\r\n    if (dot(vec4(d, 1.), uClipPlane) < 0.)\r\n    {\r\n        discard;\r\n        return;\r\n    }\r\n#if defined(CLIP_PLANE_CLAMP)\r\n    gl_FragDepth = 0.;\r\n    return;\r\n#endif\r\n\r\n#endif\r\n    vec3 v = normalize(vWorldNormal.stp);\r\n    highp vec3 S = d - uCameraPosition;\r\n    float D = step(.5, fract(vMaterialProperties.q * .5)), p;\r\n    vec4 u = vec4(0., 0., 0., 1.);\r\n    vec2 r = vec2(0.);\r\n#if defined(TEXTURE_ATLAS)\r\n    SampleTerrainTextures(u, r, p, v, d, S, vVertexAlbedo, vMaterialProperties, D);\r\n#else\r\n\r\n#if defined(DEBUG_TEXEL_DENSITY)\r\n    gl_FragColor = vec4(1.);\r\n#endif\r\n    u = vVertexAlbedo;\r\n#endif\r\n\r\n#if defined(DEBUG_TERRAIN_SPECULAR_MAX)\r\n    if (uDebugTerrainSpecular.s >= 0.)\r\n        r.t = max(r.t, uDebugTerrainSpecular.s);\r\n    if (uDebugTerrainSpecular.t >= 0.)\r\n        r.t = uDebugTerrainSpecular.t;\r\n#endif\r\n\r\n#if defined(DEBUG_TEXEL_DENSITY) || defined(DEBUG_TANGENTS) || defined(DEBUG_BITANGENTS)\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_ENABLED)\r\n    if (!IsStipplePixelVisible(S, gl_FragCoord.st, u.q))\r\n    {\r\n        discard;\r\n    }\r\n#endif\r\n    float n = 1.;\r\n#if defined(TEXTURE_ATLAS)\r\n    n += r.s * 4.;\r\n#endif\r\n\r\n#if defined(VIEWPORTLOOKUPSCALE)\r\n    vec2 G = gl_FragCoord.st * uFullScreenLookupScale.st;\r\n#endif\r\n    float g = 1.;\r\n#if defined(SSAO)\r\n    g = texture2D(uSSAOMap, G).s;\r\n#endif\r\n    vec3 m;\r\n#if defined(IRRADIANCE_LIGHTING)\r\n\r\n#if defined(NORMAL_MAP)\r\n    m = uAmbientColour * EvaluateSHLighting2ndOrder(v, uIrradianceSHCoefs);\r\n#else\r\n    m = vAmbientColour;\r\n#endif\r\n\r\n#else\r\n    m = uAmbientColour;\r\n#endif\r\n\r\n#if defined(SSAO)\r\n    m *= g;\r\n#endif\r\n    highp float t = length(S);\r\n    highp vec3 T = S / t;\r\n    LightingTerms s;\r\n    ClearLightingTerms(s);\r\n#if defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    int A = -1;\r\n    float C = 0.;\r\n#if defined(DEFERRED_SHADOWS)\r\n    s = EvaluateSunlightRT5(C, v, v, -T, G, r.t, D);\r\n#else\r\n    s = EvaluateSunlightRT5(A, C, vec4(d, 1.), v, v, vWorldPos_ViewSpaceDepth.q, -T, r.t, D, 1.);\r\n#endif\r\n\r\n#else\r\n    s.Diffuse = vec3(1.);\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    if (uDebugMaterialHighlight != -1.)\r\n    {\r\n        float e = mix(.1, 1., length(s.Diffuse)), P = .1;\r\n        vec3 q = mix(vec3(P) * e, vec3(0, 1, 0), p);\r\n        gl_FragColor = vec4(q, 1);\r\n        if (uDebugReturn != 0.)\r\n        {\r\n            return;\r\n        }\r\n    }\r\n#endif\r\n    vec4 i = vec4(0., 0., 0., u.q);\r\n#if defined(POINT_LIGHTING)\r\n    vec3 e = vec3(0., 0., 0.), q = vec3(0., 0., 0.);\r\n    const vec3 f = vec3(.65, .65, .65);\r\n    const float P = 1., l = 5.;\r\n    EvaluatePointLights(e, q, f, r.t, P, l, -T, d, v, vWorldPos_ViewSpaceDepth.q, vec3(0.));\r\n#if defined(DEBUG_POINTLIGHTS)\r\n    gl_FragColor = vec4(e, i.q);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DEBUG_POINTLIGHTS_SPECULAR)\r\n    gl_FragColor = vec4(q, i.q);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DIFFUSE_LIGHTING)\r\n    s.Diffuse += e;\r\n#else\r\n    s.Diffuse = e;\r\n#endif\r\n\r\n#if defined(POINT_LIGHTING_SPECULAR)\r\n    s.Specular += q;\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(DEBUG_POINTLIGHTS)\r\n    gl_FragColor = vec4(0., 0., 0., 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DEBUG_POINTLIGHTS_SPECULAR)\r\n    gl_FragColor = vec4(0., 0., 0., 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if !defined(DIFFUSE_LIGHTING)\r\n    s.Diffuse = vec3(0.);\r\n#endif\r\n\r\n#endif\r\n    float h = 0.;\r\n#if defined(CAUSTICS)\r\n    h = CalculateCausticsTerm(d, C, v);\r\n#endif\r\n\r\n#if defined(AMBIENT_LIGHTING)\r\n    i.stp += m;\r\n#endif\r\n    i.stp += s.Diffuse;\r\n#if defined(SPECULAR_LIGHTING)\r\n    i.stp += s.Specular * n;\r\n#endif\r\n\r\n#if defined(CAUSTICS)\r\n    i.stp += uSunColour * h;\r\n#endif\r\n\r\n#if defined(ALBEDO_LIGHTING)\r\n    i.stp *= u.stp;\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && defined(SUNLIGHT_SHADOWS)\r\n\r\n#if defined(DEBUG_EMISSIVE_MAP)\r\n    i.stp = vec3(D);\r\n#endif\r\n\r\n#elif defined(DEBUG_EMISSIVE_MAP)\r\n    i.stp = vec3(0.);\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && !defined(DEBUG_EMISSIVE_MAP)\r\n    i.stp = mix(i.stp, u.stp, D);\r\n#endif\r\n\r\n#if defined(FOG_DISTANCE) || (defined(SUNLIGHT_DIRECT_LIGHTING) && defined(LIGHT_SCATTERING))\r\n\r\n#if defined(OGLES2_BACKEND)\r\n    vec3 c, E;\r\n#if defined(LIGHT_SCATTERING)\r\n    ComputeInOutScattering(T, t, uInvSunDirection, c, E);\r\n#else\r\n    c = vec3(1.);\r\n    E = vec3(0.);\r\n#endif\r\n\r\n#if defined(FOG_DISTANCE)\r\n    float R = FogBasedOnDistance(t) * FogBasedOnAngle(T);\r\n    E = mix(E, uFogColour.stp, R);\r\n    c *= 1. - R;\r\n#endif\r\n    i.stp = mix(ApplyInOutScattering(i.stp, c, E), i.stp, D);\r\n#else\r\n    i.stp = mix(ApplyInOutScattering(i.stp, vOutScattering, vInScattering), i.stp, D);\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(DEBUG_ALBEDO)\r\n    i = u;\r\n#endif\r\n\r\n#if defined(DEBUG_NORMALS)\r\n    i.stp = v * .5 + .5;\r\n    i.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_SPECULAR_MAP)\r\n\r\n#if defined(TEXTURE_ATLAS)\r\n    i.stp = vec3(max(0., (n - .5) / 4.));\r\n#else\r\n    i.stp = vec3(0.);\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEBUG_SUNLIGHT_SHADOW_CASCADE) && !defined(DEFERRED_SHADOWS)\r\n    i.stp *= ShadowMapCascadeColour(A, int(uMappingParams.q)).stp;\r\n#endif\r\n\r\n#if defined(DEBUG_RT7_EMISSIVE) || defined(DEBUG_RT7_METALNESS) || defined(DEBUG_RT7_ROUGHNESS)\r\n    i = vec4(1., 0., 1., 1.);\r\n#endif\r\n    gl_FragColor = i;\r\n}\r\n"
},5857:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define SUNLIGHT_DIRECT_LIGHTING\r\n#define TEXTURE_ATLAS\r\n#define VIEW_TRANSFORMS\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nattribute vec3 aVertexPosition;\r\nattribute vec4 aVertexNormal_FogProportion;\r\nattribute vec4 aMaterialSettingsSlotXY_MaterialSettingsSlotXY2;\r\nattribute vec2 aMaterialSettingsSlotXY3;\r\nattribute vec4 aTextureScale;\r\nattribute vec4 aVertexColour;\r\nattribute vec4 aTextureWeight;\r\nattribute vec4 aMaterialProperties;\r\nuniform mat4 uModelMatrix;\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\nuniform mediump vec4 uAtlasMeta;\r\nuniform float uFade;\r\nout highp vec4 vWorldPos_ViewSpaceDepth;\r\nout vec4 vVertexAlbedo;\r\nout vec3 vWorldNormal;\r\nflat out highp vec4 vMaterialSettingsSlots1D;\r\nflat out highp vec4 vTextureScale;\r\nout vec4 vTextureWeight;\r\nflat out vec4 vMaterialProperties;\r\n#ifndef DISTANCE_FOG_UNIFORMS\r\n#define DISTANCE_FOG_UNIFORMS\r\n#if defined(FOG_DISTANCE)\r\nUNIFORM_BUFFER_BEGIN(DistanceFog)\r\nuniform mediump vec4 uFogColour;\r\nuniform highp vec4 uFogParams;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_FUNCTIONS\r\n#define DISTANCE_FOG_FUNCTIONS\r\n#if defined(FOG_DISTANCE)\r\nfloat FogBasedOnDistance(highp float f)\r\n{\r\n    highp float F = (uFogParams.t - f) * uFogParams.s;\r\n    return 1. - clamp(F, 0., 1.);\r\n}\r\nfloat FogBasedOnAngle(highp vec3 f)\r\n{\r\n    highp float F = 1. - clamp(f.t + uFogParams.q, 0., 1.);\r\n    F = pow(F, uFogParams.p);\r\n    return clamp(F, 0., 1.);\r\n}\r\n#endif\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    vec4 d = uModelMatrix * vec4(aVertexPosition, 1.);\r\n    gl_Position = uViewProjMatrix * d;\r\n    vWorldPos_ViewSpaceDepth.stp = d.stp;\r\n    vVertexAlbedo = aVertexColour;\r\n#if defined(GAMMA_CORRECT_INPUTS) && !defined(TEXTURE_ATLAS)\r\n    vVertexAlbedo.stp = SRGBToLinear(vVertexAlbedo.stp);\r\n#endif\r\n    vVertexAlbedo.q += uFade;\r\n#if defined(SUNLIGHT_DIRECT_LIGHTING) || defined(DEBUG_NORMALS)\r\n    vWorldNormal = normalize(Mat4ToMat3(uModelMatrix) * aVertexNormal_FogProportion.stp);\r\n#endif\r\n\r\n#if defined(IRRADIANCE_LIGHTING) && !defined(NORMAL_MAP)\r\n    vAmbientColour = uAmbientColour * EvaluateSHLighting2ndOrder(vWorldNormal, uIrradianceSHCoefs);\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS)\r\n    vMaterialSettingsSlots1D = vec4(aMaterialSettingsSlotXY_MaterialSettingsSlotXY2.s + aMaterialSettingsSlotXY_MaterialSettingsSlotXY2.t * MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X, aMaterialSettingsSlotXY_MaterialSettingsSlotXY2.p + aMaterialSettingsSlotXY_MaterialSettingsSlotXY2.q * MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X, aMaterialSettingsSlotXY3.s + aMaterialSettingsSlotXY3.t * MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X, 0.);\r\n    vTextureScale = aTextureScale;\r\n    vTextureWeight = aTextureWeight;\r\n#endif\r\n    vMaterialProperties = aMaterialProperties + vec4(.25);\r\n#if defined(LIGHT_SCATTERING) || defined(SUNLIGHT_SHADOWS) || defined(FOG_DISTANCE)\r\n    vec3 S = d.stp - uCameraPosition;\r\n    float G = length(S);\r\n    vec3 g = S / G;\r\n#endif\r\n\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    vec3 u = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    vWorldPos_ViewSpaceDepth.q = abs(dot(S.stp, u));\r\n#endif\r\n\r\n#if (defined(FOG_DISTANCE) || (defined(SUNLIGHT_DIRECT_LIGHTING) && defined(LIGHT_SCATTERING))) && !defined(OGLES2_BACKEND)\r\n\r\n#if defined(LIGHT_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    ComputeInOutScattering(g, G, uInvSunDirection, vOutScattering, vInScattering);\r\n#else\r\n    vOutScattering = vec3(1.);\r\n    vInScattering = vec3(0.);\r\n#endif\r\n\r\n#if defined(FOG_DISTANCE)\r\n    float p = FogBasedOnDistance(G);\r\n    vInScattering = mix(vInScattering, uFogColour.stp, p);\r\n    vOutScattering *= 1. - p;\r\n#endif\r\n\r\n#endif\r\n}\r\n"
},7274:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define SHADER_TYPE_PIXEL\r\n\r\nout vec4 gl_FragColor;\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define AMBIENT_LIGHTING\r\n#define DIFFUSE_LIGHTING\r\n#define ALBEDO_LIGHTING\r\n#define TEXTURE_ALBEDO_GLOBAL\r\n#define SUNLIGHT_DIRECT_LIGHTING\r\n#define TEXTURE_ATLAS\r\n#define ALPHA_ENABLED\r\n#define VIEW_TRANSFORMS\r\n#define TINT\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nuniform highp float uTextureAnimationTime;\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\n\r\nUNIFORM_BUFFER_BEGIN(Sunlight)\r\nuniform highp vec3 uInvSunDirection;\r\nuniform mediump vec3 uAmbientColour;\r\nuniform mediump vec3 uSunColour;\r\nuniform mediump float uDummy;\r\nUNIFORM_BUFFER_END\r\n#ifndef LIGHT_SCATTERING_VS_UNIFORMS\r\n#define LIGHT_SCATTERING_VS_UNIFORMS\r\nUNIFORM_BUFFER_BEGIN(SimpleScattering)\r\nuniform mediump vec3 uOutscatteringAmount;\r\nuniform mediump vec3 uInscatteringAmount;\r\nuniform mediump vec3 uScatteringTintColour;\r\nuniform highp vec4 uScatteringParameters;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\nuniform float uAlphaTestThreshold;\r\nuniform vec4 uAtlasMeta;\r\nuniform sampler2D uTextureAtlas;\r\nuniform sampler2D uTextureAtlasSettings;\r\nuniform samplerCube uGlobalEnvironmentMap;\r\nuniform vec4 uGlobalEnvironmentMappingParams;\r\nuniform vec4 uTint;\r\nin highp vec3 vWorldPosition;\r\nin highp vec3 vNormal;\r\nin mediump vec4 vVertexAlbedo;\r\nin vec2 vTextureUV;\r\nflat in vec3 vMaterialSettingsSlotXY_BatchFlags;\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\nvec4 textureCubeSRGB(samplerCube sampler, vec3 reflDir)\r\n{\r\n    vec4 texel = textureCube(sampler, reflDir);\r\n    return texel;\r\n}\r\n\r\nvec4 textureCubeSRGB(samplerCube sampler, vec3 reflDir, float lod)\r\n{\r\n    vec4 texel = textureCube(sampler, reflDir, lod);\r\n    return texel;\r\n}\r\n\r\nvec4 textureCubeLodSRGB(samplerCube sampler, vec3 reflDir, float lod)\r\n{\r\n    vec4 texel = textureCubeLodCompat(sampler, reflDir, lod);\r\n    return texel;\r\n}\r\n#define SRGB_TEXTURES\r\n#define STANDARD_DERIVATIVES\r\n#define TEXTURE_LOD\r\n#define TEXTURE_GRAD\r\n#define TEXTURE_MIP_LIMIT\r\n#define LOOKUP_MODE_DYNAMIC\r\n\r\n#define TEXTURE_SETTINGS_USE_TEXEL_OFFSETS\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\nfloat getMipMapLevel(vec2 v, vec2 p)\r\n{\r\n    float d = 0.;\r\n#if defined(STANDARD_DERIVATIVES)\r\n    float L = max(dot(v, v), dot(p, p));\r\n    d = .5 * log2(L);\r\n    d = max(0., d);\r\n#endif\r\n    return d;\r\n}\r\n#if defined(DEBUG_TEXEL_DENSITY)\r\nvec3 GetTexelDensityDebugColour(vec2 v, float p, vec3 d)\r\n{\r\n    float t = length(fwidth(v) * p), s = length(fwidth(d)), L = t / s, h = uDebugTexelDensity.s, f = uDebugTexelDensity.t, o = uDebugTexelDensity.p, T = uDebugTexelDensity.q;\r\n    vec3 c;\r\n    c.s = smoothstep(f / (T + 1.), h, L);\r\n    c.t = 1. - smoothstep(0., f * (T + 1.), abs(L - f));\r\n    c.p = smoothstep(1. - (f + o * T), 1. - o, 1. - L);\r\n    c *= c;\r\n    return c;\r\n}\r\n#endif\r\n#if defined(LOOKUP_MODE_DYNAMIC) && !defined(NO_SAMPLER_WRAP)\r\nflat in mediump float vSamplerWrap;\r\n#endif\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid getTexelBias_inner(float v, highp vec2 t, highp vec3 d, highp vec3 p, highp vec3 s, vec4 c, vec2 m, vec2 g, float L, sampler2D f, out vec4 i, out vec4 h, out vec4 o)\r\n{\r\n    float T = c.s;\r\n    highp float q = c.t, l = c.p;\r\n    float P = c.q;\r\n    highp vec3 S = vec3(d.s, p.s, s.s), y = vec3(d.t, p.t, s.t), a = vec3(d.p, p.p, s.p);\r\n    const vec2 u = vec2(1.);\r\n    vec3 D = .5 / a;\r\n    highp vec2 r, C, Y;\r\n#if !defined(LOOKUP_MODE_CLAMP) && !defined(LOOKUP_MODE_REPEAT)\r\n    const float G = .5, e = .25, n = .125, E = .0625;\r\n    vec4 O = step(.5, fract(L * vec4(G, e, n, E)));\r\n#endif\r\n\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n    r = clamp(t, vec2(D.s), u - vec2(D.s));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n    r = mod(t, u);\r\n#else\r\n    const vec2 N = vec2(.5), M = vec2(2.);\r\n    vec2 x = clamp(t, vec2(D.s), u - vec2(D.s)), R = mod(t, u), A = t - M * floor(N * t), U = u - abs(u - A);\r\n    r = O.st * x + O.pq * R + (u - O.st - O.pq) * U;\r\n#endif\r\n    r = r * a.s * l;\r\n    r += vec2(S.s, y.s) * q * l;\r\n    if (v > 1.)\r\n    {\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n        C = clamp(t, vec2(D.t), u - vec2(D.t));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n        C = mod(t, u);\r\n#else\r\n        vec2 I = clamp(t, vec2(D.t), u - vec2(D.t)), K = R, B = U;\r\n        C = O.st * I + O.pq * K + (u - O.st - O.pq) * B;\r\n#endif\r\n        C = C * a.t * l;\r\n        C += vec2(S.t, y.t) * q * l;\r\n        if (v > 2.)\r\n        {\r\n#if defined(LOOKUP_MODE_CLAMP)\r\n            Y = clamp(t, vec2(D.p), u - vec2(D.p));\r\n#elif defined(LOOKUP_MODE_REPEAT)\r\n            Y = mod(t, u);\r\n#else\r\n            vec2 b = clamp(t, vec2(D.p), u - vec2(D.p)), X = R, V = U;\r\n            Y = O.st * b + O.pq * X + (u - O.st - O.pq) * V;\r\n#endif\r\n            Y = Y * a.p * l;\r\n            Y += vec2(S.p, y.p) * q * l;\r\n        }\r\n    }\r\n    h = vec4(0.);\r\n    o = vec4(0.);\r\n#if defined(TEXTURE_MIP_LIMIT)\r\n\r\n#if defined(TEXTURE_GRAD)\r\n    highp vec2 I = m * l, K = g * l, B = I * a.s, X = K * a.s;\r\n    const vec2 b = vec2(.025);\r\n    B = clamp(B, -b, b);\r\n    X = clamp(X, -b, b);\r\n    i = texture2DGrad(f, r, B, X);\r\n    if (v > 1.)\r\n    {\r\n        B = I * a.t;\r\n        X = K * a.t;\r\n        B = clamp(B, -b, b);\r\n        X = clamp(X, -b, b);\r\n        h = texture2DGrad(f, C, B, X);\r\n        if (v > 2.)\r\n            B = I * a.p, X = K * a.p, B = clamp(B, -b, b), X = clamp(X, -b, b), o = texture2DGrad(f, Y, B, X);\r\n    }\r\n#else\r\n    i = texture2D(f, r);\r\n    if (v > 1.)\r\n    {\r\n        h = texture2D(f, C);\r\n        if (v > 2.)\r\n            o = texture2D(f, Y);\r\n    }\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(TEXTURE_LOD)\r\n    vec2 V = m * a.s, W = g * a.s;\r\n    float F = getMipMapLevel(V, W);\r\n    F = min(F, P);\r\n    i = texture2DLod(f, r, F);\r\n    if (v > 1.)\r\n    {\r\n        V = m * a.t;\r\n        W = g * a.t;\r\n        F = getMipMapLevel(V, W);\r\n        F = min(F, P);\r\n        h = texture2DLod(f, C, F);\r\n        if (v > 2.)\r\n            V = m * a.p, W = g * a.p, F = getMipMapLevel(V, W), F = min(F, P), o = texture2DLod(f, Y, F);\r\n    }\r\n#else\r\n    i = texture2D(f, r);\r\n    if (v > 1.)\r\n    {\r\n        h = texture2D(f, C);\r\n        if (v > 2.)\r\n            o = texture2D(f, Y);\r\n    }\r\n#endif\r\n\r\n#endif\r\n}\r\nvoid getTexel_inner(float v, vec2 f, highp vec3 d, highp vec3 t, highp vec3 p, vec4 s, vec2 h, vec2 o, float b, sampler2D B, out vec4 D, out vec4 L, out vec4 u)\r\n{\r\n    getTexelBias_inner(v, f, d, t, p, s, h, o, b, B, D, L, u);\r\n#if defined(SRGB_TEXTURES)\r\n    if (v > 1.)\r\n        L = vec4(LinearToSRGB(L.stp), L.q);\r\n    if (v > 2.)\r\n        u = vec4(LinearToSRGB(u.stp), u.q);\r\n#else\r\n    D = vec4(SRGBToLinear(D.stp), D.q);\r\n#endif\r\n}\r\nvoid getTexel_inner(float v, vec2 f, highp vec3 d, highp vec3 t, highp vec3 p, vec4 s, float h, sampler2D o, out vec4 b, out vec4 B, out vec4 u)\r\n{\r\n    vec2 X = vec2(0.), i = vec2(0.);\r\n#if defined(STANDARD_DERIVATIVES)\r\n    X = dFdx(f);\r\n    i = dFdy(f);\r\n#endif\r\n    getTexel_inner(v, f, d, t, p, s, X, i, h, o, b, B, u);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, vec4 h, vec2 g, vec2 s, float f, sampler2D e, out vec4 c)\r\n{\r\n    vec3 t = vec3(1.), l = vec3(1.);\r\n    vec4 i = vec4(0.), p = vec4(0.);\r\n    getTexel_inner(1., v, o, t, l, h, g, s, f, e, c, i, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, vec4 h, float g, sampler2D s, out vec4 f)\r\n{\r\n    vec3 e = vec3(1.), l = vec3(1.);\r\n    vec4 t = vec4(0.), p = vec4(0.);\r\n    getTexel_inner(1., v, o, e, l, h, g, s, f, t, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, vec4 g, vec2 s, vec2 f, float e, sampler2D t, out vec4 l, out vec4 p)\r\n{\r\n    vec3 i = vec3(1.);\r\n    vec4 c = vec4(0.);\r\n    getTexel_inner(2., v, o, h, i, g, s, f, e, t, l, p, c);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, vec4 g, float s, sampler2D f, out vec4 e, out vec4 t)\r\n{\r\n    vec3 l = vec3(1.);\r\n    vec4 p = vec4(0.);\r\n    getTexel_inner(2., v, o, h, l, g, s, f, e, t, p);\r\n}\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, highp vec3 g, vec4 s, vec2 f, vec2 e, float t, sampler2D l, out vec4 p, out vec4 i, out vec4 c) { getTexel_inner(3., v, o, h, g, s, f, e, t, l, p, i, c); }\r\nvoid getTexel(vec2 v, highp vec3 o, highp vec3 h, highp vec3 g, vec4 s, float f, sampler2D e, out vec4 t, out vec4 l, out vec4 p) { getTexel_inner(3., v, o, h, g, s, f, e, t, l, p); }\r\n\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#ifndef TEXTURE_SETTINGS_INC\r\n#define TEXTURE_SETTINGS_INC\r\nstruct TextureSettings\r\n{\r\n    highp vec3 textureMeta1;\r\n    highp vec3 textureMeta2;\r\n    highp vec2 uvAnim;\r\n    float wrapping;\r\n    float specular;\r\n    float normalScale;\r\n#if defined(REFRACTION)\r\n    vec4 refraction;\r\n#endif\r\n#if defined(VIEWPORTMAP)\r\n    vec4 viewportMapUVScaleAndAnim;\r\n#endif\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    highp float materialID;\r\n#endif\r\n};\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid getTextureSettings(vec2 s, out TextureSettings v)\r\n{\r\n    const highp float d = 1. / 255., S = 1. / 65535., e = 32767., t = 1. / 32767.;\r\n    const float f = 1. / MATERIAL_SETTINGS_TEXTURE_RESOLUTION;\r\n    vec2 i = (floor(s + .5) * vec2(MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X, MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y) + .5) * f;\r\n    const float u = f;\r\n    vec4 T = texture2DLodCompat(uTextureAtlasSettings, i, 0.), U, n, D, m, a, R;\r\n    float h;\r\n    vec4 r;\r\n#if defined(TEXTURE_SETTINGS_USE_TEXEL_OFFSETS)\r\n\r\n#define SAMPLE_OFFSET_SLOTSIZES_AND_WRAPPING ivec2(2, 0)\r\n\r\n#define SAMPLE_OFFSET_UV_ANIM ivec2(0, 1)\r\n\r\n#define SAMPLE_OFFSET_SPECULAR_NORMAL_SCALE ivec2(1, 1)\r\n\r\n#define SAMPLE_OFFSET_REFRACTION ivec2(0, 2)\r\n\r\n#define SAMPLE_OFFSET_SLOTETC ivec2(1, 2)\r\n\r\n#define SAMPLE_OFFSET_VIEWPORTMAP_UVSCALE ivec2(2, 2)\r\n\r\n#define SAMPLE_OFFSET_VIEWPORTMAP_UVANIMATION ivec2(0, 3)\r\n\r\n#define SAMPLE_OFFSET_DEBUG ivec2(2, 3)\r\n    U = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SLOTSIZES_AND_WRAPPING);\r\n    n = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_UV_ANIM);\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    D = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SPECULAR_NORMAL_SCALE);\r\n#endif\r\n\r\n#if defined(REFRACTION)\r\n    m = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_REFRACTION);\r\n#endif\r\n    h = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_SLOTETC).q;\r\n#if defined(VIEWPORTMAP)\r\n    a = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_VIEWPORTMAP_UVSCALE);\r\n    R = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_VIEWPORTMAP_UVANIMATION);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    r = textureLodOffset(uTextureAtlasSettings, i, 0., SAMPLE_OFFSET_DEBUG);\r\n#endif\r\n\r\n#else\r\n    vec2 g = vec2(u * 2., 0.), o = vec2(0., u), M = vec2(u, u), p = vec2(0., u * 2.), X = vec2(u, u * 2.), q = vec2(u * 2., u * 2.), E = vec2(0., u * 3.), A = vec2(u * 2., u * 3.);\r\n    U = texture2DLodCompat(uTextureAtlasSettings, i + g, 0.);\r\n    n = texture2DLodCompat(uTextureAtlasSettings, i + o, 0.);\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    D = texture2DLodCompat(uTextureAtlasSettings, i + M, 0.);\r\n#endif\r\n\r\n#if defined(REFRACTION)\r\n    m = texture2DLodCompat(uTextureAtlasSettings, i + p, 0.);\r\n#endif\r\n    h = texture2DLodCompat(uTextureAtlasSettings, i + X, 0.).q;\r\n#if defined(VIEWPORTMAP)\r\n    a = texture2DLodCompat(uTextureAtlasSettings, i + q, 0.);\r\n    R = texture2DLodCompat(uTextureAtlasSettings, i + E, 0.);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    r = texture2DLodCompat(uTextureAtlasSettings, i + A, 0.);\r\n#endif\r\n\r\n#endif\r\n    T = floor(T * 255. + .5);\r\n    U = floor(U * 255. + .5);\r\n    h = floor(h * 255. + .5);\r\n    const float V = .5, c = .25, L = .125, P = .0625;\r\n    vec4 N = step(.5, fract(h * vec4(V, c, L, P)));\r\n    T += vec4(256.) * N;\r\n    vec2 w = U.st * uAtlasMeta.t;\r\n    v.textureMeta1 = vec3(T.st, w.s);\r\n    v.textureMeta2 = vec3(T.pq, w.t);\r\n    v.wrapping = U.q;\r\n#if defined(SPECULAR_LIGHTING) || defined(USE_NORMAL_MAP)\r\n    v.specular = UnpackVec2ToFloat(D.st) * d;\r\n    v.normalScale = UnpackVec2ToFloat(D.pq) * d;\r\n    v.normalScale = v.normalScale * .1 - 8.;\r\n#else\r\n    v.specular = 0.;\r\n    v.normalScale = 0.;\r\n#endif\r\n    highp vec2 G = vec2(UnpackVec2ToFloat(n.st), UnpackVec2ToFloat(n.pq)) - e;\r\n    G *= step(1.5, abs(G));\r\n    v.uvAnim = G * t * 2.;\r\n#if defined(REFRACTION)\r\n    v.refraction = m;\r\n    v.refraction.t = v.refraction.t * 2. + 1.;\r\n    v.refraction.p = UnpackVec2ToFloat(v.refraction.pq) * S * 10.;\r\n#endif\r\n\r\n#if defined(VIEWPORTMAP)\r\n    highp vec2 C = vec2(UnpackVec2ToFloat(a.st), UnpackVec2ToFloat(a.pq)) - e, Y = vec2(UnpackVec2ToFloat(R.st), UnpackVec2ToFloat(R.pq)) - e;\r\n    C *= step(1.5, abs(C));\r\n    Y *= step(1.5, abs(Y));\r\n    v.viewportMapUVScaleAndAnim = vec4(C * t * 2., Y * t * 2.);\r\n#endif\r\n\r\n#if defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    v.materialID = UnpackVec2ToFloat(r.st);\r\n#endif\r\n}\r\nvoid getTextureSettings1D(float v, out TextureSettings i)\r\n{\r\n    const float d = 1. / MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X;\r\n    float S = floor((v + .5) * d), u = v - S * MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X;\r\n    getTextureSettings(vec2(u, S), i);\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\nconst highp float CAUSTICS_FIXED_POINT_SCALE = 10000.;\r\n#if defined(CAUSTICS) && !defined(CAUSTICS_COMPUTE) && !defined(CAUSTICS_STENCIL)\r\nfloat CalculateCausticsTerm(highp vec3 u, float t, vec3 e)\r\n{\r\n    float i = 0., s = 0.;\r\n    if (u.t <= uCausticsPlaneHeight)\r\n        s = step(1., t);\r\n    else\r\n    {\r\n#if defined(CAUSTICS_OVERWATER)\r\n        s = clamp(e.t * -1., 0., 1.);\r\n        float d = smoothstep(uCausticsOverWaterFade.s, uCausticsOverWaterFade.t, u.t - uCausticsPlaneHeight);\r\n        s *= 1. - d;\r\n#else\r\n        return 0.0;\r\n#endif\r\n    }\r\n    if (s > 0.)\r\n    {\r\n        highp vec4 C = uCausticsViewProjMatrix * vec4(u, 1.);\r\n        C.st /= 2. * C.q;\r\n        vec2 f = abs(C.st);\r\n        C.st += .5;\r\n        f = smoothstep(.4, .5, f);\r\n        s *= max(0., 1. - (f.s + f.t));\r\n        if (s > 0.)\r\n            i += textureOffset(uCausticsMap, C.st, ivec2(-1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(0, -1)).s, i += texture2D(uCausticsMap, C.st).s * 5., i += textureOffset(uCausticsMap, C.st, ivec2(0, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 1)).s, i *= s / 12.;\r\n    }\r\n    return i;\r\n}\r\n#endif\r\n#if defined(CAUSTICS_COMPUTE)\r\nvoid WriteCausticsRay(vec3 t, float i)\r\n{\r\n    vec2 s = t.sp * i * uCausticsRefractionScale, C = (gl_FragCoord.st + s * 2.) / uCausticsComputeResolution * uCausticsMapSize;\r\n    highp float u = min(uCausticsFade.s / i * uCausticsFade.t, 7. * uCausticsFade.t), f = smoothstep(uCausticsFade.p, uCausticsFade.q, i), E = f * u * CAUSTICS_FIXED_POINT_SCALE;\r\n    if (E >= 1.f)\r\n        imageAtomicAdd(uCausticsIntegerMap, ivec2(C.st), uint(E));\r\n}\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_UNIFORMS\r\n#define DISTANCE_FOG_UNIFORMS\r\n#if defined(FOG_DISTANCE)\r\nUNIFORM_BUFFER_BEGIN(DistanceFog)\r\nuniform mediump vec4 uFogColour;\r\nuniform highp vec4 uFogParams;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_FUNCTIONS\r\n#define DISTANCE_FOG_FUNCTIONS\r\n#if defined(FOG_DISTANCE)\r\nfloat FogBasedOnDistance(highp float f)\r\n{\r\n    highp float F = (uFogParams.t - f) * uFogParams.s;\r\n    return 1. - clamp(F, 0., 1.);\r\n}\r\nfloat FogBasedOnAngle(highp vec3 f)\r\n{\r\n    highp float F = 1. - clamp(f.t + uFogParams.q, 0., 1.);\r\n    F = pow(F, uFogParams.p);\r\n    return clamp(F, 0., 1.);\r\n}\r\n#endif\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && defined(NORMAL_MAP)\r\n#define USE_NORMAL_MAP\r\n#endif\r\n\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS)\r\nvoid CalculateDerivatives(inout highp vec2 v, inout highp vec2 d, inout highp vec3 g, inout highp vec3 h, highp vec2 S, highp vec3 T)\r\n{\r\n#if defined(STANDARD_DERIVATIVES)\r\n    v = dFdx(S);\r\n    d = dFdy(S);\r\n#if defined(PER_FRAGMENT_TANGENTS)\r\n    g = dFdxFine(T);\r\n    h = dFdyFine(T);\r\n#endif\r\n\r\n#endif\r\n}\r\n#if defined(RT7_MATERIAL)\r\nvoid SampleTexturesRT7(inout vec4 v, inout vec4 d, inout vec4 S, vec2 T, TextureSettings h, float g, vec2 i, vec2 u)\r\n{\r\n#if defined(TEXTURE_ATLAS)\r\n\r\n#if !defined(TEXTURE_ALBEDO_GLOBAL)\r\n    if (fract(g * 8.) > .5)\r\n    {\r\n#endif\r\n        getTexel(T, h.textureMeta1, h.textureMeta2, h.textureMeta3, uAtlasMeta, i, u, h.wrapping, uTextureAtlas, v, d, S);\r\n#if defined(ETC_CHANNEL_SWIZZLE)\r\n        d = d.qtps;\r\n        S = S.sqpt;\r\n#endif\r\n\r\n#if !defined(TEXTURE_ALBEDO_GLOBAL)\r\n    }\r\n#endif\r\n\r\n#endif\r\n}\r\n#else\r\nvoid SampleTextures(inout vec4 v, inout vec4 d, vec2 T, TextureSettings h, float S, vec2 i, vec2 u)\r\n{\r\n#if defined(TEXTURE_ATLAS)\r\n\r\n#if !defined(TEXTURE_ALBEDO_GLOBAL)\r\n    if (fract(S * 8.) > .5)\r\n    {\r\n#endif\r\n\r\n#if defined(HDR_SCALE) || defined(USE_NORMAL_MAP)\r\n        getTexel(T, h.textureMeta1, h.textureMeta2, uAtlasMeta, i, u, h.wrapping, uTextureAtlas, v, d);\r\n#if defined(ETC_CHANNEL_SWIZZLE)\r\n        d = d.qtps;\r\n#endif\r\n\r\n#else\r\n    getTexel(T, h.textureMeta1, uAtlasMeta, i, u, h.wrapping, uTextureAtlas, v);\r\n#endif\r\n\r\n#if !defined(TEXTURE_ALBEDO_GLOBAL)\r\n    }\r\n#endif\r\n\r\n#if defined(HDR_SCALE)\r\n    v = HDRScale(v, d.s);\r\n#endif\r\n\r\n#endif\r\n}\r\n#endif\r\n#endif\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\nvoid ComputeTangentBitangentFromDerivatives(inout vec3 v, inout vec3 p, highp vec3 h, highp vec3 d, highp vec3 A, highp vec2 r, highp vec2 S)\r\n{\r\n    highp vec3 q = cross(h, d), c = cross(A, h), n = c * r.s + q * S.s, s = c * r.t + q * S.t;\r\n    highp float D = dot(n, n), a = dot(s, s), i = max(D, a), t = inversesqrt(i);\r\n    n *= t;\r\n    s *= t;\r\n    if (isNaN(D + a) || i <= 0.)\r\n        n = s = h;\r\n    v = n;\r\n    p = s;\r\n}\r\nvec3 ComputeBitangent(vec3 v, vec4 h)\r\n{\r\n    highp vec3 p = cross(v, h.stp);\r\n    p *= h.q;\r\n    return p;\r\n}\r\nvec3 ApplyNormalMap(highp vec3 v, highp vec3 h, highp vec3 d, highp vec3 A, highp vec2 p, highp vec2 S)\r\n{\r\n    highp vec3 D, s;\r\n    ComputeTangentBitangentFromDerivatives(D, s, h, d, A, p, S);\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = normalize(D) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = normalize(s) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 r = v.s * D + v.t * s + v.p * h;\r\n    r = normalize(r);\r\n    return abs(r.s) + abs(r.t) + abs(r.p) < .5 ? h : r;\r\n}\r\nvec3 ApplyNormalMap(vec3 v, vec3 A, vec3 s, vec3 S)\r\n{\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = s * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = S * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 p = v.s * s + v.t * S + v.p * A;\r\n    p = normalize(p);\r\n    return p;\r\n}\r\nvec3 ApplyNormalMap(vec3 v, vec3 h, vec4 r)\r\n{\r\n    vec3 p = ComputeBitangent(h, r);\r\n    return ApplyNormalMap(v, h, r.stp, p);\r\n}\r\nvec3 ApplyNormalMapTerrain(vec3 v, highp vec3 h, highp vec3 r, highp vec3 S)\r\n{\r\n    highp vec3 p = cross(h, r), s = cross(S, h), D = s * r.s + p * S.s, n = s * r.p + p * S.p;\r\n    highp float A = inversesqrt(max(dot(D, D), dot(n, n)));\r\n    D *= A;\r\n    n *= A;\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = normalize(D) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = normalize(n) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    highp vec3 d = v.s * D + v.t * n + v.p * h;\r\n    d = normalize(d);\r\n    return isNaN(d.s) ? h : d;\r\n}\r\nvec3 ApplyNormalMapTerrain(vec3 v, vec3 h)\r\n{\r\n    const vec3 p = vec3(0., 0., 1.);\r\n    vec3 D = cross(p, h), s = cross(D, h);\r\n    return ApplyNormalMap(v, h, D, s);\r\n}\r\n\r\nvec3 UnpackCompressedNormal(vec3 U)\r\n{\r\n    vec3 v = vec3(U.ps * 255. / 127. - 1.00787, 0.);\r\n    v.p = sqrt(1. - min(1., dot(v.st, v.st)));\r\n    v.t = -v.t;\r\n    return v;\r\n}\r\nvec3 UnpackNormal(vec3 v, float U)\r\n{\r\n    vec3 t;\r\n#if defined(COMPRESSED_NORMALS)\r\n    t = UnpackCompressedNormal(v);\r\n#else\r\n    t = v.pst * 255. / 127. - 1.00787;\r\n    t.t = -t.t;\r\n#endif\r\n    t.st *= U;\r\n    return t;\r\n}\r\nvec3 UnpackNormal(vec3 U) { return UnpackNormal(U, 1.); }\r\nvec3 UnpackNormal(vec4 v) { return UnpackNormal(v.tpq, 1.); }\r\nvec3 UnpackNormal(vec4 v, float U) { return UnpackNormal(v.tpq, U); }\r\n\r\n#if defined(VIEWPORTMAP)\r\nvec3 SampleViewportMapColour(highp vec2 v, highp vec4 e)\r\n{\r\n    v = v * uViewportLookupScale.st;\r\n    vec2 t;\r\n#if defined(OGLES2_BACKEND)\r\n    t = uViewportMapTextureSize.st;\r\n#else\r\n    t = vec2(textureSize(uViewportMap, 0));\r\n#endif\r\n    v.s *= uViewportLookupScale.p * uViewportLookupScale.t / (t.s / t.t);\r\n    v *= e.st;\r\n    highp float u = uTextureAnimationTime;\r\n    v += e.pq * u;\r\n    return texture2DLodCompat(uViewportMap, v, 0.).stp;\r\n}\r\n#endif\r\n\r\n#ifndef VOLUMETRIC_FUNCTIONS_INC\r\n#define VOLUMETRIC_FUNCTIONS_INC\r\n#if defined(SUNLIGHT_SHADOWS) && defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n#define VOLUMETRIC_SCATTERING_SUPPORTED\r\nuniform vec4 uMieG, uVolumetricScatteringParameters;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\nuniform vec4 uGroundFogHeight_Falloff;\r\n#endif\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\nuniform sampler3D sNoiseTex;\r\nuniform vec4 u3DNoiseFrequency_Strength, u3DNoiseWind_Power;\r\n#endif\r\nuniform float uTime;\r\nfloat ShadowSample(vec4 u, vec4 v, float s)\r\n{\r\n    int d = int(uMappingParams.q);\r\n    vec4 f;\r\n    int G;\r\n#if defined(CASCADE_SPLIT_SELECTION)\r\n    G = ShadowMapSelectCascadeBySplit(s, uCascadeFrustumViewDepths, uCascadeSplitSelectionFlags);\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    f = uSunlightViewProjTexMatrix[G] * u;\r\n#else\r\n    f = v * uSunlightProjTexMatScale[G] + uSunlightProjTexMatOffset[G];\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    G = ShadowMapSelectCascadeByMap(f, u, uSunlightViewProjTexMatrix, uCascadeMinAtlasExtents);\r\n#else\r\n    G = ShadowMapSelectCascadeByMap(f, v, uSunlightProjTexMatScale, uSunlightProjTexMatOffset, uCascadeMinAtlasExtents);\r\n#endif\r\n\r\n#endif\r\n    return G >= d ? 1. : ShadowDepthMapFilter1x1(uSunlightShadowMap, f);\r\n}\r\nfloat PhaseFunction(float v, vec4 s) { return s.q * (s.s / pow(s.t - s.p * v, 1.5)); }\r\nvec4 GetScatteredInRay(int s, vec3 u, float v, float d, vec4 f)\r\n{\r\n    float G = uSunlightFadeAttenParams.t * 1.4, m = min(G, v);\r\n    vec3 V = uCameraPosition, t = V + u * m;\r\n    vec4 x = uSunlightViewMatrix * vec4(V, 1.), e = uSunlightViewMatrix * vec4(t, 1.), i = uSunlightViewMatrix * vec4(V, 0.), n = uSunlightViewMatrix * vec4(t, 0.);\r\n    vec3 E = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    int S = int(uMappingParams.q);\r\n    float q = 0., p = 1. / float(s), N = d * p, h = m * p;\r\n    vec2 r = vec2(0., 0.);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n    vec3 P = vec3(.05 * uTime), a = u3DNoiseWind_Power.stp * uTime;\r\n    const float o = .31;\r\n    float c = u3DNoiseFrequency_Strength.s * o;\r\n    vec3 l = a * u3DNoiseFrequency_Strength.s, T = a * c;\r\n#endif\r\n    for (int X = 0; X < s; ++X)\r\n    {\r\n        vec3 U = mix(V, t, N);\r\n        vec4 I = mix(x, e, N);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        vec4 M = mix(i, n, N);\r\n        vec3 C = M.sts * vec3(.001) + P, g = M.sts * vec3(.001) - P;\r\n        I.sp += vec2(texture3D(sNoiseTex, g).s, texture3D(sNoiseTex, g).s) * 128. - 64.;\r\n#endif\r\n        float R = 0.;\r\n#if defined(USE_CASCADE_SPLIT_SELECTION)\r\n        vec3 O = U.stp - uCameraPosition;\r\n        R = abs(dot(O, E));\r\n#endif\r\n        float F = ShadowSample(vec4(U, 1.f), I, R), D = 1., w = 1.;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\n        if (uGroundFogHeight_Falloff.t != 0.)\r\n        {\r\n            float L = max(0., (U.t - uGroundFogHeight_Falloff.s) * uGroundFogHeight_Falloff.t);\r\n            w = exp(-L) * 100.;\r\n        }\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        if (u3DNoiseFrequency_Strength.t != 0.)\r\n        {\r\n            vec3 L = U * u3DNoiseFrequency_Strength.s + l;\r\n            float y = float(texture3D(sNoiseTex, L));\r\n            vec3 A = U * c + T;\r\n            float H = float(texture3D(sNoiseTex, A)), W = pow(mix(y, H, .8) + .5, u3DNoiseWind_Power.q);\r\n            w *= max(0, mix(1., W, u3DNoiseFrequency_Strength.t));\r\n        }\r\n#endif\r\n        D += w;\r\n        float L = D * h, W = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += W * exp(-q) * vec2(F, 1. - F);\r\n        N += p;\r\n    }\r\n    if (v > G)\r\n    {\r\n        float L = v - G, U = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += vec2(U * exp(-q), 0.);\r\n    }\r\n    float U = r.s + r.t;\r\n    if (U > 0.)\r\n    {\r\n        float L = r.s / U, g = uVolumetricScatteringParameters.q;\r\n        L = pow(L, g);\r\n        r.st = U * vec2(L, 1. - L);\r\n        r.s = r.s * PhaseFunction(dot(u, uInvSunDirection), f);\r\n    }\r\n    return vec4(r.s, q, r.t, 1.);\r\n}\r\nvec4 GetScatteredInRay2(int s, vec3 u, float v, float f) { return GetScatteredInRay(s, u, v, f, uMieG); }\r\nvec4 GetScatteredInRayLine(int s, vec3 u, float v, vec3 f, float d, float G)\r\n{\r\n    vec4 L = GetScatteredInRay2(s, u, v, G), t = GetScatteredInRay2(s, mix(u, f, .33), mix(v, d, .33), G), m = GetScatteredInRay2(s, mix(u, f, .66), mix(v, d, .66), G), U = GetScatteredInRay2(s, f, d, G);\r\n    return L * .15 + t * .2 + m * .3 + U * .35;\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef APPLY_VOLUMETRICS_INC\r\n#define APPLY_VOLUMETRICS_INC\r\n#ifndef VOLUMETRIC_FUNCTIONS_INC\r\n#define VOLUMETRIC_FUNCTIONS_INC\r\n#if defined(SUNLIGHT_SHADOWS) && defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n#define VOLUMETRIC_SCATTERING_SUPPORTED\r\nuniform vec4 uMieG, uVolumetricScatteringParameters;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\nuniform vec4 uGroundFogHeight_Falloff;\r\n#endif\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\nuniform sampler3D sNoiseTex;\r\nuniform vec4 u3DNoiseFrequency_Strength, u3DNoiseWind_Power;\r\n#endif\r\nuniform float uTime;\r\nfloat ShadowSample(vec4 u, vec4 v, float s)\r\n{\r\n    int d = int(uMappingParams.q);\r\n    vec4 f;\r\n    int G;\r\n#if defined(CASCADE_SPLIT_SELECTION)\r\n    G = ShadowMapSelectCascadeBySplit(s, uCascadeFrustumViewDepths, uCascadeSplitSelectionFlags);\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    f = uSunlightViewProjTexMatrix[G] * u;\r\n#else\r\n    f = v * uSunlightProjTexMatScale[G] + uSunlightProjTexMatOffset[G];\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    G = ShadowMapSelectCascadeByMap(f, u, uSunlightViewProjTexMatrix, uCascadeMinAtlasExtents);\r\n#else\r\n    G = ShadowMapSelectCascadeByMap(f, v, uSunlightProjTexMatScale, uSunlightProjTexMatOffset, uCascadeMinAtlasExtents);\r\n#endif\r\n\r\n#endif\r\n    return G >= d ? 1. : ShadowDepthMapFilter1x1(uSunlightShadowMap, f);\r\n}\r\nfloat PhaseFunction(float v, vec4 s) { return s.q * (s.s / pow(s.t - s.p * v, 1.5)); }\r\nvec4 GetScatteredInRay(int s, vec3 u, float v, float d, vec4 f)\r\n{\r\n    float G = uSunlightFadeAttenParams.t * 1.4, m = min(G, v);\r\n    vec3 V = uCameraPosition, t = V + u * m;\r\n    vec4 x = uSunlightViewMatrix * vec4(V, 1.), e = uSunlightViewMatrix * vec4(t, 1.), i = uSunlightViewMatrix * vec4(V, 0.), n = uSunlightViewMatrix * vec4(t, 0.);\r\n    vec3 E = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    int S = int(uMappingParams.q);\r\n    float q = 0., p = 1. / float(s), N = d * p, h = m * p;\r\n    vec2 r = vec2(0., 0.);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n    vec3 P = vec3(.05 * uTime), a = u3DNoiseWind_Power.stp * uTime;\r\n    const float o = .31;\r\n    float c = u3DNoiseFrequency_Strength.s * o;\r\n    vec3 l = a * u3DNoiseFrequency_Strength.s, T = a * c;\r\n#endif\r\n    for (int X = 0; X < s; ++X)\r\n    {\r\n        vec3 U = mix(V, t, N);\r\n        vec4 I = mix(x, e, N);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        vec4 M = mix(i, n, N);\r\n        vec3 C = M.sts * vec3(.001) + P, g = M.sts * vec3(.001) - P;\r\n        I.sp += vec2(texture3D(sNoiseTex, g).s, texture3D(sNoiseTex, g).s) * 128. - 64.;\r\n#endif\r\n        float R = 0.;\r\n#if defined(USE_CASCADE_SPLIT_SELECTION)\r\n        vec3 O = U.stp - uCameraPosition;\r\n        R = abs(dot(O, E));\r\n#endif\r\n        float F = ShadowSample(vec4(U, 1.f), I, R), D = 1., w = 1.;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\n        if (uGroundFogHeight_Falloff.t != 0.)\r\n        {\r\n            float L = max(0., (U.t - uGroundFogHeight_Falloff.s) * uGroundFogHeight_Falloff.t);\r\n            w = exp(-L) * 100.;\r\n        }\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        if (u3DNoiseFrequency_Strength.t != 0.)\r\n        {\r\n            vec3 L = U * u3DNoiseFrequency_Strength.s + l;\r\n            float y = float(texture3D(sNoiseTex, L));\r\n            vec3 A = U * c + T;\r\n            float H = float(texture3D(sNoiseTex, A)), W = pow(mix(y, H, .8) + .5, u3DNoiseWind_Power.q);\r\n            w *= max(0, mix(1., W, u3DNoiseFrequency_Strength.t));\r\n        }\r\n#endif\r\n        D += w;\r\n        float L = D * h, W = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += W * exp(-q) * vec2(F, 1. - F);\r\n        N += p;\r\n    }\r\n    if (v > G)\r\n    {\r\n        float L = v - G, U = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += vec2(U * exp(-q), 0.);\r\n    }\r\n    float U = r.s + r.t;\r\n    if (U > 0.)\r\n    {\r\n        float L = r.s / U, g = uVolumetricScatteringParameters.q;\r\n        L = pow(L, g);\r\n        r.st = U * vec2(L, 1. - L);\r\n        r.s = r.s * PhaseFunction(dot(u, uInvSunDirection), f);\r\n    }\r\n    return vec4(r.s, q, r.t, 1.);\r\n}\r\nvec4 GetScatteredInRay2(int s, vec3 u, float v, float f) { return GetScatteredInRay(s, u, v, f, uMieG); }\r\nvec4 GetScatteredInRayLine(int s, vec3 u, float v, vec3 f, float d, float G)\r\n{\r\n    vec4 L = GetScatteredInRay2(s, u, v, G), t = GetScatteredInRay2(s, mix(u, f, .33), mix(v, d, .33), G), m = GetScatteredInRay2(s, mix(u, f, .66), mix(v, d, .66), G), U = GetScatteredInRay2(s, f, d, G);\r\n    return L * .15 + t * .2 + m * .3 + U * .35;\r\n}\r\n#endif\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\nuniform vec3 uVolumetricLitFogColour, uVolumetricUnlitFogColour;\r\nuniform mat4 uVolumetricDitherMat;\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid GetInAndOutScattering(vec4 v, out vec3 u, out vec3 G)\r\n{\r\n    vec3 A = uSunColour * uVolumetricLitFogColour, o = uAmbientColour * uVolumetricUnlitFogColour;\r\n    u = vec3(exp(-v.t));\r\n    G = v.s * A + v.p * o;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\nvec4 ApplyVolumetricScattering(vec4 v, vec4 u)\r\n{\r\n    vec3 A = vec3(1.), o = vec3(0.);\r\n    GetInAndOutScattering(u, A, o);\r\n    return vec4(v.stp * A + o, v.q);\r\n}\r\nfloat CalculateScatteringOffset(vec2 v)\r\n{\r\n    vec2 u = vec2(floor(mod(v.st, 4.)));\r\n    return uVolumetricDitherMat[int(u.s)][int(u.t)];\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef LIGHTING_UTILS_H\r\n#define LIGHTING_UTILS_H\r\n#ifndef LIGHTING_INC\r\n#define LIGHTING_INC\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\n\r\nstruct LightingTerms\r\n{\r\n    vec3 Diffuse;\r\n    vec3 Specular;\r\n};\r\nvoid ClearLightingTerms(inout LightingTerms v) { v.Diffuse = vec3(0., 0., 0.), v.Specular = vec3(0., 0., 0.); }\r\nvoid AddLightingTerms(inout LightingTerms v, LightingTerms L) { v.Diffuse += L.Diffuse, v.Specular += L.Specular; }\r\nvoid EvaluateDirLightRT5(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, float S, float c, float F, float e, float E, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 G = normalize(d + i);\r\n    float r = FresnelSchlick(S, clamp(dot(i, G), 0., 1.), F);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(G, f, L, i, d, E, c, .5, .5);\r\n#else\r\n    vec3 n = vec3(r) * vec3(RunescapeRT5BRDF(G, f, c));\r\n#endif\r\n    n *= A * e;\r\n    v.Specular += n;\r\n#endif\r\n}\r\nvoid EvaluateDirLightRT7(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, vec3 S, float c, float E, float G, float e, float F, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 r = normalize(d + i), n = FresnelSchlick(S, clamp(dot(i, r), 0., 1.), G);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(r, f, L, i, d, F, c, .5, .5);\r\n#else\r\n    vec3 C = CookTorranceBRDF(c, E, n, f, r, d, i, F);\r\n#endif\r\n    C *= A * e;\r\n    v.Specular += C;\r\n#endif\r\n}\r\nfloat SpecularHorizonOcclusion(float L, vec3 i, vec3 v)\r\n{\r\n    vec3 d = reflect(i, v);\r\n    float A = clamp(1. + L * dot(d, v), 0., 1.);\r\n    A *= A;\r\n    return A;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT5(inout int i, inout float E, highp vec4 v, vec3 u, vec3 f, float d, vec3 n, float p, float S, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n    {\r\n        if (L > 0.)\r\n        {\r\n            highp vec4 h = uSunlightViewMatrix * v, e = vec4(u.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(i, v + e, h + e, d, uSunlightShadowMap, uSunlightShadowTranslucencyMap, r);\r\n        }\r\n    }\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, f, n, uInvSunDirection, h, p, 5., L, t, uSunColour);\r\n    return D;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT5(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, float n, float S)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, v, f, uInvSunDirection, h, n, 5., L, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT7(inout int u, inout float E, highp vec4 v, vec3 f, vec3 d, float n, vec3 h, vec3 L, float p, float i, float t, float S)\r\n{\r\n    float D = max(0., dot(f, uInvSunDirection)), e = D;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n    {\r\n        if (D > 0.)\r\n        {\r\n            highp vec4 r = uSunlightViewMatrix * v, a = vec4(f.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(u, v + a, r + a, n, uSunlightShadowMap, uSunlightShadowTranslucencyMap, S);\r\n        }\r\n    }\r\n#endif\r\n    e *= E;\r\n    LightingTerms r;\r\n    ClearLightingTerms(r);\r\n    EvaluateDirLightRT7(r, f, d, h, uInvSunDirection, L, p, i, t, e, D, uSunColour);\r\n    return r;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT7(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, vec3 n, float h, float L, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), p = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT7(D, u, v, f, uInvSunDirection, n, h, L, r, t, p, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef STIPPLE_TRANSPARENCY_UTILS_INC\r\n#define STIPPLE_TRANSPARENCY_UTILS_INC\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR) || defined(STIPPLE_TRANSPARENCY_CLIP_FAR) || defined(STIPPLE_TRANSPARENCY_ALPHA)\r\n#ifndef STIPPLE_COMMON_INC\r\n#define STIPPLE_COMMON_INC\r\nhighp float GetStippleViewSpaceDepthFromPos(vec3 S)\r\n{\r\n    vec3 u = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    return dot(S, u);\r\n}\r\n#endif\r\n\r\n#ifndef NOISE_UTILS_INC\r\n#define NOISE_UTILS_INC\r\nvec4 permute(vec4 t)\r\n{\r\n    return mod((t * 34. + 1.) * t, 289.);\r\n}\r\nvec2 fade(vec2 t) { return t * t * t * (t * (t * 6. - 15.) + 10.); }\r\nfloat cnoise(highp vec2 t)\r\n{\r\n    highp vec4 v = floor(t.stst) + vec4(0., 0., 1., 1.), d = fract(t.stst) - vec4(0., 0., 1., 1.);\r\n    v = mod(v, 289.);\r\n    vec4 p = v.spsp, s = v.ttqq, h = d.spsp, e = d.ttqq, f = permute(permute(p) + s), m = 2. * fract(f * .0243902) - 1., c = abs(m) - .5, q = floor(m + .5);\r\n    m = m - q;\r\n    vec2 N = vec2(m.s, c.s), r = vec2(m.t, c.t), o = vec2(m.p, c.p), a = vec2(m.q, c.q);\r\n    vec4 G = 1.79284 - .853735 * vec4(dot(N, N), dot(o, o), dot(r, r), dot(a, a));\r\n    N *= G.s;\r\n    o *= G.t;\r\n    r *= G.p;\r\n    a *= G.q;\r\n    float i = dot(N, vec2(h.s, e.s)), n = dot(r, vec2(h.t, e.t)), l = dot(o, vec2(h.p, e.p)), I = dot(a, vec2(h.q, e.q));\r\n    vec2 u = fade(d.st), S = mix(vec2(i, l), vec2(n, I), u.s);\r\n    float g = mix(S.s, S.t, u.t);\r\n    return 2.3 * g;\r\n}\r\nhighp float GetInterleavedGradientNoise(highp vec2 t) { return clamp(fract(52.9829 * fract(.0671106 * t.s + .00583715 * t.t)), 0., .999); }\r\n#endif\r\n\r\n#define STIPPLE_TRANSPARENCY_ENABLED\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR) || defined(STIPPLE_TRANSPARENCY_CLIP_FAR)\r\nuniform vec4 uStippleTransparencyClipParams;\r\n#endif\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nfloat GetStippleTransparencyAlpha(float S, inout float R)\r\n{\r\n    float f = 1.;\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_NEAR)\r\n    float d = (S - (uZBufferParams.q + uStippleTransparencyClipParams.s)) * uStippleTransparencyClipParams.t;\r\n    f *= clamp(d, 0., 1.);\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_CLIP_FAR)\r\n    float u = 1. - (S - (abs(uZBufferParams.p) - uStippleTransparencyClipParams.p)) * uStippleTransparencyClipParams.q;\r\n    f *= clamp(u, 0., 1.);\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_ALPHA)\r\n    f *= clamp(R + .005, 0., 1.);\r\n    R = 1.;\r\n#endif\r\n    return f;\r\n}\r\nbool IsStipplePixelVisible(highp vec3 S, highp vec2 R, inout float d)\r\n{\r\n    float u = GetStippleViewSpaceDepthFromPos(S);\r\n    return GetStippleTransparencyAlpha(u, d) > GetInterleavedGradientNoise(R);\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n#endif\r\n\r\n#ifndef STIPPLE_CUTOUT_UTILS_INC\r\n#define STIPPLE_CUTOUT_UTILS_INC\r\n#if defined(STIPPLE_TRANSPARENCY_CUTOUT)\r\n#ifndef STIPPLE_COMMON_INC\r\n#define STIPPLE_COMMON_INC\r\nhighp float GetStippleViewSpaceDepthFromPos(vec3 S)\r\n{\r\n    vec3 u = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    return dot(S, u);\r\n}\r\n#endif\r\n\r\n#ifndef NOISE_UTILS_INC\r\n#define NOISE_UTILS_INC\r\nvec4 permute(vec4 t)\r\n{\r\n    return mod((t * 34. + 1.) * t, 289.);\r\n}\r\nvec2 fade(vec2 t) { return t * t * t * (t * (t * 6. - 15.) + 10.); }\r\nfloat cnoise(highp vec2 t)\r\n{\r\n    highp vec4 v = floor(t.stst) + vec4(0., 0., 1., 1.), d = fract(t.stst) - vec4(0., 0., 1., 1.);\r\n    v = mod(v, 289.);\r\n    vec4 p = v.spsp, s = v.ttqq, h = d.spsp, e = d.ttqq, f = permute(permute(p) + s), m = 2. * fract(f * .0243902) - 1., c = abs(m) - .5, q = floor(m + .5);\r\n    m = m - q;\r\n    vec2 N = vec2(m.s, c.s), r = vec2(m.t, c.t), o = vec2(m.p, c.p), a = vec2(m.q, c.q);\r\n    vec4 G = 1.79284 - .853735 * vec4(dot(N, N), dot(o, o), dot(r, r), dot(a, a));\r\n    N *= G.s;\r\n    o *= G.t;\r\n    r *= G.p;\r\n    a *= G.q;\r\n    float i = dot(N, vec2(h.s, e.s)), n = dot(r, vec2(h.t, e.t)), l = dot(o, vec2(h.p, e.p)), I = dot(a, vec2(h.q, e.q));\r\n    vec2 u = fade(d.st), S = mix(vec2(i, l), vec2(n, I), u.s);\r\n    float g = mix(S.s, S.t, u.t);\r\n    return 2.3 * g;\r\n}\r\nhighp float GetInterleavedGradientNoise(highp vec2 t) { return clamp(fract(52.9829 * fract(.0671106 * t.s + .00583715 * t.t)), 0., .999); }\r\n#endif\r\n\r\n#define STIPPLE_CUTOUT_STIPPLED_ALPHA_MULTIPLIER 2.0\r\nfloat GetStippleCutoutAdjustedAlpha(vec3 S, vec2 u, float G)\r\n{\r\n    float v = uStippleCutoutPosDepthVisibility.p, p = GetStippleViewSpaceDepthFromPos(S);\r\n    const float T = 500., f = 500., t = 1. / f;\r\n    float i = 0.f;\r\n    if (p < v + T)\r\n    {\r\n        float l = abs(p - (v + T));\r\n        l = clamp(l * t, 0., 1.);\r\n        vec2 c = u * 2. - vec2(1.), a = c - uStippleCutoutPosDepthVisibility.st;\r\n        a = a;\r\n        float d = uProjectionMatrix[1][1] / uProjectionMatrix[0][0];\r\n        a.s *= d;\r\n        float I = uStippleCutoutPosDepthVisibility.q, R = uStippleCutoutStartRangeAndMinAlpha.s, s = uStippleCutoutStartRangeAndMinAlpha.t, e = uStippleCutoutStartRangeAndMinAlpha.p, o = clamp((length(a) - R) * s, 0., 1.);\r\n        i = mix(pow(l * (1. - o), 2.), 0., I) - e;\r\n    }\r\n    return i;\r\n}\r\nbool IsStippleCutoutVisible(vec3 S, vec2 v, vec2 l) { return GetStippleCutoutAdjustedAlpha(S, v, STIPPLE_CUTOUT_STIPPLED_ALPHA_MULTIPLIER) > GetInterleavedGradientNoise(l); }\r\n#endif\r\n#endif\r\n\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifndef LIGHTING_INC\r\n#define LIGHTING_INC\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\n\r\nstruct LightingTerms\r\n{\r\n    vec3 Diffuse;\r\n    vec3 Specular;\r\n};\r\nvoid ClearLightingTerms(inout LightingTerms v) { v.Diffuse = vec3(0., 0., 0.), v.Specular = vec3(0., 0., 0.); }\r\nvoid AddLightingTerms(inout LightingTerms v, LightingTerms L) { v.Diffuse += L.Diffuse, v.Specular += L.Specular; }\r\nvoid EvaluateDirLightRT5(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, float S, float c, float F, float e, float E, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 G = normalize(d + i);\r\n    float r = FresnelSchlick(S, clamp(dot(i, G), 0., 1.), F);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(G, f, L, i, d, E, c, .5, .5);\r\n#else\r\n    vec3 n = vec3(r) * vec3(RunescapeRT5BRDF(G, f, c));\r\n#endif\r\n    n *= A * e;\r\n    v.Specular += n;\r\n#endif\r\n}\r\nvoid EvaluateDirLightRT7(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, vec3 S, float c, float E, float G, float e, float F, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 r = normalize(d + i), n = FresnelSchlick(S, clamp(dot(i, r), 0., 1.), G);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(r, f, L, i, d, F, c, .5, .5);\r\n#else\r\n    vec3 C = CookTorranceBRDF(c, E, n, f, r, d, i, F);\r\n#endif\r\n    C *= A * e;\r\n    v.Specular += C;\r\n#endif\r\n}\r\nfloat SpecularHorizonOcclusion(float L, vec3 i, vec3 v)\r\n{\r\n    vec3 d = reflect(i, v);\r\n    float A = clamp(1. + L * dot(d, v), 0., 1.);\r\n    A *= A;\r\n    return A;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n\r\nvoid main()\r\n{\r\n#if defined(DEBUG_VERTEX_BONE_COLOUR)\r\n    gl_FragColor = vec4(vVertexAlbedo);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(ALPHA_ENABLED)\r\n    if (vVertexAlbedo.q == 0.)\r\n    {\r\n        discard;\r\n    }\r\n#endif\r\n    highp vec4 d = vec4(vWorldPosition.stp, 1.);\r\n#if defined(CLIP_PLANE) && !defined(PUSH_TO_FARPLANE)\r\n    if (dot(d, uClipPlane) < 0.)\r\n    {\r\n        discard;\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS)\r\n    TextureSettings D;\r\n    getTextureSettings(vMaterialSettingsSlotXY_BatchFlags.st, D);\r\n#endif\r\n    highp vec2 v = vec2(0.), p = vec2(0.);\r\n    highp vec3 r = vec3(0.), q = vec3(0.);\r\n    vec4 u = vec4(1.), s;\r\n#if defined(COMPRESSED_NORMALS)\r\n    s = vec4(0., .5, 0., .5);\r\n#else\r\n    s = vec4(0., .5, 1., .5);\r\n#endif\r\n    highp vec3 S = d.stp - uCameraPosition;\r\n#if defined(TEXTURE_ATLAS)\r\n    highp float G = uTextureAnimationTime;\r\n    vec2 t = vTextureUV + fract(D.uvAnim * G);\r\n    CalculateDerivatives(v, p, r, q, t, S);\r\n    SampleTextures(u, s, t, D, vMaterialSettingsSlotXY_BatchFlags.p, v, p);\r\n#endif\r\n    float i = 1., g = 0., C = 0.;\r\n    vec3 n = step(.5, fract(vMaterialSettingsSlotXY_BatchFlags.p * vec3(64., 32., 16.)));\r\n#if !defined(TEXTURE_ALBEDO_GLOBAL)\r\n    n.sp *= step(.5, fract(vMaterialSettingsSlotXY_BatchFlags.p * 8.));\r\n#endif\r\n    i += n.s * u.q * 4.;\r\n    g = n.t;\r\n    C = n.p * u.q;\r\n    u.q = min(u.q + n.s + n.p, 1.);\r\n    vec4 f = u * vVertexAlbedo;\r\n#if defined(DEBUG_GEOMETRY_INSTANCE_COLOUR)\r\n    gl_FragColor = vec4(uDebugInstanceColour.stp, f.q);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(ALPHA_ENABLED)\r\n    if (f.q <= uAlphaTestThreshold)\r\n    {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_CUTOUT) && defined(VIEWPORTLOOKUPSCALE)\r\n    if (fract(vMaterialSettingsSlotXY_BatchFlags.p * 4.) > .5)\r\n    {\r\n#if defined(ALPHA_ENABLED)\r\n        if (uAlphaTestThreshold > .01)\r\n        {\r\n            if (IsStippleCutoutVisible(S, gl_FragCoord.st * uViewportLookupScale.st, gl_FragCoord.st))\r\n            {\r\n                discard;\r\n            }\r\n        }\r\n        else\r\n            f.q *= 1.f - GetStippleCutoutAdjustedAlpha(S, gl_FragCoord.st * uViewportLookupScale.st, 1.);\r\n#else\r\n        if (IsStippleCutoutVisible(S, gl_FragCoord.st * uViewportLookupScale.st, gl_FragCoord.st))\r\n        {\r\n            discard;\r\n        }\r\n#endif\r\n    }\r\n#endif\r\n\r\n#if defined(STIPPLE_TRANSPARENCY_ENABLED)\r\n    if (!IsStipplePixelVisible(S, gl_FragCoord.st, f.q))\r\n    {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n#if defined(GOURAUD_SHADING)\r\n    gl_FragColor = f;\r\n    return;\r\n#endif\r\n    highp vec3 e = normalize(vNormal), T = vec3(0., 1., 0.), P = vec3(0., 1., 0.);\r\n#if defined(PER_FRAGMENT_TANGENTS)\r\n    ComputeTangentBitangentFromDerivatives(T, P, e, r, q, v, p);\r\n#endif\r\n\r\n#if defined(USE_NORMAL_MAP)\r\n\r\n#if !defined(PER_FRAGMENT_TANGENTS)\r\n    T = normalize(vTangent.stp);\r\n    P = ComputeBitangent(e, vTangent);\r\n#endif\r\n    vec3 A = UnpackNormal(s.tpq, D.normalScale);\r\n    e = ApplyNormalMap(A, e, T, P);\r\n#endif\r\n\r\n#if defined(DEBUG_TANGENTS) || defined(DEBUG_BITANGENTS)\r\n\r\n#if defined(DEBUG_TANGENTS)\r\n    gl_FragColor.stp = normalize(T) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_BITANGENTS)\r\n    gl_FragColor.stp = normalize(P) * .5 + .5;\r\n    gl_FragColor.q = 1.;\r\n#endif\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(VIEWPORTMAP)\r\n    f.stp = SampleViewportMapColour(gl_FragCoord.st, D.viewportMapUVScaleAndAnim);\r\n#endif\r\n\r\n#if defined(DEBUG_TEXEL_DENSITY)\r\n\r\n#if defined(TEXTURE_ATLAS)\r\n    gl_FragColor = vec4(GetTexelDensityDebugColour(vTextureUV, D.textureMeta1.p, S), 1.);\r\n#else\r\n    gl_FragColor = vec4(1.);\r\n#endif\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(VIEWPORTLOOKUPSCALE)\r\n    vec2 E = gl_FragCoord.st * uFullScreenLookupScale.st;\r\n#endif\r\n    float h = 1.;\r\n#if defined(SSAO) && !defined(REFRACTION)\r\n    h = texture2D(uSSAOMap, E).s;\r\n#endif\r\n    LightingTerms m;\r\n    ClearLightingTerms(m);\r\n    m.Diffuse = uAmbientColour;\r\n    vec3 l = vec3(1., 1., 1.);\r\n#if defined(IRRADIANCE_LIGHTING)\r\n    l = EvaluateSHLighting2ndOrder(e, uIrradianceSHCoefs);\r\n    m.Diffuse *= l;\r\n#endif\r\n\r\n#if defined(SSAO)\r\n    m.Diffuse *= h;\r\n#endif\r\n    highp float V = length(S);\r\n    highp vec3 a = S / V;\r\n    LightingTerms R;\r\n    ClearLightingTerms(R);\r\n#if defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    int I = -1;\r\n    float F = 0.;\r\n#if defined(DEFERRED_SHADOWS)\r\n    R = EvaluateSunlightRT5(F, e, P, -a, E, D.specular, g);\r\n#else\r\n    highp vec3 O = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    highp float o = abs(dot(S, O));\r\n    float L = step(.5, fract(vMaterialSettingsSlotXY_BatchFlags.p * 2.));\r\n    R = EvaluateSunlightRT5(I, F, d, e, P, o, -a, D.specular, g, L);\r\n#endif\r\n\r\n#else\r\n    R.Diffuse = vec3(1.);\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && defined(DEBUG_MATERIAL_HIGHLIGHT)\r\n    if (uDebugMaterialHighlight != -1.)\r\n    {\r\n        float c = mix(.1, .5, length(R.Diffuse)), N = .1;\r\n        vec3 U = mix(vec3(N) * c, vec3(0, 1, 0), D.materialID == uDebugMaterialHighlight ? 1 : 0);\r\n        gl_FragColor = vec4(U, 1);\r\n        if (uDebugReturn != 0.)\r\n        {\r\n            return;\r\n        }\r\n    }\r\n#endif\r\n    float N = FresnelSchlick(.8, max(0., dot(-a, e)), 5.);\r\n#if defined(TEXTURE_ATLAS) && defined(GLOBAL_ENVIRONMENTMAPPING)\r\n    if (C > 0.)\r\n    {\r\n        vec3 c = reflect(-a, e);\r\n        c.s = -c.s;\r\n        c.t = -c.t;\r\n        m.Specular = textureCubeSRGB(uGlobalEnvironmentMap, c).stp * h;\r\n#if defined(NORMALIZED_ENVIRONMENTMAPPING)\r\n        m.Specular *= l * uGlobalEnvironmentMappingParams.q;\r\n#endif\r\n        f.stp = mix(f.stp, m.Specular, C * N);\r\n    }\r\n#endif\r\n    vec4 c = vec4(0., 0., 0., f.q);\r\n#if defined(POINT_LIGHTING)\r\n    vec3 U = vec3(0., 0., 0.), M = vec3(0., 0., 0.);\r\n    const vec3 B = vec3(.65, .65, .65);\r\n    const float H = 1., b = 5.;\r\n    EvaluatePointLights(U, M, B, D.specular, H, b, -a, vWorldPosition.stp, e, o, vTilePosition);\r\n#if defined(DEBUG_POINTLIGHTS)\r\n    gl_FragColor = vec4(U, f.q);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DEBUG_POINTLIGHTS_SPECULAR)\r\n    gl_FragColor = vec4(M, f.q);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DIFFUSE_LIGHTING)\r\n    R.Diffuse += U;\r\n#else\r\n    R.Diffuse = U;\r\n#endif\r\n\r\n#if defined(POINT_LIGHTING_SPECULAR)\r\n    R.Specular += M;\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(DEBUG_POINTLIGHTS)\r\n    gl_FragColor = vec4(0., 0., 0., 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DEBUG_POINTLIGHTS_SPECULAR)\r\n    gl_FragColor = vec4(0., 0., 0., 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if !defined(DIFFUSE_LIGHTING)\r\n    R.Diffuse = vec3(0.);\r\n#endif\r\n\r\n#endif\r\n    float x = 0.;\r\n#if defined(CAUSTICS)\r\n    x = CalculateCausticsTerm(vWorldPosition.stp, F, e);\r\n#endif\r\n\r\n#if defined(AMBIENT_LIGHTING)\r\n    c.stp += m.Diffuse;\r\n#endif\r\n    c.stp += R.Diffuse;\r\n#if defined(SPECULAR_LIGHTING)\r\n    c.stp += R.Specular * i;\r\n#endif\r\n\r\n#if defined(CAUSTICS)\r\n    c.stp += uSunColour * x;\r\n#endif\r\n\r\n#if defined(ALBEDO_LIGHTING)\r\n    c.stp *= f.stp;\r\n#endif\r\n\r\n#if defined(DEBUG_EMISSIVE_MAP)\r\n    c.stp = vec3(g);\r\n#else\r\n    if (g > 0.)\r\n        c.q *= c.q;\r\n    c.stp = mix(c.stp, f.stp, g);\r\n#endif\r\n\r\n#if defined(REFRACTION)\r\n    if (D.refraction.s > 0. || D.refraction.p > 0.)\r\n        c.stp = CalculateRefractionColour(vWorldPosition.stp, e, -a, D.specular, D.refraction, e.sp, c);\r\n#endif\r\n\r\n#if defined(LIGHT_SCATTERING) || defined(FOG_DISTANCE)\r\n    c.stp = ApplyInOutScattering(c.stp, vOutScattering, vInScattering);\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_SUPPORTED)\r\n    vec4 Y = GetScatteredInRay2(8, a, V, CalculateScatteringOffset(gl_FragCoord.st));\r\n    c = ApplyVolumetricScattering(c, Y);\r\n#endif\r\n\r\n#if defined(TINT) && defined(PUSH_TO_FARPLANE)\r\n    c.stp += uTint.stp;\r\n#endif\r\n\r\n#if defined(DEBUG_ALBEDO)\r\n    c = f;\r\n#endif\r\n\r\n#if defined(DEBUG_NORMALS)\r\n    c.stp = e * .5 + .5;\r\n    c.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_FRESNEL)\r\n    c.stp = vec3(N, N, N);\r\n    c.q = 1.;\r\n#endif\r\n\r\n#if defined(DEBUG_SPECULAR_MAP)\r\n    c.stp = vec3(max(0., (i - .5) / 4.));\r\n#endif\r\n\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEBUG_SUNLIGHT_SHADOW_CASCADE) && !defined(DEFERRED_SHADOWS)\r\n    c.stp = ShadowMapCascadeColour(I, int(uMappingParams.q)).stp;\r\n#endif\r\n\r\n#if defined(DEBUG_RT7_EMISSIVE) || defined(DEBUG_RT7_METALNESS) || defined(DEBUG_RT7_ROUGHNESS)\r\n    c = vec4(1., 0., 1., 1.);\r\n#endif\r\n\r\n#if defined(FORCE_OPAQUE)\r\n    c.q = 1.;\r\n#endif\r\n\r\n#if defined(PREMULTIPLY_ALPHA)\r\n    c.stp *= c.q;\r\n#endif\r\n    gl_FragColor = c;\r\n}\r\n"
},8977:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define TEXTURE_ALBEDO_GLOBAL\r\n#define SUNLIGHT_DIRECT_LIGHTING\r\n#define TEXTURE_ATLAS\r\n#define VIEW_TRANSFORMS\r\n#define TINT\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nattribute vec4 aVertexPosition_BoneLabel;\r\nattribute vec2 aTextureUV;\r\nattribute vec4 aVertexNormal_BatchFlags, aVertexTangent, aVertexColour, aVertexColourUnwhitenedRGB_TilePositionLevel, aMaterialSettingsSlotXY_TilePositionXZ, aVertexSkinBones, aVertexSkinWeights;\r\nuniform float uSmoothSkinning;\r\nuniform mat4 uModelMatrix;\r\nuniform float uVertexScale;\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\nuniform mediump vec4 uTint;\r\nuniform float uFade;\r\nout highp vec3 vWorldPosition;\r\nout highp vec3 vNormal;\r\nout mediump vec4 vVertexAlbedo;\r\nout vec2 vTextureUV;\r\nflat out vec3 vMaterialSettingsSlotXY_BatchFlags;\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\n#if defined(TEXTURE_ATLAS) && defined(NORMAL_MAP)\r\n#define USE_NORMAL_MAP\r\n#endif\r\n\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#if defined(ANIMATION_VERTEX)\r\n#if defined(USE_BONE_HALF_FLOATS)\r\nmat4 GetBoneFromIndex(float u)\r\n{\r\n    uint f = uint(u), v = f % 2u, n = (f * 3u - v) / 2u;\r\n    uvec4 d = (1u - v) * uBoneTransforms[n] + v * uvec4(uBoneTransforms[n].pq, uBoneTransforms[n + 1u].st);\r\n    uvec2 G = (1u - v) * uvec2(uBoneTransforms[n + 1u].st) + v * uvec2(uBoneTransforms[n + 1u].pq);\r\n    vec2 m = unpackHalf2x16(d.s), A = unpackHalf2x16(d.t), e = unpackHalf2x16(d.p), U = unpackHalf2x16(d.q), s = unpackHalf2x16(G.s), a = unpackHalf2x16(G.t);\r\n    mat4 t = mat4(vec4(m.st, A.s, 0.), vec4(A.t, e.st, 0.), vec4(U.st, s.s, 0.), vec4(s.t, a.st, 1.));\r\n    return t;\r\n}\r\n#else\r\nmat4 GetBoneFromIndex(float u)\r\n{\r\n    int n = int(u * 3.);\r\n    return mat4(vec4(uBoneTransforms[n].stp, 0.), vec4(uBoneTransforms[n].q, uBoneTransforms[n + 1].st, 0.), vec4(uBoneTransforms[n + 1].pq, uBoneTransforms[n + 2].s, 0.), vec4(uBoneTransforms[n + 2].tpq, 1.));\r\n}\r\n#endif\r\n#endif\r\n\r\nvoid AssignTextureAtlasVaryings(out vec2 d, out vec2 v, vec2 s, vec2 p)\r\n{\r\n    d = s.st, v = p;\r\n}\r\nmat3 ResolveNormalTransformMatrix(mat4 v)\r\n{\r\n    mat3 p = Mat4ToMat3(v);\r\n#if defined(ANIMATION_VERTEX)\r\n    const highp float d = 2e-16;\r\n    float s = step(d, abs(p[0].s) + abs(p[1].t));\r\n    p[0].s = mix(1., p[0].s, s);\r\n    p[1].t = mix(1., p[1].t, s);\r\n#endif\r\n    return p;\r\n}\r\nvec2 ClipSpacePosToUVSpacePos(vec2 s) { return s.st * .5 + vec2(.5, .5); }\r\nvec4 OffsetPositionAlongNormal(vec4 p, vec3 s, vec4 t, vec2 d, float v)\r\n{\r\n    if (v <= 0.)\r\n        return t;\r\n    else\r\n    {\r\n        vec2 a = t.st / t.q, l = ClipSpacePosToUVSpacePos(a) * d;\r\n        vec4 f = p;\r\n        f.stp -= s;\r\n        vec4 u = uViewProjMatrix * f;\r\n        vec2 G = ClipSpacePosToUVSpacePos(u.st / u.q) * d;\r\n        u.st = a;\r\n        vec2 q = G - l;\r\n        q = -q;\r\n        float A = dot(q, q);\r\n        if (A > 0.)\r\n            q /= sqrt(A), u.st += q * v / d;\r\n        u.st *= u.q;\r\n        return u;\r\n    }\r\n}\r\n#if defined(ANIMATION_VERTEX)\r\nmat4 GetBoneMatrix(out float s)\r\n{\r\n    s = floor(aVertexPosition_BoneLabel.q / 256.);\r\n    float v = aVertexPosition_BoneLabel.q - s * 256.;\r\n    mat4 p = GetBoneFromIndex(v), f = uSmoothSkinning < 0. ? mat4(1.) : GetBoneFromIndex(aVertexSkinBones.s);\r\n    if (uSmoothSkinning > 0.)\r\n    {\r\n        f *= aVertexSkinWeights.s;\r\n        mat4 u = GetBoneFromIndex(aVertexSkinBones.t);\r\n        f += u * aVertexSkinWeights.t;\r\n        u = GetBoneFromIndex(aVertexSkinBones.p);\r\n        f += u * aVertexSkinWeights.p;\r\n        u = GetBoneFromIndex(aVertexSkinBones.q);\r\n        f += u * aVertexSkinWeights.q;\r\n    }\r\n    return f * p;\r\n}\r\nmat4 GetBoneMatrixRigid(out float s)\r\n{\r\n    s = floor(aVertexPosition_BoneLabel.q / 256.);\r\n    float v = aVertexPosition_BoneLabel.q - s * 256.;\r\n    mat4 p = GetBoneFromIndex(v), u = uSmoothSkinning < 0. ? mat4(1.) : GetBoneFromIndex(aVertexSkinBones.s);\r\n    return u * p;\r\n}\r\n#endif\r\nvoid AssignPositionNormalVaryings(out float v)\r\n{\r\n    vec3 u = aVertexPosition_BoneLabel.stp;\r\n    mat4 p;\r\n#if defined(ANIMATION_VERTEX)\r\n    mat4 d = GetBoneMatrix(v), s = uModelMatrix;\r\n    p = s * d;\r\n#else\r\n    v = 0.;\r\n    p = uModelMatrix;\r\n#endif\r\n    vec3 a = u * uVertexScale;\r\n    vec4 t = p * vec4(a, 1.),\r\n         q = uViewProjMatrix * t;\r\n#if !defined(MODEL_GEOMETRY_SHADOW_VS)\r\n    mat3 f = ResolveNormalTransformMatrix(p);\r\n    vNormal = f * aVertexNormal_BatchFlags.stp;\r\n    vNormal = normalize(vNormal);\r\n    vNormal = isNaN(vNormal.s) ? vec3(0., 1., 0.) : vNormal;\r\n#if defined(USE_NORMAL_MAP) && !defined(PER_FRAGMENT_TANGENTS)\r\n    vTangent.stp = f * aVertexTangent.stp;\r\n    vTangent.stp = normalize(vTangent.stp);\r\n    vTangent.stp = isNaN(vTangent.s) ? vec3(1., 0., 0.) : vTangent.stp;\r\n    vTangent.q = aVertexTangent.q;\r\n#endif\r\n\r\n#if defined(MODEL_GEOMETRY_HIGHLIGHT_VS)\r\n    q = OffsetPositionAlongNormal(t, vNormal, q, uViewportLookupScale.pq, uHighlightScale);\r\n#endif\r\n    vWorldPosition = t.stp;\r\n#endif\r\n    gl_Position = q;\r\n#if !defined(ANIMATION_VERTEX) && defined(PUSH_TO_FARPLANE)\r\n    gl_Position.p = gl_Position.q * .9999;\r\n#endif\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    float d = 1.;\r\n    AssignPositionNormalVaryings(d);\r\n#if defined(TEXTURE_ATLAS)\r\n\r\n#if defined(TEXTURE_ALBEDO_GLOBAL)\r\n    vVertexAlbedo = aVertexColour;\r\n#else\r\n    vVertexAlbedo = vec4(mix(aVertexColourUnwhitenedRGB_TilePositionLevel.stp, aVertexColour.stp, step(.5, fract(aVertexNormal_BatchFlags.q * 8.))), aVertexColour.q);\r\n#endif\r\n\r\n#else\r\n    vVertexAlbedo = vec4(aVertexColourUnwhitenedRGB_TilePositionLevel.stp, aVertexColour.q);\r\n#endif\r\n    // vVertexAlbedo.q += uFade;\r\n#if defined(TINT)\r\n\r\n#if !defined(PUSH_TO_FARPLANE)\r\n    // vVertexAlbedo.stp = vVertexAlbedo.stp + uTint.q * (uTint.stp - vVertexAlbedo.stp);\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(ANIMATION_VERTEX)\r\n    vVertexAlbedo.q += uLabelDeltas[int(d)].q;\r\n    vVertexAlbedo.q = clamp(vVertexAlbedo.q, 0., 1.);\r\n#if defined(ANIMATION_COLOUR_RGB) || defined(ANIMATION_COLOUR_HSL)\r\n\r\n#if defined(ANIMATION_COLOUR_RGB)\r\n    vVertexAlbedo.stp += uLabelDeltas[int(d)].stp;\r\n#endif\r\n\r\n#if defined(ANIMATION_COLOUR_HSL)\r\n    vVertexAlbedo = convertRGBtoHSL(vVertexAlbedo);\r\n    vVertexAlbedo.s = fract(vVertexAlbedo.s + uLabelDeltas[int(d)].s);\r\n    vVertexAlbedo.tp = clamp(vVertexAlbedo.tp + uLabelDeltas[int(d)].tp, 0., 1.);\r\n    vVertexAlbedo = convertHSLtoRGB(vVertexAlbedo);\r\n#endif\r\n\r\n#if defined(BAKED_SRGB_TO_LINEAR) && !defined(GAMMA_CORRECT_INPUTS)\r\n    vVertexAlbedo.stp = SRGBToLinear(vVertexAlbedo.stp);\r\n#endif\r\n\r\n#endif\r\n\r\n#endif\r\n\r\n#if !defined(BAKED_SRGB_TO_LINEAR) && defined(GAMMA_CORRECT_INPUTS)\r\n    vVertexAlbedo.stp = SRGBToLinear(vVertexAlbedo.stp);\r\n#endif\r\n\r\n#if defined(GOURAUD_SHADING)\r\n    float p = dot(vNormal, uInvSunDirection);\r\n    vVertexAlbedo.stp = vVertexAlbedo.stp * (uAmbientColour + uSunColour * p);\r\n#endif\r\n\r\n#if defined(POINT_LIGHTING)\r\n    vTilePosition = vec3(floor(aVertexColourUnwhitenedRGB_TilePositionLevel.q * 255. + .1), aMaterialSettingsSlotXY_TilePositionXZ.pq);\r\n#endif\r\n    vMaterialSettingsSlotXY_BatchFlags.p = aVertexNormal_BatchFlags.q + .25 / 128.;\r\n#if defined(TEXTURE_ATLAS)\r\n    AssignTextureAtlasVaryings(vTextureUV, vMaterialSettingsSlotXY_BatchFlags.st, aTextureUV, aMaterialSettingsSlotXY_TilePositionXZ.st);\r\n#endif\r\n\r\n#if defined(DEBUG_VERTEX_BONE_COLOUR)\r\n\r\n#if defined(ANIMATION_VERTEX)\r\n    vVertexAlbedo.stpq = vec4(mod(aVertexPosition_BoneLabel.q / 5., 1.), mod(aVertexPosition_BoneLabel.q / 14., 1.), mod(aVertexPosition_BoneLabel.q / 63., 1.), 1.);\r\n#else\r\n    vVertexAlbedo.stpq = vec4(0.);\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(LIGHT_SCATTERING) || defined(FOG_DISTANCE)\r\n    vec4 o = uModelMatrix * vec4(aVertexPosition_BoneLabel.stp, 1.);\r\n    vec3 v = o.stp - uCameraPosition;\r\n    float a = length(v);\r\n#if defined(LIGHT_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    ComputeInOutScattering(normalize(v), a, uInvSunDirection.stp, vOutScattering, vInScattering);\r\n#else\r\n    vOutScattering = vec3(1.);\r\n    vInScattering = vec3(0.);\r\n#endif\r\n\r\n#if defined(FOG_DISTANCE)\r\n    float q = FogBasedOnDistance(a);\r\n    vInScattering = mix(vInScattering, uFogColour.stp, q);\r\n    vOutScattering *= 1. - q;\r\n#endif\r\n\r\n#endif\r\n}\r\n"
},929:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define SHADER_TYPE_PIXEL\r\n\r\nout vec4 gl_FragColor;\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define VIEW_TRANSFORMS\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\n\r\nUNIFORM_BUFFER_BEGIN(Sunlight)\r\nuniform highp vec3 uInvSunDirection;\r\nuniform mediump vec3 uAmbientColour;\r\nuniform mediump vec3 uSunColour;\r\nuniform mediump float uDummy;\r\nUNIFORM_BUFFER_END\r\nuniform lowp vec4 uWaterFeatureFlags;\r\nuniform highp vec4 uWaterNormalMapTextureScales_FlowNoiseScale;\r\nuniform highp vec2 uWaterTickFade;\r\nuniform vec4 uWaterNormalBRDFParams;\r\nuniform vec3 uWaterSpecularColour;\r\nin highp vec4 vPosition_WaterDepth;\r\nin vec4 vColour;\r\nin highp vec4 vFlowControlMask_ViewSpaceDepth;\r\nin highp vec4 vNoisyPatchFlow0_NoisyPatchFlow1;\r\nin highp vec4 vNoisyPatchFlow2_UVPack_NormalsFlow0Map0;\r\nin highp vec4 vUVPack_NormalsFlow0Map1_NormalsFlow0Map2;\r\nin highp vec4 vUVPack_NormalsFlow1Map0_NormalsFlow1Map1;\r\nin highp vec4 vUVPack_NormalsFlow1Map2_NormalsFlow2Map0;\r\nin highp vec4 vUVPack_NormalsFlow2Map1_NormalsFlow2Map2;\r\nin highp vec4 vUVPack_NormalMapMacroUV_EmissiveUV[3];\r\nin highp vec2 vUVPack_FoamUV;\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n\r\nvec4 textureCubeSRGB(samplerCube sampler, vec3 reflDir)\r\n{\r\n    vec4 texel = textureCube(sampler, reflDir);\r\n    return texel;\r\n}\r\n\r\nvec4 textureCubeSRGB(samplerCube sampler, vec3 reflDir, float lod)\r\n{\r\n    vec4 texel = textureCube(sampler, reflDir, lod);\r\n    return texel;\r\n}\r\n\r\nvec4 textureCubeLodSRGB(samplerCube sampler, vec3 reflDir, float lod)\r\n{\r\n    vec4 texel = textureCubeLodCompat(sampler, reflDir, lod);\r\n    return texel;\r\n}\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\nvec3 UnpackCompressedNormal(vec3 U)\r\n{\r\n    vec3 v = vec3(U.ps * 255. / 127. - 1.00787, 0.);\r\n    v.p = sqrt(1. - min(1., dot(v.st, v.st)));\r\n    v.t = -v.t;\r\n    return v;\r\n}\r\nvec3 UnpackNormal(vec3 v, float U)\r\n{\r\n    vec3 t;\r\n#if defined(COMPRESSED_NORMALS)\r\n    t = UnpackCompressedNormal(v);\r\n#else\r\n    t = v.pst * 255. / 127. - 1.00787;\r\n    t.t = -t.t;\r\n#endif\r\n    t.st *= U;\r\n    return t;\r\n}\r\nvec3 UnpackNormal(vec3 U) { return UnpackNormal(U, 1.); }\r\nvec3 UnpackNormal(vec4 v) { return UnpackNormal(v.tpq, 1.); }\r\nvec3 UnpackNormal(vec4 v, float U) { return UnpackNormal(v.tpq, U); }\r\n\r\nconst highp float CAUSTICS_FIXED_POINT_SCALE = 10000.;\r\n#if defined(CAUSTICS) && !defined(CAUSTICS_COMPUTE) && !defined(CAUSTICS_STENCIL)\r\nfloat CalculateCausticsTerm(highp vec3 u, float t, vec3 e)\r\n{\r\n    float i = 0., s = 0.;\r\n    if (u.t <= uCausticsPlaneHeight)\r\n        s = step(1., t);\r\n    else\r\n    {\r\n#if defined(CAUSTICS_OVERWATER)\r\n        s = clamp(e.t * -1., 0., 1.);\r\n        float d = smoothstep(uCausticsOverWaterFade.s, uCausticsOverWaterFade.t, u.t - uCausticsPlaneHeight);\r\n        s *= 1. - d;\r\n#else\r\n        return 0.0;\r\n#endif\r\n    }\r\n    if (s > 0.)\r\n    {\r\n        highp vec4 C = uCausticsViewProjMatrix * vec4(u, 1.);\r\n        C.st /= 2. * C.q;\r\n        vec2 f = abs(C.st);\r\n        C.st += .5;\r\n        f = smoothstep(.4, .5, f);\r\n        s *= max(0., 1. - (f.s + f.t));\r\n        if (s > 0.)\r\n            i += textureOffset(uCausticsMap, C.st, ivec2(-1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(-1, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(0, -1)).s, i += texture2D(uCausticsMap, C.st).s * 5., i += textureOffset(uCausticsMap, C.st, ivec2(0, 1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, -1)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 0)).s, i += textureOffset(uCausticsMap, C.st, ivec2(1, 1)).s, i *= s / 12.;\r\n    }\r\n    return i;\r\n}\r\n#endif\r\n#if defined(CAUSTICS_COMPUTE)\r\nvoid WriteCausticsRay(vec3 t, float i)\r\n{\r\n    vec2 s = t.sp * i * uCausticsRefractionScale, C = (gl_FragCoord.st + s * 2.) / uCausticsComputeResolution * uCausticsMapSize;\r\n    highp float u = min(uCausticsFade.s / i * uCausticsFade.t, 7. * uCausticsFade.t), f = smoothstep(uCausticsFade.p, uCausticsFade.q, i), E = f * u * CAUSTICS_FIXED_POINT_SCALE;\r\n    if (E >= 1.f)\r\n        imageAtomicAdd(uCausticsIntegerMap, ivec2(C.st), uint(E));\r\n}\r\n#endif\r\n\r\n#ifndef DEPTH_UTILS_INC\r\n#define DEPTH_UTILS_INC\r\nhighp float GetViewSpaceDepth(highp float v, highp vec3 G)\r\n{\r\n    return G.s / (G.t * v + G.p);\r\n}\r\nhighp vec4 GetViewSpaceDepth(highp vec4 v, highp vec3 G) { return G.s / (G.t * v + G.p); }\r\nhighp vec3 GetViewSpacePos(vec2 v, highp float G, highp mat4 f)\r\n{\r\n    highp vec4 m = vec4(2. * v - 1., 2. * G - 1., 1.), h = f * m;\r\n    h.stp /= h.q;\r\n    return h.stp;\r\n}\r\nhighp vec4 GetWorldSpacePos(vec2 v, highp float G, highp mat4 f)\r\n{\r\n    highp vec4 m = vec4(2. * v - 1., 2. * G - 1., 1.), h = f * m;\r\n    h = h / h.q;\r\n    return h;\r\n}\r\nhighp float GetViewSpaceDepthFromPos(vec3 v, mat4 G)\r\n{\r\n    vec3 h = vec3(G[0][2], G[1][2], G[2][2]);\r\n    return dot(v, h);\r\n}\r\n#if defined(SAMPLER_2D_AUTO_MULTISAMPLE)\r\nhighp vec3 GetViewSpacePos(vec2 v, SAMPLER_2D_AUTO_MULTISAMPLE G, highp mat4 h)\r\n{\r\n    highp float m;\r\n#if defined(VIEWPORTLOOKUPSCALE)\r\n    m = texture2DMultisample(G, v, uViewportLookupScale.pq).s;\r\n#else\r\n    m = texture2DMultisample(G, v, textureSize(G)).s;\r\n#endif\r\n    return GetViewSpacePos(v, m, h);\r\n}\r\nhighp vec3 GetViewSpacePos(vec2 v, vec4 G, vec2 h, SAMPLER_2D_AUTO_MULTISAMPLE f, highp mat4 m)\r\n{\r\n    highp float d = texture2DMultisample(f, v * G.pq + G.st, h).s;\r\n    return GetViewSpacePos(v, d, m);\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef NOISE_UTILS_INC\r\n#define NOISE_UTILS_INC\r\nvec4 permute(vec4 t)\r\n{\r\n    return mod((t * 34. + 1.) * t, 289.);\r\n}\r\nvec2 fade(vec2 t) { return t * t * t * (t * (t * 6. - 15.) + 10.); }\r\nfloat cnoise(highp vec2 t)\r\n{\r\n    highp vec4 v = floor(t.stst) + vec4(0., 0., 1., 1.), d = fract(t.stst) - vec4(0., 0., 1., 1.);\r\n    v = mod(v, 289.);\r\n    vec4 p = v.spsp, s = v.ttqq, h = d.spsp, e = d.ttqq, f = permute(permute(p) + s), m = 2. * fract(f * .0243902) - 1., c = abs(m) - .5, q = floor(m + .5);\r\n    m = m - q;\r\n    vec2 N = vec2(m.s, c.s), r = vec2(m.t, c.t), o = vec2(m.p, c.p), a = vec2(m.q, c.q);\r\n    vec4 G = 1.79284 - .853735 * vec4(dot(N, N), dot(o, o), dot(r, r), dot(a, a));\r\n    N *= G.s;\r\n    o *= G.t;\r\n    r *= G.p;\r\n    a *= G.q;\r\n    float i = dot(N, vec2(h.s, e.s)), n = dot(r, vec2(h.t, e.t)), l = dot(o, vec2(h.p, e.p)), I = dot(a, vec2(h.q, e.q));\r\n    vec2 u = fade(d.st), S = mix(vec2(i, l), vec2(n, I), u.s);\r\n    float g = mix(S.s, S.t, u.t);\r\n    return 2.3 * g;\r\n}\r\nhighp float GetInterleavedGradientNoise(highp vec2 t) { return clamp(fract(52.9829 * fract(.0671106 * t.s + .00583715 * t.t)), 0., .999); }\r\n#endif\r\n\r\n#ifndef LIGHTING_UTILS_H\r\n#define LIGHTING_UTILS_H\r\n#ifndef LIGHTING_INC\r\n#define LIGHTING_INC\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\n#ifndef FRESNEL_INC\r\n#define FRESNEL_INC\r\nvec3 FresnelSchlick(vec3 F, float f, highp float h)\r\n{\r\n    vec3 c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nvec3 FresnelSchlickRoughness(vec3 f, float F, highp float h, float v)\r\n{\r\n    vec3 c = f + (max(vec3(v), f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(float F, float f, highp float h)\r\n{\r\n    float c = F + (1. - F) * pow(1. - f, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlickRoughness(float f, float F, highp float h, float v)\r\n{\r\n    float c = f + (max(v, f) - f) * pow(1. - F, h);\r\n    return c;\r\n}\r\nfloat FresnelSchlick(vec3 F, vec3 f, float c)\r\n{\r\n    float h = max(0., dot(F, f));\r\n    return c + (1. - c) * pow(1. - h, 5.);\r\n}\r\nfloat Fresnel(vec3 F, vec3 f, float c, float h)\r\n{\r\n    float p = 1. - max(0., dot(F, f)), v = p * p;\r\n    v = v * v;\r\n    v = v * p;\r\n    return clamp(v * (1. - clamp(h, 0., 1.)) + h - c, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifndef BRDF_INC\r\n#define BRDF_INC\r\n#ifndef NDF_INC\r\n#define NDF_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat BlinnPhongNDF(float f, float N)\r\n{\r\n    return (f + 2.) * INV_EIGHT * pow(N, f);\r\n}\r\nfloat GGXTrowbridgeReitzNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f, T = I * (P - 1.) + 1.;\r\n    return P / (PI * (T * T + .0001));\r\n}\r\nfloat BeckmannNDF(float N, float f)\r\n{\r\n    float P = N * N, I = f * f;\r\n    return exp((I - 1.) / (P * I)) / (PI * P * (I * I));\r\n}\r\n#endif\r\n\r\n#ifndef VISIBILITY_FUNC_INC\r\n#define VISIBILITY_FUNC_INC\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n\r\nfloat SchlickSmithVis(float V, float f, float S)\r\n{\r\n    float P = 1. / sqrt(PI_OVER_4 * V + PI_OVER_2), d = 1. - P, v = (f * d + P) * (S * d + P);\r\n    return 1. / (v + .0001);\r\n}\r\nfloat KelemenSzirmayKalosVis(vec3 V, vec3 P)\r\n{\r\n    vec3 f = V + P;\r\n    return 4. / max(0., dot(f, f));\r\n}\r\n#endif\r\n\r\n#define GGX_NDF\r\n#define SCHLICK_SMITH_VIS\r\nvec3 CookTorranceBRDF(float d, float S, vec3 n, vec3 v, vec3 f, vec3 B, vec3 R, float F)\r\n{\r\n    float m = max(0., dot(v, f)), r = 1.;\r\n#if defined(BLINN_PHONG_NDF)\r\n    r = BlinnPhongNDF(d, m);\r\n#elif defined(GGX_NDF)\r\n    r = GGXTrowbridgeReitzNDF(PerceptualRoughnessToRoughness(S), m);\r\n#elif defined(BECKMANN_NDF)\r\n    r = max(0.f, BeckmannNDF(SpecPowToBeckmannRoughness(d), m));\r\n#else\r\n\r\n#error CookTorranceBRDF normal distribution function not specified\r\n\r\n#endif\r\n    float C = 1.;\r\n#if defined(SCHLICK_SMITH_VIS)\r\n    C = SchlickSmithVis(d, F, max(0., dot(v, B)));\r\n#elif defined(KELEMEN_SZIRMAY_KALOS_VIS)\r\n    C = KelemenSzirmayKalosVis(R, B);\r\n#endif\r\n    return n * (r * C);\r\n}\r\nfloat RunescapeLegacyBRDF(vec3 d, vec3 v, vec3 f, float B, float S)\r\n{\r\n    vec3 n = reflect(-d, f);\r\n    float C = pow(max(0., dot(n, v)), B);\r\n    return C * S;\r\n}\r\nfloat RunescapeRT5BRDF(vec3 d, vec3 v, float S) { return BlinnPhongNDF(S, max(0., dot(d, v))); }\r\nvec3 ShiftTangent(vec3 d, vec3 S, float B) { return normalize(d + B * S); }\r\nvec3 AnisotropicBRDF(vec3 v, vec3 d, vec3 S, vec3 f, vec3 B, float n, float m, float R, float C)\r\n{\r\n    const float F = 7.5, r = 1., e = .5, o = 1.;\r\n    float s = R - .5;\r\n    S = ShiftTangent(S, d, e + (C * 2. - 1.) * o + s);\r\n    float p = abs(dot(S, f)), a = 1. - p, t = 1. - abs(dot(S, B)), K = p * dot(d, B);\r\n    K += a * t;\r\n    K = pow(K, F) * n;\r\n    K = mix(K, K * C, o);\r\n    float G = pow(dot(d, v), m), P = mix(G, K, r);\r\n    return vec3(P, P, P);\r\n}\r\n#endif\r\n\r\nstruct LightingTerms\r\n{\r\n    vec3 Diffuse;\r\n    vec3 Specular;\r\n};\r\nvoid ClearLightingTerms(inout LightingTerms v) { v.Diffuse = vec3(0., 0., 0.), v.Specular = vec3(0., 0., 0.); }\r\nvoid AddLightingTerms(inout LightingTerms v, LightingTerms L) { v.Diffuse += L.Diffuse, v.Specular += L.Specular; }\r\nvoid EvaluateDirLightRT5(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, float S, float c, float F, float e, float E, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 G = normalize(d + i);\r\n    float r = FresnelSchlick(S, clamp(dot(i, G), 0., 1.), F);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(G, f, L, i, d, E, c, .5, .5);\r\n#else\r\n    vec3 n = vec3(r) * vec3(RunescapeRT5BRDF(G, f, c));\r\n#endif\r\n    n *= A * e;\r\n    v.Specular += n;\r\n#endif\r\n}\r\nvoid EvaluateDirLightRT7(inout LightingTerms v, vec3 f, vec3 L, vec3 d, vec3 i, vec3 S, float c, float E, float G, float e, float F, vec3 A)\r\n{\r\n    v.Diffuse += A * e;\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 r = normalize(d + i), n = FresnelSchlick(S, clamp(dot(i, r), 0., 1.), G);\r\n#if defined(ANISOTROPY_BRDF)\r\n    vec3 D = AnisotropicBRDF(r, f, L, i, d, F, c, .5, .5);\r\n#else\r\n    vec3 C = CookTorranceBRDF(c, E, n, f, r, d, i, F);\r\n#endif\r\n    C *= A * e;\r\n    v.Specular += C;\r\n#endif\r\n}\r\nfloat SpecularHorizonOcclusion(float L, vec3 i, vec3 v)\r\n{\r\n    vec3 d = reflect(i, v);\r\n    float A = clamp(1. + L * dot(d, v), 0., 1.);\r\n    A *= A;\r\n    return A;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\n#endif\r\n\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT5(inout int i, inout float E, highp vec4 v, vec3 u, vec3 f, float d, vec3 n, float p, float S, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n    {\r\n        if (L > 0.)\r\n        {\r\n            highp vec4 h = uSunlightViewMatrix * v, e = vec4(u.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(i, v + e, h + e, d, uSunlightShadowMap, uSunlightShadowTranslucencyMap, r);\r\n        }\r\n    }\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, f, n, uInvSunDirection, h, p, 5., L, t, uSunColour);\r\n    return D;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT5(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, float n, float S)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), L = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (S == 0. && uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    L *= E;\r\n    float h = .65;\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT5(D, u, v, f, uInvSunDirection, h, n, 5., L, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#if !defined(DEFERRED_SHADOWS)\r\nLightingTerms EvaluateSunlightRT7(inout int u, inout float E, highp vec4 v, vec3 f, vec3 d, float n, vec3 h, vec3 L, float p, float i, float t, float S)\r\n{\r\n    float D = max(0., dot(f, uInvSunDirection)), e = D;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n    {\r\n        if (D > 0.)\r\n        {\r\n            highp vec4 r = uSunlightViewMatrix * v, a = vec4(f.st, 0., 0.) * 32.;\r\n            E = DirLightShadowAtten(u, v + a, r + a, n, uSunlightShadowMap, uSunlightShadowTranslucencyMap, S);\r\n        }\r\n    }\r\n#endif\r\n    e *= E;\r\n    LightingTerms r;\r\n    ClearLightingTerms(r);\r\n    EvaluateDirLightRT7(r, f, d, h, uInvSunDirection, L, p, i, t, e, D, uSunColour);\r\n    return r;\r\n}\r\n#else\r\nLightingTerms EvaluateSunlightRT7(inout float E, vec3 u, vec3 v, vec3 f, vec2 d, vec3 n, float h, float L, float r)\r\n{\r\n    float t = max(0., dot(u, uInvSunDirection)), p = t;\r\n    E = 1.;\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEFERRED_SHADOWS)\r\n    if (uMappingParams.p != 0.)\r\n        E = texture2DLod(uShadowBuffer, d, 0.).s;\r\n#endif\r\n    LightingTerms D;\r\n    ClearLightingTerms(D);\r\n    EvaluateDirLightRT7(D, u, v, f, uInvSunDirection, n, h, L, r, t, p, uSunColour);\r\n    return D;\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_UNIFORMS\r\n#define DISTANCE_FOG_UNIFORMS\r\n#if defined(FOG_DISTANCE)\r\nUNIFORM_BUFFER_BEGIN(DistanceFog)\r\nuniform mediump vec4 uFogColour;\r\nuniform highp vec4 uFogParams;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_FUNCTIONS\r\n#define DISTANCE_FOG_FUNCTIONS\r\n#if defined(FOG_DISTANCE)\r\nfloat FogBasedOnDistance(highp float f)\r\n{\r\n    highp float F = (uFogParams.t - f) * uFogParams.s;\r\n    return 1. - clamp(F, 0., 1.);\r\n}\r\nfloat FogBasedOnAngle(highp vec3 f)\r\n{\r\n    highp float F = 1. - clamp(f.t + uFogParams.q, 0., 1.);\r\n    F = pow(F, uFogParams.p);\r\n    return clamp(F, 0., 1.);\r\n}\r\n#endif\r\n#endif\r\n\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nfloat GenerateNoise()\r\n{\r\n    const float d = 512., v = .125;\r\n    return clamp(cnoise(vPosition_WaterDepth.sp / d) * v, 0., 1.);\r\n}\r\nvec2 GetCombinedFlow() { return vNoisyPatchFlow0_NoisyPatchFlow1.st * vFlowControlMask_ViewSpaceDepth.s + vNoisyPatchFlow0_NoisyPatchFlow1.pq * vFlowControlMask_ViewSpaceDepth.t + vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.st * vFlowControlMask_ViewSpaceDepth.p; }\r\n#if defined(WATER_NORMAL_MAPS)\r\nvec4 WeightedNormalMap_XY_DXDY(highp float v, sampler2D d, vec2 f, vec2 p, float E)\r\n{\r\n    if (v <= 0.)\r\n        return vec4(0.);\r\n    vec3 u = UnpackNormal(texture2D(d, f));\r\n    vec2 t = u.st / u.p;\r\n    const float W = 6.;\r\n    float q = clamp(length(p) * W + uWaterStillWaterNormalStrength_spareyzw.s, 0., 1.);\r\n    return vec4(u.st, t * q) * v * E;\r\n}\r\nvec2 GetNormalDXDYWeightedSum(highp vec4 d, highp vec4 v, highp vec4 u, vec2 f, vec2 p, vec2 t, vec2 W, float E)\r\n{\r\n    vec4 h = vec4(0.);\r\n    h += WeightedNormalMap_XY_DXDY(d.s, uWaterNormalMapTexture0, f, W, 1.);\r\n    p += h.st * v.t * E;\r\n    h += WeightedNormalMap_XY_DXDY(v.s, uWaterNormalMapTexture1, p, W, 1.);\r\n    t += h.st * u.t * E;\r\n    h += WeightedNormalMap_XY_DXDY(u.s, uWaterNormalMapTexture2, t, W, 1.);\r\n    return h.pq;\r\n}\r\nvec3 WaterDetailNormalWeightedSum(vec2 v, vec2 p, vec2 d, vec2 f, vec3 h)\r\n{\r\n    const float u = .5;\r\n    vec2 t = v + h.st * u * uSampleWeight_uvDistortion_sparezw[0].t, q = p + h.st * u * uSampleWeight_uvDistortion_sparezw[1].t, s = d + h.st * u * uSampleWeight_uvDistortion_sparezw[2].t;\r\n    const float E = .8;\r\n    vec2 W = GetNormalDXDYWeightedSum(uSampleWeight_uvDistortion_sparezw[0], uSampleWeight_uvDistortion_sparezw[1], uSampleWeight_uvDistortion_sparezw[2], t, q, s, f, E);\r\n    return normalize(vec3(W, 1.));\r\n}\r\n#if !defined(GLES2_COMPAT_MODE)\r\nvec3 WaterMacroNormalWeightedSum()\r\n{\r\n    const float d = .25;\r\n    const vec2 v = vec2(.1, -.13) * d;\r\n    const float f = .1;\r\n    vec2 p = GetNormalDXDYWeightedSum(uMacroSampleWeight_uvDistortion_sparezw[0], uMacroSampleWeight_uvDistortion_sparezw[1], uMacroSampleWeight_uvDistortion_sparezw[2], vUVPack_NormalMapMacroUV_EmissiveUV[0].st, vUVPack_NormalMapMacroUV_EmissiveUV[1].st, vUVPack_NormalMapMacroUV_EmissiveUV[2].st, v, f);\r\n    return normalize(vec3(p, 1.));\r\n}\r\n#else\r\nvec3 WaterMacroNormalWeightedSum()\r\n{\r\n    const float d = .25;\r\n    const vec2 v = vec2(.1, -.13) * d;\r\n    const float f = .1, p = .1;\r\n    vec2 W = vPosition_WaterDepth.sp * uWaterNormalMapTextureScales_FlowNoiseScale.s * p, u = vPosition_WaterDepth.sp * uWaterNormalMapTextureScales_FlowNoiseScale.t * p, t = vPosition_WaterDepth.sp * uWaterNormalMapTextureScales_FlowNoiseScale.p * p;\r\n    const float E = .01;\r\n    vec2 q = vec2(.1, -.13), s = vec2(-.08, .1), r = vec2(.11, -.9);\r\n    const float n = .5;\r\n    highp float m = uWaterTickFade.s * n;\r\n    vec2 h = W + q * d * m, e = u + s * d * m, c = t + r * d * m, G = GetNormalDXDYWeightedSum(uMacroSampleWeight_uvDistortion_sparezw[0], uMacroSampleWeight_uvDistortion_sparezw[1], uMacroSampleWeight_uvDistortion_sparezw[2], h, e, c, v, f);\r\n    return normalize(vec3(G, 1.));\r\n}\r\n#endif\r\nvec3 WaterNormal()\r\n{\r\n    vec3 v = WaterMacroNormalWeightedSum(), u = vec3(0.);\r\n    vec2 f = vNoisyPatchFlow0_NoisyPatchFlow1.pq - vNoisyPatchFlow0_NoisyPatchFlow1.st, p = vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.st - vNoisyPatchFlow0_NoisyPatchFlow1.st, t = vec2(0., 0.), q = vec2(0., 0.), s = vec2(0., 0.), W = vec2(0., 0.), r = vec2(0., 0.), c = vec2(0., 0.), i = vec2(0., 0.), h = vec2(0., 0.), e = vec2(0., 0.);\r\n#if !defined(GLES2_COMPAT_MODE)\r\n    t = vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.pq;\r\n    q = vUVPack_NormalsFlow0Map1_NormalsFlow0Map2.st;\r\n    s = vUVPack_NormalsFlow0Map1_NormalsFlow0Map2.pq;\r\n    W = vUVPack_NormalsFlow1Map0_NormalsFlow1Map1.st;\r\n    r = vUVPack_NormalsFlow1Map0_NormalsFlow1Map1.pq;\r\n    c = vUVPack_NormalsFlow1Map2_NormalsFlow2Map0.st;\r\n    i = vUVPack_NormalsFlow1Map2_NormalsFlow2Map0.pq;\r\n    h = vUVPack_NormalsFlow2Map1_NormalsFlow2Map2.st;\r\n    e = vUVPack_NormalsFlow2Map1_NormalsFlow2Map2.pq;\r\n#else\r\n    vec2 d = vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.pq, m = vUVPack_NormalsFlow1Map0_NormalsFlow2Map0.st, E = vUVPack_NormalsFlow1Map0_NormalsFlow2Map0.pq;\r\n    t = d;\r\n    q = d * vec2(-.96, .95);\r\n    s = d * vec2(.97, -.94);\r\n    W = m;\r\n    r = m * vec2(-.96, .95);\r\n    c = m * vec2(.97, -.94);\r\n    i = E;\r\n    h = E * vec2(-.96, .95);\r\n    e = E * vec2(.97, -.94);\r\n#endif\r\n    const float G = 1e-07;\r\n    if (dot(f, f) <= G && dot(p, p) <= G)\r\n        u = WaterDetailNormalWeightedSum(t, q, s, vNoisyPatchFlow0_NoisyPatchFlow1.st, v) + v;\r\n    else\r\n        u += (WaterDetailNormalWeightedSum(t, q, s, vNoisyPatchFlow0_NoisyPatchFlow1.st, v) + v) * vFlowControlMask_ViewSpaceDepth.s, u += (WaterDetailNormalWeightedSum(W, r, c, vNoisyPatchFlow0_NoisyPatchFlow1.pq, v) + v) * vFlowControlMask_ViewSpaceDepth.t, u += (WaterDetailNormalWeightedSum(i, h, e, vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.st, v) + v) * vFlowControlMask_ViewSpaceDepth.p;\r\n    return normalize(u).spt;\r\n}\r\n#else\r\nvec3 WaterNormal()\r\n{\r\n    return vec3(0., 1., 0.);\r\n}\r\n#endif\r\nvec3 WaterAlbedo(float v, float d, float E)\r\n{\r\n    vec3 f = vColour.stp;\r\n#if defined(WATER_FOAM_MAP)\r\n    float p = uWaterFoamScaleFoamDepth.t, u = clamp((1. - step(p, 0.)) * min(1., 1. - min(v / p, 1.)), 0., 1.), q = uWaterTickFade.s + vPosition_WaterDepth.s * .0001 + vPosition_WaterDepth.p * .0001, t = pow(max(0., cos(abs(v) * .005 + q + E * 4.)), 8.), s = pow(max(0., cos(abs(v) * .005 - q + E * 8.)), 4.), r = min(1., t + s * u) * max(.2 - d, 0.);\r\n#if !defined(GLES2_COMPAT_MODE)\r\n    vec4 h = texture2D(uWaterTextureFoam, vUVPack_FoamUV.st) * uWaterFoamScaleFoamDepth.s;\r\n    vec3 W = h.stp * h.q;\r\n    f = mix(vColour.stp, W, r * u);\r\n#else\r\n    f = vColour.stp;\r\n#endif\r\n\r\n#endif\r\n    return f;\r\n}\r\nfloat WaterSoftEdgeAlpha(float v)\r\n{\r\n    const float p = .004, u = 1.;\r\n    float f;\r\n#if defined(WATER_EXTINCTION)\r\n    const float d = .002;\r\n    float W = uWaterExtinctionVisibilityMetres / d, t = p + 1. / (W + .001), s = pow(v * t, u);\r\n    f = clamp(s, 0., 1.);\r\n#else\r\n    float q = pow(v * p, u);\r\n    f = clamp(q, 0., 1.);\r\n#endif\r\n    return f;\r\n}\r\nfloat SunLightShadowAttenuation(vec3 d, vec3 p, vec2 v, vec3 f, float E)\r\n{\r\n    float W = 1.;\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    int u = -1;\r\n    vec4 t = uSunlightViewMatrix * vec4(vPosition_WaterDepth.stp, 1.);\r\n    W = DirLightShadowAtten(u, vec4(vPosition_WaterDepth.stp, 1.) + vec4(v, 0., 0.), t + vec4(v, 0., 0.), vFlowControlMask_ViewSpaceDepth.q, uSunlightShadowMap, uSunlightShadowTranslucencyMap, 1.);\r\n#endif\r\n    return W;\r\n}\r\nvec3 SunLightDiffuseContribution(vec3 v, vec3 d, vec2 p, vec3 f, float E, float u)\r\n{\r\n    vec3 r = vec3(0.);\r\n#if defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    r = v * (dot(d, uInvSunDirection) * .5 + .5) * (1. - E) * uSunColour;\r\n#else\r\n    const float W = 2.;\r\n    r = v * W;\r\n#endif\r\n    return r * u;\r\n}\r\nvec3 SunLightSpecularContribution(vec3 d, vec3 v, vec2 p, vec3 f, float t, float E)\r\n{\r\n    vec3 W = vec3(0.);\r\n#if defined(SPECULAR_LIGHTING)\r\n    vec3 u = normalize(uInvSunDirection - f);\r\n    float q = clamp(dot(u, v), 0., 1.);\r\n    W = uSunColour * uSunColour * t * clamp(uInvSunDirection.t, 0., 1.) * pow(q, uWaterNormalBRDFParams.p * .25) * (uWaterNormalBRDFParams.q * 1.8 + .2) * clamp(uWaterNormalBRDFParams.q - .05, 0., 1.) * 25.;\r\n#endif\r\n    return W * E;\r\n}\r\n#if defined(GLOBAL_ENVIRONMENTMAPPING)\r\nvec3 GetEnvironmentMapReflection(vec3 v, vec3 f)\r\n{\r\n    vec3 u = reflect(v, f);\r\n    u.p = -u.p;\r\n    u.t = abs(u.t);\r\n    vec3 d = textureCubeSRGB(uGlobalEnvironmentMap, u).stp;\r\n#if defined(FOG_DISTANCE)\r\n    float E = FogBasedOnAngle(normalize(reflect(v, f)));\r\n    d = mix(d.stp, uFogColour.stp, E);\r\n#endif\r\n    return d;\r\n}\r\n#endif\r\nvec3 EnvMapContribution(vec3 v, vec3 f, vec3 d, float E)\r\n{\r\n    vec3 W = vec3(0.);\r\n    float u = 1.;\r\n#if defined(GLOBAL_ENVIRONMENTMAPPING)\r\n\r\n#if defined(REFLECTION)\r\n    u = uWaterReflectionStrength;\r\n    if (uWaterReflectionMapContribution < 1.)\r\n#endif\r\n    {\r\n        vec3 t = GetEnvironmentMapReflection(d, f);\r\n#if defined(REFLECTION)\r\n        t *= 1. - uWaterReflectionMapContribution;\r\n#endif\r\n        W = t * mix(v, vec3(1., 1., 1.), E);\r\n    }\r\n#endif\r\n    return W * u;\r\n}\r\nvec3 WaterReflection(vec3 v, vec3 f, vec2 d, vec3 p, float E)\r\n{\r\n    vec3 W = vec3(0.);\r\n#if defined(REFLECTION)\r\n    vec2 u = uViewportOffsetScale.st * uFullScreenLookupScale.pq, h = gl_FragCoord.st + d;\r\n    h = (h - u) * uViewportLookupScale.st;\r\n    vec4 r = texture2DLodCompat(uReflectionMap, vec2(1. - h.s, h.t), 0.);\r\n    if (r.q < 1.)\r\n    {\r\n        h = gl_FragCoord.st;\r\n        h = (h - u) * uViewportLookupScale.st;\r\n        r = texture2DLodCompat(uReflectionMap, vec2(1. - h.s, h.t), 0.);\r\n#if defined(GLOBAL_ENVIRONMENTMAPPING)\r\n        if (r.q == 0.)\r\n            r.stp = GetEnvironmentMapReflection(p, f), r.q = 1.;\r\n#endif\r\n    }\r\n    W = r.stp * mix(v, vec3(1.), E) * uWaterReflectionMapContribution * uWaterReflectionStrength;\r\n#endif\r\n    return W;\r\n}\r\nvec3 WaterExtinction(vec3 v, vec3 d, float f, vec2 p, vec3 W, float E)\r\n{\r\n    vec3 t = d;\r\n#if defined(WATER_EXTINCTION) && defined(REFRACTION)\r\n    const float u = .002;\r\n    if (uWaterFeatureFlags.t >= 1.)\r\n    {\r\n        vec3 h = GetWorldSpacePos(p, f, uSceneInvViewProjMatrix).stp;\r\n        float r = length(h - vPosition_WaterDepth.stp) * u;\r\n        highp float q = abs(h.t - vPosition_WaterDepth.t) * u, s = mix(.04, 1., clamp(uWaterExtinctionVisibilityMetres, 0., 1.));\r\n        vec3 m = W / v, c = v / max(max(v.s, v.t), v.p), n = m * c, e = uWaterExtinctionOpaqueWaterColour * n;\r\n        float G = clamp(r / uWaterExtinctionVisibilityMetres, 0., 1.), S = pow(G, s);\r\n        vec3 i = mix(d, e, S);\r\n        const float N = .25;\r\n        vec3 C = clamp(q / (uWaterExtinctionRGBDepthMetres * c), 0., 1.), P = pow(C, vec3(N));\r\n        t = i * (1. - P);\r\n        t = mix(d, t, E);\r\n    }\r\n#endif\r\n    return t;\r\n}\r\nvec3 WaterRefractionWithExtinction(vec3 v, vec3 d, float p, float t, vec3 f, float u)\r\n{\r\n    vec3 W = vec3(0.);\r\n#if defined(REFRACTION)\r\n    vec2 E = uViewportOffsetScale.st * uFullScreenLookupScale.pq;\r\n    vec3 q = vec3(0.);\r\n    float r = 0.;\r\n    highp vec2 h = d.sp * min(sqrt(p) * u * 2., 128.);\r\n    vec2 s = gl_FragCoord.st + h * t * 2.;\r\n    s = (s - E) * uViewportLookupScale.st;\r\n    if (uWaterFeatureFlags.s >= 1.)\r\n    {\r\n#if !defined(NXT_MOBILE)\r\n        r = texture2DLodCompat(uRefractionDepth, s, 0.).s;\r\n        if (r < gl_FragCoord.p || r >= 1.)\r\n            s = gl_FragCoord.st, s = (s - E) * uViewportLookupScale.st;\r\n#endif\r\n        q = texture2DLodCompat(uRefractionMap, vec3(s, 0.), 0.).stp;\r\n    }\r\n    W = WaterExtinction(v, q, r, s, f, u);\r\n#endif\r\n    return W;\r\n}\r\n#if defined(WATER_EMISSIVE) && !defined(GLES2_COMPAT_MODE)\r\n#define EMISSIVE_MAP_MASK (0)\r\n#define EMISSIVE_MAP_RGBMAP_MASK (1)\r\nvec4 SampleEmissiveMap(sampler2D v, vec2 E)\r\n{\r\n    vec2 u = vUVPack_NormalMapMacroUV_EmissiveUV[1].pq - vUVPack_NormalMapMacroUV_EmissiveUV[0].pq, p = vUVPack_NormalMapMacroUV_EmissiveUV[2].pq - vUVPack_NormalMapMacroUV_EmissiveUV[0].pq;\r\n    const float W = 1e-07;\r\n    if (dot(u, u) <= W && dot(p, p) <= W)\r\n        return texture2D(v, vUVPack_NormalMapMacroUV_EmissiveUV[0].pq + E);\r\n    else\r\n    {\r\n        vec4 f = texture2D(v, vUVPack_NormalMapMacroUV_EmissiveUV[0].pq + E) * vFlowControlMask_ViewSpaceDepth.s;\r\n        f += texture2D(v, vUVPack_NormalMapMacroUV_EmissiveUV[1].pq + E) * vFlowControlMask_ViewSpaceDepth.t;\r\n        f += texture2D(v, vUVPack_NormalMapMacroUV_EmissiveUV[2].pq + E) * vFlowControlMask_ViewSpaceDepth.p;\r\n        return f;\r\n    }\r\n}\r\nvec4 EmissiveContribution_Mask(vec3 v, vec2 f)\r\n{\r\n    float E = SampleEmissiveMap(uWaterEmissiveMapTexture, f).s;\r\n    vec3 d = mix(v, uWaterEmissiveColourEmissiveSource.stp, uWaterEmissiveColourEmissiveSource.q);\r\n    float W = uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.s;\r\n    return vec4(d * (1. + W), E);\r\n}\r\nvec4 EmissiveContribution_RGBMapMask(vec3 v, vec2 f)\r\n{\r\n    vec4 h = SampleEmissiveMap(uWaterEmissiveMapTexture, f);\r\n    vec3 d = mix(v, h.stp * uWaterEmissiveColourEmissiveSource.stp, uWaterEmissiveColourEmissiveSource.q);\r\n    float E = uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.s;\r\n    return vec4(d * (1. + E), h.q);\r\n}\r\nvec4 EmissiveContribution_NoMap(vec3 v)\r\n{\r\n    vec3 d = mix(v, uWaterEmissiveColourEmissiveSource.stp, uWaterEmissiveColourEmissiveSource.q);\r\n    float E = uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.s;\r\n    return vec4(d * (1. + E), 1.);\r\n}\r\nvec4 EmissiveContribution(vec3 v, vec3 d, float E)\r\n{\r\n    int W = int(uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.q);\r\n    if (W == 0)\r\n        return EmissiveContribution_NoMap(v);\r\n    vec2 f = d.sp * uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.t * E * 2.;\r\n    int u = int(uEmissiveScale_MapRefractionDepth_EmissiveMapMode_EmissiveMapExists.p);\r\n    if (u == EMISSIVE_MAP_MASK)\r\n        return EmissiveContribution_Mask(v, f);\r\n    else\r\n        return EmissiveContribution_RGBMapMask(v, f);\r\n}\r\n#endif\r\n#if (defined(SUNLIGHT_SHADOWS) && defined(DEBUG_SUNLIGHT_SHADOW_CASCADE) && !defined(DEFERRED_SHADOWS)) || defined(DEBUG_ALBEDO) || defined(DEBUG_NORMALS)\r\n#define WATER_DEBUG_OUTPUT\r\n#endif\r\n#if defined(WATER_DEBUG_OUTPUT)\r\nvoid WaterWriteDebugColour(vec3 v, vec3 d)\r\n{\r\n#if defined(DEBUG_ALBEDO)\r\n    gl_FragColor = vec4(v, 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(DEBUG_NORMALS)\r\n    gl_FragColor = vec4(d * .5 + .5, 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n\r\n#if defined(SUNLIGHT_SHADOWS) && defined(DEBUG_SUNLIGHT_SHADOW_CASCADE) && !defined(DEFERRED_SHADOWS)\r\n    gl_FragColor = vec4(ShadowMapCascadeColour(iCascade, int(uMappingParams.q)).stp, 1.);\r\n    if (uDebugReturn != 0.)\r\n    {\r\n        return;\r\n    }\r\n#endif\r\n}\r\n#endif\r\nvoid WaterFragment()\r\n{\r\n    vec3 v = vPosition_WaterDepth.stp - uCameraPosition;\r\n    float d = length(v);\r\n    vec3 f = v / d;\r\n    vec2 u = GetCombinedFlow();\r\n    float p = length(u), E = GenerateNoise();\r\n    vec3 W = WaterAlbedo(vPosition_WaterDepth.q, p, E), h = WaterNormal();\r\n    vec2 t = h.sp * min(vPosition_WaterDepth.q, 32.);\r\n    float q = WaterSoftEdgeAlpha(vPosition_WaterDepth.q);\r\n    vec4 r = vec4(0.);\r\n    r.q = q;\r\n    const float s = .28, e = 0., c = .6;\r\n    float G = clamp(FresnelSchlick(h, -f, s), e, c), S = clamp(G + uWaterNormalBRDFParams.s, e, c);\r\n    r.q *= G;\r\n    r.stp += WaterReflection(W, h, t, f, S);\r\n    r.stp += EnvMapContribution(W, h, f, S);\r\n    float N = SunLightShadowAttenuation(W, h, t, f, G);\r\n    vec3 m = SunLightDiffuseContribution(W, h, t, f, G, N), n = SunLightSpecularContribution(W, h, t, f, S, N);\r\n    r.stp += n;\r\n#if defined(SUNLIGHT_DIRECT_LIGHTING) && (defined(LIGHT_SCATTERING) || defined(FOG_DISTANCE))\r\n    vec3 i = vOutScattering, P = vInScattering;\r\n    r.stp = ApplyInOutScattering(r.stp, i, P);\r\n    r.q = mix(r.q, 1., vColour.q);\r\n#endif\r\n\r\n#if !defined(REFRACTION)\r\n    r.stp += m;\r\n#if defined(WATER_EMISSIVE) && !defined(GLES2_COMPAT_MODE)\r\n    vec4 C = EmissiveContribution(W, h, G);\r\n    r.stp = mix(r.stp, C.stp, C.q * q * uEmissiveBlend);\r\n#endif\r\n\r\n#else\r\n    vec3 D = WaterRefractionWithExtinction(W, h, vPosition_WaterDepth.q, G, m, q);\r\n#if defined(WATER_EMISSIVE) && !defined(GLES2_COMPAT_MODE)\r\n    r.stp = mix(D, r.stp, G);\r\n    vec4 g = EmissiveContribution(W, h, G);\r\n    r.stp = mix(r.stp, g.stp, g.q * uEmissiveBlend);\r\n    r.stp = mix(D, r.stp, q);\r\n#else\r\n    r.stp = mix(D, r.stp, r.q);\r\n#endif\r\n\r\n#endif\r\n\r\n#if !defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    r.q = 1.;\r\n#endif\r\n    gl_FragColor = r;\r\n#if defined(WATER_DEBUG_OUTPUT)\r\n    WaterWriteDebugColour(W, h);\r\n#endif\r\n}\r\n#if defined(CAUSTICS_STENCIL)\r\nvoid CausticsStencil()\r\n{\r\n    gl_FragColor.s = float(texture2D(uCausticsMap, gl_FragCoord.st / uCausticsMapSize).s) * uCausticsScale / CAUSTICS_FIXED_POINT_SCALE;\r\n}\r\n#endif\r\n#if defined(CAUSTICS_COMPUTE)\r\nvoid CausticsCompute()\r\n{\r\n    vec3 v = WaterNormal();\r\n    WriteCausticsRay(v, vPosition_WaterDepth.q);\r\n    discard;\r\n    return;\r\n}\r\n#endif\r\n#if defined(CLIP_PLANE_CLAMP)\r\nvoid ClipPlaneClamp()\r\n{\r\n    const float E = 200.;\r\n    if (abs(vPosition_WaterDepth.t + uClipPlane.q) < E)\r\n        gl_FragDepth = 1., gl_FragColor = vec4(uFogColour.stp, 1.);\r\n    else\r\n    {\r\n        discard;\r\n    }\r\n}\r\n#endif\r\nvoid main()\r\n{\r\n#if defined(CLIP_PLANE_CLAMP)\r\n    ClipPlaneClamp();\r\n#elif defined(CAUSTICS_STENCIL)\r\n    CausticsStencil();\r\n#elif defined(CAUSTICS_COMPUTE)\r\n    CausticsCompute();\r\n#else\r\n    WaterFragment();\r\n#endif\r\n}\r\n"
},1826:e=>{"use strict"
;e.exports="\r\n#version 460\r\n\r\n/***************************************************/\r\n/***************** GLSL Header *********************/\r\n/***************************************************/\r\n#ifdef GL_EXT_gpu_shader4\r\n#extension GL_EXT_gpu_shader4 : enable\r\n#endif\r\n#ifdef GL_ARB_gpu_shader5\r\n#extension GL_ARB_gpu_shader5 : enable\r\n#endif\r\n#ifdef GL_ARB_derivative_control\r\n#extension GL_ARB_derivative_control : enable\r\n#endif\r\n\r\n#ifdef GL_ARB_texture_gather\r\n#extension GL_ARB_texture_gather : enable\r\n#endif\r\n\r\n#define OGL_BACKEND\r\n\r\n#undef attribute\r\n#define attribute in\r\n\r\n#undef gl_FragColor\r\n#define gl_FragColor FragColor\r\n\r\n#define shadow2DCompat texture\r\n\r\n#undef textureCube\r\n#define textureCube texture\r\n\r\n#undef texture2D\r\n#define texture2D texture\r\n\r\n#undef texture3D\r\n#define texture3D texture\r\n\r\n#undef texture2DLod\r\n#define texture2DLod textureLod\r\n\r\n#undef textureCubeLod\r\n#define textureCubeLod textureLod\r\n\r\n#undef texture2DGrad\r\n#define texture2DGrad textureGrad\r\n\r\n#define MSAA_AVAILABLE\r\n\r\n#define TEXTURE_OFFSET_AVAILABLE\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define shadow2DLodCompat texture2DLod\r\n\r\n#define texture2DLodCompat texture2DLod\r\n\r\n#define textureCubeLodCompat textureCubeLod\r\n\r\n#define textureGatherCompat(sampler, texCoord, viewportScale) textureGather(sampler, texCoord).wzxy\r\n\r\n#define UNIFORM_BUFFER_BEGIN(name) \\\r\n    layout(std140) uniform name    \\\r\n    {\r\n#define UNIFORM_BUFFER_END \\\r\n    }                      \\\r\n    ;\r\n\r\nmat3 Mat4ToMat3(const mat4 inputMatrix)\r\n{\r\n    return mat3(inputMatrix);\r\n}\r\n\r\n#define isNaN isnan\r\n\r\n#ifndef GL_ARB_derivative_control\r\n#define dFdxFine dFdx\r\n#define dFdyFine dFdy\r\n#define fwidthFine fwidth\r\n#endif\r\n\r\n/***************************************************/\r\n\r\n/***************************************************/\r\n/***************** Effect Defines ******************/\r\n/***************************************************/\r\n#define VIEW_TRANSFORMS\r\n#define WATER_COMMON\r\n\r\n/*************************************************/\r\n\r\n/***************************************************/\r\n/********** Mandatory Shader Fragments *************/\r\n/***************************************************/\r\n\r\n#define GRAPHICS_QUALITY_LOW 0\r\n#define GRAPHICS_QUALITY_MEDIUM 1\r\n#define GRAPHICS_QUALITY_HIGH 2\r\n#define GRAPHICS_QUALITY_ULTRA 3\r\n\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_X 3.0\r\n#define MATERIAL_SETTINGS_SLOT_PIXEL_RESOLUTION_Y 4.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_X 42.0\r\n#define MATERIAL_SETTINGS_SLOTS_DIMENSION_COUNT_Y 32.0\r\n#define MATERIAL_SETTINGS_TEXTURE_RESOLUTION 128.0\r\n#ifndef MATH_UTILS_INC\r\n#define MATH_UTILS_INC\r\nconst float PI = 3.14159, INV_PI = .31831, TWOPI = PI * 2., INV_TWOPI = 1. / TWOPI, PI_OVER_4 = PI / 4., PI_OVER_2 = PI / 2., SQRT_2_PI = .797885, INV_EIGHT = .125;\r\nfloat SpecPowToBeckmannRoughness(float f) { return sqrt(2. / (f + 2.)); }\r\nfloat PerceptualRoughnessToRoughness(float f) { return f * f; }\r\nfloat RoughnessToPerceptualRoughness(float f) { return sqrt(f); }\r\n#endif\r\n#ifndef CONVERSION_UTILS_INC\r\n#define CONVERSION_UTILS_INC\r\nvec3 SRGBToLinear(vec3 srgbColour)\r\n{\r\n#if defined(GAMMA_CORRECT_INPUTS)\r\n    return srgbColour * srgbColour;\r\n#else\r\n    return pow(srgbColour, vec3(2.2, 2.2, 2.2));\r\n#endif\r\n}\r\nvec3 LinearToSRGB(vec3 s) { return max(vec3(1.055) * pow(s, vec3(.416667)) - vec3(.055), vec3(0.)); }\r\nfloat LinearToSRGB(float s)\r\n{\r\n    const float p = 1. / 2.2;\r\n    return pow(s, p);\r\n}\r\nvec3 LinearToSRGBRunescape(vec3 s) { return sqrt(s); }\r\nfloat LinearToSRGBRunescape(float s) { return sqrt(s); }\r\nvec4 convertRGBtoHSL(vec4 s)\r\n{\r\n    const float p = 1. / 6.;\r\n    float v = s.s, m = s.t, t = s.p, f = min(min(s.s, s.t), s.p), q = max(max(s.s, s.t), s.p), r = q - f, G = (f + q) * .5, i = 0., e = 0.;\r\n    if (G > 0. && G < 1.)\r\n    {\r\n        float L = G < .5 ? G : 1. - G;\r\n        i = r / (L * 2.);\r\n    }\r\n    if (r > 0.)\r\n    {\r\n        vec3 L = vec3(q == v && q != m ? 1. : 0., q == m && q != t ? 1. : 0., q == t && q != v ? 1. : 0.), o = vec3((m - t) / r, 2. + (t - v) / r, 4. + (v - m) / r);\r\n        e += dot(o, L);\r\n        e *= p;\r\n        if (e < 0.)\r\n            e += 1.;\r\n    }\r\n    return vec4(e, i, G, s.q);\r\n}\r\nvec4 convertHSLtoRGB(vec4 s)\r\n{\r\n    const float v = 1. / 3., q = 2. / 3., m = 6.;\r\n    float p = s.s, t = s.t, r = s.p;\r\n    vec3 f = vec3(m * (p - q), 0., m * (1. - p));\r\n    if (p < q)\r\n        f.s = 0., f.t = m * (q - p), f.p = m * (p - v);\r\n    if (p < v)\r\n        f.s = m * (v - p), f.t = m * p, f.p = 0.;\r\n    f = min(f, 1.);\r\n    float L = 2. * t, i = 1. - t, G = 1. - r, e = 2. * r - 1.;\r\n    vec3 c = L * f + i, o;\r\n    if (r >= .5)\r\n        o = G * c + e;\r\n    else\r\n        o = r * c;\r\n    return vec4(o, s.q);\r\n}\r\n#endif\r\n#ifndef PACK_UTILS_INC\r\n#define PACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nvec4 PackFloatToRGBA(highp float valueToPack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\r\n    const highp vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\r\n    highp vec4 fragColour = mod(valueToPack * bitShift * vec4(255), vec4(256)) / vec4(255);\r\n    return fragColour - fragColour.xxyz * bitMask;\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\r\n    const highp vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\r\n    highp vec4 fragColour = fract(valueToPack * bitShift);\r\n    return fragColour - (fragColour.xxyz * bitMask);\r\n#endif\r\n}\r\nvec2 NormalPackSphereMap(vec3 v)\r\n{\r\n    vec2 f = normalize(v.st) * sqrt(-v.p * .5 + .5);\r\n    f = f * .5 + .5;\r\n    return f * 65535.;\r\n}\r\nvec2 PackFloatToVec2(float v)\r\n{\r\n    vec2 f;\r\n    const float b = 1. / 255.;\r\n    vec2 h = vec2(1., 255.), r = fract(h * v);\r\n    r.s -= r.t * b;\r\n    return r.st;\r\n}\r\n#endif\r\n#ifndef UNPACK_UTILS_INC\r\n#define UNPACK_UTILS_INC\r\n#ifndef SHADER_LIB_COMMON_INC\r\n#define SHADER_LIB_COMMON_INC\r\n#define USE_MOD_PACK\r\n#endif\r\n\r\nhighp float UnpackRGBAToFloat(highp vec4 valueToUnpack)\r\n{\r\n#if defined(USE_MOD_PACK) || defined(USE_FRACT_PACK)\r\n    const highp vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n#ifdef USE_ARAS_PACK\r\n    const highp vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\r\n    return dot(valueToUnpack, bitShifts);\r\n#endif\r\n}\r\nvec3 ColourUnpack(highp float v)\r\n{\r\n    vec3 f;\r\n    f.s = floor(v / 256. / 256.);\r\n    f.t = floor((v - f.s * 256. * 256.) / 256.);\r\n    f.p = floor(v - f.s * 256. * 256. - f.t * 256.);\r\n    return f / 256.;\r\n}\r\nvec3 NormalUnpackSphereMap(vec2 v)\r\n{\r\n    vec4 f = vec4(v.s / 32767. - 1., v.t / 32767. - 1., 1., -1.);\r\n    float U = dot(f.stp, -f.stq);\r\n    f.st *= sqrt(U);\r\n    f.p = U;\r\n    return f.stp * 2. + vec3(0., 0., -1.);\r\n}\r\nhighp float UnpackRGBAToIntegerFloat(highp vec4 f) { return floor(f.s * 255. + .5) * 256. * 256. * 256. + floor(f.t * 255. + .5) * 256. * 256. + floor(f.p * 255. + .5) * 256. + floor(f.q * 255. + .5); }\r\nhighp float UnpackRGBAToIntegerFloat16(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\nhighp int UnpackRGBAToInt(vec4 f) { return int(UnpackRGBAToIntegerFloat(f)); }\r\nhighp vec4 UnpackFloatToRGBA(highp float f)\r\n{\r\n    const highp vec4 v = vec4(1., 255., 65025., 1.65814e+07), s = vec4(vec3(1. / 255.), 0.);\r\n    highp vec4 U = fract(f * v);\r\n    U -= U.sstp * s;\r\n    return U;\r\n}\r\nhighp float UnpackVec2ToFloat(highp vec2 f) { return floor(f.s * 255. + .5) * 256. + floor(f.t * 255. + .5); }\r\n#endif\r\n#if defined(MSAA) && defined(MSAA_AVAILABLE)\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2DMS\r\n#define MSAA_SAMPLERS_ENABLED 1\r\n#define texture2DMultisample(sampler, texCoord, texSize) texelFetch(sampler, ivec2((texCoord)*texSize), 0)\r\n#else\r\n#define SAMPLER_2D_AUTO_MULTISAMPLE sampler2D\r\n#define MSAA_SAMPLERS_ENABLED 0\r\n#define texture2DMultisample(sampler, texCoord, texSize) texture2DLodCompat(sampler, texCoord, 0.0)\r\n#endif\r\nUNIFORM_BUFFER_BEGIN(ViewportLookupScale)\r\nuniform highp vec4 uViewportLookupScale;\r\nuniform highp vec4 uViewportOffsetScale;\r\nuniform highp vec4 uFullScreenLookupScale;\r\nUNIFORM_BUFFER_END\r\n\r\n/***************************************************/\r\n\r\nuniform lowp vec4 uWaterFeatureFlags;\r\nuniform highp vec4 uWaterNormalMapTextureScales_FlowNoiseScale;\r\nuniform highp vec2 uWaterTickFade;\r\nuniform mat4 uModelMatrix;\r\n\r\nUNIFORM_BUFFER_BEGIN(ViewTransforms)\r\nuniform highp vec3 uCameraPosition;\r\nuniform highp mat4 uViewMatrix;\r\nuniform highp mat4 uProjectionMatrix;\r\nuniform highp mat4 uViewProjMatrix;\r\nuniform highp vec4 uZBufferParams;\r\nUNIFORM_BUFFER_END\r\nout highp vec4 vPosition_WaterDepth;\r\nout vec4 vColour;\r\nout highp vec4 vFlowControlMask_ViewSpaceDepth;\r\nout highp vec4 vNoisyPatchFlow0_NoisyPatchFlow1;\r\nout highp vec4 vNoisyPatchFlow2_UVPack_NormalsFlow0Map0;\r\nout highp vec4 vUVPack_NormalsFlow0Map1_NormalsFlow0Map2;\r\nout highp vec4 vUVPack_NormalsFlow1Map0_NormalsFlow1Map1;\r\nout highp vec4 vUVPack_NormalsFlow1Map2_NormalsFlow2Map0;\r\nout highp vec4 vUVPack_NormalsFlow2Map1_NormalsFlow2Map2;\r\nout highp vec4 vUVPack_NormalMapMacroUV_EmissiveUV[3];\r\nout highp vec2 vUVPack_FoamUV;\r\nattribute vec4 aWaterPosition_Depth, aVertexColour;\r\nattribute vec2 aWaterFlowDataPatchFlow0, aWaterFlowDataPatchFlow1, aWaterFlowDataPatchFlow2;\r\nattribute vec4 aWaterFlowDataFlowNoise0_FlowNoise1, aWaterFlowDataFlowNoise2_FlowIndex_Spare;\r\n#ifndef DISTANCE_FOG_UNIFORMS\r\n#define DISTANCE_FOG_UNIFORMS\r\n#if defined(FOG_DISTANCE)\r\nUNIFORM_BUFFER_BEGIN(DistanceFog)\r\nuniform mediump vec4 uFogColour;\r\nuniform highp vec4 uFogParams;\r\nUNIFORM_BUFFER_END\r\n#endif\r\n#endif\r\n\r\n#ifndef DISTANCE_FOG_FUNCTIONS\r\n#define DISTANCE_FOG_FUNCTIONS\r\n#if defined(FOG_DISTANCE)\r\nfloat FogBasedOnDistance(highp float f)\r\n{\r\n    highp float F = (uFogParams.t - f) * uFogParams.s;\r\n    return 1. - clamp(F, 0., 1.);\r\n}\r\nfloat FogBasedOnAngle(highp vec3 f)\r\n{\r\n    highp float F = 1. - clamp(f.t + uFogParams.q, 0., 1.);\r\n    F = pow(F, uFogParams.p);\r\n    return clamp(F, 0., 1.);\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef VOLUMETRIC_FUNCTIONS_INC\r\n#define VOLUMETRIC_FUNCTIONS_INC\r\n#if defined(SUNLIGHT_SHADOWS) && defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n#define VOLUMETRIC_SCATTERING_SUPPORTED\r\nuniform vec4 uMieG, uVolumetricScatteringParameters;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\nuniform vec4 uGroundFogHeight_Falloff;\r\n#endif\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\nuniform sampler3D sNoiseTex;\r\nuniform vec4 u3DNoiseFrequency_Strength, u3DNoiseWind_Power;\r\n#endif\r\nuniform float uTime;\r\nfloat ShadowSample(vec4 u, vec4 v, float s)\r\n{\r\n    int d = int(uMappingParams.q);\r\n    vec4 f;\r\n    int G;\r\n#if defined(CASCADE_SPLIT_SELECTION)\r\n    G = ShadowMapSelectCascadeBySplit(s, uCascadeFrustumViewDepths, uCascadeSplitSelectionFlags);\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    f = uSunlightViewProjTexMatrix[G] * u;\r\n#else\r\n    f = v * uSunlightProjTexMatScale[G] + uSunlightProjTexMatOffset[G];\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    G = ShadowMapSelectCascadeByMap(f, u, uSunlightViewProjTexMatrix, uCascadeMinAtlasExtents);\r\n#else\r\n    G = ShadowMapSelectCascadeByMap(f, v, uSunlightProjTexMatScale, uSunlightProjTexMatOffset, uCascadeMinAtlasExtents);\r\n#endif\r\n\r\n#endif\r\n    return G >= d ? 1. : ShadowDepthMapFilter1x1(uSunlightShadowMap, f);\r\n}\r\nfloat PhaseFunction(float v, vec4 s) { return s.q * (s.s / pow(s.t - s.p * v, 1.5)); }\r\nvec4 GetScatteredInRay(int s, vec3 u, float v, float d, vec4 f)\r\n{\r\n    float G = uSunlightFadeAttenParams.t * 1.4, m = min(G, v);\r\n    vec3 V = uCameraPosition, t = V + u * m;\r\n    vec4 x = uSunlightViewMatrix * vec4(V, 1.), e = uSunlightViewMatrix * vec4(t, 1.), i = uSunlightViewMatrix * vec4(V, 0.), n = uSunlightViewMatrix * vec4(t, 0.);\r\n    vec3 E = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    int S = int(uMappingParams.q);\r\n    float q = 0., p = 1. / float(s), N = d * p, h = m * p;\r\n    vec2 r = vec2(0., 0.);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n    vec3 P = vec3(.05 * uTime), a = u3DNoiseWind_Power.stp * uTime;\r\n    const float o = .31;\r\n    float c = u3DNoiseFrequency_Strength.s * o;\r\n    vec3 l = a * u3DNoiseFrequency_Strength.s, T = a * c;\r\n#endif\r\n    for (int X = 0; X < s; ++X)\r\n    {\r\n        vec3 U = mix(V, t, N);\r\n        vec4 I = mix(x, e, N);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        vec4 M = mix(i, n, N);\r\n        vec3 C = M.sts * vec3(.001) + P, g = M.sts * vec3(.001) - P;\r\n        I.sp += vec2(texture3D(sNoiseTex, g).s, texture3D(sNoiseTex, g).s) * 128. - 64.;\r\n#endif\r\n        float R = 0.;\r\n#if defined(USE_CASCADE_SPLIT_SELECTION)\r\n        vec3 O = U.stp - uCameraPosition;\r\n        R = abs(dot(O, E));\r\n#endif\r\n        float F = ShadowSample(vec4(U, 1.f), I, R), D = 1., w = 1.;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\n        if (uGroundFogHeight_Falloff.t != 0.)\r\n        {\r\n            float L = max(0., (U.t - uGroundFogHeight_Falloff.s) * uGroundFogHeight_Falloff.t);\r\n            w = exp(-L) * 100.;\r\n        }\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        if (u3DNoiseFrequency_Strength.t != 0.)\r\n        {\r\n            vec3 L = U * u3DNoiseFrequency_Strength.s + l;\r\n            float y = float(texture3D(sNoiseTex, L));\r\n            vec3 A = U * c + T;\r\n            float H = float(texture3D(sNoiseTex, A)), W = pow(mix(y, H, .8) + .5, u3DNoiseWind_Power.q);\r\n            w *= max(0, mix(1., W, u3DNoiseFrequency_Strength.t));\r\n        }\r\n#endif\r\n        D += w;\r\n        float L = D * h, W = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += W * exp(-q) * vec2(F, 1. - F);\r\n        N += p;\r\n    }\r\n    if (v > G)\r\n    {\r\n        float L = v - G, U = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += vec2(U * exp(-q), 0.);\r\n    }\r\n    float U = r.s + r.t;\r\n    if (U > 0.)\r\n    {\r\n        float L = r.s / U, g = uVolumetricScatteringParameters.q;\r\n        L = pow(L, g);\r\n        r.st = U * vec2(L, 1. - L);\r\n        r.s = r.s * PhaseFunction(dot(u, uInvSunDirection), f);\r\n    }\r\n    return vec4(r.s, q, r.t, 1.);\r\n}\r\nvec4 GetScatteredInRay2(int s, vec3 u, float v, float f) { return GetScatteredInRay(s, u, v, f, uMieG); }\r\nvec4 GetScatteredInRayLine(int s, vec3 u, float v, vec3 f, float d, float G)\r\n{\r\n    vec4 L = GetScatteredInRay2(s, u, v, G), t = GetScatteredInRay2(s, mix(u, f, .33), mix(v, d, .33), G), m = GetScatteredInRay2(s, mix(u, f, .66), mix(v, d, .66), G), U = GetScatteredInRay2(s, f, d, G);\r\n    return L * .15 + t * .2 + m * .3 + U * .35;\r\n}\r\n#endif\r\n#endif\r\n\r\n#ifndef APPLY_VOLUMETRICS_INC\r\n#define APPLY_VOLUMETRICS_INC\r\n#ifndef VOLUMETRIC_FUNCTIONS_INC\r\n#define VOLUMETRIC_FUNCTIONS_INC\r\n#if defined(SUNLIGHT_SHADOWS) && defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n#define VOLUMETRIC_SCATTERING_SUPPORTED\r\nuniform vec4 uMieG, uVolumetricScatteringParameters;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\nuniform vec4 uGroundFogHeight_Falloff;\r\n#endif\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\nuniform sampler3D sNoiseTex;\r\nuniform vec4 u3DNoiseFrequency_Strength, u3DNoiseWind_Power;\r\n#endif\r\nuniform float uTime;\r\nfloat ShadowSample(vec4 u, vec4 v, float s)\r\n{\r\n    int d = int(uMappingParams.q);\r\n    vec4 f;\r\n    int G;\r\n#if defined(CASCADE_SPLIT_SELECTION)\r\n    G = ShadowMapSelectCascadeBySplit(s, uCascadeFrustumViewDepths, uCascadeSplitSelectionFlags);\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    f = uSunlightViewProjTexMatrix[G] * u;\r\n#else\r\n    f = v * uSunlightProjTexMatScale[G] + uSunlightProjTexMatOffset[G];\r\n#endif\r\n\r\n#else\r\n\r\n#if defined(USE_LIGHT_VIEW_PROJ_TEX_MATRIX)\r\n    G = ShadowMapSelectCascadeByMap(f, u, uSunlightViewProjTexMatrix, uCascadeMinAtlasExtents);\r\n#else\r\n    G = ShadowMapSelectCascadeByMap(f, v, uSunlightProjTexMatScale, uSunlightProjTexMatOffset, uCascadeMinAtlasExtents);\r\n#endif\r\n\r\n#endif\r\n    return G >= d ? 1. : ShadowDepthMapFilter1x1(uSunlightShadowMap, f);\r\n}\r\nfloat PhaseFunction(float v, vec4 s) { return s.q * (s.s / pow(s.t - s.p * v, 1.5)); }\r\nvec4 GetScatteredInRay(int s, vec3 u, float v, float d, vec4 f)\r\n{\r\n    float G = uSunlightFadeAttenParams.t * 1.4, m = min(G, v);\r\n    vec3 V = uCameraPosition, t = V + u * m;\r\n    vec4 x = uSunlightViewMatrix * vec4(V, 1.), e = uSunlightViewMatrix * vec4(t, 1.), i = uSunlightViewMatrix * vec4(V, 0.), n = uSunlightViewMatrix * vec4(t, 0.);\r\n    vec3 E = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    int S = int(uMappingParams.q);\r\n    float q = 0., p = 1. / float(s), N = d * p, h = m * p;\r\n    vec2 r = vec2(0., 0.);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n    vec3 P = vec3(.05 * uTime), a = u3DNoiseWind_Power.stp * uTime;\r\n    const float o = .31;\r\n    float c = u3DNoiseFrequency_Strength.s * o;\r\n    vec3 l = a * u3DNoiseFrequency_Strength.s, T = a * c;\r\n#endif\r\n    for (int X = 0; X < s; ++X)\r\n    {\r\n        vec3 U = mix(V, t, N);\r\n        vec4 I = mix(x, e, N);\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        vec4 M = mix(i, n, N);\r\n        vec3 C = M.sts * vec3(.001) + P, g = M.sts * vec3(.001) - P;\r\n        I.sp += vec2(texture3D(sNoiseTex, g).s, texture3D(sNoiseTex, g).s) * 128. - 64.;\r\n#endif\r\n        float R = 0.;\r\n#if defined(USE_CASCADE_SPLIT_SELECTION)\r\n        vec3 O = U.stp - uCameraPosition;\r\n        R = abs(dot(O, E));\r\n#endif\r\n        float F = ShadowSample(vec4(U, 1.f), I, R), D = 1., w = 1.;\r\n#if defined(VOLUMETRIC_GROUND_FOG)\r\n        if (uGroundFogHeight_Falloff.t != 0.)\r\n        {\r\n            float L = max(0., (U.t - uGroundFogHeight_Falloff.s) * uGroundFogHeight_Falloff.t);\r\n            w = exp(-L) * 100.;\r\n        }\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_NOISE)\r\n        if (u3DNoiseFrequency_Strength.t != 0.)\r\n        {\r\n            vec3 L = U * u3DNoiseFrequency_Strength.s + l;\r\n            float y = float(texture3D(sNoiseTex, L));\r\n            vec3 A = U * c + T;\r\n            float H = float(texture3D(sNoiseTex, A)), W = pow(mix(y, H, .8) + .5, u3DNoiseWind_Power.q);\r\n            w *= max(0, mix(1., W, u3DNoiseFrequency_Strength.t));\r\n        }\r\n#endif\r\n        D += w;\r\n        float L = D * h, W = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += W * exp(-q) * vec2(F, 1. - F);\r\n        N += p;\r\n    }\r\n    if (v > G)\r\n    {\r\n        float L = v - G, U = uVolumetricScatteringParameters.s * L;\r\n        q += uVolumetricScatteringParameters.t * L;\r\n        r += vec2(U * exp(-q), 0.);\r\n    }\r\n    float U = r.s + r.t;\r\n    if (U > 0.)\r\n    {\r\n        float L = r.s / U, g = uVolumetricScatteringParameters.q;\r\n        L = pow(L, g);\r\n        r.st = U * vec2(L, 1. - L);\r\n        r.s = r.s * PhaseFunction(dot(u, uInvSunDirection), f);\r\n    }\r\n    return vec4(r.s, q, r.t, 1.);\r\n}\r\nvec4 GetScatteredInRay2(int s, vec3 u, float v, float f) { return GetScatteredInRay(s, u, v, f, uMieG); }\r\nvec4 GetScatteredInRayLine(int s, vec3 u, float v, vec3 f, float d, float G)\r\n{\r\n    vec4 L = GetScatteredInRay2(s, u, v, G), t = GetScatteredInRay2(s, mix(u, f, .33), mix(v, d, .33), G), m = GetScatteredInRay2(s, mix(u, f, .66), mix(v, d, .66), G), U = GetScatteredInRay2(s, f, d, G);\r\n    return L * .15 + t * .2 + m * .3 + U * .35;\r\n}\r\n#endif\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\nuniform vec3 uVolumetricLitFogColour, uVolumetricUnlitFogColour;\r\nuniform mat4 uVolumetricDitherMat;\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvoid GetInAndOutScattering(vec4 v, out vec3 u, out vec3 G)\r\n{\r\n    vec3 A = uSunColour * uVolumetricLitFogColour, o = uAmbientColour * uVolumetricUnlitFogColour;\r\n    u = vec3(exp(-v.t));\r\n    G = v.s * A + v.p * o;\r\n}\r\n#if __VERSION__ <= 120\r\n#define in varying\r\n#define out varying\r\n#endif\r\n\r\nvec4 ApplyVolumetricScattering(vec4 v, vec4 u)\r\n{\r\n    vec3 A = vec3(1.), o = vec3(0.);\r\n    GetInAndOutScattering(u, A, o);\r\n    return vec4(v.stp * A + o, v.q);\r\n}\r\nfloat CalculateScatteringOffset(vec2 v)\r\n{\r\n    vec2 u = vec2(floor(mod(v.st, 4.)));\r\n    return uVolumetricDitherMat[int(u.s)][int(u.t)];\r\n}\r\n#endif\r\n#endif\r\n\r\n#if __VERSION__ <= 120\r\n#ifdef in\r\n#undef in\r\n#endif\r\n#ifdef out\r\n#undef out\r\n#endif\r\n#endif\r\n\r\nvec2 GetFlowOrientedUV(vec2 v, vec2 u, float d, float E)\r\n{\r\n    float T = dot(u, u);\r\n    const float q = 1e-06;\r\n    vec2 e = T < q ? vec2(0., 1.) : normalize(u), t = vec2(e.t, -e.s);\r\n    highp float f = length(u * d * E);\r\n    return vec2(dot(t, v), dot(e, v) + f);\r\n}\r\nvec2 GetFlowOrientedUV(vec4 e, vec2 v, float d, vec2 u, float f)\r\n{\r\n    vec2 q = vec2(e.sp);\r\n    float t = sign(u.t);\r\n    return GetFlowOrientedUV(q, v * t, d, f) * u;\r\n}\r\n#if defined(WATER_NORMAL_MAPS)\r\nvec2 TransformNormalMapTexCoordFlowAligned(in NormalMapTexCoordParams v, vec2 u, vec2 d, vec2 f)\r\n{\r\n    const float q = .5;\r\n    highp float E = uWaterTickFade.s * q;\r\n    float t = v.flowSpeed_spareyzw.s;\r\n    vec2 T = GetFlowOrientedUV(u, v.flowRotation * d, t, E), a = (v.uvRotation * T + f * t * E) * v.uvScale_uvOffset.st + v.uvScale_uvOffset.pq;\r\n    return a;\r\n}\r\nvec2 TransformNormalMapTexCoordAxisAligned(in NormalMapTexCoordParams v, vec2 u, vec2 d, vec2 f)\r\n{\r\n    const float q = .5;\r\n    highp float t = uWaterTickFade.s * q;\r\n    vec2 p = (d + f) * v.flowSpeed_spareyzw.s, E = v.flowRotation * p * t, a = v.uvRotation * (u + E) * v.uvScale_uvOffset.st + v.uvScale_uvOffset.pq;\r\n    return a;\r\n}\r\n#if !defined(GLES2_COMPAT_MODE)\r\nvoid ComputeNormalMapDetailTexCoords(vec2 v, vec2 d, vec2 f, vec2 u, vec2 t, vec2 a, vec2 p, vec2 s, vec2 E)\r\n{\r\n    vec2 q = vec2(1.), S = vec2(-1.), g = vec2(1., -1.), T = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, u, p * q), e = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[1], d, u, p * S), G = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[2], f, u, p * g), C = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, t, s * q), P = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[1], d, t, s * S), W = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[2], f, t, s * g), D = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, a, E * q), o = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[1], d, a, E * S), r = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[2], f, a, E * g);\r\n    vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.pq = T;\r\n    vUVPack_NormalsFlow0Map1_NormalsFlow0Map2 = vec4(e, G);\r\n    vUVPack_NormalsFlow1Map0_NormalsFlow1Map1 = vec4(C, P);\r\n    vUVPack_NormalsFlow1Map2_NormalsFlow2Map0 = vec4(W, D);\r\n    vUVPack_NormalsFlow2Map1_NormalsFlow2Map2 = vec4(o, r);\r\n}\r\nvoid ComputeNormalMapMacroTexCoords(vec2 v, vec2 d, vec2 f)\r\n{\r\n    const float q = .25;\r\n    const vec2 t = vec2(.1, -.13) * q;\r\n    const float u = .1;\r\n    vUVPack_NormalMapMacroUV_EmissiveUV[0].st = TransformNormalMapTexCoordAxisAligned(uWaterNormalMapMacroTexCoordParams[0], v * u, t, vec2(0.));\r\n    vUVPack_NormalMapMacroUV_EmissiveUV[1].st = TransformNormalMapTexCoordAxisAligned(uWaterNormalMapMacroTexCoordParams[1], d * u, t, vec2(0.));\r\n    vUVPack_NormalMapMacroUV_EmissiveUV[2].st = TransformNormalMapTexCoordAxisAligned(uWaterNormalMapMacroTexCoordParams[2], f * u, t, vec2(0.));\r\n}\r\n#else\r\nvoid ComputeNormalMapDetailTexCoords(vec2 v, vec2 d, vec2 f, vec2 t, vec2 u, vec2 E, vec2 a)\r\n{\r\n    vec2 q = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, d, u), e = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, f, E), S = TransformNormalMapTexCoordFlowAligned(uWaterNormalMapTexCoordParams[0], v, t, a);\r\n    vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.pq = q;\r\n    vUVPack_NormalsFlow1Map0_NormalsFlow2Map0 = vec4(e, S);\r\n}\r\n#endif\r\n#endif\r\n#if defined(WATER_EMISSIVE) && !defined(GLES2_COMPAT_MODE)\r\n#define EMISSIVE_UV_MODE_AXIS_ALIGNED (0)\r\n#define EMISSIVE_UV_MODE_FLOW_ALIGNED (1)\r\nvoid GetEmissiveFlow(out vec2 v, out vec2 d, out vec2 t, vec2 u, vec2 f, vec2 q, float E)\r\n{\r\n    float a = cos(E), S = sin(E);\r\n    mat2 T = mat2(vec2(a, -S), vec2(S, a));\r\n    vec2 G = T * u, e = T * f, p = T * q;\r\n    const float g = 1e-06;\r\n    vec3 C = vec3(G, dot(G, G)), s = vec3(e, dot(e, e)), r = vec3(p, dot(p, p));\r\n    if (C.p < g)\r\n        C = s.p > r.p ? s : r;\r\n    if (s.p < g)\r\n        s = r.p > C.p ? r : C;\r\n    if (r.p < g)\r\n        r = C.p > s.p ? C : s;\r\n    v = C.st;\r\n    d = s.st;\r\n    t = r.st;\r\n}\r\nvoid ComputeEmissiveTexCoords(vec4 v, vec2 d, vec2 f, vec2 E)\r\n{\r\n    float t = uEmissiveFlowSpeed_EmissiveFlowRotation_EmissiveUVScale.s, q = uEmissiveFlowSpeed_EmissiveFlowRotation_EmissiveUVScale.t, u = uEmissiveMapScale_EmissiveUVMode.s;\r\n    vec2 a = uEmissiveFlowSpeed_EmissiveFlowRotation_EmissiveUVScale.pq, p = vec2(0., 0.), s = vec2(0., 0.), e = vec2(0., 0.);\r\n    GetEmissiveFlow(p, s, e, d, f, E, q);\r\n    const float T = .5;\r\n    highp float S = uWaterTickFade.s * T;\r\n    vec2 G = v.sp * u;\r\n    if (int(uEmissiveMapScale_EmissiveUVMode.t) == EMISSIVE_UV_MODE_FLOW_ALIGNED)\r\n        vUVPack_NormalMapMacroUV_EmissiveUV[0].pq = GetFlowOrientedUV(G, p, t, S) * a, vUVPack_NormalMapMacroUV_EmissiveUV[1].pq = GetFlowOrientedUV(G, s, t, S) * a, vUVPack_NormalMapMacroUV_EmissiveUV[2].pq = GetFlowOrientedUV(G, e, t, S) * a;\r\n    else\r\n    {\r\n        vec2 g = sign(a);\r\n        vUVPack_NormalMapMacroUV_EmissiveUV[0].pq = G * a + p * g * t * S;\r\n        vUVPack_NormalMapMacroUV_EmissiveUV[1].pq = G * a + s * g * t * S;\r\n        vUVPack_NormalMapMacroUV_EmissiveUV[2].pq = G * a + e * g * t * S;\r\n    }\r\n}\r\n#endif\r\nvoid main()\r\n{\r\n    vec3 u = aWaterPosition_Depth.stp;\r\n    vec4 v = uModelMatrix * vec4(u, 1.);\r\n    vPosition_WaterDepth.stp = v.stp;\r\n    vPosition_WaterDepth.q = aWaterPosition_Depth.q;\r\n#if defined(CLIP_PLANE_CLAMP) && defined(CLIP_PLANE)\r\n    v.t = -uClipPlane.q;\r\n#endif\r\n    gl_Position = uViewProjMatrix * v;\r\n#if defined(CLIP_PLANE_CLAMP) && defined(CLIP_PLANE)\r\n    return;\r\n#endif\r\n\r\n#if defined(CAUSTICS_COMPUTE) || defined(CAUSTICS_STENCIL)\r\n    const float E = 256.;\r\n    if (abs(vPosition_WaterDepth.t - uCausticsPlaneHeight) > E)\r\n    {\r\n        gl_Position.q = -1.;\r\n        return;\r\n    }\r\n#endif\r\n    vColour = aVertexColour;\r\n#if defined(LIGHT_SCATTERING) || defined(FOG_DISTANCE) || defined(SUNLIGHT_SHADOWS) || defined(VOLUMETRIC_SCATTERING_SUPPORTED)\r\n    vec3 t = v.stp - uCameraPosition;\r\n    float d = length(t);\r\n#endif\r\n\r\n#if defined(SUNLIGHT_SHADOWS)\r\n    vec3 f = vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    vFlowControlMask_ViewSpaceDepth.q = abs(dot(t.stp, f));\r\n#endif\r\n\r\n#if defined(LIGHT_SCATTERING) || defined(FOG_DISTANCE)\r\n    t /= d;\r\n#if defined(LIGHT_SCATTERING) && defined(SUNLIGHT_DIRECT_LIGHTING)\r\n    ComputeInOutScattering(t, d, uInvSunDirection, vOutScattering, vInScattering);\r\n#else\r\n    vOutScattering = vec3(1.);\r\n    vInScattering = vec3(0.);\r\n#endif\r\n\r\n#if defined(FOG_DISTANCE)\r\n    float q = FogBasedOnDistance(d);\r\n    q = q + q * uWaterTickFade.t - uWaterTickFade.t;\r\n    vInScattering = mix(vInScattering, uFogColour.stp, q);\r\n    vOutScattering *= 1. - q;\r\n    vColour.q = q;\r\n#else\r\n    vColour.q = 0.;\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(VOLUMETRIC_SCATTERING_SUPPORTED)\r\n    vec4 a = GetScatteredInRay2(8, t, d, 100.);\r\n    vec3 T = vec3(1.), S = vec3(0.);\r\n    GetInAndOutScattering(a, T, S);\r\n    vInScattering += S;\r\n    vOutScattering *= T;\r\n#endif\r\n    float g = uWaterNormalMapTextureScales_FlowNoiseScale.q;\r\n    vec2 p = aWaterFlowDataFlowNoise0_FlowNoise1.st / 127. * g, e = aWaterFlowDataFlowNoise0_FlowNoise1.pq / 127. * g, s = aWaterFlowDataFlowNoise2_FlowIndex_Spare.st / 127. * g, G = -aWaterFlowDataPatchFlow0 * (1. / 4095.), r = -aWaterFlowDataPatchFlow1 * (1. / 4095.), C = -aWaterFlowDataPatchFlow2 * (1. / 4095.);\r\n    int W = int(aWaterFlowDataFlowNoise2_FlowIndex_Spare.p);\r\n    vFlowControlMask_ViewSpaceDepth.stp = vec3(W == 0 ? 1. : 0., W == 1 ? 1. : 0., W == 2 ? 1. : 0.);\r\n    vNoisyPatchFlow0_NoisyPatchFlow1.st = G + p;\r\n    vNoisyPatchFlow0_NoisyPatchFlow1.pq = r + e;\r\n    vNoisyPatchFlow2_UVPack_NormalsFlow0Map0.st = C + s;\r\n#if defined(WATER_NORMAL_MAPS) || defined(WATER_FOAM_MAP)\r\n\r\n#if !defined(GLES2_COMPAT_MODE)\r\n    vUVPack_FoamUV = v.sp * uWaterNormalMapTextureScales_FlowNoiseScale.s;\r\n#endif\r\n    vec2 o = v.sp * uWaterNormalMapTextureScales_FlowNoiseScale.s, P = v.sp * uWaterNormalMapTextureScales_FlowNoiseScale.t, D = v.sp * uWaterNormalMapTextureScales_FlowNoiseScale.p;\r\n#if defined(WATER_NORMAL_MAPS)\r\n\r\n#if !defined(GLES2_COMPAT_MODE)\r\n    ComputeNormalMapDetailTexCoords(o, P, D, G, r, C, p, e, s);\r\n    ComputeNormalMapMacroTexCoords(o, P, D);\r\n#else\r\n    ComputeNormalMapDetailTexCoords(o, G, r, C, p, e, s);\r\n#endif\r\n\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(WATER_EMISSIVE) && !defined(GLES2_COMPAT_MODE)\r\n    ComputeEmissiveTexCoords(v, G, r, C);\r\n#endif\r\n}\r\n"
},3779:()=>{},7199:()=>{},5390:()=>{},5063:()=>{},9188:()=>{},9350:()=>{},6278:()=>{},3903:()=>{},6455:()=>{},9544:()=>{},1603:()=>{},6840:()=>{},9247:()=>{},2578:()=>{},9209:(e,t,n)=>{"use strict"
;var r=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?n.g:globalThis;e.exports=function(){
for(var e=[],t=0;t<r.length;t++)"function"==typeof i[r[t]]&&(e[e.length]=r[t]);return e}},8957:(e,t,n)=>{"use strict";var r=n(453)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},8487:e=>{"use strict"
;var t=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,n){var r,i,a;return n=n||{},r=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),i=""===r?1/0:void 0===n.maxLength?80:n.maxLength,a=n.replacer,function e(n,s,o){
var l,c,u,h,d,p,f,m,g,_,v,y;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(v=JSON.stringify(n,a)))return v;if(f=i-s.length-o,v.length<=f&&(g=v.replace(t,(function(e,t){return t||e+" "}))).length<=f)return g;if(null!=a&&(n=JSON.parse(v),
a=void 0),"object"==typeof n&&null!==n){if(m=s+r,u=[],c=0,Array.isArray(n))for(_="[",l="]",f=n.length;c<f;c++)u.push(e(n[c],m,c===f-1?0:1)||"null");else for(_="{",l="}",f=(p=Object.keys(n)).length;c<f;c++)h=p[c],d=JSON.stringify(h)+": ",
void 0!==(y=e(n[h],m,d.length+(c===f-1?0:1)))&&u.push(d+y);if(u.length>0)return[_,r+u.join(",\n"+m),l].join("\n"+s)}return v}(e,"",0)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}}
;return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},
n.u=e=>"generated/9b093b7baedb8ec54df9.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),
n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],
e.children||(e.children=[]),e),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script")
;if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),
n.b=document.baseURI||self.location.href;var r={};return(()=>{"use strict";n.r(r),n.d(r,{start:()=>fI,unload:()=>pI});var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>w,AddOperation:()=>Q,AdditiveAnimationBlendMode:()=>Bt,
AdditiveBlending:()=>y,AgXToneMapping:()=>se,AlphaFormat:()=>ze,AlwaysCompare:()=>An,AlwaysDepth:()=>j,AlwaysStencilFunc:()=>vn,AmbientLight:()=>cp,AnimationAction:()=>Zp,AnimationClip:()=>Dd,AnimationLoader:()=>Vd,AnimationMixer:()=>ef,
AnimationObjectGroup:()=>Jp,AnimationUtils:()=>bd,ArcCurve:()=>Bu,ArrayCamera:()=>jl,ArrowHelper:()=>qf,AttachedBindMode:()=>le,Audio:()=>Pp,AudioAnalyser:()=>Vp,AudioContext:()=>wp,AudioListener:()=>Op,AudioLoader:()=>Sp,AxesHelper:()=>Xf,
BackSide:()=>m,BasicDepthPacking:()=>Ht,BasicShadowMap:()=>u,BatchedMesh:()=>du,Bone:()=>Fc,BooleanKeyframeTrack:()=>Ad,Box2:()=>ff,Box3:()=>Pr,Box3Helper:()=>Vf,BoxGeometry:()=>$a,BoxHelper:()=>Gf,BufferAttribute:()=>ca,BufferGeometry:()=>Aa,
BufferGeometryLoader:()=>gp,ByteType:()=>Re,Cache:()=>Od,Camera:()=>Za,CameraHelper:()=>Uf,CanvasTexture:()=>Pu,CapsuleGeometry:()=>sh,CatmullRomCurve3:()=>Wu,CineonToneMapping:()=>re,CircleGeometry:()=>oh,ClampToEdgeWrapping:()=>_e,Clock:()=>Ip,
Color:()=>Zi,ColorKeyframeTrack:()=>Cd,ColorManagement:()=>mr,CompressedArrayTexture:()=>Lu,CompressedCubeTexture:()=>Ou,CompressedTexture:()=>Du,CompressedTextureLoader:()=>Hd,ConeGeometry:()=>ch,ConstantAlphaFactor:()=>G,ConstantColorFactor:()=>B,
CubeCamera:()=>is,CubeReflectionMapping:()=>he,CubeRefractionMapping:()=>de,CubeTexture:()=>as,CubeTextureLoader:()=>Wd,CubeUVReflectionMapping:()=>me,CubicBezierCurve:()=>Yu,CubicBezierCurve3:()=>Ku,CubicInterpolant:()=>Ed,CullFaceBack:()=>o,
CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>s,Curve:()=>Fu,CurvePath:()=>rh,CustomBlending:()=>E,CustomToneMapping:()=>ae,CylinderGeometry:()=>lh,Cylindrical:()=>df,Data3DTexture:()=>Rr,DataArrayTexture:()=>Mr,DataTexture:()=>Uc,
DataTextureLoader:()=>$d,DataUtils:()=>sa,DecrementStencilOp:()=>on,DecrementWrapStencilOp:()=>cn,DefaultLoadingManager:()=>Fd,DepthFormat:()=>je,DepthStencilFormat:()=>We,DepthTexture:()=>Qs,DetachedBindMode:()=>ce,DirectionalLight:()=>lp,
DirectionalLightHelper:()=>Of,DiscreteInterpolant:()=>Sd,DisplayP3ColorSpace:()=>Kt,DodecahedronGeometry:()=>hh,DoubleSide:()=>g,DstAlphaFactor:()=>L,DstColorFactor:()=>P,DynamicCopyUsage:()=>Ln,DynamicDrawUsage:()=>Mn,DynamicReadUsage:()=>kn,
EdgesGeometry:()=>gh,EllipseCurve:()=>Uu,EqualCompare:()=>xn,EqualDepth:()=>q,EqualStencilFunc:()=>pn,EquirectangularReflectionMapping:()=>pe,EquirectangularRefractionMapping:()=>fe,Euler:()=>yi,EventDispatcher:()=>Gn,ExtrudeGeometry:()=>Wh,
FileLoader:()=>Gd,Float16BufferAttribute:()=>_a,Float32BufferAttribute:()=>va,FloatType:()=>Oe,Fog:()=>rc,FogExp2:()=>nc,FramebufferTexture:()=>Nu,FrontSide:()=>f,Frustum:()=>ps,GLBufferAttribute:()=>sf,GLSL1:()=>Pn,GLSL3:()=>Fn,
GreaterCompare:()=>wn,GreaterDepth:()=>Y,GreaterEqualCompare:()=>Tn,GreaterEqualDepth:()=>X,GreaterEqualStencilFunc:()=>_n,GreaterStencilFunc:()=>mn,GridHelper:()=>Rf,Group:()=>Wl,HalfFloatType:()=>Pe,HemisphereLight:()=>Yd,
HemisphereLightHelper:()=>If,IcosahedronGeometry:()=>qh,ImageBitmapLoader:()=>xp,ImageLoader:()=>jd,ImageUtils:()=>yr,IncrementStencilOp:()=>sn,IncrementWrapStencilOp:()=>ln,InstancedBufferAttribute:()=>Vc,InstancedBufferGeometry:()=>mp,
InstancedInterleavedBuffer:()=>af,InstancedMesh:()=>Kc,Int16BufferAttribute:()=>pa,Int32BufferAttribute:()=>ma,Int8BufferAttribute:()=>ua,IntType:()=>De,InterleavedBuffer:()=>ac,InterleavedBufferAttribute:()=>oc,Interpolant:()=>xd,
InterpolateDiscrete:()=>Nt,InterpolateLinear:()=>Dt,InterpolateSmooth:()=>Lt,InvertStencilOp:()=>un,KeepStencilOp:()=>rn,KeyframeTrack:()=>Td,LOD:()=>Ac,LatheGeometry:()=>ah,Layers:()=>bi,LessCompare:()=>bn,LessDepth:()=>W,LessEqualCompare:()=>En,
LessEqualDepth:()=>$,LessEqualStencilFunc:()=>fn,LessStencilFunc:()=>dn,Light:()=>Xd,LightProbe:()=>dp,Line:()=>yu,Line3:()=>_f,LineBasicMaterial:()=>pu,LineCurve:()=>Ju,LineCurve3:()=>Zu,LineDashedMaterial:()=>fd,LineLoop:()=>wu,LineSegments:()=>Eu,
LinearDisplayP3ColorSpace:()=>Jt,LinearFilter:()=>Se,LinearInterpolant:()=>wd,LinearMipMapLinearFilter:()=>Me,LinearMipMapNearestFilter:()=>Ae,LinearMipmapLinearFilter:()=>Ce,LinearMipmapNearestFilter:()=>Te,LinearSRGBColorSpace:()=>Yt,
LinearToneMapping:()=>te,LinearTransfer:()=>Zt,Loader:()=>Ud,LoaderUtils:()=>fp,LoadingManager:()=>Pd,LoopOnce:()=>It,LoopPingPong:()=>kt,LoopRepeat:()=>Rt,LuminanceAlphaFormat:()=>He,LuminanceFormat:()=>Ve,MOUSE:()=>i,Material:()=>ta,
MaterialLoader:()=>pp,MathUtils:()=>er,Matrix3:()=>nr,Matrix4:()=>ci,MaxEquation:()=>C,Mesh:()=>ja,MeshBasicMaterial:()=>na,MeshDepthMaterial:()=>Ul,MeshDistanceMaterial:()=>Bl,MeshLambertMaterial:()=>dd,MeshMatcapMaterial:()=>pd,
MeshNormalMaterial:()=>hd,MeshPhongMaterial:()=>cd,MeshPhysicalMaterial:()=>ld,MeshStandardMaterial:()=>od,MeshToonMaterial:()=>ud,MinEquation:()=>A,MirroredRepeatWrapping:()=>ve,MixOperation:()=>Z,MultiplyBlending:()=>x,MultiplyOperation:()=>J,
NearestFilter:()=>ye,NearestMipMapLinearFilter:()=>we,NearestMipMapNearestFilter:()=>xe,NearestMipmapLinearFilter:()=>Ee,NearestMipmapNearestFilter:()=>be,NeutralToneMapping:()=>oe,NeverCompare:()=>yn,NeverDepth:()=>H,NeverStencilFunc:()=>hn,
NoBlending:()=>_,NoColorSpace:()=>qt,NoToneMapping:()=>ee,NormalAnimationBlendMode:()=>Ut,NormalBlending:()=>v,NotEqualCompare:()=>Sn,NotEqualDepth:()=>K,NotEqualStencilFunc:()=>gn,NumberKeyframeTrack:()=>Md,Object3D:()=>Pi,ObjectLoader:()=>_p,
ObjectSpaceNormalMap:()=>$t,OctahedronGeometry:()=>Xh,OneFactor:()=>I,OneMinusConstantAlphaFactor:()=>V,OneMinusConstantColorFactor:()=>z,OneMinusDstAlphaFactor:()=>O,OneMinusDstColorFactor:()=>F,OneMinusSrcAlphaFactor:()=>D,
OneMinusSrcColorFactor:()=>k,OrthographicCamera:()=>Is,P3Primaries:()=>tn,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>Bs,Path:()=>ih,PerspectiveCamera:()=>ns,Plane:()=>us,PlaneGeometry:()=>gs,PlaneHelper:()=>Hf,PointLight:()=>sp,
PointLightHelper:()=>Tf,Points:()=>Iu,PointsMaterial:()=>Su,PolarGridHelper:()=>kf,PolyhedronGeometry:()=>uh,PositionalAudio:()=>Gp,PropertyBinding:()=>Kp,PropertyMixer:()=>Hp,QuadraticBezierCurve:()=>Qu,QuadraticBezierCurve3:()=>eh,
Quaternion:()=>Nr,QuaternionKeyframeTrack:()=>Rd,QuaternionLinearInterpolant:()=>Id,RED_GREEN_RGTC2_Format:()=>Ct,RED_RGTC1_Format:()=>Tt,REVISION:()=>t,RGBADepthPacking:()=>jt,RGBAFormat:()=>Ge,RGBAIntegerFormat:()=>Ke,RGBA_ASTC_10x10_Format:()=>yt,
RGBA_ASTC_10x5_Format:()=>gt,RGBA_ASTC_10x6_Format:()=>_t,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>bt,RGBA_ASTC_12x12_Format:()=>xt,RGBA_ASTC_4x4_Format:()=>lt,RGBA_ASTC_5x4_Format:()=>ct,RGBA_ASTC_5x5_Format:()=>ut,
RGBA_ASTC_6x5_Format:()=>ht,RGBA_ASTC_6x6_Format:()=>dt,RGBA_ASTC_8x5_Format:()=>pt,RGBA_ASTC_8x6_Format:()=>ft,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>Et,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>it,
RGBA_PVRTC_4BPPV1_Format:()=>rt,RGBA_S3TC_DXT1_Format:()=>Ze,RGBA_S3TC_DXT3_Format:()=>Qe,RGBA_S3TC_DXT5_Format:()=>et,RGB_BPTC_SIGNED_Format:()=>wt,RGB_BPTC_UNSIGNED_Format:()=>St,RGB_ETC1_Format:()=>at,RGB_ETC2_Format:()=>st,
RGB_PVRTC_2BPPV1_Format:()=>nt,RGB_PVRTC_4BPPV1_Format:()=>tt,RGB_S3TC_DXT1_Format:()=>Je,RGFormat:()=>Xe,RGIntegerFormat:()=>Ye,RawShaderMaterial:()=>sd,Ray:()=>li,Raycaster:()=>lf,Rec709Primaries:()=>en,RectAreaLight:()=>up,RedFormat:()=>$e,
RedIntegerFormat:()=>qe,ReinhardToneMapping:()=>ne,RenderTarget:()=>Ar,RepeatWrapping:()=>ge,ReplaceStencilOp:()=>an,ReverseSubtractEquation:()=>T,RingGeometry:()=>Yh,SIGNED_RED_GREEN_RGTC2_Format:()=>Mt,SIGNED_RED_RGTC1_Format:()=>At,
SRGBColorSpace:()=>Xt,SRGBTransfer:()=>Qt,Scene:()=>ic,ShaderChunk:()=>_s,ShaderLib:()=>ys,ShaderMaterial:()=>Ja,ShadowMaterial:()=>ad,Shape:()=>_h,ShapeGeometry:()=>Kh,ShapePath:()=>Yf,ShapeUtils:()=>Vh,ShortType:()=>ke,Skeleton:()=>Gc,
SkeletonHelper:()=>wf,SkinnedMesh:()=>Pc,Source:()=>xr,Sphere:()=>ei,SphereGeometry:()=>Jh,Spherical:()=>hf,SphericalHarmonics3:()=>hp,SplineCurve:()=>th,SpotLight:()=>tp,SpotLightHelper:()=>yf,Sprite:()=>Ec,SpriteMaterial:()=>lc,
SrcAlphaFactor:()=>N,SrcAlphaSaturateFactor:()=>U,SrcColorFactor:()=>R,StaticCopyUsage:()=>Dn,StaticDrawUsage:()=>Cn,StaticReadUsage:()=>Rn,StereoCamera:()=>Mp,StreamCopyUsage:()=>On,StreamDrawUsage:()=>In,StreamReadUsage:()=>Nn,
StringKeyframeTrack:()=>kd,SubtractEquation:()=>S,SubtractiveBlending:()=>b,TOUCH:()=>a,TangentSpaceNormalMap:()=>Wt,TetrahedronGeometry:()=>Zh,Texture:()=>Sr,TextureLoader:()=>qd,TorusGeometry:()=>Qh,TorusKnotGeometry:()=>ed,Triangle:()=>qi,
TriangleFanDrawMode:()=>Vt,TriangleStripDrawMode:()=>Gt,TrianglesDrawMode:()=>zt,TubeGeometry:()=>td,UVMapping:()=>ue,Uint16BufferAttribute:()=>fa,Uint32BufferAttribute:()=>ga,Uint8BufferAttribute:()=>ha,Uint8ClampedBufferAttribute:()=>da,
Uniform:()=>tf,UniformsGroup:()=>rf,UniformsLib:()=>vs,UniformsUtils:()=>Ka,UnsignedByteType:()=>Ie,UnsignedInt248Type:()=>Be,UnsignedIntType:()=>Le,UnsignedShort4444Type:()=>Fe,UnsignedShort5551Type:()=>Ue,UnsignedShortType:()=>Ne,
VSMShadowMap:()=>p,Vector2:()=>tr,Vector3:()=>Dr,Vector4:()=>Tr,VectorKeyframeTrack:()=>Nd,VideoTexture:()=>ku,WebGL1Renderer:()=>tc,WebGL3DRenderTarget:()=>kr,WebGLArrayRenderTarget:()=>Ir,WebGLCoordinateSystem:()=>Bn,WebGLCubeRenderTarget:()=>ss,
WebGLMultipleRenderTargets:()=>Kf,WebGLRenderTarget:()=>Cr,WebGLRenderer:()=>ec,WebGLUtils:()=>Hl,WebGPUCoordinateSystem:()=>zn,WireframeGeometry:()=>nd,WrapAroundEnding:()=>Ft,ZeroCurvatureEnding:()=>Ot,ZeroFactor:()=>M,ZeroSlopeEnding:()=>Pt,
ZeroStencilOp:()=>nn,_SRGBAFormat:()=>Un,createCanvasElement:()=>lr});const t="162",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},a={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3
},s=0,o=1,l=2,c=3,u=0,h=1,d=2,p=3,f=0,m=1,g=2,_=0,v=1,y=2,b=3,x=4,E=5,w=100,S=101,T=102,A=103,C=104,M=200,I=201,R=202,k=203,N=204,D=205,L=206,O=207,P=208,F=209,U=210,B=211,z=212,G=213,V=214,H=0,j=1,W=2,$=3,q=4,X=5,Y=6,K=7,J=0,Z=1,Q=2,ee=0,te=1,ne=2,re=3,ie=4,ae=5,se=6,oe=7,le="attached",ce="detached",ue=300,he=301,de=302,pe=303,fe=304,me=306,ge=1e3,_e=1001,ve=1002,ye=1003,be=1004,xe=1004,Ee=1005,we=1005,Se=1006,Te=1007,Ae=1007,Ce=1008,Me=1008,Ie=1009,Re=1010,ke=1011,Ne=1012,De=1013,Le=1014,Oe=1015,Pe=1016,Fe=1017,Ue=1018,Be=1020,ze=1021,Ge=1023,Ve=1024,He=1025,je=1026,We=1027,$e=1028,qe=1029,Xe=1030,Ye=1031,Ke=1033,Je=33776,Ze=33777,Qe=33778,et=33779,tt=35840,nt=35841,rt=35842,it=35843,at=36196,st=37492,ot=37496,lt=37808,ct=37809,ut=37810,ht=37811,dt=37812,pt=37813,ft=37814,mt=37815,gt=37816,_t=37817,vt=37818,yt=37819,bt=37820,xt=37821,Et=36492,wt=36494,St=36495,Tt=36283,At=36284,Ct=36285,Mt=36286,It=2200,Rt=2201,kt=2202,Nt=2300,Dt=2301,Lt=2302,Ot=2400,Pt=2401,Ft=2402,Ut=2500,Bt=2501,zt=0,Gt=1,Vt=2,Ht=3200,jt=3201,Wt=0,$t=1,qt="",Xt="srgb",Yt="srgb-linear",Kt="display-p3",Jt="display-p3-linear",Zt="linear",Qt="srgb",en="rec709",tn="p3",nn=0,rn=7680,an=7681,sn=7682,on=7683,ln=34055,cn=34056,un=5386,hn=512,dn=513,pn=514,fn=515,mn=516,gn=517,_n=518,vn=519,yn=512,bn=513,xn=514,En=515,wn=516,Sn=517,Tn=518,An=519,Cn=35044,Mn=35048,In=35040,Rn=35045,kn=35049,Nn=35041,Dn=35046,Ln=35050,On=35042,Pn="100",Fn="300 es",Un=1035,Bn=2e3,zn=2001
;class Gn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners
;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return
;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}
const Vn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]
;let Hn=1234567;const jn=Math.PI/180,Wn=180/Math.PI;function $n(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0
;return(Vn[255&e]+Vn[e>>8&255]+Vn[e>>16&255]+Vn[e>>24&255]+"-"+Vn[255&t]+Vn[t>>8&255]+"-"+Vn[t>>16&15|64]+Vn[t>>24&255]+"-"+Vn[63&n|128]+Vn[n>>8&255]+"-"+Vn[n>>16&255]+Vn[n>>24&255]+Vn[255&r]+Vn[r>>8&255]+Vn[r>>16&255]+Vn[r>>24&255]).toLowerCase()}
function qn(e,t,n){return Math.max(t,Math.min(n,e))}function Xn(e,t){return(e%t+t)%t}function Yn(e,t,n){return(1-n)*e+n*t}function Kn(e){return!(e&e-1)&&0!==e}function Jn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Zn(e,t){
switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1)
;case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Qn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:
return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}
}const er={DEG2RAD:jn,RAD2DEG:Wn,generateUUID:$n,clamp:qn,euclideanModulo:Xn,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Yn,damp:function(e,t,n,r){
return Yn(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Xn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)
},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Hn=e);let t=Hn+=1831565813
;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*jn},radToDeg:function(e){return e*Wn},isPowerOfTwo:Kn,ceilPowerOfTwo:function(e){
return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:Jn,setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,s=Math.sin,o=a(n/2),l=s(n/2),c=a((t+r)/2),u=s((t+r)/2),h=a((t-r)/2),d=s((t-r)/2),p=a((r-t)/2),f=s((r-t)/2)
;switch(i){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break
;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Qn,denormalize:Zn};class tr{constructor(e=0,t=0){tr.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}
set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:
this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){
return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}
addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,
this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],
this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),
this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length()
;return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){
return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){
return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}
angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(qn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}
distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,
this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,
e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){
return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class nr{constructor(e,t,n,r,i,a,s,o,l){nr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l)}
set(e,t,n,r,i,a,s,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],
t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements
;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){
const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],_=r[1],v=r[4],y=r[7],b=r[2],x=r[5],E=r[8];return i[0]=a*f+s*_+o*b,i[3]=a*m+s*v+o*x,i[6]=a*g+s*y+o*E,i[1]=l*f+c*_+u*b,
i[4]=l*m+c*v+u*x,i[7]=l*g+c*y+u*E,i[2]=h*f+d*_+p*b,i[5]=h*m+d*v+p*x,i[8]=h*g+d*y+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){
const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-n*i*c+n*s*o+r*i*l-r*a*o}invert(){
const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=c*a-s*l,h=s*o-c*i,d=l*i-a*o,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(s*n-r*a)*f,e[3]=h*f,
e[4]=(c*t-r*o)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){
return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,s){
const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-r*l,r*o,-r*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(rr.makeScale(e,t)),this}rotate(e){return this.premultiply(rr.makeRotation(-e)),this}translate(e,t){
return this.premultiply(rr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}
makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){
const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const rr=new nr;function ir(e){
for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const ar={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function sr(e,t){return new ar[e](t)}function or(e){
return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function lr(){const e=or("canvas");return e.style.display="block",e}const cr={};function ur(e){e in cr||(cr[e]=!0,console.warn(e))}
const hr=(new nr).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),dr=(new nr).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pr={[Yt]:{transfer:Zt,primaries:en,toReference:e=>e,fromReference:e=>e
},[Xt]:{transfer:Qt,primaries:en,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Jt]:{transfer:Zt,primaries:tn,toReference:e=>e.applyMatrix3(dr),fromReference:e=>e.applyMatrix3(hr)},[Kt]:{transfer:Qt,primaries:tn,
toReference:e=>e.convertSRGBToLinear().applyMatrix3(dr),fromReference:e=>e.applyMatrix3(hr).convertLinearToSRGB()}},fr=new Set([Yt,Jt]),mr={enabled:!0,_workingColorSpace:Yt,get workingColorSpace(){return this._workingColorSpace},
set workingColorSpace(e){if(!fr.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=pr[t].toReference;return(0,
pr[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return pr[e].primaries},
getTransfer:function(e){return e===qt?Zt:pr[e].transfer}};function gr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function _r(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let vr;class yr{
static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===vr&&(vr=or("canvas")),vr.width=e.width,vr.height=e.height
;const n=vr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=vr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),
t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){
if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=or("canvas");t.width=e.width,
t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*gr(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0)
;for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*gr(t[e]/255)):t[e]=gr(t[e]);return{data:t,width:e.width,height:e.height}}
return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let br=0;class xr{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:br++}),this.uuid=$n(),this.data=e,
this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e
;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Er(r[t].image)):e.push(Er(r[t]))}else e=Er(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Er(e){
return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yr.getDataURL(e):e.data?{
data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let wr=0;class Sr extends Gn{
constructor(e=Sr.DEFAULT_IMAGE,t=Sr.DEFAULT_MAPPING,n=_e,r=_e,i=Se,a=Ce,s=Ge,o=Ie,l=Sr.DEFAULT_ANISOTROPY,c=qt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wr++}),this.uuid=$n(),this.name="",this.source=new xr(e),this.mipmaps=[],
this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new tr(0,0),this.repeat=new tr(1,1),this.center=new tr(0,0),this.rotation=0,
this.matrixAutoUpdate=!0,this.matrix=new nr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,
this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){
return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,
this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,
this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,
this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",
generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],
rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,
generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({
type:"dispose"})}transformUv(e){if(this.mapping!==ue)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ge:e.x=e.x-Math.floor(e.x);break;case _e:e.x=e.x<0?0:1;break;case ve:
1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ge:e.y=e.y-Math.floor(e.y);break;case _e:e.y=e.y<0?0:1;break;case ve:
1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Sr.DEFAULT_IMAGE=null,Sr.DEFAULT_MAPPING=ue,
Sr.DEFAULT_ANISOTROPY=1;class Tr{constructor(e=0,t=0,n=0,r=1){Tr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){
return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){
switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:
return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){
return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){
return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,
this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){
const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){
return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i
;const a=.01,s=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),
this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,_=(g+1)/2,v=(c+h)/4,y=(u+f)/4,b=(p+m)/4;return e>o&&e>_?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=y/n):o>_?o<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=v/r,i=b/r):_<a?(n=.707106781,
r=.707106781,i=0):(i=Math.sqrt(_),n=y/i,r=b/i),this.set(n,r,i,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(e){
return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),
this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){
return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length()
;return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),
this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){
return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){
return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){
return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,
this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}
fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),
this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ar extends Gn{constructor(e=1,t=1,n={}){
super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Tr(0,0,e,t),this.scissorTest=!1,this.viewport=new Tr(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,
minFilter:Se,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},n);const i=new Sr(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,
i.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let e=0;e<a;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,
this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n
;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){
return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0
;for(let t=0,n=e.textures.length;t<n;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new xr(t),this.depthBuffer=e.depthBuffer,
this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Cr extends Ar{constructor(e=1,t=1,n={}){super(e,t,n),
this.isWebGLRenderTarget=!0}}class Mr extends Sr{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ye,this.minFilter=ye,this.wrapR=_e,this.generateMipmaps=!1,
this.flipY=!1,this.unpackAlignment=1}}class Ir extends Cr{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Mr(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Rr extends Sr{
constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ye,this.minFilter=ye,this.wrapR=_e,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kr extends Cr{
constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Rr(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Nr{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,
this._w=r}static slerpFlat(e,t,n,r,i,a,s){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f)
;if(u!==f||o!==h||l!==d||c!==p){let e=1-s;const t=o*h+l*d+c*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,s=Math.sin(s*a)/i}const i=s*n;if(o=o*e+h*i,l=l*e+d*i,c=c*e+p*i,u=u*e+f*i,e===1-s){
const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const s=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return e[t]=s*p+c*u+o*d-l*h,
e[t+1]=o*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-o*u,e[t+3]=c*p-s*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,
this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)
}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),h=o(n/2),d=o(r/2),p=o(i/2);switch(a){case"XYZ":
this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,
this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":
this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){
const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){
const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u)
;this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1
;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),
this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(qn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){
return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){
return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,
this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}
multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+r*l-i*o,this._y=r*c+a*o+i*s-n*l,this._z=i*c+a*l+n*o-r*s,this._w=a*c-n*s-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){
if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let s=a*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,
this._y=r,this._z=i,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}
const l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){
return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){
return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,
e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}
_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Dr{constructor(e=0,t=0,n=0){Dr.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,
this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break
;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){
return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){
return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}
subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,
this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Or.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Or.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements
;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){
const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){
const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*r-s*n),c=2*(s*t-i*r),u=2*(i*n-a*t);return this.x=t+o*l+a*u-s*c,this.y=n+o*c+s*l-i*u,this.z=r+o*u+i*c-a*l,this}project(e){
return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements
;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){
return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){
return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),
this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),
this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),
this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){
return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}
lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}
crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=r*o-i*s,this.y=i*a-n*o,this.z=n*s-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}
projectOnPlane(e){return Lr.copy(this).projectOnVector(e),this.sub(Lr)}reflect(e){return this.sub(Lr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t
;return Math.acos(qn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){
return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,
this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements
;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}
setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,
this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),
this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,
this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Lr=new Dr,Or=new Nr;class Pr{constructor(e=new Dr(1/0,1/0,1/0),t=new Dr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){
return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ur.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty()
;for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Ur.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){
const n=Ur.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){
return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}
getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}
expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){
const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Ur):Ur.fromBufferAttribute(r,t),Ur.applyMatrix4(e.matrixWorld),
this.expandByPoint(Ur);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Br.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Br.copy(n.boundingBox)),Br.applyMatrix4(e.matrixWorld),this.union(Br)}
const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){
return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){
return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){
return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ur),Ur.distanceToSquared(e.center)<=e.radius*e.radius}
intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,
n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($r),
qr.subVectors(this.max,$r),zr.subVectors(e.a,$r),Gr.subVectors(e.b,$r),Vr.subVectors(e.c,$r),Hr.subVectors(Gr,zr),jr.subVectors(Vr,Gr),Wr.subVectors(zr,Vr)
;let t=[0,-Hr.z,Hr.y,0,-jr.z,jr.y,0,-Wr.z,Wr.y,Hr.z,0,-Hr.x,jr.z,0,-jr.x,Wr.z,0,-Wr.x,-Hr.y,Hr.x,0,-jr.y,jr.x,0,-Wr.y,Wr.x,0];return!!Kr(t,zr,Gr,Vr,qr)&&(t=[1,0,0,0,1,0,0,0,1],!!Kr(t,zr,Gr,Vr,qr)&&(Xr.crossVectors(Hr,jr),t=[Xr.x,Xr.y,Xr.z],
Kr(t,zr,Gr,Vr,qr)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ur).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),
e.radius=.5*this.getSize(Ur).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){
return this.isEmpty()||(Fr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),
Fr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),
Fr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}
const Fr=[new Dr,new Dr,new Dr,new Dr,new Dr,new Dr,new Dr,new Dr],Ur=new Dr,Br=new Pr,zr=new Dr,Gr=new Dr,Vr=new Dr,Hr=new Dr,jr=new Dr,Wr=new Dr,$r=new Dr,qr=new Dr,Xr=new Dr,Yr=new Dr;function Kr(e,t,n,r,i){for(let a=0,s=e.length-3;a<=s;a+=3){
Yr.fromArray(e,a);const s=i.x*Math.abs(Yr.x)+i.y*Math.abs(Yr.y)+i.z*Math.abs(Yr.z),o=t.dot(Yr),l=n.dot(Yr),c=r.dot(Yr);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}const Jr=new Pr,Zr=new Dr,Qr=new Dr;class ei{
constructor(e=new Dr,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Jr.setFromPoints(e).getCenter(n);let r=0
;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),
this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius
;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e)
;return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}
applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this
;Zr.subVectors(e,this.center);const t=Zr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Zr,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),
this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Qr.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Zr.copy(e.center).add(Qr)),this.expandByPoint(Zr.copy(e.center).sub(Qr))),this)}equals(e){
return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ti=new Dr,ni=new Dr,ri=new Dr,ii=new Dr,ai=new Dr,si=new Dr,oi=new Dr;class li{constructor(e=new Dr,t=new Dr(0,0,-1)){this.origin=e,
this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){
return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ti)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction)
;return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ti.subVectors(e,this.origin).dot(this.direction)
;return t<0?this.origin.distanceToSquared(e):(ti.copy(this.origin).addScaledVector(this.direction,t),ti.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ni.copy(e).add(t).multiplyScalar(.5),ri.copy(t).sub(e).normalize(),ii.copy(this.origin).sub(ni)
;const i=.5*e.distanceTo(t),a=-this.direction.dot(ri),s=ii.dot(this.direction),o=-ii.dot(ri),l=ii.lengthSq(),c=Math.abs(1-a*a);let u,h,d,p;if(c>0)if(u=a*o-s,h=a*s-o,p=i*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+a*h+2*s)+h*(a*u+h+2*o)+l
}else h=i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h=-i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-a*i+s)),h=u>0?-i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-o),i),
d=h*(h+2*o)+l):(u=Math.max(0,-(a*i+s)),h=u>0?i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l);else h=a>0?-i:i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),
r&&r.copy(ni).addScaledVector(ri,h),d}intersectSphere(e,t){ti.subVectors(e.center,this.origin);const n=ti.dot(this.direction),r=ti.dot(ti)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),s=n-a,o=n+a
;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null
;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin)
;return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,s,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,
r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(s=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),
n>o||s>r?null:((s>n||n!=n)&&(n=s),(o<r||r!=r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,ti)}intersectTriangle(e,t,n,r,i){ai.subVectors(t,e),si.subVectors(n,e),oi.crossVectors(ai,si)
;let a,s=this.direction.dot(oi);if(s>0){if(r)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}ii.subVectors(this.origin,e);const o=a*this.direction.dot(si.crossVectors(ii,si));if(o<0)return null;const l=a*this.direction.dot(ai.cross(ii))
;if(l<0)return null;if(o+l>s)return null;const c=-a*ii.dot(oi);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){
return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ci{constructor(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m){ci.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],
void 0!==e&&this.set(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m)}set(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}
identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ci).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],
t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements
;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){
return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/ui.setFromMatrixColumn(e,0).length(),i=1/ui.setFromMatrixColumn(e,1).length(),a=1/ui.setFromMatrixColumn(e,2).length()
;return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){
const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*o,t[2]=i-e*l,
t[6]=r+n*l,t[10]=a*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=a*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-a*u,
t[8]=r+n*s,t[1]=n+r*s,t[5]=a*c,t[9]=i-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){
const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,
t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(di,e,pi)}lookAt(e,t,n){const r=this.elements;return gi.subVectors(e,t),0===gi.lengthSq()&&(gi.z=1),
gi.normalize(),fi.crossVectors(n,gi),0===fi.lengthSq()&&(1===Math.abs(n.z)?gi.x+=1e-4:gi.z+=1e-4,gi.normalize(),fi.crossVectors(n,gi)),fi.normalize(),mi.crossVectors(gi,fi),r[0]=fi.x,r[4]=mi.x,r[8]=gi.x,r[1]=fi.y,r[5]=mi.y,r[9]=gi.y,r[2]=fi.z,
r[6]=mi.z,r[10]=gi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){
const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],x=r[0],E=r[4],w=r[8],S=r[12],T=r[1],A=r[5],C=r[9],M=r[13],I=r[2],R=r[6],k=r[10],N=r[14],D=r[3],L=r[7],O=r[11],P=r[15]
;return i[0]=a*x+s*T+o*I+l*D,i[4]=a*E+s*A+o*R+l*L,i[8]=a*w+s*C+o*k+l*O,i[12]=a*S+s*M+o*N+l*P,i[1]=c*x+u*T+h*I+d*D,i[5]=c*E+u*A+h*R+d*L,i[9]=c*w+u*C+h*k+d*O,i[13]=c*S+u*M+h*N+d*P,i[2]=p*x+f*T+m*I+g*D,i[6]=p*E+f*A+m*R+g*L,i[10]=p*w+f*C+m*k+g*O,
i[14]=p*S+f*M+m*N+g*P,i[3]=_*x+v*T+y*I+b*D,i[7]=_*E+v*A+y*R+b*L,i[11]=_*w+v*C+y*k+b*O,i[15]=_*S+v*M+y*N+b*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,
t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14]
;return e[3]*(+i*o*u-r*l*u-i*s*h+n*l*h+r*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+i*a*h-r*a*d+r*l*c-i*o*c)+e[11]*(+t*l*u-t*s*d-i*a*u+n*a*d+i*s*c-n*l*c)+e[15]*(-r*s*c-t*o*u+t*s*h+r*a*u-n*a*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],
e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,
r[14]=n),this}invert(){
const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*o*d-s*m*d-u*o*g+s*h*g,v=p*h*l-c*m*l-p*o*d+a*m*d+c*o*g-a*h*g,y=c*f*l-p*u*l+p*s*d-a*f*d-c*s*g+a*u*g,b=p*u*o-c*f*o-p*s*h+a*f*h+c*s*m-a*u*m,x=t*_+n*v+r*y+i*b
;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/x;return e[0]=_*E,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*E,e[2]=(s*m*i-f*o*i+f*r*l-n*m*l-s*r*g+n*o*g)*E,e[3]=(u*o*i-s*h*i-u*r*l+n*h*l+s*r*d-n*o*d)*E,e[4]=v*E,
e[5]=(c*m*i-p*h*i+p*r*d-t*m*d-c*r*g+t*h*g)*E,e[6]=(p*o*i-a*m*i-p*r*l+t*m*l+a*r*g-t*o*g)*E,e[7]=(a*h*i-c*o*i+c*r*l-t*h*l-a*r*d+t*o*d)*E,e[8]=y*E,e[9]=(p*u*i-c*f*i-p*n*d+t*f*d+c*n*g-t*u*g)*E,e[10]=(a*f*i-p*s*i+p*n*l-t*f*l-a*n*g+t*s*g)*E,
e[11]=(c*s*i-a*u*i-c*n*l+t*u*l+a*n*d-t*s*d)*E,e[12]=b*E,e[13]=(c*f*r-p*u*r+p*n*h-t*f*h-c*n*m+t*u*m)*E,e[14]=(p*s*r-a*f*r-p*n*o+t*f*o+a*n*m-t*s*m)*E,e[15]=(a*u*r-c*s*r+c*n*o-t*u*o-a*n*h+t*s*h)*E,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z
;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10]
;return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e)
;return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e)
;return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,s=e.y,o=e.z,l=i*a,c=i*s;return this.set(l*a+n,l*s-r*o,l*o+r*s,0,l*s+r*o,c*s+n,c*o-r*a,0,l*o-r*s,c*o+r*a,i*o*o+n,0,0,0,0,1),
this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){
const r=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,l=i+i,c=a+a,u=s+s,h=i*l,d=i*c,p=i*u,f=a*c,m=a*u,g=s*u,_=o*l,v=o*c,y=o*u,b=n.x,x=n.y,E=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+y)*b,r[2]=(p-v)*b,r[3]=0,r[4]=(d-y)*x,r[5]=(1-(h+g))*x,r[6]=(m+_)*x,r[7]=0,
r[8]=(p+v)*E,r[9]=(m-_)*E,r[10]=(1-(h+f))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=ui.set(r[0],r[1],r[2]).length();const a=ui.set(r[4],r[5],r[6]).length(),s=ui.set(r[8],r[9],r[10]).length()
;this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],hi.copy(this);const o=1/i,l=1/a,c=1/s;return hi.elements[0]*=o,hi.elements[1]*=o,hi.elements[2]*=o,hi.elements[4]*=l,hi.elements[5]*=l,hi.elements[6]*=l,hi.elements[8]*=c,hi.elements[9]*=c,
hi.elements[10]*=c,t.setFromRotationMatrix(hi),n.x=i,n.y=a,n.z=s,this}makePerspective(e,t,n,r,i,a,s=Bn){const o=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),h=(n+r)/(n-r);let d,p;if(s===Bn)d=-(a+i)/(a-i),p=-2*a*i/(a-i);else{
if(s!==zn)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-a/(a-i),p=-a*i/(a-i)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}
makeOrthographic(e,t,n,r,i,a,s=Bn){const o=this.elements,l=1/(t-e),c=1/(n-r),u=1/(a-i),h=(t+e)*l,d=(n+r)*c;let p,f;if(s===Bn)p=(a+i)*u,f=-2*u;else{if(s!==zn)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=i*u,
f=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}
fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],
e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ui=new Dr,hi=new ci,di=new Dr(0,0,0),pi=new Dr(1,1,1),fi=new Dr,mi=new Dr,gi=new Dr,_i=new ci,vi=new Nr;class yi{constructor(e=0,t=0,n=0,r=yi.DEFAULT_ORDER){
this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,
this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){
return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){
const r=e.elements,i=r[0],a=r[4],s=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(qn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,l),this._z=0);break
;case"YXZ":this._x=Math.asin(-qn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(qn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),
this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-qn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":
this._z=Math.asin(qn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-qn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),
this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){
return _i.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_i,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return vi.setFromEuler(this),this.setFromQuaternion(vi,e)}equals(e){
return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,
e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yi.DEFAULT_ORDER="XYZ";class bi{constructor(){
this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}
let xi=0;const Ei=new Dr,wi=new Nr,Si=new ci,Ti=new Dr,Ai=new Dr,Ci=new Dr,Mi=new Nr,Ii=new Dr(1,0,0),Ri=new Dr(0,1,0),ki=new Dr(0,0,1),Ni={type:"added"},Di={type:"removed"},Li={type:"childadded",child:null},Oi={type:"childremoved",child:null}
;class Pi extends Gn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xi++}),this.uuid=$n(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pi.DEFAULT_UP.clone()
;const e=new Dr,t=new yi,n=new Nr,r=new Dr(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{
configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ci},normalMatrix:{value:new nr}}),this.matrix=new ci,this.matrixWorld=new ci,
this.matrixAutoUpdate=Pi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new bi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,
this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),
this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){
this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return wi.setFromAxisAngle(e,t),this.quaternion.multiply(wi),this}
rotateOnWorldAxis(e,t){return wi.setFromAxisAngle(e,t),this.quaternion.premultiply(wi),this}rotateX(e){return this.rotateOnAxis(Ii,e)}rotateY(e){return this.rotateOnAxis(Ri,e)}rotateZ(e){return this.rotateOnAxis(ki,e)}translateOnAxis(e,t){
return Ei.copy(e).applyQuaternion(this.quaternion),this.position.add(Ei.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ii,e)}translateY(e){return this.translateOnAxis(Ri,e)}translateZ(e){return this.translateOnAxis(ki,e)}
localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Si.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ti.copy(e):Ti.set(e,t,n)
;const r=this.parent;this.updateWorldMatrix(!0,!1),Ai.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Si.lookAt(Ai,Ti,this.up):Si.lookAt(Ti,Ai,this.up),this.quaternion.setFromRotationMatrix(Si),
r&&(Si.extractRotation(r.matrixWorld),wi.setFromRotationMatrix(Si),this.quaternion.premultiply(wi.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}
return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ni),Li.child=e,this.dispatchEvent(Li),
Li.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e)
;return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Di),Oi.child=e,this.dispatchEvent(Oi),Oi.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)
}attach(e){return this.updateWorldMatrix(!0,!1),Si.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Si.multiply(e.parent.matrixWorld)),e.applyMatrix4(Si),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){
return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t)
;if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),
e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ai,e,Ci),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ai,Mi,e),e}
getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){
if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){
this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),
(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children
;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),
this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t]
;!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,
type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),
!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),
r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),
null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,
r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,
sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,
r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={
min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),
this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry)
;const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,
r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[]
;for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[]
;for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){
const t=a(e.geometries),r=a(e.materials),i=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),
o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){
return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),
this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,
this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),
!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Pi.DEFAULT_UP=new Dr(0,1,0),Pi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0
;const Fi=new Dr,Ui=new Dr,Bi=new Dr,zi=new Dr,Gi=new Dr,Vi=new Dr,Hi=new Dr,ji=new Dr,Wi=new Dr,$i=new Dr;class qi{constructor(e=new Dr,t=new Dr,n=new Dr){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Fi.subVectors(e,t),
r.cross(Fi);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Fi.subVectors(r,t),Ui.subVectors(n,t),Bi.subVectors(e,t)
;const a=Fi.dot(Fi),s=Fi.dot(Ui),o=Fi.dot(Bi),l=Ui.dot(Ui),c=Ui.dot(Bi),u=a*l-s*s;if(0===u)return i.set(0,0,0),null;const h=1/u,d=(l*o-s*c)*h,p=(a*c-s*o)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){
return null!==this.getBarycoord(e,t,n,r,zi)&&zi.x>=0&&zi.y>=0&&zi.x+zi.y<=1}static getInterpolation(e,t,n,r,i,a,s,o){return null===this.getBarycoord(e,t,n,r,zi)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),
o.addScaledVector(i,zi.x),o.addScaledVector(a,zi.y),o.addScaledVector(s,zi.z),o)}static isFrontFacing(e,t,n,r){return Fi.subVectors(n,t),Ui.subVectors(e,t),Fi.cross(Ui).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}
setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}
clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fi.subVectors(this.c,this.b),Ui.subVectors(this.a,this.b),.5*Fi.cross(Ui).length()}getMidpoint(e){
return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){
return qi.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return qi.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return qi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){
return qi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,s;Gi.subVectors(r,n),Vi.subVectors(i,n),ji.subVectors(e,n)
;const o=Gi.dot(ji),l=Vi.dot(ji);if(o<=0&&l<=0)return t.copy(n);Wi.subVectors(e,r);const c=Gi.dot(Wi),u=Vi.dot(Wi);if(c>=0&&u<=c)return t.copy(r);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return a=o/(o-c),t.copy(n).addScaledVector(Gi,a);$i.subVectors(e,i)
;const d=Gi.dot($i),p=Vi.dot($i);if(p>=0&&d<=p)return t.copy(i);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Vi,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Hi.subVectors(i,r),s=(u-c)/(u-c+(d-p)),
t.copy(r).addScaledVector(Hi,s);const g=1/(m+f+h);return a=f*g,s=h*g,t.copy(n).addScaledVector(Gi,a).addScaledVector(Vi,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Xi={aliceblue:15792383,
antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,
coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,
darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,
dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,
lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,
lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,
mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,
olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,
powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,
slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,
yellow:16776960,yellowgreen:10145074},Yi={h:0,s:0,l:0},Ki={h:0,s:0,l:0};function Ji(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Zi{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,
this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,
this.b=e,this}setHex(e,t=Xt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,mr.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=mr.workingColorSpace){return this.r=e,this.g=t,this.b=n,
mr.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=mr.workingColorSpace){if(e=Xn(e,1),t=qn(t,0,1),n=qn(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ji(i,r,e+1/3),this.g=Ji(i,r,e),this.b=Ji(i,r,e-1/3)}
return mr.toWorkingColorSpace(this,r),this}setStyle(e,t=Xt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=r[1],s=r[2]
;switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t)
;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":
if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:
console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t)
;if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Xt){const n=Xi[e.toLowerCase()]
;return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=gr(e.r),
this.g=gr(e.g),this.b=gr(e.b),this}copyLinearToSRGB(e){return this.r=_r(e.r),this.g=_r(e.g),this.b=_r(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Xt){
return mr.fromWorkingColorSpace(Qi.copy(this),e),65536*Math.round(qn(255*Qi.r,0,255))+256*Math.round(qn(255*Qi.g,0,255))+Math.round(qn(255*Qi.b,0,255))}getHexString(e=Xt){return("000000"+this.getHex(e).toString(16)).slice(-6)}
getHSL(e,t=mr.workingColorSpace){mr.fromWorkingColorSpace(Qi.copy(this),t);const n=Qi.r,r=Qi.g,i=Qi.b,a=Math.max(n,r,i),s=Math.min(n,r,i);let o,l;const c=(s+a)/2;if(s===a)o=0,l=0;else{const e=a-s;switch(l=c<=.5?e/(a+s):e/(2-a-s),a){case n:
o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=mr.workingColorSpace){return mr.fromWorkingColorSpace(Qi.copy(this),t),e.r=Qi.r,e.g=Qi.g,e.b=Qi.b,e}getStyle(e=Xt){
mr.fromWorkingColorSpace(Qi.copy(this),e);const t=Qi.r,n=Qi.g,r=Qi.b;return e!==Xt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){
return this.getHSL(Yi),this.setHSL(Yi.h+e,Yi.s+t,Yi.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){
return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){
return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Yi),e.getHSL(Ki)
;const n=Yn(Yi.h,Ki.h,t),r=Yn(Yi.s,Ki.s,t),i=Yn(Yi.l,Ki.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements
;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){
return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Qi=new Zi
;Zi.NAMES=Xi;let ea=0;class ta extends Gn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ea++}),this.uuid=$n(),this.name="",this.type="Material",this.blending=v,this.side=f,this.vertexColors=!1,this.opacity=1,
this.transparent=!1,this.alphaHash=!1,this.blendSrc=N,this.blendDst=D,this.blendEquation=w,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Zi(0,0,0),this.blendAlpha=0,this.depthFunc=$,
this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rn,this.stencilZFail=rn,this.stencilZPass=rn,this.stencilWrite=!1,this.clippingPlanes=null,
this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,
this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}
onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`)
;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={
textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,
""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),
this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),
void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),
void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),
void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),
this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),
this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),
void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),
this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),
void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),
this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),
this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),
this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,
n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),
this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),
this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),
this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),
this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),
void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),
this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),
this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),
this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),
void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),
this.blending!==v&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),
this.blendSrc!==N&&(n.blendSrc=this.blendSrc),this.blendDst!==D&&(n.blendDst=this.blendDst),this.blendEquation!==w&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),
null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),
0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==$&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),
!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==vn&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),
255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==rn&&(n.stencilFail=this.stencilFail),this.stencilZFail!==rn&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==rn&&(n.stencilZPass=this.stencilZPass),
!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),
0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),
void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),
!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),
this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),
!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images)
;t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,
this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,
this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,
this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e)
;for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,
this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,
this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}
set needsUpdate(e){!0===e&&this.version++}}class na extends ta{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,
this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yi,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",
this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,
this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,
this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ra=function(){
const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(r[e]=1024>>-t-14,
r[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}
const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13)
;for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,
exponentTable:s,offsetTable:o}}();function ia(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=qn(e,-65504,65504),ra.floatView[0]=e;const t=ra.uint32View[0],n=t>>23&511
;return ra.baseTable[n]+((8388607&t)>>ra.shiftTable[n])}function aa(e){const t=e>>10;return ra.uint32View[0]=ra.mantissaTable[ra.offsetTable[t]+(1023&e)]+ra.exponentTable[t],ra.floatView[0]}const sa={toHalfFloat:ia,fromHalfFloat:aa
},oa=new Dr,la=new tr;class ca{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,
this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Cn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Oe,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){
return ur("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}
clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}
copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){
if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)la.fromBufferAttribute(this,t),la.applyMatrix3(e),this.setXY(t,la.x,la.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.applyMatrix3(e),
this.setXYZ(t,oa.x,oa.y,oa.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.applyMatrix4(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}applyNormalMatrix(e){
for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.applyNormalMatrix(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.transformDirection(e),
this.setXYZ(t,oa.x,oa.y,oa.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Zn(n,this.array)),n}setComponent(e,t,n){
return this.normalized&&(n=Qn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Qn(t,this.array)),
this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){
let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3]
;return this.normalized&&(t=Zn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array)),
this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){
return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array),i=Qn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}
clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),
this.usage!==Cn&&(e.usage=this.usage),e}}class ua extends ca{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ha extends ca{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class da extends ca{constructor(e,t,n){
super(new Uint8ClampedArray(e),t,n)}}class pa extends ca{constructor(e,t,n){super(new Int16Array(e),t,n)}}class fa extends ca{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ma extends ca{constructor(e,t,n){super(new Int32Array(e),t,n)}}
class ga extends ca{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class _a extends ca{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=aa(this.array[e*this.itemSize])
;return this.normalized&&(t=Zn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize]=ia(t),this}getY(e){let t=aa(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zn(t,this.array)),t}setY(e,t){
return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize+1]=ia(t),this}getZ(e){let t=aa(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Qn(t,this.array)),
this.array[e*this.itemSize+2]=ia(t),this}getW(e){let t=aa(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Qn(t,this.array)),this.array[e*this.itemSize+3]=ia(t),this}setXY(e,t,n){
return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array)),this.array[e+0]=ia(t),this.array[e+1]=ia(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array)),
this.array[e+0]=ia(t),this.array[e+1]=ia(n),this.array[e+2]=ia(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array),i=Qn(i,this.array)),this.array[e+0]=ia(t),
this.array[e+1]=ia(n),this.array[e+2]=ia(r),this.array[e+3]=ia(i),this}}class va extends ca{constructor(e,t,n){super(new Float32Array(e),t,n)}}let ya=0;const ba=new ci,xa=new Pi,Ea=new Dr,wa=new Pr,Sa=new Pr,Ta=new Dr;class Aa extends Gn{
constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ya++}),this.uuid=$n(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,
this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ir(e)?ga:fa)(e,1):this.index=e,this}getAttribute(e){
return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,
materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal
;if(void 0!==n){const t=(new nr).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),
null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ba.makeRotationFromQuaternion(e),this.applyMatrix4(ba),this}rotateX(e){return ba.makeRotationX(e),this.applyMatrix4(ba),this}rotateY(e){
return ba.makeRotationY(e),this.applyMatrix4(ba),this}rotateZ(e){return ba.makeRotationZ(e),this.applyMatrix4(ba),this}translate(e,t,n){return ba.makeTranslation(e,t,n),this.applyMatrix4(ba),this}scale(e,t,n){return ba.makeScale(e,t,n),
this.applyMatrix4(ba),this}lookAt(e){return xa.lookAt(e),xa.updateMatrix(),this.applyMatrix4(xa.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ea).negate(),this.translate(Ea.x,Ea.y,Ea.z),this}setFromPoints(e){
const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new va(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Pr)
;const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),
void this.boundingBox.set(new Dr(-1/0,-1/0,-1/0),new Dr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];wa.setFromBufferAttribute(n),
this.morphTargetsRelative?(Ta.addVectors(this.boundingBox.min,wa.min),this.boundingBox.expandByPoint(Ta),Ta.addVectors(this.boundingBox.max,wa.max),this.boundingBox.expandByPoint(Ta)):(this.boundingBox.expandByPoint(wa.min),
this.boundingBox.expandByPoint(wa.max))}}else this.boundingBox.makeEmpty()
;(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}
computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ei);const e=this.attributes.position,t=this.morphAttributes.position
;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Dr,1/0);if(e){const n=this.boundingSphere.center
;if(wa.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Sa.setFromBufferAttribute(n),this.morphTargetsRelative?(Ta.addVectors(wa.min,Sa.min),wa.expandByPoint(Ta),Ta.addVectors(wa.max,Sa.max),
wa.expandByPoint(Ta)):(wa.expandByPoint(Sa.min),wa.expandByPoint(Sa.max))}wa.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Ta.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Ta));if(t)for(let i=0,a=t.length;i<a;i++){
const a=t[i],s=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)Ta.fromBufferAttribute(a,t),s&&(Ea.fromBufferAttribute(e,t),Ta.add(Ea)),r=Math.max(r,n.distanceToSquared(Ta))}this.boundingSphere.radius=Math.sqrt(r),
isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes
;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv
;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ca(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),s=[],o=[];for(let e=0;e<n.count;e++)s[e]=new Dr,o[e]=new Dr
;const l=new Dr,c=new Dr,u=new Dr,h=new tr,d=new tr,p=new tr,f=new Dr,m=new Dr;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),h.fromBufferAttribute(i,e),d.fromBufferAttribute(i,t),
p.fromBufferAttribute(i,r),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(a),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(a),
s[e].add(f),s[t].add(f),s[r].add(f),o[e].add(m),o[t].add(m),o[r].add(m))}let _=this.groups;0===_.length&&(_=[{start:0,count:e.count}]);for(let t=0,n=_.length;t<n;++t){const n=_[t],r=n.start
;for(let t=r,i=r+n.count;t<i;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const v=new Dr,y=new Dr,b=new Dr,x=new Dr;function E(e){b.fromBufferAttribute(r,e),x.copy(b);const t=s[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),
y.crossVectors(x,t);const n=y.dot(o[e])<0?-1:1;a.setXYZW(e,v.x,v.y,v.z,n)}for(let t=0,n=_.length;t<n;++t){const n=_[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)E(e.getX(t+0)),E(e.getX(t+1)),E(e.getX(t+2))}}computeVertexNormals(){
const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ca(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0)
;const r=new Dr,i=new Dr,a=new Dr,s=new Dr,o=new Dr,l=new Dr,c=new Dr,u=new Dr;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),
c.subVectors(a,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),o.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)
}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z)
;this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ta.fromBufferAttribute(e,t),Ta.normalize(),e.setXYZ(t,Ta.x,Ta.y,Ta.z)}toNonIndexed(){function e(e,t){
const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let s=0,o=0;for(let i=0,l=t.length;i<l;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)a[o++]=n[s++]}return new ca(a,r,i)}
if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Aa,n=this.index.array,r=this.attributes;for(const i in r){const a=e(r[i],n);t.setAttribute(i,a)}
const i=this.morphAttributes;for(const r in i){const a=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);a.push(r)}t.morphAttributes[r]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,n=a.length;e<n;e++){
const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),
Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={
type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){
const n=this.morphAttributes[t],a=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];a.push(r.toJSON(e.data))}a.length>0&&(r[t]=a,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups
;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,
this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e]
;this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups
;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),
this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}
const Ca=new ci,Ma=new li,Ia=new ei,Ra=new Dr,ka=new Dr,Na=new Dr,Da=new Dr,La=new Dr,Oa=new Dr,Pa=new tr,Fa=new tr,Ua=new tr,Ba=new Dr,za=new Dr,Ga=new Dr,Va=new Dr,Ha=new Dr;class ja extends Pi{constructor(e=new Aa,t=new na){super(),this.isMesh=!0,
this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),
void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){
const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e)
;this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e)
;const s=this.morphTargetInfluences;if(i&&s){Oa.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=s[n],o=i[n];0!==r&&(La.fromBufferAttribute(o,e),a?Oa.addScaledVector(La,r):Oa.addScaledVector(La.sub(t),r))}t.add(Oa)}return t}raycast(e,t){
const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ia.copy(n.boundingSphere),Ia.applyMatrix4(i),Ma.copy(e.ray).recast(e.near),!1===Ia.containsPoint(Ma.origin)){
if(null===Ma.intersectSphere(Ia,Ra))return;if(Ma.origin.distanceToSquared(Ra)>(e.far-e.near)**2)return}Ca.copy(i).invert(),Ma.copy(e.ray).applyMatrix4(Ca),null!==n.boundingBox&&!1===Ma.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Ma)}
}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,s=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange
;if(null!==s)if(Array.isArray(a))for(let i=0,o=h.length;i<o;i++){const o=h[i],p=a[o.materialIndex]
;for(let i=Math.max(o.start,d.start),a=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));i<a;i+=3)r=Wa(this,p,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))
}else for(let i=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);i<o;i+=3)r=Wa(this,a,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),
t.push(r));else if(void 0!==o)if(Array.isArray(a))for(let i=0,s=h.length;i<s;i++){const s=h[i],p=a[s.materialIndex]
;for(let i=Math.max(s.start,d.start),a=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));i<a;i+=3)r=Wa(this,p,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))
}else for(let i=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);i<s;i+=3)r=Wa(this,a,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}function Wa(e,t,n,r,i,a,s,o,l,c){e.getVertexPosition(o,ka),e.getVertexPosition(l,Na),
e.getVertexPosition(c,Da);const u=function(e,t,n,r,i,a,s,o){let l;if(l=t.side===m?r.intersectTriangle(s,a,i,!0,o):r.intersectTriangle(i,a,s,t.side===f,o),null===l)return null;Ha.copy(o),Ha.applyMatrix4(e.matrixWorld)
;const c=n.ray.origin.distanceTo(Ha);return c<n.near||c>n.far?null:{distance:c,point:Ha.clone(),object:e}}(e,t,n,r,ka,Na,Da,Va);if(u){i&&(Pa.fromBufferAttribute(i,o),Fa.fromBufferAttribute(i,l),Ua.fromBufferAttribute(i,c),
u.uv=qi.getInterpolation(Va,ka,Na,Da,Pa,Fa,Ua,new tr)),a&&(Pa.fromBufferAttribute(a,o),Fa.fromBufferAttribute(a,l),Ua.fromBufferAttribute(a,c),u.uv1=qi.getInterpolation(Va,ka,Na,Da,Pa,Fa,Ua,new tr)),s&&(Ba.fromBufferAttribute(s,o),
za.fromBufferAttribute(s,l),Ga.fromBufferAttribute(s,c),u.normal=qi.getInterpolation(Va,ka,Na,Da,Ba,za,Ga,new Dr),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a:o,b:l,c,normal:new Dr,materialIndex:0}
;qi.getNormal(ka,Na,Da,e.normal),u.face=e}return u}class $a extends Aa{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const s=this
;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const o=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,r,i,a,p,f,m,g,_){const v=a/m,y=p/g,b=a/2,x=p/2,E=f/2,w=m+1,S=g+1;let T=0,A=0;const C=new Dr;for(let a=0;a<S;a++){const s=a*y-x
;for(let o=0;o<w;o++){const h=o*v-b;C[e]=h*r,C[t]=s*i,C[n]=E,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(o/m),u.push(1-a/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){
const n=h+t+w*e,r=h+t+w*(e+1),i=h+(t+1)+w*(e+1),a=h+(t+1)+w*e;o.push(n,r,a),o.push(r,i,a),A+=6}s.addGroup(d,A,_),d+=A,h+=T}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),
p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new va(l,3)),this.setAttribute("normal",new va(c,3)),this.setAttribute("uv",new va(u,2))}copy(e){
return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $a(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qa(e){const t={};for(const n in e){t[n]={}
;for(const r in e[n]){const i=e[n][r]
;i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),
t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Xa(e){const t={};for(let n=0;n<e.length;n++){const r=qa(e[n]);for(const e in r)t[e]=r[e]}return t}function Ya(e){
return null===e.getRenderTarget()?e.outputColorSpace:mr.workingColorSpace}const Ka={clone:qa,merge:Xa};class Ja extends ta{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},
this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,
this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},
this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,
this.vertexShader=e.vertexShader,this.uniforms=qa(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,
this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e)
;t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()
}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()
}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,
t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Za extends Pi{constructor(){super(),this.isCamera=!0,this.type="Camera",
this.matrixWorldInverse=new ci,this.projectionMatrix=new ci,this.projectionMatrixInverse=new ci,this.coordinateSystem=Bn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),
this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){
super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}
const Qa=new Dr,es=new tr,ts=new tr;class ns extends Za{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,
this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,
this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Wn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){
const e=Math.tan(.5*jn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Wn*Math.atan(Math.tan(.5*jn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){
return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Qa.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Qa.x,Qa.y).multiplyScalar(-e/Qa.z),Qa.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),
n.set(Qa.x,Qa.y).multiplyScalar(-e/Qa.z)}getViewSize(e,t){return this.getViewBounds(e,es,ts),t.subVectors(ts,es)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,
height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),
this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*jn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,s=a.fullHeight
;i+=a.offsetX*r/e,t-=a.offsetY*n/s,r*=a.width/e,n*=a.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),
this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,
t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const rs=-90;class is extends Pi{constructor(e,t,n){super(),this.type="CubeCamera",
this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ns(rs,1,e,t);r.layers=this.layers,this.add(r);const i=new ns(rs,1,e,t);i.layers=this.layers,this.add(i);const a=new ns(rs,1,e,t);a.layers=this.layers,this.add(a)
;const s=new ns(rs,1,e,t);s.layers=this.layers,this.add(s);const o=new ns(rs,1,e,t);o.layers=this.layers,this.add(o);const l=new ns(rs,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){
const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,s,o]=t;for(const e of t)this.remove(e);if(e===Bn)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),
s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==zn)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),
i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld()
;const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem())
;const[i,a,s,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),
e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),
e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class as extends Sr{constructor(e,t,n,r,i,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:he,n,r,i,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){
this.image=e}}class ss extends Cr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n]
;this.texture=new as(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,
this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Se}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,
this.texture.magFilter=t.magFilter;const n=new $a(5,5,5),r=new Ja({name:"CubemapFromEquirect",uniforms:qa({tEquirect:{value:null}}),
vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",
fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",
side:m,blending:_});r.uniforms.tEquirect.value=t;const i=new ja(n,r),a=t.minFilter;return t.minFilter===Ce&&(t.minFilter=Se),new is(1,10,this).update(e,i),t.minFilter=a,i.geometry.dispose(),i.material.dispose(),this}clear(e,t,n,r){
const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const os=new Dr,ls=new Dr,cs=new nr;class us{constructor(e=new Dr(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){
return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}
setFromCoplanarPoints(e,t,n){const r=os.subVectors(n,t).cross(ls.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){
const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){
return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(os),r=this.normal.dot(n)
;if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){
const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){
return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||cs.getNormalMatrix(e),r=this.coplanarPoint(os).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){
return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const hs=new ei,ds=new Dr;class ps{
constructor(e=new us,t=new us,n=new us,r=new us,i=new us,a=new us){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(a),this}copy(e){const t=this.planes
;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Bn){const n=this.planes,r=e.elements,i=r[0],a=r[1],s=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],_=r[13],v=r[14],y=r[15]
;if(n[0].setComponents(o-i,h-l,m-d,y-g).normalize(),n[1].setComponents(o+i,h+l,m+d,y+g).normalize(),n[2].setComponents(o+a,h+c,m+p,y+_).normalize(),n[3].setComponents(o-a,h-c,m-p,y-_).normalize(),n[4].setComponents(o-s,h-u,m-f,y-v).normalize(),
t===Bn)n[5].setComponents(o+s,h+u,m+f,y+v).normalize();else{if(t!==zn)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,v).normalize()}return this}intersectsObject(e){
if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),hs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),
hs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(hs)}intersectsSprite(e){return hs.center.set(0,0,0),hs.radius=.7071067811865476,hs.applyMatrix4(e.matrixWorld),this.intersectsSphere(hs)}intersectsSphere(e){
const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(ds.x=r.normal.x>0?e.max.x:e.min.x,
ds.y=r.normal.y>0?e.max.y:e.min.y,ds.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(ds)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){
return(new this.constructor).copy(this)}}function fs(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){
e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ms(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){
t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,
bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=r.get(t);if(void 0===a)r.set(t,function(t,r){const i=t.array,a=t.usage,s=i.byteLength,o=e.createBuffer();let l;if(e.bindBuffer(r,o),
e.bufferData(r,i,a),t.onUploadCallback(),i instanceof Float32Array)l=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")
;l=e.HALF_FLOAT
}else l=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=e.SHORT;else if(i instanceof Uint32Array)l=e.UNSIGNED_INT;else if(i instanceof Int32Array)l=e.INT;else if(i instanceof Int8Array)l=e.BYTE;else if(i instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{
if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);l=e.UNSIGNED_BYTE}return{buffer:o,type:l,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}
}(t,i));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.")
;!function(t,r,i){const a=r.array,s=r._updateRange,o=r.updateRanges;if(e.bindBuffer(i,t),-1===s.count&&0===o.length&&e.bufferSubData(i,0,a),0!==o.length){for(let t=0,r=o.length;t<r;t++){const r=o[t]
;n?e.bufferSubData(i,r.start*a.BYTES_PER_ELEMENT,a,r.start,r.count):e.bufferSubData(i,r.start*a.BYTES_PER_ELEMENT,a.subarray(r.start,r.start+r.count))}r.clearUpdateRanges()}
-1!==s.count&&(n?e.bufferSubData(i,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(i,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),r.onUploadCallback()}(a.buffer,t,i),a.version=t.version}}}}
class gs extends Aa{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,s=Math.floor(n),o=Math.floor(r),l=s+1,c=o+1,u=e/s,h=t/o,d=[],p=[],f=[],m=[]
;for(let e=0;e<c;e++){const t=e*h-a;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),a=t+1+l*e;d.push(n,r,a),d.push(r,i,a)}
this.setIndex(d),this.setAttribute("position",new va(p,3)),this.setAttribute("normal",new va(f,3)),this.setAttribute("uv",new va(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){
return new gs(e.width,e.height,e.widthSegments,e.heightSegments)}}const _s={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",
alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",
alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",
alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",
alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",
aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",
batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",
batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",
beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",
bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",
iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",
clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",
color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",
color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",
color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",
color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",
common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",
defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",
displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",
displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",
emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",
colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",
envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",
envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",
fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",
fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",
lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",
lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",
lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",
lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",
lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",
lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",
lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",
lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",
lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",
logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",
logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",
logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",
logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",
map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",
map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",
map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",
map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",
metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",
morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",
morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",
morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",
morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",
normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",
normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",
normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",
normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",
normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",
clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",
clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",
clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",
iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",
opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",
project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",
dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",
dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",
roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",
shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",
shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",
shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",
skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",
skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",
specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",
tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tfloat startCompression = 0.8 - 0.04;\n\tfloat desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min(color.r, min(color.g, color.b));\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max(color.r, max(color.g, color.b));\n\tif (peak < startCompression) return color;\n\tfloat d = 1. - startCompression;\n\tfloat newPeak = 1. - d * d / (peak + d - startCompression);\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);\n\treturn mix(color, vec3(1, 1, 1), g);\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",
transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",
transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",
uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",
uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",
uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",
worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",
background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",
background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",
backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",
backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",
cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",
cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",
depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",
depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",
distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",
distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",
equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",
equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",
meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",
meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",
meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",
sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",
sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"
},vs={common:{diffuse:{value:new Zi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new nr},alphaMap:{value:null},alphaMapTransform:{value:new nr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{
value:new nr}},envmap:{envMap:{value:null},envMapRotation:{value:new nr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new nr}},
lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new nr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new nr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new nr},
normalScale:{value:new tr(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new nr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new nr}},
metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new nr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new nr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},
fogFar:{value:2e3},fogColor:{value:new Zi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},
shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},
spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},
distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],
properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Zi(16777215)},opacity:{value:1},size:{value:1},
scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new nr},alphaTest:{value:0},uvTransform:{value:new nr}},sprite:{diffuse:{value:new Zi(16777215)},opacity:{value:1},center:{value:new tr(.5,.5)},rotation:{value:0},map:{
value:null},mapTransform:{value:new nr},alphaMap:{value:null},alphaMapTransform:{value:new nr},alphaTest:{value:0}}},ys={basic:{uniforms:Xa([vs.common,vs.specularmap,vs.envmap,vs.aomap,vs.lightmap,vs.fog]),vertexShader:_s.meshbasic_vert,
fragmentShader:_s.meshbasic_frag},lambert:{uniforms:Xa([vs.common,vs.specularmap,vs.envmap,vs.aomap,vs.lightmap,vs.emissivemap,vs.bumpmap,vs.normalmap,vs.displacementmap,vs.fog,vs.lights,{emissive:{value:new Zi(0)}}]),
vertexShader:_s.meshlambert_vert,fragmentShader:_s.meshlambert_frag},phong:{uniforms:Xa([vs.common,vs.specularmap,vs.envmap,vs.aomap,vs.lightmap,vs.emissivemap,vs.bumpmap,vs.normalmap,vs.displacementmap,vs.fog,vs.lights,{emissive:{value:new Zi(0)},
specular:{value:new Zi(1118481)},shininess:{value:30}}]),vertexShader:_s.meshphong_vert,fragmentShader:_s.meshphong_frag},standard:{
uniforms:Xa([vs.common,vs.envmap,vs.aomap,vs.lightmap,vs.emissivemap,vs.bumpmap,vs.normalmap,vs.displacementmap,vs.roughnessmap,vs.metalnessmap,vs.fog,vs.lights,{emissive:{value:new Zi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{
value:1}}]),vertexShader:_s.meshphysical_vert,fragmentShader:_s.meshphysical_frag},toon:{uniforms:Xa([vs.common,vs.aomap,vs.lightmap,vs.emissivemap,vs.bumpmap,vs.normalmap,vs.displacementmap,vs.gradientmap,vs.fog,vs.lights,{emissive:{value:new Zi(0)}
}]),vertexShader:_s.meshtoon_vert,fragmentShader:_s.meshtoon_frag},matcap:{uniforms:Xa([vs.common,vs.bumpmap,vs.normalmap,vs.displacementmap,vs.fog,{matcap:{value:null}}]),vertexShader:_s.meshmatcap_vert,fragmentShader:_s.meshmatcap_frag},points:{
uniforms:Xa([vs.points,vs.fog]),vertexShader:_s.points_vert,fragmentShader:_s.points_frag},dashed:{uniforms:Xa([vs.common,vs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_s.linedashed_vert,
fragmentShader:_s.linedashed_frag},depth:{uniforms:Xa([vs.common,vs.displacementmap]),vertexShader:_s.depth_vert,fragmentShader:_s.depth_frag},normal:{uniforms:Xa([vs.common,vs.bumpmap,vs.normalmap,vs.displacementmap,{opacity:{value:1}}]),
vertexShader:_s.meshnormal_vert,fragmentShader:_s.meshnormal_frag},sprite:{uniforms:Xa([vs.sprite,vs.fog]),vertexShader:_s.sprite_vert,fragmentShader:_s.sprite_frag},background:{uniforms:{uvTransform:{value:new nr},t2D:{value:null},
backgroundIntensity:{value:1}},vertexShader:_s.background_vert,fragmentShader:_s.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{
value:new nr}},vertexShader:_s.backgroundCube_vert,fragmentShader:_s.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_s.cube_vert,fragmentShader:_s.cube_frag},equirect:{uniforms:{tEquirect:{
value:null}},vertexShader:_s.equirect_vert,fragmentShader:_s.equirect_frag},distanceRGBA:{uniforms:Xa([vs.common,vs.displacementmap,{referencePosition:{value:new Dr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_s.distanceRGBA_vert,
fragmentShader:_s.distanceRGBA_frag},shadow:{uniforms:Xa([vs.lights,vs.fog,{color:{value:new Zi(0)},opacity:{value:1}}]),vertexShader:_s.shadow_vert,fragmentShader:_s.shadow_frag}};ys.physical={uniforms:Xa([ys.standard.uniforms,{clearcoat:{value:0},
clearcoatMap:{value:null},clearcoatMapTransform:{value:new nr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new nr},clearcoatNormalScale:{value:new tr(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},
clearcoatRoughnessMapTransform:{value:new nr},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new nr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},
iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new nr},sheen:{value:0},sheenColor:{value:new Zi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new nr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null
},sheenRoughnessMapTransform:{value:new nr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new nr},transmissionSamplerSize:{value:new tr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{
value:null},thicknessMapTransform:{value:new nr},attenuationDistance:{value:0},attenuationColor:{value:new Zi(0)},specularColor:{value:new Zi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new nr},specularIntensity:{value:1},
specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new nr},anisotropyVector:{value:new tr},anisotropyMap:{value:null},anisotropyMapTransform:{value:new nr}}]),vertexShader:_s.meshphysical_vert,fragmentShader:_s.meshphysical_frag}
;const bs={r:0,b:0,g:0},xs=new yi,Es=new ci;function ws(e,t,n,r,i,a,s){const o=new Zi(0);let l,c,u=!0===a?0:1,h=null,d=0,p=null;function g(t,n){t.getRGB(bs,Ya(e)),r.buffers.color.setClear(bs.r,bs.g,bs.b,n,s)}return{getClearColor:function(){return o},
setClearColor:function(e,t=1){o.set(e),u=t,g(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,g(o,u)},render:function(a,_){let v=!1,y=!0===_.isScene?_.background:null;y&&y.isTexture&&(y=(_.backgroundBlurriness>0?n:t).get(y)),
null===y?g(o,u):y&&y.isColor&&(g(y,1),v=!0);const b=e.xr.getEnvironmentBlendMode();"additive"===b?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===b&&r.buffers.color.setClear(0,0,0,0,s),
(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===me)?(void 0===c&&(c=new ja(new $a(1,1,1),new Ja({name:"BackgroundCubeMaterial",uniforms:qa(ys.backgroundCube.uniforms),
vertexShader:ys.backgroundCube.vertexShader,fragmentShader:ys.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){
this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),xs.copy(_.backgroundRotation),xs.x*=-1,xs.y*=-1,xs.z*=-1,
y.isCubeTexture&&!1===y.isRenderTargetTexture&&(xs.y*=-1,xs.z*=-1),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,
c.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Es.makeRotationFromEuler(xs)),
c.material.toneMapped=mr.getTransfer(y.colorSpace)!==Qt,h===y&&d===y.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),c.layers.enableAll(),
a.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===l&&(l=new ja(new gs(2,2),new Ja({name:"BackgroundMaterial",uniforms:qa(ys.background.uniforms),vertexShader:ys.background.vertexShader,fragmentShader:ys.background.fragmentShader,
side:f,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=y,
l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,l.material.toneMapped=mr.getTransfer(y.colorSpace)!==Qt,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),
h===y&&d===y.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function Ss(e,t,n,r){
const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==a,o={},l=p(null);let c=l,u=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){
return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,
object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const a=c.newAttributes,s=c.enabledAttributes,o=c.attributeDivisors;a[n]=1,
0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),o[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),o[n]=i)}function _(){const t=c.newAttributes,n=c.enabledAttributes
;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,r,i,a,s,o){!0===o?e.vertexAttribIPointer(t,n,r,a,s):e.vertexAttribPointer(t,n,r,i,a,s)}function y(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){
l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,d,y,b){let x=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s]
;return void 0===u&&(u=p(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[s]=u),u}(y,d,l);c!==t&&(c=t,h(c.object)),x=function(e,t,n,r){const i=c.attributes,a=t.attributes;let s=0;const o=n.getAttributes()
;for(const t in o)if(o[t].location>=0){const n=i[t];let r=a[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0
;if(r&&n.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==r}(i,y,d,b),x&&function(e,t,n,r){const i={},a=t.attributes;let s=0;const o=n.getAttributes();for(const t in o)if(o[t].location>=0){let n=a[t]
;void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,s++}c.attributes=i,c.attributesNum=s,c.index=r}(i,y,d,b)
}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,x=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(x||u)&&(u=!1,function(i,a,s,o){
if(!1===r.isWebGL2&&(i.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,c=s.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const a=c[t];if(a.location>=0){let s=l[t]
;if(void 0===s&&("instanceMatrix"===t&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){const t=s.normalized,l=s.itemSize,c=n.get(s);if(void 0===c)continue
;const u=c.buffer,h=c.type,d=c.bytesPerElement,p=!0===r.isWebGL2&&(h===e.INT||h===e.UNSIGNED_INT||s.gpuType===De);if(s.isInterleavedBufferAttribute){const n=s.data,r=n.stride,c=s.offset;if(n.isInstancedInterleavedBuffer){
for(let e=0;e<a.locationSize;e++)g(a.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e)
;e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)v(a.location+e,l/a.locationSize,h,t,r*d,(c+l/a.locationSize*e)*d,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,s.meshPerAttribute)
;!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u)
;for(let e=0;e<a.locationSize;e++)v(a.location+e,l/a.locationSize,h,t,l*d,l/a.locationSize*e*d,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(a.location,n);break;case 3:e.vertexAttrib3fv(a.location,n)
;break;case 4:e.vertexAttrib4fv(a.location,n);break;default:e.vertexAttrib1fv(a.location,n)}}}}_()}(i,l,d,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in o){
const t=o[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e]
;for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)d(r[e].object),delete r[e];delete n[e.id]}},
initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function Ts(e,t,n,r){const i=r.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,s,o){
if(0===o)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",
null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,r,s,o),n.update(s,a,o)},this.renderMultiDraw=function(e,r,i){if(0===i)return
;const s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<i;t++)this.render(e[t],r[t]);else{s.multiDrawArraysWEBGL(a,e,0,r,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,a,1)}}}function As(e,t,n){let r;function i(t){if("highp"===t){
if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}
return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}
const a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let s=void 0!==n.precision?n.precision:"highp";const o=i(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o)
;const l=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=a||t.has("OES_texture_float")
;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r
},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,
floatVertexTextures:v&&y,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function Cs(e){const t=this;let n=null,r=0,i=!1,a=!1;const s=new us,o=new nr,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){
if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==a;++t,n+=4)s.copy(e[t]).applyMatrix4(i,o),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,
l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},
this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,o,u){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s)
;if(!i||null===h||0===h.length||a&&!p)a?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=a?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=c(h,o,t,u);for(let e=0;e!==t;++e)i[e]=n[e]
;f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Ms(e){let t=new WeakMap;function n(e,t){return t===pe?e.mapping=he:t===fe&&(e.mapping=de),e}function r(e){const n=e.target;n.removeEventListener("dispose",r)
;const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===pe||a===fe){if(t.has(i))return n(t.get(i).texture,i.mapping);{const a=i.image;if(a&&a.height>0){const s=new ss(a.height)
;return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class Is extends Za{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),
this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,
this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,
fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){
null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2
;let i=n-e,a=n+e,s=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,
s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e)
;return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}
const Rs=[.125,.215,.35,.446,.526,.582],ks=new Is,Ns=new Zi;let Ds=null,Ls=0,Os=0
;const Ps=(1+Math.sqrt(5))/2,Fs=1/Ps,Us=[new Dr(1,1,1),new Dr(-1,1,1),new Dr(1,1,-1),new Dr(-1,1,-1),new Dr(0,Ps,Fs),new Dr(0,Ps,-Fs),new Dr(Fs,0,Ps),new Dr(-Fs,0,Ps),new Dr(Ps,Fs,0),new Dr(-Ps,Fs,0)];class Bs{constructor(e){this._renderer=e,
this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}
fromScene(e,t=0,n=.1,r=100){Ds=this._renderer.getRenderTarget(),Ls=this._renderer.getActiveCubeFace(),Os=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),
t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){
null===this._cubemapMaterial&&(this._cubemapMaterial=Hs(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Vs(),this._compileMaterial(this._equirectMaterial))}
dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}
_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){
this._renderer.setRenderTarget(Ds,Ls,Os),e.scissorTest=!1,Gs(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===he||e.mapping===de?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),
Ds=this._renderer.getRenderTarget(),Ls=this._renderer.getActiveCubeFace(),Os=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){
const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Se,minFilter:Se,generateMipmaps:!1,type:Pe,format:Ge,colorSpace:Yt,depthBuffer:!1},r=zs(e,t,n)
;if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=zs(e,t,n);const{_lodMax:r}=this
;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+Rs.length;for(let s=0;s<a;s++){const a=Math.pow(2,i);n.push(a);let o=1/a;s>e-4?o=Rs[s-e+4-1]:0===s&&(o=0),r.push(o)
;const l=1/(a-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let e=0;e<d;e++){
const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(r,f*p*e),v.set(h,m*p*e);const i=[e,e,e,e,e,e];y.set(i,g*p*e)}const b=new Aa;b.setAttribute("position",new ca(_,f)),b.setAttribute("uv",new ca(v,m)),
b.setAttribute("faceIndex",new ca(y,g)),t.push(b),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new Dr(0,1,0);return new Ja({name:"SphericalGaussianBlur",defines:{n:20,
CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},
vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",
fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",
blending:_,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new ja(this._lodPlanes[0],e);this._renderer.compile(t,ks)}_sceneToCubeUV(e,t,n,r){
const i=new ns(90,1,t,n),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Ns),o.toneMapping=ee,o.autoClear=!1;const u=new na({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1
}),h=new ja(new $a,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(Ns),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,a[t],0),i.lookAt(s[t],0,0)):1===n?(i.up.set(0,0,a[t]),
i.lookAt(0,s[t],0)):(i.up.set(0,a[t],0),i.lookAt(0,0,s[t]));const l=this._cubeSize;Gs(r,n*l,t>2?l:0,l,l),o.setRenderTarget(r),d&&o.render(h,i),o.render(e,i)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}
_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===he||e.mapping===de;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Hs()),
this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Vs());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new ja(this._lodPlanes[0],i)
;i.uniforms.envMap.value=e;const s=this._cubeSize;Gs(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,ks)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){
const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=Us[(t-1)%Us.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),
this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!")
;const c=new ja(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20
;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}
for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);const{_lodMax:_}=this;u.dTheta.value=d,u.mipInt.value=_-n;const v=this._sizeLods[r]
;Gs(t,3*v*(r>_-4?r-_+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(t),o.render(c,ks)}}function zs(e,t,n){const r=new Cr(e,t,n);return r.texture.mapping=me,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Gs(e,t,n,r,i){
e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Vs(){return new Ja({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},
vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",
fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",
blending:_,depthTest:!1,depthWrite:!1})}function Hs(){return new Ja({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},
vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",
fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",
blending:_,depthTest:!1,depthWrite:!1})}function js(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){
const a=i.mapping,s=a===pe||a===fe,o=a===he||a===de;if(s||o){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new Bs(e)),r=s?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),
r.texture}if(t.has(i))return t.get(i).texture;{const a=i.image;if(s&&a&&a.height>0||o&&a&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(a)){null===n&&(n=new Bs(e));const a=s?n.fromEquirectangular(i):n.fromCubemap(i)
;return t.set(i,a),i.addEventListener("dispose",r),a.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ws(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){
case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":
r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":
r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":
r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){
e.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),
n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e)
;return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function $s(e,t,n,r){const i={},a=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index)
;for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}o.removeEventListener("dispose",s),delete i[o.id];const l=a.get(o);l&&(t.remove(l),
a.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version
;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}
const o=new(ir(n)?ga:fa)(n,1);o.version=s;const l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes
;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index
;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function qs(e,t,n,r){const i=r.isWebGL2;let a,s,o;this.setMode=function(e){a=e},this.setIndex=function(e){s=e.type,o=e.bytesPerElement},this.render=function(t,r){
e.drawElements(a,r,s,t*o),n.update(r,a,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",
null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](a,l,s,r*o,c),n.update(l,a,c)},this.renderMultiDraw=function(e,r,i){
if(0===i)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<i;t++)this.render(e[t]/o,r[t]);else{l.multiDrawElementsWEBGL(a,r,0,s,e,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,a,1)}}}function Xs(e){const t={frame:0,calls:0,
triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3)
;break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Ys(e,t){
return e[0]-t[0]}function Ks(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Js(e,t,n){const r={},i=new Float32Array(8),a=new WeakMap,s=new Tr,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,u){const h=l.morphTargetInfluences
;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=a.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose()
;const m=void 0!==c.morphAttributes.position,g=void 0!==c.morphAttributes.normal,_=void 0!==c.morphAttributes.color,v=c.morphAttributes.position||[],y=c.morphAttributes.normal||[],b=c.morphAttributes.color||[];let x=0;!0===m&&(x=1),!0===g&&(x=2),
!0===_&&(x=3);let E=c.attributes.position.count*x,w=1;E>t.maxTextureSize&&(w=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const S=new Float32Array(E*w*4*p),T=new Mr(S,E,w,p);T.type=Oe,T.needsUpdate=!0;const A=4*x;for(let M=0;M<p;M++){
const I=v[M],R=y[M],k=b[M],N=E*w*4*M;for(let D=0;D<I.count;D++){const L=D*A;!0===m&&(s.fromBufferAttribute(I,D),S[N+L+0]=s.x,S[N+L+1]=s.y,S[N+L+2]=s.z,S[N+L+3]=0),!0===g&&(s.fromBufferAttribute(R,D),S[N+L+4]=s.x,S[N+L+5]=s.y,S[N+L+6]=s.z,S[N+L+7]=0),
!0===_&&(s.fromBufferAttribute(k,D),S[N+L+8]=s.x,S[N+L+9]=s.y,S[N+L+10]=s.z,S[N+L+11]=4===k.itemSize?s.w:1)}}function C(){T.dispose(),a.delete(c),c.removeEventListener("dispose",C)}f={count:p,texture:T,size:new tr(E,w)},a.set(c,f),
c.addEventListener("dispose",C)}if(!0===l.isInstancedMesh&&null!==l.morphTexture)u.getUniforms().setValue(e,"morphTexture",l.morphTexture,n);else{let O=0;for(let F=0;F<h.length;F++)O+=h[F];const P=c.morphTargetsRelative?1:1-O
;u.getUniforms().setValue(e,"morphTargetBaseInfluence",P),u.getUniforms().setValue(e,"morphTargetInfluences",h)}u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{
const U=void 0===h?0:h.length;let B=r[c.id];if(void 0===B||B.length!==U){B=[];for(let j=0;j<U;j++)B[j]=[j,0];r[c.id]=B}for(let W=0;W<U;W++){const $=B[W];$[0]=W,$[1]=h[W]}B.sort(Ks);for(let q=0;q<8;q++)q<U&&B[q][1]?(o[q][0]=B[q][0],
o[q][1]=B[q][1]):(o[q][0]=Number.MAX_SAFE_INTEGER,o[q][1]=0);o.sort(Ys);const z=c.morphAttributes.position,G=c.morphAttributes.normal;let V=0;for(let X=0;X<8;X++){const Y=o[X],K=Y[0],J=Y[1]
;K!==Number.MAX_SAFE_INTEGER&&J?(z&&c.getAttribute("morphTarget"+X)!==z[K]&&c.setAttribute("morphTarget"+X,z[K]),G&&c.getAttribute("morphNormal"+X)!==G[K]&&c.setAttribute("morphNormal"+X,G[K]),i[X]=J,
V+=J):(z&&!0===c.hasAttribute("morphTarget"+X)&&c.deleteAttribute("morphTarget"+X),G&&!0===c.hasAttribute("morphNormal"+X)&&c.deleteAttribute("morphNormal"+X),i[X]=0)}const H=c.morphTargetsRelative?1:1-V
;u.getUniforms().setValue(e,"morphTargetBaseInfluence",H),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Zs(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),
null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const o=r.render.frame,l=s.geometry,c=t.get(s,l);if(i.get(c)!==o&&(t.update(c),i.set(c,o)),
s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),i.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,o))),s.isSkinnedMesh){
const e=s.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return c},dispose:function(){i=new WeakMap}}}class Qs extends Sr{constructor(e,t,n,r,i,a,s,o,l,c){
if((c=void 0!==c?c:je)!==je&&c!==We)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===je&&(n=Le),void 0===n&&c===We&&(n=Be),super(null,r,i,a,s,o,c,n,l),this.isDepthTexture=!0,
this.image={width:e,height:t},this.magFilter=void 0!==s?s:ye,this.minFilter=void 0!==o?o:ye,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){
const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const eo=new Sr,to=new Qs(1,1);to.compareFunction=En
;const no=new Mr,ro=new Rr,io=new as,ao=[],so=[],oo=new Float32Array(16),lo=new Float32Array(9),co=new Float32Array(4);function uo(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=ao[i];if(void 0===a&&(a=new Float32Array(i),ao[i]=a),
0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function ho(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function po(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]
}function fo(e,t){let n=so[t];void 0===n&&(n=new Int32Array(t),so[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function mo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function go(e,t){const n=this.cache
;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ho(n,t))return;e.uniform2fv(this.addr,t),po(n,t)}}function _o(e,t){const n=this.cache
;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{
if(ho(n,t))return;e.uniform3fv(this.addr,t),po(n,t)}}function vo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{
if(ho(n,t))return;e.uniform4fv(this.addr,t),po(n,t)}}function yo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ho(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),po(n,t)}else{if(ho(n,r))return;co.set(r),e.uniformMatrix2fv(this.addr,!1,co),
po(n,r)}}function bo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ho(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),po(n,t)}else{if(ho(n,r))return;lo.set(r),e.uniformMatrix3fv(this.addr,!1,lo),po(n,r)}}function xo(e,t){
const n=this.cache,r=t.elements;if(void 0===r){if(ho(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),po(n,t)}else{if(ho(n,r))return;oo.set(r),e.uniformMatrix4fv(this.addr,!1,oo),po(n,r)}}function Eo(e,t){const n=this.cache
;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function wo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ho(n,t))return;e.uniform2iv(this.addr,t),po(n,t)}}function So(e,t){
const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ho(n,t))return;e.uniform3iv(this.addr,t),po(n,t)}}function To(e,t){const n=this.cache
;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ho(n,t))return;e.uniform4iv(this.addr,t),po(n,t)}}function Ao(e,t){const n=this.cache
;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Co(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ho(n,t))return;e.uniform2uiv(this.addr,t),po(n,t)}}function Mo(e,t){
const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ho(n,t))return;e.uniform3uiv(this.addr,t),po(n,t)}}function Io(e,t){const n=this.cache
;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ho(n,t))return;e.uniform4uiv(this.addr,t),po(n,t)}}function Ro(e,t,n){
const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i);const a=this.type===e.SAMPLER_2D_SHADOW?to:eo;n.setTexture2D(t||a,i)}function ko(e,t,n){const r=this.cache,i=n.allocateTextureUnit()
;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ro,i)}function No(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||io,i)}function Do(e,t,n){
const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||no,i)}function Lo(e,t){e.uniform1fv(this.addr,t)}function Oo(e,t){const n=uo(t,this.size,2);e.uniform2fv(this.addr,n)}function Po(e,t){
const n=uo(t,this.size,3);e.uniform3fv(this.addr,n)}function Fo(e,t){const n=uo(t,this.size,4);e.uniform4fv(this.addr,n)}function Uo(e,t){const n=uo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Bo(e,t){const n=uo(t,this.size,9)
;e.uniformMatrix3fv(this.addr,!1,n)}function zo(e,t){const n=uo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Go(e,t){e.uniform1iv(this.addr,t)}function Vo(e,t){e.uniform2iv(this.addr,t)}function Ho(e,t){e.uniform3iv(this.addr,t)}
function jo(e,t){e.uniform4iv(this.addr,t)}function Wo(e,t){e.uniform1uiv(this.addr,t)}function $o(e,t){e.uniform2uiv(this.addr,t)}function qo(e,t){e.uniform3uiv(this.addr,t)}function Xo(e,t){e.uniform4uiv(this.addr,t)}function Yo(e,t,n){
const r=this.cache,i=t.length,a=fo(n,i);ho(r,a)||(e.uniform1iv(this.addr,a),po(r,a));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||eo,a[e])}function Ko(e,t,n){const r=this.cache,i=t.length,a=fo(n,i);ho(r,a)||(e.uniform1iv(this.addr,a),po(r,a))
;for(let e=0;e!==i;++e)n.setTexture3D(t[e]||ro,a[e])}function Jo(e,t,n){const r=this.cache,i=t.length,a=fo(n,i);ho(r,a)||(e.uniform1iv(this.addr,a),po(r,a));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||io,a[e])}function Zo(e,t,n){
const r=this.cache,i=t.length,a=fo(n,i);ho(r,a)||(e.uniform1iv(this.addr,a),po(r,a));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||no,a[e])}class Qo{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){
switch(e){case 5126:return mo;case 35664:return go;case 35665:return _o;case 35666:return vo;case 35674:return yo;case 35675:return bo;case 35676:return xo;case 5124:case 35670:return Eo;case 35667:case 35671:return wo;case 35668:case 35672:return So
;case 35669:case 35673:return To;case 5125:return Ao;case 36294:return Co;case 36295:return Mo;case 36296:return Io;case 35678:case 36198:case 36298:case 36306:case 35682:return Ro;case 35679:case 36299:case 36307:return ko;case 35680:case 36300:
case 36308:case 36293:return No;case 36289:case 36303:case 36311:case 36292:return Do}}(t.type)}}class el{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Lo
;case 35664:return Oo;case 35665:return Po;case 35666:return Fo;case 35674:return Uo;case 35675:return Bo;case 35676:return zo;case 5124:case 35670:return Go;case 35667:case 35671:return Vo;case 35668:case 35672:return Ho;case 35669:case 35673:
return jo;case 5125:return Wo;case 36294:return $o;case 36295:return qo;case 36296:return Xo;case 35678:case 36198:case 36298:case 36306:case 35682:return Yo;case 35679:case 36299:case 36307:return Ko;case 35680:case 36300:case 36308:case 36293:
return Jo;case 36289:case 36303:case 36311:case 36292:return Zo}}(t.type)}}class tl{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}
const nl=/(\w+)(\])?(\[|\.)?/g;function rl(e,t){e.seq.push(t),e.map[t.id]=t}function il(e,t,n){const r=e.name,i=r.length;for(nl.lastIndex=0;;){const a=nl.exec(r),s=nl.lastIndex;let o=a[1];const l="]"===a[2],c=a[3];if(l&&(o|=0),
void 0===c||"["===c&&s+2===i){rl(n,void 0===c?new Qo(o,e,t):new el(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new tl(o),rl(n,e)),n=e}}}class al{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS)
;for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);il(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}
static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}
function sl(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let ol=0;function ll(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return""
;const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let e=i;e<a;e++){const i=e+1
;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function cl(e,t){const n=function(e){const t=mr.getPrimaries(mr.workingColorSpace),n=mr.getPrimaries(e);let r
;switch(t===n?r="":t===tn&&n===en?r="LinearDisplayP3ToLinearSRGB":t===en&&n===tn&&(r="LinearSRGBToLinearDisplayP3"),e){case Yt:case Jt:return[r,"LinearTransferOETF"];case Xt:case Kt:return[r,"sRGBTransferOETF"];default:
return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function ul(e,t){let n;switch(t){case te:n="Linear";break;case ne:n="Reinhard"
;break;case re:n="OptimizedCineon";break;case ie:n="ACESFilmic";break;case se:n="AgX";break;case oe:n="Neutral";break;case ae:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}
return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function hl(e){return""!==e}function dl(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps
;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)
}function pl(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const fl=/^[ \t]*#include +<([\w\d./]+)>/gm;function ml(e){return e.replace(fl,_l)}
const gl=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function _l(e,t){let n=_s[t];if(void 0===n){const e=gl.get(t)
;if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=_s[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return ml(n)}
const vl=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yl(e){return e.replace(vl,bl)}function bl(e,t,n,r){let i=""
;for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function xl(e){
let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\t`
;return e.isWebGL2&&(t+=`precision ${e.precision} sampler3D;\n\t\tprecision ${e.precision} sampler2DArray;\n\t\tprecision ${e.precision} sampler2DShadow;\n\t\tprecision ${e.precision} samplerCubeShadow;\n\t\tprecision ${e.precision} sampler2DArrayShadow;\n\t\tprecision ${e.precision} isampler2D;\n\t\tprecision ${e.precision} isampler3D;\n\t\tprecision ${e.precision} isamplerCube;\n\t\tprecision ${e.precision} isampler2DArray;\n\t\tprecision ${e.precision} usampler2D;\n\t\tprecision ${e.precision} usampler3D;\n\t\tprecision ${e.precision} usamplerCube;\n\t\tprecision ${e.precision} usampler2DArray;\n\t\t`),
"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function El(e,t,n,r){const i=e.getContext(),a=n.defines
;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t
}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case he:case de:t="ENVMAP_TYPE_CUBE";break;case me:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION"
;return e.envMap&&e.envMapMode===de&&(t="ENVMAP_MODE_REFRACTION"),t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case J:t="ENVMAP_BLENDING_MULTIPLY";break;case Z:t="ENVMAP_BLENDING_MIX";break;case Q:
t="ENVMAP_BLENDING_ADD"}return t}(n),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),g=n.isWebGL2?"":function(e){
return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.alphaToCoverage||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(hl).join("\n")
}(n),_=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hl).join("\n")}(n),v=function(e){const t=[];for(const n in e){
const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),y=i.createProgram();let b,x,E=n.glslVersion?"#version "+n.glslVersion+"\n":""
;n.isRawShaderMaterial?(b=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(hl).join("\n"),b.length>0&&(b+="\n"),x=[g,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(hl).join("\n"),
x.length>0&&(x+="\n")):(b=[xl(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(hl).join("\n"),
x=[g,xl(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ee?"#define TONE_MAPPING":"",n.toneMapping!==ee?_s.tonemapping_pars_fragment:"",n.toneMapping!==ee?ul("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",_s.colorspace_pars_fragment,cl("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(hl).join("\n")),
s=ml(s),s=dl(s,n),s=pl(s,n),o=ml(o),o=dl(o,n),o=pl(o,n),s=yl(s),o=yl(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(E="#version 300 es\n",
b=[_,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,
x=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===Fn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Fn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x)
;const w=E+b+s,S=E+x+o,T=sl(i,i.VERTEX_SHADER,w),A=sl(i,i.FRAGMENT_SHADER,S);function C(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(y).trim(),r=i.getShaderInfoLog(T).trim(),a=i.getShaderInfoLog(A).trim();let s=!0,o=!0
;if(!1===i.getProgramParameter(y,i.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,y,T,A);else{const e=ll(i,T,"vertex"),r=ll(i,A,"fragment")
;console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)
}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==a||(o=!1);o&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:r,prefix:b},fragmentShader:{log:a,prefix:x}})}i.deleteShader(T),i.deleteShader(A),M=new al(i,y),
I=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[a]={type:r.type,
location:e.getAttribLocation(t,a),locationSize:s}}return n}(i,y)}let M,I;i.attachShader(y,T),i.attachShader(y,A),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,"position"),
i.linkProgram(y),this.getUniforms=function(){return void 0===M&&C(this),M},this.getAttributes=function(){return void 0===I&&C(this),I};let R=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){
return!1===R&&(R=i.getProgramParameter(y,37297)),R},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ol++,this.cacheKey=t,this.usedTimes=1,
this.program=y,this.vertexShader=T,this.fragmentShader=A,this}let wl=0;class Sl{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){
const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){
const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){
return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){
const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Tl(e),t.set(e,n)),n}}class Tl{constructor(e){this.id=wl++,this.code=e,this.usedTimes=0}}function Al(e,t,n,r,i,a,s){
const o=new bi,l=new Sl,c=new Set,u=[],h=i.isWebGL2,d=i.logarithmicDepthBuffer,p=i.vertexTextures;let f=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",
MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",
ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,o,u,b,x){
const E=b.fog,w=x.geometry,S=a.isMeshStandardMaterial?b.environment:null,T=(a.isMeshStandardMaterial?n:t).get(a.envMap||S),A=T&&T.mapping===me?T.image.height:null,C=_[a.type];null!==a.precision&&(f=i.getMaxPrecision(a.precision),
f!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));const M=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,I=void 0!==M?M.length:0;let R,k,N,D,L=0
;if(void 0!==w.morphAttributes.position&&(L=1),void 0!==w.morphAttributes.normal&&(L=2),void 0!==w.morphAttributes.color&&(L=3),C){const e=ys[C];R=e.vertexShader,k=e.fragmentShader}else R=a.vertexShader,k=a.fragmentShader,l.update(a),
N=l.getVertexShaderID(a),D=l.getFragmentShaderID(a)
;const O=e.getRenderTarget(),P=!0===x.isInstancedMesh,F=!0===x.isBatchedMesh,U=!!a.map,B=!!a.matcap,z=!!T,G=!!a.aoMap,V=!!a.lightMap,H=!!a.bumpMap,j=!!a.normalMap,W=!!a.displacementMap,$=!!a.emissiveMap,q=!!a.metalnessMap,X=!!a.roughnessMap,Y=a.anisotropy>0,K=a.clearcoat>0,J=a.iridescence>0,Z=a.sheen>0,Q=a.transmission>0,te=Y&&!!a.anisotropyMap,ne=K&&!!a.clearcoatMap,re=K&&!!a.clearcoatNormalMap,ie=K&&!!a.clearcoatRoughnessMap,ae=J&&!!a.iridescenceMap,se=J&&!!a.iridescenceThicknessMap,oe=Z&&!!a.sheenColorMap,le=Z&&!!a.sheenRoughnessMap,ce=!!a.specularMap,ue=!!a.specularColorMap,he=!!a.specularIntensityMap,de=Q&&!!a.transmissionMap,pe=Q&&!!a.thicknessMap,fe=!!a.gradientMap,ge=!!a.alphaMap,_e=a.alphaTest>0,ve=!!a.alphaHash,ye=!!a.extensions
;let be=ee;a.toneMapped&&(null!==O&&!0!==O.isXRRenderTarget||(be=e.toneMapping));const xe={isWebGL2:h,shaderID:C,shaderType:a.type,shaderName:a.name,vertexShader:R,fragmentShader:k,defines:a.defines,customVertexShaderID:N,customFragmentShaderID:D,
isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:F,instancing:P,instancingColor:P&&null!==x.instanceColor,instancingMorph:P&&null!==x.morphTexture,supportsVertexTextures:p,
outputColorSpace:null===O?e.outputColorSpace:!0===O.isXRRenderTarget?O.texture.colorSpace:Yt,alphaToCoverage:!!a.alphaToCoverage,map:U,matcap:B,envMap:z,envMapMode:z&&T.mapping,envMapCubeUVHeight:A,aoMap:G,lightMap:V,bumpMap:H,normalMap:j,
displacementMap:p&&W,emissiveMap:$,normalMapObjectSpace:j&&a.normalMapType===$t,normalMapTangentSpace:j&&a.normalMapType===Wt,metalnessMap:q,roughnessMap:X,anisotropy:Y,anisotropyMap:te,clearcoat:K,clearcoatMap:ne,clearcoatNormalMap:re,
clearcoatRoughnessMap:ie,iridescence:J,iridescenceMap:ae,iridescenceThicknessMap:se,sheen:Z,sheenColorMap:oe,sheenRoughnessMap:le,specularMap:ce,specularColorMap:ue,specularIntensityMap:he,transmission:Q,transmissionMap:de,thicknessMap:pe,
gradientMap:fe,opaque:!1===a.transparent&&a.blending===v&&!1===a.alphaToCoverage,alphaMap:ge,alphaTest:_e,alphaHash:ve,combine:a.combine,mapUv:U&&y(a.map.channel),aoMapUv:G&&y(a.aoMap.channel),lightMapUv:V&&y(a.lightMap.channel),
bumpMapUv:H&&y(a.bumpMap.channel),normalMapUv:j&&y(a.normalMap.channel),displacementMapUv:W&&y(a.displacementMap.channel),emissiveMapUv:$&&y(a.emissiveMap.channel),metalnessMapUv:q&&y(a.metalnessMap.channel),
roughnessMapUv:X&&y(a.roughnessMap.channel),anisotropyMapUv:te&&y(a.anisotropyMap.channel),clearcoatMapUv:ne&&y(a.clearcoatMap.channel),clearcoatNormalMapUv:re&&y(a.clearcoatNormalMap.channel),
clearcoatRoughnessMapUv:ie&&y(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ae&&y(a.iridescenceMap.channel),iridescenceThicknessMapUv:se&&y(a.iridescenceThicknessMap.channel),sheenColorMapUv:oe&&y(a.sheenColorMap.channel),
sheenRoughnessMapUv:le&&y(a.sheenRoughnessMap.channel),specularMapUv:ce&&y(a.specularMap.channel),specularColorMapUv:ue&&y(a.specularColorMap.channel),specularIntensityMapUv:he&&y(a.specularIntensityMap.channel),
transmissionMapUv:de&&y(a.transmissionMap.channel),thicknessMapUv:pe&&y(a.thicknessMap.channel),alphaMapUv:ge&&y(a.alphaMap.channel),vertexTangents:!!w.attributes.tangent&&(j||Y),vertexColors:a.vertexColors,
vertexAlphas:!0===a.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,pointsUvs:!0===x.isPoints&&!!w.attributes.uv&&(U||ge),fog:!!E,useFog:!0===a.fog,fogExp2:!!E&&E.isFogExp2,flatShading:!0===a.flatShading,
sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,
morphTargetsCount:I,morphTextureStride:L,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,
numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,
numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:be,useLegacyLights:e._useLegacyLights,
decodeVideoTexture:U&&!0===a.map.isVideoTexture&&mr.getTransfer(a.map.colorSpace)===Qt,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===g,flipSided:a.side===m,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,
index0AttributeName:a.index0AttributeName,extensionDerivatives:ye&&!0===a.extensions.derivatives,extensionFragDepth:ye&&!0===a.extensions.fragDepth,extensionDrawBuffers:ye&&!0===a.extensions.drawBuffers,
extensionShaderTextureLOD:ye&&!0===a.extensions.shaderTextureLOD,extensionClipCullDistance:ye&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ye&&!0===a.extensions.multiDraw&&r.has("WEBGL_multi_draw"),
rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),
rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return xe.vertexUv1s=c.has(1),xe.vertexUv2s=c.has(2),xe.vertexUv3s=c.has(3),c.clear(),xe},getProgramCacheKey:function(t){
const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){
e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),
e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),
e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),
e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),
e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),
e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),
t.instancingMorph&&o.enable(4),t.matcap&&o.enable(5),t.envMap&&o.enable(6),t.normalMapObjectSpace&&o.enable(7),t.normalMapTangentSpace&&o.enable(8),t.clearcoat&&o.enable(9),t.iridescence&&o.enable(10),t.alphaTest&&o.enable(11),
t.vertexColors&&o.enable(12),t.vertexAlphas&&o.enable(13),t.vertexUv1s&&o.enable(14),t.vertexUv2s&&o.enable(15),t.vertexUv3s&&o.enable(16),t.vertexTangents&&o.enable(17),t.anisotropy&&o.enable(18),t.alphaHash&&o.enable(19),t.batching&&o.enable(20),
e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),
t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.useLegacyLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.transmission&&o.enable(15),
t.sheen&&o.enable(16),t.opaque&&o.enable(17),t.pointsUvs&&o.enable(18),t.decodeVideoTexture&&o.enable(19),t.alphaToCoverage&&o.enable(20),e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},
getUniforms:function(e){const t=_[e.type];let n;if(t){const e=ys[t];n=Ka.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}
return void 0===r&&(r=new El(e,n,t,a),u.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}
function Cl(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ml(e,t){
return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Il(e,t){
return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Rl(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,s,o){let l=e[t]
;return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{
opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?r.push(u):!0===s.transparent?i.push(u):n.push(u)},unshift:function(e,t,s,o,l,c){
const u=a(e,t,s,o,l,c);s.transmission>0?r.unshift(u):!0===s.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,
t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ml),r.length>1&&r.sort(t||Il),i.length>1&&i.sort(t||Il)}}}function kl(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new Rl,
e.set(t,[i])):n>=r.length?(i=new Rl,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function Nl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Dr,
color:new Zi};break;case"SpotLight":n={position:new Dr,direction:new Dr,color:new Zi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Dr,color:new Zi,distance:0,decay:0};break;case"HemisphereLight":n={
direction:new Dr,skyColor:new Zi,groundColor:new Zi};break;case"RectAreaLight":n={color:new Zi,position:new Dr,halfWidth:new Dr,halfHeight:new Dr}}return e[t.id]=n,n}}}let Dl=0;function Ll(e,t){
return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ol(e,t){const n=new Nl,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={
shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tr};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tr,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{
directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],
directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],
numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new Dr);const a=new Dr,s=new ci,o=new ci;return{setup:function(a,s){let o=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0)
;let u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0,b=0;a.sort(Ll);const x=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],s=t.color,E=t.intensity,w=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*E*x,
l+=s.g*E*x,c+=s.b*E*x;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],E);b++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){
const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=S,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}
i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(E*x),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),
e.decay=t.decay,i.spot[d]=e;const a=t.shadow;if(t.map&&(i.spotLightMap[v]=t.map,v++,a.updateMatrices(t),t.castShadow&&y++),i.spotLightMatrix[d]=a.matrix,t.castShadow){const e=r.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,
e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,i.spotShadow[d]=e,i.spotShadowMap[d]=S,_++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(E),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),
i.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,
n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=S,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){
const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(E*x),e.groundColor.copy(t.groundColor).multiplyScalar(E*x),i.hemi[f]=e,f++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=vs.LTC_FLOAT_1,
i.rectAreaLTC2=vs.LTC_FLOAT_2):(i.rectAreaLTC1=vs.LTC_HALF_1,i.rectAreaLTC2=vs.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=vs.LTC_FLOAT_1,
i.rectAreaLTC2=vs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=vs.LTC_HALF_1,i.rectAreaLTC2=vs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,
i.ambient[1]=l,i.ambient[2]=c;const E=i.hash
;E.directionalLength===u&&E.pointLength===h&&E.spotLength===d&&E.rectAreaLength===p&&E.hemiLength===f&&E.numDirectionalShadows===m&&E.numPointShadows===g&&E.numSpotShadows===_&&E.numSpotMaps===v&&E.numLightProbes===b||(i.directional.length=u,
i.spot.length=d,i.rectArea.length=p,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,
i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=_+v-y,i.spotLightMap.length=v,i.numSpotLightShadowsWithMaps=y,i.numLightProbes=b,E.directionalLength=u,E.pointLength=h,E.spotLength=d,E.rectAreaLength=p,
E.hemiLength=f,E.numDirectionalShadows=m,E.numPointShadows=g,E.numSpotShadows=_,E.numSpotMaps=v,E.numLightProbes=b,i.version=Dl++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){
const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(d.isSpotLight){
const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++
}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o.identity(),s.copy(d.matrixWorld),s.premultiply(h),o.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),
e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){
const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function Pl(e,t){const n=new Ol(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,
lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Fl(e,t){let n=new WeakMap;return{get:function(r,i=0){const a=n.get(r);let s
;return void 0===a?(s=new Pl(e,t),n.set(r,[s])):i>=a.length?(s=new Pl(e,t),a.push(s)):s=a[i],s},dispose:function(){n=new WeakMap}}}class Ul extends ta{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",
this.depthPacking=Ht,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),
this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,
this.wireframeLinewidth=e.wireframeLinewidth,this}}class Bl extends ta{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,
this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}
function zl(e,t,n){let r=new ps;const i=new tr,a=new tr,s=new Tr,o=new Ul({depthPacking:jt}),l=new Bl,c={},u=n.maxTextureSize,d={[f]:m,[m]:f,[g]:g},v=new Ja({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new tr},
radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"
}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const b=new Aa;b.setAttribute("position",new ca(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new ja(b,v),E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h;let w=this.type
;function S(n,r){const a=t.update(x);v.defines.VSM_SAMPLES!==n.blurSamples&&(v.defines.VSM_SAMPLES=n.blurSamples,y.defines.VSM_SAMPLES=n.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Cr(i.x,i.y)),
v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,v,x,null),y.uniforms.shadow_pass.value=n.mapPass.texture,
y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,y,x,null)}function T(t,n,r,i){let a=null
;const s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===r.isPointLight?l:o,
e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=a.uuid,t=n.uuid;let r=c[e]
;void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",C)),a=i}return a.visible=n.visible,a.wireframe=n.wireframe,
a.side=i===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,
a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,
!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=r),a}function A(n,i,a,s,o){if(!1===n.visible)return
;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===p)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material
;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=T(n,h,s,o);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}
}else if(l.visible){const t=T(n,l,s,o);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)A(l[e],i,a,s,o)}function C(e){
e.target.removeEventListener("dispose",C);for(const t in c){const n=c[t],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(t,n,o){if(!1===E.enabled)return;if(!1===E.autoUpdate&&!1===E.needsUpdate)return;if(0===t.length)return
;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(_),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const f=w!==p&&this.type===p,m=w===p&&this.type!==p
;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const g=h.getFrameExtents()
;if(i.multiply(g),a.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/g.x),i.x=a.x*g.x,h.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/g.y),i.y=a.y*g.y,h.mapSize.y=a.y)),null===h.map||!0===f||!0===m){const e=this.type!==p?{minFilter:ye,magFilter:ye
}:{};null!==h.map&&h.map.dispose(),h.map=new Cr(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const _=h.getViewportCount();for(let e=0;e<_;e++){const t=h.getViewport(e)
;s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(s),h.updateMatrices(c,e),r=h.getFrustum(),A(n,o,h.camera,c,this.type)}!0!==h.isPointLightShadow&&this.type===p&&S(h,o),h.needsUpdate=!1}w=this.type,E.needsUpdate=!1,e.setRenderTarget(l,c,h)}}
function Gl(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new Tr;let r=null;const i=new Tr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,s,o){!0===o&&(t*=s,
r*=s,a*=s),n.set(t,r,a,s),!1===i.equals(n)&&(e.clearColor(t,r,a,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?Ce(e.DEPTH_TEST):Me(e.DEPTH_TEST)},
setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case H:e.depthFunc(e.NEVER);break;case j:e.depthFunc(e.ALWAYS);break;case W:e.depthFunc(e.LESS);break;case $:e.depthFunc(e.LEQUAL);break;case q:
e.depthFunc(e.EQUAL);break;case X:e.depthFunc(e.GEQUAL);break;case Y:e.depthFunc(e.GREATER);break;case K:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},
reset:function(){t=!1,n=null,r=null,i=null}}},c=new function(){let t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?Ce(e.STENCIL_TEST):Me(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),
n=r)},setFunc:function(t,n,s){r===t&&i===n&&a===s||(e.stencilFunc(t,n,s),r=t,i=n,a=s)},setOp:function(t,n,r){s===t&&o===n&&l===r||(e.stencilOp(t,n,r),s=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},
reset:function(){t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null}}},u=new WeakMap,h=new WeakMap
;let d={},p={},f=new WeakMap,J=[],Z=null,Q=!1,ee=null,te=null,ne=null,re=null,ie=null,ae=null,se=null,oe=new Zi(0,0,0),le=0,ce=!1,ue=null,he=null,de=null,pe=null,fe=null;const me=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ge=!1,_e=0
;const ve=e.getParameter(e.VERSION);-1!==ve.indexOf("WebGL")?(_e=parseFloat(/^WebGL (\d)/.exec(ve)[1]),ge=_e>=1):-1!==ve.indexOf("OpenGL ES")&&(_e=parseFloat(/^OpenGL ES (\d)/.exec(ve)[1]),ge=_e>=2);let ye=null,be={}
;const xe=e.getParameter(e.SCISSOR_BOX),Ee=e.getParameter(e.VIEWPORT),we=(new Tr).fromArray(xe),Se=(new Tr).fromArray(Ee);function Te(t,n,i,a){const s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),
e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST)
;for(let o=0;o<i;o++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,s);return o}const Ae={};function Ce(t){!0!==d[t]&&(e.enable(t),d[t]=!0)
}function Me(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}Ae[e.TEXTURE_2D]=Te(e.TEXTURE_2D,e.TEXTURE_2D,1),Ae[e.TEXTURE_CUBE_MAP]=Te(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(Ae[e.TEXTURE_2D_ARRAY]=Te(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),
Ae[e.TEXTURE_3D]=Te(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),a.setClear(1),c.setClear(0),Ce(e.DEPTH_TEST),a.setFunc($),Ne(!1),De(o),Ce(e.CULL_FACE),ke(_);const Ie={[w]:e.FUNC_ADD,[S]:e.FUNC_SUBTRACT,[T]:e.FUNC_REVERSE_SUBTRACT}
;if(r)Ie[A]=e.MIN,Ie[C]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(Ie[A]=e.MIN_EXT,Ie[C]=e.MAX_EXT)}const Re={[M]:e.ZERO,[I]:e.ONE,[R]:e.SRC_COLOR,[N]:e.SRC_ALPHA,[U]:e.SRC_ALPHA_SATURATE,[P]:e.DST_COLOR,[L]:e.DST_ALPHA,
[k]:e.ONE_MINUS_SRC_COLOR,[D]:e.ONE_MINUS_SRC_ALPHA,[F]:e.ONE_MINUS_DST_COLOR,[O]:e.ONE_MINUS_DST_ALPHA,[B]:e.CONSTANT_COLOR,[z]:e.ONE_MINUS_CONSTANT_COLOR,[G]:e.CONSTANT_ALPHA,[V]:e.ONE_MINUS_CONSTANT_ALPHA};function ke(t,n,r,i,a,s,o,l,c,u){
if(t!==_){if(!1===Q&&(Ce(e.BLEND),Q=!0),t===E)a=a||n,s=s||r,o=o||i,n===te&&a===ie||(e.blendEquationSeparate(Ie[n],Ie[a]),te=n,ie=a),r===ne&&i===re&&s===ae&&o===se||(e.blendFuncSeparate(Re[r],Re[i],Re[s],Re[o]),ne=r,re=i,ae=s,se=o),
!1!==l.equals(oe)&&c===le||(e.blendColor(l.r,l.g,l.b,c),oe.copy(l),le=c),ee=t,ce=!1;else if(t!==ee||u!==ce){if(te===w&&ie===w||(e.blendEquation(e.FUNC_ADD),te=w,ie=w),u)switch(t){case v:
e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case y:e.blendFunc(e.ONE,e.ONE);break;case b:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x:
e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case v:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case y:
e.blendFunc(e.SRC_ALPHA,e.ONE);break;case b:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}ne=null,re=null,ae=null,
se=null,oe.set(0,0,0),le=0,ee=t,ce=u}}else!0===Q&&(Me(e.BLEND),Q=!1)}function Ne(t){ue!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),ue=t)}function De(t){t!==s?(Ce(e.CULL_FACE),
t!==he&&(t===o?e.cullFace(e.BACK):t===l?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):Me(e.CULL_FACE),he=t}function Le(t,n,r){t?(Ce(e.POLYGON_OFFSET_FILL),pe===n&&fe===r||(e.polygonOffset(n,r),pe=n,fe=r)):Me(e.POLYGON_OFFSET_FILL)}return{
buffers:{color:i,depth:a,stencil:c},enable:Ce,disable:Me,bindFramebuffer:function(t,n){return p[t]!==n&&(e.bindFramebuffer(t,n),p[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(p[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(p[e.DRAW_FRAMEBUFFER]=n)),!0)},
drawBuffers:function(r,i){let a=J,s=!1;if(r){a=f.get(i),void 0===a&&(a=[],f.set(i,a));const t=r.textures;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)a[n]=e.COLOR_ATTACHMENT0+n;a.length=t.length,s=!0}
}else a[0]!==e.BACK&&(a[0]=e.BACK,s=!0);if(s)if(n.isWebGL2)e.drawBuffers(a);else{if(!0!==t.has("WEBGL_draw_buffers"))throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")
;t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a)}},useProgram:function(t){return Z!==t&&(e.useProgram(t),Z=t,!0)},setBlending:ke,setMaterial:function(t,n){t.side===g?Me(e.CULL_FACE):Ce(e.CULL_FACE);let r=t.side===m;n&&(r=!r),Ne(r),
t.blending===v&&!1===t.transparent?ke(_):ke(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),
a.setMask(t.depthWrite),i.setMask(t.colorWrite);const s=t.stencilWrite;c.setTest(s),s&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),
Le(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?Ce(e.SAMPLE_ALPHA_TO_COVERAGE):Me(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ne,setCullFace:De,setLineWidth:function(t){t!==de&&(ge&&e.lineWidth(t),de=t)},
setPolygonOffset:Le,setScissorTest:function(t){t?Ce(e.SCISSOR_TEST):Me(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+me-1),ye!==t&&(e.activeTexture(t),ye=t)},bindTexture:function(t,n,r){
void 0===r&&(r=null===ye?e.TEXTURE0+me-1:ye);let i=be[r];void 0===i&&(i={type:void 0,texture:void 0},be[r]=i),i.type===t&&i.texture===n||(ye!==r&&(e.activeTexture(r),ye=r),e.bindTexture(t,n||Ae[t]),i.type=t,i.texture=n)},unbindTexture:function(){
const t=be[ye];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},
compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},
texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=h.get(n);void 0===r&&(r=new WeakMap,h.set(n,r));let i=r.get(t)
;void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=h.get(n).get(t);u.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),u.set(n,r))},texStorage2D:function(){try{
e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{
e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{
e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){
!1===we.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),we.copy(t))},viewport:function(t){!1===Se.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),Se.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),
e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),
e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),
e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),
e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},ye=null,be={},p={},f=new WeakMap,J=[],Z=null,Q=!1,ee=null,te=null,ne=null,re=null,ie=null,ae=null,se=null,oe=new Zi(0,0,0),le=0,ce=!1,ue=null,he=null,
de=null,pe=null,fe=null,we.set(0,0,e.canvas.width,e.canvas.height),Se.set(0,0,e.canvas.width,e.canvas.height),i.reset(),a.reset(),c.reset()}}}function Vl(e,t,n,r,i,a,s){
const o=i.isWebGL2,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new tr,h=new WeakMap;let d;const p=new WeakMap
;let f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):or("canvas")}function g(e,t,n,r){let i=1;const a=z(e)
;if((a.width>r||a.height>r)&&(i=r/Math.max(a.width,a.height)),i<1||!0===t){
if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){
const r=t?Jn:Math.floor,s=r(i*a.width),o=r(i*a.height);void 0===d&&(d=m(s,o));const l=n?m(s,o):d;return l.width=s,l.height=o,l.getContext("2d").drawImage(e,0,0,s,o),
console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+s+"x"+o+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e}return e}
function _(e){const t=z(e);return Kn(t.width)&&Kn(t.height)}function v(e,t){return e.generateMipmaps&&t&&e.minFilter!==ye&&e.minFilter!==Se}function y(t){e.generateMipmap(t)}function b(n,r,i,a,s=!1){if(!1===o)return r;if(null!==n){
if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),
r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),
i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.RG8UI),i===e.UNSIGNED_SHORT&&(l=e.RG16UI),i===e.UNSIGNED_INT&&(l=e.RG32UI),i===e.BYTE&&(l=e.RG8I),i===e.SHORT&&(l=e.RG16I),
i===e.INT&&(l=e.RG32I)),r===e.RGBA){const t=s?Zt:mr.getTransfer(a);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===Qt?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),
i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function x(e,t,n){
return!0===v(e,n)||e.isFramebufferTexture&&e.minFilter!==ye&&e.minFilter!==Se?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}
function E(t){return t===ye||t===be||t===Ee?e.NEAREST:e.LINEAR}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=p.get(n);if(i){const r=i[t.__cacheKey]
;r.usedTimes--,0===r.usedTimes&&T(e),0===Object.keys(i).length&&p.delete(n)}r.remove(e)}(t),t.isVideoTexture&&h.delete(t)}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=r.get(t)
;if(t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){
if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t])
;n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer)
;if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),
n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}
const i=t.textures;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),s.memory.textures--),r.remove(i[t])}r.remove(t)}(n)}function T(t){const n=r.get(t);e.deleteTexture(n.__webglTexture)
;const i=t.source;delete p.get(i)[n.__cacheKey],s.memory.textures--}let A=0;function C(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(t),
!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void D(a,t,i)
;console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const M={[ge]:e.REPEAT,[_e]:e.CLAMP_TO_EDGE,[ve]:e.MIRRORED_REPEAT},I={[ye]:e.NEAREST,
[be]:e.NEAREST_MIPMAP_NEAREST,[Ee]:e.NEAREST_MIPMAP_LINEAR,[Se]:e.LINEAR,[Te]:e.LINEAR_MIPMAP_NEAREST,[Ce]:e.LINEAR_MIPMAP_LINEAR},R={[yn]:e.NEVER,[An]:e.ALWAYS,[bn]:e.LESS,[En]:e.LEQUAL,[xn]:e.EQUAL,[Tn]:e.GEQUAL,[wn]:e.GREATER,[Sn]:e.NOTEQUAL}
;function k(n,a,s){
if(a.type!==Oe||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Se&&a.magFilter!==Te&&a.magFilter!==Ee&&a.magFilter!==Ce&&a.minFilter!==Se&&a.minFilter!==Te&&a.minFilter!==Ee&&a.minFilter!==Ce||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),
s?(e.texParameteri(n,e.TEXTURE_WRAP_S,M[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,M[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,M[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,I[a.magFilter]),
e.texParameteri(n,e.TEXTURE_MIN_FILTER,I[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),
n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),
a.wrapS===_e&&a.wrapT===_e||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,E(a.magFilter)),
e.texParameteri(n,e.TEXTURE_MIN_FILTER,E(a.minFilter)),a.minFilter!==ye&&a.minFilter!==Se&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),
a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===ye)return
;if(a.minFilter!==Ee&&a.minFilter!==Ce)return;if(a.type===Oe&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&a.type===Pe&&!1===t.has("OES_texture_half_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){
const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function N(t,n){let r=!1
;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let a=p.get(i);void 0===a&&(a={},p.set(i,a));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),
t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){
void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),a[o].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&T(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return r}
function D(t,s,l){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);const u=N(t,s),h=s.source;n.bindTexture(c,t.__webglTexture,e.TEXTURE0+l);const d=r.get(h)
;if(h.version!==d.__version||!0===u){n.activeTexture(e.TEXTURE0+l);const t=mr.getPrimaries(mr.workingColorSpace),r=s.colorSpace===qt?null:mr.getPrimaries(s.colorSpace),p=s.colorSpace===qt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL
;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(e){
return!o&&(e.wrapS!==_e||e.wrapT!==_e||e.minFilter!==ye&&e.minFilter!==Se)}(s)&&!1===_(s.image);let m=g(s.image,f,!1,i.maxTextureSize);m=B(s,m);const E=_(m)||o,w=a.convert(s.format,s.colorSpace)
;let S,T=a.convert(s.type),A=b(s.internalFormat,w,T,s.colorSpace,s.isVideoTexture);k(c,s,E);const C=s.mipmaps,M=o&&!0!==s.isVideoTexture&&A!==at,I=void 0===d.__version||!0===u,R=h.dataReady,N=x(s,m,E);if(s.isDepthTexture)A=e.DEPTH_COMPONENT,
o?A=s.type===Oe?e.DEPTH_COMPONENT32F:s.type===Le?e.DEPTH_COMPONENT24:s.type===Be?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:s.type===Oe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),
s.format===je&&A===e.DEPTH_COMPONENT&&s.type!==Ne&&s.type!==Le&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=Le,T=a.convert(s.type)),
s.format===We&&A===e.DEPTH_COMPONENT&&(A=e.DEPTH_STENCIL,s.type!==Be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=Be,T=a.convert(s.type))),
I&&(M?n.texStorage2D(e.TEXTURE_2D,1,A,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,A,m.width,m.height,0,w,T,null));else if(s.isDataTexture)if(C.length>0&&E){M&&I&&n.texStorage2D(e.TEXTURE_2D,N,A,C[0].width,C[0].height)
;for(let t=0,r=C.length;t<r;t++)S=C[t],M?R&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,w,T,S.data):n.texImage2D(e.TEXTURE_2D,t,A,S.width,S.height,0,w,T,S.data);s.generateMipmaps=!1
}else M?(I&&n.texStorage2D(e.TEXTURE_2D,N,A,m.width,m.height),
R&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,w,T,m.data)):n.texImage2D(e.TEXTURE_2D,0,A,m.width,m.height,0,w,T,m.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){
M&&I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,N,A,C[0].width,C[0].height,m.depth);for(let t=0,r=C.length;t<r;t++)S=C[t],
s.format!==Ge?null!==w?M?R&&n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,m.depth,w,S.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,A,S.width,S.height,m.depth,0,S.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?R&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,m.depth,w,T,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,A,S.width,S.height,m.depth,0,w,T,S.data)
}else{M&&I&&n.texStorage2D(e.TEXTURE_2D,N,A,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)S=C[t],
s.format!==Ge?null!==w?M?R&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,w,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,A,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?R&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,w,T,S.data):n.texImage2D(e.TEXTURE_2D,t,A,S.width,S.height,0,w,T,S.data)
}else if(s.isDataArrayTexture)M?(I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,N,A,m.width,m.height,m.depth),
R&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,w,T,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,A,m.width,m.height,m.depth,0,w,T,m.data);else if(s.isData3DTexture)M?(I&&n.texStorage3D(e.TEXTURE_3D,N,A,m.width,m.height,m.depth),
R&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,w,T,m.data)):n.texImage3D(e.TEXTURE_3D,0,A,m.width,m.height,m.depth,0,w,T,m.data);else if(s.isFramebufferTexture){if(I)if(M)n.texStorage2D(e.TEXTURE_2D,N,A,m.width,m.height);else{
let t=m.width,r=m.height;for(let i=0;i<N;i++)n.texImage2D(e.TEXTURE_2D,i,A,t,r,0,w,T,null),t>>=1,r>>=1}}else if(C.length>0&&E){if(M&&I){const t=z(C[0]);n.texStorage2D(e.TEXTURE_2D,N,A,t.width,t.height)}for(let t=0,r=C.length;t<r;t++)S=C[t],
M?R&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w,T,S):n.texImage2D(e.TEXTURE_2D,t,A,w,T,S);s.generateMipmaps=!1}else if(M){if(I){const t=z(m);n.texStorage2D(e.TEXTURE_2D,N,A,t.width,t.height)}R&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,w,T,m)
}else n.texImage2D(e.TEXTURE_2D,0,A,w,T,m);v(s,E)&&y(c),d.__version=h.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function L(t,i,s,o,c,u){const h=a.convert(s.format,s.colorSpace),d=a.convert(s.type),p=b(s.internalFormat,h,d,s.colorSpace)
;if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,r,i.depth,0,h,d,null):n.texImage2D(c,u,p,t,r,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),
U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,c,r.get(s).__webglTexture,0,F(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,c,r.get(s).__webglTexture,u),
n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=!0===o?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(r||U(n)){const t=n.depthTexture
;t&&t.isDepthTexture&&(t.type===Oe?i=e.DEPTH_COMPONENT32F:t.type===Le&&(i=e.DEPTH_COMPONENT24));const r=F(n)
;U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height)
;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=F(n)
;r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),
e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const s=t[i],o=a.convert(s.format,s.colorSpace),c=a.convert(s.type),u=b(s.internalFormat,o,c,s.colorSpace),h=F(n)
;r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}
e.bindRenderbuffer(e.RENDERBUFFER,null)}function P(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){
if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),
!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")
;r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),C(i.depthTexture,0)
;const a=r.get(i.depthTexture).__webglTexture,s=F(i)
;if(i.depthTexture.format===je)U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{
if(i.depthTexture.format!==We)throw new Error("Unknown depthTexture format")
;U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[]
;for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),O(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),
i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function F(e){return Math.min(i.maxSamples,e.samples)}function U(e){const n=r.get(e)
;return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,n){const r=e.colorSpace,i=e.format,a=e.type
;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Un||r!==Yt&&r!==qt&&(mr.getTransfer(r)===Qt?!1===o?!0===t.has("EXT_sRGB")&&i===Ge?(e.format=Un,e.minFilter=Se,
e.generateMipmaps=!1):n=yr.sRGBToLinear(n):i===Ge&&a===Ie||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}
function z(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,
u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=A;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),
A+=1,e},this.resetTextureUnits=function(){A=0},this.setTexture2D=C,this.setTexture2DArray=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?D(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},
this.setTexture3D=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?D(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,s){const l=r.get(t)
;t.version>0&&l.__version!==t.version?function(t,s,l){if(6!==s.image.length)return;const c=N(t,s),u=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+l);const h=r.get(u);if(u.version!==h.__version||!0===c){
n.activeTexture(e.TEXTURE0+l);const t=mr.getPrimaries(mr.workingColorSpace),r=s.colorSpace===qt?null:mr.getPrimaries(s.colorSpace),d=s.colorSpace===qt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),
e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d)
;const p=s.isCompressedTexture||s.image[0].isCompressedTexture,f=s.image[0]&&s.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=p||f?f?s.image[e].image:s.image[e]:g(s.image[e],!1,!0,i.maxCubemapSize),m[e]=B(s,m[e])
;const E=m[0],w=_(E)||o,S=a.convert(s.format,s.colorSpace),T=a.convert(s.type),A=b(s.internalFormat,S,T,s.colorSpace),C=o&&!0!==s.isVideoTexture,M=void 0===h.__version||!0===c,I=u.dataReady;let R,N=x(s,E,w);if(k(e.TEXTURE_CUBE_MAP,s,w),p){
C&&M&&n.texStorage2D(e.TEXTURE_CUBE_MAP,N,A,E.width,E.height);for(let t=0;t<6;t++){R=m[t].mipmaps;for(let r=0;r<R.length;r++){const i=R[r]
;s.format!==Ge?null!==S?C?I&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,S,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,A,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?I&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,S,T,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,A,i.width,i.height,0,S,T,i.data)
}}}else{if(R=s.mipmaps,C&&M){R.length>0&&N++;const t=z(m[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,N,A,t.width,t.height)}for(let t=0;t<6;t++)if(f){
C?I&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,S,T,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,A,m[t].width,m[t].height,0,S,T,m[t].data);for(let r=0;r<R.length;r++){const i=R[r].image[t].image
;C?I&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,S,T,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,A,i.width,i.height,0,S,T,i.data)}}else{
C?I&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,S,T,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,A,S,T,m[t]);for(let r=0;r<R.length;r++){const i=R[r]
;C?I&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,S,T,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,A,S,T,i.image[t])}}}v(s,w)&&y(e.TEXTURE_CUBE_MAP),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version
}(l,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&L(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&P(t)},
this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",S);const h=t.textures,d=!0===t.isWebGLCubeRenderTarget,p=h.length>1,f=_(t)||o
;if(p||(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,s.memory.textures++),d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[]
;for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[]
;for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(p)if(i.drawBuffers)for(let t=0,n=h.length;t<n;t++){const n=r.get(h[t])
;void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===U(t)){
c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<h.length;n++){const r=h[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),
e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),s=a.convert(r.type),o=b(r.internalFormat,i,s,r.colorSpace,!0===t.isXRRenderTarget),l=F(t)
;e.renderbufferStorageMultisample(e.RENDERBUFFER,l,o,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),
t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),O(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),k(e.TEXTURE_CUBE_MAP,l,f)
;for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)L(c.__webglFramebuffer[n][r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else L(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0)
;v(l,f)&&y(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(p){for(let i=0,a=h.length;i<a;i++){const a=h[i],s=r.get(a);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),k(e.TEXTURE_2D,a,f),L(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),
v(a,f)&&y(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D
;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),
n.bindTexture(r,u.__webglTexture),k(r,l,f),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)L(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,r,n);else L(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r,0);v(l,f)&&y(r),
n.unbindTexture()}t.depthBuffer&&P(t)},this.updateRenderTargetMipmap=function(t){const i=_(t)||o,a=t.textures;for(let s=0,o=a.length;s<o;s++){const o=a[s];if(v(o,i)){
const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(o).__webglTexture;n.bindTexture(i,a),y(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===U(t)){
const i=t.textures,a=t.width,s=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=r.get(t),d=i.length>1
;if(d)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),
e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<i.length;n++){
l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(u);const p=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),
d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[n]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),d){
const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),c&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}
if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),
e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),
e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=P,this.setupFrameBufferTexture=L,this.useMultisampledRTT=U}
function Hl(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=qt){let a;const s=mr.getTransfer(i);if(n===Ie)return e.UNSIGNED_BYTE;if(n===Fe)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Ue)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Re)return e.BYTE
;if(n===ke)return e.SHORT;if(n===Ne)return e.UNSIGNED_SHORT;if(n===De)return e.INT;if(n===Le)return e.UNSIGNED_INT;if(n===Oe)return e.FLOAT;if(n===Pe)return r?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null)
;if(n===ze)return e.ALPHA;if(n===Ge)return e.RGBA;if(n===Ve)return e.LUMINANCE;if(n===He)return e.LUMINANCE_ALPHA;if(n===je)return e.DEPTH_COMPONENT;if(n===We)return e.DEPTH_STENCIL;if(n===Un)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null
;if(n===$e)return e.RED;if(n===qe)return e.RED_INTEGER;if(n===Xe)return e.RG;if(n===Ye)return e.RG_INTEGER;if(n===Ke)return e.RGBA_INTEGER;if(n===Je||n===Ze||n===Qe||n===et)if(s===Qt){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),
null===a)return null;if(n===Je)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ze)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Qe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===et)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{
if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(n===Je)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ze)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Qe)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT
;if(n===et)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===tt||n===nt||n===rt||n===it){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(n===tt)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG
;if(n===nt)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===rt)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===it)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===at)return a=t.get("WEBGL_compressed_texture_etc1"),
null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===st||n===ot){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(n===st)return s===Qt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2
;if(n===ot)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(n===lt||n===ct||n===ut||n===ht||n===dt||n===pt||n===ft||n===mt||n===gt||n===_t||n===vt||n===yt||n===bt||n===xt){if(a=t.get("WEBGL_compressed_texture_astc"),
null===a)return null;if(n===lt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ct)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR
;if(n===ut)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ht)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR
;if(n===dt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===pt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR
;if(n===ft)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===mt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR
;if(n===gt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===_t)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR
;if(n===vt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===yt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR
;if(n===bt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===xt)return s===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Et||n===wt||n===St){
if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(n===Et)return s===Qt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===wt)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT
;if(n===St)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Tt||n===At||n===Ct||n===Mt){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(n===Et)return a.COMPRESSED_RED_RGTC1_EXT
;if(n===At)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Ct)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Mt)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Be?r?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),
null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class jl extends ns{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Wl extends Pi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const $l={type:"move"}
;class ql{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Wl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),
this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Wl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Dr,
this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Dr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Wl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,
this._grip.linearVelocity=new Dr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Dr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),
null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){
return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null
;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r)
;null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}
const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this
})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),
o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,
o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),
s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,
this.dispatchEvent($l)))}return null!==s&&(s.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Wl;n.matrixAutoUpdate=!1,n.visible=!1,
e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Xl{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new Sr;e.properties.get(r).__webglTexture=t.texture,
t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}render(e,t){if(null!==this.texture){if(null===this.mesh){const e=t.cameras[0].viewport,n=new Ja({extensions:{fragDepth:!0},
vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",
fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",
uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new ja(new gs(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class Yl extends Gn{constructor(e,t){super();const n=this
;let r=null,i=1,a=null,s="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=new Xl,m=t.getContextAttributes();let g=null,_=null;const v=[],y=[],b=new tr;let x=null;const E=new ns;E.layers.enable(1),E.viewport=new Tr;const w=new ns
;w.layers.enable(2),w.viewport=new Tr;const S=[E,w],T=new jl;T.layers.enable(1),T.layers.enable(2);let A=null,C=null;function M(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=v[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),
n.dispatchEvent({type:e.type,data:e.inputSource}))}function I(){r.removeEventListener("select",M),r.removeEventListener("selectstart",M),r.removeEventListener("selectend",M),r.removeEventListener("squeeze",M),r.removeEventListener("squeezestart",M),
r.removeEventListener("squeezeend",M),r.removeEventListener("end",I),r.removeEventListener("inputsourceschange",R);for(let e=0;e<v.length;e++){const t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}A=null,C=null,f.reset(),e.setRenderTarget(g),d=null,
h=null,u=null,r=null,_=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(x),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function R(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=y.indexOf(n);r>=0&&(y[r]=null,
v[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=y.indexOf(n);if(-1===r){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(n),r=e;break}if(null===y[e]){y[e]=n,r=e;break}}if(-1===r)break}const i=v[r];i&&i.connect(n)}}
this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new ql,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new ql,v[e]=t),
t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new ql,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,
!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,
!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},
this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",M),
r.addEventListener("selectstart",M),r.addEventListener("selectend",M),r.addEventListener("squeeze",M),r.addEventListener("squeezestart",M),r.addEventListener("squeezeend",M),r.addEventListener("end",I),r.addEventListener("inputsourceschange",R),
!0!==m.xrCompatible&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(b),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,
framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),_=new Cr(d.framebufferWidth,d.framebufferHeight,{format:Ge,type:Ie,
colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,a=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?We:je,a=m.stencil?Be:Le);const o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i}
;u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(o),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),_=new Cr(h.textureWidth,h.textureHeight,{format:Ge,type:Ie,
depthTexture:new Qs(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0}),e.properties.get(_).__ignoreDepthValues=h.ignoreDepthValues}
_.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await r.requestReferenceSpace(s),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){
if(null!==r)return r.environmentBlendMode};const k=new Dr,N=new Dr;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}
this.updateCamera=function(e){if(null===r)return;null!==f.texture&&(e.near=f.depthNear,e.far=f.depthFar),T.near=w.near=E.near=e.near,T.far=w.far=E.far=e.far,A===T.near&&C===T.far||(r.updateRenderState({depthNear:T.near,depthFar:T.far}),A=T.near,
C=T.far,E.near=A,E.far=C,w.near=A,w.far=C,E.updateProjectionMatrix(),w.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,n=T.cameras;D(T,t);for(let e=0;e<n.length;e++)D(n[e],t);2===n.length?function(e,t,n){
k.setFromMatrixPosition(t.matrixWorld),N.setFromMatrixPosition(n.matrixWorld)
;const r=k.distanceTo(N),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u
;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,_=o+f,v=d-m,y=p+(r-m),b=l*o/_*g,x=c*o/_*g
;e.projectionMatrix.makePerspective(v,y,b,x,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(T,E,w):T.projectionMatrix.copy(E.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),
e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),
e.isPerspectiveCamera&&(e.fov=2*Wn*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,T,t)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,
null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture};let L=null;const O=new fs;O.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||a),p=i,null!==c){
const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(_,d.framebuffer),e.setRenderTarget(_));let n=!1;t.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let a=null;if(null!==d)a=d.getViewport(i);else{
const t=u.getViewSubImage(h,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(_,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(_))}let s=S[r];void 0===s&&(s=new ns,s.layers.enable(r),s.viewport=new Tr,S[r]=s),
s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),
0===r&&(T.matrix.copy(s.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(s)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){const n=u.getDepthInformation(t[0])
;n&&n.isValid&&n.texture&&f.init(e,n,r.renderState)}}for(let e=0;e<v.length;e++){const t=y[e],n=v[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}f.render(e,T),L&&L(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),
this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const Kl=new yi,Jl=new ci;function Zl(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,
i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),
i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,i.side===m&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),
r.normalScale.value.copy(i.normalScale),i.side===m&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,
r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),
i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const a=t.get(i),s=a.envMap,o=a.envMapRotation;if(s&&(r.envMap.value=s,Kl.copy(o),Kl.x*=-1,Kl.y*=-1,Kl.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(Kl.y*=-1,Kl.z*=-1),
r.envMapRotation.value.setFromMatrix4(Jl.makeRotationFromEuler(Kl)),r.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){
r.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,
n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ya(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},
refreshMaterialUniforms:function(e,i,a,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){
e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,
n(r.metalnessMap,e.metalnessMapTransform)),e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform)),t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),
i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,
n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,
e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,
n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),
t.side===m&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],
e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),
t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,
e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,
n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),
t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),
e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),
t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)
}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,
e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),
i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,
e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,s):i.isSpriteMaterial?function(e,t){
e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),
t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Ql(e,t,n,r){let i={},a={},s=[]
;const o=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=r[a]
;if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,
t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,
t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target
;n.removeEventListener("dispose",u);const r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){
let d=i[n.id];void 0===d&&(function(e){const t=e.uniforms;let n=0;for(let e=0,r=t.length;e<r;e++){const r=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=r.length;e<t;e++){const t=r[e],i=Array.isArray(t.value)?t.value:[t.value]
;for(let e=0,r=i.length;e<r;e++){const r=c(i[e]),a=n%16;0!==a&&16-a<r.boundary&&(n+=16-a),t.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,n+=r.storage}}}const r=n%16;r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),
d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n
;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u))
;const p=h.program;r.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=Array.isArray(r[t])?r[t]:[r[t]]
;for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===l(i,t,r,a)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let a=0;a<n.length;a++){const s=n[a],o=c(s);"number"==typeof s||"boolean"==typeof s?(i.__data[0]=s,
e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,
i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),
a[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);s=[],i={},a={}}}}class ec{constructor(e={}){
const{canvas:n=lr(),context:r=null,depth:i=!0,stencil:a=!0,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;let d;this.isWebGLRenderer=!0,
d=null!==r?r.getContextAttributes().alpha:s;const p=new Uint32Array(4),_=new Int32Array(4);let v=null,y=null;const b=[],x=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,
this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Xt,this._useLegacyLights=!1,this.toneMapping=ee,this.toneMappingExposure=1;const E=this
;let w=!1,S=0,T=0,A=null,C=-1,M=null;const I=new Tr,R=new Tr;let k=null;const N=new Zi(0);let D=0,L=n.width,O=n.height,P=1,F=null,U=null;const B=new Tr(0,0,L,O),z=new Tr(0,0,L,O);let G=!1;const V=new ps;let H=!1,j=!1,W=null
;const $=new ci,q=new tr,X=new Dr,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return null===A?P:1}let J,Z,Q,te,ne,re,ie,ae,se,oe,le,ce,ue,he,de,pe,fe,me,ge,_e,ve,ye,be,xe,Ee=r;function we(e,t){
for(let r=0;r<e.length;r++){const i=e[r],a=n.getContext(i,t);if(null!==a)return a}return null}try{const e={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h}
;if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${t}`),n.addEventListener("webglcontextlost",Ae,!1),n.addEventListener("webglcontextrestored",Me,!1),n.addEventListener("webglcontextcreationerror",Re,!1),null===Ee){
const t=["webgl2","webgl","experimental-webgl"];if(!0===E.isWebGL1Renderer&&t.shift(),Ee=we(t,e),null===Ee)throw we(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}
"undefined"!=typeof WebGLRenderingContext&&Ee instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),
void 0===Ee.getShaderPrecisionFormat&&(Ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Se(){J=new Ws(Ee),Z=new As(Ee,J,e),J.init(Z),
ye=new Hl(Ee,J,Z),Q=new Gl(Ee,J,Z),te=new Xs(Ee),ne=new Cl,re=new Vl(Ee,J,Q,ne,Z,ye,te),ie=new Ms(E),ae=new js(E),se=new ms(Ee,Z),be=new Ss(Ee,J,se,Z),oe=new $s(Ee,se,te,be),le=new Zs(Ee,oe,se,te),ge=new Js(Ee,Z,re),pe=new Cs(ne),
ce=new Al(E,ie,ae,J,Z,be,pe),ue=new Zl(E,ne),he=new kl,de=new Fl(J,Z),me=new ws(E,ie,ae,Q,le,d,l),fe=new zl(E,le,Z),xe=new Ql(Ee,te,Z,Q),_e=new Ts(Ee,J,te,Z),ve=new qs(Ee,J,te,Z),te.programs=ce.programs,E.capabilities=Z,E.extensions=J,
E.properties=ne,E.renderLists=he,E.shadowMap=fe,E.state=Q,E.info=te}Se();const Te=new Yl(E,Ee);function Ae(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Me(){
console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const e=te.autoReset,t=fe.enabled,n=fe.autoUpdate,r=fe.needsUpdate,i=fe.type;Se(),te.autoReset=e,fe.enabled=t,fe.autoUpdate=n,fe.needsUpdate=r,fe.type=i}function Re(e){
console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ke(e){const t=e.target;t.removeEventListener("dispose",ke),function(e){(function(e){const t=ne.get(e).programs
;void 0!==t&&(t.forEach((function(e){ce.releaseProgram(e)})),e.isShaderMaterial&&ce.releaseShaderCache(e))})(e),ne.remove(e)}(t)}function De(e,t,n){!0===e.transparent&&e.side===g&&!1===e.forceSinglePass?(e.side=m,e.needsUpdate=!0,Ze(e,t,n),e.side=f,
e.needsUpdate=!0,Ze(e,t,n),e.side=g):Ze(e,t,n)}this.xr=Te,this.getContext=function(){return Ee},this.getContextAttributes=function(){return Ee.getContextAttributes()},this.forceContextLoss=function(){const e=J.get("WEBGL_lose_context")
;e&&e.loseContext()},this.forceContextRestore=function(){const e=J.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e,this.setSize(L,O,!1))},
this.getSize=function(e){return e.set(L,O)},this.setSize=function(e,t,r=!0){Te.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=e,O=t,n.width=Math.floor(e*P),n.height=Math.floor(t*P),
!0===r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(L*P,O*P).floor()},this.setDrawingBufferSize=function(e,t,r){L=e,O=t,P=r,n.width=Math.floor(e*r),
n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(I)},this.getViewport=function(e){return e.copy(B)},this.setViewport=function(e,t,n,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,r),
Q.viewport(I.copy(B).multiplyScalar(P).round())},this.getScissor=function(e){return e.copy(z)},this.setScissor=function(e,t,n,r){e.isVector4?z.set(e.x,e.y,e.z,e.w):z.set(e,t,n,r),Q.scissor(R.copy(z).multiplyScalar(P).round())},
this.getScissorTest=function(){return G},this.setScissorTest=function(e){Q.setScissorTest(G=e)},this.setOpaqueSort=function(e){F=e},this.setTransparentSort=function(e){U=e},this.getClearColor=function(e){return e.copy(me.getClearColor())},
this.setClearColor=function(){me.setClearColor.apply(me,arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha.apply(me,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){
let e=!1;if(null!==A){const t=A.texture.format;e=t===Ke||t===Ye||t===qe}if(e){const e=A.texture.type,t=e===Ie||e===Le||e===Ne||e===Be||e===Fe||e===Ue,n=me.getClearColor(),r=me.getClearAlpha(),i=n.r,a=n.g,s=n.b;t?(p[0]=i,p[1]=a,p[2]=s,p[3]=r,
Ee.clearBufferuiv(Ee.COLOR,0,p)):(_[0]=i,_[1]=a,_[2]=s,_[3]=r,Ee.clearBufferiv(Ee.COLOR,0,_))}else r|=Ee.COLOR_BUFFER_BIT}t&&(r|=Ee.DEPTH_BUFFER_BIT),n&&(r|=Ee.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ee.clear(r)},
this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ae,!1),
n.removeEventListener("webglcontextrestored",Me,!1),n.removeEventListener("webglcontextcreationerror",Re,!1),he.dispose(),de.dispose(),ne.dispose(),ie.dispose(),ae.dispose(),le.dispose(),be.dispose(),xe.dispose(),ce.dispose(),Te.dispose(),
Te.removeEventListener("sessionstart",Ve),Te.removeEventListener("sessionend",He),W&&(W.dispose(),W=null),je.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=Y);const s=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){
!0!==t.isScene&&(t=Y),re.resetTextureUnits()
;const a=t.fog,s=r.isMeshStandardMaterial?t.environment:null,o=null===A?E.outputColorSpace:!0===A.isXRRenderTarget?A.texture.colorSpace:Yt,l=(r.isMeshStandardMaterial?ae:ie).get(r.envMap||s),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color
;let f=ee;r.toneMapped&&(null!==A&&!0!==A.isXRRenderTarget||(f=E.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,_=ne.get(r),v=y.state.lights;if(!0===H&&(!0===j||e!==M)){
const t=e===M&&r.id===C;pe.setState(r,e,t)}let b=!1
;r.version===_.__version?_.needsLights&&_.lightsStateVersion!==v.state.version||_.outputColorSpace!==o||i.isBatchedMesh&&!1===_.batching?b=!0:i.isBatchedMesh||!0!==_.batching?i.isInstancedMesh&&!1===_.instancing?b=!0:i.isInstancedMesh||!0!==_.instancing?i.isSkinnedMesh&&!1===_.skinning?b=!0:i.isSkinnedMesh||!0!==_.skinning?i.isInstancedMesh&&!0===_.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===_.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===_.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===_.instancingMorph&&null!==i.morphTexture||_.envMap!==l||!0===r.fog&&_.fog!==a?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===pe.numPlanes&&_.numIntersection===pe.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==h||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==f||!0===Z.isWebGL2&&_.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,
_.__version=r.version);let x=_.currentProgram;!0===b&&(x=Ze(r,t,i));let w=!1,S=!1,T=!1;const I=x.getUniforms(),R=_.uniforms;if(Q.useProgram(x.program)&&(w=!0,S=!0,T=!0),r.id!==C&&(C=r.id,S=!0),w||M!==e){
I.setValue(Ee,"projectionMatrix",e.projectionMatrix),I.setValue(Ee,"viewMatrix",e.matrixWorldInverse);const t=I.map.cameraPosition;void 0!==t&&t.setValue(Ee,X.setFromMatrixPosition(e.matrixWorld)),
Z.logarithmicDepthBuffer&&I.setValue(Ee,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),
(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&I.setValue(Ee,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,S=!0,T=!0)}if(i.isSkinnedMesh){
I.setOptional(Ee,i,"bindMatrix"),I.setOptional(Ee,i,"bindMatrixInverse");const e=i.skeleton;e&&(Z.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),
I.setValue(Ee,"boneTexture",e.boneTexture,re)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}
i.isBatchedMesh&&(I.setOptional(Ee,i,"batchingTexture"),I.setValue(Ee,"batchingTexture",i._matricesTexture,re));const k=n.morphAttributes;var N,D;if((void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===Z.isWebGL2)&&ge.update(i,n,x),
(S||_.receiveShadow!==i.receiveShadow)&&(_.receiveShadow=i.receiveShadow,I.setValue(Ee,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(R.envMap.value=l,
R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),S&&(I.setValue(Ee,"toneMappingExposure",E.toneMappingExposure),_.needsLights&&(D=T,(N=R).ambientLightColor.needsUpdate=D,N.lightProbe.needsUpdate=D,
N.directionalLights.needsUpdate=D,N.directionalLightShadows.needsUpdate=D,N.pointLights.needsUpdate=D,N.pointLightShadows.needsUpdate=D,N.spotLights.needsUpdate=D,N.spotLightShadows.needsUpdate=D,N.rectAreaLights.needsUpdate=D,
N.hemisphereLights.needsUpdate=D),a&&!0===r.fog&&ue.refreshFogUniforms(R,a),ue.refreshMaterialUniforms(R,r,P,O,W),al.upload(Ee,Qe(_),R,re)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(al.upload(Ee,Qe(_),R,re),r.uniformsNeedUpdate=!1),
r.isSpriteMaterial&&I.setValue(Ee,"center",i.center),I.setValue(Ee,"modelViewMatrix",i.modelViewMatrix),I.setValue(Ee,"normalMatrix",i.normalMatrix),I.setValue(Ee,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){
const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(Z.isWebGL2){const n=e[t];xe.update(n,x),xe.bind(n,x)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return x}(e,t,n,r,i);Q.setMaterial(r,s)
;let l=n.index,c=1;if(!0===r.wireframe){if(l=oe.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==a&&(d=Math.max(d,a.start*c),p=Math.min(p,(a.start+a.count)*c)),
null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;be.setup(i,r,o,n,l);let g=_e;if(null!==l&&(m=se.get(l),g=ve,g.setIndex(m)),
i.isMesh)!0===r.wireframe?(Q.setLineWidth(r.wireframeLinewidth*K()),g.setMode(Ee.LINES)):g.setMode(Ee.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Q.setLineWidth(e*K()),
i.isLineSegments?g.setMode(Ee.LINES):i.isLineLoop?g.setMode(Ee.LINE_LOOP):g.setMode(Ee.LINE_STRIP)}else i.isPoints?g.setMode(Ee.POINTS):i.isSprite&&g.setMode(Ee.TRIANGLES)
;if(i.isBatchedMesh)g.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)g.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){
const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,f,t)}else g.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),y=de.get(n),y.init(),x.push(y),n.traverseVisible((function(e){
e.isLight&&e.layers.test(t.layers)&&(y.pushLight(e),e.castShadow&&y.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(y.pushLight(e),e.castShadow&&y.pushShadow(e))})),y.setupLights(E._useLegacyLights)
;const r=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];De(a,n,e),r.add(a)}else De(t,n,e),r.add(t)})),x.pop(),y=null,r},this.compileAsync=function(e,t,n=null){
const r=this.compile(e,t,n);return new Promise((t=>{function n(){r.forEach((function(e){ne.get(e).currentProgram.isReady()&&r.delete(e)})),0!==r.size?setTimeout(n,10):t(e)}null!==J.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))}
;let ze=null;function Ve(){je.stop()}function He(){je.start()}const je=new fs;function We(e,t,n,r){if(!1===e.visible)return
;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)y.pushLight(e),e.castShadow&&y.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||V.intersectsSprite(e)){
r&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4($);const t=le.update(e),i=e.material;i.visible&&v.push(e,t,i,n,X.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||V.intersectsObject(e))){const t=le.update(e),i=e.material
;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),X.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),X.copy(t.boundingSphere.center)),
X.applyMatrix4(e.matrixWorld).applyMatrix4($)),Array.isArray(i)){const r=t.groups;for(let a=0,s=r.length;a<s;a++){const s=r[a],o=i[s.materialIndex];o&&o.visible&&v.push(e,t,o,n,X.z,s)}}else i.visible&&v.push(e,t,i,n,X.z,null)}const i=e.children
;for(let e=0,a=i.length;e<a;e++)We(i[e],t,n,r)}function $e(e,t,n,r){const i=e.opaque,a=e.transmissive,s=e.transparent;y.setupLightsView(n),!0===H&&pe.setGlobalState(E.clippingPlanes,n),a.length>0&&function(e,t,n,r){
if(null!==(!0===n.isScene?n.overrideMaterial:null))return;const i=Z.isWebGL2;null===W&&(W=new Cr(1,1,{generateMipmaps:!0,type:J.has("EXT_color_buffer_half_float")?Pe:Ie,minFilter:Ce,samples:i?4:0})),E.getDrawingBufferSize(q),
i?W.setSize(q.x,q.y):W.setSize(Jn(q.x),Jn(q.y));const a=E.getRenderTarget();E.setRenderTarget(W),E.getClearColor(N),D=E.getClearAlpha(),D<1&&E.setClearColor(16777215,.5),E.clear();const s=E.toneMapping;E.toneMapping=ee,Xe(e,n,r),
re.updateMultisampleRenderTarget(W),re.updateRenderTargetMipmap(W);let o=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.object,s=i.geometry,l=i.material,c=i.group;if(l.side===g&&a.layers.test(r.layers)){const e=l.side;l.side=m,l.needsUpdate=!0,
Je(a,n,r,s,l,c),l.side=e,l.needsUpdate=!0,o=!0}}!0===o&&(re.updateMultisampleRenderTarget(W),re.updateRenderTargetMipmap(W)),E.setRenderTarget(a),E.setClearColor(N,D),E.toneMapping=s}(i,a,t,n),r&&Q.viewport(I.copy(r)),i.length>0&&Xe(i,t,n),
a.length>0&&Xe(a,t,n),s.length>0&&Xe(s,t,n),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Xe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){
const a=e[i],s=a.object,o=a.geometry,l=null===r?a.material:r,c=a.group;s.layers.test(n.layers)&&Je(s,t,n,o,l,c)}}function Je(e,t,n,r,i,a){e.onBeforeRender(E,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),
e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(E,t,n,r,e,a),!0===i.transparent&&i.side===g&&!1===i.forceSinglePass?(i.side=m,i.needsUpdate=!0,E.renderBufferDirect(n,t,r,i,e,a),i.side=f,i.needsUpdate=!0,
E.renderBufferDirect(n,t,r,i,e,a),i.side=g):E.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(E,t,n,r,i,a)}function Ze(e,t,n){!0!==t.isScene&&(t=Y)
;const r=ne.get(e),i=y.state.lights,a=y.state.shadowsArray,s=i.state.version,o=ce.getParameters(e,i.state,a,t,n),l=ce.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,
r.envMap=(e.isMeshStandardMaterial?ae:ie).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",ke),c=new Map,r.programs=c);let u=c.get(l)
;if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return et(e,o),u}else o.uniforms=ce.getUniforms(e),e.onBuild(n,o,E),e.onBeforeCompile(o,E),u=ce.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const h=r.uniforms
;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=pe.uniform),et(e,o),r.needsLights=function(e){
return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,
h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,
h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,
h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,
h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Qe(e){if(null===e.uniformsList){
const t=e.currentProgram.getUniforms();e.uniformsList=al.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function et(e,t){const n=ne.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.instancing=t.instancing,
n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,
n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}je.setAnimationLoop((function(e){ze&&ze(e)})),
"undefined"!=typeof self&&je.setContext(self),this.setAnimationLoop=function(e){ze=e,Te.setAnimationLoop(e),null===e?je.stop():je.start()},Te.addEventListener("sessionstart",Ve),Te.addEventListener("sessionend",He),this.render=function(e,t){
if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),
null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Te.enabled&&!0===Te.isPresenting&&(!0===Te.cameraAutoUpdate&&Te.updateCamera(t),t=Te.getCamera()),!0===e.isScene&&e.onBeforeRender(E,e,t,A),y=de.get(e,x.length),y.init(),
x.push(y),$.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),V.setFromProjectionMatrix($),j=this.localClippingEnabled,H=pe.init(this.clippingPlanes,j),v=he.get(e,b.length),v.init(),b.push(v),We(e,t,0,E.sortObjects),v.finish(),
!0===E.sortObjects&&v.sort(F,U),this.info.render.frame++,!0===H&&pe.beginShadows();const n=y.state.shadowsArray;if(fe.render(n,e,t),!0===H&&pe.endShadows(),!0===this.info.autoReset&&this.info.reset(),
!1!==Te.enabled&&!1!==Te.isPresenting&&!1!==Te.hasDepthSensing()||me.render(v,e),y.setupLights(E._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];$e(v,e,r,r.viewport)}}else $e(v,e,t)
;null!==A&&(re.updateMultisampleRenderTarget(A),re.updateRenderTargetMipmap(A)),!0===e.isScene&&e.onAfterRender(E,e,t),be.resetDefaultState(),C=-1,M=null,x.pop(),y=x.length>0?x[x.length-1]:null,b.pop(),v=b.length>0?b[b.length-1]:null},
this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(e,t,n){ne.get(e.texture).__webglTexture=t,
ne.get(e.depthTexture).__webglTexture=n;const r=ne.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,
r.__autoAllocateDepthBuffer||!0===J.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},
this.setRenderTargetFramebuffer=function(e,t){const n=ne.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){A=e,S=t,T=n;let r=!0,i=null,a=!1,s=!1;if(e){const o=ne.get(e)
;void 0!==o.__useDefaultFramebuffer?(Q.bindFramebuffer(Ee.FRAMEBUFFER,null),
r=!1):void 0===o.__webglFramebuffer?re.setupRenderTarget(e):o.__hasExternalTextures&&re.rebindTextures(e,ne.get(e.texture).__webglTexture,ne.get(e.depthTexture).__webglTexture);const l=e.texture
;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=ne.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],
a=!0):i=Z.isWebGL2&&e.samples>0&&!1===re.useMultisampledRTT(e)?ne.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,I.copy(e.viewport),R.copy(e.scissor),k=e.scissorTest}else I.copy(B).multiplyScalar(P).floor(),
R.copy(z).multiplyScalar(P).floor(),k=G;if(Q.bindFramebuffer(Ee.FRAMEBUFFER,i)&&Z.drawBuffers&&r&&Q.drawBuffers(e,i),Q.viewport(I),Q.scissor(R),Q.setScissorTest(k),a){const r=ne.get(e.texture)
;Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){const r=ne.get(e.texture),i=t||0;Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}C=-1
},this.readRenderTargetPixels=function(e,t,n,r,i,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=ne.get(e).__webglFramebuffer
;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){Q.bindFramebuffer(Ee.FRAMEBUFFER,o);try{const s=e.texture,o=s.format,l=s.type
;if(o!==Ge&&ye.convert(o)!==Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.")
;const c=l===Pe&&(J.has("EXT_color_buffer_half_float")||Z.isWebGL2&&J.has("EXT_color_buffer_float"))
;if(!(l===Ie||ye.convert(l)===Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_TYPE)||l===Oe&&(Z.isWebGL2||J.has("OES_texture_float")||J.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")
;t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&Ee.readPixels(t,n,r,i,ye.convert(o),ye.convert(l),a)}finally{const e=null!==A?ne.get(A).__webglFramebuffer:null;Q.bindFramebuffer(Ee.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){
const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);re.setTexture2D(t,0),Ee.copyTexSubImage2D(Ee.TEXTURE_2D,n,0,0,e.x,e.y,i,a),Q.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){
const i=t.image.width,a=t.image.height,s=ye.convert(n.format),o=ye.convert(n.type);re.setTexture2D(n,0),Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,n.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),
Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,n.unpackAlignment),
t.isDataTexture?Ee.texSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,i,a,s,o,t.image.data):t.isCompressedTexture?Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):Ee.texSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,s,o,t.image),
0===r&&n.generateMipmaps&&Ee.generateMipmap(Ee.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){
if(E.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.")
;const a=Math.round(e.max.x-e.min.x),s=Math.round(e.max.y-e.min.y),o=e.max.z-e.min.z+1,l=ye.convert(r.format),c=ye.convert(r.type);let u;if(r.isData3DTexture)re.setTexture3D(r,0),u=Ee.TEXTURE_3D;else{
if(!r.isDataArrayTexture&&!r.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");re.setTexture2DArray(r,0),u=Ee.TEXTURE_2D_ARRAY}
Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,r.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,r.unpackAlignment)
;const h=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),d=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),p=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),f=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),m=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[i]:n.image
;Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,g.width),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,g.height),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,e.min.x),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,e.min.y),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,e.min.z),
n.isDataTexture||n.isData3DTexture?Ee.texSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,c,g.data):r.isCompressedArrayTexture?Ee.compressedTexSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,g.data):Ee.texSubImage3D(u,i,t.x,t.y,t.z,a,s,o,l,c,g),
Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,h),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,d),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,p),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,f),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&Ee.generateMipmap(u),
Q.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?re.setTextureCube(e,0):e.isData3DTexture?re.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?re.setTexture2DArray(e,0):re.setTexture2D(e,0),Q.unbindTexture()},
this.resetState=function(){S=0,T=0,A=null,Q.reset(),be.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Bn}get outputColorSpace(){
return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Kt?"display-p3":"srgb",t.unpackColorSpace=mr.workingColorSpace===Jt?"display-p3":"srgb"}get useLegacyLights(){
return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}
set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),
this._useLegacyLights=e}}class tc extends ec{}tc.prototype.isWebGL1Renderer=!0;class nc{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Zi(e),this.density=t}clone(){return new nc(this.color,this.density)}toJSON(){return{
type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class rc{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Zi(e),this.near=t,this.far=n}clone(){return new rc(this.color,this.near,this.far)}toJSON(){
return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ic extends Pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,
this.backgroundIntensity=1,this.backgroundRotation=new yi,this.environmentRotation=new yi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){
return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,
this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),
this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),
1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ac{constructor(e,t){
this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Cn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=$n()}onUploadCallback(){}set needsUpdate(e){
!0===e&&this.version++}get updateRange(){return ur("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){
this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,
n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$n()),
void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride)
;return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$n()),
void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}
const sc=new Dr;class oc{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){
this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)sc.fromBufferAttribute(this,t),sc.applyMatrix4(e),this.setXYZ(t,sc.x,sc.y,sc.z);return this}applyNormalMatrix(e){
for(let t=0,n=this.count;t<n;t++)sc.fromBufferAttribute(this,t),sc.applyNormalMatrix(e),this.setXYZ(t,sc.x,sc.y,sc.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)sc.fromBufferAttribute(this,t),sc.transformDirection(e),
this.setXYZ(t,sc.x,sc.y,sc.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Zn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Qn(n,this.array)),
this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Qn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Qn(t,this.array)),
this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Qn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Qn(t,this.array)),
this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1]
;return this.normalized&&(t=Zn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3]
;return this.normalized&&(t=Zn(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){
return e=e*this.data.stride+this.offset,this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,
this.normalized&&(t=Qn(t,this.array),n=Qn(n,this.array),r=Qn(r,this.array),i=Qn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){
console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset
;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new ca(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),
void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new oc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){
console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset
;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),
void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class lc extends ta{
constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Zi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){
return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let cc
;const uc=new Dr,hc=new Dr,dc=new Dr,pc=new tr,fc=new tr,mc=new ci,gc=new Dr,_c=new Dr,vc=new Dr,yc=new tr,bc=new tr,xc=new tr;class Ec extends Pi{constructor(e=new lc){if(super(),this.isSprite=!0,this.type="Sprite",void 0===cc){cc=new Aa
;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ac(e,5);cc.setIndex([0,1,2,0,2,3]),cc.setAttribute("position",new oc(t,3,0,!1)),cc.setAttribute("uv",new oc(t,2,3,!1))}this.geometry=cc,this.material=e,
this.center=new tr(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hc.setFromMatrixScale(this.matrixWorld),mc.copy(e.camera.matrixWorld),
this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),dc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&hc.multiplyScalar(-dc.z)
;const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const a=this.center;wc(gc.set(-.5,-.5,0),dc,a,hc,r,i),wc(_c.set(.5,-.5,0),dc,a,hc,r,i),wc(vc.set(.5,.5,0),dc,a,hc,r,i),yc.set(0,0),bc.set(1,0),xc.set(1,1)
;let s=e.ray.intersectTriangle(gc,_c,vc,!1,uc);if(null===s&&(wc(_c.set(-.5,.5,0),dc,a,hc,r,i),bc.set(0,1),s=e.ray.intersectTriangle(gc,vc,_c,!1,uc),null===s))return;const o=e.ray.origin.distanceTo(uc);o<e.near||o>e.far||t.push({distance:o,
point:uc.clone(),uv:qi.getInterpolation(uc,gc,_c,vc,yc,bc,xc,new tr),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function wc(e,t,n,r,i,a){
pc.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(fc.x=a*pc.x-i*pc.y,fc.y=i*pc.x+a*pc.y):fc.copy(pc),e.copy(t),e.x+=fc.x,e.y+=fc.y,e.applyMatrix4(mc)}const Sc=new Dr,Tc=new Dr;class Ac extends Pi{constructor(){super(),this._currentLevel=0,
this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e]
;this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,
object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}
return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Sc.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Sc);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){
Sc.setFromMatrixPosition(e.matrixWorld),Tc.setFromMatrixPosition(this.matrixWorld);const n=Sc.distanceTo(Tc)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),
!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels
;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}}const Cc=new Dr,Mc=new Tr,Ic=new Tr,Rc=new Dr,kc=new ci,Nc=new Dr,Dc=new ei,Lc=new ci,Oc=new li
;class Pc extends ja{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=le,this.bindMatrix=new ci,this.bindMatrixInverse=new ci,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){
const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Pr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Nc),this.boundingBox.expandByPoint(Nc)}
computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ei),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Nc),
this.boundingSphere.expandByPoint(Nc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,
null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld
;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Dc.copy(this.boundingSphere),Dc.applyMatrix4(r),!1!==e.ray.intersectsSphere(Dc)&&(Lc.copy(r).invert(),Oc.copy(e.ray).applyMatrix4(Lc),
null!==this.boundingBox&&!1===Oc.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Oc)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,
void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){
const e=new Tr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){
super.updateMatrixWorld(e),this.bindMode===le?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===ce?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}
applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;Mc.fromBufferAttribute(r.attributes.skinIndex,e),Ic.fromBufferAttribute(r.attributes.skinWeight,e),Cc.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){
const r=Ic.getComponent(e);if(0!==r){const i=Mc.getComponent(e);kc.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Rc.copy(Cc).applyMatrix4(kc),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Fc extends Pi{
constructor(){super(),this.isBone=!0,this.type="Bone"}}class Uc extends Sr{constructor(e=null,t=1,n=1,r,i,a,s,o,l=ye,c=ye,u,h){super(null,a,s,o,l,c,r,i,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,
this.flipY=!1,this.unpackAlignment=1}}const Bc=new ci,zc=new ci;class Gc{constructor(e=[],t=[]){this.uuid=$n(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){
const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){
console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ci)}}calculateInverses(){this.boneInverses.length=0
;for(let e=0,t=this.bones.length;e<t;e++){const t=new ci;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e]
;t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),
t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){
const i=e[r]?e[r].matrixWorld:zc;Bc.multiplyMatrices(i,t[r]),Bc.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Gc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),
e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Uc(t,e,e,Ge,Oe);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t]
;if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r]
;void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Fc),this.bones.push(i),this.boneInverses.push((new ci).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",
generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}
class Vc extends ca{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON()
;return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Hc=new ci,jc=new ci,Wc=[],$c=new Pr,qc=new ci,Xc=new ja,Yc=new ei;class Kc extends ja{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,
this.instanceMatrix=new Vc(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,qc)}computeBoundingBox(){
const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Pr),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Hc),$c.copy(e.boundingBox).applyMatrix4(Hc),
this.boundingBox.union($c)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new ei),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty()
;for(let n=0;n<t;n++)this.getMatrixAt(n,Hc),Yc.copy(e.boundingSphere).applyMatrix4(Hc),this.boundingSphere.union(Yc)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),
null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){
t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[i+e]}
raycast(e,t){const n=this.matrixWorld,r=this.count;if(Xc.geometry=this.geometry,Xc.material=this.material,void 0!==Xc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Yc.copy(this.boundingSphere),Yc.applyMatrix4(n),
!1!==e.ray.intersectsSphere(Yc)))for(let i=0;i<r;i++){this.getMatrixAt(i,Hc),jc.multiplyMatrices(n,Hc),Xc.matrixWorld=jc,Xc.raycast(e,Wc);for(let e=0,n=Wc.length;e<n;e++){const n=Wc[e];n.instanceId=i,n.object=this,t.push(n)}Wc.length=0}}
setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Vc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){
const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new Uc(new Float32Array(r*this.count),r,this.count,$e,Oe));const i=this.morphTexture.source.data.data;let a=0;for(let e=0;e<n.length;e++)a+=n[e]
;const s=this.geometry.morphTargetsRelative?1:1-a,o=r*e;i[o]=s,i.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Jc(e,t){return e.z-t.z}function Zc(e,t){return t.z-e.z}
const Qc="batchId",eu=new ci,tu=new ci,nu=new ci,ru=new ci,iu=new ps,au=new Pr,su=new ei,ou=new Dr,lu=new class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,
count:-1,z:-1});const i=n[this.index];r.push(i),this.index++,i.start=e.start,i.count=e.count,i.z=t}reset(){this.list.length=0,this.index=0}},cu=new ja,uu=[];function hu(e,t,n=0){const r=t.itemSize
;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const i=e.count;for(let a=0;a<i;a++)for(let i=0;i<r;i++)t.setComponent(a+n,i,e.getComponent(a,i))}else t.array.set(e.array,n*r);t.needsUpdate=!0}class du extends ja{
get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=2*t,r){super(new Aa,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,
this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,
this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount)
;e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Uc(t,e,e,Ge,Oe);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,i=this._maxIndexCount
;if(!1===this._geometryInitialized){for(const r in e.attributes){const i=e.getAttribute(r),{array:a,itemSize:s,normalized:o}=i,l=new a.constructor(n*s),c=new i.constructor(l,s,o);c.setUsage(i.usage),t.setAttribute(r,c)}if(null!==e.getIndex()){
const e=n>65536?new Uint32Array(i):new Uint16Array(i);t.setIndex(new ca(e,1))}const a=r>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(Qc,new ca(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){
if(e.getAttribute(Qc))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Qc}"`);const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".')
;for(const n in t.attributes){if(n===Qc)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n)
;if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){
null===this.boundingBox&&(this.boundingBox=new Pr);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)!1!==n[r]&&(this.getMatrixAt(r,eu),this.getBoundingBoxAt(r,au).applyMatrix4(eu),t.union(au))}
computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ei);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)!1!==n[r]&&(this.getMatrixAt(r,eu),
this.getBoundingSphereAt(r,su).applyMatrix4(eu),t.union(su))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.")
;const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let i=null;const a=this._reservedRanges,s=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(i=a[a.length-1]),r.vertexCount=-1===t?e.getAttribute("position").count:t,
r.vertexStart=null===i?0:i.vertexStart+i.vertexCount;const l=e.getIndex(),c=null!==l;if(c&&(r.indexCount=-1===n?l.count:n,r.indexStart=null===i?0:i.indexStart+i.indexCount),
-1!==r.indexStart&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.")
;const u=this._visibility,h=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;u.push(!0),h.push(!0);const f=this._geometryCount;this._geometryCount++,nu.toArray(p,16*f),d.needsUpdate=!0,a.push(r),s.push({
start:c?r.indexStart:r.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new Pr,sphereInitialized:!1,sphere:new ei});const m=this.geometry.getAttribute(Qc);for(let e=0;e<r.vertexCount;e++)m.setX(r.vertexStart+e,f);return m.needsUpdate=!0,
this.setGeometryAt(f,e),f}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t)
;const n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),a=t.getIndex(),s=this._reservedRanges[e]
;if(r&&a.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=s.vertexStart,l=s.vertexCount;for(const e in n.attributes){if(e===Qc)continue
;const r=t.getAttribute(e),i=n.getAttribute(e);hu(r,i,o);const a=r.itemSize;for(let e=r.count,t=l;e<t;e++){const t=o+e;for(let e=0;e<a;e++)i.setComponent(t,e,0)}i.needsUpdate=!0}if(r){const e=s.indexStart
;for(let t=0;t<a.count;t++)i.setX(e+t,o+a.getX(t));for(let t=a.count,n=s.indexCount;t<n;t++)i.setX(e+t,o);i.needsUpdate=!0}const c=this._bounds[e];null!==t.boundingBox?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,
null!==t.boundingSphere?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const u=this._drawRanges[e],h=t.getAttribute("position");return u.count=r?a.count:h.count,this._visibilityChanged=!0,e}deleteGeometry(e){
const t=this._active;return e>=t.length||!1===t[e]||(t[e]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(e,t){if(!1===this._active[e])return null;const n=this._bounds[e],r=n.box,i=this.geometry;if(!1===n.boxInitialized){r.makeEmpty()
;const t=i.index,a=i.attributes.position,s=this._drawRanges[e];for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),r.expandByPoint(ou.fromBufferAttribute(a,n))}n.boxInitialized=!0}return t.copy(r),t}getBoundingSphereAt(e,t){
if(!1===this._active[e])return null;const n=this._bounds[e],r=n.sphere,i=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(e,au),au.getCenter(r.center);const t=i.index,a=i.attributes.position,s=this._drawRanges[e];let o=0
;for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),ou.fromBufferAttribute(a,n),o=Math.max(o,r.center.distanceToSquared(ou))}r.radius=Math.sqrt(o),n.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){
const n=this._active,r=this._matricesTexture,i=this._matricesTexture.image.data;return e>=this._geometryCount||!1===n[e]||(t.toArray(i,16*e),r.needsUpdate=!0),this}getMatrixAt(e,t){const n=this._active,r=this._matricesTexture.image.data
;return e>=this._geometryCount||!1===n[e]?null:t.fromArray(r,16*e)}setVisibleAt(e,t){const n=this._visibility,r=this._active;return e>=this._geometryCount||!1===r[e]||n[e]===t||(n[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){
const t=this._visibility,n=this._active;return!(e>=this._geometryCount||!1===n[e])&&t[e]}raycast(e,t){const n=this._visibility,r=this._active,i=this._drawRanges,a=this._geometryCount,s=this.matrixWorld,o=this.geometry;cu.material=this.material,
cu.geometry.index=o.index,cu.geometry.attributes=o.attributes,null===cu.geometry.boundingBox&&(cu.geometry.boundingBox=new Pr),null===cu.geometry.boundingSphere&&(cu.geometry.boundingSphere=new ei);for(let o=0;o<a;o++){if(!n[o]||!r[o])continue
;const a=i[o];cu.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(o,cu.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,cu.geometry.boundingBox),this.getBoundingSphereAt(o,cu.geometry.boundingSphere),cu.raycast(e,uu)
;for(let e=0,n=uu.length;e<n;e++){const n=uu[e];n.object=this,n.batchId=o,t.push(n)}uu.length=0}cu.material=null,cu.geometry.index=null,cu.geometry.attributes={},cu.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),
this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,
this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map((e=>({...e}))),this._reservedRanges=e._reservedRanges.map((e=>({...e}))),this._visibility=e._visibility.slice(),
this._active=e._active.slice(),this._bounds=e._bounds.map((e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()}))),this._maxGeometryCount=e._maxGeometryCount,
this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),
this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),
this._matricesTexture=null,this}onBeforeRender(e,t,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return
;const a=r.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._active,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled
;d&&(ru.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),iu.setFromProjectionMatrix(ru,e.coordinateSystem));let p=0;if(this.sortObjects){tu.copy(this.matrixWorld).invert(),
ou.setFromMatrixPosition(n.matrixWorld).applyMatrix4(tu);for(let e=0,t=l.length;e<t;e++)if(l[e]&&o[e]){this.getMatrixAt(e,eu),this.getBoundingSphereAt(e,su).applyMatrix4(eu);let t=!1;if(d&&(t=!iu.intersectsSphere(su)),!t){
const t=ou.distanceTo(su.center);lu.push(h[e],t)}}const e=lu.list,t=this.customSort;null===t?e.sort(i.transparent?Zc:Jc):t.call(this,e,n);for(let t=0,n=e.length;t<n;t++){const n=e[t];c[p]=n.start*s,u[p]=n.count,p++}lu.reset()
}else for(let e=0,t=l.length;e<t;e++)if(l[e]&&o[e]){let t=!1;if(d&&(this.getMatrixAt(e,eu),this.getBoundingSphereAt(e,su).applyMatrix4(eu),t=!iu.intersectsSphere(su)),!t){const t=h[e];c[p]=t.start*s,u[p]=t.count,p++}}this._multiDrawCount=p,
this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,i,a){this.onBeforeRender(e,null,r,i,a)}}class pu extends ta{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Zi(16777215),this.map=null,this.linewidth=1,
this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}
const fu=new Dr,mu=new Dr,gu=new ci,_u=new li,vu=new ei;class yu extends Pi{constructor(e=new Aa,t=new pu){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),
this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0]
;for(let e=1,r=t.count;e<r;e++)fu.fromBufferAttribute(t,e-1),mu.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=fu.distanceTo(mu);e.setAttribute("lineDistance",new va(n,1))
}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange
;if(null===n.boundingSphere&&n.computeBoundingSphere(),vu.copy(n.boundingSphere),vu.applyMatrix4(r),vu.radius+=i,!1===e.ray.intersectsSphere(vu))return;gu.copy(r).invert(),_u.copy(e.ray).applyMatrix4(gu)
;const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new Dr,c=new Dr,u=new Dr,h=new Dr,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p)for(let n=Math.max(0,a.start),r=Math.min(p.count,a.start+a.count)-1;n<r;n+=d){
const r=p.getX(n),i=p.getX(n+1);if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,i),_u.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(h);a<e.near||a>e.far||t.push({distance:a,
point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,a.start),r=Math.min(f.count,a.start+a.count)-1;n<r;n+=d){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),
_u.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}
updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e)
;this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const bu=new Dr,xu=new Dr;class Eu extends yu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry
;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)bu.fromBufferAttribute(t,e),xu.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+bu.distanceTo(xu);e.setAttribute("lineDistance",new va(n,1))
}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wu extends yu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Su extends ta{
constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Zi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),
this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Tu=new ci,Au=new li,Cu=new ei,Mu=new Dr;class Iu extends Pi{constructor(e=new Aa,t=new Su){super(),
this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){
const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cu.copy(n.boundingSphere),Cu.applyMatrix4(r),Cu.radius+=i,!1===e.ray.intersectsSphere(Cu))return
;Tu.copy(r).invert(),Au.copy(e.ray).applyMatrix4(Tu);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++){
const i=l.getX(n);Mu.fromBufferAttribute(c,i),Ru(Mu,i,o,r,e,t,this)}else for(let n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);n<i;n++)Mu.fromBufferAttribute(c,n),Ru(Mu,n,o,r,e,t,this)}updateMorphTargets(){
const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e)
;this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Ru(e,t,n,r,i,a,s){const o=Au.distanceSqToPoint(e);if(o<n){const n=new Dr;Au.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n)
;if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:s})}}class ku extends Sr{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:Se,
this.magFilter=void 0!==i?i:Se,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){
return new this.constructor(this.image).copy(this)}update(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Nu extends Sr{constructor(e,t){super({width:e,height:t}),
this.isFramebufferTexture=!0,this.magFilter=ye,this.minFilter=ye,this.generateMipmaps=!1,this.needsUpdate=!0}}class Du extends Sr{constructor(e,t,n,r,i,a,s,o,l,c,u,h){super(null,a,s,o,l,c,r,i,u,h),this.isCompressedTexture=!0,this.image={width:t,
height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Lu extends Du{constructor(e,t,n,r,i,a){super(e,t,n,i,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=_e}}class Ou extends Du{constructor(e,t,n){
super(void 0,e[0].width,e[0].height,t,n,he),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Pu extends Sr{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Fu{
constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[]
;for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){
if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n
;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let s,o=0,l=i-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),s=n[r]-a,
s<0)o=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===a)return r/(i-1);const c=n[r];return(r+(a-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1)
;const a=this.getPoint(r),s=this.getPoint(i),o=t||(a.isVector2?new tr:new Dr);return o.copy(s).sub(a).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){
const n=new Dr,r=[],i=[],a=[],s=new Dr,o=new ci;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Dr)}i[0]=new Dr,a[0]=new Dr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),
u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),a[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(r[t-1],r[t]),
s.length()>Number.EPSILON){s.normalize();const e=Math.acos(qn(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(qn(i[0].dot(i[e]),-1,1));t/=e,
r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){
return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){
return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Uu extends Fu{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,
this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t=new tr){const n=t,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),
!0!==this.aClockwise||a||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){
const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,
this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,
e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,
this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Bu extends Uu{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function zu(){
let e=0,t=0,n=0,r=0;function i(i,a,s,o){e=i,t=s,n=-3*i+3*a-2*s-o,r=2*i-2*a+s+o}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,s,o){
let l=(t-e)/a-(n-e)/(a+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+o)+(r-n)/o;l*=s,c*=s,i(t,n,l,c)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}const Gu=new Dr,Vu=new zu,Hu=new zu,ju=new zu;class Wu extends Fu{
constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Dr){const n=t,r=this.points,i=r.length,a=(i-(this.closed?0:1))*e
;let s,o,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?s=r[(l-1)%i]:(Gu.subVectors(r[0],r[1]).add(r[0]),s=Gu);const u=r[l%i],h=r[(l+1)%i]
;if(this.closed||l+2<i?o=r[(l+2)%i]:(Gu.subVectors(r[i-1],r[i-2]).add(r[i-1]),o=Gu),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25
;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Vu.initNonuniformCatmullRom(s.x,u.x,h.x,o.x,t,n,r),
Hu.initNonuniformCatmullRom(s.y,u.y,h.y,o.y,t,n,r),ju.initNonuniformCatmullRom(s.z,u.z,h.z,o.z,t,n,r)}else"catmullrom"===this.curveType&&(Vu.initCatmullRom(s.x,u.x,h.x,o.x,this.tension),Hu.initCatmullRom(s.y,u.y,h.y,o.y,this.tension),
ju.initCatmullRom(s.z,u.z,h.z,o.z,this.tension));return n.set(Vu.calc(c),Hu.calc(c),ju.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,
this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,
e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Dr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,
this}}function $u(e,t,n,r,i){const a=.5*(r-t),s=.5*(i-n),o=e*e;return(2*n-2*r+a+s)*(e*o)+(-3*n+3*r-2*a-s)*o+a*e+n}function qu(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){
return e*e*t}(e,r)}function Xu(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class Yu extends Fu{
constructor(e=new tr,t=new tr,n=new tr,r=new tr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new tr){const n=t,r=this.v0,i=this.v1,a=this.v2,s=this.v3
;return n.set(Xu(e,r.x,i.x,a.x,s.x),Xu(e,r.y,i.y,a.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),
e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ku extends Fu{
constructor(e=new Dr,t=new Dr,n=new Dr,r=new Dr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Dr){const n=t,r=this.v0,i=this.v1,a=this.v2,s=this.v3
;return n.set(Xu(e,r.x,i.x,a.x,s.x),Xu(e,r.y,i.y,a.y,s.y),Xu(e,r.z,i.z,a.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON()
;return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}
class Ju extends Fu{constructor(e=new tr,t=new tr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new tr){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}
getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new tr){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){
const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Zu extends Fu{constructor(e=new Dr,t=new Dr){super(),this.isLineCurve3=!0,
this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Dr){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Dr){
return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),
e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qu extends Fu{constructor(e=new tr,t=new tr,n=new tr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",
this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new tr){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(qu(e,r.x,i.x,a.x),qu(e,r.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){
const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eh extends Fu{
constructor(e=new Dr,t=new Dr,n=new Dr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Dr){const n=t,r=this.v0,i=this.v1,a=this.v2
;return n.set(qu(e,r.x,i.x,a.x),qu(e,r.y,i.y,a.y),qu(e,r.z,i.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),
e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class th extends Fu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}
getPoint(e,t=new tr){const n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),s=i-a,o=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set($u(s,o.x,l.x,c.x,u.x),$u(s,o.y,l.y,c.y,u.y)),n}copy(e){
super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t]
;e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new tr).fromArray(n))}return this}}var nh=Object.freeze({__proto__:null,ArcCurve:Bu,
CatmullRomCurve3:Wu,CubicBezierCurve:Yu,CubicBezierCurve3:Ku,EllipseCurve:Uu,LineCurve:Ju,LineCurve3:Zu,QuadraticBezierCurve:Qu,QuadraticBezierCurve3:eh,SplineCurve:th});class rh extends Fu{constructor(){super(),this.type="CurvePath",this.curves=[],
this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new nh[n](t,e))}
return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,a=this.curves[i],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}i++}return null}getLength(){
const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths
;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}
getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const a=i[r],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){const r=o[e]
;n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}
return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),
this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new nh[n.type]).fromJSON(n))}return this}}class ih extends rh{constructor(e){super(),this.type="Path",this.currentPoint=new tr,
e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){
const n=new Ju(this.currentPoint.clone(),new tr(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Qu(this.currentPoint.clone(),new tr(e,t),new tr(n,r));return this.curves.push(i),
this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){const s=new Yu(this.currentPoint.clone(),new tr(e,t),new tr(n,r),new tr(i,a));return this.curves.push(s),this.currentPoint.set(i,a),this}splineThru(e){
const t=[this.currentPoint.clone()].concat(e),n=new th(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){const s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,n,r,i,a),this}
absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,s,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,s,o),this}absellipse(e,t,n,r,i,a,s,o){const l=new Uu(e,t,n,r,i,a,s,o)
;if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this
}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ah extends Aa{
constructor(e=[new tr(0,-.5),new tr(.5,0),new tr(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=qn(r,0,2*Math.PI)
;const i=[],a=[],s=[],o=[],l=[],c=1/t,u=new Dr,h=new tr,d=new Dr,p=new Dr,f=new Dr;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break
;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let i=0;i<=t;i++){
const d=n+i*c*r,p=Math.sin(d),f=Math.cos(d);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*p,u.y=e[n].y,u.z=e[n].x*f,a.push(u.x,u.y,u.z),h.x=i/t,h.y=n/(e.length-1),s.push(h.x,h.y);const r=o[3*n+0]*p,c=o[3*n+1],d=o[3*n+0]*f;l.push(r,c,d)}}
for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,a=r,s=r+e.length,o=r+e.length+1,l=r+1;i.push(a,s,l),i.push(o,l,s)}this.setIndex(i),this.setAttribute("position",new va(a,3)),this.setAttribute("uv",new va(s,2)),
this.setAttribute("normal",new va(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ah(e.points,e.segments,e.phiStart,e.phiLength)}}class sh extends ah{constructor(e=1,t=1,n=4,r=8){
const i=new ih;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){
return new sh(e.radius,e.length,e.capSegments,e.radialSegments)}}class oh extends Aa{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t)
;const i=[],a=[],s=[],o=[],l=new Dr,c=new tr;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),a.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(a[u]/e+1)/2,c.y=(a[u+1]/e+1)/2,
o.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new va(a,3)),this.setAttribute("normal",new va(s,3)),this.setAttribute("uv",new va(o,2))}copy(e){return super.copy(e),
this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class lh extends Aa{constructor(e=1,t=1,n=1,r=32,i=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",
this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function _(n){
const i=p,a=new tr,f=new Dr;let _=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let e=0;e<=r;e++){const t=e/r*o+s,n=Math.cos(t),i=Math.sin(t);f.x=v*i,f.y=m*y,f.z=v*n,
u.push(f.x,f.y,f.z),h.push(0,y,0),a.x=.5*n+.5,a.y=.5*i*y+.5,d.push(a.x,a.y),p++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const a=new Dr,_=new Dr;let v=0
;const y=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,v=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+s,l=Math.sin(i),f=Math.cos(i);_.x=v*l,_.y=-g*n+m,_.z=v*f,u.push(_.x,_.y,_.z),a.set(l,y,f).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),
c.push(p++)}f.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],a=f[t][e+1];c.push(n,r,a),c.push(r,i,a),v+=6}l.addGroup(g,v,0),g+=v}(),!1===a&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),
this.setAttribute("position",new va(u,3)),this.setAttribute("normal",new va(h,3)),this.setAttribute("uv",new va(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){
return new lh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ch extends lh{constructor(e=1,t=1,n=32,r=1,i=!1,a=0,s=2*Math.PI){super(0,e,t,n,r,i,a,s),this.type="ConeGeometry",
this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:s}}static fromJSON(e){return new ch(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}
class uh extends Aa{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],a=[];function s(e,t,n,r){const i=r+1,a=[];for(let r=0;r<=i;r++){a[r]=[]
;const s=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)a[r][e]=0===e&&r===i?s:s.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(a[e][n+1]),o(a[e+1][n]),
o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}
function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Dr,r=new Dr,i=new Dr;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],r),l(t[a+2],i),s(n,r,i,e)}(r),function(e){const t=new Dr;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],
t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new Dr;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,s=(t=e,
Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);a.push(r,1-s)}var t;(function(){const e=new Dr,t=new Dr,n=new Dr,r=new Dr,s=new tr,o=new tr,l=new tr;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),
t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const p=u(r);c(s,d+0,e,p),c(o,d+2,t,p),c(l,d+4,n,p)}})(),function(){
for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new va(i,3)),
this.setAttribute("normal",new va(i.slice(),3)),this.setAttribute("uv",new va(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){
return new uh(e.vertices,e.indices,e.radius,e.details)}}class hh extends uh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n
;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),
this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hh(e.radius,e.detail)}}const dh=new Dr,ph=new Dr,fh=new Dr,mh=new qi;class gh extends Aa{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",
this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(jn*t),a=e.getIndex(),s=e.getAttribute("position"),o=a?a.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){
a?(l[0]=a.getX(e),l[1]=a.getX(e+1),l[2]=a.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=mh;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),o.fromBufferAttribute(s,l[2]),mh.getNormal(fh),
u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(o.x*r)},${Math.round(o.y*r)},${Math.round(o.z*r)}`,
u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],a=mh[c[e]],s=mh[c[t]],o=`${n}_${r}`,p=`${r}_${n}`;p in h&&h[p]?(fh.dot(h[p].normal)<=i&&(d.push(a.x,a.y,a.z),d.push(s.x,s.y,s.z)),h[p]=null):o in h||(h[o]={
index0:l[e],index1:l[t],normal:fh.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];dh.fromBufferAttribute(s,t),ph.fromBufferAttribute(s,n),d.push(dh.x,dh.y,dh.z),d.push(ph.x,ph.y,ph.z)}this.setAttribute("position",new va(d,3))}}
copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class _h extends ih{constructor(e){super(e),this.uuid=$n(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[]
;for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){
const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),
this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new ih).fromJSON(n))}return this}}function vh(e,t,n,r,i){let a,s;if(i===function(e,t,n,r){let i=0
;for(let a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)s=Bh(a,e[a],e[a+1],s);else for(a=n-r;a>=t;a-=r)s=Bh(a,e[a],e[a+1],s);return s&&Dh(s,s.next)&&(zh(s),s=s.next),s}function yh(e,t){if(!e)return e
;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Dh(r,r.next)&&0!==Nh(r.prev,r,r.next))r=r.next;else{if(zh(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function bh(e,t,n,r,i,a,s){if(!e)return;!s&&a&&function(e,t,n,r){let i=e;do{
0===i.z&&(i.z=Mh(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,a,s,o,l,c=1;do{for(n=e,e=null,a=null,s=0;n;){for(s++,r=n,o=0,t=0;t<c&&(o++,r=r.nextZ,r);t++);
for(l=c;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,a);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,
a?Eh(e,r,i,a):xh(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),zh(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?bh(e=wh(yh(e),t,n),t,n,r,i,a,2):2===s&&Sh(e,t,n,r,i,a):bh(yh(e),t,n,r,i,a,1);break}}function xh(e){const t=e.prev,n=e,r=e.next
;if(Nh(t,n,r)>=0)return!1;const i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,c=r.y,u=i<a?i<s?i:s:a<s?a:s,h=o<l?o<c?o:c:l<c?l:c,d=i>a?i>s?i:s:a>s?a:s,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==t;){
if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Rh(i,o,a,l,s,c,f.x,f.y)&&Nh(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Eh(e,t,n,r){const i=e.prev,a=e,s=e.next;if(Nh(i,a,s)>=0)return!1
;const o=i.x,l=a.x,c=s.x,u=i.y,h=a.y,d=s.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=Mh(p,f,t,n,r),v=Mh(m,g,t,n,r);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=_&&b&&b.z<=v;){
if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==s&&Rh(o,u,l,h,c,d,y.x,y.y)&&Nh(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&Rh(o,u,l,h,c,d,b.x,b.y)&&Nh(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=_;){
if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==s&&Rh(o,u,l,h,c,d,y.x,y.y)&&Nh(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&Rh(o,u,l,h,c,d,b.x,b.y)&&Nh(b.prev,b,b.next)>=0)return!1;b=b.nextZ}
return!0}function wh(e,t,n){let r=e;do{const i=r.prev,a=r.next.next;!Dh(i,a)&&Lh(i,r,r.next,a)&&Fh(i,a)&&Fh(a,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(a.i/n|0),zh(r),zh(r.next),r=e=a),r=r.next}while(r!==e);return yh(r)}function Sh(e,t,n,r,i,a){
let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&kh(s,e)){let o=Uh(s,e);return s=yh(s,s.next),o=yh(o,o.next),bh(s,t,n,r,i,a,0),void bh(o,t,n,r,i,a,0)}e=e.next}s=s.next}while(s!==e)}function Th(e,t){return e.x-t.x}function Ah(e,t){
const n=function(e,t){let n,r=t,i=-1/0;const a=e.x,s=e.y;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const e=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=a&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===a))return n}r=r.next}while(r!==t);if(!n)return null
;const o=n,l=n.x,c=n.y;let u,h=1/0;r=n;do{a>=r.x&&r.x>=l&&a!==r.x&&Rh(s<c?a:i,s,l,c,s<c?i:a,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(a-r.x),Fh(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Ch(n,r)))&&(n=r,h=u)),r=r.next}while(r!==o);return n}(e,t);if(!n)return t
;const r=Uh(n,e);return yh(r,r.next),yh(n,n.next)}function Ch(e,t){return Nh(e.prev,e,t.prev)<0&&Nh(t.next,e,e.next)<0}function Mh(e,t,n,r,i){
return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ih(e){let t=e,n=e;do{
(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rh(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function kh(e,t){
return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Lh(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Fh(e,t)&&Fh(t,e)&&function(e,t){let n=e,r=!1
;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r
}(e,t)&&(Nh(e.prev,e,t.prev)||Nh(e,t.prev,t))||Dh(e,t)&&Nh(e.prev,e,e.next)>0&&Nh(t.prev,t,t.next)>0)}function Nh(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Dh(e,t){return e.x===t.x&&e.y===t.y}function Lh(e,t,n,r){
const i=Ph(Nh(e,t,n)),a=Ph(Nh(e,t,r)),s=Ph(Nh(n,r,e)),o=Ph(Nh(n,r,t));return i!==a&&s!==o||!(0!==i||!Oh(e,n,t))||!(0!==a||!Oh(e,r,t))||!(0!==s||!Oh(n,e,r))||!(0!==o||!Oh(n,t,r))}function Oh(e,t,n){
return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ph(e){return e>0?1:e<0?-1:0}function Fh(e,t){
return Nh(e.prev,e,e.next)<0?Nh(e,t,e.next)>=0&&Nh(e,e.prev,t)>=0:Nh(e,t,e.prev)<0||Nh(e,e.next,t)<0}function Uh(e,t){const n=new Gh(e.i,e.x,e.y),r=new Gh(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,
a.next=r,r.prev=a,r}function Bh(e,t,n,r){const i=new Gh(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function zh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),
e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gh(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Vh{static area(e){const t=e.length;let n=0
;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Vh.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Hh(e),jh(n,e);let a=e.length;t.forEach(Hh);for(let e=0;e<t.length;e++)r.push(a),
a+=t[e].length,jh(n,t[e]);const s=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let a=vh(e,0,i,n,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,c,u,h,d,p;if(r&&(a=function(e,t,n,r){const i=[];let a,s,o,l,c;for(a=0,
s=t.length;a<s;a++)o=t[a]*r,l=a<s-1?t[a+1]*r:e.length,c=vh(e,o,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Ih(c));for(i.sort(Th),a=0;a<i.length;a++)n=Ah(i[a],n);return n}(e,t,a,n)),e.length>80*n){o=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],
h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=0!==p?32767/p:0}return bh(a,s,n,o,l,p,0),s}(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function Hh(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}
function jh(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Wh extends Aa{constructor(e=new _h([new tr(.5,.5),new tr(-.5,.5),new tr(-.5,-.5),new tr(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,
options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)a(e[t]);function a(e){const a=[],s=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1
;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3
;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:$h;let g,_,v,y,b,x=!1;f&&(g=f.getSpacedPoints(o),x=!0,c=!1,_=f.computeFrenetFrames(o,!1),v=new Dr,y=new Dr,b=new Dr),c||(p=0,u=0,h=0,d=0);const E=e.extractPoints(s);let w=E.shape
;const S=E.holes;if(!Vh.isClockWise(w)){w=w.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];Vh.isClockWise(t)&&(S[e]=t.reverse())}}const T=Vh.triangulateShape(w,S),A=w;for(let e=0,t=S.length;e<t;e++){const t=S[e];w=w.concat(t)}
function C(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const M=w.length,I=T.length;function R(e,t,n){let r,i,a;const s=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+o*o,h=s*c-o*l
;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-o/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-o*l);r=p+s*m-e.x,i=f+o*m-e.y;const g=r*r+i*i;if(g<=2)return new tr(r,i);a=Math.sqrt(g/2)}else{let e=!1
;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(r=-o,i=s,a=Math.sqrt(u)):(r=s,i=o,a=Math.sqrt(u/2))}return new tr(r/a,i/a)}const k=[]
;for(let e=0,t=A.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),k[e]=R(A[e],A[n],A[r]);const N=[];let D,L=k.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];D=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),
i===n&&(i=0),D[e]=R(t[e],t[r],t[i]);N.push(D),L=L.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=A.length;e<t;e++){const t=C(A[e],k[e],r);F(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){
const t=S[e];D=N[e];for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);F(i.x,i.y,-n)}}}const O=h+d;for(let e=0;e<M;e++){const t=c?C(w[e],L[e],O):w[e];x?(y.copy(_.normals[0]).multiplyScalar(t.x),v.copy(_.binormals[0]).multiplyScalar(t.y),
b.copy(g[0]).add(y).add(v),F(b.x,b.y,b.z)):F(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<M;t++){const n=c?C(w[t],L[t],O):w[t];x?(y.copy(_.normals[e]).multiplyScalar(n.x),v.copy(_.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(y).add(v),
F(b.x,b.y,b.z)):F(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=A.length;e<t;e++){const t=C(A[e],k[e],r);F(t.x,t.y,l+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];D=N[e]
;for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);x?F(i.x,i.y+g[o-1].y,g[o-1].x+n):F(i.x,i.y,l+n)}}}function P(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=M*e,a=M*(e+1)
;B(t+r+n,t+i+n,t+i+a,t+r+a)}}}function F(e,t,n){a.push(e),a.push(t),a.push(n)}function U(e,t,i){z(e),z(t),z(i);const a=r.length/3,s=m.generateTopUV(n,r,a-3,a-2,a-1);G(s[0]),G(s[1]),G(s[2])}function B(e,t,i,a){z(e),z(t),z(a),z(t),z(i),z(a)
;const s=r.length/3,o=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function z(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3
;if(c){let e=0,t=M*e;for(let e=0;e<I;e++){const n=T[e];U(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=M*e;for(let e=0;e<I;e++){const n=T[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<I;e++){const t=T[e];U(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=T[e]
;U(t[0]+M*o,t[1]+M*o,t[2]+M*o)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;P(A,t),t+=A.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];P(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}
this.setAttribute("position",new va(r,3)),this.setAttribute("uv",new va(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){
if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n
}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath
;return void 0!==r&&(e.options.extrudePath=(new nh[r.type]).fromJSON(r)),new Wh(n,e.options)}}const $h={generateTopUV:function(e,t,n,r,i){const a=t[3*n],s=t[3*n+1],o=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new tr(a,s),new tr(o,l),new tr(c,u)]},
generateSideWallUV:function(e,t,n,r,i,a){const s=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],g=t[3*a+1],_=t[3*a+2]
;return Math.abs(o-u)<Math.abs(s-c)?[new tr(s,1-l),new tr(c,1-h),new tr(d,1-f),new tr(m,1-_)]:[new tr(o,1-l),new tr(u,1-h),new tr(p,1-f),new tr(g,1-_)]}};class qh extends uh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2
;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),
this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qh(e.radius,e.detail)}}class Xh extends uh{constructor(e=1,t=0){
super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Xh(e.radius,e.detail)}}class Yh extends Aa{
constructor(e=.5,t=1,n=32,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);const s=[],o=[],l=[],c=[];let u=e
;const h=(t-e)/(r=Math.max(1,r)),d=new Dr,p=new tr;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*a;d.x=u*Math.cos(r),d.y=u*Math.sin(r),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}
for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,a=r+n+1,o=r+n+2,l=r+1;s.push(i,a,l),s.push(a,o,l)}}this.setIndex(s),this.setAttribute("position",new va(o,3)),this.setAttribute("normal",new va(l,3)),
this.setAttribute("uv",new va(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}
class Kh extends Aa{constructor(e=new _h([new tr(0,.5),new tr(-.5,-.5),new tr(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],a=[];let s=0,o=0
;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){const s=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Vh.isClockWise(c)&&(c=c.reverse())
;for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===Vh.isClockWise(t)&&(u[e]=t.reverse())}const h=Vh.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),
i.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+s,i=t[1]+s,a=t[2]+s;n.push(r,i,a),o+=3}}this.setIndex(n),this.setAttribute("position",new va(r,3)),this.setAttribute("normal",new va(i,3)),
this.setAttribute("uv",new va(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n]
;t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new Kh(n,e.curveSegments)}}class Jh extends Aa{
constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),
n=Math.max(2,Math.floor(n));const o=Math.min(a+s,Math.PI);let l=0;const c=[],u=new Dr,h=new Dr,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],_=d/n;let v=0;0===d&&0===a?v=.5/t:d===n&&o===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const o=n/t
;u.x=-e*Math.cos(r+o*i)*Math.sin(a+_*s),u.y=e*Math.cos(a+_*s),u.z=e*Math.sin(r+o*i)*Math.sin(a+_*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(o+v,1-_),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){
const t=c[e][r+1],i=c[e][r],s=c[e+1][r],l=c[e+1][r+1];(0!==e||a>0)&&d.push(t,i,l),(e!==n-1||o<Math.PI)&&d.push(i,s,l)}this.setIndex(d),this.setAttribute("position",new va(p,3)),this.setAttribute("normal",new va(f,3)),
this.setAttribute("uv",new va(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}
class Zh extends uh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Zh(e.radius,e.detail)}}
class Qh extends Aa{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r)
;const a=[],s=[],o=[],l=[],c=new Dr,u=new Dr,h=new Dr;for(let a=0;a<=n;a++)for(let d=0;d<=r;d++){const p=d/r*i,f=a/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),
c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(d/r),l.push(a/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,o=(r+1)*e+t;a.push(n,i,o),a.push(i,s,o)}
this.setIndex(a),this.setAttribute("position",new va(s,3)),this.setAttribute("normal",new va(o,3)),this.setAttribute("uv",new va(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){
return new Qh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class ed extends Aa{constructor(e=1,t=.4,n=64,r=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},
n=Math.floor(n),r=Math.floor(r);const s=[],o=[],l=[],c=[],u=new Dr,h=new Dr,d=new Dr,p=new Dr,f=new Dr,m=new Dr,g=new Dr;for(let s=0;s<=n;++s){const v=s/n*i*Math.PI*2;_(v,i,a,e,d),_(v+.01,i,a,e,p),m.subVectors(p,d),g.addVectors(p,d),
f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,a=-t*Math.cos(i),p=t*Math.sin(i);u.x=d.x+(a*g.x+p*f.x),u.y=d.y+(a*g.y+p*f.y),u.z=d.z+(a*g.z+p*f.z),o.push(u.x,u.y,u.z),
h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(s/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;s.push(n,i,o),s.push(i,a,o)}function _(e,t,n,r,i){
const a=Math.cos(e),s=Math.sin(e),o=n/t*e,l=Math.cos(o);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new va(o,3)),this.setAttribute("normal",new va(l,3)),this.setAttribute("uv",new va(c,2))}
copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ed(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class td extends Aa{
constructor(e=new eh(new Dr(-1,-1,0),new Dr(-1,1,0),new Dr(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i)
;this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const s=new Dr,o=new Dr,l=new tr;let c=new Dr;const u=[],h=[],d=[],p=[];function f(i){c=e.getPointAt(i/t,c);const l=a.normals[i],d=a.binormals[i];for(let e=0;e<=r;e++){
const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+i*d.x,o.y=a*l.y+i*d.y,o.z=a*l.z+i*d.z,o.normalize(),h.push(o.x,o.y,o.z),s.x=c.x+n*o.x,s.y=c.y+n*o.y,s.z=c.z+n*o.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),
function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,a,s)}}()}(),
this.setIndex(p),this.setAttribute("position",new va(u,3)),this.setAttribute("normal",new va(h,3)),this.setAttribute("uv",new va(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON()
;return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new td((new nh[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class nd extends Aa{constructor(e=null){if(super(),
this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new Dr,i=new Dr;if(null!==e.index){const a=e.attributes.position,s=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}])
;for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let o=0;o<3;o++){const l=s.getX(e+o),c=s.getX(e+(o+1)%3);r.fromBufferAttribute(a,l),i.fromBufferAttribute(a,c),!0===rd(r,i,n)&&(t.push(r.x,r.y,r.z),
t.push(i.x,i.y,i.z))}}}else{const a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let s=0;s<3;s++){const o=3*e+s,l=3*e+(s+1)%3;r.fromBufferAttribute(a,o),i.fromBufferAttribute(a,l),!0===rd(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))
}}this.setAttribute("position",new va(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function rd(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`
;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var id=Object.freeze({__proto__:null,BoxGeometry:$a,CapsuleGeometry:sh,CircleGeometry:oh,ConeGeometry:ch,CylinderGeometry:lh,DodecahedronGeometry:hh,EdgesGeometry:gh,ExtrudeGeometry:Wh,
IcosahedronGeometry:qh,LatheGeometry:ah,OctahedronGeometry:Xh,PlaneGeometry:gs,PolyhedronGeometry:uh,RingGeometry:Yh,ShapeGeometry:Kh,SphereGeometry:Jh,TetrahedronGeometry:Zh,TorusGeometry:Qh,TorusKnotGeometry:ed,TubeGeometry:td,WireframeGeometry:nd
});class ad extends ta{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Zi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}
class sd extends Ja{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class od extends ta{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",
this.color=new Zi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,
this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,
this.envMapRotation=new yi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={
STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,
this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,
this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,
this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,
this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ld extends od{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",
this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new tr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,
Object.defineProperty(this,"reflectivity",{get:function(){return qn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],
this.iridescenceThicknessMap=null,this.sheenColor=new Zi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,
this.attenuationColor=new Zi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Zi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,
this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}
get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){
return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,
this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,
this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,
this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,
this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,
this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class cd extends ta{
constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Zi(16777215),this.specular=new Zi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,
this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),this.displacementMap=null,this.displacementScale=1,
this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yi,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",
this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,
this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,
this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,
this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,
this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ud extends ta{constructor(e){super(),
this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Zi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),
this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,
this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,
this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,
this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,
this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}
class hd extends ta{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),this.displacementMap=null,
this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,
this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,
this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class dd extends ta{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Zi(16777215),this.map=null,this.lightMap=null,
this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),
this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yi,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,
this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,
this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,
this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,
this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,
this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pd extends ta{constructor(e){super(),
this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Zi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new tr(1,1),
this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,
this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,
this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fd extends pu{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,
this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function md(e,t,n){
return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function gd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _d(e){const t=e.length,n=new Array(t)
;for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function vd(e,t,n){const r=e.length,i=new e.constructor(r);for(let a=0,s=0;s!==r;++a){const r=n[a]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i}function yd(e,t,n,r){
let i=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[i++];if(void 0===a)return;let s=a[r];if(void 0!==s)if(Array.isArray(s))do{s=a[r],void 0!==s&&(t.push(a.time),n.push.apply(n,s)),a=e[i++]}while(void 0!==a);else if(void 0!==s.toArray)do{s=a[r],
void 0!==s&&(t.push(a.time),s.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{s=a[r],void 0!==s&&(t.push(a.time),n.push(s)),a=e[i++]}while(void 0!==a)}const bd={convertArray:md,isTypedArray:gd,getKeyframeOrder:_d,sortedArray:vd,
flattenJSON:yd,subclip:function(e,t,n,r,i=30){const a=e.clone();a.name=t;const s=[];for(let e=0;e<a.tracks.length;++e){const t=a.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const a=t.times[e]*i;if(!(a<n||a>=r)){
l.push(t.times[e]);for(let n=0;n<o;++n)c.push(t.values[e*o+n])}}0!==l.length&&(t.times=md(l,t.times.constructor),t.values=md(c,t.values.constructor),s.push(t))}a.tracks=s;let o=1/0
;for(let e=0;e<a.tracks.length;++e)o>a.tracks[e].times[0]&&(o=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30)
;const i=n.tracks.length,a=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let o=0
;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(a<=r.times[0]){
const e=o,t=l-o;d=r.values.slice(e,t)}else if(a>=r.times[h]){const e=h*l+o,t=e+l-o;d=r.values.slice(e,t)}else{const e=r.createInterpolant(),t=o,n=l-o;e.evaluate(a),d=e.resultBuffer.slice(t,n)}
"quaternion"===i&&(new Nr).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===i)Nr.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*c
;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=Bt,e}};class xd{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,
this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,
this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],
e>=i)break t}a=n,n=0}}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,
this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e]
;return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Ed extends xd{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={
endingStart:Ot,endingEnd:Ot}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,s=r[i],o=r[a];if(void 0===s)switch(this.getSettings_().endingStart){case Pt:i=e,s=2*t-n;break;case Ft:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,
s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Pt:a=e,o=2*n-t;break;case Ft:a=1,o=n+r[1]-r[0];break;default:a=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=i*c,
this._offsetNext=a*c}interpolate_(e,t,n,r){
const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f
;for(let e=0;e!==s;++e)i[e]=g*a[c+e]+_*a[l+e]+v*a[o+e]+y*a[u+e];return i}}class wd extends xd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(n-t)/(r-t),u=1-c
;for(let e=0;e!==s;++e)i[e]=a[l+e]*u+a[o+e]*c;return i}}class Sd extends xd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Td{constructor(e,t,n,r){
if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=md(t,this.TimeBufferType),
this.values=md(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:md(e.times,Array),values:md(e.values,Array)}
;const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Sd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){
return new wd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Ed(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Nt:t=this.InterpolantFactoryMethodDiscrete;break
;case Dt:t=this.InterpolantFactoryMethodLinear;break;case Lt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){
if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){
case this.InterpolantFactoryMethodDiscrete:return Nt;case this.InterpolantFactoryMethodLinear:return Dt;case this.InterpolantFactoryMethodSmooth:return Lt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){
const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i
;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize()
;t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null
;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,a),e=!1
;break}a=r}if(void 0!==r&&gd(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){
const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Lt,i=e.length-1;let a=1;for(let s=1;s<i;++s){let i=!1;const o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,a=e+n
;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[a+s]){i=!0;break}}}if(i){if(s!==a){e[a]=e[s];const r=s*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,s=0;s!==n;++s)t[r+s]=t[e+s];++a}
return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t)
;return n.createInterpolant=this.createInterpolant,n}}Td.prototype.TimeBufferType=Float32Array,Td.prototype.ValueBufferType=Float32Array,Td.prototype.DefaultInterpolation=Dt;class Ad extends Td{}Ad.prototype.ValueTypeName="bool",
Ad.prototype.ValueBufferType=Array,Ad.prototype.DefaultInterpolation=Nt,Ad.prototype.InterpolantFactoryMethodLinear=void 0,Ad.prototype.InterpolantFactoryMethodSmooth=void 0;class Cd extends Td{}Cd.prototype.ValueTypeName="color"
;class Md extends Td{}Md.prototype.ValueTypeName="number";class Id extends xd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(n-t)/(r-t);let l=e*s
;for(let e=l+s;l!==e;l+=4)Nr.slerpFlat(i,0,a,l-s,a,l,o);return i}}class Rd extends Td{InterpolantFactoryMethodLinear(e){return new Id(this.times,this.values,this.getValueSize(),e)}}Rd.prototype.ValueTypeName="quaternion",
Rd.prototype.DefaultInterpolation=Dt,Rd.prototype.InterpolantFactoryMethodSmooth=void 0;class kd extends Td{}kd.prototype.ValueTypeName="string",kd.prototype.ValueBufferType=Array,kd.prototype.DefaultInterpolation=Nt,
kd.prototype.InterpolantFactoryMethodLinear=void 0,kd.prototype.InterpolantFactoryMethodSmooth=void 0;class Nd extends Td{}Nd.prototype.ValueTypeName="vector";class Dd{constructor(e,t=-1,n,r=Ut){this.name=e,this.tracks=n,this.duration=t,
this.blendMode=r,this.uuid=$n(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Ld(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode)
;return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Td.toJSON(n[e]));return r}
static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,a=[];for(let e=0;e<i;e++){let s=[],o=[];s.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);const l=_d(s);s=vd(s,1,l),o=vd(o,1,l),r||0!==s[0]||(s.push(i),o.push(o[0])),
a.push(new Md(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}
for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],a=n.name.match(i);if(a&&a.length>1){const e=a[1]
;let t=r[e];t||(r[e]=t=[]),t.push(n)}}const a=[];for(const e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null
;const n=function(e,t,n,r,i){if(0!==n.length){const a=[],s=[];yd(n,a,s,r),0!==a.length&&i.push(new e(t,a,s))}},r=[],i=e.name||"default",a=e.fps||30,s=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys
;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],a=[]
;for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),a.push(r.morphTarget===n?1:0)}r.push(new Md(".morphTargetInfluence["+n+"]",e,a))}o=e.length*a}else{const a=".bones["+t[e].name+"]";n(Nd,a+".position",i,"pos",r),
n(Rd,a+".quaternion",i,"rot",r),n(Nd,a+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,o,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}
return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){
for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){
return this.constructor.toJSON(this)}}function Ld(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":
case"integer":return Md;case"vector":case"vector2":case"vector3":case"vector4":return Nd;case"color":return Cd;case"quaternion":return Rd;case"bool":case"boolean":return Ad;case"string":return kd}
throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];yd(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Od={
enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Pd{constructor(e,t,n){const r=this
;let i,a=!1,s=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===a&&void 0!==r.onStart&&r.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,
void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},
this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1]
;if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Fd=new Pd;class Ud{constructor(e){this.manager=void 0!==e?e:Fd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}
loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){
return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ud.DEFAULT_MATERIAL_NAME="__DEFAULT";const Bd={};class zd extends Error{constructor(e,t){super(e),this.response=t}}class Gd extends Ud{constructor(e){super(e)}
load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Od.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i
;if(void 0!==Bd[e])return void Bd[e].push({onLoad:t,onProgress:n,onError:r});Bd[e]=[],Bd[e].push({onLoad:t,onProgress:n,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),
credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),
"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Bd[e],r=t.body.getReader(),i=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=i?parseInt(i):0,s=0!==a;let o=0;const l=new ReadableStream({
start(e){!function t(){r.read().then((({done:r,value:i})=>{if(r)e.close();else{o+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:a});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}
e.enqueue(i),t()}}))}()}});return new Response(l)}throw new zd(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":
return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n)
;return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{Od.add(e,t);const n=Bd[e];delete Bd[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const n=Bd[e];if(void 0===n)throw this.manager.itemError(e),t
;delete Bd[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){
return this.mimeType=e,this}}class Vd extends Ud{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Gd(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){
try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Dd.parse(e[n]);t.push(r)}return t}}class Hd extends Ud{constructor(e){super(e)}load(e,t,n,r){
const i=this,a=[],s=new Du,o=new Gd(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials);let l=0;function c(c){o.load(e[c],(function(e){
const n=i.parse(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=Se),s.image=a,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}
if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else o.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]}
;for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}s.image=a}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps
;1===n.mipmapCount&&(s.minFilter=Se),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}}class jd extends Ud{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Od.get(e)
;if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const s=or("img");function o(){c(),Od.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),i.manager.itemError(e),
i.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),
"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class Wd extends Ud{constructor(e){super(e)}load(e,t,n,r){const i=new as;i.colorSpace=Xt;const a=new jd(this.manager)
;a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function o(n){a.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)o(t);return i}}class $d extends Ud{constructor(e){
super(e)}load(e,t,n,r){const i=this,a=new Uc,s=new Gd(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){let n;try{
n=i.parse(e)}catch(e){if(void 0===r)return void console.error(e);r(e)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:_e,
a.wrapT=void 0!==n.wrapT?n.wrapT:_e,a.magFilter=void 0!==n.magFilter?n.magFilter:Se,a.minFilter=void 0!==n.minFilter?n.minFilter:Se,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),
void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Ce),1===n.mipmapCount&&(a.minFilter=Se),
void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n)}),n,r),a}}class qd extends Ud{constructor(e){super(e)}load(e,t,n,r){const i=new Sr,a=new jd(this.manager);return a.setCrossOrigin(this.crossOrigin),
a.setPath(this.path),a.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class Xd extends Pi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Zi(e),this.intensity=t}dispose(){}copy(e,t){
return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,
void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),
void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class Yd extends Xd{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",
this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Zi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Kd=new ci,Jd=new Dr,Zd=new Dr;class Qd{constructor(e){this.camera=e,this.bias=0,
this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new tr(512,512),this.map=null,this.mapPass=null,this.matrix=new ci,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ps,this._frameExtents=new tr(1,1),this._viewportCount=1,
this._viewports=[new Tr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Jd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Jd),
Zd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Zd),t.updateMatrixWorld(),Kd.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kd),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Kd)}
getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,
this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),
512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ep extends Qd{constructor(){super(new ns(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}
updateMatrices(e){const t=this.camera,n=2*Wn*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){
return super.copy(e),this.focus=e.focus,this}}class tp extends Xd{constructor(e,t,n=0,r=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.target=new Pi,this.distance=n,
this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new ep}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,
this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const np=new ci,rp=new Dr,ip=new Dr;class ap extends Qd{constructor(){super(new ns(90,1,.5,500)),
this.isPointLightShadow=!0,this._frameExtents=new tr(4,2),this._viewportCount=6,this._viewports=[new Tr(2,1,1,1),new Tr(0,1,1,1),new Tr(3,1,1,1),new Tr(1,1,1,1),new Tr(3,0,1,1),new Tr(1,0,1,1)],
this._cubeDirections=[new Dr(1,0,0),new Dr(-1,0,0),new Dr(0,0,1),new Dr(0,0,-1),new Dr(0,1,0),new Dr(0,-1,0)],this._cubeUps=[new Dr(0,1,0),new Dr(0,1,0),new Dr(0,1,0),new Dr(0,1,0),new Dr(0,0,1),new Dr(0,0,-1)]}updateMatrices(e,t=0){
const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),rp.setFromMatrixPosition(e.matrixWorld),n.position.copy(rp),ip.copy(n.position),ip.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),
n.lookAt(ip),n.updateMatrixWorld(),r.makeTranslation(-rp.x,-rp.y,-rp.z),np.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(np)}}class sp extends Xd{constructor(e,t,n=0,r=2){super(e,t),
this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ap}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),
this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class op extends Qd{constructor(){super(new Is(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class lp extends Xd{constructor(e,t){super(e,t),
this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.target=new Pi,this.shadow=new op}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),
this.shadow=e.shadow.clone(),this}}class cp extends Xd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class up extends Xd{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",
this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){
const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class hp{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Dr)}set(e){
for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),
t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),
t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),
t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),
t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){
for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1
;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients
;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,
t[8]=.546274*(n*n-r*r)}}class dp extends Xd{constructor(e=new hp,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}
toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class pp extends Ud{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,a=new Gd(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),
a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){
return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=pp.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),
void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),
void 0!==e.sheenColor&&(r.sheenColor=(new Zi).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),
void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),
void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),
void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),
void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),
void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),
void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),
void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),
void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),
void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),
void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),
void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),
void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),
void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),
void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),
void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),
void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),
void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),
void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t]
;switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Zi).setHex(i.value);break;case"v2":r.uniforms[t].value=(new tr).fromArray(i.value);break;case"v3":
r.uniforms[t].value=(new Dr).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new Tr).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new nr).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new ci).fromArray(i.value);break
;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),
void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),
void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),
void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale
;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new tr).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),
void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),
void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),
void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),
void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),
void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),
void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),
void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new tr).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),
void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),
void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}
static createMaterialFromType(e){return new{ShadowMaterial:ad,SpriteMaterial:lc,RawShaderMaterial:sd,ShaderMaterial:Ja,PointsMaterial:Su,MeshPhysicalMaterial:ld,MeshStandardMaterial:od,MeshPhongMaterial:cd,MeshToonMaterial:ud,MeshNormalMaterial:hd,
MeshLambertMaterial:dd,MeshDepthMaterial:Ul,MeshDistanceMaterial:Bl,MeshBasicMaterial:na,MeshMatcapMaterial:pd,LineDashedMaterial:fd,LineBasicMaterial:pu,Material:ta}[e]}}class fp{static decodeText(e){
if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/")
;return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),
/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class mp extends Aa{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),
this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class gp extends Ud{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Gd(i.manager)
;a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={}
;function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=sr(i.type,a),o=new ac(s,i.stride)
;return o.uuid=i.uuid,t[r]=o,o}const i=e.isInstancedBufferGeometry?new mp:new Aa,a=e.data.index;if(void 0!==a){const e=sr(a.type,a.array);i.setIndex(new ca(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let a
;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);a=new oc(t,n.itemSize,n.offset,n.normalized)}else{const e=sr(n.type,n.array);a=new(n.isInstancedBufferAttribute?Vc:ca)(e,n.itemSize,n.normalized)}void 0!==n.name&&(a.name=n.name),
void 0!==n.usage&&a.setUsage(n.usage),i.setAttribute(t,a)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],a=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data)
;s=new oc(t,i.itemSize,i.offset,i.normalized)}else{const e=sr(i.type,i.array);s=new ca(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),a.push(s)}i.morphAttributes[t]=a}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0)
;const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Dr
;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new ei(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class _p extends Ud{constructor(e){super(e)}load(e,t,n,r){
const i=this,a=""===this.path?fp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const s=new Gd(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),
s.load(e,(function(n){let a=null;try{a=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const s=a.metadata
;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(a,t)}),n,r)}async loadAsync(e,t){
const n=""===this.path?fp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Gd(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials)
;const i=await r.loadAsync(e,t),a=JSON.parse(i),s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(a)}parse(e,t){
const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)
})),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,o,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1
;for(const t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){
const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,r,s,a,t),l=this.parseSkeletons(e.skeletons,o)
;return this.bindSkeletons(o,l),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new _h).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),
void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Gc).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new gp;for(let i=0,a=e.length;i<a;i++){let a;const s=e[i];switch(s.type){case"BufferGeometry":
case"InstancedBufferGeometry":a=r.parse(s);break;default:s.type in id?a=id[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),
void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new pp;i.setTextures(t);for(let t=0,a=e.length;t<a;t++){const a=e[t];void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),
r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Dd.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function a(e){if("string"==typeof e){const t=e
;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{
data:sr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Pd(t);i=new jd(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[]
;for(let t=0,n=i.length;t<n;t++){const n=a(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Uc(n.data,n.width,n.height)))}r[n.uuid]=new xr(e)}else{const e=a(n.url);r[n.uuid]=new xr(e)}}}return r}async parseImagesAsync(e){
const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:sr(e.type,e.data),width:e.width,height:e.height}:null}
if(void 0!==e&&e.length>0){r=new jd(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],a=r.url;if(Array.isArray(a)){const e=[];for(let t=0,n=a.length;t<n;t++){const n=a[t],r=await i(n)
;null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Uc(r.data,r.width,r.height)))}n[r.uuid]=new xr(e)}else{const e=await i(r.url);n[r.uuid]=new xr(e)}}}return n}parseTextures(e,t){function n(e,t){
return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,a=e.length;i<a;i++){const a=e[i]
;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const s=t[a.image],o=s.data;let l;Array.isArray(o)?(l=new as,
6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new Uc:new Sr,o&&(l.needsUpdate=!0)),l.source=s,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=n(a.mapping,vp)),void 0!==a.channel&&(l.channel=a.channel),
void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=n(a.wrap[0],yp),
l.wrapT=n(a.wrap[1],yp)),void 0!==a.format&&(l.format=a.format),void 0!==a.internalFormat&&(l.internalFormat=a.internalFormat),void 0!==a.type&&(l.type=a.type),void 0!==a.colorSpace&&(l.colorSpace=a.colorSpace),
void 0!==a.minFilter&&(l.minFilter=n(a.minFilter,bp)),void 0!==a.magFilter&&(l.magFilter=n(a.magFilter,bp)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),
void 0!==a.generateMipmaps&&(l.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),
void 0!==a.compareFunction&&(l.compareFunction=a.compareFunction),void 0!==a.userData&&(l.userData=a.userData),r[a.uuid]=l}return r}parseObject(e,t,n,r,i){let a,s,o;function l(e){
return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r]
;void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){
return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new ic,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new Zi(e.background):a.background=u(e.background)),
void 0!==e.environment&&(a.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new rc(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new nc(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),
void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),
void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new ns(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),
void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Is(e.left,e.right,e.top,e.bottom,e.near,e.far),
void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new cp(e.color,e.intensity);break;case"DirectionalLight":a=new lp(e.color,e.intensity);break;case"PointLight":
a=new sp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new up(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new tp(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":
a=new Yd(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new dp).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),o=c(e.material),a=new Pc(s,o),void 0!==e.bindMode&&(a.bindMode=e.bindMode),
void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),o=c(e.material),a=new ja(s,o);break;case"InstancedMesh":s=l(e.geometry),o=c(e.material)
;const t=e.count,n=e.instanceMatrix,r=e.instanceColor;a=new Kc(s,o,t),a.instanceMatrix=new Vc(new Float32Array(n.array),16),void 0!==r&&(a.instanceColor=new Vc(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":s=l(e.geometry),
o=c(e.material),a=new du(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,o),a.geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,
a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map((e=>{const t=new Pr;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const n=new ei;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{
boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}})),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,
a._geometryCount=e.geometryCount,a._matricesTexture=u(e.matricesTexture.uuid);break;case"LOD":a=new Ac;break;case"Line":a=new yu(l(e.geometry),c(e.material));break;case"LineLoop":a=new wu(l(e.geometry),c(e.material));break;case"LineSegments":
a=new Eu(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new Iu(l(e.geometry),c(e.material));break;case"Sprite":a=new Ec(c(e.material));break;case"Group":a=new Wl;break;case"Bone":a=new Fc;break;default:a=new Pi}if(a.uuid=e.uuid,
void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),
a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),
void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),
e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),
void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),
void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){const s=e.children
;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];a.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate)
;const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){
if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}const vp={UVMapping:ue,CubeReflectionMapping:he,
CubeRefractionMapping:de,EquirectangularReflectionMapping:pe,EquirectangularRefractionMapping:fe,CubeUVReflectionMapping:me},yp={RepeatWrapping:ge,ClampToEdgeWrapping:_e,MirroredRepeatWrapping:ve},bp={NearestFilter:ye,NearestMipmapNearestFilter:be,
NearestMipmapLinearFilter:Ee,LinearFilter:Se,LinearMipmapNearestFilter:Te,LinearMipmapLinearFilter:Ce};class xp extends Ud{constructor(e){super(e),this.isImageBitmapLoader=!0,
"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}
setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Od.get(e);if(void 0!==a)return i.manager.itemStart(e),a.then?void a.then((n=>{t&&t(n),
i.manager.itemEnd(e)})).catch((e=>{r&&r(e)})):(setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader
;const o=fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){return Od.add(e,n),t&&t(n),i.manager.itemEnd(e),n
})).catch((function(t){r&&r(t),Od.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)}));Od.add(e,o),i.manager.itemStart(e)}}let Ep;class wp{static getContext(){return void 0===Ep&&(Ep=new(window.AudioContext||window.webkitAudioContext)),Ep}
static setContext(e){Ep=e}}class Sp extends Ud{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Gd(this.manager);function s(t){r?r(t):console.error(t),i.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),
a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){try{const n=e.slice(0);wp.getContext().decodeAudioData(n,(function(e){t(e)})).catch(s)}catch(e){s(e)}}),n,r)}}const Tp=new ci,Ap=new ci,Cp=new ci
;class Mp{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,
this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache
;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,
t.eyeSep=this.eyeSep,Cp.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(jn*t.fov*.5)/t.zoom;let a,s;Ap.elements[12]=-n,Tp.elements[12]=n,a=-i*t.aspect+r,s=i*t.aspect+r,Cp.elements[0]=2*t.near/(s-a),
Cp.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(Cp),a=-i*t.aspect-r,s=i*t.aspect-r,Cp.elements[0]=2*t.near/(s-a),Cp.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(Cp)}
this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ap),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Tp)}}class Ip{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){
this.startTime=Rp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0
;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Rp();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Rp(){return("undefined"==typeof performance?Date:performance).now()}
const kp=new Dr,Np=new Nr,Dp=new Dr,Lp=new Dr;class Op extends Pi{constructor(){super(),this.type="AudioListener",this.context=wp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,
this.timeDelta=0,this._clock=new Ip}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),
this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,
this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){
super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(kp,Np,Dp),Lp.set(0,0,-1).applyQuaternion(Np),t.positionX){const e=this.context.currentTime+this.timeDelta
;t.positionX.linearRampToValueAtTime(kp.x,e),t.positionY.linearRampToValueAtTime(kp.y,e),t.positionZ.linearRampToValueAtTime(kp.z,e),t.forwardX.linearRampToValueAtTime(Lp.x,e),t.forwardY.linearRampToValueAtTime(Lp.y,e),
t.forwardZ.linearRampToValueAtTime(Lp.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(kp.x,kp.y,kp.z),t.setOrientation(Lp.x,Lp.y,Lp.z,n.x,n.y,n.z)}}
class Pp extends Pi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,
this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){
return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",
this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){
return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.")
;if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,
t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),
this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,
!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){
if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){
this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput())
;return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e])
;this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),
this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){
return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,
!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1
}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this
;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){
return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Fp=new Dr,Up=new Nr,Bp=new Dr,zp=new Dr;class Gp extends Pp{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",
this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}
setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){
return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,
this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Fp,Up,Bp),zp.set(0,0,1).applyQuaternion(Up);const t=this.panner;if(t.positionX){
const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Fp.x,e),t.positionY.linearRampToValueAtTime(Fp.y,e),t.positionZ.linearRampToValueAtTime(Fp.z,e),t.orientationX.linearRampToValueAtTime(zp.x,e),
t.orientationY.linearRampToValueAtTime(zp.y,e),t.orientationZ.linearRampToValueAtTime(zp.z,e)}else t.setPosition(Fp.x,Fp.y,Fp.z),t.setOrientation(zp.x,zp.y,zp.z)}}class Vp{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),
this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0
;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Hp{constructor(e,t,n){let r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,
a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,
i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,
this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;const e=t/a
;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),
this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex
;this._mixBufferRegion(n,r,e,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}}saveOriginalState(){
const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){
const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){
this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}
_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){Nr.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const a=this._workIndex*i;Nr.multiplyQuaternionsFlat(e,a,e,t,e,n),Nr.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,n,r,i){
const a=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*a+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]+e[n+a]*r}}}
const jp="\\[\\]\\.:\\/",Wp=new RegExp("["+jp+"]","g"),$p="[^"+jp+"]",qp="[^"+jp.replace("\\.","")+"]",Xp=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",$p)+/(WCOD+)?/.source.replace("WCOD",qp)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$p)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$p)+"$"),Yp=["material","materials","bones","map"]
;class Kp{constructor(e,t,n){this.path=t,this.parsedPath=n||Kp.parseTrackName(t),this.node=Kp.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){
return e&&e.isAnimationObjectGroup?new Kp.Composite(e,t,n):new Kp(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Wp,"")}static parseTrackName(e){const t=Xp.exec(e)
;if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){
const e=n.nodeName.substring(r+1);-1!==Yp.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n
}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r]
;if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}
_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}
_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){
this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty
;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}
_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}
_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){
this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),
this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Kp.findNode(this.rootNode,t.nodeName),this.node=e),
this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":
if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this)
;if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":
if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}
if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this)
;if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:
if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){
if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName
;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,
void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){
if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this)
;if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}
o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,
this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}
Kp.Composite=class{constructor(e,t,n){const r=n||Kp.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}
setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){
const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Kp.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kp.prototype.Versioning={None:0,NeedsUpdate:1,
MatrixWorldNeedsUpdate:2},Kp.prototype.GetterByBindingType=[Kp.prototype._getValue_direct,Kp.prototype._getValue_array,Kp.prototype._getValue_arrayElement,Kp.prototype._getValue_toArray],
Kp.prototype.SetterByBindingTypeAndVersioning=[[Kp.prototype._setValue_direct,Kp.prototype._setValue_direct_setNeedsUpdate,Kp.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kp.prototype._setValue_array,Kp.prototype._setValue_array_setNeedsUpdate,Kp.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kp.prototype._setValue_arrayElement,Kp.prototype._setValue_arrayElement_setNeedsUpdate,Kp.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kp.prototype._setValue_fromArray,Kp.prototype._setValue_fromArray_setNeedsUpdate,Kp.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]]
;class Jp{constructor(){this.isAnimationObjectGroup=!0,this.uuid=$n(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t
;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){
return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length;let s,o=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){
const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(u);for(let e=0,t=a;e!==t;++e)i[e].push(new Kp(u,n[e],r[e]))}else if(d<l){s=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[h]=o,e[o]=u;for(let e=0,t=a;e!==t;++e){
const t=i[e],a=t[o];let s=t[d];t[d]=a,void 0===s&&(s=new Kp(u,n[e],r[e])),t[o]=s}
}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){
const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=i){const a=i++,c=e[a];t[c.uuid]=l,e[l]=c,t[o]=a,e[a]=s
;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[l];t[l]=r,t[a]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,a=e.length
;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<i){const s=--i,o=e[s],c=--a,u=e[c];t[o.uuid]=l,e[l]=o,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[c];t[l]=r,
t[s]=i,t.pop()}}else{const i=--a,s=e[i];i>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings
;if(void 0!==r)return i[r];const a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),s.push(t),i.push(u);for(let n=c,r=o.length;n!==r;++n){const r=o[n];u[n]=new Kp(r,e,t)}
return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=n,a[n]=o,a.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}class Zp{
constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,a=i.length,s=new Array(a),o={endingStart:Ot,endingEnd:Ot};for(let e=0;e!==a;++e){const t=i[e].createInterpolant(null);s[e]=t,
t.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Rt,this._loopCount=-1,
this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){
return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}
isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){
return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){
return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,a=n/r;e.warp(1,i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}
stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}
getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){
return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s)
;const o=s.parameterPositions,l=s.sampleValues;return o[0]=i,o[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}
getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n
;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const a=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings
;if(this.blendMode===Bt)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight
;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale
;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop
;let r=this.time+e,i=this._loopCount;const a=n===kt;if(0===e)return-1===i||!a||1&~i?r:t-r;if(n===It){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}
this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,
this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,
this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",
action:this,loopDelta:n})}}else this.time=r;if(a&&!(1&~i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Pt,r.endingEnd=Pt):(r.endingStart=e?this.zeroSlopeAtStart?Pt:Ot:Ft,
r.endingEnd=t?this.zeroSlopeAtEnd?Pt:Ot:Ft)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,o=a.sampleValues
;return s[0]=i,o[0]=t,s[1]=i+e,o[1]=n,this}}const Qp=new Float32Array(1);class ef extends Gn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){
const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,s=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l]
;if(void 0!==u)++u.referenceCount,a[e]=u;else{if(u=a[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,o,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath
;u=new Hp(Kp.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,o,l),a[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){
const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e]
;0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e]
;0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,
this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){
return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex
;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const t=a.knownActions
;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null
;const i=e._clip.uuid,a=this._actionsByClip,s=a[i],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete a[i],
this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){
const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i
}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){
const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,s=a[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[i],0===Object.keys(s).length&&delete a[r]}_lendBinding(e){
const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,
t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new wd(new Float32Array(2),new Float32Array(2),1,Qp),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){
const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let a="string"==typeof e?Dd.findByName(r,e):e
;const s=null!==a?a.uuid:e,o=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:Ut),void 0!==o){const e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null
;const c=new Zp(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Dd.findByName(n,e):e,a=i?i.uuid:e,s=this._actionsByClip[a]
;return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale
;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(r,e,i,a);const s=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)s[e].apply(a);return this}setTime(e){
this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions
;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=i,t[i]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}
uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){
const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class tf{constructor(e){this.value=e}clone(){
return new tf(void 0===this.value.clone?this.value:this.value.clone())}}let nf=0;class rf extends Gn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:nf++}),this.name="",this.usage=Cn,this.uniforms=[]}add(e){
return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),
this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++){const n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<n.length;e++)this.uniforms.push(n[e].clone())}return this}clone(){
return(new this.constructor).copy(this)}}class af extends ac{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){
const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class sf{constructor(e,t,n,r,i){
this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,
this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const of=new ci;class lf{constructor(e,t,n=0,r=1/0){this.ray=new li(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new bi,this.params={
Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),
this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),
this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return of.identity().extractRotation(e.matrixWorld),
this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(of),this}intersectObject(e,t=!0,n=[]){return uf(e,this,n,t),n.sort(cf),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)uf(e[r],this,n,t)
;return n.sort(cf),n}}function cf(e,t){return e.distance-t.distance}function uf(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)uf(r[e],t,n,!0)}}class hf{constructor(e=1,t=0,n=0){
return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6
;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,
this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(qn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class df{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){
return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){
return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const pf=new tr;class ff{constructor(e=new tr(1/0,1/0),t=new tr(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){
return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=pf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),
this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){
return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){
return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){
return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){
return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){
return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,pf).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),
this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const mf=new Dr,gf=new Dr;class _f{constructor(e=new Dr,t=new Dr){this.start=e,this.end=t}set(e,t){
return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){
return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){mf.subVectors(e,this.start),
gf.subVectors(this.end,this.start);const n=gf.dot(gf);let r=gf.dot(mf)/n;return t&&(r=qn(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){
return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const vf=new Dr;class yf extends Pi{constructor(e,t){super(),
this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Aa,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,a=t/n*Math.PI*2
;r.push(Math.cos(i),Math.sin(i),1,Math.cos(a),Math.sin(a),1)}n.setAttribute("position",new va(r,3));const i=new pu({fog:!1,toneMapped:!1});this.cone=new Eu(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),
this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),
this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld)
;const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),vf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vf),
void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const bf=new Dr,xf=new ci,Ef=new ci;class wf extends Eu{constructor(e){const t=Sf(e),n=new Aa,r=[],i=[],a=new Zi(0,0,1),s=new Zi(0,1,0)
;for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new va(r,3)),n.setAttribute("color",new va(i,3)),super(n,new pu({vertexColors:!0,
depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){
const t=this.bones,n=this.geometry,r=n.getAttribute("position");Ef.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(xf.multiplyMatrices(Ef,i.matrixWorld),bf.setFromMatrixPosition(xf),
r.setXYZ(n,bf.x,bf.y,bf.z),xf.multiplyMatrices(Ef,i.parent.matrixWorld),bf.setFromMatrixPosition(xf),r.setXYZ(n+1,bf.x,bf.y,bf.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),
this.material.dispose()}}function Sf(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Sf(e.children[n]));return t}class Tf extends ja{constructor(e,t,n){super(new Jh(t,4,2),new na({wireframe:!0,fog:!1,
toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),
void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Af=new Dr,Cf=new Zi,Mf=new Zi;class If extends Pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,
this.color=n,this.type="HemisphereLightHelper";const r=new Xh(t);r.rotateY(.5*Math.PI),this.material=new na({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0)
;const i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new ca(a,3)),this.add(new ja(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){
const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Cf.copy(this.light.color),Mf.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Cf:Mf
;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Af.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Rf extends Eu{constructor(e=10,t=10,n=4473924,r=8947848){n=new Zi(n),r=new Zi(r)
;const i=t/2,a=e/t,s=e/2,o=[],l=[];for(let e=0,c=0,u=-s;e<=t;e++,u+=a){o.push(-s,0,u,s,0,u),o.push(u,0,-s,u,0,s);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Aa
;c.setAttribute("position",new va(o,3)),c.setAttribute("color",new va(l,3)),super(c,new pu({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class kf extends Eu{
constructor(e=10,t=16,n=8,r=64,i=4473924,a=8947848){i=new Zi(i),a=new Zi(a);const s=[],o=[];if(t>1)for(let n=0;n<t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;s.push(0,0,0),s.push(l,0,c);const u=1&n?i:a;o.push(u.r,u.g,u.b),
o.push(u.r,u.g,u.b)}for(let t=0;t<n;t++){const l=1&t?i:a,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;s.push(n,0,i),o.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,s.push(n,0,i),
o.push(l.r,l.g,l.b)}}const l=new Aa;l.setAttribute("position",new va(s,3)),l.setAttribute("color",new va(o,3)),super(l,new pu({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}
const Nf=new Dr,Df=new Dr,Lf=new Dr;class Of extends Pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Aa
;r.setAttribute("position",new va([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new pu({fog:!1,toneMapped:!1});this.lightPlane=new yu(r,i),this.add(this.lightPlane),r=new Aa,r.setAttribute("position",new va([0,0,0,0,0,1],3)),
this.targetLine=new yu(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){
this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Nf.setFromMatrixPosition(this.light.matrixWorld),Df.setFromMatrixPosition(this.light.target.matrixWorld),Lf.subVectors(Df,Nf),this.lightPlane.lookAt(Df),
void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),
this.targetLine.lookAt(Df),this.targetLine.scale.z=Lf.length()}}const Pf=new Dr,Ff=new Za;class Uf extends Eu{constructor(e){const t=new Aa,n=new pu({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],a={};function s(e,t){o(e),o(t)}
function o(e){r.push(0,0,0),i.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),
s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new va(r,3)),t.setAttribute("color",new va(i,3)),
super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()
;const l=new Zi(16755200),c=new Zi(16711680),u=new Zi(43775),h=new Zi(16777215),d=new Zi(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,r,i){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),
a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),
a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),
a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),
a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),
a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0}update(){
const e=this.geometry,t=this.pointMap;Ff.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Bf("c",t,e,Ff,0,0,-1),Bf("t",t,e,Ff,0,0,1),Bf("n1",t,e,Ff,-1,-1,-1),Bf("n2",t,e,Ff,1,-1,-1),Bf("n3",t,e,Ff,-1,1,-1),Bf("n4",t,e,Ff,1,1,-1),
Bf("f1",t,e,Ff,-1,-1,1),Bf("f2",t,e,Ff,1,-1,1),Bf("f3",t,e,Ff,-1,1,1),Bf("f4",t,e,Ff,1,1,1),Bf("u1",t,e,Ff,.7,1.1,-1),Bf("u2",t,e,Ff,-.7,1.1,-1),Bf("u3",t,e,Ff,0,2,-1),Bf("cf1",t,e,Ff,-1,0,1),Bf("cf2",t,e,Ff,1,0,1),Bf("cf3",t,e,Ff,0,-1,1),
Bf("cf4",t,e,Ff,0,1,1),Bf("cn1",t,e,Ff,-1,0,-1),Bf("cn2",t,e,Ff,1,0,-1),Bf("cn3",t,e,Ff,0,-1,-1),Bf("cn4",t,e,Ff,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bf(e,t,n,r,i,a,s){
Pf.set(i,a,s).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Pf.x,Pf.y,Pf.z)}}const zf=new Pr;class Gf extends Eu{constructor(e,t=16776960){
const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Aa;i.setIndex(new ca(n,1)),i.setAttribute("position",new ca(r,3)),super(i,new pu({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",
this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&zf.setFromObject(this.object),zf.isEmpty())return
;const t=zf.min,n=zf.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,
i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){
this.geometry.dispose(),this.material.dispose()}}class Vf extends Eu{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Aa;r.setIndex(new ca(n,1)),
r.setAttribute("position",new va([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new pu({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box
;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Hf extends yu{constructor(e,t=1,n=16776960){const r=n,i=new Aa
;i.setAttribute("position",new va([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new pu({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=new Aa
;a.setAttribute("position",new va([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new ja(a,new na({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),
this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),
this.children[0].material.dispose()}}const jf=new Dr;let Wf,$f;class qf extends Pi{constructor(e=new Dr(0,0,1),t=new Dr(0,0,0),n=1,r=16776960,i=.2*n,a=.2*i){super(),this.type="ArrowHelper",void 0===Wf&&(Wf=new Aa,
Wf.setAttribute("position",new va([0,0,0,0,1,0],3)),$f=new lh(0,.5,1,5,1),$f.translate(0,-.5,0)),this.position.copy(t),this.line=new yu(Wf,new pu({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ja($f,new na({
color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{
jf.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(jf,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,
this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),
this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Xf extends Eu{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Aa;n.setAttribute("position",new va(t,3)),
n.setAttribute("color",new va([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new pu({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Zi,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),
r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Yf{constructor(){this.type="ShapePath",
this.color=new Zi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ih,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){
return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1
;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],s=t[a],o=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],o=-o,s=t[i],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0
;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const n=Vh.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,a,s;const o=[];if(1===r.length)return a=r[0],s=new _h,
s.curves=a.curves,o.push(s),o;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let t=0,s=r.length;t<s;t++)a=r[t],h=a.getPoints(),i=n(h),i=e?!i:i,i?(!l&&u[f]&&f++,u[f]={s:new _h,p:h},u[f].s.curves=a.curves,
l&&f++,p[f]=[]):p[f].push({h:a,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new _h;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let e=0,t=u.length;e<t;e++)c[e]=[]
;for(let r=0,i=u.length;r<i;r++){const i=p[r];for(let a=0;a<i.length;a++){const s=i[a];let o=!0;for(let i=0;i<u.length;i++)t(s.p,u[i].p)&&(r!==i&&n++,o?(o=!1,c[i].push(s)):e=!0);o&&c[r].push(s)}}n>0&&!1===e&&(p=c)}for(let e=0,t=u.length;e<t;e++){
s=u[e].s,o.push(s),d=p[e];for(let e=0,t=d.length;e<t;e++)s.holes.push(d[e].h)}return o}}class Kf extends Cr{constructor(e=1,t=1,n=1,r={}){
console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...r,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){
return this.textures}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),
"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);const Jf={type:"change"},Zf={type:"start"},Qf={type:"end"},em=new li,tm=new us,nm=Math.cos(70*er.DEG2RAD)
;class rm extends Gn{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Dr,this.cursor=new Dr,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,
this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,
this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},
this.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN},this.touches={ONE:a.ROTATE,TWO:a.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,
this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",J),
this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",J),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),
n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Jf),n.update(),s=r.NONE},this.update=function(){
const t=new Dr,i=(new Nr).setFromUnitVectors(e.up,new Dr(0,1,0)),a=i.clone().invert(),d=new Dr,p=new Nr,f=new Dr,m=2*Math.PI;return function(g=null){const _=n.object.position;t.copy(_).sub(n.target),t.applyQuaternion(i),l.setFromVector3(t),
n.autoRotate&&s===r.NONE&&M(function(e){return null!==e?2*Math.PI/60*n.autoRotateSpeed*e:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(l.theta+=c.theta*n.dampingFactor,l.phi+=c.phi*n.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi)
;let v=n.minAzimuthAngle,y=n.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=m:v>Math.PI&&(v-=m),y<-Math.PI?y+=m:y>Math.PI&&(y-=m),l.theta=v<=y?Math.max(v,Math.min(y,l.theta)):l.theta>(v+y)/2?Math.max(v,l.theta):Math.min(y,l.theta)),
l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),
n.target.add(n.cursor);let b=!1;if(n.zoomToCursor&&w||n.object.isOrthographicCamera)l.radius=P(l.radius);else{const e=l.radius;l.radius=P(l.radius*u),b=e!=l.radius}if(t.setFromSpherical(l),t.applyQuaternion(a),_.copy(n.target).add(t),
n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),n.zoomToCursor&&w){let r=null;if(n.object.isPerspectiveCamera){const e=t.length()
;r=P(e*u);const i=e-r;n.object.position.addScaledVector(x,i),n.object.updateMatrixWorld(),b=!!i}else if(n.object.isOrthographicCamera){const e=new Dr(E.x,E.y,0);e.unproject(n.object);const i=n.object.zoom
;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),n.object.updateProjectionMatrix(),b=i!==n.object.zoom;const a=new Dr(E.x,E.y,0);a.unproject(n.object),n.object.position.sub(a).add(e),n.object.updateMatrixWorld(),r=t.length()
}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1
;null!==r&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(em.origin.copy(n.object.position),em.direction.set(0,0,-1).transformDirection(n.object.matrix),
Math.abs(n.object.up.dot(em.direction))<nm?e.lookAt(n.target):(tm.setFromNormalAndCoplanarPoint(n.object.up,n.target),em.intersectPlane(tm,n.target))))}else if(n.object.isOrthographicCamera){const e=n.object.zoom
;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),e!==n.object.zoom&&(n.object.updateProjectionMatrix(),b=!0)}return u=1,w=!1,
!!(b||d.distanceToSquared(n.object.position)>o||8*(1-p.dot(n.object.quaternion))>o||f.distanceToSquared(n.target)>o)&&(n.dispatchEvent(Jf),d.copy(n.object.position),p.copy(n.object.quaternion),f.copy(n.target),!0)}}(),this.dispose=function(){
n.domElement.removeEventListener("contextmenu",Q),n.domElement.removeEventListener("pointerdown",W),n.domElement.removeEventListener("pointercancel",q),n.domElement.removeEventListener("wheel",X),n.domElement.removeEventListener("pointermove",$),
n.domElement.removeEventListener("pointerup",q),n.domElement.getRootNode().removeEventListener("keydown",Y,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",J),n._domElementKeyEvents=null)}
;const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,l=new hf,c=new hf;let u=1
;const h=new Dr,d=new tr,p=new tr,f=new tr,m=new tr,g=new tr,_=new tr,v=new tr,y=new tr,b=new tr,x=new Dr,E=new tr;let w=!1;const S=[],T={};let A=!1;function C(e){const t=Math.abs(.01*e);return Math.pow(.95,n.zoomSpeed*t)}function M(e){c.theta-=e}
function I(e){c.phi-=e}const R=function(){const e=new Dr;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}}(),k=function(){const e=new Dr;return function(t,r){
!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),N=function(){const e=new Dr;return function(t,r){const i=n.domElement;if(n.object.isPerspectiveCamera){
const a=n.object.position;e.copy(a).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),R(2*t*s/i.clientHeight,n.object.matrix),k(2*r*s/i.clientHeight,n.object.matrix)
}else n.object.isOrthographicCamera?(R(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),
k(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function D(e){
n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e){
n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(e,t){if(!n.zoomToCursor)return;w=!0
;const r=n.domElement.getBoundingClientRect(),i=e-r.left,a=t-r.top,s=r.width,o=r.height;E.x=i/s*2-1,E.y=-a/o*2+1,x.set(E.x,E.y,1).unproject(n.object).sub(n.object.position).normalize()}function P(e){
return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function F(e){d.set(e.clientX,e.clientY)}function U(e){m.set(e.clientX,e.clientY)}function B(e){if(1===S.length)d.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y)
;d.set(n,r)}}function z(e){if(1===S.length)m.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}}function G(e){const t=te(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);v.set(0,i)}function V(e){
if(1==S.length)p.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}f.subVectors(p,d).multiplyScalar(n.rotateSpeed);const t=n.domElement;M(2*Math.PI*f.x/t.clientHeight),I(2*Math.PI*f.y/t.clientHeight),d.copy(p)}
function H(e){if(1===S.length)g.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(n,r)}_.subVectors(g,m).multiplyScalar(n.panSpeed),N(_.x,_.y),m.copy(g)}function j(e){
const t=te(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);y.set(0,a),b.set(0,Math.pow(y.y/v.y,n.zoomSpeed)),D(b.y),v.copy(y),O(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function W(e){
!1!==n.enabled&&(0===S.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",$),n.domElement.addEventListener("pointerup",q)),function(e){for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return!0;return!1
}(e)||(function(e){S.push(e.pointerId)}(e),"touch"===e.pointerType?Z(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){
case i.DOLLY:if(!1===n.enableZoom)return;!function(e){O(e.clientX,e.clientX),v.set(e.clientX,e.clientY)}(e),s=r.DOLLY;break;case i.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;U(e),s=r.PAN}else{if(!1===n.enableRotate)return
;F(e),s=r.ROTATE}break;case i.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;F(e),s=r.ROTATE}else{if(!1===n.enablePan)return;U(e),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(Zf)}(e)))}function $(e){
!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(ee(e),s){case r.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(e),n.update();break;case r.TOUCH_PAN:if(!1===n.enablePan)return;H(e),n.update();break;case r.TOUCH_DOLLY_PAN:
if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&j(e),n.enablePan&&H(e)}(e),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&j(e),n.enableRotate&&V(e)}(e),
n.update();break;default:s=r.NONE}}(e):function(e){switch(s){case r.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,d).multiplyScalar(n.rotateSpeed);const t=n.domElement;M(2*Math.PI*f.x/t.clientHeight),
I(2*Math.PI*f.y/t.clientHeight),d.copy(p),n.update()}(e);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,v),b.y>0?D(C(b.y)):b.y<0&&L(C(b.y)),v.copy(y),n.update()}(e);break;case r.PAN:
if(!1===n.enablePan)return;!function(e){g.set(e.clientX,e.clientY),_.subVectors(g,m).multiplyScalar(n.panSpeed),N(_.x,_.y),m.copy(g),n.update()}(e)}}(e))}function q(e){switch(function(e){delete T[e.pointerId]
;for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return void S.splice(t,1)}(e),S.length){case 0:n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",$),n.domElement.removeEventListener("pointerup",q),
n.dispatchEvent(Qf),s=r.NONE;break;case 1:const t=S[0],i=T[t];Z({pointerId:t,pageX:i.x,pageY:i.y})}}function X(e){!1!==n.enabled&&!1!==n.enableZoom&&s===r.NONE&&(e.preventDefault(),n.dispatchEvent(Zf),function(e){O(e.clientX,e.clientY),
e.deltaY<0?L(C(e.deltaY)):e.deltaY>0&&D(C(e.deltaY)),n.update()}(function(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!A&&(n.deltaY*=10),n
}(e)),n.dispatchEvent(Qf))}function Y(e){"Control"===e.key&&(A=!0,n.domElement.getRootNode().addEventListener("keyup",K,{passive:!0,capture:!0}))}function K(e){"Control"===e.key&&(A=!1,n.domElement.getRootNode().removeEventListener("keyup",K,{
passive:!0,capture:!0}))}function J(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?I(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):N(0,n.keyPanSpeed),t=!0;break
;case n.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?I(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):N(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:
e.ctrlKey||e.metaKey||e.shiftKey?M(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):N(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?M(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):N(-n.keyPanSpeed,0),t=!0}
t&&(e.preventDefault(),n.update())}(e)}function Z(e){switch(ee(e),S.length){case 1:switch(n.touches.ONE){case a.ROTATE:if(!1===n.enableRotate)return;B(e),s=r.TOUCH_ROTATE;break;case a.PAN:if(!1===n.enablePan)return;z(e),s=r.TOUCH_PAN;break;default:
s=r.NONE}break;case 2:switch(n.touches.TWO){case a.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&G(e),n.enablePan&&z(e)}(e),s=r.TOUCH_DOLLY_PAN;break;case a.DOLLY_ROTATE:
if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&G(e),n.enableRotate&&B(e)}(e),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(Zf)}function Q(e){
!1!==n.enabled&&e.preventDefault()}function ee(e){let t=T[e.pointerId];void 0===t&&(t=new tr,T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function te(e){const t=e.pointerId===S[0]?S[1]:S[0];return T[t]}n.domElement.addEventListener("contextmenu",Q),
n.domElement.addEventListener("pointerdown",W),n.domElement.addEventListener("pointercancel",q),n.domElement.addEventListener("wheel",X,{passive:!1}),n.domElement.getRootNode().addEventListener("keydown",Y,{passive:!0,capture:!0}),this.update()}}
function im(e,t){if(!e||"object"!=typeof e)return null;let n={};for(let[r,i]of Object.entries(t)){if(!(r in e)&&typeof e[r]!=i)return null;n[r]=e[r]}return n}function am(e,t){let n=0;if(t){e=e.toUpperCase()
;for(let t of e)n=Math.imul(n,61)+t.charCodeAt(0)-32|0}else for(let t of e)n=((n<<5)-n|0)+t.charCodeAt(0)|0;return n>>>0}function sm(e){let[t,n,r,i]=e.split(/[,\.\/:;]/).map((e=>+e));return r=r??1,i=i??r,isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)?null:{
x:t,z:n,xsize:r,zsize:i}}function om(e){let t=e.split(",").map((e=>{let t=e.split("-"),n=t[0]?t[0].split("."):[],r=t[0]||t[1]?(t[1]??t[0]).split("."):[];return{start:[+(n[0]??0),+(n[1]??0),+(n[2]??0)],end:[+(r[0]??1/0),+(r[1]??1/0),+(r[2]??1/0)]}}))
;return t}function lm(e,t,n){let r=e.get(t);return void 0===r&&(r=n(),e.set(t,r)),r}function cm(e){return new Promise((t=>setTimeout(t,e)))}function um(e,t){return(e%t+t)%t}function hm(e){
return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function dm(e){let t="",n=[];try{for(;e;){let r=e.match(/<(\/?)(\w+)(=(\w+))?>/);if(r){t+=hm(e.slice(0,r.index)),
e=e.slice(r.index+r[0].length);let i=!!r[1],a=r[2];if(i){let e=n.pop();if(e!=a)throw new Error("markup token mismatch");if("col"!=e)throw new Error("unknown markup closing token "+e);t+="</span>"}else if("br"==a)t+="<br/>";else{
if("col"!=a)throw new Error("unknown token "+a);t+=`<span style="color:#${r[4].replace(/\W/g,"")};">`,n.push("col")}}else t+=hm(e),e=""}for(;0!=n.length;){let e=n.pop();if("col"!=e)throw new Error("non-autocloseable token left unclosed "+e)
;t+="</span>"}}catch(n){console.log(n.message),t=hm(e)}return t}globalThis.cacheFilenameHash=am;const pm=function e(t,n=0){this.getData=function(){return t},this.bytesLeft=function(){return t.length-n},this.readBuffer=function(e=t.length-n){
let r=t.slice(n,n+e);return n+=e,r},this.tee=function(){return new e(t,n)},this.eof=function(){if(n>t.length)throw new Error("reading past end of buffer");return n>=t.length},this.skip=function(e){return n+=e,this},this.scanloc=function(){return n},
this.readByte=function(){var e=this.readUByte();return e>127?e-256:e},this.readUShortSmart=function(){let e=this.readUByte();return 128&e?(127&e)<<8|this.readUByte():e},this.readShortSmart=function(){let e=this.readUByte(),t=127&e
;return t=e<64?e:e-128,128&e?t<<8|this.readUByte():t},this.readShortSmartBias=function(){let e=this.readUByte();return 128&e?((127&e)<<8|this.readUByte())-16384:e-64},this.readUIntSmart=function(){let e=this.readUByte(),t=this.readUByte()
;return 128&e?(127&e)<<24|t<<16|this.readUByte()<<8|this.readUByte():e<<8|t},this.readUByte=function(){return t[n++]},this.readShort=function(e=!1){var t=this.readUShort(e);return t>32767?t-65536:t},this.readTribyte=function(){let e=t.readIntBE(n,3)
;return n+=3,e},this.readUShort=function(e=!1){return e?t[n++]<<8&65280|t[n++]:t[n++]|t[n++]<<8&65280},this.readUInt=function(e=!1){
return e?(t[n++]<<24&4278190080|t[n++]<<16&16711680|t[n++]<<8&65280|t[n++])>>>0:(t[n++]|t[n++]<<8&65280|t[n++]<<16&16711680|t[n++]<<24&4278190080)>>>0},this.readFloat=function(e=!1,r=!1){var i,a,s,o;e?(o=t[n++],s=t[n++]<<16&16711680,
a=t[n++]<<8&65280,i=t[n++]):(i=t[n++],a=t[n++]<<8&65280,s=t[n++]<<16&16711680,o=t[n++]);var l=i|a|s;return r&&(o=o<<1&254,!(8388608&~l)&&(o|=1),l&=8388607),(1+l*Math.pow(2,r?-23:-24))*Math.pow(2,o-127)},this.readHalf=function(e=!1){
var r=t[n++],i=t[n++]|r<<8&768,a=r>>2&31;return i=i*Math.pow(2,-10)+(0==a?0:1),i*=Math.pow(2,a-15),!(128&~r)&&(i*=-1),i}};function fm(e){return(255&e)<<8|(65280&e)>>>8}function mm(e){
let t=!(32768&(e=fm(e))),n=(31744&e)>>10,r=(1023&e)*Math.pow(2,-10)+(0==n?0:1);return r*=Math.pow(2,n-15),t?r:-r}function gm(e){var t,n,r,i=e[0],a=e[1],s=e[2];if(0==a)t=n=r=s;else{var o=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),
n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},l=s<.5?s*(1+a):s+a-s*a,c=2*s-l;t=o(c,l,i+1/3),n=o(c,l,i),r=o(c,l,i-1/3)}return[t,n,r]}function _m(e){let t=gm(e);return[Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])]}
function vm(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),a=0,s=0;let o=(r+i)/2;if(r!=i){var l=r-i;switch(s=o>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}
return[a,s,o]}function ym(e,t,n){return e<0&&(e+=1),Math.round(63*e)<<10|Math.round(7*t)<<7|Math.round(127*n)}function bm(e){var t=(e>>10&63)/63;return t>.5&&(t-=1),[t,(e>>7&7)/7,(127&e)/127]}globalThis.hsl=e=>_m(bm(e));class xm{constructor(){
this.listeners={}}on(e,t){(this.listeners[e]??(this.listeners[e]=new Set)).add(t)}once(e,t){let n=this.listeners[e]??(this.listeners[e]=new Set),r=e=>{n.delete(r),t(e)};n.add(r)}off(e,t){(this.listeners[e]??(this.listeners[e]=new Set)).delete(t)}
emit(e,t){(this.listeners[e]??(this.listeners[e]=new Set)).forEach((e=>e(t)))}}class Em extends Promise{constructor(e=(e,t)=>{}){let t,n;super(((r,i)=>(t=r,n=i,e(r,i)))),this.done=t,this.err=n}}async function wm(e,t,n){
let r=0,i=0,a=new Array(e).fill(null);for(let s of t())if(a[r++%e]=s,r>=i+e&&r>=e){let t=await a[i%e];i++,n(t)}for(;i<r;){let t=await a[i%e];i++,n(t)}}function Sm(e,t,n=null){for(;e;){if(t(e))return e;e=e.parentElement}return n}Symbol.iterator,
Symbol.iterator;var Tm=n(8287).Buffer;function Am(e,t,n){return e||(e=new Uint8ClampedArray(t*n*4)),e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer,e.byteOffset,e.length)),"undefined"!=typeof ImageData?new ImageData(e,t,n):{data:e,width:t,
height:n,colorSpace:"srgb"}}async function Cm(e,t,r){if("undefined"!=typeof HTMLCanvasElement){let n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),Lm(n,t,r)}{
let i=n(2578)(e.data,{raw:{width:e.width,height:e.height,channels:4}});if("png"==t)return i.png().toBuffer();if("webp"==t)return i.webp({quality:100*r}).toBuffer();throw new Error("unknown format")}}let Mm,Im,Rm,km;async function Nm(e,t,r){
if("undefined"!=typeof ImageDecoder){let n=new ImageDecoder({data:e,type:t,premultiplyAlpha:r?"none":"default",colorSpaceConversion:"none"}),i=await n.decode(),a=new Uint8Array(i.image.allocationSize());i.image.copyTo(a)
;let s=i.image.visibleRect.width*i.image.visibleRect.height;if("BGRX"!=i.image.format&&"RGBX"!=i.image.format||(r=!0),"BGRA"==i.image.format||"BGRX"==i.image.format)for(let e=0;e<s;e++){let t=a[4*e+0];a[4*e+0]=a[4*e+2],a[4*e+1]=a[4*e+1],a[4*e+2]=t,
a[4*e+3]=r?255:a[4*e+3]}else{if("RGBA"!=i.image.format&&"RGBX"!=i.image.format)throw new Error("unexpected image format");if(r)for(let e=0;e<s;e++)a[4*e+3]=255}return Am(a,i.image.visibleRect.width,i.image.visibleRect.height)}
if("undefined"!=typeof HTMLCanvasElement){r&&console.warn("can not strip alpha in browser context that does not support ImageDecoder");let n=new Image,i=new Blob([e],{type:t}),a=URL.createObjectURL(i);n.src=a,await n.decode()
;let s=document.createElement("canvas");s.width=n.naturalWidth,s.height=n.naturalHeight;let o=s.getContext("2d",{willReadFrequently:!0});return o.drawImage(n,0,0),URL.revokeObjectURL(a),o.getImageData(0,0,s.width,s.height)}{let t=n(2578)(e)
;r&&t.removeAlpha();let i=await t.raw().toBuffer({resolveWithObject:!0});return Am(new Uint8ClampedArray(i.data.buffer,i.data.byteOffset,i.data.byteLength),i.info.width,i.info.height)}}async function Dm(e){if("undefined"!=typeof HTMLCanvasElement){
let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t.toDataURL("image/png")}{const t=n(2578);return"data:image/png;base64,"+(await t(e.data,{raw:{
width:e.width,height:e.height,channels:4}}).png().toBuffer()).toString("base64")}}async function Lm(e,t,n){let r=await new Promise((r=>e.toBlob(r,`image/${t}`,n)));if(!r)throw new Error("image compression failed");let i=await r.arrayBuffer()
;return Tm.from(i)}function Om(e){let t=4*e.width,n=new Uint8Array(t);for(let r=0;r<e.height/2;r++){let i=r*t,a=(e.height-1-r)*t;n.set(e.data.slice(i,i+t),0),e.data.copyWithin(i,a,a+t),e.data.set(n,a)}}function Pm(e,t){
let n=new Uint8ClampedArray(t.width*t.height*4),r=4*t.width,i=4*e.width,a=i*t.y+4*t.x;for(let s=0;s<t.height;s++)n.set(e.data.slice(a+s*i,a+s*i+r),r*s);return new ImageData(n,t.width,t.height)}function Fm(e){
let t=new Uint32Array(e.data.buffer,e.data.byteOffset,e.data.byteLength/4),n=e.width,r=0,i=e.height,a=0;for(let s=0;s<e.height;s++){let o=s*e.width;for(let l=0;l<e.width;l++)0!=t[o+l]&&(n=Math.min(l,n),r=Math.max(l,r),i=Math.min(s,i),a=Math.max(s,a))
}return(r<n||a<i)&&(n=i=0,r=a=-1),{x:n,y:i,width:r-n+1,height:a-i+1}}function Um(e,t=!1){let n=document.createElement("canvas"),r=n.getContext("2d",{willReadFrequently:!0});if(t){
if(!(e instanceof ImageData))throw new Error("can only flip imagedata textures");Om(e)}return Bm(r,e),n.style.cssText="position:absolute;top:0px;left:0px;border:1px solid red;background:purple;",document.body.appendChild(n),n.onclick=e=>{
navigator.clipboard.write([new ClipboardItem({"image/png":new Promise((e=>n.toBlob(e)))})]),n.remove()},n}function Bm(e,t){const n=e.canvas;"data"in t?("undefined"==typeof ImageData||t instanceof ImageData||(t=new ImageData(t.data,t.width,t.height)),
n.width=t.width,n.height=t.height,e.putImageData(t,0,0)):"source"in t?(n.width=t.source.data.width,n.height=t.source.data.height,e.drawImage(t.source.data,0,0)):(n.width=t.width,n.height=t.height,e.drawImage(t,0,0))}function zm(e){
return zm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zm(e)}function Gm(e,t,n){var r=n.value
;if("function"!=typeof r)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(zm(r)));var i=!1;return{configurable:!0,get:function(){if(i||this===e.prototype||this.hasOwnProperty(t)||"function"!=typeof r)return r
;var n=r.bind(this);return i=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return n},set:function(e){r=e,delete this[t]}}),i=!1,n},set:function(e){r=e}}}function Vm(e,t=1/0,n=null){Im||(Im=new gs(2,2,1,1)),Rm||(Rm=new Ja({uniforms:{
blitTexture:new tf(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",
fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"
})),Rm.uniforms.blitTexture.value=e,Rm.defines.IS_SRGB=e.colorSpace==Xt,Rm.needsUpdate=!0,km||(km=new ja(Im,Rm),km.frustrumCulled=!1);const r=new ns,i=new ic;i.add(km),null===n&&(n=Mm=new ec({antialias:!1}))
;const a=Math.min(e.image.width,t),s=Math.min(e.image.height,t);n.setSize(a,s),n.clear(),n.render(i,r);const o=document.createElement("canvas"),l=o.getContext("2d");o.width=a,o.height=s,l.drawImage(n.domElement,0,0,a,s);const c=new Pu(o)
;return c.minFilter=e.minFilter,c.magFilter=e.magFilter,c.wrapS=e.wrapS,c.wrapT=e.wrapT,c.name=e.name,Mm&&(Mm.forceContextLoss(),Mm.dispose(),Mm=null),c}globalThis.dumptex=Um;const Hm={
POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],
TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class jm{constructor(){this.pluginCallbacks=[],this.register((function(e){return new ag(e)})),this.register((function(e){return new sg(e)})),
this.register((function(e){return new cg(e)})),this.register((function(e){return new ug(e)})),this.register((function(e){return new hg(e)})),this.register((function(e){return new dg(e)})),this.register((function(e){return new og(e)})),
this.register((function(e){return new lg(e)})),this.register((function(e){return new pg(e)})),this.register((function(e){return new fg(e)})),this.register((function(e){return new mg(e)})),this.register((function(e){return new gg(e)})),
this.register((function(e){return new _g(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){
return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){const i=new ig,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](i));i.setPlugins(a),
i.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,r,i,t)}))}}const Wm=5120,$m=5121,qm=5122,Xm=5123,Ym="KHR_mesh_quantization",Km={};Km[ye]=9728,Km[be]=9984,Km[Ee]=9986,Km[Se]=9729,Km[Te]=9985,
Km[Ce]=9987,Km[_e]=33071,Km[ge]=10497,Km[ve]=33648;const Jm={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Zm=new Zi;function Qm(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}
function eg(e){return 4*Math.ceil(e/4)}function tg(e,t=0){const n=eg(e.byteLength);if(n!==e.byteLength){const r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function ng(){
return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function rg(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n
;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class ig{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],
this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,
textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),
this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,i=r.buffers,a=r.json;n=r.options;const s=r.extensionsUsed,o=r.extensionsRequired,l=new Blob(i,{type:"application/octet-stream"
}),c=Object.keys(s),u=Object.keys(o);if(c.length>0&&(a.extensionsUsed=c),u.length>0&&(a.extensionsRequired=u),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===n.binary){const e=new FileReader;e.readAsArrayBuffer(l),
e.onloadend=function(){const n=tg(e.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,n.byteLength,!0),r.setUint32(4,5130562,!0);const i=tg((s=JSON.stringify(a),(new TextEncoder).encode(s).buffer),32);var s
;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,i.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0)
;const u=12+o.byteLength+i.byteLength+r.byteLength+n.byteLength;c.setUint32(8,u,!0);const h=new Blob([l,o,i,r,n],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(h),d.onloadend=function(){t(d.result)}}
}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const n=e.result;a.buffers[0].uri=n,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return
;const n=this.options,r=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={})
;for(const e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],r[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(t){
console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}
return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new Dr;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}
createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new Dr;for(let e=0,t=n.count;e<t;e++)r.fromBufferAttribute(n,e),
0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),
0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}
buildMetalRoughTexture(e,t){if(e===t)return e;function n(e){return e.colorSpace===Xt?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}
console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Du&&(e=Vm(e)),t instanceof Du&&(t=Vm(t))
;const r=e?e.image:null,i=t?t.image:null,a=Math.max(r?r.width:0,i?i.width:0),s=Math.max(r?r.height:0,i?i.height:0),o=ng();o.width=a,o.height=s;const l=o.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,a,s);const c=l.getImageData(0,0,a,s);if(r){
l.drawImage(r,0,0,a,s);const t=n(e),i=l.getImageData(0,0,a,s).data;for(let e=2;e<i.length;e+=4)c.data[e]=256*t(i[e]/256)}if(i){l.drawImage(i,0,0,a,s);const e=n(t),r=l.getImageData(0,0,a,s).data;for(let t=1;t<r.length;t+=4)c.data[t]=256*e(r[t]/256)}
l.putImageData(c,0,0);const u=(e||t).clone();return u.source=new xr(o),u.colorSpace=qt,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}
processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,i){const a=this.json;let s;switch(a.bufferViews||(a.bufferViews=[]),t){case Wm:case $m:s=1;break;case qm:case Xm:
s=2;break;default:s=4}const o=eg(r*e.itemSize*s),l=new DataView(new ArrayBuffer(o));let c=0;for(let i=n;i<n+r;i++)for(let n=0;n<e.itemSize;n++){let r
;e.itemSize>4?r=e.array[i*e.itemSize+n]:(0===n?r=e.getX(i):1===n?r=e.getY(i):2===n?r=e.getZ(i):3===n&&(r=e.getW(i)),!0===e.normalized&&(r=er.normalize(r,e.array))),
5126===t?l.setFloat32(c,r,!0):5124===t?l.setInt32(c,r,!0):5125===t?l.setUint32(c,r,!0):t===qm?l.setInt16(c,r,!0):t===Xm?l.setUint16(c,r,!0):t===Wm?l.setInt8(c,r):t===$m&&l.setUint8(c,r),c+=s}const u={buffer:this.processBuffer(l.buffer),
byteOffset:this.byteOffset,byteLength:o};return void 0!==i&&(u.target=i),34962===i&&(u.byteStride=e.itemSize*s),this.byteOffset+=o,a.bufferViews.push(u),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json
;return n.bufferViews||(n.bufferViews=[]),new Promise((function(r){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const e=tg(i.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength}
;t.byteOffset+=e.byteLength,r(n.bufferViews.push(a)-1)}}))}processAccessor(e,t,n,r){const i=this.json;let a
;if(e.array.constructor===Float32Array)a=5126;else if(e.array.constructor===Int32Array)a=5124;else if(e.array.constructor===Uint32Array)a=5125;else if(e.array.constructor===Int16Array)a=qm;else if(e.array.constructor===Uint16Array)a=Xm;else if(e.array.constructor===Int8Array)a=Wm;else{
if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=$m}if(void 0===n&&(n=0),void 0!==r&&r!==1/0||(r=e.count),0===r)return null;const s=function(e,t,n){
const r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+n;i++)for(let t=0;t<e.itemSize;t++){let n
;e.itemSize>4?n=e.array[i*e.itemSize+t]:(0===t?n=e.getX(i):1===t?n=e.getY(i):2===t?n=e.getZ(i):3===t&&(n=e.getW(i)),!0===e.normalized&&(n=er.normalize(n,e.array))),r.min[t]=Math.min(r.min[t],n),r.max[t]=Math.max(r.max[t],n)}return r}(e,n,r);let o
;void 0!==t&&(o=e===t.index?34963:34962);const l=this.processBufferView(e,a,n,r,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:a,count:r,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]}
;return!0===e.normalized&&(c.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(c)-1}processImage(e,t,n,r="image/png"){if(null!==e){const i=this,a=i.cache,s=i.json,o=i.options,l=i.pending;a.images.has(e)||a.images.set(e,{})
;const c=a.images.get(e),u=r+":flipY/"+n.toString();if(void 0!==c[u])return c[u];s.images||(s.images=[]);const h={mimeType:r},d=ng();d.width=Math.min(e.width,o.maxTextureSize),d.height=Math.min(e.height,o.maxTextureSize);const p=d.getContext("2d")
;if(!0===n&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){t!==Ge&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),
(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const n=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<n.length;t+=4)n[t+0]=e.data[t+0],n[t+1]=e.data[t+1],
n[t+2]=e.data[t+2],n[t+3]=e.data[t+3];p.putImageData(new ImageData(n,e.width,e.height),0,0)}else{
if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement or ImageBitmap.")
;p.drawImage(e,0,0,d.width,d.height)}!0===o.binary?l.push(rg(d,r).then((e=>i.processBufferViewImage(e))).then((e=>{h.bufferView=e}))):void 0!==d.toDataURL?h.uri=d.toDataURL(r):l.push(rg(d,r).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{
h.uri=e})));const f=s.images.push(h)-1;return c[u]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Km[e.magFilter],
minFilter:Km[e.minFilter],wrapS:Km[e.wrapS],wrapT:Km[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);r.textures||(r.textures=[]),
e instanceof Du&&(e=Vm(e,t.maxTextureSize));let i=e.userData.mimeType;"image/webp"===i&&(i="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(a.name=e.name),
this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,a)}));const s=r.textures.push(a)-1;return n.textures.set(e,s),s}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e)
;if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}}
;!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity])
;if(Qm(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,
r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),
r.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive
;if(Math.max(t.r,t.g,t.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){
const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){const t={
index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",
r.alphaCutoff=e.alphaTest),e.side===g&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));const a=n.materials.push(r)-1;return t.materials.set(e,a),a}
processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,n=e.material.length;t<n;t++)r.push(e.material[t].uuid);else r.push(e.material.uuid);const i=r.join(":")
;if(t.meshes.has(i))return t.meshes.get(i);const a=e.geometry;let s;s=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const o={},l={},c=[],u=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",
color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=a.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),
a.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in a.attributes){if("morph"===e.slice(0,5))continue;const n=a.attributes[e];if(e=h[e]||e.toUpperCase(),
/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(n))){l[e]=t.attributes.get(this.getUID(n));continue}p=null;const r=n.array
;"JOINTS_0"!==e||r instanceof Uint16Array||r instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new ca(new Uint16Array(r),n.itemSize,n.normalized));const i=this.processAccessor(p||n,a)
;null!==i&&(e.startsWith("_")||this.detectMeshQuantization(e,n),l[e]=i,t.attributes.set(this.getUID(n),i))}if(void 0!==d&&a.setAttribute("normal",d),0===Object.keys(l).length)return null
;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],r=[],i={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)i[e.morphTargetDictionary[t]]=t;for(let s=0;s<e.morphTargetInfluences.length;++s){
const o={};let l=!1;for(const e in a.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const n=a.morphAttributes[e][s],r=e.toUpperCase(),i=a.attributes[e]
;if(t.attributes.has(this.getUID(n,!0))){o[r]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!a.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let t=0;t<n.itemSize;t++)0===t&&c.setX(e,n.getX(e)-i.getX(e)),
1===t&&c.setY(e,n.getY(e)-i.getY(e)),2===t&&c.setZ(e,n.getZ(e)-i.getZ(e)),3===t&&c.setW(e,n.getW(e)-i.getW(e));o[r]=this.processAccessor(c,a),t.attributes.set(this.getUID(i,!0),o[r])}u.push(o),n.push(e.morphTargetInfluences[s]),
void 0!==e.morphTargetDictionary&&r.push(i[s])}o.weights=n,r.length>0&&(o.extras={},o.extras.targetNames=r)}const f=Array.isArray(e.material);if(f&&0===a.groups.length)return null;let m=!1;if(f&&null===a.index){const e=[]
;for(let t=0,n=a.attributes.position.count;t<n;t++)e[t]=t;a.setIndex(e),m=!0}const g=f?e.material:[e.material],_=f?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,n=_.length;e<n;e++){const n={mode:s,attributes:l}
;if(this.serializeUserData(a,n),u.length>0&&(n.targets=u),null!==a.index){let r=this.getUID(a.index);void 0===_[e].start&&void 0===_[e].count||(r+=":"+_[e].start+":"+_[e].count),
t.attributes.has(r)?n.indices=t.attributes.get(r):(n.indices=this.processAccessor(a.index,a,_[e].start,_[e].count),t.attributes.set(r,n.indices)),null===n.indices&&delete n.indices}const r=this.processMaterial(g[_[e].materialIndex])
;null!==r&&(n.material=r),c.push(n)}!0===m&&a.setIndex(null),o.primitives=c,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,o)}));const v=n.meshes.push(o)-1;return t.meshes.set(i,v),v}detectMeshQuantization(e,t){
if(this.extensionsUsed[Ym])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}
t.normalized&&(n+=" normalized");const r=e.split("_",1)[0];Hm[r]&&Hm[r].includes(n)&&(this.extensionsUsed[Ym]=!0,this.extensionsRequired[Ym]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={
type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:er.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},
""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);const i=(e=jm.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[];for(let e=0;e<i.length;++e){
const n=i[e],o=Kp.parseTrackName(n.name);let l=Kp.findNode(t,o.nodeName);const c=Jm[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),
!l||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',n.name),null;const u=1;let h,d=n.values.length/n.times.length;c===Jm.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),
!0===n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=n.getInterpolation()===Nt?"STEP":"LINEAR",s.push({input:this.processAccessor(new ca(n.times,u)),output:this.processAccessor(new ca(n.values,d)),
interpolation:h}),a.push({sampler:s.length-1,target:{node:r.get(l),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:s,channels:a}),n.animations.length-1}processSkin(e){
const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],i=e.skeleton;if(void 0===i)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const s=[],o=new Float32Array(16*i.bones.length),l=new ci
;for(let t=0;t<i.bones.length;++t)s.push(n.get(i.bones[t])),l.copy(i.boneInverses[t]),l.multiply(e.bindMatrix).toArray(o,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new ca(o,16)),joints:s,
skeleton:n.get(a)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),r=e.scale.toArray()
;Qm(t,[0,0,0,1])||(i.rotation=t),Qm(n,[0,0,0])||(i.translation=n),Qm(r,[1,1,1])||(i.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Qm(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(i.matrix=e.matrix.elements)
;if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(i.mesh=t)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),
e.children.length>0){const t=[];for(let r=0,i=e.children.length;r<i;r++){const i=e.children[r];if(i.visible||!1===n.onlyVisible){const e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){
t.writeNode&&t.writeNode(e,i)}));const a=t.nodes.push(i)-1;return r.set(e,a),a}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);const i=[]
;for(let t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.visible||!1===n.onlyVisible){const e=this.processNode(r);null!==e&&i.push(e)}}i.length>0&&(r.nodes=i),this.serializeUserData(e,r)}processObjects(e){const t=new ic;t.name="AuxScene"
;for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const n=[]
;for(let t=0;t<e.length;t++)e[t]instanceof ic?this.processScene(e[t]):n.push(e[t]);n.length>0&&this.processObjects(n);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e])
;for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class ag{constructor(e){
this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e)
;const n=this.writer,r=n.json,i=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",
e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),
void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),
!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),
i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);const s=r.extensions[this.name].lights;s.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:s.length-1}}}class sg{constructor(e){
this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,
t.pbrMetallicRoughness.roughnessFactor=.9}}class og{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,r=n.extensionsUsed,i={}
;if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),i.clearcoatTexture=t}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,
e.clearcoatRoughnessMap){const t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={
index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(t,e.clearcoatNormalMap),i.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class lg{
constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={
index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),i.iridescenceTexture=t}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],
i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),
i.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class cg{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){
if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel}
;n.applyTextureTransform(t,e.transmissionMap),i.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class ug{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){
if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){const t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel}
;n.applyTextureTransform(t,e.thicknessMap),i.thicknessTexture=t}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class hg{
constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0
}}class dg{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Zm)&&!e.specularIntensityMap&&!e.specularColorMap)return
;const n=this.writer,r=n.extensionsUsed,i={};if(e.specularIntensityMap){const t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),i.specularTexture=t}
if(e.specularColorMap){const t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),i.specularColorTexture=t}i.specularFactor=e.specularIntensity,
i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class pg{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){
if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.sheenRoughnessMap){const t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel}
;n.applyTextureTransform(t,e.sheenRoughnessMap),i.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),i.sheenColorTexture=t}
i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class fg{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){
if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.anisotropyMap){const t={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),i.anisotropyTexture=t}
i.anisotropyStrength=e.anisotropy,i.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class mg{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){
if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class gg{constructor(e){
this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.bumpMap){const t={index:n.processTexture(e.bumpMap),
texCoord:e.bumpMap.channel};n.applyTextureTransform(t,e.bumpMap),i.bumpTexture=t}i.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class _g{constructor(e){this.writer=e,
this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const n=this.writer,r=e,i=new Float32Array(3*r.count),a=new Float32Array(4*r.count),s=new Float32Array(3*r.count),o=new ci,l=new Dr,c=new Nr,u=new Dr
;for(let e=0;e<r.count;e++)r.getMatrixAt(e,o),o.decompose(l,c,u),l.toArray(i,3*e),c.toArray(a,4*e),u.toArray(s,3*e);const h={TRANSLATION:n.processAccessor(new ca(i,3)),ROTATION:n.processAccessor(new ca(a,4)),SCALE:n.processAccessor(new ca(s,3))}
;r.instanceColor&&(h._COLOR_0=n.processAccessor(r.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0}}jm.Utils={insertKeyframe:function(e,t){
const n=.001,r=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+r),s=e.createInterpolant(new e.ValueBufferType(r));let o;if(0===e.times.length){i[0]=t;for(let e=0;e<r;e++)a[e]=0;o=0
}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;i[0]=t,i.set(e.times,1),a.set(s.evaluate(t),0),a.set(e.values,r),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;i[i.length-1]=t,
i.set(e.times,0),a.set(e.values,0),a.set(s.evaluate(t),e.values.length),o=i.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){i.set(e.times.slice(0,l+1),0),i[l+1]=t,
i.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*r),0),a.set(s.evaluate(t),(l+1)*r),a.set(e.values.slice((l+1)*r),(l+2)*r),o=l+1;break}}return e.times=i,e.values=a,o},mergeMorphTargetTracks:function(e,t){const n=[],r={},i=e.tracks
;for(let e=0;e<i.length;++e){let a=i[e];const s=Kp.parseTrackName(a.name),o=Kp.findNode(t,s.nodeName);if("morphTargetInfluences"!==s.propertyName||void 0===s.propertyIndex){n.push(a);continue}
if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){
if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.")
;console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(Dt)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[s.propertyIndex]
;if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);let u;if(void 0===r[o.uuid]){u=a.clone();const e=new u.ValueBufferType(l*u.times.length);for(let t=0;t<u.times.length;t++)e[t*l+c]=u.values[t]
;u.name=(s.nodeName||"")+".morphTargetInfluences",u.values=e,r[o.uuid]=u,n.push(u);continue}const h=a.createInterpolant(new a.ValueBufferType(1));u=r[o.uuid];for(let e=0;e<u.times.length;e++)u.values[e*l+c]=h.evaluate(u.times[e])
;for(let e=0;e<a.times.length;e++){const t=this.insertKeyframe(u,a.times[e]);u.values[t*l+c]=a.values[e]}}return e.tracks=n,e}};class vg{parse(e,t={}){const n=(t=Object.assign({binary:!1},t)).binary,r=[];let i,a=0;e.traverse((function(e){
if(e.isMesh){const t=e.geometry,n=t.index,i=t.getAttribute("position");a+=null!==n?n.count/3:i.count/3,r.push({object3d:e,geometry:t})}}));let s=80;if(!0===n){const e=new ArrayBuffer(2*a+3*a*4*4+80+4);i=new DataView(e),i.setUint32(s,a,!0),s+=4
}else i="",i+="solid exported\n";const o=new Dr,l=new Dr,c=new Dr,u=new Dr,h=new Dr,d=new Dr;for(let e=0,t=r.length;e<t;e++){const t=r[e].object3d,n=r[e].geometry,i=n.index,a=n.getAttribute("position")
;if(null!==i)for(let e=0;e<i.count;e+=3)p(i.getX(e+0),i.getX(e+1),i.getX(e+2),a,t);else for(let e=0;e<a.count;e+=3)p(e+0,e+1,e+2,a,t)}return!1===n&&(i+="endsolid exported\n"),i;function p(e,t,r,a,p){o.fromBufferAttribute(a,e),
l.fromBufferAttribute(a,t),c.fromBufferAttribute(a,r),!0===p.isSkinnedMesh&&(p.applyBoneTransform(e,o),p.applyBoneTransform(t,l),p.applyBoneTransform(r,c)),o.applyMatrix4(p.matrixWorld),l.applyMatrix4(p.matrixWorld),c.applyMatrix4(p.matrixWorld),
function(e,t,r){u.subVectors(r,t),h.subVectors(e,t),u.cross(h).normalize(),d.copy(u).normalize(),!0===n?(i.setFloat32(s,d.x,!0),s+=4,i.setFloat32(s,d.y,!0),s+=4,i.setFloat32(s,d.z,!0),s+=4):(i+="\tfacet normal "+d.x+" "+d.y+" "+d.z+"\n",
i+="\t\touter loop\n")}(o,l,c),f(o),f(l),f(c),!0===n?(i.setUint16(s,0,!0),s+=2):(i+="\t\tendloop\n",i+="\tendfacet\n")}function f(e){!0===n?(i.setFloat32(s,e.x,!0),s+=4,i.setFloat32(s,e.y,!0),s+=4,i.setFloat32(s,e.z,!0),
s+=4):i+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n"}}}class yg extends sd{constructor(){super({uniforms:{map:{type:"t",value:null}},
vertexShader:"\n\t\t\t\tattribute vec3 position;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main()  {\n\t\t\t\t\tvUv = vec2(position.x,position.y);\n\t\t\t\t\tgl_Position = vec4(position, 1.0);\n\t\t\t\t}",
fragmentShader:"\n\t\t\t\tprecision mediump float;\n\t\t\t\tuniform samplerCube map;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\t#define M_PI 3.1415926535897932384626433832795\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat longitude = vUv.x * M_PI;\n\t\t\t\t\tfloat latitude = vUv.y * 0.5 * M_PI;\n\t\t\t\t\tvec3 dir = vec3(sin(longitude) * cos(latitude), sin(latitude), -cos(longitude) * cos(latitude));\n\t\t\t\t\tnormalize(dir);\n\t\t\t\t\tgl_FragColor = textureCube(map, dir);\n\t\t\t\t}",
side:g,transparent:!0}),this.transparent=!0}}class bg{constructor(e,t,n,r){this.size=t,e.getContext(),this.cubeRenderTarget=new ss(t,{minFilter:Se,magFilter:Se,format:Ge,colorSpace:e.outputColorSpace,samples:0}),
this.cubeRenderTarget.isXRRenderTarget=!0,this.cubeCamera=new is(n,r,this.cubeRenderTarget),this.skyCubeCamera=new is(n,r,this.cubeRenderTarget),this.quad=new ja(new gs(2,2),new yg),this.quad.frustumCulled=!1,this.projectCamera=new Za}render(e){
this.quad.material.uniforms.map.value=this.cubeCamera.renderTarget.texture,e.render(this.quad,this.projectCamera)}}const xg={framemaps:1,config:2,interfaces:3,mapsquares:5,oldmodels:7,sprites:8,clientscript:12,sounds:14,objects:16,enums:17,npcs:18,
items:19,sequences:20,spotanims:21,structs:22,quickchat:24,materials:26,particles:27,worldmap:23,music:40,models:47,frames:48,texturesOldPng:9,texturesOldCompoundPng:37,textures2015Png:43,textures2015CompoundPng:44,textures2015Dds:45,
textures2015CompoundPngMips:46,textures2015CompoundDds:50,textures2015PngMips:51,texturesDds:52,texturesPng:53,texturesBmp:54,texturesKtx:55,skeletalAnims:56,achievements:57,cutscenes:66,index:255},Eg=0,wg=3,Sg=5,Tg=6,Ag={mapunderlays:1,
identityKit:3,mapoverlays:4,params:11,environments:29,animgroups:32,mapscenes:34,maplabels:36,dbtables:40,dbrows:41,varplayer:60,varnpc:61,varclient:62,varworld:63,varregion:64,varobject:65,varclan:66,varclansettings:67,varcampaign:68,
varplayergroup:75,varbits:69,locs_old:6,npcs_old:9,items_old:10,spotanim_old:13},Cg=377,Mg=235;var Ig=n(8287).Buffer;const Rg={buffer:{constr:Ig},hex:{constr:Uint8Array},byte:{constr:Int8Array},ubyte:{constr:Uint8Array},short:{constr:Int16Array},
ushort:{constr:Uint16Array},int:{constr:Int32Array},uint:{constr:Uint32Array},float:{constr:Float32Array}};var kg=null;function Ng(e){let t=kg;return kg=e?{rootstate:null,opcodes:[]}:null,t}function Dg(e,t,n){
if(!Object.hasOwn(n,e))throw new Error(`Type '${e}' not found in typedef.json`);let r=n[e];return"string"!=typeof r?Lg(t,r,n):Object.hasOwn(jg,r)?jg[r]:Dg(r,t,n)}function Lg(e,t,n){switch(e??(e=()=>{throw new Error("reference failed to resolve")}),
typeof t){case"boolean":case"number":return Ug(t);case"string":return Object.hasOwn(jg,t)?jg[t]:Dg(t,e,n);case"object":if(null==t)return Ug(null);if(!Array.isArray(t))return function(e,t,n){let r={read(e){let t={},n={$opcode:0};for(e.stack.push(t),
e.hiddenstack.push(n),kg&&!kg.rootstate&&(kg.rootstate=t);;){if(e.scan==e.endoffset){c||console.log("ended reading opcode struct at end of file without 0x00 opcode");break}let r=s.read(e);if(n.$opcode=r,!c&&0==r)break;let i=l.get(r)
;if(kg&&kg.opcodes.push({op:i?i.key:`_0x${r.toString(16)}_`,index:e.scan-1,stacksize:e.stack.length}),!i)throw new Error("unknown chunk 0x"+r.toString(16).toUpperCase());t[i.key]=i.parser.read(e)}return e.stack.pop(),e.hiddenstack.pop(),t},
write(e,t){if("object"!=typeof t||!t)throw new Error("oject expected");e.stack.push(t),e.hiddenstack.push({});for(let n in t){if(n.startsWith("$"))continue;let r=o[n];if(!r)throw new Error("unknown property "+n);s.write(e,r.op),r.parser.write(e,t[n])
}c||s.write(e,0),e.stack.pop(),e.hiddenstack.pop()},getTypescriptType(e){let t="{\n",n=e+"\t";for(let e of l.values())t+=n+e.key+"?: "+e.parser.getTypescriptType(n)+" | null\n";return t+=e+"}",t},getJsonSchema:()=>({type:"object",
properties:Object.fromEntries([...l.values()].filter((e=>!e.key.startsWith("$"))).map((e=>[e.key,{oneOf:[e.parser.getJsonSchema(),{type:"null"}]}])))})},i=function(e,n,r){let i={stackdepth:r.stackdepth+1,resolve(t,n){
if("object"!=typeof t||!t)throw new Error("object expected");let i=t[e];return r.resolve(i,n)}};return"$opcode"==n||Object.prototype.hasOwnProperty.call(o,n)?(a[n]??(a[n]=[]),a[n].push(i),i):Og(n,t,i)
},a={},s=Lg(null,e.$opcode??"unsigned byte",n),o={};for(let t in e){if(t.startsWith("$"))continue;let r=e[t];if("object"!=typeof r||!r)throw new Error("op name expected");let a=r.name;if("string"!=typeof a)throw new Error("op name expected")
;if(o[a])throw new Error("duplicate opcode key "+a);o[a]={op:parseInt(t),parser:Lg(i.bind(null,t),r.read,n)}}let l=new Map;for(let e in o){let t=o[e];l.set(t.op,{key:e,parser:t.parser})}let c=!!l.get(0);return r}(t,e,n);{
if(t.length<1)throw new Error(`'read' variables must either be a valid type-defining string, an array of type-defining strings / objects, or a valid type-defining object: ${JSON.stringify(t)}`);let r=t.slice(1);if(Wg[t[0]])return Wg[t[0]](r,e,n)}
default:throw new Error(`'read' variables must either be a valid type-defining string, an array of type-defining strings / objects, or a valid type-defining object: ${JSON.stringify(t)}`)}}function Og(e,t,n){
if(!t)throw new Error("reference "+e+" could not be resolved");return t(e,n)}function Pg(e,t,n){let r=Og(t,e,{stackdepth:0,resolve:n}).stackdepth,i=t.startsWith("$");return{read(e){let n=i?e.hiddenstack:e.stack;return n[n.length-r][t]},write(e,n){
if(e.isWrite&&!i)throw new Error(`can update ref values in write mode when they are hidden (prefixed with $) in ${t}`);let a=i?e.hiddenstack:e.stack;a[a.length-r][t]=n}}}function Fg(e,t,n){if("string"==typeof e){if("hex"==n)return Ig.from(e,"hex");{
let n=e.match(/^buffer ([\w\[\]]+){([\d,\-\.]*)}/);if(!n)throw new Error("invalid arraybuffer string");return new t.constr(n[2].split(",").map((e=>+e)))}}if(!(e instanceof t.constr))throw new Error("arraybuffer expected");return e}function Ug(e){
if("number"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e&&null!=e)throw new Error("only bool, number, string or null literals allowed");return{read:t=>e,readConst:()=>e,write(t,n){
if(n!=e)throw new Error(`expected constant ${e} was not present during write`)},getTypescriptType:()=>JSON.stringify(e),getJsonSchema:()=>({const:e})}}function Bg(e){const t="latin1";return{read(n){let r=Vg(n.args)<=Cg?10:0
;for(let t=0;t<e.length;t++,n.scan++)if(n.buffer.readUInt8(n.scan)!=e[t])throw new Error("failed to match string header bytes");let i=n.scan;for(;;){if(i==n.endoffset)throw new Error("reading string without null termination")
;if(n.buffer.readUInt8(i)==r)break;i++}let a=n.buffer.toString(t,n.scan,i);return n.scan=i+1,a},write(n,r){if("string"!=typeof r)throw new Error("string expected");let i=Vg(n.args)<=Cg?10:0,a=[...e,...Ig.from(r,t),i];n.buffer.set(a,n.scan),
n.scan+=a.length},getTypescriptType:()=>"string",getJsonSchema:()=>({type:"string"})}}function zg(e,t,n){let r=[],i=[];for(let a of t){a=a.replace(/\s/g,"");let t=a.split(/&&/g),s=[];for(let a of t){let t,o,l=0;if("default"==a||"other"==a)continue;{
let e=a.match(/^((?<var>[\$a-zA-Z]\w*)?(?<op><|<=|>|>=|&|==|=|!&|&=|!=)?)?(?<version>0x[\da-fA=F]+|-?\d+)$/);if(!e)throw new Error("invalid match value, expected <op><version>. For example '>10'");l=parseInt(e.groups.version),t=e.groups.op??"=",
"=="==t&&(t="="),o=e.groups.var??"$opcode"}let c=r.findIndex((e=>e.name==o));-1==c&&(c=r.length,r.push({name:o,parser:Pg(e,o,((e,t)=>{if(!n)throw new Error("write not implemented");let r=n(e);for(let e=0;e<i.length;e++){let n=i[e];for(let i of n){
if(i.varindex!=c)continue;let n=e==r,a=i.value;switch(i.op){case"=":t=n?a:t;break;case"!=":t=n?t:a;break;case"&":case"&=":t=n?t|a:t&~a;break;case"!&":t=n?t&~a:t|a;break;case">=":t=n?Math.max(a,t):t;break;case">":t=n?Math.max(a+1,t):t;break;case"<=":
t=n?Math.min(a,t):t;break;case"<":t=n?Math.min(a-1,t):t;break;default:throw new Error("unknown condition "+i.op)}}}return t}))})),s.push({op:t,value:l,varname:o,varindex:c})}i.push(s)}return{match:e=>{let t=r.map((t=>t.parser.read(e)))
;for(let e=0;e<i.length;e++){let n=i[e],r=!0;for(let e of n){let n=t[e.varindex];switch(e.op){case"=":r=n==e.value;break;case"!=":r=n!=e.value;break;case"<":r=n<e.value;break;case"<=":r=n<=e.value;break;case">":r=n>e.value;break;case">=":r=n>=e.value
;break;case"&":r=!!(n&e.value);break;case"!&":r=!(n&e.value);break;case"&=":r=(n&e.value)==e.value;break;default:throw new Error("unknown op"+e.op)}if(!r)break}if(r)return e}return-1}}}const Gg={playeritem:function(){return{read(e){
let t=e.buffer.readUInt8(e.scan++);if(0==t)return 0;let n=e.buffer.readUInt8(e.scan++);return 255==n&&255==t?-1:t<<8|n},write(e,t){if("number"!=typeof t)throw new Error("number expected")
;0==t?e.buffer.writeUInt8(0,e.scan++):(e.buffer.writeUint16BE(-1==t?65535:65535&t,e.scan),e.scan+=2)},getTypescriptType:()=>"number",getJsonSchema:()=>({type:"integer",minimum:-1,maximum:49150})}},itemvar:function(e){let t=e[0]
;if("string"!=typeof t||!["ref","matcount","colorcount","modelcount"].includes(t))throw new Error;return{read(e){let n="number"==typeof e.args.activeitem?e.args.activeitem:-1;if("ref"==t&&(n++,e.args.activeitem=n),
!Array.isArray(e.args.slots))throw new Error("");let r=e.args.slots[n];if("ref"==t)return r;if("matcount"==t)return r?.replaceMaterials?.length??0;if("colorcount"==t)return r?.replaceColors?.length??0;if("modelcount"==t)return r?.models.length
;throw new Error},write(){},getTypescriptType:()=>"ref"==t?"any":"number",getJsonSchema:()=>({type:"ref"==t?"any":"integer"})}},buildnr:function(e,t){return{readConst:e=>Vg(e.args),read:e=>Vg(e.args),write(e,t){},getTypescriptType:e=>"number",
getJsonSchema:()=>({type:"number"})}},match:function(e,t,n){let r={read(e){let t={$opcode:0};e.stack.push({}),e.hiddenstack.push(t);let n=a?a.read(e):0;t.$opcode=n;let r=l.match(e);if(-1==r)throw new Error("no opcode matched");let i=o[r].read(e)
;return e.stack.pop(),e.hiddenstack.pop(),i},write(e,t){let n={$opcode:0};if(e.stack.push({}),e.hiddenstack.push(n),a){if(!a.readConst)throw new Error("non-const or non-reference match value not implemented in write mode");n.$opcode=a.readConst(e)}
let r=l.match(e);if(-1==r)throw new Error("no opcode matched");o[r].write(e,t),e.stack.pop(),e.hiddenstack.pop()},getTypescriptType:e=>"("+o.map((t=>t.getTypescriptType(e+"\t"))).join("|")+")",getJsonSchema:()=>({anyOf:o.map((e=>e.getJsonSchema()))})
};const i=function(e,n){let r={stackdepth:n.stackdepth+1,resolve(e,t){throw new Error("write not supported")}};return"$opcode"==e?r:Og(e,t,r)};if(1==e.length&&(e=[null,e[0]]),2!=e.length)throw new Error("match chunks needs 2 arguments")
;if("object"!=typeof e[1])throw new Error("match chunk requires 2n+2 arguments");let a=e[0]?Lg(i,e[0],n):null,s=Object.keys(e[1]),o=Object.values(e[1]).map((e=>Lg(i,e,n))),l=zg(i,s);return r},footer:function(e,t,n){
if(2!=e.length)throw new Error("footer requires length and subtype arguments");let r=Lg(t,e[0],n),i=Lg(t,e[1],n);return{read(e){let t=r.read(e),n=e.scan,a=e.endoffset-t;e.scan=a,kg&&kg.opcodes.push({op:"footer",index:n,stacksize:e.stack.length+1,
jump:{to:a}});let s=i.read(e);return kg&&kg.opcodes.push({op:"footer",index:e.scan,stacksize:e.stack.length+1,jump:{to:n}}),e.scan!=e.endoffset&&console.log(`didn't read full footer, ${e.endoffset-e.scan} bytes left`),e.scan=n,
e.endoffset=e.endoffset-t,s},write(e,t){let n=e.scan;i.write(e,t);let r=e.scan-n;e.buffer.copyWithin(e.endoffset-r,n,e.scan),e.scan=n,e.endoffset-=r},getTypescriptType:e=>i.getTypescriptType(e),getJsonSchema:()=>i.getJsonSchema()}},
"tailed varushort":function(e,t,n){return{read(e){let t=0;for(;;){let n,r=e.buffer.readUint8(e.scan++);if(n=128&r?(127&r)<<8|e.buffer.readUint8(e.scan++):r,t+=n,32767!=n)return t}},write(e,t){if("number"!=typeof t)throw new Error("number expected")
;for(;t>=0;){let n=Math.min(32767,t);n<128?e.buffer.writeUint8(n,e.scan++):(e.buffer.writeUint16BE(32768|n,e.scan),e.scan+=2),t-=n}},getTypescriptType:e=>"number",getJsonSchema:()=>({type:"number"})}},legacy_maptile:function(e,t,n){return{read(e){
let t={flags:0,shape:null,overlay:null,settings:null,underlay:null,height:null};for(;;){let n=e.buffer.readUint8(e.scan++);if(0==n)break;if(1==n){t.height=e.buffer.readUint8(e.scan++);break}n>=2&&n<=49&&(t.shape=n-2,
t.overlay=e.buffer.readUint8(e.scan),e.scan+=1),n>=50&&n<=81&&(t.settings=n-49),n>=82&&(t.underlay=n-81)}return t},write(e){throw new Error("not implemented")},getTypescriptType(e){let t=e+"\t"
;return`{\n${t}flags: number,\n${t}shape: number | null,\n${t}overlay: number | null,\n${t}settings: number | null,\n${t}underlay: number | null,\n${t}height: number | null,\n${e}}`},getJsonSchema:()=>({type:"any"})}},scriptopt:function(e,t,n){
return{read(e){let t=e.args.clientScriptDeob;if(!t)throw new Error("opcode callibration not set for clientscript with obfuscated opcodes");return kg&&kg.opcodes.push({op:"opcode",index:e.scan,stacksize:e.stack.length+1}),t.readOpcode(e)},write(e,t){
let n=e.args.clientScriptDeob;if(!n)throw new Error("opcode callibration not set for clientscript with obfuscated opcodes");n.writeOpCode(e,t)},getJsonSchema:()=>({type:"object",properties:{opcode:{type:"number"},imm:{type:"number"},imm_obj:{oneOf:[{
type:"number"},{type:"string"},{type:"null"}]}}}),getTypescriptType(e){let t=e+"\t";return`{\n${t}opcode:number,\n${t}imm:number,\n${t}imm_obj:number|string|[number,number]|null,\n${e}}`}}}};function Vg(e){
if("number"!=typeof e.clientVersion)throw new Error("client version not set");return e.clientVersion}const Hg={ubyte:{read(e){let t=e.buffer.readUInt8(e.scan);return e.scan+=1,t},write(e,t){e.buffer.writeUInt8(t,e.scan),e.scan+=1},min:0,max:255},
byte:{read(e){let t=e.buffer.readInt8(e.scan);return e.scan+=1,t},write(e,t){e.buffer.writeInt8(t,e.scan),e.scan+=1},min:-128,max:127},ushort:{read(e){let t=e.buffer.readUInt16BE(e.scan);return e.scan+=2,t},write(e,t){
e.buffer.writeUInt16BE(t,e.scan),e.scan+=2},min:0,max:65535},short:{read(e){let t=e.buffer.readInt16BE(e.scan);return e.scan+=2,t},write(e,t){e.buffer.writeInt16BE(t,e.scan),e.scan+=2},min:-32768,max:32767},uint:{read(e){
let t=e.buffer.readUInt32BE(e.scan);return e.scan+=4,t},write(e,t){e.buffer.writeUInt32BE(t,e.scan),e.scan+=4},min:0,max:2**32-1},int:{read(e){let t=e.buffer.readInt32BE(e.scan);return e.scan+=4,t},write(e,t){e.buffer.writeInt32BE(t,e.scan),e.scan+=4
},min:-(2**31),max:2**31-1},uint_le:{read(e){let t=e.buffer.readUInt32LE(e.scan);return e.scan+=4,t},write(e,t){e.buffer.writeUint32LE(t,e.scan),e.scan+=4},min:0,max:2**32-1},ushort_le:{read(e){let t=e.buffer.readUInt16LE(e.scan);return e.scan+=2,t},
write(e,t){e.buffer.writeUint16LE(t,e.scan),e.scan+=2},min:0,max:65535},utribyte:{read(e){let t=e.buffer.readUIntBE(e.scan,3);return e.scan+=3,t},write(e,t){e.buffer.writeUintBE(t,e.scan,3),e.scan+=3},min:0,max:2**24-1},float:{read(e){
let t=e.buffer.readFloatBE(e.scan);return e.scan+=4,t},write(e,t){e.buffer.writeFloatBE(t,e.scan),e.scan+=4},min:Number.MIN_VALUE,max:Number.MAX_VALUE},varushort:{read(e){let t=e.buffer.readUInt8(e.scan++)
;return 128&t?(127&t)<<8|e.buffer.readUInt8(e.scan++):t},write(e,t){t<128?(e.buffer.writeUInt8(t,e.scan),e.scan+=1):(e.buffer.writeUint16BE(32768|t,e.scan),e.scan+=2)},min:0,max:32767},varshort:{read(e){let t=e.buffer.readUInt8(e.scan++)
;return 128&t?((127&t)<<8|e.buffer.readUInt8(e.scan++))<<17>>17:t<<25>>25},write(e,t){t<64&&t>=-64?(e.buffer.writeUInt8(127&t,e.scan),e.scan+=1):(e.buffer.writeInt16BE(32768|t,e.scan),e.scan+=2)},min:-16384,max:16383},varuint:{read(e){
let t=e.buffer.readUInt16BE(e.scan);if(e.scan+=2,!(32768&t))return t;{let n=e.buffer.readUInt16BE(e.scan);return e.scan+=2,(32767&t)<<16|n}},write(e,t){t<32768?(e.buffer.writeUInt16BE(t,e.scan),
e.scan+=2):(e.buffer.writeUint32BE((2147483648|t)>>>0,e.scan),e.scan+=4)},min:0,max:2**31-1},varnullint:{read(e){let t=e.buffer.readUInt16BE(e.scan);if(e.scan+=2,32767==t)return-1;if(!(32768&t))return t;{let n=e.buffer.readUInt16BE(e.scan)
;return e.scan+=2,(32767&t)<<16|n}},write(e,t){-1==t?(e.buffer.writeUint16BE(32767,e.scan),e.scan+=2):t<32768?(e.buffer.writeUInt16BE(t,e.scan),e.scan+=2):(e.buffer.writeUint32BE((2147483648|t)>>>0,e.scan),e.scan+=4)},min:-1,max:2**31-1},varint:{
read(e){let t=e.buffer.readUInt16BE(e.scan);if(e.scan+=2,!(32768&t))return t<<17>>17;let n=e.buffer.readUInt16BE(e.scan);return e.scan+=2,((32767&t)<<16|n)<<1>>1},write(e,t){t<16384&&t>=-16384?(e.buffer.writeUInt16BE(32767&t,e.scan),
e.scan+=2):(e.buffer.writeInt32BE(8388608|t,e.scan),e.scan+=4)},min:-(2**30),max:2**30-1}},jg={...Object.fromEntries(Object.entries(Hg).map((([e,t])=>[e,{read:t.read,write:(e,n)=>{if("number"!=typeof n||n>t.max||n<t.min)throw new Error;t.write(e,n)},
getJsonSchema:()=>({type:"number",maximum:t.max,minimum:t.min}),getTypescriptType:e=>"number"}]))),bool:{read(e){let t=e.buffer.readUInt8(e.scan++);if(0!=t&&1!=t)throw new Error("1 or 0 expected boolean value");return 0!=t},write(e,t){
if("boolean"!=typeof t)throw new Error("boolean expected");e.buffer.writeUInt8(+t,e.scan++)},getJsonSchema:()=>({type:"boolean"}),getTypescriptType:e=>"boolean"},string:Bg([]),paddedstring:Bg([0])},Wg={ref:function(e,t,n){let r=e=>{let t=c.read(e)
;return-1!=s&&(t=t>>s&~(-1<<o)),t+l},i={read:r,readConst:r,write(e,t){},getTypescriptType:()=>"number",getJsonSchema:()=>({type:"integer",minimum:-1==o?void 0:0,maximum:-1==o?void 0:2**o-1})}
;if(e.length<1)throw new Error("1 argument exptected for proprety with type ref");if("string"!=typeof e[0])throw new Error("ref propname expected");let a=e[0],[s,o]=[-1,-1];if(e[1]){
if(!Array.isArray(e[1])||2!=e[1].length||"number"!=typeof e[1][0]||"number"!=typeof e[1][1])throw new Error("second argument for ref should be [minbit,bitlen] pair");s=e[1][0],o=e[1][1]}let l=e[2]??0
;if("number"!=typeof l)throw new Error("ref offset should be a number");let c=Pg(t,a,((e,t)=>{if("number"!=typeof e)throw new Error("number expected");return-1!=s?t&~(~(-1<<o)<<s)|e<<s:e}));return i},accum:function(e,t,n){let r={read(e){
let t,n=a.read(e),r=o.read(e)??0;if("add"==s||"add-1"==s||"postadd"==s)t=r+(n??0)+("add-1"==s?-1:0);else{if("hold"!=s)throw new Error("unknown accumolator mode");t=n??r}return o.write(e,t),"postadd"==s?r:t},write(e,t){
if("number"!=typeof t)throw new Error("number expected");let n,r=o.read(e)??0
;if("add"!=s&&"add-1"!=s)throw"hold"==s?new Error("writing accum intaccum hold not implemented"):"postadd"==s?new Error("writing accum intaccum postadd not implemented"):new Error("unknown accumolator mode");n=t-r+("add-1"==s?1:0),a.write(e,n),
o.write(e,t)},getTypescriptType:()=>"number",getJsonSchema:()=>({type:"integer"})};if(e.length<2)throw new Error("2 arguments exptected for proprety with type accum");let i=e[0],a=Lg(t,e[1],n),s=e[2]??"add"
;if("string"!=typeof i)throw new Error("ref name should be a string");let o=Pg(t,i,((e,t)=>t));return r},opt:function(e,t,n){let r={read:e=>-1==o.match(e)?null:l.read(e),write(e,t){if(null!=t)return l.write(e,t)},
getTypescriptType:e=>l.getTypescriptType(e)+" | null",getJsonSchema:()=>({oneOf:[l.getJsonSchema(),{type:"null"}]})},i=function(e,n){return Og(e,t,{stackdepth:n.stackdepth,resolve:(e,t)=>null!=e?n.resolve(e,t):t})}
;if(e.length<2)throw new Error("2 arguments exptected for proprety with type opt");let a=e[0],s="";if("string"==typeof a)s=a;else{let e,t,n="eq";if(Array.isArray(a)){
if("number"!=typeof a[1])throw new Error("only literal ints as condition value are supported");e=a[0],n=a[2]??"eq",t=a[1]}else{if("number"!=typeof a)throw new Error("");e="$opcode",t=a}"bitflag"!=n&&"bitflagnot"!=n||(t=1<<t),s=`${e}${{bitand:"&=",
bitflag:"&",bitflagnot:"!&",bitor:"&",eq:"==",eqnot:"!=",gteq:">=",lteq:"<="}[n]}${t}`}let o=zg(i,[s],(e=>null==e?-1:0)),l=Lg(i,e[1],n);return r},chunkedarray:function(e,t,n){let r={read(e){let t=s.read(e),n=[],r=[];for(let i=0;i<c.length;i++){
let a=c[i];kg&&kg.opcodes.push({op:Object.keys(a).join(),index:e.scan,stacksize:e.stack.length});for(let s=0;s<t;s++){let t,o;0==i?(o={},n.push(o),t={},r.push(t)):(o=n[s],t=r[s]),e.stack.push(o),e.hiddenstack.push(t);for(let n in a){
let r=a[n].read(e);n.startsWith("$")?t[n]=r:o[n]=r}e.stack.pop(),e.hiddenstack.pop()}}return n},write(e,t){if(!Array.isArray(t))throw new Error("array expected");s.write(e,t.length);let n=[];for(let r=0;r<c.length;r++){let i=c[r]
;for(let a=0;a<t.length;a++){let s=t[a],l=0==r?n[a]={}:n[a];if(e.stack.push(s),e.hiddenstack.push(l),"object"!=typeof s||!s)throw new Error("object expected");for(let t in i){let n=i[t],r=s[t];if(t.startsWith("$")){
if(null!=n.readConst)r=n.readConst(e);else{let e=o[t];if(!e)throw new Error("cannot write hidden values if they are not constant or not referenced");r??(r=0);for(let t of e)r=t.resolve(s,r)}l[t]=r}n.write(e,r)}e.stack.pop(),e.hiddenstack.pop()}}},
getTypescriptType(e){let t="{\n",n=e+"\t";for(let[e,r]of Object.entries(l))"$"!=e[0]&&(t+=n+e+": "+r.getTypescriptType(n)+",\n");return t+=e+"}[]",t},getJsonSchema:()=>({type:"array",items:{type:"object",
properties:Object.fromEntries([...Object.entries(l)].filter((([e])=>!e.startsWith("$"))).map((([e,t])=>[e,t.getJsonSchema()]))),required:u.filter((e=>!e.startsWith("$")))}})};const i=function(e,n,r){let i={stackdepth:r.stackdepth+1,resolve(t,n){
if("object"!=typeof t||!t)throw new Error("object expected");let i=t[e];return r.resolve(i,n)}};return Object.prototype.hasOwnProperty.call(l,n)?(o[n]??(o[n]=[]),o[n].push(i),i):Og(n,t,i)};let a=e.slice(1),s=Lg((function(e,n){return Og(e,t,{
stackdepth:n.stackdepth,resolve(e,t){if(!Array.isArray(e))throw new Error("array expected");return n.resolve(e.length,t)}})}),e[0],n),o={},l={},c=[];for(let e of a){
if(!Array.isArray(e))throw new Error("each argument for composed chunk should be an array");let t={};c.push(t);for(let r of e){if(!Array.isArray(r)||2!=r.length||"string"!=typeof r[0])throw new Error("each composedchunk should be a [name,type] pair")
;let e=Lg(i.bind(null,r[0]),r[1],n);t[r[0]]=e,l[r[0]]=e}}let u=c.flatMap(Object.keys);return r},bytesleft:function(){return{read:e=>e.endoffset-e.scan,write(e,t){},getTypescriptType:()=>"number",getJsonSchema:()=>({type:"integer"})}},
buffer:function(e,t,n){let r={read(e){let t=l.read(e),n=t*s*c.constr.BYTES_PER_ELEMENT,r=new ArrayBuffer(n);if(e.scan+n>e.endoffset)throw new Error("trying to read outside buffer bounds");let i=Ig.from(r);i.set(e.buffer.subarray(e.scan,e.scan+n)),
e.scan+=n;let a="buffer"==o?i:new c.constr(r);return"hex"==o?a.toJSON=()=>i.toString("hex"):!0===e.args.keepBufferJson?a.toJSON=()=>`buffer ${o}${1!=s?`[${s}]`:""}[${t}]`:a.toJSON=()=>`buffer ${o}${1!=s?`[${s}]`:""}[]{${[...a].join(",")}}`,a},
write(e,t){let n=Fg(t,c,o);if(n.length%s!=0)throw new Error("araybuffer is not integer multiple of vectorlength");l.write(e,n.length/s);let r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);e.buffer.set(r,e.scan),e.scan+=r.byteLength},
getTypescriptType:e=>c.constr.name,getJsonSchema:()=>({type:"string"})};if(e.length<1)throw new Error(`'read' variables interpretted as an array must contain items: ${JSON.stringify(e)}`);let i=e[1]??"buffer",a=e[2]??1
;if("string"!=typeof i||!Object.hasOwn(Rg,i))throw new Error("unknown buffer type "+e[1]);if("number"!=typeof a)throw new Error("vectorlength should be a number");let s=a,o=i,l=Lg((function(e,n){return Og(e,t,{stackdepth:n.stackdepth,resolve(e,t){
let r=Fg(e,c,o);return n.resolve(r.length/s,t)}})}),e[0],n);const c=Rg[i];return r},nullarray:function(e,t,n){let r={read(e){let t=[],n={$opcode:0};for(e.hiddenstack.push(n),e.stack.push({});;){let r=e.scan,i=s.read(e);if(kg&&kg.opcodes.push({
op:"$opcode",index:r,stacksize:e.stack.length}),n.$opcode=i,i==o.read(e))break;t.push(l.read(e))}return e.hiddenstack.pop(),e.stack.pop(),t},write(e,t){if(!Array.isArray(t))throw new Error("array expected");e.stack.push(t),e.hiddenstack.push({})
;for(let n of t)s.write(e,1),l.write(e,n);s.write(e,0),e.stack.pop(),e.hiddenstack.pop()},getTypescriptType:e=>`${l.getTypescriptType(e)}[]`,getJsonSchema:()=>({type:"array",items:l.getJsonSchema()})}
;if(e.length<1)throw new Error(`'read' variables interpretted as an array must contain items: ${JSON.stringify(e)}`);let i=e.length>=2?e[0]:"variable unsigned short",a=e.length>=3?e[1]:0,s=Lg(null,i,n),o=Lg(null,a,n),l=Lg((function(e,n){
return"$opcode"==e?{stackdepth:n.stackdepth+1,resolve(e,t){throw new Error("not implemented")}}:Og(e,t,{stackdepth:n.stackdepth+1,resolve(e,t){if(!Array.isArray(e))throw new Error("array expected");return n.resolve(e[0],t)}})}),e[e.length-1],n)
;return r},array:function(e,t,n){let r={read(e){let t=i.read(e),n=[];for(let r=0;r<t;r++)n.push(a.read(e));return n},write(e,t){if(!Array.isArray(t))throw new Error("array expected");i.write(e,t.length);for(let n=0;n<t.length;n++)a.write(e,t[n])},
getTypescriptType:e=>`${a.getTypescriptType(e)}[]`,getJsonSchema:()=>({type:"array",items:a.getJsonSchema()})};if(e.length<1)throw new Error(`'read' variables interpretted as an array must contain items: ${JSON.stringify(e)}`)
;let i=Lg((function(e,n){return Og(e,t,{stackdepth:n.stackdepth,resolve(e,t){if(!Array.isArray(e))throw new Error("array expected");return n.resolve(e.length,t)}})}),e.length>=2?e[0]:"variable unsigned short",n),a=Lg((function(e,n){return Og(e,t,{
stackdepth:n.stackdepth,resolve(e,t){if(!Array.isArray(e))throw new Error("array expected");return n.resolve(e[0],t)}})}),e[e.length>=2?1:0],n);return r},struct:function(e,t,n){let r={},i={read(e){let t={},n={};e.stack.push(t),e.hiddenstack.push(n),
kg&&!kg.rootstate&&(kg.rootstate=t);for(let r of o){kg&&kg.opcodes.push({op:r,index:e.scan,stacksize:e.stack.length});let i=s[r].read(e);void 0!==i&&("$"==r[0]?n[r]=i:t[r]=i)}return e.stack.pop(),e.hiddenstack.pop(),t},write(e,t){
if("object"!=typeof t||!t)throw new Error("object expected");let n={};e.stack.push(t),e.hiddenstack.push(n);for(let i of o){let a=t[i],o=s[i];if(i.startsWith("$")){if(null!=o.readConst)a=o.readConst(e);else{let e=r[i]
;if(!e)throw new Error("cannot write hidden values if they are not constant or not referenced");a??(a=0);for(let n of e)a=n.resolve(t,a)}n[i]=a}o.write(e,a)}e.stack.pop(),e.hiddenstack.pop()},getTypescriptType(e){let t="{\n",n=e+"\t"
;for(let e of o)"$"!=e[0]&&(t+=n+e+": "+s[e].getTypescriptType(n)+",\n");return t+=e+"}",t},getJsonSchema:()=>({type:"object",
properties:Object.fromEntries([...Object.entries(s)].filter((([e])=>!e.startsWith("$"))).map((([e,t])=>[e,t.getJsonSchema()]))),required:o.filter((e=>!e.startsWith("$")))})},a=function(e,n,i){let a={stackdepth:i.stackdepth+1,resolve(t,n){
if("object"!=typeof t||!t)throw new Error("object expected");let r=t[e];return i.resolve(r,n)}};return Object.prototype.hasOwnProperty.call(s,n)?(r[n]??(r[n]=[]),r[n].push(a),a):Og(n,t,a)},s={};for(let t of e){
if(!Array.isArray(t)||2!=t.length)throw new Error("each struct args should be a [name,type] pair");if("string"!=typeof t[0])throw new Error("prop name should be string");if(s[t[0]])throw new Error("duplicate struct prop "+t[0])
;s[t[0]]=Lg(a.bind(null,t[0]),t[1],n)}let o=Object.keys(s);return i},tuple:function(e,t,n){let r={read(e){let t=[];for(let n of a){let r=n.read(e);t.push(r)}return t},write(e,t){if(!Array.isArray(t))throw new Error("array expected")
;for(let[n,r]of a.entries())r.write(e,t[n])},getTypescriptType(e){let t="[\n",n=e+"\t";for(let e of a)t+=n+e.getTypescriptType(n)+",\n";return t+=e+"]",t},getJsonSchema:()=>({type:"array",items:Object.entries(a).map((([e,t])=>t.getJsonSchema())),
minItems:Object.keys(a).length,maxItems:Object.keys(a).length})};const i=function(e,n,r){return Og(n,t,{stackdepth:r.stackdepth,resolve(t,n){if(!Array.isArray(t))throw new Error("Array expected");return r.resolve(t[e],n)}})}
;let a=e.map(((e,t)=>Lg(i.bind(null,t),e,n)));return r},...Gg,...jg};var $g=n(6698),qg=n.n($g),Xg=n(8287).Buffer;const Yg=qg().parse(n(3537)),Kg=Xg.alloc(2097152);let Jg=0;class Zg{static fromJson(e){let t=qg().parse(e,void 0,!0);return new Zg(t,e)}
constructor(e,t){this.totaltime=0,this.parser=Lg(null,e,Yg),this.originalSource=t??JSON.stringify(e,void 0,"\t")}readInternal(e){let t=performance.now(),n=this.parser.read(e);if(this.totaltime+=performance.now()-t,e.scan!=e.endoffset&&(Jg++,
Jg<100&&console.log("bytes left over after decoding file: "+(e.endoffset-e.scan)),100==Jg&&console.log("too many bytes left over warning, no more warnings will be logged"),
e.buffer.byteLength<1e5))throw new Error("bytes left over after decoding file: "+(e.endoffset-e.scan));return n}read(e,t,n){let r={isWrite:!1,buffer:e,stack:[],hiddenstack:[],scan:0,endoffset:e.byteLength,args:{...t.getDecodeArgs(),...n}}
;return this.readInternal(r)}write(e,t){let n={isWrite:!0,stack:[],hiddenstack:[],buffer:Kg,scan:0,endoffset:Kg.byteLength,args:{clientVersion:1e3,...t}};if(this.parser.write(n,e),
n.scan>n.endoffset)throw new Error("tried to write file larger than scratchbuffer size");n.buffer.copyWithin(n.scan,n.endoffset,Kg.byteLength),n.scan+=Kg.byteLength-n.endoffset;let r=Uint8Array.prototype.slice.call(Kg,0,n.scan)
;return Kg.fill(0,0,n.scan),r}}globalThis.parserTimings=()=>{let e=Object.entries(Qg).map((e=>({name:e[0],t:e[1].totaltime})));e.sort(((e,t)=>t.t-e.t)),e.slice(0,10).filter((e=>e.t>.01)).forEach((e=>console.log(`${e.name} ${e.t.toFixed(3)}s`)))}
;const Qg={cacheIndex:Zg.fromJson(n(3417)),npc:Zg.fromJson(n(5258)),item:Zg.fromJson(n(3688)),object:Zg.fromJson(n(2244)),achievement:Zg.fromJson(n(4094)),mapsquareTiles:Zg.fromJson(n(7689)),mapsquareTilesNxt:Zg.fromJson(n(6222)),
mapsquareWaterTiles:Zg.fromJson(n(7421)),mapsquareUnderlays:Zg.fromJson(n(3653)),mapsquareOverlays:Zg.fromJson(n(5903)),mapsquareLocations:Zg.fromJson(n(8707)),mapsquareEnvironment:Zg.fromJson(n(6508)),mapZones:Zg.fromJson(n(6362)),
enums:Zg.fromJson(n(2835)),mapscenes:Zg.fromJson(n(1194)),sequences:Zg.fromJson(n(1171)),framemaps:Zg.fromJson(n(9774)),frames:Zg.fromJson(n(1901)),animgroupConfigs:Zg.fromJson(n(5191)),models:Zg.fromJson(n(3908)),oldmodels:Zg.fromJson(n(3813)),
classicmodels:Zg.fromJson(n(5602)),spotAnims:Zg.fromJson(n(1739)),rootCacheIndex:Zg.fromJson(n(1380)),skeletalAnim:Zg.fromJson(n(1092)),materials:Zg.fromJson(n(6914)),oldmaterials:Zg.fromJson(n(9833)),quickchatCategories:Zg.fromJson(n(3599)),
quickchatLines:Zg.fromJson(n(7146)),environments:Zg.fromJson(n(2536)),avatars:Zg.fromJson(n(466)),avatarOverrides:Zg.fromJson(n(4882)),identitykit:Zg.fromJson(n(2230)),structs:Zg.fromJson(n(7882)),params:Zg.fromJson(n(1140)),
particles_0:Zg.fromJson(n(2872)),particles_1:Zg.fromJson(n(5881)),audio:Zg.fromJson(n(9694)),proctexture:Zg.fromJson(n(9193)),oldproctexture:Zg.fromJson(n(2390)),maplabels:Zg.fromJson(n(4827)),cutscenes:Zg.fromJson(n(7135)),
clientscript:Zg.fromJson(n(1910)),clientscriptdata:Zg.fromJson(n(366)),interfaces:Zg.fromJson(n(4810)),dbtables:Zg.fromJson(n(1695)),dbrows:Zg.fromJson(n(8795))};var e_=n(8287).Buffer;function t_(e,t,n){
return(2*(e>>t&(1<<n)-1)*255+(1<<n)-1)/((1<<n)-1)/2}function n_(e,t,n){let r=32-n-t;return e<<r>>>r+t}function r_(e,t,n){let r=32-n-t;return e<<r>>r+t}function i_(e,t){return e[t]|e[t+1]<<8}function a_(e,t){
return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}
const s_=new Int16Array([2,8,-2,-8,5,17,-5,-17,9,29,-9,-29,13,42,-13,-42,18,60,-18,-60,24,80,-24,-80,33,106,-33,-106,47,183,-47,-183]),o_=new Int8Array([-3,-6,-9,-15,2,5,8,14,-3,-7,-10,-13,2,6,9,12,-2,-5,-8,-13,1,4,7,12,-2,-4,-6,-13,1,3,5,12,-3,-6,-8,-12,2,5,7,11,-3,-7,-9,-11,2,6,8,10,-4,-7,-8,-11,3,6,7,10,-3,-5,-8,-11,2,4,7,10,-2,-6,-8,-10,1,5,7,9,-2,-5,-8,-10,1,4,7,9,-2,-4,-8,-10,1,3,7,9,-2,-5,-7,-10,1,4,6,9,-3,-4,-7,-10,2,3,6,9,-1,-2,-3,-10,0,1,2,9,-4,-6,-8,-9,3,5,7,8,-3,-5,-7,-9,2,4,6,8]),l_=new Uint8Array([3,6,11,16,23,32,41,64])
;function c_(e){return e>255?255:e<0?0:e}function u_(e,t,n,r){return c_(e+o_[t<<3|r]*n)}function h_(e){return e<<4|e}function d_(e){return e<<3|e>>2}function p_(e){return e<<2|e>>4}function f_(e){return e<<1|e>>7}class m_{constructor(e,t,n){
if(this.bmpWidth=-1,this.bmpHeight=-1,this.isMaterialTexture=!!n,this.stripAlpha=t,this.imagefiles=[],this.cachedDrawables=[],this.cachedImageDatas=[],e instanceof ImageData)this.filesize=e.data.byteLength,this.type="imagedata",this.mipmaps=1,
this.cachedImageDatas=[Promise.resolve(e)];else if(this.filesize=e.byteLength,2303741511==e.readUint32BE(0))this.type="png",this.imagefiles.push(e),this.mipmaps=1;else{let t=0,n=0;for(;;){let r=e.readUInt8(n+t+1+4+0),i=e.readUInt8(n+t+1+4+1)
;if(0==r&&0==i){this.type="bmpmips";break}if(68==r&&68==i){this.type="dds";break}if(137==r&&80==i){this.type="png";break}if(171==r&&75==i){this.type="ktx";break}if(!(n++<=1))throw new Error("failed to detect texture")}1==n&&e.readUint8(t++),
this.mipmaps=e.readUInt8(t++),"bmpmips"==this.type&&(this.bmpWidth=e.readUInt32BE(t),t+=4,this.bmpHeight=e.readUInt32BE(t),t+=4);for(let n=0;n<this.mipmaps;n++){let r
;"bmpmips"==this.type?r=(this.bmpWidth>>n)*(this.bmpHeight>>n)*4:(r=e.readUInt32BE(t),t+=4),this.imagefiles.push(e.slice(t,t+r)),t+=r,this.cachedDrawables.push(null),this.cachedImageDatas.push(null)}}}toImageData(e=0){let t=this.cachedImageDatas[e]
;return t||(t=(async()=>{const t=this.isMaterialTexture?32:void 0;if("bmpmips"==this.type){let n=this.bmpWidth>>e,r=this.bmpHeight>>e,i=function(e,t,n,r=-1,i=!0){-1==r&&(r=0,console.warn("cannot infer padding size on bmp textures"))
;const a=4*t,s=r*a+4*r,o=n-2*r,l=t-2*r,c=4*l,u=new Uint8Array(c*o);for(let t=0;t<o;t++){const n=t*c;if(u.set(e.subarray(s+a*t,s+a*t+c),n),i)for(let e=n;e<n+c;e+=4)u[e+3]=255}return{data:u,width:l,height:o}}(this.imagefiles[e],n,r,t,this.stripAlpha)
;return Am(i.data,i.width,i.height)}if("png"==this.type)return Nm(this.imagefiles[e],"image/png",this.stripAlpha);if("dds"==this.type){let n=function(e,t=-1,n=!0){let r=function(e){let t=0,n=e.readUInt32LE(t);t+=4,e.readUInt32LE(t),t+=4
;let r=e.readUInt32LE(t);t+=4;let i=e.readUInt32LE(t);t+=4;let a=e.readUInt32LE(t);t+=4;let s=e.readUInt32LE(t);t+=4;let o=e.readUInt32LE(t);t+=4;let l=e.readUInt32LE(t);t+=4,t+=44;let c=e.readUInt32LE(t+8);t+=32,t+=20
;let u=894720068==c,h=827611204==c;if(!h&&!u)throw new Error("dds file is not dxt1 or dxt5 encoded as expected, continuing as dxt5");let d=[];for(let n=0;n<l;n++){let r=a>>n,s=i>>n,o=r*s*(u?16:8);d.push({width:r,height:s,data:e.slice(t,t+o)}),t+=o}
return{magic:n,flags:r,height:i,width:a,pitchorlinearsize:s,depth:o,isDxt1:h,isDxt5:u,mips:d}}(e);-1==t&&(t=r.isDxt5?32:0);let i=r.width-2*t,a=r.height-2*t,s=e_.alloc(i*a*4);if(function(e,t,n,r,i,a,s,o,l){
const c=l?16:8,u=l?8:0,h=new Uint8Array(4),d=new Uint8Array(4),p=new Uint8Array(4),f=new Uint8Array(8),m=new Uint16Array(8);for(let g=a/4;g<(a+o)/4;g++)for(let o=i/4;o<(i+s)/4;o++){let s=(r/4*g+o)*c;m[4]=i_(n,s+u+0),m[5]=i_(n,s+u+2),m[6]=i_(n,s+u+4),
m[7]=i_(n,s+u+6),h[0]=t_(m[4],11,5),d[0]=t_(m[4],5,6),p[0]=t_(m[4],0,5),h[1]=t_(m[5],11,5),d[1]=t_(m[5],5,6),p[1]=t_(m[5],0,5),f[0]=255,f[1]=255,f[2]=255,f[3]=255,m[4]>m[5]?(h[2]=(2*h[0]+h[1]+1)/3,d[2]=(2*d[0]+d[1]+1)/3,p[2]=(2*p[0]+p[1]+1)/3,
h[3]=(h[0]+2*h[1]+1)/3,d[3]=(d[0]+2*d[1]+1)/3,p[3]=(p[0]+2*p[1]+1)/3):(h[2]=(h[0]+h[1])/2,d[2]=(d[0]+d[1])/2,p[2]=(p[0]+p[1])/2,h[3]=0,d[3]=0,p[3]=0,f[3]=0);for(let n=0;n<16;n++){let r=4*(4*o+n%4-i)+(4*g+(n/4|0)-a)*t,s=m[n<8?6:7]>>n%8*2&3
;e[r+0]=h[s],e[r+1]=d[s],e[r+2]=p[s],e[r+3]=f[s]}if(l){if(m[0]=i_(n,s+0),m[1]=i_(n,s+2),m[2]=i_(n,s+4),m[3]=i_(n,s+6),f[0]=t_(m[0],0,8),f[1]=t_(m[0],8,8),f[0]>f[1])for(let e=0;e<6;e++)f[2+e]=((6-e)*f[0]+(1+e)*f[1]+3)/7;else{
for(let e=0;e<4;e++)f[2+e]=((4-e)*f[0]+(1+e)*f[1]+2)/5;f[6]=0,f[7]=255}let r=0,l=1;for(let n=0;n<16;n++){let s=4*(4*o+n%4-i)+(4*g+(n/4|0)-a)*t,c=m[l]>>r&7;r+=3,r>=16&&(r-=16,l++,c|=m[l]&1<<r-1),e[s+3]=f[c]}}}
}(s,4*i,r.mips[0].data,r.mips[0].width,t,t,i,a,r.isDxt5),n)for(let e=0;e<s.length;e+=4)s[e+3]=255;return{data:s,width:i,height:a}}(this.imagefiles[e],t,this.stripAlpha);return Am(n.data,n.width,n.height)}if("ktx"==this.type){
let n=function(e,t=-1,n=!0){let r=function(e){let t=0;e.readUInt32BE(t),t+=4,e.readUInt32BE(t),t+=4,e.readUInt32BE(t),t+=4;let n=e.readUint32BE(t);t+=4;let r=67305985!=n,i=()=>{let n=e.readUint32BE(t);return t+=4,
r?(255&(i=n))<<24|(65280&i)<<8|(16711680&i)>>>8|(4278190080&i)>>>24:n;var i},a=(i(),i(),i(),i()),s=(i(),i()),o=i(),l=(i(),i(),i(),i()),c=i();t+=c;let u=37496==a,h=37492==a
;if(!h&&!u)throw new Error("dds file is not dxt1 or dxt5 encoded as expected, continuing as dxt5");let d=[];for(let n=0;n<l;n++){let r=s>>n,a=o>>n,l=i();d.push({width:r,height:a,data:e.slice(t,t+l)}),t+=l}return{isDxt1:h,isDxt5:u,mips:d,width:s,
height:o}}(e);-1==t&&(t=r.isDxt5?32:0);let i=r.width-2*t,a=r.height-2*t,s=e_.alloc(i*a*4);if(function(e,t,n,r,i,a,s,o,l){const c=l?16:8,u=l?8:0,h=new Uint8Array(16);for(let d=a/4;d<(a+o)/4;d++)for(let o=i/4;o<(i+s)/4;o++){
let s,p,f,m,g,_,v,y,b,x=(r/4*d+o)*c,E=a_(n,x+u),w=a_(n,x+u+4),S=n_(E,0,1),T=n_(E,1,1),A=n_(E,27,5),C=n_(E,19,5),M=n_(E,11,5),I=A+r_(E,24,3),R=C+r_(E,16,3),k=M+r_(E,8,3),N=I>=0&&I<32,D=R>=0&&R<32,L=k>=0&&k<32;if(0==T||N&&D&&L){0==T?(s=h_(n_(E,28,4)),
m=h_(n_(E,24,4)),p=h_(n_(E,20,4)),g=h_(n_(E,16,4)),f=h_(n_(E,12,4)),_=h_(n_(E,8,4))):(s=d_(A),p=d_(C),f=d_(M),m=d_(I),g=d_(R),_=d_(k));let n=n_(E,5,3),r=n_(E,2,3);for(let l=0;l<16;l++){
let c=w>>>l+15&2|w>>>l&1,u=4*(4*o+(l/4|0)-i)+(4*d+l%4-a)*t,h=1==S?l%4<2:l<8,v=h?n:r;e[u+0]=c_((h?s:m)+s_[v<<2|c]),e[u+1]=c_((h?p:g)+s_[v<<2|c]),e[u+2]=c_((h?f:_)+s_[v<<2|c]),e[u+3]=255}}else if(N&&D){if(!L){s=p_(n_(E,25,6)),
p=f_(n_(E,24,1)<<6|n_(E,17,6)),f=p_(n_(E,16,1)<<5|n_(E,11,2)<<3|n_(E,7,3)),m=p_(n_(E,2,5)<<1|n_(E,0,1)),g=f_(n_(w,25,7)),_=p_(n_(w,19,6)),v=p_(n_(w,13,6)),y=f_(n_(w,6,7)),b=p_(n_(w,0,6));for(let n=0;n<16;n++){
let r=n%4,l=n/4|0,c=4*(4*o+r-i)+(4*d+l-a)*t;e[c+0]=c_(r*(m-s)+l*(v-s)+4*s+2>>2),e[c+1]=c_(r*(g-p)+l*(y-p)+4*p+2>>2),e[c+2]=c_(r*(_-f)+l*(b-f)+4*f+2>>2),e[c+3]=255}}}else{if(N){s=h_(n_(E,27,4)),p=h_(n_(E,24,3)<<1|n_(E,20,1)),
f=h_(n_(E,19,1)<<3|n_(E,15,3)),m=h_(n_(E,11,4)),g=h_(n_(E,7,4)),_=h_(n_(E,3,4));let e=(s<<16|p<<8|f)>=(m<<16|g<<8|_)?1:0,t=n_(E,2,1)<<2|n_(E,0,1)<<1|e,n=l_[t];h[0]=c_(s+n),h[1]=c_(p+n),h[2]=c_(f+n),h[4]=c_(s-n),h[5]=c_(p-n),h[6]=c_(f-n),h[8]=c_(m+n),
h[9]=c_(g+n),h[10]=c_(_+n),h[12]=c_(m-n),h[13]=c_(g-n),h[14]=c_(_-n)}else{h[0]=h_(n_(E,27,2)<<2|n_(E,24,2)),h[1]=h_(n_(E,20,4)),h[2]=h_(n_(E,16,4)),h[8]=h_(n_(E,12,4)),h[9]=h_(n_(E,8,4)),h[10]=h_(n_(E,4,4));let e=n_(E,2,2)<<1|n_(E,0,1),t=l_[e]
;h[4]=c_(h[8]+t),h[5]=c_(h[9]+t),h[6]=c_(h[10]+t),h[12]=c_(h[4]-t),h[13]=c_(h[5]-t),h[14]=c_(h[6]-t)}for(let n=0;n<16;n++){let r=w>>>n+15&2|w>>>n&1,s=4*(4*o+(n/4|0)-i)+(4*d+n%4-a)*t;e[s+0]=c_(h[r<<2]),e[s+1]=c_(h[r<<2|1]),e[s+2]=c_(h[r<<2|2]),
e[s+3]=255}}if(l){let r=a_(n,x),s=a_(n,x+4),l=n_(r,24,8),c=n_(r,20,4),u=n_(r,16,4),h=4*(4*o-i)+(4*d-a)*t+3;e[h+0+0*t]=u_(l,u,c,n_(r,13,3)),e[h+0+1*t]=u_(l,u,c,n_(r,10,3)),e[h+0+2*t]=u_(l,u,c,n_(r,7,3)),e[h+0+3*t]=u_(l,u,c,n_(r,4,3)),
e[h+4+0*t]=u_(l,u,c,n_(r,1,3)),e[h+4+1*t]=u_(l,u,c,n_(r,0,1)<<2|n_(s,30,2)),e[h+4+2*t]=u_(l,u,c,n_(s,27,3)),e[h+4+3*t]=u_(l,u,c,n_(s,24,3)),e[h+8+0*t]=u_(l,u,c,n_(s,21,3)),e[h+8+1*t]=u_(l,u,c,n_(s,18,3)),e[h+8+2*t]=u_(l,u,c,n_(s,15,3)),
e[h+8+3*t]=u_(l,u,c,n_(s,12,3)),e[h+12+0*t]=u_(l,u,c,n_(s,9,3)),e[h+12+1*t]=u_(l,u,c,n_(s,6,3)),e[h+12+2*t]=u_(l,u,c,n_(s,3,3)),e[h+12+3*t]=u_(l,u,c,n_(s,0,3))}}}(s,4*i,r.mips[0].data,r.mips[0].width,t,t,i,a,r.isDxt5),
n)for(let e=0;e<s.length;e+=4)s[e+3]=255;return{data:s,width:i,height:a}}(this.imagefiles[e],t,this.stripAlpha);return Am(n.data,n.width,n.height)}throw"imagedata"==this.type?new Error("image not found"):new Error("unknown format")})(),
this.cachedImageDatas[e]=t),t}async toWebgl(e=0){let t=this.cachedDrawables[e];return t||(t="png"==this.type?new Promise(((t,n)=>{let r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),t(r)},r.onerror=n;let i=new Blob([this.imagefiles[e]],{
type:"image/png"});r.src=URL.createObjectURL(i)})):this.toImageData(e).then((e=>createImageBitmap(e))),this.cachedDrawables[e]=t),t}}function g_(e){let t=[];for(let n=0;n<e.bonecount;n++)t.push({xsum:0,ysum:0,zsum:0,weightsum:0})
;for(let n of e.meshes){let e=n.attributes.boneids,r=n.attributes.boneweights,i=n.attributes.pos,a=n.indices;if(e&&r)for(let n=0;n<a.count;n++){let s=a.array[n];for(let n=0;n<e.itemSize;n++){
let a=e.array[s*e.itemSize+n],o=r.array[s*r.itemSize+n],l=t[a];l.xsum+=i.array[i.itemSize*s+0]*o,l.ysum+=i.array[i.itemSize*s+1]*o,l.zsum+=i.array[i.itemSize*s+2]*o,l.weightsum+=o}}}return t}function __(e){return new ca(new Float32Array(e),3)}
function v_(e,t){let n=new Uint8Array(4*t.length),r=new Uint8Array(4*t.length);for(let e=0;e<t.length;e++){let i=t[e];i=65535==i?0:i+1,n[4*e]=i,r[4*e]=255}e.boneids=new ca(n,4),e.boneweights=new ca(r,4,!0)}function y_(e,t,n){
if(n instanceof Uint16Array){let r=new Float32Array(2*t);for(let e=0;e<2*t;e++)r[e]=mm(n[e]);e.texuvs=new ca(r,2)}else e.texuvs=new ca(n,2)}function b_(e,t){let n=new Int8Array(t.length);for(let e=0;e<t.length;e+=3){
let r=t[e+0],i=t[e+1],a=t[e+2],s=Math.hypot(r,i,a);0==s&&(s=1);let o=127/s;n[e+0]=Math.round(r*o),n[e+1]=Math.round(i*o),n[e+2]=Math.round(a*o)}e.normals=new ca(n,3,!0)}"undefined"!=typeof TextEncoder?TextEncoder:n(537).TextEncoder,Int8Array,
Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let x_=0,E_=[0,0,0,0,0,0,0,0,0],w_=[0,0,0,0,0,0,0,0,0];function S_(e,t,n,r,i,a,s){let o=[0,0,0,0,0,0,0,0,0],l=Math.cos(.024543693*r),c=Math.sin(.024543693*r);E_[0]=l,
E_[1]=0,E_[2]=c,E_[3]=0,E_[4]=1,E_[5]=0,E_[6]=-c,E_[7]=0,E_[8]=l;let u=1,h=0,d=t/32767,p=-Math.sqrt(1-Math.min(1,d*d)),f=1-d,m=Math.sqrt(e*e+n*n);return 0==m&&0==d?o=E_:(0!=m&&(u=-n/m,h=e/m),w_[0]=d+u*u*f,w_[1]=h*p,w_[2]=h*u*f,w_[3]=-h*p,w_[4]=d,
w_[5]=u*p,w_[6]=u*h*f,w_[7]=-u*p,w_[8]=d+h*h*f,o[0]=E_[0]*w_[0]+E_[1]*w_[3]+E_[2]*w_[6],o[1]=E_[0]*w_[1]+E_[1]*w_[4]+E_[2]*w_[7],o[2]=E_[0]*w_[2]+E_[1]*w_[5]+E_[2]*w_[8],o[3]=E_[3]*w_[0]+E_[4]*w_[3]+E_[5]*w_[6],
o[4]=E_[3]*w_[1]+E_[4]*w_[4]+E_[5]*w_[7],o[5]=E_[3]*w_[2]+E_[4]*w_[5]+E_[5]*w_[8],o[6]=E_[6]*w_[0]+E_[7]*w_[3]+E_[8]*w_[6],o[7]=E_[6]*w_[1]+E_[7]*w_[4]+E_[8]*w_[7],o[8]=E_[6]*w_[2]+E_[7]*w_[5]+E_[8]*w_[8]),o[0]*=i,o[1]*=i,o[2]*=i,o[3]*=a,o[4]*=a,
o[5]*=a,o[6]*=s,o[7]*=s,o[8]*=s,o}function T_(e,t,n){return(-1==e?4194303:e)|(t?8388608:0)|(n?4194304:0)}function A_(e,t,n){let r=Qg.materials.read(e,n),i={textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,
baseColor:[1,1,1],alphamode:"opaque",alphacutoff:.1,stripDiffuseAlpha:!1,raw:null};if(i.raw=r,r.v0){let e=r.v0,a=e.arr.find((e=>1==e.op))
;a?n.getBuildNr()<=838?i.textures.diffuse=a.value:i.textures.diffuse=t:e.diffuse?i.textures.diffuse=e.diffuse:17&e.textureflags&&(i.textures.diffuse=t),e.normal?i.textures.normal=e.normal:10&e.textureflags&&(i.textures.normal=t)
;let s=7&e.texrepeatflags,o=e.textureflags>>2&7;if(i.texmodes=0==s?"mirror":1==s?"repeat":"clamp",i.texmodet=0==o?"mirror":1==o?"repeat":"clamp",i.alphamode=0==e.alphamode?"opaque":1==e.alphamode?"cutoff":"blend",
e.alphacutoff&&(i.alphacutoff=e.alphacutoff/255),e.animtexU||e.animtexV){let t=1/32768;i.uvAnim={u:(e.animtexU??0)*t,v:(e.animtexV??0)*t}}e.extra&&(i.baseColorFraction=e.extra.baseColorFraction/255,
i.baseColor=0==e.extra.baseColor?[1,1,1]:gm(bm(e.extra.baseColor))),i.stripDiffuseAlpha="opaque"==i.alphamode}else{if(!r.v1)throw new Error("unkown material version "+r.version);{let e=r.v1;if(i.alphamode=e.opaque_2&&!e.hasUVanimU?"cutoff":"blend",
i.baseColorFraction=1,e.diffuse&&(i.textures.diffuse=e.diffuse.texture),e.normal&&(i.textures.normal=e.normal.texture),e.compound&&(i.textures.compound=e.compound.texture),e.uvanim_u||e.uvanim_v){let t=1/32768;i.uvAnim={u:(e.uvanim_u??0)*t,
v:(e.uvanim_v??0)*t}}}}return i}var C_=n(8287).Buffer;const M_=3988292384,I_=new Uint32Array(256),R_=new Uint32Array(256);function k_(e,t=0,n=0,r=e.length){t^=4294967295;for(let i=n;i<r;i++)t=t>>>8^I_[255&(t^e[i])];return(4294967295^t)>>>0}
!function(){for(let e=0;e<256;e++){let t=e,n=e<<24;for(let e=8;e>0;e--)1&~t?t>>>=1:t=t>>>1^M_,2147483648&n?n=(n^M_)<<1|1:n<<=1,n&=4294967295;I_[e]=4294967295&t,R_[e]=n}}();const N_=C_.alloc(4);function D_(e,t){return N_.writeUInt32BE(e>>>0),k_(N_,t)}
class L_{constructor(e=0){this.crc=4294967295^e}addbyte(e){this.crc=this.crc>>>8^I_[255&(this.crc^255&e)]}addUint16Flipped(e){this.crc=this.crc>>>8^I_[255&(this.crc^e>>16&255)],this.crc=this.crc>>>8^I_[255&(this.crc^255&e)]}addUint16(e){
this.crc=this.crc>>>8^I_[255&(this.crc^255&e)],this.crc=this.crc>>>8^I_[255&(this.crc^e>>16&255)]}addUint32(e){this.crc=this.crc>>>8^I_[255&(this.crc^255&e)],this.crc=this.crc>>>8^I_[255&(this.crc^e>>16&255)],
this.crc=this.crc>>>8^I_[255&(this.crc^e>>24&255)],this.crc=this.crc>>>8^I_[255&(this.crc^e>>32&255)]}get(){return(4294967295^this.crc)>>>0}fork(){return new L_(this.get())}}function O_(e,t,n=0,r=e.length){t^=4294967295
;for(let i=r-1;i>=n;i--)t=t<<8&4294967295^R_[t>>>24]^e[i];return(4294967295^t)>>>0}function P_(e,t=!1,n=4){let r=C_.alloc(n);return t?r.writeUIntBE(e>>>0,0,n):r.writeUIntLE(e>>>0,0,n),r}function F_(e,t){let n=P_(e);return P_(O_(n,t))}
var U_=n(8287).Buffer,B_=n(8287).Buffer;function z_(e,t){switch(e.readUInt8(0)){case 0:return G_(e);case 1:return V_(e);case 2:return j_(e,t);case 3:return q_(e);case 90:return function(e){return e.readUInt32BE(4),n(8559).inflateSync(e.slice(8))}(e)
;default:throw new Error("Unknown compression type ("+e.readUInt8(0).toString()+")")}}var G_=function(e){var t=e.readUInt32BE(1),n=B_.alloc(t);return e.copy(n,0,5),n},V_=function(e){var t=n(7996),r=e.readUInt32BE(1),i=(e.readUInt32BE(5),
B_.alloc(r+2+1+1));return e.copy(i,4,9),i.writeUInt16BE(16986,0),i.writeUInt8(104,2),i.writeUInt8(56,3),B_.from(t.simple(t.array(i)))};function H_(e){var t=n(7996),r=B_.alloc(e.byteLength+4);return e.copy(r,4),r.writeUInt16BE(16986,0),
r.writeUInt8(104,2),r.writeUInt8(56,3),B_.from(t.simple(t.array(r)))}var j_=function(e,t){var r=n(8559);try{let n=e.readUint32BE(1);if(t){let i=function(e,t){let n=U_.allocUnsafe(e.length),r=0;for(;r<=e.length-8;r+=8){
let a=e.readUInt32BE(r+0),s=e.readUInt32BE(r+4);for(var i=3337565984;i;)s-=(a<<4>>>0^a>>>5)+a^i+t[i>>11&3],s>>>=0,a-=(s<<4>>>0^s>>>5)+s^(i=i-2654435769>>>0)+t[3&i],a>>>=0;n.writeUInt32BE(a,r+0),n.writeUInt32BE(s,r+4)}return e.copy(n,r,r,n.length),n
}(e.slice(5,9+n),t);return r.gunzipSync(i.slice(4,4+n))}{let t=e.slice(9,9+n);return r.gunzipSync(t)}}catch(e){throw new Error(`gzip decompress failed, possibly due to missing or wrong xtea key, key: ${t??"none"}`,{cause:e})}};let W_=null,$_=!1
;var q_=function(e){var t=e.readUInt32BE(1),r=e.readUInt32BE(5),i=B_.alloc(t+8);if(e.copy(i,0,9,14),i.writeUInt32LE(r,5),i.writeUInt32LE(0,9),e.copy(i,13,14),!$_&&!W_){$_=!0;try{W_=require("lzma-native").LZMA()}catch(e){
console.log("can't load native lzma, falling back to naive js implementation")}}if(W_)return W_.decompress(i);var a=n(611).j;return B_.from(a.decompress(i))};function X_(e,t,n,r,i,a){let s=n*r,o=0,l=new Uint8ClampedArray(4*s),c=o,u=o+s;o+=s+(i?s:0)
;for(let s=0;s<r;s++)for(let o=0;o<n;o++){let h=4*o+s*n*4,d=a?s+o*r:o+s*n,p=e.readUInt8(c+d);if(0==p)l[h+0]=0,l[h+1]=0,l[h+2]=0,l[h+3]=0;else{let n=3*(p-1);l[h+0]=t[n+0],l[h+1]=t[n+1],l[h+2]=t[n+2],l[h+3]=i?e.readUInt8(u+d):255}}return{img:Am(l,n,r),
bytesused:o}}function Y_(e,t){let n=new pm(t),r=n.readUShort(!0);if(!e)throw new Error("sprite meta file not found");let i=new pm(e);i.skip(r);let a=i.readUShort(!0),s=i.readUShort(!0),o=i.readUByte()-1,l=i.readBuffer(3*o),c=[];for(;!n.eof();){
let e=i.readUByte(),t=i.readUByte(),r=i.readUShort(!0),o=i.readUShort(!0),u=0!=i.readUByte(),h=n.readBuffer(r*o);c.push({x:e,y:t,fullwidth:a,fullheight:s,img:X_(h,l,r,o,!1,u).img})}return 1!=c.length&&console.log(c),c[0]}function K_(e){
if(0==e.x&&0==e.y&&e.fullwidth==e.img.width&&e.fullheight==e.img.height)return e.img;let t=new ImageData(e.fullwidth,e.fullheight);for(let n=0;n<e.img.height;n++){let r=4*e.img.width,i=n*r,a=4*t.width,s=(n+e.y)*a+4*e.x
;t.data.set(e.img.data.subarray(i,i+r),s)}return t}function J_(e){let t=e.readUInt16BE(e.length-2),n=32767&t,r=[];if(t>>15){let t=0,n=e.readUInt8(t);if(t++,0!=n)throw new Error("unknown type");let i=e.readUInt8(t);t++
;let a=!!(1&i),s=e.readUInt16BE(t);t+=2;let o=e.readUInt16BE(t);t+=2;let l=t;t+=s*o*3;let c=t;t+=a?s*o:0;let u=new Uint8ClampedArray(s*o*4);for(let t=0;t<o;t++)for(let n=0;n<s;n++){let r=4*n+t*s*4,i=n+t*s;u[r+0]=e.readUInt8(l+3*i+0),
u[r+1]=e.readUInt8(l+3*i+1),u[r+2]=e.readUInt8(l+3*i+2),u[r+3]=a?e.readUInt8(c+i+2):255}r.push({x:0,y:0,fullwidth:s,fullheight:o,img:Am(u,s,o)})}else{let t=7+8*n,i=e.length-t,a=e.readUInt16BE(i);i+=2;let s=e.readUInt16BE(i);i+=2;let o=e.readUInt8(i)
;i++;let l=[];for(let t=0;t<n;t++)l.push({x:e.readUInt16BE(i+0*n+2*t),y:e.readUInt16BE(i+2*n+2*t),width:e.readUInt16BE(i+4*n+2*t),height:e.readUInt16BE(i+6*n+2*t)});let c=e.slice(e.length-t-3*o,e.length-t);i=0
;for(let t of l)if(0!=t.width&&0!=t.height){let n=e.readUInt8(i);i++;let o=!!(1&n),l=!!(2&n),u=X_(e.slice(i),c,t.width,t.height,l,o);i+=u.bytesused,r.push({x:t.x,y:t.y,fullwidth:a,fullheight:s,img:u.img})}}return r}
const Z_=0,Q_=1,ev=4,tv=2,nv=4,rv=5,iv=6;function av(e,t,n){if(!n&&0!=t)return[{buffer:e,fileid:0,namehash:null,offset:0,size:e.byteLength}];let r=new pm(e),i=r.readTribyte();if(r.readTribyte()!=i&&(r=new pm(H_(r.readBuffer())),
r.bytesLeft()!=i))throw new Error("decompress failed");let a=[],s=r.readUShort(!0),o=r.tee().skip(10*s);for(let e=0;e<s;e++){let t=r.readUInt(!0),n=r.readTribyte(),i=r.readTribyte(),s=o.scanloc(),l=o.readBuffer(i);if(n!=i&&(l=H_(l),
l.length!=n))throw new Error("decompress failed");a.push({fileid:e,buffer:l,offset:s,size:n,namehash:t})}return a}function sv(e){
let t=am("MAP_INDEX",!0),n=am("MAP_VERSION",!0),r=am("MAP_CRC",!0),i=e.find((e=>e.namehash==t)),a=e.find((e=>e.namehash==n)),s=e.find((e=>e.namehash==r));if(!i||!a||!s)throw new Error
;let o=new pm(i.buffer),l=new pm(a.buffer),c=new pm(s.buffer),u=new Map;for(;!o.eof();)u.set(o.readUShort(!0),{map:o.readUShort(!0),loc:o.readUShort(!0),crc:c.readUInt(!0),version:l.readUShort(!0)}),o.readUByte();return u}function ov(e,t){
let n=am(`${t}.IDX`,!0),r=am(`${t}.DAT`,!0),i=e.find((e=>e.namehash==n)),a=e.find((e=>e.namehash==r));if(!i||!a)throw new Error;let s=new pm(i.buffer),o=s.readUShort(!0),l=2,c=[];for(let e=0;e<o;e++){let e=s.readUShort(!0)
;c.push(a.buffer.slice(l,l+e)),l+=e}return c}async function lv(e,t,n){let r=`${t}.${n?"tga":"dat"}`,i=await e.findSubfileByName(Z_,iv,r);return n?function(e){let t=new pm(e),n=t.readUByte(),r=t.readUByte(),i=(t.readUByte(),t.readUShort(!1),
t.readUShort(!1)),a=t.readUByte(),s=t.readUShort(!1),o=t.readUShort(!1),l=t.readUShort(!1),c=t.readUShort(!1),u=t.readUByte(),h=t.readUByte();if(t.skip(n),1!=r||8!=u)throw new Error("only palette based uncompressed TGA supported")
;if(24!=a)throw new Error("only 24bpp rgb TGA supported");if(0!=h)throw new Error("no fancy TGA's allowed");let d=t.readBuffer(3*i),p=new Uint8ClampedArray(l*c*4);for(let e=0;e<c;e++)for(let n=0;n<l;n++){let r=4*n+e*l*4,i=3*t.readUByte()
;p[r+0]=d[i+2],p[r+1]=d[i+1],p[r+2]=d[i+0],p[r+3]=255,255==p[r+0]&&0==p[r+1]&&255==p[r+2]&&(p[r+0]=0,p[r+1]=0,p[r+2]=0,p[r+3]=0)}return t.eof||console.warn("didn't parse TGA sprite to completion"),{x:s,y:o,fullwidth:l,fullheight:c,img:Am(p,l,c)}
}(i.buffer):cv(e,i.buffer)}async function cv(e,t){return Y_((await e.findSubfileByName(Z_,iv,"INDEX.DAT")).buffer,t)}async function uv(e,t,n,r){let i=await lv(e,t,r);if(!n)return i;let a=await lv(e,n,r)
;if(a.img.width+a.x>i.img.width||a.img.height+a.y>i.img.height)return console.warn("tried to overlay image outside of dest bounds"),i;let s=Am(i.img.data.slice(),i.img.width,i.img.height);for(let e=0;e<a.img.height;e++)for(let t=0;t<a.img.width;t++){
let n=4*(e*a.img.width+t),r=4*((e+a.y)*i.img.width+(t+a.x)),o=a.img.data[n+0],l=a.img.data[n+1],c=a.img.data[n+2],u=a.img.data[n+3],h=0==o&&255==l&&0==c&&255==u,d=255==u;s.data[r+0]=h?0:d?o:i.img.data[r+0],s.data[r+1]=h?0:d?l:i.img.data[r+1],
s.data[r+2]=h?0:d?c:i.img.data[r+2],s.data[r+3]=h?0:d?u:i.img.data[r+3]}return{x:i.x,y:i.y,fullwidth:i.fullwidth,fullheight:i.fullheight,img:s}}var hv=n(8287).Buffer;function dv(e,t,n){if(1==t.length)return[{buffer:e,offset:0,size:e.byteLength,
fileid:t[0],namehash:n?.[0]??null}];let r=0;e.readUInt8(r),r++;let i=e.readUInt32BE(r);r+=4;let a=[];for(let s=0;s<t.length;s++){let o=e.readUInt32BE(r);r+=4,a.push({buffer:e.slice(i,o),offset:i,size:o-i,fileid:t[s],namehash:n?.[s]??null}),i=o}
return a}globalThis.ignoreCache=!1;class pv{constructor(e){this.files=e}forgecrc(e,t,n){let r=0;for(let e=0;e<this.files.length;e++){if(e==t){r=k_(this.files[e],r,0,n);break}r=k_(this.files[e],r)}let i=e;i=O_(this.networkFooter(),i)
;for(let e=this.files.length-1;e>=0;e--){if(e==t){i=k_(this.files[e],i,0,n+4);break}i=k_(this.files[e],i)}console.log("forging file",t,n,F_(r,i)),this.files[t]=hv.from(this.files[t]),F_(r,i).copy(this.files[t],n)}networkFooter(){
if(1==this.files.length)return hv.from([]);let e=1+4*this.files.length,t=hv.alloc(e),n=0,r=0;for(let e of this.files)t.writeInt32BE(e.byteLength-n,r),n=e.byteLength,r+=4;return t.writeUInt8(1,e-1),t}packNetwork(){
return hv.concat([...this.files,this.networkFooter()])}sqliteHeader(){if(1==this.files.length)return hv.from([]);let e=5+4*this.files.length,t=hv.alloc(e),n=0,r=e;t.writeUInt8(1,n),n++,t.writeUInt32BE(r,n),n+=4
;for(let e of this.files)r+=e.byteLength,t.writeUInt32BE(r,n),n+=4;return t}packSqlite(){return hv.concat([this.sqliteHeader(),...this.files])}}function fv(e,t,n){if(e==xg.index)return function(e,t){
return Qg.rootCacheIndex.read(e,t).cachemajors.map((e=>{if(0!=e.crc)return{major:255,minor:e.minor,crc:e.crc,version:e.version,size:0,name:null,subindexcount:e.subindexcount,subindices:[0],subnames:null,uncompressed_crc:0,uncompressed_size:0}}))
}(t,n);let r=Qg.cacheIndex.read(t,n).indices,i=[];for(let t of r)i[t.minor]=Object.assign(t,{major:e});return i}const mv={[xg.items]:256,[xg.npcs]:128,[xg.structs]:32,[xg.enums]:256,[xg.objects]:256,[xg.sequences]:128,[xg.spotanims]:256,
[xg.achievements]:128,[xg.materials]:Number.MAX_SAFE_INTEGER},gv={[xg.items]:Ag.items_old,[xg.npcs]:Ag.npcs_old,[xg.objects]:Ag.locs_old,[xg.spotanims]:Ag.spotanim_old};function _v(e,t,n){if(n<488){let n=gv[e];if(void 0!==n)return{major:xg.config,
minor:n,subid:t}}let r=mv[e]??1;return{minor:Math.floor(t/r),major:e,subid:t%r}}function vv(e,t,n){return t*(mv[e]??1)+n}class yv{constructor(){this.decodeArgs={}}getCacheMeta(){return{name:"unkown",descr:"",timestamp:new Date(0)}}getFile(e,t,n){
throw new Error("not implemented")}getFileArchive(e){throw new Error("not implemented")}getCacheIndex(e){throw new Error("not implemented")}getBuildNr(){return 940}getDecodeArgs(){return this.decodeArgs.clientVersion=this.getBuildNr(),this.decodeArgs
}writeFile(e,t,n){throw new Error("not implemented")}writeFileArchive(e,t,n){throw new Error("not implemented")}async getIndexEntryById(e,t){let n;if(n=this.getBuildNr()<=Cg?{major:e,minor:t,crc:0,name:null,subindexcount:1,subindices:[0],
subnames:null,version:0}:(await this.getCacheIndex(e))[t],!n)throw new Error(`minor id ${t} does not exist in major ${e}.`);return n}async getArchiveById(e,t){let n=await this.getIndexEntryById(e,t);return this.getFileArchive(n)}
async getFileById(e,t){let n=_v(e,t,this.getBuildNr()),r=(await this.getArchiveById(n.major,n.minor)).find((e=>e.fileid==n.subid));if(!r)throw new Error(`File ${t} in major ${e} not found, (redirected to ${n.major}.${n.minor}.${n.subid})`)
;return r.buffer}async findFileByName(e,t){let n=am(t,this.getBuildNr()<=Cg);return(await this.getCacheIndex(e)).find((e=>e&&e.name==n))}async findSubfileByName(e,t,n){let r=am(n,this.getBuildNr()<=Cg)
;return(await this.getArchiveById(e,t)).find((e=>e&&e.namehash==r))}async bruteForceFindAnyNamedFile(e){let t=await this.getCacheIndex(xg.index);for(let n of t){if(!n)continue;let t=await this.findFileByName(n.minor,e)
;if(t)return this.getFileArchive(t)}return null}close(){}}class bv extends yv{constructor(e){super(),this.indexMap=new Map,this.xteakeys=null,this.requiresCrc=e}getFile(e,t,n){throw new Error("not implemented")}async getFileArchive(e){
let t=await this.getFile(e.major,e.minor,e.crc);return this.getBuildNr()<=Cg?av(t,e.major,this.getBuildNr()<=Mg):function(e,t,n){if(1==t.length)return[{buffer:e,offset:0,size:e.byteLength,fileid:t[0],namehash:n?.[0]??null}]
;let r=e.readUInt8(e.length-1);var i=e.length-1-4*t.length*r,a=[],s=0;for(let c=0;c<r;c++)for(var o=0,l=0;l<t.length;++l){o+=e.readInt32BE(i),i+=4;let r=o,c=e.slice(s,s+r);s+=r;let u=a[l];u?(u.buffer=hv.concat([u.buffer,c]),u.size+=r):a[l]={buffer:c,
offset:s,size:r,fileid:t[l],namehash:n?.[l]??null}}return a}(t,e.subindices,e.subnames)}getXteaKey(e,t){let n=e<<23|t;return this.xteakeys?.get(n)}getCacheIndex(e){let t=this.indexMap.get(e);return t||(t=(async()=>{let t
;this.requiresCrc&&e!=xg.index&&(t=(await this.getCacheIndex(xg.index))[e].crc);let n=await this.getFile(xg.index,e,t);return fv(e,n,this)})(),this.indexMap.set(e,t)),t}}class xv extends bv{constructor(e,t){super(t),this.getFile=e}getCacheMeta(){
return{name:"callback",descr:"Cache source based on external getter",timestamp:new Date(0)}}}class Ev extends yv{constructor(e){super(),this.archieveCache=new Map,this.cachedObjects=[],this.cacheFetchCounter=0,this.cacheAddCounter=0,
this.maxcachesize=2e8,this.rawsource=e}fetchCachedObject(e,t,n,r){let i=e.get(t);if(!i||globalThis.ignoreCache){let a=n();i={promise:a,data:null,owner:e,id:t,lastuse:0,size:0,usecount:0},a.then((e=>{i.size=r(e),i.promise=null,i.data=e})),
this.cachedObjects.push(i),e.set(t,i),++this.cacheAddCounter%100==0&&this.sweepCachedObjects()}return i.usecount++,i.lastuse=this.cacheFetchCounter++,i.data?Promise.resolve(i.data):i.promise}sweepCachedObjects(){
let e=e=>Math.min(100,this.cacheFetchCounter-e.lastuse)+Math.max(-100,10*-e.usecount);this.cachedObjects.sort(((t,n)=>e(t)-e(n)));let t=this.cachedObjects.length,n=0;for(let e=0;e<this.cachedObjects.length;e++){let r=this.cachedObjects[e];n+=r.size,
n>this.maxcachesize?(t=Math.min(t,e),r.owner.delete(r.id)):r.usecount=0}this.cachedObjects.length=t}getCacheIndex(e){return this.rawsource.getCacheIndex(e)}getFile(e,t,n){return this.rawsource.getFile(e,t,n)}getFileArchive(e){
let t=()=>this.rawsource.getFileArchive(e);if(e.major==xg.models||e.major==xg.texturesBmp||e.major==xg.texturesDds||e.major==xg.texturesPng)return t();{let n=e.major<<23|e.minor
;return this.fetchCachedObject(this.archieveCache,n,t,(e=>e.reduce(((e,t)=>e+t.size),0)))}}getBuildNr(){return this.rawsource.getBuildNr()}getCacheMeta(){return this.rawsource.getCacheMeta()}}var wv=n(8487),Sv=n.n(wv),Tv=n(8287).Buffer
;async function Av(e,t,n,r,i=!1){let a=r??await e.getFileById(t,n);if(1245792065!=a.readUint32BE())return a;let s=Qg.audio.read(a,e),o=i?await async function(e,t,n=4){let r=[],i=0,a=0,s=[];for(let o of e)i>=a+n&&(s.push(await r[a%n]),a++),
r[i%n]=t(o,i),i++;for(;a<i;)s.push(await r[a%n]),a++;return s}(s.chunks,(n=>n.data??e.getFileById(t,n.fileid)),8):s.chunks.filter((e=>e.data)).map((e=>e.data)),l=[],c=0n,u=0;for(let[e,t]of o.entries()){let n=0n;for(let r=0;r<t.length;){let i=r
;t.readUint32BE(r),r+=4,t.readUint8(r),r+=1,t.readUint8(r),r+=1;let a=t.readBigInt64LE(r);r+=8,t.readUint32LE(r),r+=4,t.readUint32LE(r),r+=4,t.readUint32LE(r),r+=4;let s=t.readUint8(r);r+=1;let h=0;for(let e=0;e<s;e++)h+=t.readUint8(r),r+=1
;let d=Uint8Array.prototype.slice.call(t,i,r),p=t.slice(r,r+h);r+=h;let f=0==i&&0==e,m=e==o.length-1&&r==t.length;d.writeUint8(+f<<1|+m<<2,5),d.writeBigInt64LE(a+c,6),d.writeUint32LE(u++,18),d.writeUInt32LE(0,22);let g=Mv(p,Mv(d))
;d.writeUint32LE(g,22),0!=e&&0==r||(l.push(d),l.push(p)),n=a}c+=n}return Tv.concat(l)}
const Cv=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188])
;function Mv(e,t=0,n=0,r=e.length){t^=0;for(let i=n;i<r;i++)t=t<<8^Cv[t>>>24&255^e[i]];return(0^t)>>>0}const Iv={textures:6,models:101,entity:102,maps:103,land:104,filter:105,jagex:106,media:107,sounds:108,config:110}
;function Rv(e,t,n,r,i,a,s,o,l,c,u,h,d){return{buildnr:e,locsjson:h,name:d,date:t,versions:{config:n,maps:r,land:i,media:a,models:s,textures:o,entity:l,sounds:c,filter:u}}}
const kv=[Rv(115,new Date("2001-12-24 20:28"),48,27,0,28,12,8,10,0,0,null,"dec 2001 - last original world data"),Rv(230,new Date("2004-02-18 11:43"),100,100,100,100,100,100,100,100,100,"SceneryLocs.json","Last version of entered files")],Nv=Object.fromEntries(Object.entries(Iv).map((([e,t])=>[t,e])))
;class Dv extends yv{constructor(e,t){super(),this.fs=e,this.usingversion=t}static async create(e,t){if(!t){let n=function(e){let t=[];for(let e of kv)t.push({buildnr:e.buildnr,iscomplete:!1,locsjson:e.locsjson,target:e.versions,
foundjag:Object.fromEntries(Object.entries(e.versions).map((([e])=>[e,0]))),foundmem:Object.fromEntries(Object.entries(e.versions).map((([e])=>[e,0])))});for(let n of e){let e=n.match(/^(?<name>[a-zA-Z]+)(?<version>\d+)\.(?<type>jag|mem)$/);if(e){
let n=+e.groups.version,r="mem"==e.groups.type,i=e.groups.name;for(let e of t){let t=r?e.foundmem:e.foundjag;e.target[i]&&n<=e.target[i]&&n>t[i]&&(t[i]=n)}}}for(let e of t){let t=!0;for(let n in e.target)e.foundjag[n]!=e.target[n]&&(t=!1),
0!=e.foundmem[n]&&e.foundmem[n]!=e.target[n]&&(t=!1);e.iscomplete=t}return t}((await e.readDir(".")).map((e=>e.name))),r=localStorage.rsmv_classicversion??"-1";t=n.at(+r)}return new Dv(e,t)}async getFileArchive(e){
if(0!=e.major)throw new Error("all files are placed in index 0 for classic caches");let t=Nv[e.minor],n=await this.getNamedFile(t,!1),r=await this.getNamedFile(t,!0),i=n?av(n,e.major,!0):[],a=r?av(r,e.major,!0):[]
;if(0==i.length&&0==a.length)throw new Error("no files found in index "+e.minor);return[...i,...a]}async getNamedFile(e,t){if(!this.usingversion||!this.fs)throw new Error("no classic files loaded in classic cache loader")
;let n=(t?this.usingversion.foundmem:this.usingversion.foundjag)[e];if(!n)return null;let r=`${e}${n}.${t?"mem":"jag"}`;return console.log("loading",r),this.fs.readFileBuffer(r)}getBuildNr(){return this.usingversion?.buildnr??200}getCacheMeta(){
return this.usingversion?{name:`Classic ${this.getBuildNr()}`,descr:`${Object.entries(this.usingversion.foundjag).map((([e,t])=>`${e}: ${t}`)).join("\n")}`,timestamp:new Date(0)}:{name:"Classic",descr:"no files loaded",timestamp:new Date(0)}}
async getFile(e,t){throw new Error("can only load archives in a classic cache")}}function Lv(e,t){let n=new Array(e).fill(null).map((()=>({})));for(let[r,i]of Object.entries(t))for(let t=0;t<e;t++)n[t][r]=i();return n}var Ov=n(8287).Buffer
;function Pv(e){let t=e.replace(/\*/g,"+").replace(/-/g,"/");return Ov.from(t,"base64")}function Fv(e){let t=e.replace(/[\- +]/g,"_").toLowerCase();if(t.match(/\W/))throw new Error("unsanitized name");return t}
const Uv=["helm","cape","necklace","weapon","body","offhand","arms","legs","face","gloves","boots","beard","ring","ammo","aura","slot15"],Bv={4:2,6:3,7:5,8:0,9:4,10:6,11:1},zv={4:9,6:10,7:12,8:7,9:11,10:13},Gv={hair0:6798,hair1:55232,skin0:4533,
skin1:4540,skin2:4550,skin3:4554,body0:8741,body1:9104,legs0:25485,legs1:25238,boots0:4620,boots1:4626},Vv={none:-1,default:9804,worried:9743,talkfast:9745,scared:9748,wtf:9752,drunk:9851,happy:9843,evil:9842,laughing:9841,crying:9765};let Hv=null
;async function jv(e,t,n){let r,i=(e,t,n,r,i)=>{o.push({buffer:e.buffer,offset:t,parent:e,penalty:e.penalty+n,slot:i,slotindex:e.slotindex+1,usesBackup:e.usesBackup||r})},a=async t=>{let r=[],i=t;for(;i.parent;)r.push(i.slot),i=i.parent;r.reverse()
;let a=t.buffer.slice(t.offset);try{var s=Qg.avatarOverrides.read(a,e.rawsource,{slots:r})}catch(e){return!1}
let o=[[Gv.hair0,l.hair[s.haircol0]],[Gv.hair1,l.hair[s.haircol0]],[Gv.skin0,l.skin[s.skincol0]],[Gv.skin1,l.skin[s.skincol0]],[Gv.skin2,l.skin[s.skincol0]],[Gv.skin3,l.skin[s.skincol0]],[Gv.body0,l.clothes[s.bodycol]],[Gv.body1,l.clothes[s.bodycol]],[Gv.legs0,l.clothes[s.legscol]],[Gv.legs1,l.clothes[s.legscol]],[Gv.boots0,l.feet[s.bootscol]],[Gv.boots1,l.feet[s.bootscol]]],c=[],u={
none:-1};if(s.slots.forEach((e=>{const t=e.slot;if(t){let r={replaceColors:[...t.replaceColors],replaceMaterials:[...t.replaceMaterials]};if(e.cust?.color?.col2)for(let t in r.replaceColors)r.replaceColors[t][1]=e.cust.color.col2[t]
;if(e.cust?.color?.col4&&r.replaceColors.push(...e.cust.color.col4),e.cust?.material)for(let t in r.replaceMaterials)r.replaceMaterials[t][1]=e.cust.material.materials[t];if(e.cust?.model)for(let n in e.cust.model)t.models[n]=e.cust.model[n]
;r.replaceColors.push(...o);let i=n?t.headmodels:t.models;for(let e=f?1:0;e<i.length;e+=2)-1!=i[e]&&c.push({modelid:i[e],mods:r})}})),n)u=Vv;else{let t=2699,n=r.find((e=>e&&-1!=e.animStruct));if(n){
let r=await e.getFileById(xg.structs,n.animStruct),i=Qg.structs.read(r,e.rawsource),a=i.extra?.find((e=>2954==e.prop));a&&(t=a.intvalue)}u=await $v(e,t)}return{models:c,avatar:s,anims:u}},s=async t=>{let n=t.offset;if(n>=t.buffer.length-2)return
;let r=t.buffer.readUint8(n++);0==r&&i(t,n,0,!1,null);let a=t.buffer.readUint8(n++);if(0!=r||0!=a){let s=r<<8|a;await(async(t,n,r,a)=>{let s=t.slotindex+1;if(a<16384){let e=a-256,o=u[e];if(o?.models){let a=[],l=[];for(let e of o.models)a.push(e,e)
;o.headmodel&&l.push(o.headmodel,o.headmodel);let c=o.bodypart??-1,u=(f?zv:Bv)[s]??-2;i(t,n,c==u?0:1,r,{name:Uv[s]+"_"+e,type:"kit",id:e,models:a,headmodels:l,replaceColors:o.recolor??[],replaceMaterials:[],animStruct:-1})}}
let o=a-16384&65535,l=a<16384,c=await e.getGameFile("items",o).catch((()=>null));if(c){let a=Qg.item.read(c,e.rawsource),u=a.extra?.find((e=>686==e.prop))?.intvalue??-1,h=[];a.maleModels_0&&(h[0]=a.maleModels_0.id),
a.femaleModels_0&&(h[1]=a.femaleModels_0.id),a.maleModels_1&&(h[2]=a.maleModels_1),a.femaleModels_1&&(h[3]=a.femaleModels_1),a.maleModels_2&&(h[4]=a.maleModels_2),a.femaleModels_2&&(h[5]=a.femaleModels_2);let d=[];a.maleHeads_0&&(d[0]=a.maleHeads_0),
a.femaleHeads_0&&(d[1]=a.femaleHeads_0),a.maleHeads_1&&(d[2]=a.maleHeads_1),a.femaleHeads_1&&(d[3]=a.femaleHeads_1);let p=a.equipSlotId!=s?1:0;i(t,n,p,r||l,{name:a.name?a.name:"item_"+o,type:"item",id:o,models:h,headmodels:d,
replaceColors:a.color_replacements??[],replaceMaterials:a.material_replacements??[],animStruct:u})}})(t,n,0==r,s)}},o=[],l=await async function(e){if(!Hv){let t=async(t,n)=>{
let r=await e.getFileById(xg.enums,t),i=Qg.enums.read(r,e),a=await e.getFileById(xg.enums,n),s=Qg.enums.read(a,e);return Object.fromEntries(s.intArrayValue2.values.map((e=>{let t=i.intArrayValue2.values.find((t=>t[0]==e[0]))[1]
;return[e[1],ym(...vm(t>>16&255,t>>8&255,255&t))]})))};Hv={feet:await t(753,3297),skin:await t(746,748),hair:await t(2343,2345),clothes:await t(2347,3282)}}return Hv
}(e),c=await e.getArchiveById(xg.config,Ag.identityKit),u=Object.fromEntries(c.map((t=>[t.fileid,Qg.identitykit.read(t.buffer,e.rawsource)]))),h=null,d={none:-1},p=t.readUint8(0),f=!!(1&p);if(65535==t.readUint16BE(1)){
let r=t.readUint16BE(3),i=await e.getGameFile("npcs",r),a=Qg.npc.read(i,e.rawsource),s={replaceColors:a.color_replacements??[],replaceMaterials:a.color_replacements??[]},o=[];n?a.headModels&&o.push(...a.headModels.map((e=>({modelid:e,mods:s
})))):(a.models&&o.push(...a.models.map((e=>({modelid:e,mods:s})))),a.animation_group&&(d=await $v(e,a.animation_group)))}else{o.push({buffer:t,offset:1,parent:null,penalty:0,slot:null,slotindex:-1,usesBackup:!1});for(let e=0;;e++){
o.sort(((e,t)=>t.penalty-e.penalty||e.slotindex-t.slotindex));let t=o.pop();if(!t)throw new Error("no avatar read solution found");if(e++,15==t.slotindex){let n=await a(t);if(n){r=n.models,d=n.anims,h=n.avatar,
console.log(`solved player avatar in ${e} steps, ${o.length} nodes left, ${t.penalty} penalty. ${t.usesBackup?"used backup":"did not use backup"}`);break}}else await s(t)}}return{models:r,anims:d,info:{avatar:h,gender:p,npc:null,kitcolors:l,buffer:t
},id:t,name:"player"}}function Wv(e,t,n){let r={gender:t,npc:n,player:null};if(e){let t=Qg.avatarOverrides.write(e);r.player={slots:e.slots.map((e=>{const t=e.slot;return t?"item"==t.type?t.id+16384:t.id+256:0})),rest:t}}return Qg.avatars.write(r)}
async function $v(e,t){let n=(await e.getArchiveById(xg.config,Ag.animgroups))[t];return fy(Qg.animgroupConfigs.read(n.buffer,e.rawsource))}function qv(e){
return"undefined"==typeof document||void 0===document.location||!document.location.protocol.startsWith("http")&&"about:"!=document.location.protocol?`https://secure.runescape.com/m=avatar-rs/${encodeURIComponent(e)}/appearance.dat`:`https://runeapps.org/data/getplayeravatar.php?player=${encodeURIComponent(e)}`
}var Xv=n(8287).Buffer;function Yv(e,t,n,r,i){e.decompose(t,n,r),i.identity()}function Kv(e,t){for(let n=0;n<e.length-1;n++){let r=e[n],i=e[n+1];if(r.time<=t&&i.time>=t){let e=r.value[0],n=i.value[0],a=r.time,s=i.time,o=e+r.value[2],l=a+r.value[1]
;return Jv(e,o,n-r.value[4],n,Zv(a,l,s-r.value[3],s,t))}}throw new Error("out of track bounds")}function Jv(e,t,n,r,i){return i*i*i*(3*t-e-3*n+r)+i*i*(3*e-6*t+3*n)+i*(3*t-3*e)+e}function Zv(e,t,n,r,i){
let a=1e-5,s=3*t-e-3*n+r,o=3*e-6*t+3*n,l=3*t-3*e,c=e-i;if(Math.abs(s)<a){let e=l*l-4*o*c;if(e<0)throw new Error("no solution for quadratic interpolation");let t=2*c/(-l-Math.sqrt(e)),n=2*c/(-l+Math.sqrt(e)),r=t>=-a&&t<=1+a
;if(!(r||n>=-a&&n<=1+a))throw new Error("no valid solutions for quadratic interpolation");return r?t:n}
let u=-o/(3*s),h=u*u*u+(o*l-3*s*c)/(6*s*s),d=l/(3*s),p=h*h+Math.pow(d-u*u,3),f=p>=0?Math.sqrt(p):0,m=p>=0?0:Math.sqrt(-p),g=h+f,_=m,v=h-f,y=-m,b=Math.hypot(g,_),x=Math.atan2(_,g),E=Math.hypot(v,y),w=Math.atan2(y,v),S=Math.pow(b,1/3),T=x/3,A=Math.pow(E,1/3),C=w/3,M=0,I=0
;for(let e of[0,1,2])for(let t of[0,1,2]){let n=S*Math.sin(T+e*Math.PI/3*2)+A*Math.sin(C+t*Math.PI/3*2),r=S*Math.cos(T+e*Math.PI/3*2)+A*Math.cos(C+t*Math.PI/3*2)+u;if(Math.abs(n)<a&&r>=-a&&r<=1+a){
let n=S*Math.cos(T+e*Math.PI/3*2)+A*Math.cos(C+t*Math.PI/3*2)+u;0!=I&&Math.abs(n-M),M=n,I++}}if(0==I)throw new Error("no solution found");return M}let Qv=(e,t)=>{const n=2*Math.PI;let r=((e-t+Math.PI)%n+n)%n-Math.PI;return Math.abs(r)<1e-4}
;function ey(e,t,n,r){for(let i of e)if(i!=t)for(let a=0;a<i.length;a++){let s=i[a],o=i[(a+1)%i.length];for(let l=n;l<n+r;l++){let n=t[l%t.length],r=t[(l+1)%t.length];if(s.x==r.x&&s.z==r.z&&o.x==n.x&&o.z==n.z){
let n=l%t.length,r=a+1,s=[...t.slice(Math.min(n+2,t.length),t.length),...t.slice(Math.max(0,n-t.length+2),n)];return i.splice(r,0,...s),e.delete(t),ey(e,i,r,s.length+2)}}}return t}function ty(e,t){for(let n=0;n<e.length;n++){
let r=e[n],i=e[(n+1)%e.length],a=e[(n+2)%e.length];if(r.x==i.x&&r.z==i.z){e.splice((n+1)%e.length,1),n=Math.max(-1,n-2);continue}let s=i.x-r.x,o=i.z-r.z,l=a.x-i.x,c=a.z-i.z,u=Math.atan2(o,s),h=Math.atan2(c,l)
;(Qv(u+Math.PI,h)||t&&Qv(u,h))&&(e.splice((n+1)%e.length,1),n=Math.max(-1,n-2))}}async function ny(e,t,n,r,i,a,s,o,l=!1){
let c=!s,u=!s,h="",d=new Map,p=new Map,f=[new Map,new Map,new Map,new Map],m=[],g=[],_=16711935,v=e=>e?e[0]<<16|e[1]<<8|e[2]:_,y=e=>{let t=e.waterProps?.rawOverlay??e.rawOverlay,n=v(t?.secondary_colour)
;return n==_&&(n=v(e.waterProps?.props.color??e.overlayprops.color)),n};if(c){let e=new Uint8ClampedArray(r.xsize*r.zsize*4);for(let t=0;t<e.length;t+=4)e[t+0]=0,e[t+1]=0,e[t+2]=0,e[t+3]=255;for(let n=0;n<r.zsize;n++)for(let a=0;a<r.xsize;a++){
let s=[0,0,0],o=!1;for(let e=wS-1;!o&&e>=0;e--){let l=t.getTile(r.x+a,r.z+n,e);if(l&&(8&l.settings||!(l.effectiveLevel>i))&&(l.underlayVisible&&(s=l.underlayprops.color,o=!0),l.waterProps||l.rawOverlay)){
let t=l.waterProps?.shape??l.shape.overlay,r=y(l);if(r==_&&(l.underlayVisible?(t=l.shape.underlay,r=v(l.underlayprops.color),s=[0,0,0],o=!1):t=[]),0!=t.length){let i=lm(f[e],r,(()=>new Set)),s=t.map((e=>({x:a+e.subx,z:n+e.subz})));i.add(s),
ty(ey(i,s,0,s.length),!1)}}}let l=4*a+4*n*r.xsize;e[l+0]=s[0],e[l+1]=s[1],e[l+2]=s[2],e[l+3]=255}h=await Dm(Am(e,r.xsize,r.zsize))}let b=(e,t,n,r,i,a)=>{let s=t+((r+a+1)%4<2?0:1),o=n+((r+a+2)%4<2?0:1),l=t+((i+a+1)%4<2?0:1),c=n+((i+a+2)%4<2?0:1)
;for(let t of e){let e=t[0].x,n=t[0].z,r=t[t.length-1].x,i=t[t.length-1].z;if(e==s&&n==o)return void t.unshift({x:l,z:c});if(e==l&&n==c)return void t.unshift({x:s,z:o});if(r==s&&i==o)return void t.push({x:l,z:c});if(r==l&&i==c)return void t.push({
x:s,z:o})}e.push([{x:s,z:o},{x:l,z:c}])};for(let a of n){if(a.x<r.x-2||a.z<r.z-2)continue;if(a.x>=r.x+r.xsize+2||a.z>=r.z+r.zsize+2)continue;if(-1==a.effectiveLevel||!a.forceVisible&&a.effectiveLevel>i)continue
;let n=a.location.deletable||a.location.actions_0?g:m,l=!1;for(let e=a.plane+1;e<wS;e++){let n=t.getTile(a.x,a.z,e);if(!n||n?.effectiveLevel!=a.effectiveLevel)break;n.effectiveLevel!=i||y(n)==_&&!n.underlayVisible||(l=!0)}
if(s&&a.effectiveLevel!=i&&(l=!0),o&&a.effectiveLevel==i&&a.location.mapFunction){let t=p.get(a.location.mapFunction);if(!t){let n=e.mapMaplabels[a.location.mapFunction];n.legacy_switch&&(n=e.mapMaplabels[n.legacy_switch.default_ref])
;let r="",i=0,s=0;if(null!=n.sprite){let t=J_(await e.getFileById(xg.sprites,n.sprite));r=await Dm(t[0].img),i=t[0].img.width,s=t[0].img.height}t={src:r,width:i,height:s,uses:[]},p.set(a.location.mapFunction,t)}t.uses.push({x:a.x-r.x,z:a.z-r.z})}
if(a.location.mapscene){if(u){let t=d.get(a.location.mapscene);if(!t){let n=e.mapMapscenes[a.location.mapscene],r="",i=0,s=0;if(null!=n.sprite_id){let t=J_(await e.getFileById(xg.sprites,n.sprite_id));r=await Dm(t[0].img),i=t[0].img.width,
s=t[0].img.height}t={src:r,width:i,height:s,uses:[]},d.set(a.location.mapscene,t)}t.uses.push({x:a.x-r.x,z:a.z-r.z})}}else l||(0==a.type?b(n,a.x-r.x,a.z-r.z,3,0,a.rotation):2==a.type?(b(n,a.x-r.x,a.z-r.z,3,0,a.rotation),
b(n,a.x-r.x,a.z-r.z,0,1,a.rotation)):9==a.type&&b(n,a.x-r.x,a.z-r.z,3,1,a.rotation))}let x=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${r.xsize} ${r.zsize}" width="${r.xsize*a}" height="${r.zsize*a}">\n`
;x+=`<g transform="scale(1,-1) translate(0,-${r.zsize})">\n`,x+="<defs>\n"
;for(let[e,t]of d)x+=`<image id="mapscene-${e}" class="mapscene" width="${t.width/4}" height="${t.height/4}" href="${t.src}" style="image-rendering: pixelated;" transform="scale(1,-1)"/>\n`
;for(let[e,t]of p)x+=`<image id="maplabel-${e}" class="maplabel" width="${t.width/4}" height="${t.height/4}" x="${-t.width/4/2}" y="0" href="${t.src}" style="image-rendering: pixelated;" transform="scale(1,-1)"/>\n`;if(x+="</defs>\n",
h&&(x+=`<image href="${h}" style="image-rendering: pixelated;" width="${r.xsize}" height="${r.zsize}"/>\n`),0!=f.reduce(((e,t)=>t.size+e),0)){x+='<g shape-rendering="crispEdges">\n';for(let e of f)for(let[t,n]of e.entries())for(let e of n)ty(e,!0),
x+=`<polygon fill="#${t.toString(16).padStart(6,"0")}" points="${e.map((e=>`${e.x},${e.z}`)).join(" ")}"/>\n`;x+="</g>"}const E=l?3/8:.2;if(0!=m.length){x+=`<g stroke="white" stroke-width="${E}" fill="none">`
;for(let e of m)x+=`<polyline points="${e.map((e=>`${e.x},${e.z}`)).join(" ")}"/>\n`;x+="</g>"}if(0!=g.length){x+=`<g stroke="red" stroke-width="${E}" fill="none">`;for(let e of g)x+=`<polyline points="${e.map((e=>`${e.x},${e.z}`)).join(" ")}"/>\n`
;x+="</g>"}for(let[e,t]of d)for(let n of t.uses)x+=`<use href="#mapscene-${e}" x="${n.x}" y="${n.z+t.height/4}"/>\n`;for(let[e,t]of p)for(let n of t.uses)x+=`<use href="#maplabel-${e}" x="${n.x}" y="${n.z+t.height/4}"/>\n`;return x+="</g>\n",
x+="</svg>",x}var ry=n(3092),iy=n.n(ry);async function ay(e,t){let n,r=await e.getModelData(t);if("classic"==e.modelType){let r=await e.engine.getArchiveById(0,Iv.models);n=Qg.classicmodels.read(r[t].buffer,e.engine.rawsource)
}else if("old"==e.modelType){let r=e.engine.legacyData?Q_:xg.oldmodels;n=Qg.oldmodels.read(await e.engine.getFileById(r,t),e.engine.rawsource)}else"nxt"==e.modelType&&(n=Qg.models.read(await e.engine.getFileById(xg.models,t),e.engine.rawsource))
;return{models:[{modelid:t,mods:{}}],anims:{},info:{modeldata:r,info:n},id:t,name:`model:${t}`}}async function sy(e,t){return{...await jv(e.engine,t.data,t.head),id:t,name:t.player}}async function oy(e,t){
let n=Qg.npc.read(await e.engine.getGameFile("npcs",t.id),e.engine.rawsource),r={},i=(t.head?n.headModels:n.models)??[];if(!t.head&&n.animation_group){let t=await e.engine.getArchiveById(xg.config,Ag.animgroups)
;r=fy(Qg.animgroupConfigs.read(t[n.animation_group].buffer,e.engine.rawsource))}let a={};return n.color_replacements&&(a.replaceColors=n.color_replacements),n.material_replacements&&(a.replaceMaterials=n.material_replacements),{info:n,
models:i.map((e=>({modelid:e,mods:a}))),anims:r,id:t,name:n.name??`npc:${t.id}`}}async function ly(e,t){let n=Qg.spotAnims.read(await e.engine.getGameFile("spotanims",t),e.engine.rawsource),r={};n.replace_colors&&(r.replaceColors=n.replace_colors),
n.replace_materials&&(r.replaceMaterials=n.replace_materials);let i=n.model?[{modelid:n.model,mods:r}]:[],a={};return n.sequence&&(a.default=n.sequence),{models:i,anims:a,info:n,id:t,name:`spotanim:${t}`}}async function cy(e,t){
let{morphedloc:n}=await qS(e.engine,t),r={},i={},a=[];return n&&(n.color_replacements&&(r.replaceColors=n.color_replacements),n.material_replacements&&(r.replaceMaterials=n.material_replacements),
e.engine.getBuildNr()>Mg&&e.engine.getBuildNr()<377&&(r.replaceMaterials=r.replaceColors),a=[...n.models?.flatMap((e=>e.values)).map((e=>({modelid:e,mods:r})))??[],...n.models_05?.models.flatMap((e=>e.values)).map((e=>({modelid:e,mods:r})))??[]]),
n?.probably_animation&&(i.default=n.probably_animation),{models:a,anims:i,info:n,id:t,name:n.name??`loc:${t}`}}async function uy(e,t){let n=Qg.item.read(await e.engine.getGameFile("items",t),e.engine.rawsource)
;!n.baseModel&&n.noteTemplate&&(n=Qg.item.read(await e.engine.getGameFile("items",n.noteTemplate),e.engine.rawsource));let r={};return n.color_replacements&&(r.replaceColors=n.color_replacements),
n.material_replacements&&(r.replaceMaterials=n.material_replacements),{models:n.baseModel?[{modelid:n.baseModel,mods:r}]:[],anims:{},info:n,id:t,name:n.name??`item:${t}`}}class hy extends xm{cleanup(){this.listeners={},
this.renderscene?.removeSceneElement(this),this.skeletonHelper?.removeFromParent(),this.renderscene=null}getSceneElements(){return{modelnode:this.rootnode,updateAnimation:this.updateAnimation}}addToScene(e){this.renderscene=e,e.addSceneElement(this)}
onModelLoaded(){this.emit("loaded",void 0),this.renderscene?.forceFrame(),this.renderscene?.setCameraLimits()}updateAnimation(e,t){this.mixer.update(e),this.loaded?.matUvAnims.forEach((e=>e.tex.offset.copy(e.v).multiplyScalar(t)))}
constructor(e,t,n=""){super(),this.loaded=null,this.rootnode=new Wl,this.nullAnimPromise={clip:null,prom:new Em},this.anims={"-1":this.nullAnimPromise},this.mountedanim=null,this.mixer=new ef(this.rootnode),this.renderscene=null,this.targetAnimId=-1,
this.skeletontype="none",this.skeletonHelper=null,this.cache=e,this.model=(async()=>{let r=function(e){return{bonecount:Math.max(...e.map((e=>e.bonecount))),skincount:Math.max(...e.map((e=>e.skincount))),maxy:Math.max(...e.map((e=>e.maxy))),
miny:Math.max(...e.map((e=>e.miny))),meshes:e.flatMap((e=>e.meshes)),debugmeshes:e.flatMap((e=>e.debugmeshes??[]))}}(await Promise.all(t.map((async t=>{let n=await e.getModelData(t.modelid);return{...n,meshes:n.meshes.map((e=>FS(e,t.mods)))}}))))
;!function(e){let t=e.meshes.reduce(((e,t)=>e+t.vertexend-t.vertexstart),0),n=new Uint32Array(t),r=0;for(let t=0;t<e.meshes.length;t++){let i=e.meshes[t];for(let e=i.vertexstart;e<i.vertexend;e++)n[r++]=t<<23|e}function i(e,t,n){
const r=e.meshes[t>>23],i=e.meshes[n>>23],a=8388607&t,s=8388607&n,o=r.attributes.pos,l=i.attributes.pos;return o.getX(a)-l.getX(s)||o.getY(a)-l.getY(s)||o.getZ(a)-l.getZ(s)}let a=new Dr,s=new Dr,o=0;n.sort(((t,n)=>i(e,t,n)));for(let t=0;t<n.length;){
let r=t;for(;t<n.length&&0==i(e,n[r],n[++t]););if(t>r+1){const i=e.meshes[n[r]>>23],l=8388607&n[r];s.set(0,0,0);for(let i=r;i<t;i++){const t=e.meshes[n[i]>>23],r=8388607&n[i]
;t.needsNormalBlending&&t.attributes.normals&&(a.fromBufferAttribute(t.attributes.normals,r),s.add(a))}s.normalize();for(let a=r;a<t;a++){const t=e.meshes[n[a]>>23],c=8388607&n[a]
;a!=r&&i.attributes.boneids&&i.attributes.boneweights&&t.attributes.boneids&&t.attributes.boneweights&&(i.attributes.boneids.getX(l)!=t.attributes.boneids.getX(c)&&o++,t.attributes.boneids.copyAt(c,i.attributes.boneids,l),
t.attributes.boneweights.copyAt(c,i.attributes.boneweights,l)),t.needsNormalBlending&&t.attributes.normals&&s.lengthSq()>.001&&t.attributes.normals.setXYZ(c,s.x,s.y,s.z)}}}console.log("merged bones:",o)}(r);let i=await rS(this.cache,r);i.name=n
;let a=[];for(let e=0;e<Math.max(r.bonecount,r.skincount);e++)a.push(i);let s=new Gc(a),o=[];i.traverse((e=>{if(e instanceof Pc&&e.bind(s),e instanceof ja&&e.material instanceof ta){let t=e.material.userData.gltfExtensions?.RA_materials_uvanim;if(t){
let n=e.material,r=new tr(t.uvAnim[0],t.uvAnim[1]);n.map&&o.push({tex:n.map,v:r}),n.normalMap&&o.push({tex:n.normalMap,v:r}),n.emissiveMap&&o.push({tex:n.emissiveMap,v:r}),n.metalnessMap&&o.push({tex:n.metalnessMap,v:r}),n.roughnessMap&&o.push({
tex:n.roughnessMap,v:r})}}}));let l=new Dd(void 0,void 0,[]);return this.nullAnimPromise.clip=l,this.nullAnimPromise.prom.done(l),this.rootnode.add(i),this.loaded={mesh:i,modeldata:r,nullAnim:l,matUvAnims:o},
-1==this.targetAnimId&&this.setAnimation(-1),this.onModelLoaded(),this.loaded})()}mountAnim(e){if(!this.loaded)throw new Error("attempting to mount anim before model is loaded");if(this.mountedanim==e)return
;if(0==this.loaded.modeldata.bonecount&&0==this.loaded.modeldata.skincount)return;let t=this.loaded.mesh;-1==t.animations.indexOf(e)&&t.animations.push(e),this.mixer.stopAllAction(),this.mixer.clipAction(e,t).play(),this.mountedanim=e}
loadAnimation(e){return this.anims[e]||(this.anims[e]={clip:null,prom:(async()=>{let t,n=await this.cache.engine.getFileById(xg.sequences,e),r=Qg.sequences.read(n,this.cache.engine.rawsource);if(r.skeletal_animation){let e=await async function(e,t){
let n=Qg.skeletalAnim.read(await e.engine.getFileById(xg.skeletalAnims,t),e.engine.rawsource),r=[],i=n.tracks.sort(((e,t)=>e.boneid!=t.boneid?e.boneid-t.boneid:e.type_0to9-t.type_0to9)),a=[{t:"unknown",a:0},{t:"rotate",a:0},{t:"rotate",a:1},{
t:"rotate",a:2},{t:"translate",a:0},{t:"translate",a:1},{t:"translate",a:2},{t:"scale",a:0},{t:"scale",a:1},{t:"scale",a:2},{t:"unknown",a:0},{t:"unknown",a:0},{t:"unknown",a:0},{t:"unknown",a:0},{t:"unknown",a:0},{t:"unknown",a:0},{t:"unknown",a:0}]
;for(let e=0;e<i.length;){let t=i[e],n=null,s=null,o=null,l=a[t.type_0to9],c=t.boneid<16e3?t.boneid-64:t.boneid-16384;for(;e<i.length;){let r=i[e],c=a[r.type_0to9];if(r.boneid!=t.boneid||c.t!=l.t)break;0==c.a&&(n=r.chunks),1==c.a&&(s=r.chunks),
2==c.a&&(o=r.chunks),e++}let u="bone_"+c,h="scale"==l.t?1:0,d=[],p=[],f=new yi,m=new Nr,g=n?.at(-1)?.time??s?.at(-1)?.time??o?.at(-1)?.time??0,_=0;for(let e=0;e<g;e+=5)p[_++]=n?Kv(n,e):h,p[_++]=s?Kv(s,e):h,p[_++]=o?Kv(o,e):h,d.push(e)
;let v=new Float32Array(d.map((e=>.02*e)));if("translate"==l.t&&r.push(new Nd(`${u}.position`,v,p)),"scale"==l.t){if(0==c)for(let e=0;e<p.length;e+=3)p[e+2]*=-1;r.push(new Nd(`${u}.scale`,v,p))}if("rotate"==l.t){let e=new Float32Array(4*d.length)
;for(let t=0;3*t<p.length;t++)f.set(p[3*t+0],p[3*t+1],p[3*t+2],"YXZ"),m.setFromEuler(f),m.toArray(e,4*t);r.push(new Rd(`${u}.quaternion`,v,e))}}return{clip:new Dd("anim_"+(1e3*Math.random()|0),void 0,r),framebaseid:n.framebase}
}(this.cache,r.skeletal_animation);t=e.clip;let n=this.loaded??await this.model;if("full"!=this.skeletontype){if("none"!=this.skeletontype)throw new Error("wrong skeleton type already mounted to model");await async function(e,t,n){
let r=Qg.framemaps.read(await t.engine.getFileById(xg.framemaps,n),t.engine.rawsource);if(!r.skeleton)throw new Error("framebase does not have skeleton");let i=[],a=[],s=new ci,o=(new ci).makeScale(1,1,-1);for(let[e,t]of r.skeleton.entries()){
let n=new Fc,r=(new ci).fromArray(t.bonematrix);n.name="bone_"+e,65535==t.nonskinboneid?(a.push(n),r.multiply(o)):i[t.nonskinboneid].add(n),s.copy(r).decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(),i[e]=n}let l=new Gc(i)
;0!=a.length&&e.add(...a),e.updateMatrixWorld(!0);let c=(new ci).copy(e.matrixWorld);l.calculateInverses(),e.traverse((e=>{if(e instanceof Pc){e.bind(l,c);let t=e.geometry;t.attributes.skinIndex=t.attributes.RA_skinIndex_skin,
t.attributes.skinWeight=t.attributes.RA_skinWeight_skin}}))}(n.mesh,this.cache,e.framebaseid),this.skeletontype="full"}}else{if(!r.frames)throw new Error("animation has no frames");{let e=await async function(e,t){let n=t[0]
;if(!n)throw new Error("animation has no frames");let r=await e.engine.getArchiveById(xg.frames,n.frameidhi),i=Object.fromEntries(r.map(((t,n)=>[t.fileid,Qg.frames.read(t.buffer,e.engine.rawsource)]))),a=0,s=[],o=[];for(let e=0;e<t.length;e++){
let n=t[e];i[n.frameidlow]?(s.push(a),a+=.02*n.framelength,o.push(i[n.frameidlow])):console.log(`missing animation frame ${n.frameidlow} in sequence ${n.frameidhi}`)}o.push(o[0]),s.push(a)
;let l=Qg.framemaps.read(await e.engine.getFileById(xg.framemaps,o[0].probably_framemap_id),e.engine.rawsource),c=new Float32Array(s),u=function(e,t){let n=t.map((e=>({flags:e.flags,animdata:e.animdata,dataindex:0,baseid:e.probably_framemap_id,
stream:new pm(Xv.from(e.animdata))}))),r=[];for(let[t,i]of e.data.entries()){let e=[3,3,4,3,3,4,3,3,3,3,3][i.type],a=new Float32Array(e*n.length),s=0,o=new Nr,l=new yi;for(let e of n){let n=e?.flags[t]??0
;if(-8&n&&console.log("unexpexted frame data flag "+(-8&n)),0==i.type&&(a[s++]=1&n?e.stream.readShortSmartBias():0,a[s++]=2&n?e.stream.readShortSmartBias():0,a[s++]=4&n?e.stream.readShortSmartBias():0,
7&n&&console.log("type 0 data",n,[...a.slice(s-3,s)])),1==i.type&&(a[s++]=1&n?e.stream.readShortSmartBias():0,a[s++]=-(2&n?e.stream.readShortSmartBias():0),a[s++]=4&n?e.stream.readShortSmartBias():0),2==i.type){let t=0;if(1&n){
let n=e.stream.readShortSmartBias(),r=e.stream.readShortSmartBias();t=Math.atan2(n,r)}let r=0;if(2&n){let t=e.stream.readShortSmartBias(),n=e.stream.readShortSmartBias();r=Math.atan2(t,n)}let i=0;if(4&n){
let t=e.stream.readShortSmartBias(),n=e.stream.readShortSmartBias();i=Math.atan2(t,n)}l.set(t,r,i,"YXZ"),o.setFromEuler(l),o.toArray(a,s),s+=4}3==i.type&&(a[s++]=(1&n?e.stream.readShortSmartBias():128)/128,
a[s++]=(2&n?e.stream.readShortSmartBias():128)/128,a[s++]=(4&n?e.stream.readShortSmartBias():128)/128),(5==i.type||i.type>=4)&&(a[s++]=1&n?e.stream.readUShortSmart():0,a[s++]=2&n?e.stream.readUShortSmart():0,a[s++]=4&n?e.stream.readUShortSmart():0)}
r.push(a)}return n.forEach(((t,n)=>{let r=t.stream.bytesLeft();if(0!=r){console.warn("ints left in anim decode: "+r,n);let i={};e.data.map(((e,n)=>{i[e.type]=(i[e.type]??0)+(t.flags[n]??0).toString(2).replaceAll("0","").length})),console.log(i)}})),r
}(l,o);return e=>{let t=g_(e),n=function(e,t,n,r){let i=n.length,a=new ci,s=new ci,o=new Nr,l=new ci,c=new ci,u=Math.max(...e.data.flatMap((e=>e.data)))+1+1,h=[];for(let e=0;e<u;e++){
let t=new Float32Array(16*i),n=r[e],a=n&&0!=n.weightsum?n.xsum/n.weightsum:0,s=n&&0!=n.weightsum?n.ysum/n.weightsum:0,o=n&&0!=n.weightsum?n.zsum/n.weightsum:0;for(let e=0;e<i;e++)t[16*e+0]=1,t[16*e+5]=1,t[16*e+10]=1,t[16*e+15]=1,t[16*e+12]=a,
t[16*e+13]=s,t[16*e+14]=o;h.push(t)}let d=new Dr;for(let n=0;n<i;n++){d.set(0,0,0);let i=16*n;for(let[u,p]of e.data.entries()){let e=t[u];if(0==p.type){d.fromArray(e,3*n);let t=0,a=0,s=0,o=0;for(let e of p.data){let n=r[e+1],l=h[e+1]
;n&&(t+=l[i+12]*n.weightsum,a+=l[i+13]*n.weightsum,s+=l[i+14]*n.weightsum,o+=n.weightsum)}0!=o&&d.set(d.x+t/o,d.y+a/o,d.z+s/o),l.makeTranslation(-d.x,-d.y,-d.z),c.makeTranslation(d.x,d.y,d.z)}if(1==p.type)for(let t of p.data){let r=h[t+1]
;r[i+12]+=e[3*n+0],r[i+13]+=e[3*n+1],r[i+14]+=e[3*n+2]}if(2==p.type){o.fromArray(e,4*n),s.makeRotationFromQuaternion(o),s.multiply(l),s.premultiply(c);for(let e of p.data){let t=h[e+1];a.fromArray(t,i),a.premultiply(s),a.toArray(t,i)}}if(3==p.type){
s.makeScale(e[3*n+0],e[3*n+1],e[3*n+2]),s.multiply(l),s.premultiply(c);for(let e of p.data){let t=h[e+1];a.fromArray(t,i),a.premultiply(s),a.toArray(t,i)}}}}return h}(l,u,c,t).map(((e,t)=>({id:t,trans:e
}))),r=c.length,i=[],a=new ci,s=new Dr,o=new Dr,h=new Nr,d=new Nr,p=0;for(let t of n){if(0==t.id)continue;if(t.id>=e.bonecount){p++;continue}
let n=`root_${t.id}`,l=`bone_${t.id}`,u=new Float32Array(3*r),f=new Float32Array(3*r),m=new Float32Array(4*r),g=new Float32Array(4*r);for(let e=0;e<r;e++)a.fromArray(t.trans,16*e),Yv(a,o,h,s,d),o.toArray(f,3*e),h.toArray(m,4*e),s.toArray(u,3*e),
d.toArray(g,4*e);i.push(new Nd(`${n}.position`,c,f)),i.push(new Rd(`${n}.quaternion`,c,m)),i.push(new Nd(`${n}.scale`,c,u)),i.push(new Rd(`${l}.quaternion`,c,g))}
return 0!=p&&console.log("skipped "+p+" bone animations since the model didn't have them"),new Dd("anim",void 0,i)}}(this.cache,r.frames),n=this.loaded??await this.model;if("baked"!=this.skeletontype){
if("none"!=this.skeletontype)throw new Error("wrong skeleton type already mounted to model");!function(e,t){let n=g_(t),r=new Fc;e.add(r);let i=[r],a=[],s=[new ci];for(let e=1;e<t.bonecount;e++){let t=new Fc,r=new Fc;t.name=`root_${e}`,
r.name=`bone_${e}`,t.add(r),a.push(t),i.push(r);let o=new ci,l=n[e];l&&0!=l.weightsum&&(t.position.set(l.xsum/l.weightsum,l.ysum/l.weightsum,l.zsum/l.weightsum),o.setPosition(t.position)),o.invert(),s.push(o)}let o=new Gc(i,s)
;0!=a.length&&r.add(...a),r.updateMatrixWorld(!0);let l=(new ci).copy(r.matrixWorld);o.calculateInverses(),e.traverse((e=>{if(e instanceof Pc){e.bind(o,l);let t=e.geometry;t.attributes.skinIndex=t.attributes.RA_skinIndex_bone,
t.attributes.skinWeight=t.attributes.RA_skinWeight_bone}})),new ef(e)}(n.mesh,n.modeldata),this.skeletontype="baked"}t=e(n.modeldata)}}return this.anims[e]={clip:t,prom:Promise.resolve(t)},this.loaded?.modeldata||await this.model,
this.anims[e].clip=t,t})()}),this.anims[e]}async setAnimation(e){this.targetAnimId=e;const t=this.loadAnimation(e);return this.mountAnim(t.clip??await t.prom)}}!function(e,t,n,r){
var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);a>3&&s&&Object.defineProperty(t,n,s)
}([Gm],hy.prototype,"updateAnimation",null);class dy extends xm{getSceneElements(){return this.chunks.map((e=>e.getSceneElements()))}addToScene(e){this.renderscene=e,e.addSceneElement(this)}cleanup(){this.listeners={},
this.chunks.forEach((e=>e.cleanup())),this.renderscene?.removeSceneElement(this),this.renderscene=null}constructor(e,t,n){super(),this.rootnode=new Wl,this.renderscene=null,this.mixer=new ef(this.rootnode),this.chunks=[]
;for(let r=t.z;r<t.z+t.zsize;r++)for(let i=t.x;i<t.x+t.xsize;i++){let t=py.create(e,i,r,n);this.chunks.push(t)}Promise.all(this.chunks.map((e=>e.chunkdata))).then((e=>{this.emit("loaded",void 0)}))}}class py extends xm{constructor(e,t,r,i,a){super(),
this.loaded=null,this.rootnode=new Wl,this.mixer=new ef(this.rootnode),this.renderscene=null,this.toggles={},this.globalname="",this.cache=e,this.chunkx=r,this.chunkz=i,this.chunkdata=(async()=>(this.loaded=await async function(e,t,r,i,a){
let s,{grid:o,chunk:l}=await t,c=new Wl;c.name=`mapsquare ${r}.${i}`;let u=new Map;if(l){let t=await async function(e,t,n,r){let i,a=[],s=t.gatherMaterials(n.tilerect.x,n.tilerect.z,n.tilerect.xsize+1,n.tilerect.zsize+1),o=new Map,l=[]
;for(let[t,n]of s.entries()){let r=e.engine.getMaterialData(t);r.textures.diffuse&&"none"!=e.textureType&&l.push(e.getTextureFile("diffuse",r.textures.diffuse,r.stripDiffuseAlpha).then((e=>e.toWebgl())).then((e=>{o.set(r.textures.diffuse,{tex:e,
repeat:n})})))}await Promise.all(l)
;let c=[...o.entries()].sort(((e,t)=>t[1].tex.width*t[1].repeat-e[1].tex.width*e[1].repeat)),u=[[256,256],[512,512],[1024,512],[1024,1024],[1024,2048],[2048,1024],[2048,2048],[2048,3072],[2048,4096],[3072,4096],[4096,4096]];e:for(let e of u){
i=new WS(e[0],e[1]);for(let[e,{tex:t,repeat:n}]of c)if(!i.addTexture(e,t,n))continue e;break}for(let e=0;e<wS;e++)a.push(JS(t,n,e,i,!0,"default")),a.push(JS(t,n,e,i,!0,"default",!0)),r?.map2d&&a.push(JS(t,n,e,i,!1,"worldmap")),
r?.invisibleLayers&&a.push(JS(t,n,e,i,!1,"wireframe")),r?.minimap&&(a.push(JS(t,n,e,i,!1,"minimap")),a.push(JS(t,n,e,i,!1,"minimap",!0)));return a}(e,o,l,a),r=a?.map2d?await async function(e,t,n){let r=new na;r.transparent=!0,r.depthTest=!1
;let i=e=>({wallgroup:{models:[],groupid:"walls"+e,minimapVariant:!1,hasVertexAlpha:!1,materialId:-1,material:{mat:r,matmeta:{textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,baseColor:[1,1,1],alphamode:"opaque",
alphacutoff:.1,stripDiffuseAlpha:!1,raw:null}},overlayIndex:1},mapscenes:new Map}),a=[i(0),i(1),i(2),i(3)],s=(e,t)=>{let n=(new Dr).set((t.x+t.sizex/2)*bS,0,(t.z+t.sizez/2)*bS),r=(new Nr).setFromAxisAngle(AS,t.rotation/2*Math.PI),i=new Dr(1,1,1)
;a[t.effectiveLevel].wallgroup.models.push({model:e.meshes[0],morph:{level:t.plane,placementMode:"followfloor",translate:n,rotation:r,scale:i,scaleModelHeightOffset:0,originx:n.x,originz:n.z},miny:e.miny,maxy:e.maxy,extras:{modeltype:"overlay",
isclickable:!1,modelgroup:"walls"+t.visualLevel,level:t.effectiveLevel}})},o=async(n,r)=>{let i=a[n.effectiveLevel].mapscenes.get(r),s=t.engine.mapMapscenes[r];if(null==s.sprite_id)return;let o=J_(await e.getFileById(xg.sprites,s.sprite_id)),l=new na
;l.map=new Uc(o[0].img.data,o[0].img.width,o[0].img.height,Ge),l.depthTest=!1,l.transparent=!0,l.needsUpdate=!0,i={groupid:"mapscenes"+n.effectiveLevel,hasVertexAlpha:!1,materialId:-1,minimapVariant:!1,material:{mat:l,matmeta:{textures:{},
texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,baseColor:[1,1,1],alphamode:"opaque",alphacutoff:.1,stripDiffuseAlpha:!1,raw:null,alphamode:"cutoff"}},models:[],overlayIndex:2},a[n.effectiveLevel].mapscenes.set(r,i),
console.warn("using very inefficient code path for 3d mapscenes")
;let c=l.map,u=128*c.image.width,h=128*c.image.height,d=new ZE(null).addParallelogram([255,255,255],[-u/2,0,-h/2],[u,0,0],[0,0,h]).convertSubmesh(0),p=new Dr((n.x+n.sizex/2)*bS,0,(n.z+n.sizez/2)*bS);i.models.push({model:d,morph:{level:n.plane,
placementMode:"simple",rotation:new Nr,scale:new Dr(1,1,1),translate:p,scaleModelHeightOffset:0,originx:p.x,originz:p.z},miny:0,maxy:0,extras:{modeltype:"overlay",isclickable:!1,level:n.visualLevel,modelgroup:"mapscenes"}})}
;for(let e of n)-1!=e.effectiveLevel&&(0==e.type?s(dw.wall,e):1==e.type?s(dw.shortcorner,e):2==e.type?s(dw.longcorner,e):3==e.type?s(dw.pillar,e):9==e.type&&s(dw.diagonal,e),null!=e.location.mapscene&&await o(e,e.location.mapscene))
;return a.flatMap((e=>[e.wallgroup,...e.mapscenes.values()]))}(e.engine,o,l.locs):[],i=await YS(e,l.locs),h=[...i.byMaterial,...r];if(a.minimap){let t=await YS(e,l.locs,!0);h.push(...t.byMaterial)}let d=l.tilerect.x*bS,p=l.tilerect.z*bS
;if(c.matrixAutoUpdate=!1,c.position.set(d,0,p),c.updateMatrix(),0!=h.length){let t=await Promise.all(h.map((t=>t.material??e.getMaterial(t.materialId,t.hasVertexAlpha,t.minimapVariant))));c.add(...h.map(((e,n)=>function(e,t,n,r,i,a){
let s=t.models.reduce(((e,t)=>e+t.model.vertexend-t.model.vertexstart),0),o=t.models.reduce(((e,t)=>e+t.model.indices.count),0),l=t.models.reduce(((e,t)=>e+ +t.model.hasVertexAlpha),0)
;if(0!=l&&l!=t.models.length)throw new Error("all meshes are expected to have same vertexAlpha setting")
;let c=0!=l,u=0,h=0,d=new ca(new Float32Array(3*s),3),p=new ca(new Float32Array(2*s),2),f=new ca(new Uint8Array(s*(c?4:3)),c?4:3,!0),m=new ca(new Int8Array(3*s),3,!0),g=new ca(s>65535?new Uint32Array(o):new Uint16Array(o),1),_=new Aa
;_.setAttribute("position",d),_.setAttribute("normal",m),_.setAttribute("color",f),_.setAttribute("uv",p),_.setIndex(g);let v=new KS(_),y=[];for(let i of t.models){let t=i.model,s=US(i.morph,n,r),o=t.vertexend-t.vertexstart,l=t.indices.count
;y.push(h);let _={mesh:v,startindex:h,endindex:h+l,startvertex:u,endvertex:u+o,hidden:!1};v.renderSections.push(_),"location"==i.extras.modeltype&&lm(a,i.extras.locationInstance,(()=>[])).push(_);{let e=u-t.vertexstart,n=t.indices
;if(s.determinant()<0)for(let t=0;t<l;t+=3){let r=h+t;g.setX(r+0,e+n.getX(t+0)),g.setX(r+1,e+n.getX(t+2)),g.setX(r+2,e+n.getX(t+1))}else for(let t=0;t<l;t+=3){let r=h+t;g.setX(r+0,e+n.getX(t+0)),g.setX(r+1,e+n.getX(t+1)),g.setX(r+2,e+n.getX(t+2))}}
BS(t.attributes.pos,i.morph,e,i.maxy-i.miny,n,r,d,u,t.vertexstart,t.vertexend);{let e=new Dr;if(t.attributes.normals){
let n=t.attributes.normals,[r,a,s]=QE(n),[l,c,h]=QE(m),d=t.vertexstart*s+a,p=u*h+c,f=(new ci).makeRotationFromQuaternion(i.morph.rotation);for(let t=0;t<o;t++){let n=p+t*h,i=d+t*s;e.set(r[i+0],r[i+1],r[i+2]),e.applyMatrix4(f),l[n+0]=Math.round(e.x),
l[n+1]=Math.round(e.y),l[n+2]=Math.round(e.z)}}else ew(g,d,m,h,h+l)}{let[e,n,r]=QE(f),i=u*r+n;if(t.attributes.color){let[n,a,s]=QE(t.attributes.color),l=t.vertexstart*s+a;if(c)for(let t=0;t<o;t++){let a=i+t*r,o=l+t*s;e[a+0]=n[o+0],e[a+1]=n[o+1],
e[a+2]=n[o+2],e[a+3]=n[o+3]}else for(let t=0;t<o;t++){let a=i+t*r,o=l+t*s;e[a+0]=n[o+0],e[a+1]=n[o+1],e[a+2]=n[o+2]}}else for(let t=0;t<o;t++){let n=i+t*r;e[n+0]=1,e[n+1]=1,e[n+2]=1,c&&(e[n+3]=1)}}{let e=t.attributes.texuvs
;if(e)for(let n=0;n<o;n++)p.setXY(u+n,e.getX(t.vertexstart+n),e.getY(t.vertexstart+n));else for(let e=0;e<o;e++)p.setXY(u+e,0,0)}u+=o,h+=l}nS(v,i,t.minimapVariant);let b={modeltype:"locationgroup",modelgroup:t.groupid,isclickable:!0,subranges:y,
searchPeers:!0,subobjects:t.models.map((e=>e.extras))};return v.renderOrder=t.overlayIndex,v.userData=b,v.matrixAutoUpdate=!1,v.updateMatrix(),v.name="merged locs",v}(o,e,d,p,t[n],u))))}let f=(await Promise.all(t.map((e=>function(e,t){
if(0==t.nvertices)return;let r=e=>{let n=new ac(e.src,t.vertexstride/e.src.BYTES_PER_ELEMENT);return new oc(n,e.vecsize,e.offset,e.normalized)},i=new Aa;i.setAttribute("position",r(t.pos)),i.setAttribute("color",r(t.color)),
i.setAttribute("normal",r(t.normal)),i.setAttribute("texcoord_0",r(t._RA_FLOORTEX_UV0)),i.setAttribute("texcoord_1",r(t._RA_FLOORTEX_UV1)),i.setAttribute("texcoord_2",r(t._RA_FLOORTEX_UV2)),i.setAttribute("color_1",r(t._RA_FLOORTEX_WEIGHTS)),
i.setAttribute("color_2",r(t._RA_FLOORTEX_USESCOLOR));let a="worldmap"!=t.mode?new cd({shininess:0}):new na;if(a.vertexColors=!0,"wireframe"==t.mode)a.wireframe=!0;else if("worldmap"!=t.mode){let e=t.atlas.convertToThreeTexture()
;"minimap"==t.mode?a=t.iswater?function(e){let t=new Ja;t.customProgramCacheKey=()=>"water",t.uniforms={uAmbientColour:{value:[1,0,0]},uCameraPosition:{value:[1671168,17344,1638400]},uDummy:{value:[0]},uFullScreenLookupScale:{
value:[0,5.960465188081798e-8,1,0]},uInvSunDirection:{value:[1671168,17344,1638400]},uModelMatrix:{value:[1,0,0,0,0,1,0,0,0,0,1,0,1654783,100,1622015,1]},uProjectionMatrix:{
value:[152587890625e-16,0,0,0,0,-152587890625e-16,0,0,0,0,-6200397183420137e-20,0,0,0,-1.0317461490631104,1]},uSunColour:{value:[0,5.960465188081798e-8,1]},uViewMatrix:{
value:[1,0,0,0,0,5.960465188081798e-8,1,0,0,-1,5.960465188081798e-8,0,-1671168,1638400,-17344.09765625,1]},uViewProjMatrix:{
value:[152587890625e-16,0,0,0,0,-9094948101931455e-28,-6200397183420137e-20,0,0,152587890625e-16,-3695725149521767e-27,0,-25.5,-25,.04365682601928711,1]},uViewportLookupScale:{value:[1671168,17344,1638400,10947093356943706e11]},uViewportOffsetScale:{
value:[1,0,0,0]},uZBufferParams:{value:[16777248,32256,-32768,-512.0009765625]}},t.vertexColors=!0;let r=n(1826);r=Ow(r),r=Dw(r,Mw),r=Lw(r,Iw);let i=n(929);i=Ow(i),i=Dw(i,Mw),i=Lw(i,Iw),i=i.replace(/#undef gl_FragColor/,"// $&"),
i=i.replace(/void getTextureSettings\(/,"void getTextureSettings(vec2 s, out TextureSettings settings){\nsettings.textureMeta1 = vec3(0.0,0.0,8196.0);\nsettings.textureMeta2 = vec3(0.0,0.0,8196.0);\nsettings.uvAnim = vec2(0.0,0.0);\nsettings.wrapping = 0.0;\nsettings.specular = 0.0;\nsettings.normalScale = 0.0;\n}\nvoid getTextureSettingsOld(")
;let a=0;return i=Nw(i,"in highp vec2 v_texcoord_0;\nin highp vec2 v_texcoord_1;\nin highp vec2 v_texcoord_2;"),r=Nw(r,"in highp vec2 texcoord_0;\nin highp vec2 texcoord_1;\nin highp vec2 texcoord_2;"),
r=Nw(r,"out highp vec2 v_texcoord_0;\nout highp vec2 v_texcoord_1;\nout highp vec2 v_texcoord_2;"),r=kw(r,"v_texcoord_0=texcoord_0;\nv_texcoord_1=texcoord_1;\nv_texcoord_2=texcoord_2;\n"),
i=i.replace(/(?<!void )getTexel\(\w+,/gm,(()=>`getTexel(v_texcoord_${a++%3},`)),t.vertexShader=r,t.fragmentShader=i,t.uniforms.uTextureAtlas={value:e},t.uniforms.uInvSunDirection.value[2]*=-1,t.uniformsNeedUpdate=!0,t}(e):function(e){let t=new Ja
;t.uniforms={uAmbientColour:{value:[.6059895753860474,.5648590922355652,.5127604007720947]},uAtlasMeta:{value:[512,16,.0001220703125,4]},uCameraPosition:{value:[1638400,17632,1769472]},uDummy:{value:[1]},uFade:{value:[0]},uFullScreenLookupScale:{
value:[0,5.960465188081798e-8,1,0]},uGridSize:{value:[512]},uInscatteringAmount:{value:[1,0,0]},uInvSunDirection:{value:[-.5391638875007629,.6469966173171997,-.5391638875007629]},uModelMatrix:{value:[1,0,0,0,0,1,0,0,0,0,1,0,1622015,100,1753087,1]},
uOutscatteringAmount:{value:[1638400,17632,1769472]},uProjectionMatrix:{value:[152587890625e-16,0,0,0,0,-152587890625e-16,0,0,0,0,-6200397183420137e-20,0,0,0,-1.0317461490631104,1]},uScatteringParameters:{value:[0,-1,5.960465188081798e-8,0]},
uScatteringTintColour:{value:[0,5.960465188081798e-8,1]},uSunColour:{value:[.8666666746139526,.8078431487083435,.7333333492279053]},uTextureAtlas:{value:[5]},uTextureAtlasSettings:{value:[6]},uViewMatrix:{
value:[1,0,0,0,0,5.960465188081798e-8,1,0,0,-1,5.960465188081798e-8,0,-1638400,1769472,-17632.10546875,1]},uViewProjMatrix:{
value:[152587890625e-16,0,0,0,0,-9094948101931455e-28,-6200397183420137e-20,0,0,152587890625e-16,-3695725149521767e-27,0,-25,-27,.06151437759399414,1]},uViewportLookupScale:{value:[1638400,17632,1769472,0]},uViewportOffsetScale:{value:[1,0,0,0]},
uZBufferParams:{value:[16777248,32256,-32768,-512.0009765625]}},t.vertexColors=!0;let r=n(5857);r=Ow(r),r=Dw(r,Mw),r=Lw(r,Iw);let i=n(2938);i=Ow(i),i=Dw(i,Mw),i=Lw(i,Iw),i=i.replace(/#undef gl_FragColor/,"// $&"),
i=i.replace(/void getTextureSettings\(/,"void getTextureSettings(vec2 s, out TextureSettings settings){\nsettings.textureMeta1 = vec3(0.0,0.0,8196.0);\nsettings.textureMeta2 = vec3(0.0,0.0,8196.0);\nsettings.uvAnim = vec2(0.0,0.0);\nsettings.wrapping = 0.0;\nsettings.specular = 0.0;\nsettings.normalScale = 0.0;\n}\nvoid getTextureSettingsOld(")
;let a=0;return i=Nw(i,"in highp vec2 v_texcoord_0;\nin highp vec2 v_texcoord_1;\nin highp vec2 v_texcoord_2;"),r=Nw(r,"in highp vec2 texcoord_0;\nin highp vec2 texcoord_1;\nin highp vec2 texcoord_2;"),
r=Nw(r,"out highp vec2 v_texcoord_0;\nout highp vec2 v_texcoord_1;\nout highp vec2 v_texcoord_2;"),r=kw(r,"v_texcoord_0=texcoord_0;\nv_texcoord_1=texcoord_1;\nv_texcoord_2=texcoord_2;\n"),
i=i.replace(/(?<!void )getTexel\(\w+,/gm,(()=>`getTexel(v_texcoord_${a++%3},`)),t.vertexShader=r,t.fragmentShader=i,t.uniforms.uTextureAtlas={value:e},t.uniforms.uInvSunDirection.value[2]*=-1,t.uniformsNeedUpdate=!0,t}(e):(function(e){
e.customProgramCacheKey=()=>"floortex",e.onBeforeCompile=(e,t)=>{
e.vertexShader="#ifdef USE_MAP\nattribute vec2 texcoord_0;\nattribute vec2 texcoord_1;\nattribute vec2 texcoord_2;\nattribute vec3 color_1;\nattribute vec3 color_2;\nvarying vec2 v_ra_floortex_0;\nvarying vec2 v_ra_floortex_1;\nvarying vec2 v_ra_floortex_2;\nvarying vec3 v_ra_floortex_weights;\nvarying vec3 v_ra_floortex_usescolor;\n#endif\n"+e.vertexShader.replace("#include <uv_vertex>","#ifdef USE_MAP\nv_ra_floortex_0 = texcoord_0;\nv_ra_floortex_1 = texcoord_1;\nv_ra_floortex_2 = texcoord_2;\nv_ra_floortex_weights = color_1;\nv_ra_floortex_usescolor = color_2;\n#endif\n#include <uv_vertex>"),
e.fragmentShader="#ifdef USE_MAP\nvarying vec2 v_ra_floortex_0;\nvarying vec2 v_ra_floortex_1;\nvarying vec2 v_ra_floortex_2;\nvarying vec3 v_ra_floortex_weights;\nvarying vec3 v_ra_floortex_usescolor;\n#endif\n\nhighp vec3 runeapps_srgb_to_linear(highp vec3 color,float gamma){\n\treturn pow(color.rgb,vec3(1.0/gamma));\n}\nhighp vec3 runeapps_linear_to_srgb(highp vec3 color,float gamma){\n\treturn pow(color.rgb,vec3(gamma));\n}\n"+e.fragmentShader.replace("#include <color_fragment>","").replace("#include <map_fragment>","#include <color_fragment>\n#ifdef USE_MAP\nvec4 texelColor = \n   texture2D( map, v_ra_floortex_0 ) * v_ra_floortex_weights.r * mix(vec4(1.0), diffuseColor, v_ra_floortex_usescolor.r)\n + texture2D( map, v_ra_floortex_1 ) * v_ra_floortex_weights.g * mix(vec4(1.0), diffuseColor, v_ra_floortex_usescolor.g)\n + texture2D( map, v_ra_floortex_2 ) * v_ra_floortex_weights.b * mix(vec4(1.0), diffuseColor, v_ra_floortex_usescolor.b);\ntexelColor = mix( diffuseColor,texelColor,dot(vec3(1.0),v_ra_floortex_weights));\n#endif\ndiffuseColor = texelColor;\n")
}}(a),a.map=e)}let s=new ja(i,a);return s.userData=t.extra,s.name=`floor ${t.chunk.mapsquarex},${t.chunk.mapsquarez} (${t.level})`,s}(0,e))))).filter((e=>e));0!=f.length&&c.add(...f);for(let e=0;e<wS;e++){let t=XS(o,l,e);t&&c.add(t)
;let n=XS(o,l,e,!0);n&&c.add(n)}if(a.hashboxes)for(let t=0;t<wS;t++)c.add(await mS(e,i.byLogical,o,l.mapsquarex,l.mapsquarez,t)),c.add(await gS(e,o,l,t));s=i.byLogical}else s=new Map;let h=l&&a?.skybox?await async function(e,t){
let n=new Pi,r=[0,0,0,0],i=-1;if(t?.extra.unk00?.unk20&&(r=t.extra.unk00.unk20.slice(1)),t?.extra.unk80){
let r=(await e.engine.getArchiveById(xg.config,Ag.environments)).find((e=>e.fileid==t.extra.unk80.environment)),a=Qg.environments.read(r.buffer,e.engine.rawsource);"number"==typeof a.model&&(i=a.model,n=await rS(e,await e.getModelData(a.model)))}
return{skybox:n,fogColor:r,skyboxModelid:i}}(e,l):null,d=e.engine.classicData?ES:xS;return c?.traverse((e=>{if(e instanceof ja){let t=e,n=!1;for(;t;)"floorhidden"==t.userData.modeltype&&(n=!0),t=t.parent
;n&&e.material instanceof cd&&(e.material.wireframe=!0)}})),{chunkx:r,chunkz:i,grid:o,chunk:l,sky:h,modeldata:s,chunkroot:c,chunkSize:d,locRenders:u}}(e,t,r,i,a),this.rootnode.add(this.loaded.chunkroot),this.onModelLoaded(),this.loaded))()}
static defaultopts(e){return{invisibleLayers:!0,collision:!0,map2d:!1,padfloor:!0,skybox:!1,minimap:!1,...e}}static create(e,t,n,r){let i=this.defaultopts(r),a=jS(e.engine,t,n,i);return new py(e,a,t,n,i)}async testLocImg(e){
if(!this.loaded)throw new Error("not loaded");let t=this.loaded?.locRenders.get(e)??[],n=t.map((e=>e.mesh.cloneSection(e)));t.map((e=>e.mesh.setSectionHide(e,!0)));let r=new Pi;r.add(...n.map((e=>e.mesh))),r.traverse((e=>e.layers.set(1))),
this.loaded.chunkroot.add(r);let i=this.renderscene.getCurrent2dCamera(),a=await this.renderscene.takeMapPicture(i,256,256,!1,r);return r.removeFromParent(),t.map((e=>e.mesh.setSectionHide(e,!1))),a}cloneLocModel(e){
return e.map((e=>e.mesh.cloneSection(e)))}replaceLocModel(e,t){let n=this.loaded?.locRenders.get(e)??[];return n.forEach((e=>e.mesh.setSectionHide(e,!0))),t?(this.loaded?.locRenders.set(e,t),
t.forEach((e=>e.mesh.setSectionHide(e,!1)))):this.loaded?.locRenders.delete(e),n}cleanup(){this.listeners={},this.globalname&&(delete globalThis[this.globalname],this.globalname=""),this.chunkdata.then((e=>e.chunkroot.traverse((e=>{
e instanceof ja&&e.geometry.dispose()})))),this.renderscene?.removeSceneElement(this),this.renderscene=null}async renderSvg(e=0,t=!1,n=1){let{chunk:r,grid:i,chunkSize:a,chunkx:s,chunkz:o}=await this.chunkdata,l={x:s*a,z:o*a,xsize:a,zsize:a}
;return ny(this.cache.engine,i,r?.locs??[],l,e,n,t,!1)}getSceneElements(){return{modelnode:this.rootnode,sky:this.loaded?.sky,options:{hideFloor:!0}}}addToScene(e){if(null==this.renderscene&&globalThis.debugchunks)for(let e=0;e<10;e++){
let t=`chunk_${this.chunkx}_${this.chunkz}${0==e?"":`_${e}`}`;if(!globalThis[t]){globalThis[t]=this,this.globalname=t;break}}this.renderscene=e,e.addSceneElement(this)}onModelLoaded(){this.setToggles(this.toggles),this.emit("loaded",this.loaded),
this.emit("changed",void 0),this.renderscene?.sceneElementsChanged()}setToggles(e,t=!1){this.toggles=e,this.rootnode.traverse((n=>{if(n.userData.modelgroup){let r=!t&&(e[n.userData.modelgroup]??!0);n.traverse((e=>{e instanceof ja&&(e.visible=r)}))}
}))}}function fy(e){let t={},n=(e,n)=>{-1!=n&&-1==Object.values(t).indexOf(n)&&(t[e]=n)};if(t.none=-1,e.baseAnims&&(n("default",e.baseAnims.idle),n("walk",e.baseAnims.walk)),e.run&&n("run",e.run),e.idleVariations){
let t=e.idleVariations.reduce(((e,t)=>e+t.probably_chance),0);for(let[r,i]of e.idleVariations.entries())n(0==r?"default":`idle${r}_${i.probably_chance}/${t}`,i.animid)}for(let[t,r]of Object.entries(e))"number"==typeof r&&n(t,e[t]);return t}
function my(e,t){return new Promise(((n,r)=>{let i=e.prepare(t,(e=>e?r(e):n(i)))}))}function gy(e,t){return new Promise(((n,r)=>{e.exec(t,(e=>e?r(e):n()))}))}function _y(e,t){return new Promise(((n,r)=>{e.all(t,((e,t)=>e?r(e):n(t)))}))}
var vy=n(5063),yy=n(9350);class by{static tryCreate(){if("undefined"==typeof require)return null;try{require("sqlite3")}catch{return null}return new by("./cache/fscache.sqlite3")}constructor(e){this.isready=!1,this.ready=(async()=>{
await vy.mkdir(yy.dirname(e),{recursive:!0});let t=await function(e,t){let n=require("sqlite3"),r=(t.write?n.OPEN_READWRITE:n.OPEN_READONLY)|(t.create?n.OPEN_CREATE:0);return new Promise(((t,i)=>{let a=new n.Database(e,r,(e=>e?i(e):t(a)))}))}(e,{
create:!0,write:!0});await gy(t,"CREATE TABLE IF NOT EXISTS groupcache (major INT, minor INT, crc UNSIGNED INT, file BLOB);"),await gy(t,"CREATE UNIQUE INDEX IF NOT EXISTS mainindex ON groupcache(major,minor,crc)"),
this.getstatement=await my(t,"SELECT major, minor, crc, file FROM groupcache WHERE major=? AND minor=? AND crc=?"),this.setstatement=await my(t,"INSERT INTO groupcache(major,minor,crc,file) VALUES (?,?,?,?)"),this.isready=!0})()}
async addFile(e,t,n,r){this.isready||await this.ready,console.log("saving",e,t,n,"len",r.length),_y(this.setstatement,[e,t,n,r])}async getFile(e,t,n){this.isready||await this.ready;let r=await _y(this.getstatement,[e,t,n])
;if(r.length>1)throw new Error("more than one match for fs cached file");if(1==r.length){if(!r[0].file)throw new Error(`file ${e}.${t} not found (explicitly missing in cache)`);return r[0].file}return null}}var xy=n(8287).Buffer
;const Ey="https://archive.openrs2.org";var wy=0,Sy=null,Ty=null;function Ay(){return Ty??(Ty=iy()(`${Ey}/caches.json`).then((e=>e.json()))),Ty}function Cy(){return Sy??(Sy=(async()=>{
const e=[423,623,693,621,619,618,620,617,840,734,736,733,732,731,20,19,17,13,10,9,8,7,6,5,2,1255,905,1256,1003,638,542,463,621,623,620,617,618,619,734,733,20,10,9,8,7,2,666,729,730,728,1455,312,286,1420,1421,1530,1480,644,257,1456,1665,1479]
;return(await Ay()).filter((t=>"en"==t.language&&"live"==t.environment&&!e.includes(t.id)&&"runescape"==t.game&&t.timestamp&&0!=t.builds.length)).sort(((e,t)=>t.builds[0].major-e.builds[0].major||(t.builds[0].minor??0)-(e.builds[0].minor??0)||+new Date(t.timestamp)-+new Date(e.timestamp)))
})()),Sy}function My(e){let t=e.builds.find((e=>0!=e.major));return t?t.major:-1}class Iy extends bv{static async fromId(e){let t=(await Ay()).find((t=>t.id==e));if(!t)throw new Error(`cache ${e} not found on openrs`);return new Iy(t)}constructor(e){
super(!1),this.xteaKeysLoaded=!1,this.xteakeysPromise=null,this.meta=e;let t=My(e);-1!=t?this.buildnr=t:(console.warn("using historic cache for which the build number is not available, treating it as current."),this.buildnr=940),
this.fscache=by.tryCreate()}getCacheMeta(){return{name:`openrs2:${this.meta.id}`,descr:`build: ${this.buildnr}\ndate: ${new Date(this.meta.timestamp??"").toDateString()}\nHistoric cache loaded from openrs2 cache repository.`,
timestamp:new Date(this.meta.timestamp??0)}}getBuildNr(){return this.buildnr}async getCacheIndex(e){return this.buildnr<=700&&!this.xteaKeysLoaded&&e==xg.mapsquares&&(this.xteakeysPromise??(this.xteakeysPromise=(async()=>{
this.xteakeys??(this.xteakeys=new Map);let e=await iy()(`${Ey}/caches/runescape/${this.meta.id}/keys.json`).then((e=>e.json()));for(let t of e){let e=t.archive<<23|t.group;this.xteakeys.set(e,new Uint32Array(t.key))}this.xteaKeysLoaded=!0,
console.log(`loaded ${e.length} xtea keys`)})()),await this.xteakeysPromise),super.getCacheIndex(e)}static async getRecentCache(e=0){return(await Cy())[e]}async downloadFile(e,t){let n
;if(e==xg.index&&t==xg.index||this.getBuildNr()<=Cg)n=`${Ey}/caches/runescape/${this.meta.id}/archives/${e}/groups/${t}.dat`;else{let r=await this.getIndexEntryById(e,t)
;n=`${Ey}/caches/runescape/archives/${e}/groups/${t}/versions/${r.version}/checksums/${0|r.crc}.dat`}const r=await iy()(n);if(!r.ok)throw new Error(`failed to download cache file ${e}.${t} from openrs2 ${this.meta.id}, http code: ${r.status}`)
;const i=await r.arrayBuffer();let a=xy.from(i);return Math.floor(wy/1e7)!=Math.floor((wy+i.byteLength)/1e7)&&console.info(`loaded ${(wy+a.byteLength)/1e6|0} mb from openrs2`),wy+=a.byteLength,a}async getFile(e,t,r){let i=null
;this.fscache&&void 0!==r&&0!=r&&(i=await this.fscache.getFile(e,t,r));let a=i??await this.downloadFile(e,t);return this.fscache&&!i&&void 0!==r&&0!=r&&this.fscache.addFile(e,t,r,a),this.buildnr<=Cg?0==e?a:(s=a,
n(8559).gunzipSync(s)):z_(a,this.getXteaKey(e,t));var s}}var Ry=n(3903);const ky={6:"BRANCH",7:"BRANCH_NOT",8:"BRANCH_EQUALS",9:"BRANCH_LESS_THAN",10:"BRANCH_GREATER_THAN",21:"RETURN",31:"BRANCH_LESS_THAN_OR_EQUALS",
32:"BRANCH_GREATER_THAN_OR_EQUALS",33:"PUSH_INT_LOCAL",34:"POP_INT_LOCAL",35:"PUSH_STRING_LOCAL",36:"POP_STRING_LOCAL",37:"JOIN_STRING",40:"GOSUB_WITH_PARAMS",42:"PUSH_VAR",43:"POP_VAR",45:"PUSH_ARRAY_INT",46:"POP_ARRAY_INT",51:"SWITCH",
150:"CC_CREATE",152:"CC_DELETEALL",404:"BASECOLOUR",1e3:"CC_SETPOSITION",1001:"CC_SETSIZE",1003:"CC_SETHIDE",1101:"CC_SETCOLOUR",1102:"CC_SETFILL",1103:"CC_SETTRANS",1105:"CC_SETGRAPHIC",1106:"CC_SET2DANGLE",1107:"CC_SETTILING",1108:"CC_SETMODEL",
1109:"CC_SETMODELANGLE",1110:"CC_SETMODELANIM",1112:"CC_SETTEXT",1113:"CC_SETTEXTFONT",1114:"CC_SETTEXTALIGN",1115:"CC_SETTEXTSHADOW",1118:"CC_SETVFLIP",1119:"CC_SETHFLIP",1211:"CC_SETPLAYERMODEL_SELF",1300:"CC_SETOP",1301:"CC_SETDRAGGABLE",
1302:"CC_SETDRAGRENDERBEHAVIOUR",1303:"CC_SETDRAGDEADZONE",1304:"CC_SETDRAGDEADTIME",1305:"CC_SETOPBASE",1400:"CC_SETONCLICK",1401:"CC_SETONHOLD",1402:"CC_SETONRELEASE",1403:"CC_SETONMOUSEOVER",1404:"CC_SETONMOUSELEAVE",1405:"CC_SETONDRAG",
1408:"CC_SETONTIMER",1409:"CC_SETONOP",1410:"CC_SETONDRAGCOMPLETE",1428:"CC_SETONVARCTRANSMIT",1500:"CC_GETX",1501:"CC_GETY",1505:"CC_GETLAYER",1702:"CC_GETID",2e3:"IF_SETPOSITION",2001:"IF_SETSIZE",2003:"IF_SETHIDE",2005:"IF_SETNOCLICKTHROUGH",
2100:"IF_SETSCROLLPOS",2101:"IF_SETCOLOUR",2102:"IF_SETFILL",2103:"IF_SETTRANS",2105:"IF_SETGRAPHIC",2108:"IF_SETMODEL",2109:"IF_SETMODELANGLE",2110:"IF_SETMODELANIM",2112:"IF_SETTEXT",2113:"IF_SETTEXTFONT",2116:"IF_SETOUTLINE",
2117:"IF_SETGRAPHICSHADOW",2120:"IF_SETSCROLLSIZE",2123:"IF_SETMODELZOOM",2127:"IF_SETPARAM_INT",2200:"IF_SETOBJECT",2201:"IF_SETNPCHEAD",2205:"IF_SETOBJECT_NONUM",2300:"IF_SETOP",2305:"IF_SETOPBASE",2307:"IF_CLEAROPS",2309:"IF_SETOPCURSOR",
2400:"IF_SETONCLICK",2404:"IF_SETONMOUSELEAVE",2406:"IF_SETONTARGETLEAVE",2407:"IF_SETONVARTRANSMIT",2408:"IF_SETONTIMER",2409:"IF_SETONOP",2410:"IF_SETONDRAGCOMPLETE",2412:"IF_SETONMOUSEREPEAT",2414:"IF_SETONINVTRANSMIT",2415:"IF_SETONSTATTRANSMIT",
2416:"IF_SETONTARGETENTER",2417:"IF_SETONSCROLLWHEEL",2422:"IF_SETONMISCTRANSMIT",2424:"IF_SETONSUBCHANGE",2426:"IF_SETONCAMFINISHED",2428:"IF_SETONVARCTRANSMIT",2429:"IF_SETONVARCSTRTRANSMIT",2431:"IF_SETONCLANSETTINGSTRANSMIT",
2433:"IF_SETONVARCLANTRANSMIT",2500:"IF_GETX",2501:"IF_GETY",2502:"IF_GETWIDTH",2503:"IF_GETHEIGHT",2505:"IF_GETLAYER",2600:"IF_GETSCROLLX",2601:"IF_GETSCROLLY",2602:"IF_GETTEXT",2603:"IF_GETSCROLLWIDTH",2604:"IF_GETSCROLLHEIGHT",
2605:"IF_GETMODELZOOM",2606:"IF_GETMODELANGLE_X",2607:"IF_GETMODELANGLE_Z",2608:"IF_GETMODELANGLE_Y",2609:"IF_GETTRANS",2610:"IF_GETMODELXOF",2611:"IF_GETMODELYOF",2612:"IF_GETGRAPHIC",2703:"IF_GETNEXTSUBID",2800:"IF_GETTARGETMASK",3100:"MES",
3110:"RESUME_OBJDIALOG",3114:"MES_TYPED",3116:"RESUME_HSLDIALOG",3200:"SOUND_SYNTH",3206:"SOUND_VORBIS_VOLUME",3209:"SOUND_VORBIS_RATE",3300:"CLIENTCLOCK",3301:"INV_GETOBJ",3302:"INV_GETNUM",3303:"INV_TOTAL",3304:"INV_SIZE",3306:"STAT_BASE",
3307:"STAT_VISIBLE_XP",3308:"COORD",3309:"COORDX",3310:"COORDY",3311:"COORDZ",3313:"INVOTHER_GETOBJ",3321:"RUNENERGY_VISIBLE",3335:"MAP_LANG",3336:"MOVECOORD",3342:"GET_MOUSEX",3343:"GET_MOUSEY",3408:"ENUM",3411:"ENUM_GETOUTPUTCOUNT",
3612:"CLAN_GETCHATCOUNT",3616:"CLAN_GETCHATMINKICK",3618:"CLAN_GETCHATRANK",3620:"CLAN_LEAVECHAT",3753:"ACTIVECLANCHANNEL_GETRANKKICK",3757:"ACTIVECLANCHANNEL_GETUSERRANK",3760:"ACTIVECLANCHANNEL_GETUSERSLOT",4e3:"ADD",4001:"SUB",4002:"MULTIPLY",
4003:"DIVIDE",4004:"RANDOM",4005:"RANDOMINC",4010:"TESTBIT",4011:"MODULO",4012:"POW",4014:"AND",4016:"MIN",4017:"MAX",4018:"SCALE",4019:"RANDOM_SOUND_PITCH",4020:"HSVTORGB",4101:"APPEND",4103:"LOWERCASE",4107:"COMPARE",4108:"PARAHEIGHT",
4117:"STRING_LENGTH",4118:"SUBSTRING",4119:"REMOVETAGS",4121:"STRING_INDEXOF_STRING",4124:"TOSTRING_LOCALISED",4125:"STRINGWIDTH",4200:"OC_NAME",4208:"OC_PARAM",4500:"STRUCT_PARAM",4600:"BAS_GETANIM_READY",5e3:"CHAT_GETFILTER_PUBLIC",
5001:"CHAT_SETFILTER",5005:"CHAT_GETFILTER_PRIVATE",5016:"CHAT_GETFILTER_TRADE",5020:"CHAT_PLAYERNAME_UNFILTERED",5207:"WORLDMAP_GETMAPNAME",5214:"WORLDMAP_JUMPTOSOURCECOORD",5306:"GETWINDOWMODE",5405:"SPLINE_NEW",5406:"SPLINE_ADDPOINT",
5407:"SPLINE_LENGTH",5500:"CAM_MOVETO",5501:"CAM_LOOKAT",5502:"CAM_MOVEALONG",5503:"CAM_RESET",5504:"CAM_FORCEANGLE",5511:"CAM_FOLLOWCOORD",5512:"CAM_SMOOTHRESET",5616:"LOBBY_LEAVELOBBY",5624:"USERFLOWFLAGS",5630:"LOGIN_CANCEL",6300:"DATE_MINUTES",
6306:"DATE_MINUTES_FROMRUNEDAY",6509:"WORLDLIST_PINGWORLDS",9001:"PUSH_CONSTANT_STRING",1e4:"CAM2_REMOVEALLEFFECTS",10001:"NOTIFICATIONS_OPENSETTINGS",10002:"AUTOSETUP_SETMIN",10003:"CANCEL_INTERFACE_DRAG",10004:"POP_INT_DISCARD",
10005:"STEAM_STORESTATS",10006:"RESUME_COUNTDIALOG",10007:"FRIEND_DEL",10008:"INTERFACE_SETPICKINGRADIUS",10009:"UNKNOWN_COMMAND_637",10010:"IF_SENDTOFRONT",10011:"IF_SENDTOBACK",10012:"MAP_PRELOAD",10013:"UNKNOWN_COMMAND_186",10014:"MINIMENU_CLOSE",
10015:"UNKNOWN_COMMAND_501",10016:"DEEPLINK_CLEAR_INDEX",10017:"UNKNOWN_COMMAND_722",10018:"CC_PAGEDCAROUSEL_SETDYNAMICPAGECOUNT",10019:"CC_RADIALPROGRESSOVERLAY_SETVALUE",10020:"IF_CLOSESUBCLIENT",10021:"CUTSCENE2D_STOP",10022:"PUSH_VARBIT",
10023:"POP_VARBIT",10024:"PUSH_LONG_LOCAL",10025:"CC_SETPAUSETEXT",10026:"CC_CLEAROPS",10027:"CAM2_ADDEFFECT_ZTILT",10028:"MAP_MEMBERS",10029:"CHAT_PLAYERNAME",10030:"CAM2_SETCOLLISIONMODE",10031:"ABORT_DIALOG",10032:"CLIENTOPTION_SET",
10033:"INT_TO_LONG",10034:"IF_SETMODELORTHOG",10035:"CAM2_UPDATEEFFECT_ZTILT",10036:"CAM2_SETFIELDOFVIEW",10037:"IF_SETOBJECT_HIGHRES",10038:"IF_RADIALPROGRESSOVERLAY_SETVALUE",10039:"UNKNOWN_COMMAND_130",10040:"OPENURLRAW",
10041:"IF_SETMOUSEOVERCURSOR",10042:"VIEWPORT_SETFOV",10043:"CC_SETOPCURSOR",10044:"SHOP_OPENCATEGORIES",10045:"CC_CHECK_SETBUTTONSIZE",10046:"CC_CHECK_SETALIGNMENT",10047:"ENUM_STRING",10048:"IF_HASSUB",10049:"CC_PARAM",10050:"BITCOUNT",
10051:"IF_SETONCAMERAUPDATETRANSMIT",10052:"IF_SETONDIALOGABORT",10053:"UNKNOWN_COMMAND_128",10054:"OPENURL",10055:"CC_RADIALPROGRESSOVERLAY_SET",10056:"CC_RADIOGROUP_CLEAROPTIONS",10057:"IF_TRIGGEROP",10058:"IF_CHECK_GET",10059:"IF_CALLONRESIZE",
10060:"IF_SET2DANGLE",10061:"GET_COL_TAG",10062:"OC_MINIMENU_COLOUR",10063:"CHAT_LASTUID",10064:"TOSTRING",10065:"DATE_RUNEDAY_FROMDATE",10066:"CC_SETHELD",10067:"LOBBY_ENTERLOBBYREPLY",10068:"IF_HASSUBMODAL",10069:"IF_HASSUBOVERLAY",10070:"OC_COST",
10071:"CC_CAROUSEL_SETSELECTED",10072:"CC_CAROUSEL_SETTEXTENTRIES",10073:"CC_CAROUSEL_SETICONENTRIES",10074:"CC_RADIALPROGRESSOVERLAY_START",10075:"OR",10076:"NC_PARAM",10077:"IF_GETHIDE",10078:"DB_GETFIELDCOUNT",10079:"IF_RADIALPROGRESSOVERLAY_SET",
10080:"ACTIVECLANSETTINGS_FIND_LISTENED",10081:"ACTIVECLANSETTINGS_FIND_AFFINED",10082:"PLAYER_GROUP_FIND",10083:"IF_SETNPCMODEL",10084:"OPENURL_SHIM",10085:"CC_CHECK_SET",10086:"CC_SETFEEDBACKMODE",10087:"CC_SETENABLED",
10088:"STAT_VISIBLE_XP_ACTUAL",10089:"IGNORE_DEL",10090:"CC_INPUT_SETUP",10091:"SHOP_APPLYPENDINGTRANSACTIONS",10092:"IF_GETTOP",10093:"STAT",10094:"DB_GETFIELD",10095:"IF_LIST_ADDENTRY",10096:"IF_RADIALPROGRESSOVERLAY_START",10097:"IF_SETONRESIZE",
10098:"CC_SETPARAM",10099:"IF_LIST_GETSELECTED",10100:"DB_FIND_WITH_COUNT",10101:"IF_SETONMOUSEOVER",10102:"IF_FIND",10103:"FEDERATED_LOGIN",10104:"UNKNOWN_COMMAND_461",10105:"CC_SETNOCLICKTHROUGH",10106:"UNKNOWN_COMMAND_702",
10107:"CC_SETONMOUSEREPEAT",10108:"DATE_RUNEDAY",10109:"UNKNOWN_COMMAND_181",10110:"MAP_LOADINGSCREEN_SETTRIGGERPERCENT",10111:"IF_SETPAUSETEXT",10112:"DB_FINDNEXT",10113:"DB_FIND",10114:"IF_SETPARAM_STRING",10115:"CC_DELETE",10116:"CC_FIND",
10117:"CC_RESUME_PAUSEBUTTON",10118:"CC_SETOUTLINE",10119:"RESUME_STRINGDIALOG",10120:"CLIENTTYPE",10121:"IF_GETPARENTLAYER",10122:"SETDEFAULTCURSORS",10123:"CAM2_GETCONTROLMODE",10124:"URLENCODE",10125:"CHAT_SENDPUBLIC",10126:"CHAT_SETMODE",
10127:"CLANFORUMQFC_TOSTRING",10128:"CC_BUTTON_SETTOGGLED",10129:"CC_BUTTON_SETCANTOGGLE",10130:"PLAYERCOUNTRY",10131:"WORLDMAP_GETCONFIGORIGIN",10132:"CC_PAGEDLAYER_SETPAGELABELS",10133:"CC_PAGEDLAYER_SETDYNAMICPAGECOUNT",
10134:"CC_PAGEDLAYER_SETPAGEICONS",10135:"UNKNOWN_COMMAND_502",10136:"CLANPROFILE_FIND",10137:"CC_SCROLLBAR_SETUP",10138:"CC_SCROLLBAR_SETVISIBLE",10139:"CLIENTOPTION_GET",10140:"KEYHELD_ALT",10141:"IF_OPENSUBCLIENT",
10142:"HIGHLIGHT_SET_CATEGORY_COLOUR",10143:"HIGHLIGHT_SET_CATEGORY_MODE",10144:"OS_PHYSICALMEMORYSIZE",10145:"CC_SETONVARTRANSMIT",10146:"PLAYERMEMBER",10147:"INV_TOTALCAT",10148:"ACTIVECLANCHANNEL_FIND_AFFINED",10149:"WORLDMAP_ISLOADED",
10150:"CC_FINDBYCATEGORY",10151:"IF_CLOSE",10152:"IF_SETENABLED",10153:"LONG_BRANCH_EQUALS",10154:"ENUM_GETREVERSEINDEX",10155:"INV_GETVAR",10156:"DETAIL_LOGINVOL",10157:"DETAIL_SPEECHVOL",10158:"DETAIL_BGSOUNDVOL",10159:"DETAIL_MUSICVOL",
10160:"DETAIL_SOUNDVOL",10161:"CC_DRAGPICKUP",10162:"CC_GETHEIGHT",10163:"WORLDLIST_FETCH",10164:"UNKNOWN_COMMAND_474",10165:"CAM2_SETPOSITIONANGULARINTERPOLATION",10166:"CAM2_SETLINEARMOVEMENTMODE",10167:"IF_GET2DANGLE",
10168:"CREATE_SUGGEST_NAME_REQUEST",10169:"GET_OBJ_BOUNDING_BOX",10170:"GET_OBJ_SCREEN_POSITION",10171:"GET_OBJ_OVERLAY_HEIGHT",10172:"GET_ENTITY_BOUNDING_BOX",10173:"GET_ENTITY_SCREEN_POSITION",10174:"GET_ENTITY_OVERLAY_HEIGHT",
10175:"GET_LOC_BOUNDING_BOX",10176:"GET_LOC_SCREEN_POSITION",10177:"GET_LOC_OVERLAY_HEIGHT",10178:"OC_ALLOWSPLACEHOLDER",10179:"USERDETAIL_DOB",10180:"STAFFMODLEVEL",10181:"NOTIFICATIONS_INIT",10182:"CC_PAGEDCAROUSEL_SETSELECTED",
10183:"CC_PAGEDLAYER_SETACTIVEPAGE",10184:"SOUND_GROUP_STOP",10185:"IF_BUTTON_SETTOGGLED",10186:"LOBBY_ENTERGAMEREPLY",10187:"IF_SETRETEX",10188:"ACTIVECLANCHANNEL_FIND_LISTENED",10189:"UNKNOWN_COMMAND_131",10190:"LOGIN_REPLY",10191:"CC_CREATECHILD",
10192:"MEC_PARAM",10193:"IF_SETOPKEYIGNOREHELD",10194:"IF_SETOPKEY",10195:"ACHIEVEMENT_FINDGRACED",10196:"IF_SETASPECT",10197:"IF_SETONBUTTONCLICK",10198:"CAM2_SETDEPTHPLANES",10199:"INV_FREESPACE",10200:"CC_SETPARAM_INT",10201:"CC_GETTEXT",
10202:"CC_GETWIDTH",10203:"CC_CRMVIEW_GETINT",10204:"CC_CRMVIEW_CONTAINS",10205:"CC_SETNPCHEAD",10206:"TARGETMODE_CANCEL",10207:"TARGETMODE_ACTIVE",10208:"WORLDLIST_SPECIFIC_THISWORLD",10209:"PLATFORMTYPE",10210:"MAP_WORLD",10211:"HAS_NXT",
10212:"FRIEND_GETWORLD",10213:"CLAN_GETCHATUSERWORLD",10214:"UNKNOWN_COMMAND_129",10215:"OS_DRIVER_VENDOR",10216:"SHOP_PURCHASEITEM",10217:"CC_CLEARSCRIPTHOOKS",10218:"INV_TOTALPARAM",10219:"WORLDMAP_DISABLEELEMENTCATEGORY",10220:"IF_CHECK_SET",
10221:"VIEWPORT_CLAMPFOV",10222:"VIEWPORT_SETZOOM",10223:"IF_SETONFRIENDTRANSMIT",10224:"CC_RADIOGROUP_SETOPTIONS",10225:"CC_RADIOGROUP_SETSELECTIONLIMITS",10226:"RUNWEIGHT_VISIBLE",10227:"STEAM_SETACHIVEMENT",10228:"IF_SETONCLANCHANNELTRANSMIT",
10229:"IF_SETONCLANTRANSMIT",10230:"UNKNOWN_COMMAND_499",10231:"UNKNOWN_COMMAND_500",10232:"SETBIT",10233:"CLEARBIT",10234:"IF_DELETEALLNESTED",10235:"GENDER",10236:"ACHIEVEMENT_FINDCATEGORY",10237:"POP_LONG_LOCAL",10238:"ADD_LONG",10239:"BASEIDKIT",
10240:"ENUM_GETREVERSECOUNT",10241:"QUEST_GETDIFFICULTY",10242:"IF_SETMODELLIGHTING",10243:"OC_IOP",10244:"ENUM_HASOUTPUT",10245:"QUEST_GETNAME",10246:"ACHIEVEMENT_FINDSUBCAT",10247:"IF_SET_GAMESCREEN_ENABLED",10248:"CC_GETINVCOUNT",
10249:"OC_UNCERT",10250:"SEQLENGTH",10251:"PARAWIDTH",10252:"CC_SETSCROLLPOS",10253:"OC_WEARPOS",10254:"NOTIFICATIONS_SENDLOCAL",10255:"IF_SETONRELEASE",10256:"RESUME_CLANFORUMQFCDIALOG",10257:"UNKNOWN_COMMAND_733",10258:"IF_SETMAXLINES",
10259:"SHOW_SOFTWARE_LICENSE",10260:"IF_CREATENESTED",10261:"IF_SETTEXTALIGN",10262:"QUEST_PARAM",10263:"TEXT_SWITCH",10264:"CREATE_NAME_AVAILABLEREQUEST",10265:"IF_SETONKEY",10266:"LOGIN_RESETREPLY",10267:"LOGIN_INPROGRESS",
10268:"CC_SLIDER_SETUPENUM",10269:"CC_SLIDER_SETUP",10270:"IGNORE_TEST",10271:"ACHIEVEMENT_ACHIEVEMENT_REQ_COUNT",10272:"ACHIEVEMENT_IS_CHECKLIST",10273:"CAM2_GETPOSITIONENTITY_ANGLEOFFSETS",10274:"CAM2_GETPOSITIONMODE",10275:"DATE_RUNEDAY_TODATE",
10276:"REBOOTTIMER",10277:"CC_SETMAXLINES",10278:"UNKNOWN_COMMAND_183",10279:"WORLDMAP_DISABLETEXTSIZE",10280:"WORLDMAP_DISABLETYPE",10281:"UNKNOWN_COMMAND_152",10282:"SETWALKMARKER",10283:"IF_RESUME_PAUSEBUTTON",10284:"CAM2_SETPOSITIONENTITY_NPC",
10285:"CAM2_SETLOOKATENTITY_NPC",10286:"CLAN_GETCHATDISPLAYNAME",10287:"FRIEND_PLATFORM",10288:"CC_SETONCLICKREPEAT",10289:"CC_GETGRAPHIC",10290:"IF_SETDRAGGABLE",10291:"CC_SETPARAM_STRING",10292:"IF_SETPLAYERMODEL_SELF",
10293:"FEDERATED_LOGIN_STATUS",10294:"SSO_AVAILABLE",10295:"CAM2_ADDEFFECT_SHAKE",10296:"STAT_BASE_ACTUAL",10297:"CC_GETCOLOUR",10298:"IF_CREATECHILD",10299:"UNKNOWN_COMMAND_187",10300:"STOCKMARKET_ISOFFEREMPTY",10301:"CC_SETMOUSEOVERCURSOR",
10302:"PLAYER_GROUP_MEMBER_GET_STATUS",10303:"IF_SETRECOL",10304:"IF_GRID_SETLAYOUTPARAMS",10305:"USERDETAIL_QUICKCHAT",10306:"DETAILGET_LOGINVOL",10307:"DETAILGET_SPEECHVOL",10308:"DETAILGET_BGSOUNDVOL",10309:"DETAILGET_MUSICVOL",
10310:"DETAILGET_SOUNDVOL",10311:"LOBBY_ENTERGAME",10312:"ACTIVECLANSETTINGS_GETAFFINEDCOUNT",10313:"CC_GETINVOBJECT",10314:"OC_MEMBERS",10315:"CC_SETOBJECT_HIGHRES",10316:"SHOP_REQUESTDATA",10317:"IF_GETFONTMETRICS",
10318:"CC_RADIOGROUP_SETOPTIONSELECTED",10319:"AUTOSETUP_GETLEVEL",10320:"CC_GETHIDE",10321:"LONG_BRANCH_GREATER_THAN",10322:"SUB_LONG",10323:"IF_GETNEXTCATEGORYSUBID",10324:"UNKNOWN_COMMAND_729",10325:"RESEND_UID_PASSPORT_REQUEST",
10326:"CC_GETMODELZOOM",10327:"CC_GETMODELANGLE_Z",10328:"CC_GETMODELANGLE_Y",10329:"CC_GETMODELANGLE_X",10330:"CC_GETMODELYOF",10331:"CC_GETMODELXOF",10332:"MINIMENUOPEN",10333:"IF_SETDRAGDEADTIME",10334:"IF_SETDRAGDEADZONE",
10335:"ACTIVECLANCHANNEL_GETUSERWORLD",10336:"CC_GETDYNAMICLAYER",10337:"CC_DELETEALLNESTED",10338:"CC_GETOPBASE",10339:"MARKETING_INITATTRIBUTION",10340:"MARKETING_INITANALYTICS",10341:"OC_HASVAROBJ",10342:"CLAN_JOINCHAT",
10343:"SHOP_PURCHASEITEMSTATUS",10344:"IF_SETONHORIZONTALSWIPE",10345:"IF_LIST_SETDROPDOWNNUMENTRIES",10346:"STYLESHEET_GET_VALUE",10347:"IF_GETSTYLESHEET",10348:"IF_LIST_SETSELECTIONLIMIT",10349:"LONG_BRANCH_GREATER_THAN_OR_EQUALS",
10350:"INV_STOCKBASE",10351:"ACHIEVEMENT_SUBCAT",10352:"ACHIEVEMENT_CATEGORY",10353:"CC_SETCHILDSPACING",10354:"CC_PANEL_SETISVERTICAL",10355:"FULLSCREEN_GETMODE",10356:"OC_CATEGORY",10357:"CC_SETOPTKEYIGNOREHELD",10358:"CC_SETOPTKEY",
10359:"IF_SETONVERTICALSWIPE",10360:"POP_STRING_DISCARD",10361:"IF_SETONPLAYERGROUPTRANSMIT",10362:"QUIT",10363:"DB_GETROWTABLE",10364:"UNKNOWN_COMMAND_735",10365:"VIDEO_ADVERT_FORCE_REMOVE",10366:"CC_SETOBJECT_ALWAYSNUM",10367:"CC_SETOBJECT_NONUM",
10368:"CC_SETOBJECT",10369:"APPLET_HASFOCUS",10370:"CAM2_SETPOSITIONPOINTCOLLISION",10371:"MULTIPLY_LONG",10372:"CC_LIST_CLEARSELECTION",10373:"IF_SETVFLIP",10374:"IF_GETMODEL",10375:"LOBBY_ENTERLOBBY_SSO",10376:"IF_SETONHOOK46",
10377:"CC_CRMVIEW_GETSTRING",10378:"CC_GETTRANS",10379:"CC_GRID_SETLAYOUTPARAMS",10380:"UNKNOWN_COMMAND_473",10381:"UNKNOWN_COMMAND_182",10382:"UNKNOWN_COMMAND_173",10383:"CC_SETOPTKEYRATE",10384:"CC_COMBO_CLEARENTRIES",10385:"UNKNOWN_COMMAND_737",
10386:"WORLDMAP_CLOSEMAP",10387:"IF_CLEARSCRIPTHOOKS",10388:"IF_SETONDRAG",10389:"MAX_LONG",10390:"FORMATMINIMENU",10391:"IF_LIST_SETENTRIES",10392:"CC_SETONDROPDOWNSELECT",10393:"SCALE_LONG",10394:"WORLDLIST_SWITCH",10395:"COS_DEG",10396:"SIN_DEG",
10397:"UI_GETDYNID",10398:"UI_GETCATEGORY",10399:"COORDZ_FINE",10400:"COORDX_FINE",10401:"MOVECOORD_FINE",10402:"COORDY_FINE",10403:"COORD_GRIDTOFINE",10404:"UNKNOWN_COMMAND_734",10405:"UNKNOWN_COMMAND_738",10406:"IF_SETTEXTANTIMACRO",
10407:"CC_GETTARGETMASK",10408:"PLAYER_GROUP_GET_OWNER_SLOT",10409:"CC_NPC_SETCUSTOMRETEX",10410:"SETBIT_RANGE_TOINT",10411:"LONG_BRANCH_LESS_THAN",10412:"DIVIDE_LONG",10413:"IGNORE_ADD_TEMP",10414:"FRIEND_TEST",10415:"COMLEVEL_ACTIVE",
10416:"UNKNOWN_COMMAND_126",10417:"TTV_LIVESTREAMS_UPDATE",10418:"UNKNOWN_COMMAND_120",10419:"FRIEND_ADD",10420:"SSO_LOGOUT",10421:"DATE_YEAR",10422:"OC_CERT",10423:"IF_SETSUBTRACTINSETS",10424:"WORLDMAP_GETZOOM",10425:"WORLDMAP_SETZOOM",
10426:"PLAYER_GROUP_MEMBER_GET_RANK",10427:"PLAYER_GROUP_MEMBER_IS_OWNER",10428:"DEEPLINK_GET",10429:"DEEPLINK_COUNT",10430:"QUEST_FINISHED",10431:"IF_GETENABLED",10432:"CC_TRIGGEROP",10433:"UNPACK_LONG",10434:"SSO_DISPLAYNAME",
10435:"CC_GETPARENTLAYER",10436:"IGNORE_ADD",10437:"CC_GETFONTMETRICS",10438:"CC_SETSCROLLSIZE",10439:"CAM2_SETPOSITIONPOINT_POINT",10440:"CAM2_SETLOOKATPOINT_POINT",10441:"ESCAPE",10442:"CAM2_SETLOOKATENTITY_PLAYER",10443:"CAM2_SETPOSITIONMODE",
10444:"CAM2_SETLOOKATMODE",10445:"CC_SETONBUTTONCLICK",10446:"WINDOW_GETINSETS",10447:"NOTIFICATIONS_CANCELLOCAL",10448:"ACTIVECLANSETTINGS_GETCLANNAME",10449:"LONG_BRANCH_NOT",10450:"CC_SETMODELLIGHTING",10451:"CC_SETSTYLESHEET",10452:"DB_LISTALL",
10453:"CAM_GETANGLE_YA",10454:"CAM_GETANGLE_XA",10455:"PLAYERMODLEVEL",10456:"PLAYERMOD",10457:"CC_SETASPECT",10458:"CC_GETGRAPHICDIMENSIONS",10459:"CC_GETSCROLLWIDTH",10460:"CC_GETSCROLLX",10461:"VIEWPORT_GETZOOM",
10462:"IF_SETONPLAYERGROUPVARPTRANSMIT",10463:"IF_NPC_SETCUSTOMRETEX",10464:"IF_NPC_SETCUSTOMHEADMODEL",10465:"IF_SETONHORIZONTALPINCH",10466:"IF_SETONVERTICALPINCH",10467:"IF_SETPINCHFLAGS",10468:"IF_SETPINCHDEADZONE",
10469:"CHATPHRASE_GETDYNAMICCOMMANDCOUNT",10470:"IF_SETONSTOCKTRANSMIT",10471:"IGNORE_SETNOTES",10472:"IGNORE_GETNAME",10473:"FRIEND_SETNOTES",10474:"FRIEND_GETNAME",10475:"CC_SETSWIPEDEADZONE",10476:"CC_SETSWIPEDEADTIME",10477:"CC_SETSWIPEUNKNOWN2",
10478:"CC_SETSWIPEUNKNOWN1",10479:"CC_SETSWIPEFLAGS",10480:"CC_GETOP",10481:"FRIEND_SETRANK",10482:"STRING_INDEXOF_CHAR",10483:"STYLESHEET_GET_PARENT_ID",10484:"STYLESHEET_HAS_VALUE",10485:"WORLDLIST_SPECIFIC",10486:"IF_SETONCHATTRANSMIT",
10487:"OC_WEARPOS2",10488:"WORLDMAP_JUMPTODISPLAYCOORD",10489:"HAS_HTML5",10490:"STOCKMARKET_ISOFFERFINISHED",10491:"LONG_BRANCH_LESS_THAN_OR_EQUALS",10492:"CC_CALLONRESIZE",10493:"FRIEND_GETSLOTFROMNAME",10494:"GETBIT_RANGE",
10495:"CC_SETOPKEYIGNOREHELD",10496:"CC_SETOPKEY",10497:"UNKNOWN_COMMAND_455",10498:"IF_SETOBJECT_ALWAYSNUM",10499:"CC_GET2DANGLE",10500:"OC_STACKABLE",10501:"ACHIEVEMENT_REQSTATE",10502:"CC_SENDTOFRONT",10503:"TTV_LIBRARY_REQUEST",
10504:"CAM2_GETPOSITIONPOINT_POINT",10505:"ACTIVECLANSETTINGS_GETBANNEDDISPLAYNAME",10506:"INVPOW",10507:"GETCLIPBOARD",10508:"QUEST_STATREQ_LEVEL",10509:"QUEST_STATREQ_STAT",10510:"QUEST_STATREQ_COUNT",10511:"CC_SETOPKEYRATE",
10512:"IF_SETTEXTSHADOW",10513:"IF_LIST_SETISSELECTED",10514:"MARKETING_SENDATTRIBUTIONEVENT",10515:"MARKETING_SENDANALYTICSEVENT",10516:"QUEST_POINTSREQ",10517:"CC_SETONVARCSTRTRANSMIT",10518:"CC_SETONINVTRANSMIT",10519:"TOSTRING_LOCALISED_LONG",
10520:"ACHIEVEMENT_ALLPREREQMET",10521:"QUEST_STARTED",10522:"UNKNOWN_COMMAND_175",10523:"IF_SETONGAMEPADBUTTONHELD",10524:"IF_SETONGAMEPADTRIGGER",10525:"IF_SETONGAMEPADAXIS",10526:"IF_SETONGAMEPADBUTTON",10527:"ABS",10528:"KEYHELD_SHIFT",
10529:"KEYHELD_CTRL",10530:"CC_LIST_SETENTRYICON",10531:"CC_LIST_ADDENTRY",10532:"ACHIEVEMENT_FINDNEXT",10533:"CHATPHRASE_GETAUTORESPONSECOUNT",10534:"TTV_WEBCAM_GETDEVICE_BYUNIQUENAME",10535:"MAP_LOADEDPERCENT",10536:"CAM2_ISENABLED",
10537:"CAM2_SETFIELDOFVIEWSCREEN",10538:"VIEWPORT_GETEFFECTIVESIZE",10539:"SETHARDCODEDOPCURSORS",10540:"QUEST_GETSORTNAME",10541:"CC_SENDTOBACK",10542:"INVOTHER_TOTAL",10543:"IF_GET_GAMESCREEN",10544:"CC_SETNPCMODEL",
10545:"CREATE_SUGGEST_NAME_REPLY",10546:"ACTIVECLANSETTINGS_GETAFFINEDRANK",10547:"ACTIVECLANSETTINGS_GETAFFINEDSLOT",10548:"WORLDMAP_3DVIEW_SETLODDISTANCE",10549:"PLAYER_GROUP_MEMBER_GET_DISPLAYNAME",10550:"PLAYER_GROUP_MEMBER_COUNT",
10551:"IF_SETTARGETVERB",10552:"IF_SETOPKEYRATE",10553:"DETAILGET_INTERFACESCALE",10554:"UNKNOWN_COMMAND_458",10555:"TTV_STREAM_GETVIEWERS",10556:"TTV_STREAM_GETSTATE",10557:"IF_SETMODELTINT",10558:"MAP_LOADINGSCREEN_ISOPEN",
10559:"SOUND_SPEECH_VOLUME",10560:"OC_ICURSOR",10561:"ACHIEVEMENT_GETNAME",10562:"OPENSTORE",10563:"CREATE_REPLY",10564:"TELEMETRY_GET_GRID_VALUE",10565:"TELEMETRY_GET_COLUMN_INDEX",10566:"TELEMETRY_GET_ROW_INDEX",10567:"TELEMETRY_GET_GROUP_INDEX",
10568:"ACHIEVEMENT_GETREWARD",10569:"DEFINE_ARRAY",10570:"STOCKMARKET_GETOFFERITEM",10571:"CHAT_CLEAR",10572:"CREATE_NAME_VALIDATE_REPLY",10573:"OC_DESC",10574:"PUSH_CONSTANT_INT",10575:"IF_GETCOLOUR",10576:"FORMAT_DATETIME_FROM_MINUTES",
10577:"CAM2_SETPOSITIONENTITY_PLAYER",10578:"TTV_LOGIN",10579:"RESUME_COUNTDIALOG_LONG",10580:"CC_RADIALPROGRESSOVERLAY_GETPROGRESS",10581:"TTV_WEBCAM_STOP",10582:"OPENURL_NOLOGIN",10583:"IF_GETINVCOUNT",10584:"IF_GETINVOBJECT",
10585:"INVOTHER_GETVAR",10586:"FORCE_INTERFACE_DRAG",10587:"CC_SETMODELZOOM",10588:"WORLDMAP_GETCONFIGZOOM",10589:"WORLDMAP_SETMAP",10590:"WORLDMAP_GETCURRENTMAP",10591:"CC_SETONSCROLLWHEEL",10592:"TTV_WEBCAM_START",
10593:"ACHIEVEMENT_TOTAL_RUNESCORE",10594:"QUEST_QUESTREQ",10595:"QUEST_QUESTREQ_COUNT",10596:"CHAT_SENDABUSEREPORT",10597:"RESUME_NAMEDIALOG",10598:"USERDETAIL_LOBBY_PLAYAGE",10599:"STOCKMARKET_GETOFFERPRICE",10600:"STOCKMARKET_GETOFFERCOUNT",
10601:"NOTIFICATIONS_ISLOCALSCHEDULED",10602:"UNKNOWN_COMMAND_480",10603:"IF_GETOP",10604:"AUTOSETUP_SETCUSTOM",10605:"AUTOSETUP_SETULTRA",10606:"AUTOSETUP_SETHIGH",10607:"AUTOSETUP_SETMEDIUM",10608:"AUTOSETUP_SETLOW",10609:"SHOP_REQUESTDATASTATUS",
10610:"FPS_STATS",10611:"APPEND_NUM",10612:"WORLDMAP_SETMAP_COORD_OVERRIDE",10613:"WORLDMAP_GETMAP",10614:"MAP_ISOWNER",10615:"TTV_LOGOUT",10616:"ACTIVECHATPHRASE_SETDYNAMICINT",10617:"ACTIVECHATPHRASE_SETDYNAMICOBJ",10618:"IF_SETONCLICKREPEAT",
10619:"SHADER_PRELOAD_THROTTLE",10620:"CC_LIST_SETDROPDOWNNUMENTRIES",10621:"IF_GETGRAPHICDIMENSIONS",10622:"MIN_LONG",10623:"DATE_ISLEAPYEAR",10624:"CC_ANIM_PLAY",10625:"CC_ANIM_KILL",10626:"CLAN_GETCHATUSERRANK",10627:"CLAN_ISSELF",
10628:"CC_GETSCROLLY",10629:"CC_SETLINKPLAYERGROUP",10630:"CC_SETLINKACTIVECLANCHANNEL",10631:"CC_SETLINKFRIEND",10632:"CC_RESETLINKPLAYER",10633:"TTV_STREAM_GETQUALITY",10634:"APPEND_CHAR",10635:"CHAR_ISPRINTABLE",10636:"ACHIEVEMENT_SPRITE",
10637:"CAM2_GETLOOKATMODE",10638:"IF_GETCHARINDEXATPOS",10639:"MAP_QUICKCHAT",10640:"CC_CRMVIEW_SETONUPDATED",10641:"CC_CRMVIEW_SETAVAILABLEFONTS",10642:"CC_CRMVIEW_INIT",10643:"ACHIEVEMENT_GETPROGRESS",10644:"UNKNOWN_COMMAND_727",
10645:"IF_GRID_GETCELLHEIGHT",10646:"IF_GETCHILDSPACING",10647:"IF_GRID_GETNUMCOLUMNS",10648:"IF_GRID_GETNUMROWS",10649:"UNKNOWN_COMMAND_732",10650:"NOTIFICATIONS_SENDGROUPEDLOCAL",10651:"TTV_LIVESTREAMS_GETSTREAM_NEXT",
10652:"TTV_LIVESTREAMS_GETSTREAM_START",10653:"SHOP_GETPRODUCTDETAILS",10654:"SHOP_GETPRODUCTCOUNT",10655:"SHOP_GETINDEXFORCATEGORYID",10656:"CAM2_SETSPRINGPROPERTIES",10657:"AUTOSETUP_DOSETUPSTATUS",10658:"CC_GRID_GETNUMCOLUMNS",
10659:"CC_GRID_GETNUMROWS",10660:"USERDETAIL_LOBBY_MEMBERSHIP",10661:"BATTERY_ISCHARGING",10662:"BATTERY_GETLEVELPERCENT",10663:"UNKNOWN_COMMAND_477",10664:"CHATPHRASE_GETDYNAMICCOMMAND",10665:"UNKNOWN_COMMAND_725",10666:"ACHIEVEMENT_GETDESC",
10667:"GET_MOUSEBUTTONS",10668:"FULLSCREEN_ENTER",10669:"FULLSCREEN_MODECOUNT",10670:"SETDEFAULTWINDOWMODE",10671:"SETWINDOWMODE",10672:"CC_COMBO_SELECT",10673:"CC_COMBO_ADDENTRY",10674:"CC_COMBO_SETENTRIES",10675:"CC_LIST_SETISSELECTED",
10676:"CC_LIST_SETENTRIES",10677:"WORLDMAP_GETDISPLAYPOSITION",10678:"UNKNOWN_COMMAND_180",10679:"WORLDMAP_GETDISPLAYCOORD",10680:"ADDPERCENT",10681:"ARRAY_SORT",10682:"ACTIVECLANSETTINGS_GETAFFINEDDISPLAYNAME",
10683:"ACTIVECLANSETTINGS_GETCURRENTOWNER_SLOT",10684:"ACTIVECLANCHANNEL_GETRANKTALK",10685:"ACTIVECLANSETTINGS_GETAFFINEDEXTRAINFO",10686:"TOSTRING_LONG",10687:"MODULO_LONG",10688:"ACTIVECLANCHANNEL_GETCLANNAME",10689:"CC_SETTARGETVERB",
10690:"USERDETAIL_LOBBY_UNREADMESSAGES",10691:"ACTIVECHATPHRASE_SEND",10692:"ACTIVECHATPHRASE_PREPARE",10693:"ACTIVECLANCHANNEL_KICKUSER",10694:"CHAT_GETHISTORY_BYUID",10695:"UNKNOWN_COMMAND_127",10696:"ACHIEVEMENT_GETGRACEDCOUNT",
10697:"IF_SETDRAGRENDERBEHAVIOUR",10698:"GETDEFAULTWINDOWMODE",10699:"CHAT_GETNEXTUID",10700:"IGNORE_GETNOTES",10701:"FRIEND_GETNOTES",10702:"IF_NPC_SETCUSTOMBODYMODEL",10703:"USERDETAIL_LOBBY_EMAILSTATUS",10704:"PARALINE",
10705:"CAM2_SETLOOKATORIENTATION_XROTATION",10706:"CAM2_SETLOOKATORIENTATION_YROTATION",10707:"CAM2_SETLOOKATORIENTATION_ZMOVEMENT",10708:"CAM2_SETLOOKATORIENTATION_XMOVEMENT",10709:"DB_FIND_REFINE",10710:"LOBBY_ENTERLOBBY",10711:"INTERPOLATE",
10712:"PRELOAD_PERCENT",10713:"CC_GETSCROLLHEIGHT",10714:"CC_TEXT_SETTRANS",10715:"TTV_STREAM_STOP",10716:"QUEST_GETMEMBERS",10717:"CAM_DEC_X",10718:"CAM_INC_X",10719:"CAM_INC_Y",10720:"CAM_DEC_Y",10721:"TTV_STREAM_SETTITLE",10722:"TTV_STREAM_START",
10723:"CC_SETONSTATTRANSMIT",10724:"IF_SETHFLIP",10725:"SHOP_ISPRODUCTAVAILABLE",10726:"INVOTHER_GETNUM",10727:"QUEST_POINTS",10728:"ACHIEVEMENT_GETSUBCATCOUNT",10729:"FRIEND_COUNT",10730:"CC_SETALPHA",10731:"IF_SETPLAYERHEAD_SELF",
10732:"LOGIN_ACCOUNTAPPEAL",10733:"CC_SETONTARGETLEAVE",10734:"CC_SETONTARGETENTER",10735:"CLIENTOPTION_CANSET",10736:"CLIENTOPTION_CANMOD",10737:"CLIENTOPTION_EXISTS",10738:"IF_GRID_GETLAYOUTPARAMS",10739:"ACTIVECLANCHANNEL_GETUSERDISPLAYNAME",
10740:"ACTIVECLANCHANNEL_GETUSERCOUNT",10741:"ACHIEVEMENT_GETMEMBERS",10742:"NOT",10743:"TTV_WEBCAM_GETCAP_BYINDEX",10744:"TTV_WEBCAM_GETCAP_BYUNIQUEID",10745:"TTV_WEBCAM_GETCAP_COUNT",10746:"DB_FIND_GET",10747:"WORLDLIST_SORT",
10748:"ACHIEVEMENT_GETCATEGORYCOUNT",10749:"CC_SETRETEX",10750:"IF_SETOBJECT_LONG",10751:"TTV_WEBCAM_GETDEVICE_BYINDEX",10752:"TTV_WEBCAM_GETDEVICE_COUNT",10753:"TTV_WEBCAM_SUPPORTED",10754:"CC_SETCLICKMASK",10755:"GET_CURRENTCURSOR",
10756:"NPC_TYPE",10757:"GET_NPC_STAT",10758:"IS_NPC_ACTIVE",10759:"IF_SETTARGETCURSORS",10760:"SOUND_SYNTH_VOLUME",10761:"BUG_REPORT",10762:"STRING_DISTANCE",10763:"TTV_WEBCAM_FLIP",10764:"OS_DRIVER_OUTDATED",10765:"IF_GETCHARPOSATINDEX",
10766:"CC_NPC_SETCUSTOMBODYMODEL",10767:"PRELOAD_DOWNLOAD_RATE",10768:"PRELOAD_DOWNLOAD_TOTALSIZE",10769:"PRELOAD_DOWNLOAD_DOWNLOADEDSIZE",10770:"PRELOAD_PROGRESS",10771:"PRELOAD_DOWNLOAD_COMPLETE",10772:"FROMDATE",10773:"PLAYER_GROUP_GET_MAX_SIZE",
10774:"VIDEO_ADVERT_PLAY",10775:"VIDEO_ADVERT_HAS_FINISHED",10776:"IGNORE_COUNT",10777:"WORLDMAP_GETSIZE",10778:"SOUND_JINGLE_VOLUME",10779:"UNKNOWN_COMMAND_174",10780:"IGNORE_GETNAME_UNFILTERED",10781:"IF_RESETMODELLIGHTING",
10782:"WORLDMAP_FLASHELEMENTCATEGORY",10783:"IF_SETTILING",10784:"STOCKMARKET_GETOFFERTYPE",10785:"LOBBY_ENTERLOBBY_SOCIAL_NETWORK",10786:"CREATE_CONNECT_REPLY",10787:"CC_UNKNOWN2",10788:"CC_SETTARGETCURSORS",10789:"CC_SETTARGETOPCURSOR",
10790:"OC_TRADEABLE",10791:"CHAT_SENDPRIVATE",10792:"WORLDLIST_AUTOWORLD",10793:"IF_BUTTON_GETTOGGLED",10794:"WORLDMAP_GETCONFIGBOUNDS",10795:"WORLDMAP_3DVIEW_GETCOORDFINE",10796:"PLAYER_GROUP_BANNED_GET_DISPLAYNAME",
10797:"PLAYER_GROUP_BANNED_COUNT",10798:"LC_PARAM",10799:"CC_SETOBJECT_LONG",10800:"CC_SETMODELORIGIN",10801:"STOCKMARKET_ISOFFERADDING",10802:"STOCKMARKET_GETOFFERCOMPLETEDGOLD",10803:"STOCKMARKET_GETOFFERCOMPLETEDCOUNT",10804:"SETOBJ",
10805:"IF_NPC_SETCUSTOMRECOL",10806:"OS_ISMAC",10807:"IF_SETONHOLD",10808:"CC_SETLINKFRIENDCHAT",10809:"PLAYER_GROUP_GET_DISPLAYNAME",10810:"CHATPHRASE_GETTEXT",10811:"OC_FINDNEXT",10812:"OC_FIND",10813:"OPPLAYER",10814:"CC_NPC_SETCUSTOMRECOL",
10815:"WORLDMAP_LISTELEMENT_NEXT",10816:"MEC_TEXT",10817:"WORLDMAP_LISTELEMENT_START",10818:"FRIEND_GETRANK",10819:"CHATPHRASE_FINDNEXT",10820:"CHATPHRASE_FIND",10821:"TEXT_GENDER",10822:"TTV_LOGIN_GETSTATE",10823:"OS_ISLINUX",10824:"OS_ISWINDOWS",
10825:"TTV_HASPREREQUISITES",10826:"TTV_LIBRARY_GETSTATE",10827:"WORLDLIST_NEXT",10828:"WORLDLIST_START",10829:"IS_TARGETED_ENTITY",10830:"NPC_FIND_ACTIVE_MINIMENU_ENTRY",10831:"GET_MINIMENU_TARGET",10832:"GET_MINIMENU_LENGTH",
10833:"GET_ACTIVE_MINIMENU_ENTRY",10834:"USERDETAIL_LOBBY_LASTLOGINDAY",10835:"ATAN2_DEG",10836:"CC_SETPLAYERHEAD_SELF",10837:"CAM2_SETLOOKATORIENTATION_VECTOR",10838:"CAM2_SETLOOKATORIENTATION_MAXDISTANCECLAMPING",10839:"COORDLEVEL_FINE",
10840:"FACING_FINE",10841:"CC_TEXT_SETCOLOUR",10842:"CC_UNKNOWN1",10843:"CC_SETONRESIZE",10844:"WORLDMAP_COORDINMAP",10845:"CLAN_KICKUSER",10846:"CC_SETOBJECT_WEARCOL",10847:"FULLSCREEN_LASTMODE",10848:"SHOP_GETCATEGORYDESCRIPTION",
10849:"CC_RADIOGROUP_ADDOPTION",10850:"ACTIVECLANSETTINGS_GETBANNEDCOUNT",10851:"CC_SETLINEWID",10852:"CC_SETLINEDIRECTION",10853:"CLEARBIT_RANGE",10854:"LOGIN_LAST_TRANSFER_REPLY",10855:"USERDETAIL_LOBBY_GRACEEXPIRY",
10856:"USERDETAIL_LOBBY_CCEXPIRY",10857:"ACTIVECLANSETTINGS_GETRANKTALK",10858:"SHOP_ISPRODUCTRECOMMENDED",10859:"IF_UNKNOWN2",10860:"CONSOLE_ENABLESNOW",10861:"SETUP_MESSAGEBOX",10862:"PLAYER_GROUP_GET_OVERALL_STATUS",10863:"TTV_CHAT_SENDMESSAGE",
10864:"IF_SETLINEDIRECTION",10865:"ACHIEVEMENT_FINDPARENTS",10866:"CHAR_TOLOWERCASE",10867:"CHAR_ISALPHANUMERIC",10868:"ACTIVECLANCHANNEL_GETSORTEDUSERSLOT",10869:"CHATPHRASE_GETAUTORESPONSE",10870:"CHATPHRASE_GETDYNAMICCOMMANDPARAM_ENUM",
10871:"MEC_CATEGORY",10872:"ACTIVECLANSETTINGS_GETSORTEDAFFINEDSLOT",10873:"ACTIVECLANSETTINGS_GETAFFINEDJOINRUNEDAY",10874:"FRIEND_GETWORLDFLAGS",10875:"FRIEND_GETWORLDNAME",10876:"GET_NPC_VISLEVEL",10877:"ACTIVECHATPHRASE_SENDPRIVATE",
10878:"UNKNOWN_COMMAND_488",10879:"UNKNOWN_COMMAND_206",10880:"CC_SETRECOL",10881:"CHAT_GETPREVUID",10882:"FRIEND_IS_REFERRED",10883:"FRIEND_IS_REFERRER",10884:"CHATCAT_GETPHRASE",10885:"CHAR_ISNUMERIC",10886:"CHATCAT_GETSUBCAT",
10887:"CHAR_TOUPPERCASE",10888:"CHATCAT_GETSUBCATSHORTCUT",10889:"CHATCAT_GETPHRASECOUNT",10890:"CHATCAT_GETSUBCATCOUNT",10891:"ACHIEVEMENT_ACHIEVEMENT_REQ",10892:"ACHIEVEMENT_ACHIEVEMENT_REQ_MET",10893:"ACHIEVEMENT_QUEST_REQ",
10894:"ACHIEVEMENT_QUEST_REQ_MET",10895:"ACHIEVEMENT_QUEST_REQ_COUNT",10896:"ACHIEVEMENT_ACHIEVEMENT_PREREQ_MET",10897:"ACHIEVEMENT_ACHIEVEMENT_PREREQ",10898:"ACHIEVEMENT_ACHIEVEMENT_PREREQ_COUNT",10899:"ACHIEVEMENT_QUEST_PREREQ_MET",
10900:"ACHIEVEMENT_QUEST_PREREQ",10901:"ACHIEVEMENT_QUEST_PREREQ_COUNT",10902:"ACHIEVEMENT_VARBIT_TESTBIT_PREREQ_MET",10903:"ACHIEVEMENT_VARBIT_TESTBIT_PREREQ_DESCRIPTION",10904:"ACHIEVEMENT_VARBIT_TESTBIT_PREREQ_COUNT",
10905:"ACHIEVEMENT_VARP_TESTBIT_PREREQ_MET",10906:"ACHIEVEMENT_VARP_TESTBIT_PREREQ_DESCRIPTION",10907:"ACHIEVEMENT_VARP_TESTBIT_PREREQ_COUNT",10908:"ACHIEVEMENT_VARBIT_PREREQ_MET",10909:"ACHIEVEMENT_VARBIT_PREREQ_DESCRIPTION",
10910:"ACHIEVEMENT_VARBIT_PREREQ_COUNT",10911:"ACHIEVEMENT_VARP_PREREQ_MET",10912:"ACHIEVEMENT_VARP_PREREQ_DESCRIPTION",10913:"ACHIEVEMENT_VARP_PREREQ_COUNT",10914:"ACHIEVEMENT_STAT_PREREQ_MET",10915:"ACHIEVEMENT_STAT_PREREQ_DESCRIPTION",
10916:"ACHIEVEMENT_PREREQ_MET",10917:"ACHIEVEMENT_STAT_PREREQ_COUNT",10918:"ACHIEVEMENT_LARGEST_PREREQ",10919:"ACHIEVEMENT_GETGRACEDAY",10920:"ACHIEVEMENT_VARBIT_TESTBIT_REQ_MET",10921:"ACHIEVEMENT_VARBIT_TESTBIT_REQ_NAME",
10922:"ACHIEVEMENT_VARBIT_TESTBIT_REQ_COUNT",10923:"ACHIEVEMENT_VARP_TESTBIT_REQ_MET",10924:"ACHIEVEMENT_VARP_TESTBIT_REQ_NAME",10925:"ACHIEVEMENT_VARP_TESTBIT_REQ_COUNT",10926:"ACHIEVEMENT_VARBIT_REQ_MET",10927:"ACHIEVEMENT_VARBIT_REQ_NAME",
10928:"ACHIEVEMENT_VARBIT_REQ_COUNT",10929:"ACHIEVEMENT_VARP_REQ_MET",10930:"ACHIEVEMENT_VARP_REQ_NAME",10931:"ACHIEVEMENT_VARP_REQ_COUNT",10932:"ACHIEVEMENT_STAT_REQ_MET",10933:"ACHIEVEMENT_STAT_REQ_NAME",10934:"ACHIEVEMENT_STAT_REQ_COUNT",
10935:"CC_SETONMISCTRANSMIT",10936:"PLAYER_GROUP_MEMBER_GET_LAST_SEEN_NODE_ID",10937:"PLAYER_GROUP_MEMBER_GET_TEAM",10938:"PLAYER_GROUP_MEMBER_GET_SAME_WORLD_VAR",10939:"PLAYER_GROUP_MEMBER_IS_ONLINE",10940:"CLAN_GETCHATOWNERNAME",
10941:"CLAN_GETCHATUSERNAME_UNFILTERED",10942:"CLAN_GETCHATUSERNAME",10943:"CHATCAT_GETDESC",10944:"LOGIN_DISALLOWTRIGGER",10945:"LOGIN_DISALLOWRESULT",10946:"LOGIN_QUEUE_POSITION",10947:"VIDEO_ADVERT_ALLOW_SKIP",10948:"LOGIN_HOPTIME",
10949:"LOGIN_BAN_DURATION",10950:"LOGIN_CONTINUE",10951:"IF_SETOPTKEY",10952:"CC_CAROUSEL_ADDTEXTENTRY",10953:"CC_PAGEDLAYER_CREATEHEADER",10954:"ACHIEVEMENT_GETHIDE",10955:"ACHIEVEMENT_RUNESCORE",10956:"QUEST_TYPE",
10957:"TELEMETRY_GET_COLUMN_COUNT",10958:"TELEMETRY_IS_ROW_PINNED",10959:"TELEMETRY_GET_ROW_ID",10960:"TELEMETRY_GET_COLUMN_ID",10961:"TELEMETRY_GET_ROW_COUNT",10962:"TELEMETRY_GET_GROUP_ID",10963:"TELEMETRY_GET_GROUP_COUNT",
10964:"WORLDMAP_GETDISABLEELEMENTS",10965:"SETBIT_RANGE",10966:"WORLDMAP_3DVIEW_DISABLE",10967:"WORLDMAP_3DVIEW_ACTIVE",10968:"CAM2_SETLOOKATMAXSPEED_AXIS",10969:"CAM2_SETLOOKATACCELERATION_AXIS",10970:"CAM2_SETPOSITIONMAXSPEED_AXIS",
10971:"CAM2_SETPOSITIONACCELERATION_AXIS",10972:"CAM2_SETSNAPDISTANCES",10973:"CAM2_ENABLE",10974:"WORLDMAP_3DVIEW_ENABLE",10975:"CREATE_EMAIL_VALIDATE_REPLY",10976:"ACTIVECLANSETTINGS_GETALLOWUNAFFINED",10977:"CAM2_RESETSNAPDISTANCES"},Ny={player:{
key:0,index:Ag.varplayer},npc:{key:1,index:Ag.varnpc},client:{key:2,index:Ag.varclient},world:{key:3,index:Ag.varworld},region:{key:4,index:Ag.varregion},object:{key:5,index:Ag.varobject},clan:{key:6,index:Ag.varclan},clansettings:{key:7,
index:Ag.varclansettings},playergroup:{key:9,index:Ag.varplayergroup}},Dy={pushint:0,pushlong:54,pushstring:3,pushlocalint:33,poplocalint:34,pushlocalstring:35,poplocalstring:36,pushlocallong:10024,poplocallong:10237,popdiscardint:10004,
popdiscardlong:9104,popdiscardstring:10360,joinstring:37,gosub:40,pushvar:42,popvar:43,pushvarbit:10022,popvarbit:10023,jump:6,branch_not:7,branch_eq:8,branch_lt:9,branch_gt:10,branch_lteq:31,branch_gteq:32,branch_eq_long:10153,branch_not_long:10449,
branch_lt_long:10411,branch_gt_long:10321,branch_lteq_long:10491,branch_gteq_long:10349,switch:51,return:21,pushconst:9001,tribyte1:9002,tribyte2:9003,shorting_or:9100,shorting_and:9101,plus:4e3,minus:4001,intdiv:4003,intmul:4002,strcmp:4107,
strconcat:4101,inttostring:10064,enum_getvalue:3408,struct_getparam:4500,item_getparam:4208,quest_getparam:10262,npc_getparam:10076,cc_getparam:10049,mec_getparam:10192,dbrow_getfield:10094,dbrow_findnext:10112,cc_setparam:10098,
db_find_with_count:10100,lc_getparam:10798,enum_getstring:10047,enum_getreverseindex:10154,enum_getreversecount:10240,enum_hasoutput:10244,define_array:10569,pop_array:46,push_array:45,printmessage:3100},Ly={int:0,boolean:1,type_2:2,quest:3,
questhelp:4,cursor:5,seq:6,colour:7,loc_shape:8,component:9,idkit:10,midi:11,npc_mode:12,namedobj:13,synth:14,type_15:15,area:16,stat:17,npc_stat:18,writeinv:19,mesh:20,maparea:21,coordgrid:22,graphic:23,chatphrase:24,fontmetrics:25,enum:26,
type_27:27,jingle:28,chatcat:29,loc:30,model:31,npc:32,obj:33,player_uid:34,type_35:35,string:36,spotanim:37,npc_uid:38,inv:39,texture:40,category:41,char:42,laser:43,bas:44,type_45:45,collision_geometry:46,physics_model:47,
physics_control_modifier:48,clanhash:49,coordfine:50,cutscene:51,itemcode:53,type_54:54,mapsceneicon:55,clanforumqfc:56,vorbis:57,verify_object:58,mapelement:59,categorytype:60,social_network:61,hitmark:62,package:63,particle_effector:64,type_65:65,
particle_emitter:66,plogtype:67,unsigned_int:68,skybox:69,skydecor:70,hash64:71,inputtype:72,struct:73,dbrow:74,type_75:75,type_76:76,type_77:77,type_78:78,type_79:79,type_80:80,type_81:81,type_83:83,type_84:84,type_85:85,type_86:86,type_87:87,
type_88:88,gwc_platform:89,type_90:90,type_91:91,type_92:92,type_93:93,bug_template:94,billing_auth_flag:95,account_feature_flag:96,interface:97,toplevelinterface:98,overlayinterface:99,clientinterface:100,movespeed:101,material:102,seqgroup:103,
temp_hiscore:104,temp_hiscore_length_type:105,temp_hiscore_display_type:106,temp_hiscore_contribute_result:107,audiogroup:108,audiomixbuss:109,long:110,crm_channel:111,http_image:112,pop_up_display_behaviour:113,poll:114,type_115:115,type_116:116,
pointlight:117,player_group:118,player_group_status:119,player_group_invite_result:120,player_group_modify_result:121,player_group_join_or_create_result:122,player_group_affinity_modify_result:123,player_group_delta_type:124,client_type:125,
telemetry_interval:126,type_127:127,type_128:128,type_129:129,type_130:130,achievement:131,stylesheet:133,type_138:138,type_200:200,type_201:201,type_202:202,type_203:203,type_204:204,type_205:205,type_206:206,type_207:207,type_208:208,
var_reference:209,unknown_int:501,unknown_long:502,unknown_string:503,scriptref:504,scriptsubref:505},Oy=["int","long","string"],Py=["known","opin","opout","scriptargvar","scriptret","uuid"];function Fy(e){return Oy.indexOf(e)}function Uy(e,t){
return n=e,Py.indexOf(n)<<27|t<<9;var n}function By(e,t){return Fy(e)<<25|t}function zy(e){return Fy(Zy(e))<<25|e}function Gy(e){if(!(e>>27&7))return Zy(511&e);let t=e>>25&3;return 0==t?"int":1==t?"long":"string"}function Vy(e){
let t=Py[e>>27&7],n=e>>9&65535,r=511&e;return"uuid"==t&&(r=33554431&e,n=0),[t,Oy[e>>25&3],n,r]}function Hy(e){let[t,n,r,i]=Vy(e)
;return"known"==t?`known type ${i} ${Object.entries(Ly).find((e=>e[1]==i))?.[0]}`:"opin"==t?`opin ${r} ${Wy(r)} ${i} ${n}`:"opout"==t?`opout ${r} ${Wy(r)} ${i} ${n}`:"scriptargvar"==t?`script ${r} arg/local ${i} ${n}`:"scriptret"==t?`script ${r} return ${i} ${n}`:"uuid"==t?`uuid ${i} ${n}`:void 0
}globalThis.debugkey=Hy;const jy={int:Uy("uuid",0)|By("int",0),long:Uy("uuid",0)|By("long",0),string:Uy("uuid",0)|By("string",0)};function Wy(e){return eb[e]??`unk${e}`}function $y(e){let t=BigInt(e[0]>>>0)<<32n|BigInt(e[1]>>>0)
;return 2147483648&e[0]&&(t-=0x10000000000000000n),t}function qy(e){let t=0xffffffffffffffffn&e;return[Number(t>>32n&0xffffffffn),Number(0xffffffffn&t)]}function Xy(e){let t=Object.entries(Ly).find((t=>t[1]==e));if(!t)return`type_${e}`;let n=t[0]
;return"enum"==n&&(n="cs2enum"),n}function Yy(e){if("cs2bool"==e)return Ly.boolean;if("cs2enum"==e)return Ly.enum;if(!Object.hasOwn(Ly,e)){let t=e.match(/^type_(\d+)$/);if(!t)throw new Error("unknown subtype "+e);return+t[1]}return Ly[e]}
const Ky=[Ly.string,Ly.coordfine,Ly.unknown_string],Jy=[Ly.type_35,Ly.clanhash,Ly.clanforumqfc,Ly.hash64,Ly.long,Ly.type_115,Ly.type_116,Ly.unknown_long];function Zy(e){return Ky.includes(e)?"string":Jy.includes(e)?"long":"int"}function Qy(e){
if("int"==e)return Ly.unknown_int;if("long"==e)return Ly.unknown_long;if("string"==e)return Ly.unknown_string;throw new Error(`uknown stack type ${e}`)}const eb={...ky,...Object.fromEntries(Object.entries(Dy).map((e=>[e[1],e[0]])))}
;globalThis.knownClientScriptOpNames=eb
;const tb=[Dy.popdiscardint,Dy.popdiscardlong,Dy.popdiscardstring],nb=[Dy.poplocalint,Dy.poplocallong,Dy.poplocalstring],rb=[Dy.pushlocalint,Dy.pushlocallong,Dy.pushlocalstring],ib=[...tb,...nb,...rb],ab=[Dy.branch_not,Dy.branch_eq,Dy.branch_lt,Dy.branch_gt,Dy.branch_lteq,Dy.branch_gteq],sb=[Dy.branch_not_long,Dy.branch_eq_long,Dy.branch_lt_long,Dy.branch_gt_long,Dy.branch_lteq_long,Dy.branch_gteq_long],ob=[...ab,...sb],lb=new Map([[Dy.shorting_or,"||"],[Dy.shorting_and,"&&"],[Dy.branch_not,"!="],[Dy.branch_eq,"=="],[Dy.branch_lteq,"<="],[Dy.branch_gteq,">="],[Dy.branch_lt,"<"],[Dy.branch_gt,">"],[Dy.plus,"+"],[Dy.minus,"-"],[Dy.intdiv,"/"],[Dy.intmul,"*"]]),cb=new Set([Dy.plus,Dy.minus,Dy.intdiv,Dy.intmul]),ub=new Map([...lb].map((e=>[e[1],e[0]]))),hb=[...ob,Dy.jump],db=[Dy.cc_getparam,Dy.mec_getparam,Dy.npc_getparam,Dy.item_getparam,Dy.quest_getparam,Dy.struct_getparam],pb=[...db,Dy.pushvar,Dy.popvar,Dy.enum_getvalue,Dy.dbrow_getfield,Dy.dbrow_findnext]
;function fb(e,t=0,n=null){return{opcode:e,imm:t,imm_obj:n}}function mb(e){return{opcode:Dy.jump,imm:0,imm_obj:{type:"jumplabel",value:e}}}class gb{constructor(e){this.values=[],void 0!==e&&this.values.push(e)}applyInOut(e){
let t=e.out.values.length-e.in.values.length;if(this.values.length,e.in.values.length,t>0)for(let e=0;e<t;e++)this.values.push(null);else this.values.length=Math.max(0,this.values.length+t)}popList(e,t){this.values.length-=e.total(t)}pushOne(e){
this.values.push(e??null)}pushList(e,t){for(let n=e.total(t);n>0;n--)this.values.push(null)}push(e){this.values.push(...e.values)}pop(){if(0==this.values.length)throw new Error("tried to pop empty StackConsts");return this.values.pop()}}class _b{
constructor(e=[]){this.values=e}pushone(e){this.values.push(e)}int(){this.values.push("int")}long(){this.values.push("long")}string(){this.values.push("string")}isEmpty(){return this.values.every((e=>e instanceof bb&&e.isEmpty()))}total(e=0){let t=0
;for(let n=this.values.length-1;n>=e;n--){let e=this.values[n];e instanceof bb?t+=e.total():t++}return t}tryShift(e){let t=0,n=-1;for(let r=0;r<this.values.length;r++){let i=this.values[r];if(i instanceof bb?t+=i.total():t++,t>=e){n=r+1;break}}
return t==e&&(this.values.splice(0,n),!0)}hasSimple(e){let t=e.values.length-1;if(this.values.length<t)return!1;for(let n=0;n<=t;n++){let r=e.values[t-n];if("string"!=typeof r)return!1;let i=this.values[this.values.length-1-n]
;if("string"!=typeof i||i!=r)return!1}return!0}pop(e,t=0){if(0!=this.tryPop(e,t))throw new Error("missing pop values on stack")}tryPopReverse(e,t=0){this.values.reverse(),e.values.reverse();try{return this.tryPop(e,t)}finally{this.values.reverse(),
e.values.reverse()}}tryPopUnordered(e){for(;!e.isEmpty();){if(0==this.values.length)return!1;let t=this.values[this.values.length-1];if(t instanceof bb)if(e.lteq(t))t.sub(e),e.sub(e);else{if(!t.lteq(e))return!1;e.sub(t),t.sub(t),this.values.pop()
}else{let n=e.getSingle(t);if(n<=0)return!1;e.setSingle(t,n-1),this.values.pop()}}return!0}tryPopSingle(e){if(0==this.values.length)return!1;let t=this.values[this.values.length-1];if(t instanceof bb){let n=t.getSingle(e);if(n<=0)return!1
;t.setSingle(e,n-1),t.isEmpty()&&this.values.pop()}else{if(t!=e)return!1;this.values.pop()}return!0}tryPop(e,t=0){let n=e.values.length;for(;n>t;){let t=e.values[n-1];if(t instanceof bb){if(!this.tryPopUnordered(t.clone()))break;n--}else{
if(!this.tryPopSingle(t))break;n--}}return n-t}push(e){for(let t of e.values)t instanceof bb?this.values.push(t.clone()):this.values.push(t)}clone(){return new _b(this.values.map((e=>e instanceof bb?e.clone():e)))}toString(){let e=[],t=null
;for(let n of this.values)if("string"==typeof n)e.push(n);else{if(n==t)continue;t=n,e.push(n.toString())}return e.join(",")}toFunctionBindString(){let e=""
;for(let t of this.values)if(t instanceof bb)e+=t.toFunctionBindString();else if("int"==t)e+="i";else if("long"==t)e+="l";else{if("string"!=t)throw new Error("unsupported stack type");e+="s"}return e}toTypeScriptVarlist(e,t,n){let r="",i=new bb
;for(let a=0;a<this.values.length;a++){let s=this.values[a];if(s instanceof bb)r+=s.toTypeScriptVarlist(i,e,t,n);else if("int"==s&&a+1<this.values.length&&"vararg"==this.values[a+1])e&&(r+="vararg"+(t?": ":"")),t&&(r+="BoundFunction"),i.vararg++,
a++;else if("int"==s)e&&(r+=`int${i.int}${t?": ":""}`),t&&(r+=n?Xy(n.int[i.int]):"number"),i.int++;else if("long"==s)e&&(r+=`long${i.long}${t?": ":""}`),t&&(r+=n?Xy(n.long[i.long]):"BigInt"),i.long++;else{
if("string"!=s)throw new Error("unsupported stack type");e&&(r+=`string${i.string}${t?": ":""}`),t&&(r+=n?Xy(n.string[i.string]):"string"),i.string++}a!=this.values.length-1&&(r+=", ")}return r}toTypeScriptReturnType(e){
return 0==this.values.length?"void":1==this.values.length?this.toTypeScriptVarlist(!1,!0,e):`[${this.toTypeScriptVarlist(!1,!0,e)}]`}toJson(){return this.values.map((e=>"string"==typeof e?e:e.toJson()))}static fromJson(e){
return new _b(e.map((e=>"string"==typeof e?e:bb.fromJson(e))))}getStackdiff(){let e=new bb;for(let t of this.values)if("int"===t)e.int++;else if("string"===t)e.string++;else if("long"===t)e.long++;else if("vararg"===t)e.vararg++;else{
if(!(t instanceof bb))throw new Error("unexpected");e.add(t)}return e}toStackDiff(){let e=new bb;for(let t of this.values)t instanceof bb?e.add(t):e.setSingle(t,e.getSingle(t)+1);return e}toLooseSubtypes(){let e=[]
;for(let t of this.values)if(t instanceof bb){if(0!=t.vararg)throw new Error("vararg doesn't have a vm type");for(let n=0;n<t.int;n++)e.push(jy.int++);for(let n=0;n<t.long;n++)e.push(jy.long++);for(let n=0;n<t.string;n++)e.push(jy.string++)
}else if("int"==t)e.push(jy.int++);else if("long"==t)e.push(jy.long++);else{if("string"!=t)throw new Error("vararg doesn't have a vm type");e.push(jy.string++)}return e}}class vb{constructor(){this.int=[],this.long=[],this.string=[]}all(){
return this.int.concat(this.long,this.string)}static fromList(e){let t=new vb;for(let n of e)t[Gy(n)].push(n);return t}static fromJson(e){let t=new vb;return t.int=e.int,t.long=e.long,t.string=e.string,t}toJson(){return this}}class yb{
constructor(e,t){this.in=new _b,this.out=new _b,this.exactin=null,this.exactout=null,this.constout=null,this.initializedin=!1,this.initializedout=!1,this.initializedthrough=!1,this.in=e??new _b,this.out=t??new _b,this.initializedin=!!e,
this.initializedout=!!t,this.initializedthrough=this.initializedin&&this.initializedout}static fromExact(e,t){let n=new yb(new _b(e.map(Gy)),new _b(t.map(Gy)));return n.exactin=vb.fromList(e),n.exactout=vb.fromList(t),n}getBottomOverlap(){
let e=Math.min(this.in.values.length,this.out.values.length);for(let t=0;t<e;t++)if(this.in.values[t]!=this.out.values[t])return t;return e}totalChange(){return this.out.total()-this.in.total()}getCode(){
return`${this.out.values.join(",")}(${this.in.values.join(",")})`}toString(){return`${this.out+""||"void"}${this.initializedthrough?"":"??"}(${this.in})`}toJson(){return{in:this.in.toJson(),out:this.out.toJson(),
initializedthrough:this.initializedthrough,exactin:this.exactin?.toJson(),exactout:this.exactout?.toJson()}}static fromJson(e){let t=new yb(_b.fromJson(e.in),_b.fromJson(e.out));return t.initializedthrough=e.initializedthrough,
t.initializedin=e.initializedthrough,t.initializedout=e.initializedthrough,t.exactin=e.exactin?vb.fromJson(e.exactin):null,t.exactout=e.exactout?vb.fromJson(e.exactout):null,t}}class bb{static fromJson(e){
return e?new bb(e.int,e.long,e.string,e.vararg):null}toJson(){return{...this}}constructor(e=0,t=0,n=0,r=0){this.int=e,this.long=t,this.string=n,this.vararg=r}sub(e){return this.int-=e.int,this.long-=e.long,this.string-=e.string,this.vararg-=e.vararg,
this}add(e){return this.int+=e.int,this.long+=e.long,this.string+=e.string,this.vararg+=e.vararg,this}min(e){this.int=Math.min(e.int,this.int),this.long=Math.min(e.long,this.long),this.string=Math.min(e.string,this.string),
this.vararg=Math.min(e.vararg,this.vararg)}max(e){this.int=Math.max(e.int,this.int),this.long=Math.max(e.long,this.long),this.string=Math.max(e.string,this.string),this.vararg=Math.max(e.vararg,this.vararg)}mult(e){return this.int*=e,this.long*=e,
this.string*=e,this.vararg*=e,this}intdiv(e){if(this.int%e!=0||this.long%e!=0||this.string%e!=0||this.vararg%e!=0)throw new Error("attempted stackdiv division leading to remainder");return this.int/=e,this.long/=e,this.string/=e,this.vararg/=e,this}
lteq(e){return this.int<=e.int&&this.long<=e.long&&this.string<=e.string&&this.vararg<=e.vararg}equals(e){return this.int==e.int&&this.long==e.long&&this.string==e.string&&this.vararg==e.vararg}isEmpty(){
return 0==this.int&&0==this.long&&0==this.string&&0==this.vararg}isNonNegative(){return this.int>=0&&this.long>=0&&this.string>=0&&this.vararg>=0}toString(){return`(${this.int},${this.long},${this.string},${this.vararg})`}total(){
return this.int+this.long+this.string+this.vararg}clone(){return(new bb).add(this)}isMonoType(){
return 0!=this.vararg?"multi":0!=this.int&&0==this.long&&0==this.string?"int":0==this.int&&0!=this.long&&0==this.string?"long":0==this.int&&0==this.long&&0!=this.string?"string":"multi"}getSingle(e){if("int"==e)return this.int
;if("long"==e)return this.long;if("string"==e)return this.string;if("vararg"==e)return this.vararg;throw new Error("unknown stack type")}setSingle(e,t){if("int"==e)this.int=t;else if("long"==e)this.long=t;else if("string"==e)this.string=t;else{
if("vararg"!=e)throw new Error("unknown stack type");this.vararg=t}}getArglist(){let e=new _b;return+!!this.int+ +!!this.string+ +!!this.long+ +!!this.vararg>1?e.values.push(this.clone()):(e.values.push(...Array(this.int).fill("int")),
e.values.push(...Array(this.string).fill("string")),e.values.push(...Array(this.long).fill("long")),e.values.push(...Array(this.vararg).fill("vararg"))),e}toFunctionBindString(){let e="";if(e+="i".repeat(this.int),e+="l".repeat(this.long),
e+="s".repeat(this.string),0!=this.vararg)throw new Error("vararg not supported");return e}toTypeScriptVarlist(e,t,n,r){let i="";for(let a=0;a<this.int;a++)t&&(i+=`int${e.int}${n?": ":""}`),n&&(i+=r?Xy(r.int[e.int]):"number"),i+=", ",e.int++
;for(let a=0;a<this.long;a++)t&&(i+=`long${e.long}${n?": ":""}`),n&&(i+=r?Xy(r.long[e.long]):"BigInt"),i+=", ",e.long++;for(let a=0;a<this.string;a++)t&&(i+=`string${e.string}${n?": ":""}`),n&&(i+=r?Xy(r.string[e.string]):"string"),i+=", ",e.string++
;for(let r=0;r<this.vararg;r++)t&&(i+=`vararg${e.vararg}${n?": ":""}`),n&&(i+="BoundFunction"),i+=", ",e.vararg++;return i=i.replace(/, $/,""),i}}
const xb=new Map([[1969878989,"emotes,40"],[2992884335,"hitsplat"],[2675166940,"emotes_locked,20"],[4136226178,"hint_headicons"],[880917333,"hint_mapmarkers"],[385880929,"hint_mapedge"],[2129339088,"magicon,0"],[2129339089,"magicon,1"],[2129339090,"magicon,2"],[2129339091,"magicon,3"],[2129339092,"magicon,4"],[2129339093,"magicon,5"],[2129339094,"magicon,6"],[2129339095,"magicon,7"],[2129339096,"magicon,8"],[2129339097,"magicon,9"],[1585002367,"magicon,10"],[1585002368,"magicon,11"],[1585002369,"magicon,12"],[1585002370,"magicon,13"],[1585002371,"magicon,14"],[1585002372,"magicon,15"],[1585002373,"magicon,16"],[1585002374,"magicon,17"],[1585002375,"magicon,18"],[1585002376,"magicon,19"],[1585002398,"magicon,20"],[1585002399,"magicon,21"],[1585002400,"magicon,22"],[1585002401,"magicon,23"],[1585002402,"magicon,24"],[1585002403,"magicon,25"],[1585002404,"magicon,26"],[1585002405,"magicon,27"],[1585002406,"magicon,28"],[1585002407,"magicon,29"],[1585002429,"magicon,30"],[1585002430,"magicon,31"],[1585002431,"magicon,32"],[1585002432,"magicon,33"],[1585002433,"magicon,34"],[1585002434,"magicon,35"],[1585002435,"magicon,36"],[1585002436,"magicon,37"],[1585002437,"magicon,38"],[1585002438,"magicon,39"],[1585002460,"magicon,40"],[1585002461,"magicon,41"],[1585002462,"magicon,42"],[1585002463,"magicon,43"],[1585002464,"magicon,44"],[1585002465,"magicon,45"],[1585002466,"magicon,46"],[1585002467,"magicon,47"],[1585002468,"magicon,48"],[1585002469,"magicon,49"],[950484242,"compass"],[2431330107,"miscgraphics,0"],[2431330108,"miscgraphics,1"],[2431330109,"miscgraphics,2"],[2431330110,"miscgraphics,3"],[2431330111,"miscgraphics,4"],[2431330112,"miscgraphics,5"],[2431330113,"miscgraphics,6"],[2431330114,"miscgraphics,7"],[2431330115,"miscgraphics,8"],[2431330116,"miscgraphics,9"],[2356789364,"miscgraphics,10"],[2356789365,"miscgraphics,11"],[2356789366,"miscgraphics,12"],[2356789367,"miscgraphics,13"],[2356789368,"miscgraphics,14"],[900197706,"staticons,0"],[900197707,"staticons,1"],[900197708,"staticons,2"],[900197709,"staticons,3"],[900197710,"staticons,4"],[900197711,"staticons,5"],[900197712,"staticons,6"],[900197713,"staticons,7"],[900197714,"staticons,8"],[900197715,"staticons,9"],[2136325189,"staticons,10"],[2136325190,"staticons,11"],[2136325191,"staticons,12"],[2136325192,"staticons,13"],[2136325193,"staticons,14"],[2136325194,"staticons,15"],[2136325195,"staticons,16"],[2136325196,"staticons,17"],[2136330800,"staticons2,0"],[2136330801,"staticons2,1"],[2136330802,"staticons2,2"],[2136330804,"staticons2,4"],[2136330805,"staticons2,5"],[2136330806,"staticons2,6"],[2136330807,"staticons2,7"],[500433066,"combaticons,0"],[500433067,"combaticons,1"],[500433068,"combaticons,2"],[500433069,"combaticons,3"],[500433070,"combaticons,4"],[500433071,"combaticons,5"],[500433072,"combaticons,6"],[500433073,"combaticons,7"],[500433074,"combaticons,8"],[500433075,"combaticons,9"],[2628523237,"combaticons,10"],[2628523238,"combaticons,11"],[2628523239,"combaticons,12"],[2628523240,"combaticons,13"],[2628523241,"combaticons,14"],[2628523242,"combaticons,15"],[2628523243,"combaticons,16"],[2628523244,"combaticons,17"],[2628523245,"combaticons,18"],[2628523246,"combaticons,19"],[2628528848,"combaticons2,0"],[2628528849,"combaticons2,1"],[2628528850,"combaticons2,2"],[2628528851,"combaticons2,3"],[2628528852,"combaticons2,4"],[2628528853,"combaticons2,5"],[2628528854,"combaticons2,6"],[2628528855,"combaticons2,7"],[2628528856,"combaticons2,8"],[2628528857,"combaticons2,9"],[4174983039,"combaticons2,10"],[4174983040,"combaticons2,11"],[4174983041,"combaticons2,12"],[4174983042,"combaticons2,13"],[4174983043,"combaticons2,14"],[4174983044,"combaticons2,15"],[4174983045,"combaticons2,16"],[4174983046,"combaticons2,17"],[4174983047,"combaticons2,18"],[4174983048,"combaticons2,19"],[3229435273,"combatboxes,0"],[3229435274,"combatboxes,1"],[3229435275,"combatboxes,2"],[3229435276,"combatboxes,3"],[738888631,"tradebacking"],[2986902419,"hitmarks"],[94935104,"cross"],[837204902,"mapdots"],[2371042572,"sworddecor,0"],[2371042573,"sworddecor,1"],[2371042574,"sworddecor,2"],[2371042575,"sworddecor,3"],[2368304475,"friendslist_font"],[1708131472,"tutorial_font"],[1743765602,"leftarrow"],[2909119341,"rightarrow"],[1585007978,"magicon2,0"],[1585007979,"magicon2,1"],[1585007980,"magicon2,2"],[1585007981,"magicon2,3"],[1585007982,"magicon2,4"],[1585007983,"magicon2,5"],[1585007984,"magicon2,6"],[1585007985,"magicon2,7"],[1585007986,"magicon2,8"],[1585007987,"magicon2,9"],[1890607141,"magicon2,10"],[1890607142,"magicon2,11"],[1890607143,"magicon2,12"],[1890607144,"magicon2,13"],[1890607145,"magicon2,14"],[1890607146,"magicon2,15"],[1890607147,"magicon2,16"],[1890607148,"magicon2,17"],[1890607149,"magicon2,18"],[1890607150,"magicon2,19"],[1890607172,"magicon2,20"],[1890607173,"magicon2,21"],[1890607174,"magicon2,22"],[1890607175,"magicon2,23"],[1890607176,"magicon2,24"],[1890607177,"magicon2,25"],[1890607178,"magicon2,26"],[1890607179,"magicon2,27"],[1890607180,"magicon2,28"],[1890607181,"magicon2,29"],[1890607203,"magicon2,30"],[1890607204,"magicon2,31"],[1890607205,"magicon2,32"],[1890607206,"magicon2,33"],[1890607207,"magicon2,34"],[1890607208,"magicon2,35"],[1890607209,"magicon2,36"],[1890607210,"magicon2,37"],[1890607211,"magicon2,38"],[1890607212,"magicon2,39"],[4110410652,"v2_stone_close_button,2"],[4110410653,"v2_stone_close_button,3"],[4110410654,"v2_stone_close_button,4"],[4110410655,"v2_stone_close_button,5"],[1014749829,"gnomeball_buttons,0"],[1014749830,"gnomeball_buttons,1"],[1014749831,"gnomeball_buttons,2"],[94839810,"coins"],[755433248,"headicons_pk"],[1170407052,"headicons_prayer"],[3639182885,"overlay_multiway"],[285466503,"overlay_duel"],[2658904862,"tex_brown"],[2876521593,"tex_red"],[3506388,"roof"],[1222630137,"leafytree"],[114464611,"railings"],[561438836,"fountain"],[4290304097,"cargonet"],[25205919,"elfroof2"],[3318248980,"welcome_font_small"],[2633212403,"elfroof"],[3311443016,"welcome_font_large"],[2898583284,"bamboo"],[1182935334,"willowtex3"],[1614826739,"mapletree"],[109757537,"stars"],[1318818808,"chainmail"],[2429813794,"lava_animated"],[1609617336,"red_green_arrows,0"],[2429794466,"hitbar_default"],[3952954078,"p11_full"],[3981583229,"p12_full"],[1057075019,"b12_full"],[3197789671,"q8_full"],[3327403,"logo"],[4124313204,"otherlevel"],[1890607240,"magicon2,46"],[1890607241,"magicon2,47"],[953669988,"mapdots_interface,0"],[953669989,"mapdots_interface,1"],[953669990,"mapdots_interface,2"],[953669991,"mapdots_interface,3"],[953669992,"mapdots_interface,4"],[2273419006,"cross_interface,0"],[2273419007,"cross_interface,1"],[2273419008,"cross_interface,2"],[2273419009,"cross_interface,3"],[2273419010,"cross_interface,4"],[2273419011,"cross_interface,5"],[2273419012,"cross_interface,6"],[2273419013,"cross_interface,7"],[2031924702,"headicons_pk_interface,0"],[2031924703,"headicons_pk_interface,1"],[2031924704,"headicons_pk_interface,2"],[2031924705,"headicons_pk_interface,3"],[2031924706,"headicons_pk_interface,4"],[2031924707,"headicons_pk_interface,5"],[2849529566,"hloading2"],[1867160429,"old_tiles"],[1609617337,"red_green_arrows,1"],[1328851774,"close_buttons,0"],[1328851775,"close_buttons,1"],[1328851776,"close_buttons,2"],[1328851777,"close_buttons,3"],[1328851778,"close_buttons,4"],[1328851779,"close_buttons,5"],[1328851780,"close_buttons,6"],[1328851781,"close_buttons,7"],[3008784350,"lunar_magic_on,0"],[3008784351,"lunar_magic_on,1"],[3008784352,"lunar_magic_on,2"],[3008784353,"lunar_magic_on,3"],[3008784354,"lunar_magic_on,4"],[3008784355,"lunar_magic_on,5"],[3008784356,"lunar_magic_on,6"],[3008784357,"lunar_magic_on,7"],[3008784358,"lunar_magic_on,8"],[3008784359,"lunar_magic_on,9"],[3078001713,"lunar_magic_on,10"],[3078001714,"lunar_magic_on,11"],[3078001715,"lunar_magic_on,12"],[3078001716,"lunar_magic_on,13"],[3078001717,"lunar_magic_on,14"],[3078001718,"lunar_magic_on,15"],[3078001719,"lunar_magic_on,16"],[3078001720,"lunar_magic_on,17"],[3078001721,"lunar_magic_on,18"],[3078001722,"lunar_magic_on,19"],[3078001744,"lunar_magic_on,20"],[3078001745,"lunar_magic_on,21"],[3078001746,"lunar_magic_on,22"],[3078001747,"lunar_magic_on,23"],[3078001748,"lunar_magic_on,24"],[3078001749,"lunar_magic_on,25"],[3078001750,"lunar_magic_on,26"],[3078001751,"lunar_magic_on,27"],[3078001752,"lunar_magic_on,28"],[3078001753,"lunar_magic_on,29"],[3078001775,"lunar_magic_on,30"],[3078001776,"lunar_magic_on,31"],[3078001777,"lunar_magic_on,32"],[3078001778,"lunar_magic_on,33"],[3078001779,"lunar_magic_on,34"],[3078001780,"lunar_magic_on,35"],[3078001781,"lunar_magic_on,36"],[3078001782,"lunar_magic_on,37"],[3078001783,"lunar_magic_on,38"],[3078001784,"lunar_magic_on,39"],[3078001806,"lunar_magic_on,40"],[1044900049,"tutorial_font_big"],[2196753399,"menu_font_small"],[2891766129,"old_tiles_lighter"],[1787935731,"quill_oblique_large"],[3929683415,"quill_caps_large"],[1157777820,"lunar_alphabet"],[24702590,"lunar_alphabet_lrg"],[3485068549,"combatboxes_large,0"],[3485068550,"combatboxes_large,1"],[3265888432,"combatboxes_very_large,0"],[3265888433,"combatboxes_very_large,1"],[303737213,"options_icons,0"],[303737214,"options_icons,1"],[303737215,"options_icons,2"],[303737216,"options_icons,3"],[303737217,"options_icons,4"],[303737218,"options_icons,5"],[303737219,"options_icons,6"],[303737220,"options_icons,7"],[303737221,"options_icons,8"],[303737222,"options_icons,9"],[825919090,"options_icons,10"],[825919091,"options_icons,11"],[825919092,"options_icons,12"],[825919093,"options_icons,13"],[825919094,"options_icons,14"],[825919095,"options_icons,15"],[825919096,"options_icons,16"],[825919097,"options_icons,17"],[1956141536,"options_radio_buttons,0"],[1956141537,"options_radio_buttons,1"],[1956141538,"options_radio_buttons,2"],[1171923135,"emotes,0"],[1171923136,"emotes,1"],[1171923137,"emotes,2"],[1171923138,"emotes,3"],[1171923139,"emotes,4"],[1171923140,"emotes,5"],[1171923141,"emotes,6"],[1171923142,"emotes,7"],[1171923143,"emotes,8"],[1171923144,"emotes,9"],[1969878896,"emotes,10"],[1969878897,"emotes,11"],[1969878898,"emotes,12"],[1969878899,"emotes,13"],[1969878900,"emotes,14"],[1969878901,"emotes,15"],[1969878902,"emotes,16"],[1969878903,"emotes,17"],[1969878904,"emotes,18"],[1969878905,"emotes,19"],[1969878927,"emotes,20"],[1969878928,"emotes,21"],[1969878929,"emotes,22"],[1969878930,"emotes,23"],[1969878931,"emotes,24"],[1969878932,"emotes,25"],[1969878933,"emotes,26"],[1969878934,"emotes,27"],[1969878935,"emotes,28"],[1969878936,"emotes,29"],[1969878958,"emotes,30"],[1969878959,"emotes,31"],[1969878960,"emotes,32"],[1969878961,"emotes,33"],[1969878962,"emotes,34"],[1969878963,"emotes,35"],[1969878964,"emotes,36"],[1969878965,"emotes,37"],[1969878966,"emotes,38"],[1969878967,"emotes,39"],[2025958354,"emotes_locked,0"],[2025958355,"emotes_locked,1"],[2025958356,"emotes_locked,2"],[2025958357,"emotes_locked,3"],[2025958358,"emotes_locked,4"],[2025958359,"emotes_locked,5"],[2025958360,"emotes_locked,6"],[2025958361,"emotes_locked,7"],[2025958362,"emotes_locked,8"],[2025958363,"emotes_locked,9"],[2675166909,"emotes_locked,10"],[2675166910,"emotes_locked,11"],[2675166911,"emotes_locked,12"],[2675166912,"emotes_locked,13"],[2675166913,"emotes_locked,14"],[2675166914,"emotes_locked,15"],[2675166915,"emotes_locked,16"],[2675166916,"emotes_locked,17"],[2675166917,"emotes_locked,18"],[2675166918,"emotes_locked,19"],[3762335482,"xmas_snowflake"],[2537929920,"barbassault_font"],[1185785869,"barbassault_icons,0"],[1185785870,"barbassault_icons,1"],[1185785871,"barbassault_icons,2"],[1185785872,"barbassault_icons,3"],[1185785873,"barbassault_icons,4"],[1185785874,"barbassault_icons,5"],[1185785875,"barbassault_icons,6"],[1185785876,"barbassault_icons,7"],[3805675385,"scrollbar_v2,0"],[962781051,"tzhaar_numbers"],[3386777705,"scales"],[4003908656,"feathers"],[1329954711,"topstat_icon,4"],[3805675386,"scrollbar_v2,1"],[197053880,"scrollbar_dragger_v2,0"],[197053881,"scrollbar_dragger_v2,1"],[197053882,"scrollbar_dragger_v2,2"],[197053883,"scrollbar_dragger_v2,3"],[1859825780,"scrollbar_parchment_v2,0"],[1859825781,"scrollbar_parchment_v2,1"],[3207353267,"scrollbar_parchment_dragger_v2,0"],[3207353268,"scrollbar_parchment_dragger_v2,1"],[3207353269,"scrollbar_parchment_dragger_v2,2"],[3207353270,"scrollbar_parchment_dragger_v2,3"],[4051286896,"peng_emotes,0"],[4051286897,"peng_emotes,1"],[4051286898,"peng_emotes,2"],[4051286899,"peng_emotes,3"],[4051286900,"peng_emotes,4"],[4051286901,"peng_emotes,5"],[4051286902,"peng_emotes,6"],[4051286903,"peng_emotes,7"],[1890607242,"magicon2,48"],[1890607243,"magicon2,49"],[1851754626,"surok_font"],[4110410650,"v2_stone_close_button,0"],[4110410651,"v2_stone_close_button,1"],[1083716754,"achievement_diary_icons,0"],[1083716755,"achievement_diary_icons,1"],[2387264634,"dream_monster_icon"],[2826396546,"ii_impling_icons,0"],[2826396547,"ii_impling_icons,1"],[2826396548,"ii_impling_icons,2"],[2826396549,"ii_impling_icons,3"],[2826396550,"ii_impling_icons,4"],[2826396551,"ii_impling_icons,5"],[2826396552,"ii_impling_icons,6"],[2826396553,"ii_impling_icons,7"],[2826396554,"ii_impling_icons,8"],[2826396555,"ii_impling_icons,9"],[1718947085,"ii_impling_icons,10"],[1718947086,"ii_impling_icons,11"],[1440119963,"ame_confirm_button,0"],[1440119964,"ame_confirm_button,1"],[2340648885,"bronze_border,0"],[825919098,"options_icons,18"],[1883892063,"exclamation_mark"],[2111304827,"warning_icons,0"],[2111304828,"warning_icons,1"],[2111304829,"warning_icons,2"],[2340648886,"bronze_border,1"],[2340648887,"bronze_border,2"],[2340648888,"bronze_border,3"],[2340648889,"bronze_border,4"],[452534144,"clan_chat_icons,0"],[452534145,"clan_chat_icons,1"],[452534146,"clan_chat_icons,2"],[452534147,"clan_chat_icons,3"],[452534148,"clan_chat_icons,4"],[452534149,"clan_chat_icons,5"],[452534150,"clan_chat_icons,6"],[452534151,"clan_chat_icons,7"],[452534152,"clan_chat_icons,8"],[422652266,"small_button"],[3588912159,"small_button_highlight"],[2926252559,"small_button_blue"],[736457293,"small_button_pressed"],[1890532674,"small_button_pressed_highlight"],[1694458038,"large_button"],[2391080043,"large_button_highlight"],[4153032334,"tradebacking_light"],[452534153,"clan_chat_icons,9"],[2013525114,"assist_overlay"],[3111128288,"staticons2_off,0"],[3111128289,"staticons2_off,1"],[3111128290,"staticons2_off,2"],[3111128292,"staticons2_off,4"],[3111128293,"staticons2_off,5"],[3111128294,"staticons2_off,6"],[3111128295,"staticons2_off,7"],[1246117048,"map_image"],[1400783165,"compass_ring"],[179009331,"map_ring"],[585464193,"radio_buttons,0"],[585464194,"radio_buttons,1"],[465118053,"bank_slot,0"],[465118054,"bank_slot,1"],[465118055,"bank_slot,2"],[465118056,"bank_slot,3"],[141184642,"bank_buttons,0"],[141184643,"bank_buttons,1"],[141184644,"bank_buttons,2"],[141184645,"bank_buttons,3"],[141184646,"bank_buttons,4"],[141184647,"bank_buttons,5"],[141184648,"bank_buttons,6"],[141184649,"bank_buttons,7"],[141184650,"bank_buttons,8"],[3347949,"mesh"],[67965397,"lore_icons,0"],[67965398,"lore_icons,1"],[67965399,"lore_icons,2"],[67965400,"lore_icons,3"],[67965401,"lore_icons,4"],[67965402,"lore_icons,5"],[67965403,"lore_icons,6"],[2031924708,"headicons_pk_interface,6"],[2031924709,"headicons_pk_interface,7"],[1329954707,"topstat_icon,0"],[1329954708,"topstat_icon,1"],[1329954709,"topstat_icon,2"],[1329954710,"topstat_icon,3"],[1969878995,"emotes,46"],[837261e3,"mapflag"],[3547865543,"floorshadows"],[141184651,"bank_buttons,9"],[81756685,"bank_buttons,10"],[81756686,"bank_buttons,11"],[81756687,"bank_buttons,12"],[81756688,"bank_buttons,13"],[81756689,"bank_buttons,14"],[81756690,"bank_buttons,15"],[81756691,"bank_buttons,16"],[81756692,"bank_buttons,17"],[1969878990,"emotes,41"],[2675166941,"emotes_locked,21"],[483200229,"bank_tabs,0"],[483200230,"bank_tabs,1"],[483200231,"bank_tabs,2"],[483200232,"bank_tabs,3"],[483200233,"bank_tabs,4"],[3880049766,"name_icons"],[2666305510,"overlay_multiway_big"],[1890607234,"magicon2,40"],[1890607235,"magicon2,41"],[1890607236,"magicon2,42"],[1890607237,"magicon2,43"],[1890607238,"magicon2,44"],[1890607239,"magicon2,45"],[1969878991,"emotes,42"],[1969878993,"emotes,44"],[2675166942,"emotes_locked,22"],[2675166943,"emotes_locked,23"],[2675166944,"emotes_locked,24"],[1969878994,"emotes,45"],[2675166945,"emotes_locked,25"],[1083716756,"achievement_diary_icons,2"],[1083716757,"achievement_diary_icons,3"],[1083716758,"achievement_diary_icons,4"],[1083716759,"achievement_diary_icons,5"],[2436182917,"bank_bag"],[2675166946,"emotes_locked,26"],[67965404,"lore_icons,7"],[81756693,"bank_buttons,18"],[1329954712,"topstat_icon,5"],[1329954713,"topstat_icon,6"],[2547340467,"login_tick"],[3078001807,"lunar_magic_on,41"],[695589409,"cursors,0"],[695589410,"cursors,1"],[695589411,"cursors,2"],[695589412,"cursors,3"],[695589413,"cursors,4"],[695589414,"cursors,5"],[695589415,"cursors,6"],[695589416,"cursors,7"],[695589417,"cursors,8"],[695589418,"cursors,9"],[88435278,"cursors,10"],[88435279,"cursors,11"],[88435280,"cursors,12"],[88435281,"cursors,13"],[88435282,"cursors,14"],[88435283,"cursors,15"],[88435284,"cursors,16"],[88435285,"cursors,17"],[88435286,"cursors,18"],[88435287,"cursors,19"],[88435309,"cursors,20"],[88435310,"cursors,21"],[88435311,"cursors,22"],[88435312,"cursors,23"],[88435313,"cursors,24"],[88435314,"cursors,25"],[88435315,"cursors,26"],[88435316,"cursors,27"],[88435317,"cursors,28"],[88435318,"cursors,29"],[88435340,"cursors,30"],[88435341,"cursors,31"],[88435342,"cursors,32"],[88435343,"cursors,33"],[88435344,"cursors,34"],[88435345,"cursors,35"],[88435346,"cursors,36"],[88435347,"cursors,37"],[88435348,"cursors,38"],[88435349,"cursors,39"],[88435371,"cursors,40"],[88435372,"cursors,41"],[88435373,"cursors,42"],[88435374,"cursors,43"],[88435375,"cursors,44"],[88435376,"cursors,45"],[88435377,"cursors,46"],[88435378,"cursors,47"],[88435379,"cursors,48"],[88435380,"cursors,49"],[88435402,"cursors,50"],[88435403,"cursors,51"],[88435404,"cursors,52"],[88435405,"cursors,53"],[88435406,"cursors,54"],[88435407,"cursors,55"],[88435408,"cursors,56"],[88435409,"cursors,57"],[88435410,"cursors,58"],[88435411,"cursors,59"],[88435433,"cursors,60"],[88435434,"cursors,61"],[88435435,"cursors,62"],[88435436,"cursors,63"],[88435437,"cursors,64"],[88435438,"cursors,65"],[88435439,"cursors,66"],[88435440,"cursors,67"],[88435441,"cursors,68"],[88435442,"cursors,69"],[88435464,"cursors,70"],[88435465,"cursors,71"],[88435466,"cursors,72"],[88435467,"cursors,73"],[88435468,"cursors,74"],[88435469,"cursors,75"],[88435470,"cursors,76"],[88435471,"cursors,77"],[88435472,"cursors,78"],[88435473,"cursors,79"],[88435495,"cursors,80"],[88435496,"cursors,81"],[88435497,"cursors,82"],[88435498,"cursors,83"],[88435499,"cursors,84"],[88435500,"cursors,85"],[88435501,"cursors,86"],[88435502,"cursors,87"],[88435503,"cursors,88"],[88435504,"cursors,89"],[88435526,"cursors,90"],[88435527,"cursors,91"],[88435528,"cursors,92"],[88435529,"cursors,93"],[88435530,"cursors,94"],[88435531,"cursors,95"],[88435532,"cursors,96"],[88435533,"cursors,97"],[88435534,"cursors,98"],[88435535,"cursors,99"],[2741493666,"cursors,100"],[2741493667,"cursors,101"],[2741493668,"cursors,102"],[2741493669,"cursors,103"],[2741493670,"cursors,104"],[2741493671,"cursors,105"],[2741493672,"cursors,106"],[2741493673,"cursors,107"],[2741493674,"cursors,108"],[2741493675,"cursors,109"],[2741493697,"cursors,110"],[2741493698,"cursors,111"],[2741493699,"cursors,112"],[2741493700,"cursors,113"],[2741493701,"cursors,114"],[2741493702,"cursors,115"],[2741493703,"cursors,116"],[2741493704,"cursors,117"],[2741493705,"cursors,118"],[2741493706,"cursors,119"],[2741493728,"cursors,120"],[2741493729,"cursors,121"],[2741493730,"cursors,122"],[2741493731,"cursors,123"],[2741493732,"cursors,124"],[2741493733,"cursors,125"],[90507597,"gravestone_background"],[1764850592,"friends_changed_name"],[1969878996,"emotes,47"],[2675166947,"emotes_locked,27"],[3656616378,"quest_icon,0"],[3656616379,"quest_icon,1"],[3656616380,"quest_icon,2"],[3656616381,"quest_icon,3"],[3656616382,"quest_icon,4"],[3656616383,"quest_icon,5"],[3656616384,"quest_icon,6"],[3656616385,"quest_icon,7"],[3656616386,"quest_icon,8"],[3656616387,"quest_icon,9"],[1685958101,"quest_icon,10"],[1685958102,"quest_icon,11"],[1685958103,"quest_icon,12"],[1685958104,"quest_icon,13"],[1685958105,"quest_icon,14"],[1685958106,"quest_icon,15"],[1685958107,"quest_icon,16"],[1685958108,"quest_icon,17"],[1685958109,"quest_icon,18"],[1685958110,"quest_icon,19"],[1685958132,"quest_icon,20"],[1685958133,"quest_icon,21"],[1685958134,"quest_icon,22"],[1685958135,"quest_icon,23"],[1685958136,"quest_icon,24"],[1685958137,"quest_icon,25"],[1969878997,"emotes,48"],[2675166948,"emotes_locked,28"],[1718947087,"ii_impling_icons,12"],[1718947088,"ii_impling_icons,13"],[1718947089,"ii_impling_icons,14"],[3378698595,"loadingwheel,0"],[3378698596,"loadingwheel,1"],[3378698597,"loadingwheel,2"],[3378698598,"loadingwheel,3"],[3378698599,"loadingwheel,4"],[3378698600,"loadingwheel,5"],[3378698601,"loadingwheel,6"],[3378698602,"loadingwheel,7"],[3378698603,"loadingwheel,8"],[3378698604,"loadingwheel,9"],[1660441420,"loadingwheel,10"],[1660441421,"loadingwheel,11"],[1660441422,"loadingwheel,12"],[1660441423,"loadingwheel,13"],[2046729299,"welcome_font_tiny"],[2830983928,"xp_token,2"],[2830983929,"xp_token,3"],[2830983926,"xp_token,0"],[2830983927,"xp_token,1"],[153728854,"easter_colours,0"],[153728855,"easter_colours,1"],[153728856,"easter_colours,2"],[153728857,"easter_colours,3"],[153728858,"easter_colours,4"],[153728859,"easter_colours,5"],[153728860,"easter_colours,6"],[153728861,"easter_colours,7"],[153728862,"easter_colours,8"],[153728863,"easter_colours,9"],[470627257,"easter_colours,10"],[470627258,"easter_colours,11"],[953669993,"mapdots_interface,5"],[953669994,"mapdots_interface,6"],[4153510063,"rand_map_rooms_off,0"],[4153510064,"rand_map_rooms_off,1"],[4153510065,"rand_map_rooms_off,2"],[4153510066,"rand_map_rooms_off,3"],[4153510067,"rand_map_rooms_off,4"],[4153510068,"rand_map_rooms_off,5"],[4153510069,"rand_map_rooms_off,6"],[4153510070,"rand_map_rooms_off,7"],[4153510071,"rand_map_rooms_off,8"],[4153510072,"rand_map_rooms_off,9"],[4204760448,"rand_map_rooms_off,10"],[4204760449,"rand_map_rooms_off,11"],[4204760450,"rand_map_rooms_off,12"],[4204760451,"rand_map_rooms_off,13"],[4204760452,"rand_map_rooms_off,14"],[4204760453,"rand_map_rooms_off,15"],[4204760454,"rand_map_rooms_off,16"],[4204760455,"rand_map_rooms_off,17"],[4204760456,"rand_map_rooms_off,18"],[3320578727,"rand_map_rooms_on,0"],[3320578728,"rand_map_rooms_on,1"],[3320578729,"rand_map_rooms_on,2"],[3320578730,"rand_map_rooms_on,3"],[3320578731,"rand_map_rooms_on,4"],[3320578732,"rand_map_rooms_on,5"],[3320578733,"rand_map_rooms_on,6"],[3320578734,"rand_map_rooms_on,7"],[3320578735,"rand_map_rooms_on,8"],[3320578736,"rand_map_rooms_on,9"],[4153692808,"rand_map_rooms_on,10"],[4153692809,"rand_map_rooms_on,11"],[4153692810,"rand_map_rooms_on,12"],[4153692811,"rand_map_rooms_on,13"],[4153692812,"rand_map_rooms_on,14"],[4153692813,"rand_map_rooms_on,15"],[4153692814,"rand_map_rooms_on,16"],[4153692815,"rand_map_rooms_on,17"],[4153692816,"rand_map_rooms_on,18"],[164497227,"rand_map_background"],[2178727222,"rand_map_room_special,0"],[2178727223,"rand_map_room_special,1"],[2178727224,"rand_map_room_special,2"],[3383183810,"rand_death_icon,0"],[3383183811,"rand_death_icon,1"],[1416173308,"rand_journal_read,0"],[1416173309,"rand_journal_read,1"],[1416173310,"rand_journal_read,2"],[1416173311,"rand_journal_read,3"],[1416173312,"rand_journal_read,4"],[1416173313,"rand_journal_read,5"],[1416173314,"rand_journal_read,6"],[1416173315,"rand_journal_read,7"],[1416173316,"rand_journal_read,8"],[698044768,"rand_button_glow"],[949071073,"rand_checkbox,0"],[949071074,"rand_checkbox,1"],[949071075,"rand_checkbox,2"],[949071076,"rand_checkbox,3"],[1801745442,"staticons2,13"],[1955696498,"staticons2_off,13"],[1890607265,"magicon2,50"],[1890607266,"magicon2,51"],[3078001841,"lunar_magic_on,54"],[3078001842,"lunar_magic_on,55"],[3078001843,"lunar_magic_on,56"],[3078001844,"lunar_magic_on,57"],[1399804477,"conq_arrow,0"],[1399804478,"conq_arrow,1"],[3886328121,"female_hair,0"],[3886328122,"female_hair,1"],[3886328123,"female_hair,2"],[3886328124,"female_hair,3"],[3886328125,"female_hair,4"],[3886328126,"female_hair,5"],[3886328127,"female_hair,6"],[3886328128,"female_hair,7"],[3886328129,"female_hair,8"],[3886328130,"female_hair,9"],[217087542,"female_hair,10"],[217087543,"female_hair,11"],[217087544,"female_hair,12"],[217087545,"female_hair,13"],[217087546,"female_hair,14"],[217087547,"female_hair,15"],[217087548,"female_hair,16"],[217087549,"female_hair,17"],[217087550,"female_hair,18"],[217087551,"female_hair,19"],[217087573,"female_hair,20"],[217087574,"female_hair,21"],[217087575,"female_hair,22"],[217087576,"female_hair,23"],[217087577,"female_hair,24"],[217087578,"female_hair,25"],[217087579,"female_hair,26"],[217087580,"female_hair,27"],[217087581,"female_hair,28"],[217087582,"female_hair,29"],[217087604,"female_hair,30"],[217087605,"female_hair,31"],[217087606,"female_hair,32"],[217087607,"female_hair,33"],[2686410948,"female_torso,0"],[2686410949,"female_torso,1"],[2686410950,"female_torso,2"],[2686410951,"female_torso,3"],[2686410952,"female_torso,4"],[2686410953,"female_torso,5"],[2686410954,"female_torso,6"],[2686410955,"female_torso,7"],[2686410956,"female_torso,8"],[2686410957,"female_torso,9"],[1674360843,"female_torso,10"],[1674360844,"female_torso,11"],[1674360845,"female_torso,12"],[1674360846,"female_torso,13"],[1674360847,"female_torso,14"],[1674360848,"female_torso,15"],[1674360849,"female_torso,16"],[1674360850,"female_torso,17"],[1674360851,"female_torso,18"],[1674360852,"female_torso,19"],[1674360874,"female_torso,20"],[1674360875,"female_torso,21"],[1674360876,"female_torso,22"],[1674360877,"female_torso,23"],[1674360878,"female_torso,24"],[1674360879,"female_torso,25"],[1674360880,"female_torso,26"],[1674360881,"female_torso,27"],[1674360882,"female_torso,28"],[1674360883,"female_torso,29"],[1674360905,"female_torso,30"],[1674360906,"female_torso,31"],[4004480188,"female_legs,0"],[4004480189,"female_legs,1"],[4004480190,"female_legs,2"],[4004480191,"female_legs,3"],[4004480192,"female_legs,4"],[4004480193,"female_legs,5"],[4004480194,"female_legs,6"],[4004480195,"female_legs,7"],[4004480196,"female_legs,8"],[4004480197,"female_legs,9"],[3879801619,"female_legs,10"],[3879801620,"female_legs,11"],[3879801621,"female_legs,12"],[3879801622,"female_legs,13"],[3879801623,"female_legs,14"],[3879801624,"female_legs,15"],[3879801625,"female_legs,16"],[3879801626,"female_legs,17"],[3879801627,"female_legs,18"],[3879801628,"female_legs,19"],[3879801650,"female_legs,20"],[3879801651,"female_legs,21"],[3879801652,"female_legs,22"],[3879801653,"female_legs,23"],[3879801654,"female_legs,24"],[3879801655,"female_legs,25"],[3879801656,"female_legs,26"],[3879801657,"female_legs,27"],[3879801658,"female_legs,28"],[3879801659,"female_legs,29"],[3879801681,"female_legs,30"],[3879801682,"female_legs,31"],[2282715781,"male_torso,0"],[2282715782,"male_torso,1"],[2282715783,"male_torso,2"],[2282715784,"male_torso,3"],[2282715785,"male_torso,4"],[2282715786,"male_torso,5"],[2282715787,"male_torso,6"],[2282715788,"male_torso,7"],[2282715789,"male_torso,8"],[2282715790,"male_torso,9"],[2044712554,"male_torso,10"],[2044712555,"male_torso,11"],[2044712556,"male_torso,12"],[2044712557,"male_torso,13"],[2044712558,"male_torso,14"],[2044712559,"male_torso,15"],[2044712560,"male_torso,16"],[2044712561,"male_torso,17"],[2044712562,"male_torso,18"],[2044712563,"male_torso,19"],[2044712585,"male_torso,20"],[2044712586,"male_torso,21"],[2044712587,"male_torso,22"],[2044712588,"male_torso,23"],[2044712589,"male_torso,24"],[2044712590,"male_torso,25"],[2044712591,"male_torso,26"],[2044712592,"male_torso,27"],[2044712593,"male_torso,28"],[2044712594,"male_torso,29"],[2044712616,"male_torso,30"],[2044712617,"male_torso,31"],[2044712618,"male_torso,32"],[217087608,"female_hair,34"],[217087609,"female_hair,35"],[217087610,"female_hair,36"],[217087611,"female_hair,37"],[217087612,"female_hair,38"],[217087613,"female_hair,39"],[3596211032,"male_hair,0"],[3596211033,"male_hair,1"],[3596211034,"male_hair,2"],[3596211035,"male_hair,3"],[3596211036,"male_hair,4"],[3596211037,"male_hair,5"],[3596211038,"male_hair,6"],[3596211039,"male_hair,7"],[3596211040,"male_hair,8"],[3596211041,"male_hair,9"],[4108359671,"male_hair,10"],[4108359672,"male_hair,11"],[4108359673,"male_hair,12"],[4108359674,"male_hair,13"],[4108359675,"male_hair,14"],[4108359676,"male_hair,15"],[4108359677,"male_hair,16"],[3714363099,"male_legs,0"],[3714363100,"male_legs,1"],[3714363101,"male_legs,2"],[3714363102,"male_legs,3"],[3714363103,"male_legs,4"],[3714363104,"male_legs,5"],[3714363105,"male_legs,6"],[3714363106,"male_legs,7"],[3714363107,"male_legs,8"],[3714363108,"male_legs,9"],[3476106452,"male_legs,10"],[3476106453,"male_legs,11"],[3476106454,"male_legs,12"],[3476106455,"male_legs,13"],[3476106456,"male_legs,14"],[3476106457,"male_legs,15"],[3476106458,"male_legs,16"],[3476106459,"male_legs,17"],[3476106460,"male_legs,18"],[3476106461,"male_legs,19"],[3476106483,"male_legs,20"],[3476106484,"male_legs,21"],[3476106485,"male_legs,22"],[3476106486,"male_legs,23"],[3476106487,"male_legs,24"],[3476106488,"male_legs,25"],[3476106489,"male_legs,26"],[3476106490,"male_legs,27"],[3476106491,"male_legs,28"],[3476106492,"male_legs,29"],[3476106514,"male_legs,30"],[3476106515,"male_legs,31"],[1969878998,"emotes,49"],[2675166949,"emotes_locked,29"],[1585002491,"magicon,50"],[4120166957,"verdana_11pt_regular"],[1227328817,"verdana_15pt_regular"],[3963936616,"cursors_skills,0"],[3963936617,"cursors_skills,1"],[3963936619,"cursors_skills,3"],[3963936622,"cursors_skills,6"],[3963936625,"cursors_skills,9"],[2622950887,"cursors_skills,10"],[2622950888,"cursors_skills,11"],[2622950889,"cursors_skills,12"],[2622950890,"cursors_skills,13"],[2622950891,"cursors_skills,14"],[2622950894,"cursors_skills,17"],[2622950895,"cursors_skills,18"],[2622950919,"cursors_skills,21"],[2622950920,"cursors_skills,22"],[2622950921,"cursors_skills,23"],[2622950922,"cursors_skills,24"],[2622950923,"cursors_skills,25"],[2622950924,"cursors_skills,26"],[2622950925,"cursors_skills,27"],[3078001845,"lunar_magic_on,58"],[2622950927,"cursors_skills,29"],[2622950949,"cursors_skills,30"],[2622950950,"cursors_skills,31"],[2622950951,"cursors_skills,32"],[2622950952,"cursors_skills,33"],[3078001846,"lunar_magic_on,59"],[2622950954,"cursors_skills,35"],[2622950955,"cursors_skills,36"],[1969879020,"emotes,50"],[1969879021,"emotes,51"],[2675166971,"emotes_locked,30"],[3991971121,"cursors_spells,0"],[3991971122,"cursors_spells,1"],[3991971123,"cursors_spells,2"],[3991971124,"cursors_spells,3"],[3991971125,"cursors_spells,4"],[3991971126,"cursors_spells,5"],[3991971127,"cursors_spells,6"],[3991971128,"cursors_spells,7"],[3991971129,"cursors_spells,8"],[3991971130,"cursors_spells,9"],[3492020542,"cursors_spells,10"],[3492020543,"cursors_spells,11"],[3492020544,"cursors_spells,12"],[3492020545,"cursors_spells,13"],[3492020546,"cursors_spells,14"],[3492020547,"cursors_spells,15"],[3492020548,"cursors_spells,16"],[3492020549,"cursors_spells,17"],[3492020550,"cursors_spells,18"],[3492020551,"cursors_spells,19"],[3492020573,"cursors_spells,20"],[3492020574,"cursors_spells,21"],[3492020575,"cursors_spells,22"],[3492020576,"cursors_spells,23"],[3492020577,"cursors_spells,24"],[3492020578,"cursors_spells,25"],[3492020579,"cursors_spells,26"],[3492020580,"cursors_spells,27"],[3492020581,"cursors_spells,28"],[3492020582,"cursors_spells,29"],[3492020604,"cursors_spells,30"],[3492020605,"cursors_spells,31"],[3492020606,"cursors_spells,32"],[3492020607,"cursors_spells,33"],[3492020608,"cursors_spells,34"],[3492020609,"cursors_spells,35"],[3492020610,"cursors_spells,36"],[3492020611,"cursors_spells,37"],[3492020612,"cursors_spells,38"],[3492020613,"cursors_spells,39"],[3492020635,"cursors_spells,40"],[3492020636,"cursors_spells,41"],[3492020637,"cursors_spells,42"],[3492020638,"cursors_spells,43"],[3492020639,"cursors_spells,44"],[3492020640,"cursors_spells,45"],[3492020641,"cursors_spells,46"],[3492020642,"cursors_spells,47"],[3492020643,"cursors_spells,48"],[3492020644,"cursors_spells,49"],[3492020666,"cursors_spells,50"],[3492020667,"cursors_spells,51"],[3492020668,"cursors_spells,52"],[3492020669,"cursors_spells,53"],[3492020670,"cursors_spells,54"],[3492020671,"cursors_spells,55"],[3492020672,"cursors_spells,56"],[3492020673,"cursors_spells,57"],[3492020674,"cursors_spells,58"],[3492020675,"cursors_spells,59"],[3492020697,"cursors_spells,60"],[3492020698,"cursors_spells,61"],[3492020699,"cursors_spells,62"],[3492020700,"cursors_spells,63"],[3492020701,"cursors_spells,64"],[3492020702,"cursors_spells,65"],[3492020703,"cursors_spells,66"],[3492020704,"cursors_spells,67"],[3492020705,"cursors_spells,68"],[3492020706,"cursors_spells,69"],[3492020728,"cursors_spells,70"],[3492020729,"cursors_spells,71"],[3492020730,"cursors_spells,72"],[3492020731,"cursors_spells,73"],[3492020732,"cursors_spells,74"],[3492020733,"cursors_spells,75"],[3492020734,"cursors_spells,76"],[3492020735,"cursors_spells,77"],[3492020736,"cursors_spells,78"],[3492020737,"cursors_spells,79"],[3492020759,"cursors_spells,80"],[918083513,"cursors_generic,0"],[918083514,"cursors_generic,1"],[918083515,"cursors_generic,2"],[918083516,"cursors_generic,3"],[918083517,"cursors_generic,4"],[918083518,"cursors_generic,5"],[918083519,"cursors_generic,6"],[918083520,"cursors_generic,7"],[918083521,"cursors_generic,8"],[918083522,"cursors_generic,9"],[2690785206,"cursors_generic,10"],[2690785207,"cursors_generic,11"],[2690785208,"cursors_generic,12"],[2690785209,"cursors_generic,13"],[2690785210,"cursors_generic,14"],[2690785211,"cursors_generic,15"],[2690785212,"cursors_generic,16"],[2690785213,"cursors_generic,17"],[2690785214,"cursors_generic,18"],[2690785215,"cursors_generic,19"],[2690785237,"cursors_generic,20"],[2690785238,"cursors_generic,21"],[2690785239,"cursors_generic,22"],[2690785240,"cursors_generic,23"],[2690785241,"cursors_generic,24"],[2690785242,"cursors_generic,25"],[2690785243,"cursors_generic,26"],[2690785244,"cursors_generic,27"],[2690785245,"cursors_generic,28"],[2690785246,"cursors_generic,29"],[2690785268,"cursors_generic,30"],[2690785269,"cursors_generic,31"],[2690785270,"cursors_generic,32"],[2690785271,"cursors_generic,33"],[2690785272,"cursors_generic,34"],[2690785273,"cursors_generic,35"],[2690785274,"cursors_generic,36"],[2690785275,"cursors_generic,37"],[2690785276,"cursors_generic,38"],[2690785277,"cursors_generic,39"],[2690785299,"cursors_generic,40"],[2690785300,"cursors_generic,41"],[2690785301,"cursors_generic,42"],[2690785302,"cursors_generic,43"],[2690785303,"cursors_generic,44"],[2690785304,"cursors_generic,45"],[2690785305,"cursors_generic,46"],[526264239,"verdana_13pt_regular"],[3078001868,"lunar_magic_on,60"],[3078001869,"lunar_magic_on,61"],[857796910,"shields,0"],[857796911,"shields,1"],[857796912,"shields,2"],[857796913,"shields,3"],[857796914,"shields,4"],[857796915,"shields,5"],[857796916,"shields,6"],[857796917,"shields,7"],[857796918,"shields,8"],[857796919,"shields,9"],[821900513,"shields,10"],[821900514,"shields,11"],[821900515,"shields,12"],[821900516,"shields,13"],[821900517,"shields,14"],[821900518,"shields,15"],[821900519,"shields,16"],[821900520,"shields,17"],[821900521,"shields,18"],[821900522,"shields,19"],[821900544,"shields,20"],[821900545,"shields,21"],[821900546,"shields,22"],[821900547,"shields,23"],[821900548,"shields,24"],[821900549,"shields,25"],[821900550,"shields,26"],[821900551,"shields,27"],[1969879022,"emotes,52"],[2675166972,"emotes_locked,31"],[2675166973,"emotes_locked,32"],[3078001808,"lunar_magic_on,42"],[3078001809,"lunar_magic_on,43"],[3078001810,"lunar_magic_on,44"],[3078001811,"lunar_magic_on,45"],[3078001812,"lunar_magic_on,46"],[3078001813,"lunar_magic_on,47"],[3078001814,"lunar_magic_on,48"],[3078001815,"lunar_magic_on,49"],[1376903010,"roles_d"],[1376903011,"roles_e"],[1376903012,"roles_f"],[1376903013,"roles_g"],[1376903014,"roles_h"],[1376903015,"roles_i"],[1376903016,"roles_j"],[1376903017,"roles_k"],[1376903018,"roles_l"],[1376903019,"roles_m"],[1969879058,"emotes,67"],[2675167009,"emotes_locked,47"],[1969879023,"emotes,53"],[2690785306,"cursors_generic,47"],[1969879024,"emotes,54"],[1969879025,"emotes,55"],[1969879026,"emotes,56"],[1969879027,"emotes,57"],[1969879028,"emotes,58"],[1969879029,"emotes,59"],[1969879051,"emotes,60"],[1969879052,"emotes,61"],[1969879053,"emotes,62"],[1969879054,"emotes,63"],[1969879055,"emotes,64"],[1969879056,"emotes,65"],[1969879057,"emotes,66"],[2675166974,"emotes_locked,33"],[2675166975,"emotes_locked,34"],[2675166976,"emotes_locked,35"],[2675166977,"emotes_locked,36"],[2675166978,"emotes_locked,37"],[2675166979,"emotes_locked,38"],[2675166980,"emotes_locked,39"],[2675167002,"emotes_locked,40"],[2675167003,"emotes_locked,41"],[2675167004,"emotes_locked,42"],[2675167006,"emotes_locked,44"],[2675167007,"emotes_locked,45"],[2675167008,"emotes_locked,46"],[1959803992,"invback"],[3078001837,"lunar_magic_on,50"],[3078001838,"lunar_magic_on,51"],[3078001839,"lunar_magic_on,52"],[3078001840,"lunar_magic_on,53"],[1585002492,"magicon,51"],[1969879059,"emotes,68"],[1969879060,"emotes,69"],[1969879082,"emotes,70"],[1969879083,"emotes,71"],[1969879084,"emotes,72"],[1969879085,"emotes,73"],[1969879086,"emotes,74"],[1969879087,"emotes,75"],[2675167010,"emotes_locked,48"],[2675167011,"emotes_locked,49"],[2675167033,"emotes_locked,50"],[2675167034,"emotes_locked,51"],[2675167035,"emotes_locked,52"],[2675167036,"emotes_locked,53"],[2675167037,"emotes_locked,54"],[2675167038,"emotes_locked,55"],[825919099,"options_icons,19"],[860008241,"compassmask_2"],[1969879088,"emotes,76"],[1969879089,"emotes,77"],[1969879090,"emotes,78"],[1969879091,"emotes,79"],[1969879113,"emotes,80"],[1969879114,"emotes,81"],[1969879115,"emotes,82"],[1969879116,"emotes,83"],[2675167039,"emotes_locked,56"],[2675167040,"emotes_locked,57"],[2675167041,"emotes_locked,58"],[2675167042,"emotes_locked,59"],[2675167064,"emotes_locked,60"],[2675167065,"emotes_locked,61"],[2675167066,"emotes_locked,62"],[2675167067,"emotes_locked,63"],[2031924710,"headicons_pk_interface,8"],[2031924711,"headicons_pk_interface,9"],[2860123697,"headicons_pk_interface,10"],[2860123698,"headicons_pk_interface,11"],[2860123699,"headicons_pk_interface,12"],[2860123700,"headicons_pk_interface,13"],[2356789369,"miscgraphics,15"],[2356789370,"miscgraphics,16"],[2356789371,"miscgraphics,17"],[1801745443,"staticons2,14"],[1955696499,"staticons2_off,14"],[2628523268,"combaticons,20"],[2628523269,"combaticons,21"],[2628523270,"combaticons,22"],[2628523271,"combaticons,23"],[2628523272,"combaticons,24"],[2628523273,"combaticons,25"],[2628523274,"combaticons,26"],[2628523275,"combaticons,27"],[2628523276,"combaticons,28"],[2628523277,"combaticons,29"],[3485068551,"combatboxes_large,2"],[3485068552,"combatboxes_large,3"],[3265888434,"combatboxes_very_large,2"],[3265888435,"combatboxes_very_large,3"],[2356789372,"miscgraphics,18"],[2356789373,"miscgraphics,19"],[3078001870,"lunar_magic_on,62"],[3078001871,"lunar_magic_on,63"],[3078001872,"lunar_magic_on,64"],[3078001873,"lunar_magic_on,65"],[821900552,"shields,28"],[821900553,"shields,29"],[821900575,"shields,30"],[821900576,"shields,31"],[821900577,"shields,32"],[821900578,"shields,33"],[821900579,"shields,34"],[821900580,"shields,35"],[821900581,"shields,36"],[821900582,"shields,37"],[821900583,"shields,38"],[821900584,"shields,39"],[821900606,"shields,40"],[821900607,"shields,41"],[821900608,"shields,42"],[821900609,"shields,43"],[821900610,"shields,44"],[821900611,"shields,45"],[821900612,"shields,46"],[821900613,"shields,47"],[821900614,"shields,48"],[821900615,"shields,49"],[821900637,"shields,50"],[821900638,"shields,51"],[821900639,"shields,52"],[821900640,"shields,53"],[821900641,"shields,54"],[821900642,"shields,55"],[821900643,"shields,56"],[821900644,"shields,57"],[821900645,"shields,58"],[821900646,"shields,59"],[821900668,"shields,60"],[821900669,"shields,61"],[821900670,"shields,62"],[821900671,"shields,63"],[3078001874,"lunar_magic_on,66"],[1969879146,"emotes,92"],[1969879147,"emotes,93"],[825919121,"options_icons,20"],[825919122,"options_icons,21"],[1969879117,"emotes,84"],[1969879118,"emotes,85"],[1969879119,"emotes,86"],[1969879120,"emotes,87"],[2675167068,"emotes_locked,64"],[2675167069,"emotes_locked,65"],[2675167070,"emotes_locked,66"],[2675167071,"emotes_locked,67"],[1969879148,"emotes,94"],[1969879149,"emotes,95"],[2675167159,"emotes_locked,92"],[1660441424,"loadingwheel,14"],[1660441425,"loadingwheel,15"],[2818168646,"l192_49"],[2136330803,"staticons2,3"],[1801745444,"staticons2,15"],[1955696500,"staticons2_off,15"],[3963936618,"cursors_skills,2"],[3963936620,"cursors_skills,4"],[3963936621,"cursors_skills,5"],[2860123701,"headicons_pk_interface,14"],[2860123702,"headicons_pk_interface,15"],[3078001875,"lunar_magic_on,67"],[3078001876,"lunar_magic_on,68"],[3963936623,"cursors_skills,7"],[1536891843,"checkbox"],[1660441426,"loadingwheel,16"],[1583090068,"verdana_11pt_bold"],[773743442,"verdana_13pt_bold"],[3699237408,"m123_28"],[3078001877,"lunar_magic_on,69"],[3078001899,"lunar_magic_on,70"],[3492020760,"cursors_spells,81"],[3492020761,"cursors_spells,82"],[3492020762,"cursors_spells,83"],[3492020763,"cursors_spells,84"],[2860123703,"headicons_pk_interface,16"],[2860123704,"headicons_pk_interface,17"],[2860123705,"headicons_pk_interface,18"],[2860123706,"headicons_pk_interface,19"],[2690785307,"cursors_generic,48"],[3078001900,"lunar_magic_on,71"],[4108359678,"male_hair,17"],[4108359679,"male_hair,18"],[4108359680,"male_hair,19"],[4108359702,"male_hair,20"],[4108359703,"male_hair,21"],[4108359704,"male_hair,22"],[4108359705,"male_hair,23"],[4108359706,"male_hair,24"],[4108359707,"male_hair,25"],[4108359708,"male_hair,26"],[4108359709,"male_hair,27"],[4108359710,"male_hair,28"],[4108359711,"male_hair,29"],[4108359733,"male_hair,30"],[4108359734,"male_hair,31"],[3078001901,"lunar_magic_on,72"],[3078001902,"lunar_magic_on,73"],[3078001903,"lunar_magic_on,74"],[3805675387,"scrollbar_v2,2"],[3805675388,"scrollbar_v2,3"],[3805675389,"scrollbar_v2,4"],[3805675390,"scrollbar_v2,5"],[3805675391,"scrollbar_v2,6"],[3805675392,"scrollbar_v2,7"],[105001967,"nomad"],[3782377587,"zamorak"],[2622950956,"cursors_skills,37"],[1969879121,"emotes,88"],[1969879122,"emotes,89"],[1969879144,"emotes,90"],[1969879145,"emotes,91"],[2675167072,"emotes_locked,68"],[2675167073,"emotes_locked,69"],[2675167095,"emotes_locked,70"],[2675167096,"emotes_locked,71"],[2675167097,"emotes_locked,72"],[2675167098,"emotes_locked,73"],[2675167099,"emotes_locked,74"],[2675167100,"emotes_locked,75"],[2675167101,"emotes_locked,76"],[2675167102,"emotes_locked,77"],[2675167103,"emotes_locked,78"],[2675167104,"emotes_locked,79"],[2675167126,"emotes_locked,80"],[2675167127,"emotes_locked,81"],[2675167128,"emotes_locked,82"],[2675167129,"emotes_locked,83"],[2675167130,"emotes_locked,84"],[2675167131,"emotes_locked,85"],[2675167132,"emotes_locked,86"],[2675167133,"emotes_locked,87"],[2675167134,"emotes_locked,88"],[2675167135,"emotes_locked,89"],[2675167157,"emotes_locked,90"],[2675167158,"emotes_locked,91"],[2675167160,"emotes_locked,93"],[2675167161,"emotes_locked,94"],[2675167162,"emotes_locked,95"],[3532157,"skin"],[3138990,"feet"],[3441879594,"fingers"],[2690785308,"cursors_generic,49"],[2690785330,"cursors_generic,50"],[2690785331,"cursors_generic,51"],[2690785332,"cursors_generic,52"],[2690785333,"cursors_generic,53"],[1718947090,"ii_impling_icons,15"],[821900672,"shields,64"],[821900673,"shields,65"],[821900674,"shields,66"],[821900675,"shields,67"],[821900676,"shields,68"],[821900677,"shields,69"],[821900699,"shields,70"],[821900700,"shields,71"],[821900701,"shields,72"],[821900702,"shields,73"],[821900703,"shields,74"],[821900704,"shields,75"],[821900705,"shields,76"],[821900706,"shields,77"],[821900707,"shields,78"],[821900708,"shields,79"],[821900730,"shields,80"],[821900731,"shields,81"],[821900732,"shields,82"],[821900733,"shields,83"],[821900734,"shields,84"],[821900735,"shields,85"],[821900736,"shields,86"],[821900737,"shields,87"],[821900738,"shields,88"],[821900739,"shields,89"],[1969879150,"emotes,96"],[1969879151,"emotes,97"],[1969879152,"emotes,98"],[1969879153,"emotes,99"],[2675167163,"emotes_locked,96"],[2675167164,"emotes_locked,97"],[2675167165,"emotes_locked,98"],[2675167166,"emotes_locked,99"],[821900761,"shields,90"],[821900762,"shields,91"],[936703680,"emotes,100"],[936703681,"emotes,101"],[936703682,"emotes,102"],[936703683,"emotes,103"],[1325795603,"emotes_locked,100"],[1325795604,"emotes_locked,101"],[1325795605,"emotes_locked,102"],[1325795606,"emotes_locked,103"],[953669995,"mapdots_interface,7"],[953669996,"mapdots_interface,8"],[1718947091,"ii_impling_icons,16"],[821900763,"shields,92"],[821900764,"shields,93"],[821900765,"shields,94"],[821900766,"shields,95"],[104396,"k12"],[118,"v"],[2622950957,"cursors_skills,38"],[2622950958,"cursors_skills,39"],[2860123728,"headicons_pk_interface,20"],[2860123729,"headicons_pk_interface,21"],[2860123730,"headicons_pk_interface,22"],[1258058669,"huffman"],[1956833037,"[proc,quicksort]"],[345345464,"[proc,inv_total_available]"],[449115492,"[proc,worldmap_arrow_update]"],[209897848,"[clientscript,magic_deltooltip]"],[2688127745,"[clientscript,quickchat_tutorial_init]"],[3469354622,"[clientscript,magic_entertargetmode]"],[2152238399,"[clientscript,magic_leavetargetmode]"],[1268880597,"[proc,magic_runecount]"],[2487759364,"[proc,magic_tostring]"],[3839738228,"[clientscript,magictraining_shop]"],[3846245796,"[clientscript,magictraining_shop_points]"],[2666282981,"[clientscript,closebutton_click]"],[1741043411,"[clientscript,scrollbar_vertical]"],[2050974931,"[proc,scrollbar_vertical]"],[456153146,"[clientscript,scrollbar_vertical_jump]"],[450510836,"[clientscript,scrollbar_vertical_drag]"],[1615770487,"[clientscript,scrollbar_vertical_wheel]"],[4129357584,"[proc,scrollbar_vertical_doscroll]"],[2103178442,"[clientscript,deltooltip]"],[971155611,"[proc,deltooltip_action]"],[740865240,"[proc,bool_to_int]"],[1110526249,"[clientscript,trail_reward_generation]"],[1003841157,"[clientscript,graphic_swapper]"],[3237377935,"[clientscript,text_colour_swapper]"],[1910507737,"[proc,tostring_spacer]"],[3413408330,"[clientscript,prayer_varupdate]"],[309378350,"[clientscript,topstat_prayer_button_update]"],[3280976340,"[proc,toplevel_minimenu_setup]"],[3801005283,"[clientscript,prayer_statupdate]"],[2182721123,"[clientscript,wilderness_level_update]"],[682911585,"[clientscript,dream_bank_init]"],[2129584024,"[clientscript,dream_chest_init]"],[1869690317,"[proc,quicksort_enum]"],[1879461885,"[clientscript,scrollbar_vertical_graphics]"],[304324745,"[clientscript,vm_kudos_set]"],[3912481340,"[clientscript,set_spinner]"],[510688383,"[clientscript,spinner]"],[3256689188,"[clientscript,model_swapper]"],[4197695370,"[clientscript,text_swapper]"],[2705280302,"[clientscript,comp_sethide]"],[2462588638,"[clientscript,tzhaar_fightpit_foesremaining]"],[1140994645,"[proc,scrollbar_resize]"],[3381268237,"[proc,add_to_inputstring]"],[3525225400,"[clientscript,trail_puzzle_generation]"],[2613144708,"[clientscript,chatdefault_updatechatbox]"],[3973535466,"[proc,rebuildchatbox]"],[3956469840,"[clientscript,chat_op]"],[3335121156,"[clientscript,macro_pinball_score]"],[2763309555,"[clientscript,meslayer_close]"],[1613394365,"[proc,meslayer_mode1]"],[3052028892,"[clientscript,meslayer_mode2]"],[3052028923,"[clientscript,meslayer_mode3]"],[3052028954,"[clientscript,meslayer_mode4]"],[3630063234,"[clientscript,trail_puzzle_click]"],[1613394520,"[proc,meslayer_mode6]"],[3052029047,"[clientscript,meslayer_mode7]"],[3052029078,"[clientscript,meslayer_mode8]"],[3052029109,"[clientscript,meslayer_mode9]"],[2770583757,"[proc,meslayer_mode10]"],[3108574411,"[clientscript,meslayer_onkey]"],[3162289,"[clientscript,pattern_spin]"],[2075566599,"[clientscript,friend_init]"],[3932683111,"[clientscript,friend_transmit]"],[4236120302,"[proc,friend_update]"],[685963734,"[clientscript,friend_op]"],[2440977979,"[clientscript,ignore_init]"],[550403483,"[clientscript,ignore_transmit]"],[3209138210,"[proc,ignore_update]"],[3323212554,"[clientscript,ignore_op]"],[273048563,"[clientscript,snapshot_open]"],[104114097,"[proc,inzone]"],[2764466761,"[clientscript,snapshot_report]"],[812897378,"[clientscript,meslayer_ondialogabort]"],[2087073245,"[clientscript,subchanged_init]"],[1084222830,"[clientscript,subchanged]"],[125608312,"[clientscript,trade_confirm_init]"],[3204967375,"[clientscript,interface_flash_slot]"],[3192622865,"[clientscript,interface_flash_fade]"],[3547486718,"[clientscript,interface_inv_init]"],[3202579805,"[clientscript,interface_inv_init_big]"],[933940484,"[clientscript,interface_inv_update_big]"],[705264388,"[proc,interface_inv_update_big]"],[2438008882,"[proc,interface_inv_draw_slot_big]"],[3419540134,"[clientscript,interface_inv_dragcomplete_swap_big]"],[1112898470,"[clientscript,interface_inv_dragcomplete_shuffle_big]"],[4153282541,"[proc,scrollbar_ondrag_doscroll]"],[1752721326,"[clientscript,interface_invother_init]"],[2138822324,"[clientscript,interface_invother_update_big]"],[1125771444,"[proc,interface_invother_update_big]"],[1344111746,"[proc,interface_invother_draw_slot_big]"],[3143981379,"[clientscript,interface_inv_drag_slot]"],[2501495071,"[clientscript,cws_mouseover]"],[2234277979,"[clientscript,pattern_cards_select]"],[3004896417,"[clientscript,kr_mouseleave_colour]"],[1107414237,"[clientscript,kr_tumbler_height]"],[1693587891,"[clientscript,kr_display_riddle]"],[2608018646,"[clientscript,friends_chat_onload]"],[2024904380,"[clientscript,friendschat_setrank]"],[1938340776,"[clientscript,friendschat_list_op]"],[3276238774,"[clientscript,friends_chat_onclantransmit]"],[2430073087,"[clientscript,friends_chat_minimenu_timer]"],[1353093728,"[clientscript,snapshot_name_update]"],[373416259,"[clientscript,snapshot_ignore_yes]"],[3475718703,"[clientscript,snapshot_ignore_no]"],[3587879263,"[proc,snapshot_hide_help]"],[3897908419,"[clientscript,snapshot_help_close]"],[1709978003,"[clientscript,snapshot_confirm_name]"],[854619885,"[clientscript,snapshot_selected_highlight]"],[183175405,"[proc,snapshot_selected_highlight]"],[1263834887,"[clientscript,snapshot_main_exit_v1]"],[3692916363,"[clientscript,fishcomp_overlay_load]"],[4158408703,"[clientscript,fishcomp_refresh]"],[315160063,"[proc,fishcomp_refresh]"],[1617307663,"[clientscript,worldmap_key_toggle]"],[2118822521,"[clientscript,worldmap_flashelementcategory]"],[3567941095,"[clientscript,worldmap_showmenu]"],[391350247,"[proc,worldmap_showmenu]"],[3179418640,"[proc,worldmap_quicksort_menu]"],[3742872050,"[clientscript,worldmap_choosemap]"],[1330093254,"[proc,worldmap_elements_update]"],[3084225071,"[proc,worldmap_elements_chooseposition]"],[252373197,"[proc,worldmap_elements_textbox]"],[3126200251,"[clientscript,ntk_text]"],[2426279981,"[clientscript,ntk_timer]"],[1605690577,"[clientscript,worldmap_button]"],[191046555,"[clientscript,cws_setup]"],[3688488969,"[proc,playerdesign4_getoutfit]"],[1627449556,"[clientscript,xbows_pouch_num]"],[740250955,"[clientscript,conq_ranking_overlay_onload]"],[1696794404,"[clientscript,conq_ranking_overlay_ontimer]"],[216004266,"[clientscript,conq_skull_swapper]"],[2283230075,"[clientscript,conq_scroll_camera]"],[4108907626,"[clientscript,conq_fade_in]"],[2872477154,"[clientscript,conq_action_cam]"],[1826166738,"[clientscript,conq_action_cam_reset]"],[2560581346,"[proc,partnercheck]"],[3395810705,"[clientscript,snapshot_main_load]"],[613869191,"[clientscript,initialise_stat_xp]"],[3314938891,"[clientscript,assist_skill_update]"],[3991101657,"[proc,enum_var]"],[3771544558,"[clientscript,stats_stat]"],[1873674926,"[clientscript,assist_comp_sethide]"],[3845798028,"[clientscript,assist_display_icon]"],[1944166572,"[proc,assist_set_icon]"],[2391398077,"[clientscript,stats_statbase]"],[2194073953,"[clientscript,assist_flash_button]"],[2824012478,"[clientscript,assist_clear_button]"],[3115505675,"[clientscript,assist_overlay_flash_icon]"],[3190325882,"[clientscript,assist_flash_icon]"],[4008496884,"[clientscript,xbows_init]"],[3804928728,"[clientscript,xbows_bolts]"],[4082268306,"[clientscript,xbows_level]"],[1042195195,"[clientscript,crafting_level]"],[190545534,"[clientscript,crafting_level_hide]"],[536027846,"[proc,assist_switch_var]"],[288171727,"[clientscript,stats_skilltotal]"],[2453186623,"[clientscript,stats_mouseover]"],[771856344,"[proc,sideinit_comp_close]"],[401041792,"[proc,stats_mouseover_create]"],[1164643033,"[clientscript,stats_update]"],[4043475017,"[clientscript,objdialog_reset]"],[3620396224,"[clientscript,objdialog_close]"],[2610745903,"[clientscript,objdialog_ondialogabort]"],[1972399808,"[proc,objdialog_close]"],[3965661080,"[clientscript,objdialog_onkey]"],[3740780303,"[clientscript,objdialog_delay_timer]"],[3280593621,"[proc,objdialog_refreshsearch]"],[2587349391,"[proc,objdialog_dosearch]"],[3019618013,"[proc,objdialog_doscrollbar]"],[2584600580,"[clientscript,objdialog_highlight]"],[1674697446,"[clientscript,objdialog_select]"],[1943362384,"[clientscript,stockmarket_onload]"],[3307998814,"[clientscript,stockmarket_onstocktransmit]"],[4234434349,"[clientscript,stockmarket_onvartransmit]"],[4179741091,"[clientscript,stockmarket_oninvtransmit]"],[4283473604,"[clientscript,stockmarket_choosecancel]"],[2741298709,"[clientscript,stock_offercount_minus]"],[506937563,"[clientscript,stock_offercount_plus]"],[3880927303,"[clientscript,friends_chat_drag]"],[3716460699,"[clientscript,stock_offerprice_minus]"],[122752405,"[clientscript,stock_offerprice_plus]"],[4191826024,"[clientscript,stockcollect_onload]"],[3450649361,"[clientscript,lore_magic_entertargetmode]"],[2133533138,"[clientscript,lore_magic_leavetargetmode]"],[38928639,"[clientscript,gravestone_plaque_setup]"],[2427492562,"[proc,lore_updateicon_v2]"],[1990313151,"[proc,scale_round]"],[2529120309,"[clientscript,letter_lj_setscrollpos]"],[855810399,"[clientscript,partyroom_interface_setup]"],[3486303877,"[clientscript,gravestone_shop_setup]"],[2783709258,"[proc,gravestone_shop_createbutton]"],[2313497945,"[proc,gravestone_shop_model]"],[693361276,"[clientscript,gravestone_shop_select]"],[89788014,"[clientscript,cc_graphic_swapper]"],[3563406607,"[clientscript,worldmap_keysort_button]"],[2140486521,"[proc,rgb_to_hex]"],[1589568985,"[proc,lightcombine]"],[566965005,"[clientscript,interface_invother_init_big]"],[1448476994,"[clientscript,bankpin_cancel]"],[1154868597,"[clientscript,imp_bank_setup]"],[2903201470,"[clientscript,interface_flash_slot_static]"],[3362070320,"[clientscript,rcguild_overlay_load]"],[4143386711,"[clientscript,fade_out_darkness]"],[755632318,"[clientscript,fade_in_darkness]"],[1827543514,"[proc,int_to_bool]"],[3435133763,"[clientscript,lore_head_update]"],[4222815955,"[clientscript,lore_pouch_counter]"],[1092933536,"[clientscript,topstat_run_text_init]"],[1894284823,"[clientscript,lore_deltooltip]"],[3510789731,"[proc,lore_tostring]"],[3081039143,"[proc,lore_tostring_pouch]"],[1409420104,"[clientscript,lore_blanktip]"],[4178932150,"[clientscript,quickchat_tutorial_loadcontent]"],[2456340101,"[clientscript,quickchat_tutorial_showpage]"],[460219700,"[clientscript,stats_scrollbar_setup]"],[859010524,"[clientscript,music_v3_setcolour]"],[1823616535,"[proc,music_getvar]"],[154350151,"[clientscript,topstat_run_text_update]"],[2308957732,"[proc,obj_warning]"],[513804110,"[clientscript,rabbit_shop_init]"],[1281689458,"[clientscript,rabbit_shop_pointsupdate]"],[3752402689,"[clientscript,fairyrings_clockwise]"],[2159187171,"[clientscript,fairyrings_anticlockwise]"],[3482052860,"[clientscript,fairyrings_vartransmit]"],[1527134220,"[clientscript,fairyrings_rotate]"],[3027309454,"[proc,fairyrings_rotate_component]"],[1784895621,"[proc,quickchat_tutorial_showpage]"],[3806649405,"[proc,quickchat_tutorial_displaydata]"],[148549787,"[proc,quickchat_tutorial_addtext]"],[838459535,"[proc,quickchat_phrase_objdialog]"],[3892822741,"[proc,quickchat_objdialog_dosearch]"],[1987824975,"[proc,quickchat_objdialog_refreshsearch]"],[3447322583,"[proc,quickchat_objdialog_doscrollbar]"],[2135594878,"[clientscript,quickchat_objdialog_highlight]"],[664789303,"[proc,quickchat_phrase_countdialog]"],[4087775869,"[clientscript,quickchat_open_onop]"],[932493278,"[proc,quickchat_open]"],[3908982894,"[proc,quickchat_open_context]"],[222932477,"[proc,quickchat_respond]"],[143576122,"[clientscript,quickchat_close]"],[2790547002,"[proc,quickchat_close]"],[488840978,"[clientscript,quickchat_onkey]"],[2539327254,"[clientscript,quickchat_menu_select]"],[1529553174,"[proc,quickchat_menu_select]"],[3048708551,"[proc,quickchat_menu_add]"],[3942718117,"[proc,quickchat_response_add]"],[1478142309,"[proc,quickchat_menu_scroll]"],[2487916389,"[clientscript,quickchat_menu_scroll]"],[1306251819,"[proc,quickchat_path_scroll]"],[387832056,"[clientscript,quickchat_return]"],[839550712,"[proc,quickchat_return]"],[4092219345,"[proc,quickchat_phrase_resend]"],[2991237263,"[clientscript,quickchat_phrase]"],[3442955919,"[proc,quickchat_phrase]"],[3762912081,"[proc,quickchat_phrase_setup]"],[3303235167,"[clientscript,quickchat_phrase_int]"],[499715167,"[proc,quickchat_phrase_int]"],[3303402071,"[clientscript,quickchat_phrase_obj]"],[499882071,"[proc,quickchat_phrase_obj]"],[2615229924,"[proc,quickchat_phrase_send]"],[685798911,"[proc,quickchat_phrase_setint]"],[685965815,"[proc,quickchat_phrase_setobj]"],[4059893459,"[clientscript,clanwars_setup_createbox]"],[3831217363,"[proc,clanwars_setup_createbox]"],[1955019231,"[proc,quickchat_friend_status]"],[2559383852,"[clientscript,bankpin_init]"],[1744235652,"[clientscript,bankpin_resynch]"],[1139613578,"[clientscript,bankpin_button]"],[667843985,"[proc,cursors_login]"],[1881684709,"[proc,scrollbar_horizontal]"],[1508390833,"[proc,dream_instance]"],[123612939,"[clientscript,meslayer_mode12]"],[1239709650,"[clientscript,loginscreen_load]"],[1721916603,"[clientscript,loginscreen_setactivemenu]"],[3222892219,"[proc,loginscreen_setactivemenu]"],[1500845733,"[clientscript,lobby_friends_join]"],[1810777253,"[proc,lobby_friends_join]"],[2046475594,"[clientscript,boardgames_rank_update]"],[424068167,"[proc,topstat_run_text_update]"],[1732692871,"[proc,loginscreen_brightness]"],[1348328603,"[clientscript,model_wobble]"],[2340187306,"[clientscript,model_wobble_magnitude]"],[551376714,"[proc,model_wobble_proc]"],[2437085339,"[proc,model_wobble_magnitude_proc]"],[3840642455,"[clientscript,rand_model_wobble]"],[1607340710,"[clientscript,rand_model_wobble_magnitude]"],[3761419662,"[clientscript,loginscreen_slider_click]"],[4278850768,"[clientscript,loginscreen_slider_drag]"],[1846914474,"[proc,loginscreen_musicvol]"],[3099023796,"[clientscript,loginscreen_keypress]"],[1788527159,"[clientscript,tzhaar_fightcave_init]"],[3620112635,"[clientscript,trawler_reward_setup]"],[3233248376,"[clientscript,prayer_load_buttons]"],[4251190904,"[proc,prayer_load_buttons]"],[1477182426,"[clientscript,zep_mouse_over]"],[2741279957,"[clientscript,zep_mouse_leave]"],[1359104264,"[clientscript,boardgames_options_ranked]"],[106291654,"[clientscript,boardgames_options_time]"],[246074949,"[proc,bankpin_shuffle]"],[3012031187,"[clientscript,agilityarena_set_model]"],[2575339581,"[clientscript,draughts_inv_init]"],[3112384420,"[clientscript,draughts_inv_update]"],[4130326948,"[proc,draughts_inv_update]"],[3213596180,"[clientscript,hauntedmine_controls_load]"],[3055081151,"[proc,lobbyscreen_load]"],[3941334181,"[clientscript,topstat_run_button_init]"],[1626449422,"[clientscript,topstat_run_button_vartransmit]"],[1721959160,"[clientscript,cc_text_colour_swapper]"],[2303346140,"[clientscript,settrans]"],[66322620,"[clientscript,chatdefault_init]"],[2116492142,"[proc,subchanged]"],[3359867955,"[clientscript,worldmap_init]"],[1236876578,"[proc,worldmap_setzoom]"],[2439177366,"[clientscript,worldmap_toggleoverview]"],[3754362509,"[proc,worldmap_showoverview]"],[1248512535,"[clientscript,worldmap_onkey]"],[1193031704,"[clientscript,barrows_killcount_update]"],[2169184960,"[clientscript,worldmap_vartransmit]"],[3362007758,"[clientscript,boardgames_options_onload]"],[2860079880,"[proc,boardgames_options_ranked]"],[376009670,"[proc,boardgames_options_time]"],[3052028985,"[clientscript,meslayer_mode5]"],[1356691599,"[clientscript,agilityarena_overlay]"],[2225707103,"[proc,comlevel]"],[4006445621,"[clientscript,toplevel_fovchange]"],[449966646,"[clientscript,tutorial_progress_bar]"],[337184915,"[clientscript,sidebook_build]"],[3193517715,"[proc,sidebook_build]"],[3636647948,"[clientscript,tog_update_interface]"],[2800964792,"[clientscript,bank_cert_button]"],[3252683448,"[proc,bank_cert_button]"],[813686113,"[clientscript,player_kit_feet_initialise]"],[3545631532,"[clientscript,player_kit_feet_varctransmit]"],[186874273,"[proc,player_kit_feet_redraw]"],[1452714554,"[clientscript,player_kit_feet_colourbutton]"],[4084982613,"[clientscript,player_kit_body_initialise]"],[2447137655,"[clientscript,player_kit_body_vartransmit]"],[3345507360,"[clientscript,player_kit_body_varctransmit]"],[2925042069,"[proc,player_kit_body_redraw]"],[1252590382,"[clientscript,player_kit_body_colourbutton]"],[131443311,"[proc,player_kit_player_create]"],[715738096,"[clientscript,player_kit_player_rotate]"],[1909282860,"[clientscript,topstat_run_button_mouseover]"],[3561645044,"[clientscript,topstat_run_button_op]"],[653756319,"[clientscript,meslayer_varc_update]"],[1324675059,"[proc,meslayer_close]"],[4114120324,"[proc,chatdefault_updatechatbox]"],[343221442,"[proc,meslayer_setupinput]"],[4105878160,"[clientscript,if_settrans]"],[3214651364,"[clientscript,letter_lj_settitle]"],[3866885870,"[clientscript,friend_update]"],[861116549,"[clientscript,barbassault_name_transmit]"],[2652449176,"[proc,boardgames_status_output]"],[3512499331,"[clientscript,loot_toggle_client]"],[996999635,"[clientscript,loot_ontimer]"],[1256909645,"[proc,worldmap_arrowkey]"],[225975945,"[clientscript,booth_init]"],[279709137,"[clientscript,wornitems_slot]"],[2969482543,"[clientscript,inventory_init]"],[1511088779,"[clientscript,inventory_targetmode]"],[2964976011,"[clientscript,inventory_drag]"],[922568650,"[proc,friendschat_kick]"],[1784320521,"[proc,chatbox_resize_window]"],[3745412916,"[proc,stats_scrollbar_setup]"],[3734282232,"[proc,updatemodel]"],[3313579405,"[clientscript,champions_onop]"],[3921254692,"[clientscript,poh_bookcase_build]"],[3896699256,"[proc,curse_get_stat]"],[2561736040,"[clientscript,scrollbar_horizontal_jump]"],[2556093730,"[clientscript,scrollbar_horizontal_drag]"],[2464330761,"[clientscript,scrollbar_horizontal_wheel]"],[3069369662,"[proc,scrollbar_horizontal_doscroll]"],[484107896,"[proc,prayer_refresh_scrollbar]"],[527179209,"[clientscript,barrows_show_head]"],[367392142,"[proc,prayer_init_buttons]"],[1488061455,"[clientscript,contact_spell]"],[1594423111,"[clientscript,component_flash_start]"],[584649031,"[proc,component_flash_start]"],[1613238468,"[clientscript,component_flash_timer]"],[1575467023,"[clientscript,component_flash_stop]"],[3066914319,"[proc,component_flash_stop]"],[1573202444,"[clientscript,topstat_run_button_update]"],[3074178060,"[proc,topstat_run_button_update]"],[3911809611,"[clientscript,brew_boiler1]"],[3911809642,"[clientscript,brew_boiler2]"],[3911809673,"[clientscript,brew_boiler3]"],[2000482577,"[proc,durationmes]"],[3910427718,"[clientscript,brew_bitternut]"],[474202646,"[clientscript,brew_buckets]"],[2135772756,"[clientscript,brew_colourwater]"],[1454686083,"[clientscript,brew_bark]"],[1960258490,"[clientscript,brew_redscore]"],[190203079,"[clientscript,brew_bluescore]"],[1471542798,"[clientscript,brew_time]"],[1033581464,"[clientscript,worldmap_search_start]"],[3975454401,"[clientscript,clanwars_orb]"],[2690089489,"[proc,clanwars_resynch_melee]"],[2686250232,"[proc,clanwars_resynch_magic]"],[1818336974,"[proc,clanwars_resynch_ranged]"],[518556078,"[proc,clanwars_resynch_prayer]"],[3841595844,"[proc,clanwars_resynch_summoning]"],[2990107159,"[proc,clanwars_resynch_food]"],[1057297861,"[proc,clanwars_resynch_potions]"],[3957694637,"[proc,clanwars_resynch_accept]"],[2574156609,"[proc,clanwars_focuslayer]"],[3887465978,"[proc,clanwars_updateside]"],[3748818075,"[proc,clanwars_updateside_textbox]"],[1495934386,"[clientscript,clanwars_overlay_status_init]"],[675327097,"[clientscript,clanwars_overlay_status]"],[1677159337,"[clientscript,clanwars_overlay_status_timecounter]"],[2072602296,"[clientscript,clanwars_overlay_rules]"],[1622323204,"[clientscript,clanwars_ffa_warning_setup]"],[3447046831,"[clientscript,clanwars_setup_maininit]"],[2431536857,"[clientscript,clanwars_setup_acceptlayer]"],[4274095970,"[clientscript,clanwars_setup_magictooltip]"],[2277148807,"[clientscript,clanwars_end_setup]"],[3393983442,"[proc,clanwars_end_victory]"],[2449005923,"[proc,clanwars_end_defeat]"],[1039801778,"[proc,clanwars_end_draw]"],[1703639912,"[proc,clanwars_setup_clicktest]"],[864152526,"[clientscript,clanwars_setup_melee]"],[860313269,"[clientscript,clanwars_setup_magic]"],[1048865969,"[clientscript,clanwars_setup_ranged]"],[4044052369,"[clientscript,clanwars_setup_prayer]"],[2771344641,"[clientscript,clanwars_setup_summoning]"],[2238469306,"[clientscript,clanwars_setup_food]"],[2973500482,"[clientscript,clanwars_setup_potions]"],[4144900249,"[clientscript,clanwars_setup_accept_button]"],[3975174719,"[clientscript,clanwars_ffa]"],[4027941643,"[clientscript,clanwars_setup_vartransmit]"],[810823436,"[clientscript,clanwars_setup_varctransmit]"],[251187421,"[clientscript,clanwars_setup_varcstrtransmit]"],[2069140585,"[proc,worldmap_key_build]"],[2269675475,"[proc,worldmap_createline]"],[1869682011,"[proc,worldmap_createtitle]"],[1111323351,"[proc,worldmap_quicksort_alphabetical]"],[4292966225,"[proc,worldmap_quicksort_category]"],[4200886279,"[clientscript,lobby_hop_abort]"],[2552889863,"[proc,lobby_hop_abort]"],[434295001,"[clientscript,quickchat_enter_search]"],[1685034926,"[proc,friendschat_kick_mes]"],[726013380,"[clientscript,friendschatsetup_onload]"],[2724789276,"[clientscript,friendschatsetup_onfriendtransmit]"],[3491036889,"[proc,quickchat_enter_search]"],[1335606747,"[clientscript,sc_remaining_clay_help]"],[2065783093,"[clientscript,sc_processing_init]"],[1946054991,"[clientscript,agilityarena_colour]"],[2055006674,"[clientscript,pest_mouseover]"],[3473962461,"[clientscript,pest_mouseleave]"],[3868947121,"[clientscript,pest_confirm_mouseover]"],[3546449442,"[proc,battlestaff_number]"],[1053013362,"[proc,rabbit_shop_pointsupdate]"],[1206294388,"[clientscript,loginscreen_slider_click_icon]"],[3532743566,"[proc,loginscreen_slider_click]"],[3743667126,"[clientscript,trawler_water_level]"],[814340540,"[clientscript,blast_furnace_bar_stock]"],[4169583975,"[clientscript,worldmap_overlay]"],[1898617945,"[proc,worldmap_overlay_clear]"],[3640863448,"[proc,worldmap_setupgraphic]"],[4292484625,"[proc,worldmap_hidegraphic]"],[3117904717,"[proc,worldmap_setuptext]"],[3042604802,"[clientscript,worldmap_op]"],[1864228840,"[proc,mescoord]"],[3932389342,"[clientscript,evilbob_load]"],[1850021236,"[clientscript,evilbob_start]"],[132301331,"[clientscript,cc_settrans]"],[2790082928,"[clientscript,trade_pricechecker_init]"],[871534013,"[clientscript,trade_pricechecker_setup]"],[642857917,"[proc,trade_pricechecker_setup]"],[4244988801,"[proc,lobbyscreen_input_full]"],[1096425515,"[clientscript,godwars_overlay_init]"],[2710757273,"[clientscript,rand_rewards_populate]"],[1517824410,"[clientscript,rand_rewards_onhover]"],[323542246,"[clientscript,rand_rewards_onexit]"],[3161116447,"[clientscript,rand_rewards_clickinformation]"],[1302972525,"[clientscript,rand_load_shop]"],[2527630203,"[proc,rand_buyprice]"],[571735141,"[clientscript,topstat_prayer_custom]"],[661706774,"[clientscript,topstat_prayer_button_op]"],[969435950,"[proc,topstat_prayer_button_update]"],[3251491523,"[clientscript,topstat_run_button_mouseleave]"],[4044799584,"[proc,topstat_button_mouseover]"],[733033231,"[proc,topstat_button_mouseleave]"],[4090981323,"[clientscript,barbassault_tutorial_colours]"],[856792583,"[clientscript,show_component]"],[1851977378,"[clientscript,hide_component]"],[3150159816,"[clientscript,godwars_overlay_vartransmit]"],[319019304,"[clientscript,xbows_rune_update]"],[1437395752,"[proc,xbows_rune_update]"],[582696090,"[clientscript,xbows_bolts_update]"],[892627610,"[proc,xbows_bolts_update]"],[1013245893,"[clientscript,xbows_setfont]"],[3568416708,"[clientscript,player_kit_scroll]"],[443236725,"[proc,player_kit_select]"],[2337247561,"[clientscript,login_register]"],[1642909186,"[clientscript,makeover_headsetup]"],[110400287,"[clientscript,makeover_gender_resynch]"],[4286972974,"[clientscript,makeover_gender_force]"],[139655258,"[proc,makeover_gender]"],[934806644,"[clientscript,makeover_colour_resynch]"],[739231427,"[clientscript,makeover_colour_force]"],[1169395375,"[proc,makeover_colour]"],[1372782649,"[clientscript,cc_setoutline]"],[2214164565,"[proc,hex_to_rgb]"],[3659841862,"[proc,lobbyscreen_leavelobby]"],[3474742053,"[clientscript,boardgames_sandtimer]"],[168729214,"[clientscript,boardgames_names]"],[1611510626,"[clientscript,boardgames_status]"],[2976127626,"[clientscript,gravestone_update_timer]"],[150467121,"[proc,gravestone_stop_timer]"],[2715906233,"[clientscript,trawler_time_left]"],[490313044,"[clientscript,notes_init]"],[856642299,"[clientscript,notes_update]"],[4056433288,"[proc,notes_build]"],[2141164718,"[clientscript,notes_click]"],[4076742318,"[proc,notes_click]"],[485806512,"[clientscript,notes_drag]"],[236993428,"[clientscript,notes_drag_end]"],[252056329,"[proc,notes_get_note]"],[528294127,"[proc,notes_get_colour]"],[3701753548,"[proc,notes_convert_colour]"],[778503687,"[clientscript,notes_colour_abort]"],[123612970,"[clientscript,meslayer_mode13]"],[1194941023,"[proc,player_prefix_check]"],[2844028720,"[clientscript,mob_locator_switch_tab]"],[1111936469,"[clientscript,mob_locator_onload]"],[1195116014,"[clientscript,mob_locator_resource_setup]"],[480719854,"[proc,mob_locator_resource_setup]"],[2360001810,"[proc,graphics_options_detailget]"],[2360359302,"[proc,graphics_options_detailset]"],[3808937363,"[clientscript,graphics_options_init]"],[2799163283,"[proc,graphics_options_init]"],[1992121244,"[proc,graphics_options_rebuild]"],[657973301,"[clientscript,dob_confirm_load]"],[123613032,"[clientscript,meslayer_mode15]"],[620626257,"[proc,graphics_options_reviewoptions]"],[3394926320,"[proc,graphics_options_resolutions]"],[2352609584,"[proc,graphics_options_message]"],[1616350722,"[clientscript,graphics_options_setwindowmode]"],[3880033517,"[clientscript,create_focus]"],[3753396973,"[proc,create_focus]"],[3791364223,"[proc,buyprice]"],[1872924219,"[proc,meslayer_setupdynamicbutton]"],[2625707790,"[clientscript,meslayer_lastname]"],[2620080175,"[proc,skilltotal]"],[3848538175,"[proc,clanwars_ffa]"],[969730300,"[clientscript,fade2_in_generic]"],[3323421482,"[proc,fade2_generic]"],[2510758524,"[clientscript,fade2_timer]"],[699637145,"[clientscript,fade2_flash_generic]"],[1717579673,"[proc,fade2_flash_generic]"],[3522936491,"[clientscript,fade2_flash_timer]"],[528691528,"[clientscript,fade2_flash_stop]"],[2277684260,"[proc,inventory_setophelds]"],[3474518444,"[clientscript,barbassault_onload]"],[3166652204,"[clientscript,ii_storage_update]"],[3753497464,"[clientscript,ii_storage_update_side]"],[418552743,"[clientscript,ii_mouseleave]"],[2140497881,"[clientscript,ii_timer_display]"],[2734915830,"[clientscript,ii_timer_update]"],[628787993,"[clientscript,ii_resize_if]"],[233070860,"[clientscript,settings_init]"],[2030646385,"[clientscript,loginscreen_button_highlight]"],[2690703985,"[proc,loginscreen_button_highlight]"],[4126927209,"[clientscript,loginscreen_link_highlight]"],[3412531049,"[proc,loginscreen_link_highlight]"],[1239543614,"[clientscript,loginscreen_link]"],[516662869,"[clientscript,loginscreen_link_nologin]"],[1087941634,"[proc,login_open]"],[3314478742,"[proc,login_close]"],[1467204022,"[clientscript,login_focus]"],[2294917456,"[clientscript,login_dologin]"],[2664151888,"[proc,login_dologin]"],[1801897444,"[clientscript,login_reply]"],[2498009784,"[proc,login_getreply]"],[3689460322,"[proc,login_popup]"],[3783916571,"[clientscript,login_popup_throbber]"],[2037851849,"[clientscript,login_popup_close]"],[3156228297,"[proc,login_popup_close]"],[627960241,"[clientscript,ecosystem_tutorial_camera]"],[899951555,"[proc,ecosystem_tutorial_cam_1]"],[899951586,"[proc,ecosystem_tutorial_cam_2]"],[899951617,"[proc,ecosystem_tutorial_cam_3]"],[899951648,"[proc,ecosystem_tutorial_cam_4]"],[899951679,"[proc,ecosystem_tutorial_cam_5]"],[899951710,"[proc,ecosystem_tutorial_cam_6]"],[899951741,"[proc,ecosystem_tutorial_cam_7]"],[899951772,"[proc,ecosystem_tutorial_cam_8]"],[2279626121,"[clientscript,ecosystem_tutorial_cam_8_2]"],[3028744160,"[proc,cc_add]"],[3221921879,"[proc,cc_add_graphic]"],[880084526,"[proc,cc_add_text]"],[878217303,"[proc,cc_add_rect]"],[1321038006,"[proc,cc_add_model]"],[131888203,"[proc,lobbyscreen_input]"],[2381813234,"[clientscript,lobbyscreen_input_close]"],[2651531250,"[proc,lobbyscreen_input_close]"],[2651216445,"[proc,lobbyscreen_input_clear]"],[1990069396,"[clientscript,lobbyscreen_input_ok]"],[3481516692,"[proc,lobbyscreen_input_ok]"],[2656693673,"[clientscript,lobbyscreen_input_keyboard]"],[2603362495,"[clientscript,lobbyscreen_load]"],[1113748204,"[clientscript,lobbyscreen_tabswitch]"],[103974124,"[proc,lobbyscreen_tabswitch]"],[3659495243,"[clientscript,lobbyscreen_entergame]"],[2649721163,"[proc,lobbyscreen_entergame]"],[1596493706,"[clientscript,lobbyscreen_entergametimer]"],[603099974,"[clientscript,lobbyscreen_leavelobby]"],[2603196459,"[clientscript,lobbyscreen_link]"],[2430617284,"[proc,lobbyscreen_countdown]"],[1748580398,"[clientscript,lobbyscreen_pvp_warning]"],[2135384405,"[proc,lobby_popup]"],[1361417084,"[clientscript,lobby_popup_close]"],[2479793532,"[proc,lobby_popup_close]"],[3757500491,"[proc,lobby_worldswitcher_drawlist]"],[3565711912,"[clientscript,lobby_worldswitcher_timer]"],[3727979453,"[proc,create_error]"],[4230839734,"[proc,create_suggestions]"],[2570585870,"[proc,task_requirements_fulfilled]"],[92935137,"[clientscript,create_suggestions_highlight]"],[752992737,"[proc,create_suggestions_highlight]"],[2431904840,"[proc,task_get_progress]"],[26928408,"[clientscript,login_resize]"],[4195259160,"[proc,login_resize]"],[3291438026,"[proc,login_popup_full]"],[2494329492,"[clientscript,login_hop_abort]"],[846333076,"[proc,login_hop_abort]"],[1693675281,"[proc,loginscreen_setactivemenu_full]"],[3325056826,"[clientscript,rand_interface_click]"],[1402160656,"[clientscript,rand_map_reset]"],[1529664866,"[clientscript,rand_map_add_room]"],[3550632988,"[clientscript,rand_map_add_player]"],[1200364771,"[clientscript,rand_map_start_room]"],[1972669362,"[clientscript,rand_map_boss_room]"],[2519345500,"[clientscript,rand_map_tooltip]"],[464922395,"[clientscript,scrollbar_vertical_text]"],[4173486214,"[clientscript,rand_inspect_examine]"],[4207373291,"[clientscript,trail_compasspoint]"],[1244514185,"[clientscript,loginscreen_quit]"],[2961982538,"[clientscript,autosetup]"],[778524234,"[proc,autosetup]"],[3883055143,"[proc,firstrun]"],[2520806556,"[clientscript,graphics_options_button_highlight]"],[1485145756,"[proc,graphics_options_button_highlight]"],[3562781666,"[clientscript,lobbyscreen_chat_handler]"],[1585201277,"[proc,lobbyscreen_chat_count]"],[4091811805,"[clientscript,objbox_set_zoom]"],[3033481489,"[clientscript,loginscreen_setactivemenu_full]"],[675911350,"[proc,love_instance]"],[3233433286,"[clientscript,love_cutscenes]"],[879294718,"[clientscript,love_puzzle_init]"],[1005876261,"[clientscript,love_puzzle_update]"],[1315807781,"[proc,love_puzzle_update]"],[1335655500,"[proc,love_puzzle_node]"],[3848765151,"[clientscript,love_puzzle_sourceclick]"],[2630640390,"[proc,love_puzzle_read_1]"],[2630640421,"[proc,love_puzzle_read_2]"],[1402686335,"[proc,love_puzzle_used_1]"],[1402686366,"[proc,love_puzzle_used_2]"],[3186281300,"[clientscript,love_puzzle_side_init]"],[1861070922,"[proc,userflowflags]"],[841315543,"[clientscript,rand_ring_interface_init]"],[3814962041,"[clientscript,trail_compass_timer]"],[3030111179,"[proc,rough_angle]"],[1502710231,"[clientscript,rand_herbburner_onhover]"],[1569980681,"[clientscript,rand_herbburner_onexit]"],[2558710742,"[clientscript,statue_bag_init]"],[1200764559,"[proc,music_v3_refresh]"],[1093385031,"[proc,music_search_close]"],[2770583881,"[proc,meslayer_mode14]"],[3954515392,"[proc,create_check_email]"],[3687734141,"[clientscript,login_link_highlight]"],[884214141,"[proc,login_link_highlight]"],[3390182533,"[clientscript,lobby_resize]"],[3263545989,"[proc,lobby_resize]"],[2823046782,"[clientscript,warguild_tag_setup]"],[923376034,"[clientscript,warguild_tag_tick]"],[1357847676,"[clientscript,warguild_overlay_arrow]"],[119622268,"[proc,warguild_overlay_arrow]"],[2464582706,"[clientscript,stockcollect_refresh]"],[3956030002,"[proc,stockcollect_refresh]"],[3993327093,"[proc,guesscolour]"],[2140499603,"[proc,rgb_to_hsl]"],[1054303555,"[clientscript,graphic_swapper2]"],[1054303586,"[clientscript,graphic_swapper3]"],[3853237005,"[clientscript,closebutton_click_book]"],[3874133752,"[clientscript,closebutton_click_paper]"],[3002396774,"[proc,fadeout]"],[3044892262,"[clientscript,fadeout]"],[1343771489,"[proc,fadein]"],[3284804961,"[clientscript,fadein]"],[1755755652,"[clientscript,valentine_setup]"],[2806854053,"[clientscript,bankpin_buttonbox]"],[2044840507,"[clientscript,bankpin_settings_setup]"],[3403460585,"[clientscript,clan_join_invite_onload]"],[2239541240,"[clientscript,clan_create_return]"],[2549472760,"[proc,clan_create_return]"],[3376774797,"[clientscript,clansettings_onload]"],[2422215987,"[clientscript,clansettings_interface_refresh]"],[1082409779,"[proc,clansettings_interface_refresh]"],[3146675397,"[clientscript,clansettings_list_build]"],[3416393413,"[proc,clansettings_list_build]"],[3816256838,"[clientscript,clan_setup_flags]"],[3943525262,"[clientscript,clan_flag_highlight]"],[2059686692,"[clientscript,clan_flag_highlight_update]"],[666500494,"[proc,clan_flag_highlight]"],[3159180403,"[proc,clan_offset_tostring]"],[950091181,"[proc,clan_time_tostring]"],[3534677166,"[clientscript,clan_run_time]"],[803607787,"[proc,clan_keyword_get]"],[959843501,"[clientscript,clan_keywords_update]"],[383729166,"[clientscript,clan_noticeboard_build]"],[3440471054,"[proc,clan_noticeboard_build]"],[3403050012,"[clientscript,clan_noticeboard_event_show]"],[774882958,"[clientscript,clan_qfc_return]"],[3421853838,"[proc,clan_qfc_return]"],[1664466295,"[clientscript,clan_vote_cast]"],[2071952732,"[proc,clan_vote_disable]"],[346009718,"[clientscript,clan_vote_restore]"],[111071091,"[proc,clan_vote_enable]"],[1034516205,"[clientscript,clan_vote_update]"],[961454523,"[clientscript,clan_motto_text_init]"],[4035496741,"[clientscript,clan_motto_text_input]"],[3861648679,"[clientscript,clan_motto_text_click]"],[682792749,"[clientscript,clan_motto_return]"],[1801169197,"[proc,clan_motto_return]"],[3493996753,"[proc,clan_motif_decode]"],[463148884,"[clientscript,clan_build_preview]"],[2885368025,"[clientscript,clan_motif_set]"],[1086136315,"[proc,clan_build_motif_layer]"],[2053465413,"[clientscript,clan_switch_tab]"],[405468997,"[proc,clan_switch_tab]"],[939191011,"[clientscript,clan_set_colour1]"],[939191042,"[clientscript,clan_set_colour2]"],[3395901300,"[clientscript,clan_info_load]"],[2039658235,"[clientscript,clan_click_pm]"],[3882886751,"[clientscript,clan_chat_onload]"],[226375491,"[clientscript,clan_invite_button]"],[3049345404,"[clientscript,clan_chat_onclansettingstransmit]"],[3985768316,"[proc,clan_chat_onclansettingstransmit]"],[685263562,"[clientscript,clan_chat_list_refresh]"],[3060697419,"[proc,clan_chat_clearlist]"],[409126975,"[clientscript,clan_chat_onclantransmit]"],[3857928584,"[clientscript,clan_chat_minimenu_timer]"],[3160934020,"[proc,clan_chat_kick_find]"],[1113506622,"[proc,clan_chat_kick]"],[3534330804,"[clientscript,clan_chat_list_op]"],[812018461,"[proc,aif_checkbox_build_layer]"],[790005299,"[clientscript,aif_textinputbox]"],[1241723955,"[proc,aif_textinputbox]"],[3911896464,"[clientscript,aif_progressbar_set]"],[634871696,"[proc,aif_progressbar_set]"],[123613063,"[clientscript,meslayer_mode16]"],[81588283,"[proc,ignore_init]"],[4011144199,"[proc,friend_init]"],[2505446143,"[clientscript,friends2_switchmode]"],[3331131675,"[proc,date_tostring]"],[1190281186,"[proc,text_plural]"],[2581030282,"[proc,clan_keyword_construct]"],[1932739337,"[clientscript,clan_colour_mouseover]"],[81002439,"[proc,displayname_simplify]"],[1890192988,"[clientscript,skillcape_build_preview]"],[165898984,"[clientscript,clan_noticeboard_event_mouseover]"],[746198919,"[clientscript,clan_noticeboard_event_mouseleave]"],[4005505415,"[proc,clan_noticeboard_event_mouseleave]"],[3220029995,"[clientscript,clan_chat_kick_button]"],[2429103799,"[proc,divide_up]"],[1887979583,"[proc,string_to_int]"],[1127565377,"[clientscript,cc_text_swapper]"],[4290883894,"[proc,tostring_minutes]"],[363054717,"[clientscript,mes]"],[2368304475,"friendslist_font"],[1708131472,"tutorial_font"],[3318248980,"welcome_font_small"],[3311443016,"welcome_font_large"],[3952954078,"p11_full"],[3981583229,"p12_full"],[1057075019,"b12_full"],[3197789671,"q8_full"],[1044900049,"tutorial_font_big"],[2196753399,"menu_font_small"],[1787935731,"quill_oblique_large"],[3929683415,"quill_caps_large"],[1157777820,"lunar_alphabet"],[24702590,"lunar_alphabet_lrg"],[2537929920,"barbassault_font"],[962781051,"tzhaar_numbers"],[1851754626,"surok_font"],[2046729299,"welcome_font_tiny"],[4120166957,"verdana_11pt_regular"],[1227328817,"verdana_15pt_regular"],[526264239,"verdana_13pt_regular"],[1583090068,"verdana_11pt_bold"],[773743442,"verdana_13pt_bold"],[3952954078,"p11_full"],[3981583229,"p12_full"],[1057075019,"b12_full"],[530115961,"overview"],[3952954078,"p11_full"],[3981583229,"p12_full"],[1057075019,"b12_full"],[2367466341,"ardougne_underground"],[3782884290,"zanaris"],[666527204,"troll_stronghold"],[110542532,"tolna"],[3755693678,"slayer_cave"],[339955018,"wilderness_dungeons"],[3392903,"null"],[1307407612,"tzhaar_area"],[128295007,"karamja_underground"],[1009939806,"miscellania_underground"],[197428487,"godwars"],[1963869704,"waterbirth"],[2830869084,"dwarven_mines"],[2373387318,"braindeath_island"],[889241484,"kalphite"],[4122880542,"keldagrim"],[114071,"sos"],[3393803815,"asgarnia_ice_dungeon"],[2420028541,"dorgeshkaan"],[1003245557,"mosleharmless_cave"],[3343801,"main"],[3186551633,"ourania"],[4114385656,"undead_dungeon"],[614031419,"misthalin_underground"],[2502817264,"ancient_cavern"],[4204353360,"morytania_underground"],[2934750709,"circus"],[94427558,"canoe"],[2367466341,"ardougne_underground"],[3782884290,"zanaris"],[666527204,"troll_stronghold"],[110542532,"tolna"],[3755693678,"slayer_cave"],[339955018,"wilderness_dungeons"],[1307407612,"tzhaar_area"],[128295007,"karamja_underground"],[1009939806,"miscellania_underground"],[197428487,"godwars"],[1963869704,"waterbirth"],[2830869084,"dwarven_mines"],[2373387318,"braindeath_island"],[889241484,"kalphite"],[4122880542,"keldagrim"],[114071,"sos"],[3393803815,"asgarnia_ice_dungeon"],[2420028541,"dorgeshkaan"],[1003245557,"mosleharmless_cave"],[3343801,"main"],[3186551633,"ourania"],[4114385656,"undead_dungeon"],[614031419,"misthalin_underground"],[2502817264,"ancient_cavern"],[4204353360,"morytania_underground"],[1787935731,"quill_oblique_large"],[3929683415,"quill_caps_large"],[1157777820,"lunar_alphabet"],[24702590,"lunar_alphabet_lrg"],[2537929920,"barbassault_font"],[1851754626,"surok_font"],[1708131472,"tutorial_font"],[1044900049,"tutorial_font_big"],[962781051,"tzhaar_numbers"],[2368304475,"friendslist_font"],[2046729299,"welcome_font_tiny"],[3318248980,"welcome_font_small"],[3311443016,"welcome_font_large"],[2196753399,"menu_font_small"],[4120166957,"verdana_11pt_regular"],[526264239,"verdana_13pt_regular"],[1583090068,"verdana_11pt_bold"],[773743442,"verdana_13pt_bold"],[1227328817,"verdana_15pt_regular"],[3952954078,"p11_full"],[3981583229,"p12_full"],[3197789671,"q8_full"],[1057075019,"b12_full"]]),Eb=[Uy("opin",Dy.enum_hasoutput)|By("int",2),Uy("opout",Dy.enum_getreverseindex)|By("int",0),Uy("opin",Dy.enum_getreverseindex)|By("int",3),Uy("opin",Dy.enum_getreversecount)|By("int",2),Uy("opin",Dy.enum_getstring)|By("int",1),Uy("opin",Dy.popdiscardint)|By("int",0),Uy("opout",Dy.lc_getparam)|By("int",0),Uy("opin",Dy.cc_setparam)|By("int",1),Uy("opin",Dy.db_find_with_count)|By("int",1),Uy("opin",Dy.pop_array)|By("int",1),Uy("opout",Dy.push_array)|By("int",0),Uy("opin",Dy.switch)|By("int",0),zy(Ly.unknown_int),zy(Ly.unknown_long),zy(Ly.unknown_string),...ab.flatMap((e=>[Uy("opin",e)|By("int",0),Uy("opin",e)|By("int",1)])),...sb.flatMap((e=>[Uy("opin",e)|By("long",0),Uy("opin",e)|By("long",1)]))]
;class wb{constructor(){this.map=new Map,this.knowntypes=new Map,this.uuidcounter=1;for(let e of Object.values(Ly)){let t=zy(e);this.knowntypes.set(t,e)}}entangle(e,t){if(null==t)return;if(e==t)return;if(Eb.includes(e)||Eb.includes(t))return
;Array.isArray(globalThis.testkey)&&e==globalThis.testkey[0]&&globalThis.testkey[1],Array.isArray(globalThis.testkey)&&e==globalThis.testkey[1]&&globalThis.testkey[0],
"number"==typeof globalThis.testboth&&(e==globalThis.testboth||globalThis.testboth),e<512&&t<512&&console.log(`unexpected exact type equation ${e} ${t}`);let n=this.map.get(e);n||(n=new Set,this.map.set(e,n)),n.add(t);let r=this.map.get(t)
;r||(r=new Set,this.map.set(t,r)),r.add(e)}parseSections(e){for(let t of e){if(-1!=t.subfuncid)continue;let e=new Ab(this);for(let n of t.children){if(!(n instanceof Cx)){if(n instanceof Nx)break;if(n instanceof gx)break;throw new Error("unexpected")
}if(!e.pushopcode(n,t.scriptid))break}}}addKnownFromCalli(e){for(let t of this.map.keys()){let[n,r,i,a]=Vy(t),s="opin"==n||"scriptargvar"==n,o="scriptargvar"==n||"scriptret"==n;if(o||"opin"==n||"opout"==n){
let n=o?e.scriptargs.get(i)?.stack:e.decodedMappings.get(i)?.stackinfo;if(n){let e=s?n.exactin:n.exactout;if(e){let n=e[r];a<n.length&&this.knowntypes.set(t,n[a])}}}}}solve(){let e=new Set(this.knowntypes.keys());for(;0!=e.size;){let t=new Set
;for(let n of e){let e=this.map.get(n);if(e){let r=this.knowntypes.get(n);for(let i of e){let e=this.knowntypes.get(i);if(void 0===e)t.add(i),this.knowntypes.set(i,r);else if(e!=r)throw globalThis.testkey=[n,i],
new Error(`conflicting types old:${Object.entries(Ly).find((t=>t[1]==e))?.[0]??"??"}, new:${Object.entries(Ly).find((e=>e[1]==r))?.[0]??"??"}\n${n} - ${Hy(n)}\n${i} - ${Hy(i)}`)}}}e=t}}}function Sb(e,t,n){return e}function Tb(e,t,n){return e|By(t,n)}
class Ab{constructor(e){this.intstack=[],this.longstack=[],this.stringstack=[],this.consts=new gb,this.ctx=e}pushopcode(e,t){Array.isArray(globalThis.test)&&globalThis.test[0]==t&&(globalThis.test[1],e.originalindex)
;let n=e.knownStackDiff??e.opinfo.stackinfo;if(!n.initializedthrough)return!1;if(!e.knownStackDiff&&pb.includes(e.op.opcode))return!1
;let r,i=0,a=0,s=e.opinfo.id==Dy.poplocalint||e.opinfo.id==Dy.pushlocalint,o=e.opinfo.id==Dy.poplocallong||e.opinfo.id==Dy.pushlocallong,l=e.opinfo.id==Dy.poplocalstring||e.opinfo.id==Dy.pushlocalstring;if(s||o||l){const n=s?"int":o?"long":"string"
;i=Uy("scriptargvar",t)|By(n,e.op.imm),a=i,r=Sb}else e.opinfo.id==Dy.gosub?(i=Uy("scriptargvar",e.op.imm),a=Uy("scriptret",e.op.imm),r=Tb):e.opinfo.id==Dy.return?(i=Uy("scriptret",t),a=i,r=Tb):(i=Uy("opin",e.op.opcode),a=Uy("opout",e.op.opcode),r=Tb)
;if(e.knownStackDiff?.exactin){let t=e.knownStackDiff.exactin;for(let e=t.int.length-1;e>=0;e--)this.ctx.entangle(zy(t.int[e]),this.intstack.pop());for(let e=t.long.length-1;e>=0;e--)this.ctx.entangle(zy(t.long[e]),this.longstack.pop())
;for(let e=t.string.length-1;e>=0;e--)this.ctx.entangle(zy(t.string[e]),this.stringstack.pop())}else{let e=n.in,t=e.getStackdiff();for(let n=e.values.length-1;n>=0;n--){let a=e.values[n];if(a instanceof bb){
for(let e=a.int-1;e>=0;e--)this.ctx.entangle(r(i,"int",--t.int),this.intstack.pop());for(let e=a.long-1;e>=0;e--)this.ctx.entangle(r(i,"long",--t.long),this.longstack.pop())
;for(let e=a.string-1;e>=0;e--)this.ctx.entangle(r(i,"string",--t.string),this.stringstack.pop())
}else if("int"==a)this.ctx.entangle(r(i,"int",--t.int),this.intstack.pop());else if("long"==a)this.ctx.entangle(r(i,"long",--t.long),this.longstack.pop());else{if("string"!=a){if("vararg"==a)return!1;throw new Error("unexpected")}
this.ctx.entangle(r(i,"string",--t.string),this.stringstack.pop())}}}if(e.knownStackDiff?.exactout){let t=e.knownStackDiff.exactout;for(let e=0;e<t.int.length;e++)this.intstack.push(zy(t.int[e]))
;for(let e=0;e<t.long.length;e++)this.longstack.push(zy(t.long[e]));for(let e=0;e<t.string.length;e++)this.stringstack.push(zy(t.string[e]))}else{let e=n.out.getStackdiff();if(0!=e.vararg)return!1
;if(!e.isNonNegative()||0!=e.vararg)throw new Error("unexpected");for(let t=0;t<e.int;t++)this.intstack.push(r(a,"int",t));for(let t=0;t<e.long;t++)this.longstack.push(r(a,"long",t));for(let t=0;t<e.string;t++)this.stringstack.push(r(a,"string",t))}
return!0}}function Cb(e,t){let n=new wb;for(let r of t.values()){if(!r.scriptcontents)continue;let{sections:t}=Ox(e,r.script,r.scriptcontents.opcodedata,r.id);n.parseSections(t)}n.solve(),function(e,t){for(let n of e.mappings.values()){
if(!n.stackinfo.initializedthrough)continue;let e=new vb,r=n.stackinfo.in.getStackdiff();for(let i=0;i<r.int;i++)e.int.push(t.get(Uy("opin",n.id)|By("int",i))??Ly.unknown_int)
;for(let i=0;i<r.long;i++)e.long.push(t.get(Uy("opin",n.id)|By("long",i))??Ly.unknown_long);for(let i=0;i<r.string;i++)e.string.push(t.get(Uy("opin",n.id)|By("string",i))??Ly.unknown_string);n.stackinfo.exactin=e
;let i=new vb,a=n.stackinfo.out.getStackdiff();for(let e=0;e<a.int;e++)i.int.push(t.get(Uy("opout",n.id)|By("int",e))??Ly.unknown_int);for(let e=0;e<a.long;e++)i.long.push(t.get(Uy("opout",n.id)|By("long",e))??Ly.unknown_long)
;for(let e=0;e<a.string;e++)i.string.push(t.get(Uy("opout",n.id)|By("string",e))??Ly.unknown_string);n.stackinfo.exactout=i}for(let[n,r]of e.scriptargs){let e=new vb,i=r.stack.in.getStackdiff()
;for(let r=0;r<i.int;r++)e.int.push(t.get(Uy("scriptargvar",n)|By("int",r))??Ly.unknown_int);for(let r=0;r<i.long;r++)e.long.push(t.get(Uy("scriptargvar",n)|By("long",r))??Ly.unknown_long)
;for(let r=0;r<i.string;r++)e.string.push(t.get(Uy("scriptargvar",n)|By("string",r))??Ly.unknown_string);r.stack.exactin=e;let a=new vb,s=r.stack.out.getStackdiff()
;for(let e=0;e<s.int;e++)a.int.push(t.get(Uy("scriptret",n)|By("int",e))??Ly.unknown_int);for(let e=0;e<s.long;e++)a.long.push(t.get(Uy("scriptret",n)|By("long",e))??Ly.unknown_long)
;for(let e=0;e<s.string;e++)a.string.push(t.get(Uy("scriptret",n)|By("string",e))??Ly.unknown_string);r.stack.exactout=a}}(e,n.knowntypes),e.foundSubtypes=!0}function Mb(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),
e.onabort=e.onerror=()=>n(e.error)}))}let Ib;function Rb(){return Ib||(Ib=function(e,t){const n=function(){var e
;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()
})).finally((function(){return clearInterval(e)})):Promise.resolve()}().then((()=>{const e=indexedDB.open("keyval-store");return e.onupgradeneeded=()=>e.result.createObjectStore(t),Mb(e)}))
;return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}(0,"keyval")),Ib}function kb(e,t=Rb()){return t("readonly",(t=>Mb(t.get(e))))}function Nb(e,t,n=Rb()){return n("readwrite",(n=>(n.put(t,e),Mb(n.transaction))))}async function Db(e){
let t=await e.getArchiveById(xg.config,Ag.params),n=new Map;for(let r of t)n.set(r.fileid,Qg.params.read(r.buffer,e));return n}async function Lb(e,t){return Qg.enums.read(await e.getFileById(xg.enums,t),e)}function Ob(e){
return e.intArrayValue1??e.intArrayValue2?.values}async function Pb(e,t){return Qg.structs.read(await e.getFileById(xg.structs,t),e)}function Fb(e,t){return(e.intArrayValue1??e.intArrayValue2?.values)?.find((e=>e[0]==t))?.[1]??e.intValue??0}
function Ub(e,t){return(e.stringArrayValue1??e.stringArrayValue2?.values)?.find((e=>e[0]==t))?.[1]??e.stringValue??""}function Bb(e,t,n){let r=e.get(n);if(!r)throw new Error(`unkown param ${n}`);let i=t?.extra?.find((e=>e.prop==n))
;if(!i)return r.type?.defaultint??-1;if(null==i.intvalue)throw new Error("param is not of type int");return i.intvalue}function zb(e,t,n){let r=e.get(n);if(!r)throw new Error(`unkown param ${n}`);let i=t?.extra?.find((e=>e.prop==n))
;if(!i)return r.type?.defaultstring??"";if(null==i.stringvalue)throw new Error("param is not of type string");return i.stringvalue}const Gb=["byte","int","tribyte","switch"];let Vb=new Zg({"0x03":{name:"type",read:"ubyte"},"0x04":{name:"0x04",
read:"ubyte"},"0x07":{name:"0x07",read:!0},"0x6e":{name:"0x6e",read:"ushort"}});var Hb=new Zg({"0x01":{name:"varid",read:"utribyte"},"0x02":{name:"bits",read:["tuple","ubyte","ubyte"]}});class jb{constructor(e,t,n){this.stackinfo=new yb,
this.stackChangeConstraints=new Set,this.scrambledid=e,this.id=t,this.possibleTypes=new Set(n),1==n.length?this.type=n[0]:this.type="unknown"}static fromJson(e){let t=new jb(e.scrambledid,e.id,"unknown"==e.type?Gb:[e.type])
;return t.stackinfo=yb.fromJson(e.stackinfo),t}toJson(){return{id:this.id,scrambledid:this.scrambledid,stackinfo:this.stackinfo.toJson(),type:this.type}}}function Wb(e){let t="byte"
;return e==Dy.pushstring?t="string":e==Dy.pushlong?t="long":e==Dy.return||38==e||39==e||102==e?t="byte":e<128&&(t="int"),t}function $b(e,t,n){let r=e.opcode,i=e.imm,a=e.imm_obj;return r==Dy.pushint&&(a=i,r=Dy.pushconst,n="switch",i=0),
r==Dy.pushlong&&(r=Dy.pushconst,n="switch",i=1),r==Dy.pushstring&&(r=Dy.pushconst,n="switch",i=2),t<751&&(r!=Dy.pushvar&&r!=Dy.popvar||(i=2<<24|i<<8)),{opcode:r,imm:i,imm_obj:a,immtype:n}}function qb(e,t){if(e.opcode!=t.opcode)return!1
;if(e.imm!=t.imm){if(Math.sign(e.imm)!=Math.sign(t.imm))return!1;if(e.imm>=0&&e.imm<10)return!1;if(t.imm>=0&&t.imm<10)return!1;if(Math.abs(e.imm-t.imm)>Math.max(e.imm+t.imm)/2*.2+10)return!1}if(typeof e.imm_obj!=typeof t.imm_obj)return!1
;if(Array.isArray(e.imm_obj)){if(!Array.isArray(t.imm_obj))return!1}else if("string"==typeof e.imm_obj);else if("number"==typeof e.imm_obj){if(Math.abs(e.imm-t.imm)>Math.max(e.imm+t.imm)/2*.2+10)return!1}else if(e.imm_obj!=t.imm_obj)return!1;return!0
}function Xb(e,t,n){let r=0,i=null;if("byte"==n){if(e.length<t+1)return null;r=e.readUint8(t),t+=1}else if("int"==n){if(e.length<t+4)return null;r=e.readInt32BE(t),t+=4}else if("tribyte"==n){if(e.length<t+3)return null;r=e.readUintBE(t,3),t+=3
}else if("switch"==n){if(e.length<t+1)return null;let n=e.readUint8(t++);if(r=n,0==n){if(e.length<t+4)return null;i=e.readInt32BE(t),t+=4}else if(1==n){if(e.length<t+8)return null;i=[e.readUint32BE(t),e.readUint32BE(t+4)],t+=8}else if(2==n){let n=t
;for(;;){if(n==e.length)return null;if(0==e.readUInt8(n))break;n++}i=e.toString("latin1",t,n),t=n+1}}else if("string"==n){let n=t;for(;;){if(n==e.length)return null;if(0==e.readUInt8(n))break;n++}i=e.toString("latin1",t,n),t=n+1}else{
if("long"!=n)throw new Error("unknown imm type");if(e.length<t+8)return null;i=[e.readUint32BE(t),e.readUint32BE(t+4)],t+=8}return{imm:r,imm_obj:i,offset:t}}let Yb=null;class Kb{static async fromJson(e,t,n){
if(t.buildnr!=e.getBuildNr())throw new Error("build numbers of json deob and loaded cache don't match");let r=new Kb(e);for(let e of t.mappings){let t=jb.fromJson(e);r.mappings.set(t.scrambledid,t),r.decodedMappings.set(t.id,t)}
return r.opidcounter=t.opidcounter,r.foundEncodings=!0,await r.preloadData(),n?r.scriptargs=new Map(n.scriptargs.map((e=>[e.id,{scriptname:e.scriptname??"",stack:yb.fromJson(e.stack)}]))):(await r.loadCandidates(),r.parseCandidateContents(),
Cb(r,r.candidates)),r}toJson(){return{buildnr:this.source.getBuildNr(),mappings:[...this.mappings.values()].map((e=>e.toJson())),opidcounter:this.opidcounter}}getScriptJson(){return{scriptargs:[...this.scriptargs].map((([e,t])=>({id:e,
scriptname:t.scriptname,stack:t.stack.toJson()})))}}static async getSaveName(e){let t=await e.getCacheIndex(xg.clientscript),n=t.find((e=>e));if(!n)throw new Error("cache has no clientscripts");let r=k_(await e.getFileById(n.major,n.minor)),i=0
;for(let e=0;e<t.length;e++)t[e]&&(i=D_(t[e].crc,i));return{opcodename:`opcodes-build${e.getBuildNr()}-${r}.json`,scriptname:`scripts-build${e.getBuildNr()}-${i}.json`}}async save(){
let{opcodename:e,scriptname:t}=await Kb.getSaveName(this.source),n=JSON.stringify(this.toJson()),r=JSON.stringify(this.getScriptJson());Ry.constants?(await Ry.mkdir("cache",{recursive:!0}),await Ry.writeFile(`cache/${e}`,n),
await Ry.writeFile(`cache/${t}`,r)):Nb?(await Nb(e,n),await Nb(t,r)):console.log("did not save cs2 callibration since there is no fs and no browser indexeddb")}constructor(e){this.mappings=new Map,this.decodedMappings=new Map,this.isNonObbedCache=!1,
this.candidatesLoaded=!1,this.foundEncodings=!1,this.foundParameters=!1,this.foundSubtypes=!1,this.opidcounter=1e4,this.dbtables=new Map,this.varmeta=new Map,this.varbitmeta=new Map,this.parammeta=new Map,this.scriptargs=new Map,
this.candidates=new Map,this.findOpcodeImmidiates=Jb,this.callibrateOperants=Zb,this.callibrateSubtypes=Cb,this.writeOpCode=(e,t)=>{if(!this.foundEncodings)throw new Error("clientscript deob not callibrated yet")
;if("object"!=typeof t||!t)throw new Error("opcode is expected to be an object");if(!("opcode"in t)||"number"!=typeof t.opcode)throw new Error("opcode prop expectec");if(!("imm"in t)||"number"!=typeof t.imm)throw new Error("imm prop expected")
;let n=this.getNamedOp(t.opcode);if(e.buffer.writeUint16BE(n.scrambledid,e.scan),e.scan+=2,"byte"==n.type)e.buffer.writeUint8(t.imm,e.scan),e.scan++;else if("int"==n.type)e.buffer.writeInt32BE(t.imm,e.scan),
e.scan+=4;else if("tribyte"==n.type)e.buffer.writeUIntBE(t.imm,e.scan,3),e.scan+=3;else{if("switch"!=n.type)throw new Error("op type write not implemented "+n.type);if(!("imm_obj"in t))throw new Error("imm_obj prop expected")
;if(e.buffer.writeUInt8(t.imm,e.scan),e.scan++,0==t.imm){if("number"!=typeof t.imm_obj)throw new Error("int expected");e.buffer.writeInt32BE(t.imm_obj,e.scan),e.scan+=4}else if(1==t.imm){
if(!Array.isArray(t.imm_obj)||2!=t.imm_obj.length||"number"!=typeof t.imm_obj[0]||"number"!=typeof t.imm_obj[1])throw new Error("array with 2 ints expected");e.buffer.writeUInt32BE(t.imm_obj[0],e.scan+0),e.buffer.writeUInt32BE(t.imm_obj[0],e.scan+4),
e.scan+=8}else{if(2!=t.imm)throw new Error("unknown switch imm type "+t.imm);if("string"!=typeof t.imm_obj)throw new Error("string expected");e.buffer.write(t.imm_obj,e.scan,"latin1"),e.scan+=t.imm_obj.length,e.buffer.writeUint8(0,e.scan),e.scan++}}
},this.readOpcode=e=>{if(!this.foundEncodings)throw new Error("clientscript deob not callibrated yet");let t=e.buffer.readUint16BE(e.scan);e.scan+=2;let n=this.mappings.get(t);n&&"unknown"!=n.type||(this.isNonObbedCache?(n=new jb(t,t,[Wb(t)]),
this.mappings.set(t,n),this.decodedMappings.set(t,n)):(n?(n.type="byte",n.possibleTypes=new Set(n.type)):n=this.declareOp(t,["byte"]),console.log(`op type not resolved: 0x${t.toString(16)} (opid:${n.id}), guessing imm type byte`)))
;let r=Xb(e.buffer,e.scan,n.type);if(!r)throw new Error("failed to read immidiate");e.scan=r.offset;let i=Wy(n.id);return{opcode:n.id,imm:r.imm,imm_obj:r.imm_obj,opname:i}},this.source=e}static async create(e,t=!1){if(!t)try{
let t,n,{opcodename:r,scriptname:i}=await this.getSaveName(e);if(Ry.constants?(t=await Ry.readFile(`cache/${r}`,"utf8"),n=await Ry.readFile(`cache/${i}`,"utf8").catch((()=>{}))):kb&&(t=await kb(r),n=await kb(i).catch((()=>{}))),t){
let r=JSON.parse(t),i=n?JSON.parse(n):null;return this.fromJson(e,r,i)}}catch{}let n=new Kb(e);return globalThis.deob=n,await n.preloadData(),await n.loadCandidates(),n}declareOp(e,t){let n=new jb(e,this.opidcounter++,t)
;if(this.mappings.has(e))throw new Error("op already exists");if(this.decodedMappings.has(n.id))throw new Error("allocated op id alerady exists");return this.mappings.set(e,n),this.decodedMappings.set(n.id,n),n}async preloadData(){let e=async e=>{
let t=await this.source.getArchiveById(xg.config,e);return{last:t.at(-1)?.fileid??0,vars:new Map(t.map((e=>[e.fileid,Vb.read(e.buffer,this.source)])))}},t=await this.source.getArchiveById(xg.config,Ag.dbtables)
;if(this.dbtables=new Map(t.map((e=>[e.fileid,Qg.dbtables.read(e.buffer,this.source)]))),this.source.getBuildNr()>900){this.varmeta=new Map(await Promise.all(Object.entries(Ny).map((async t=>{let n=await e(t[1].index);return[t[1].key,{name:t[0],
vars:n.vars,maxid:n.last}]}))));let t=await this.source.getArchiveById(xg.config,Ag.varbits);this.varbitmeta=new Map(t.map((e=>[e.fileid,Hb.read(e.buffer,this.source)]))),this.parammeta=await Db(this.source)}}async loadCandidates(e=0,t=16777215){
let n=await this.source.getCacheIndex(xg.clientscript);this.candidates.clear();let r=this.source;await wm(10,(function*(){for(let i of n)i&&(i.minor<e||i.minor>t||(yield r.getFile(i.major,i.minor,i.crc).then((e=>({id:i.minor,
scriptname:xb.get(n[i.minor].name)??"",solutioncount:0,buf:e,script:Qg.clientscriptdata.read(e,r),scriptcontents:null,argtype:null,returnType:null,unknowns:new Map,didmatch:!1})))))}),(e=>this.candidates.set(e.id,e))),this.candidatesLoaded=!0}
parseCandidateContents(){if(!this.candidatesLoaded)throw new Error("candidates not loaded");if(!this.foundEncodings)throw new Error("can't parse candidates because op encodings are not yet callibrated");for(let e of this.candidates.values()){try{
e.scriptcontents??(e.scriptcontents=Qg.clientscript.read(e.buf,this.source,{clientScriptDeob:this}))}catch(e){}e.scriptcontents&&(e.returnType=ex(this,e.scriptcontents.opcodedata),e.argtype=Qb(e.script),this.scriptargs.set(e.id,{
scriptname:e.scriptname,stack:new yb(e.argtype.getArglist(),e.returnType.toStackDiff().getArglist())}))}}generateDump(){let e=this.candidates,t=[];this.parseCandidateContents();for(let n of e.values())n.scriptcontents&&t.push({id:n.id,
scriptdata:n.script,scriptops:n.scriptcontents.opcodedata});return console.log(`dumped ${t.length} /${e.size} scripts`),{buildnr:this.source.getBuildNr(),scripts:t,decodedMappings:this.decodedMappings,opidcounter:this.opidcounter}}
async runAutoCallibrate(e){if(e.getBuildNr()<=668)this.setNonObbedMappings();else if(!this.foundEncodings){let e=await async function(){return Yb??(Yb=(async()=>{let e=await Kb.create(await Iy.fromId(1383)),t=await Kb.create(await Iy.fromId(1572))
;return e.setNonObbedMappings(),await t.runCallibrationFrom(e.generateDump()),t.generateDump()})()),Yb}();await this.runCallibrationFrom(e)}}async runCallibrationFrom(e){console.log(`callibrating buildnr ${this.source.getBuildNr()}`),function(e,t){
let n=e.candidates,r=e.source.getBuildNr();e.opidcounter=t.opidcounter;let i=(n,i)=>{if(n.script.instructioncount!=i.length)return!1;let a=new Map,s=0,o=n.script.opcodedata;for(let e=0;e<n.script.instructioncount;e++){
let n=t.decodedMappings.get(i[e].opcode);if(!n||"unknown"==n.type)return!1;let l=$b(i[e],t.buildnr,n.type);if(o.byteLength<s+2)return!1;let c=o.readUint16BE(s);s+=2;let u=Xb(o,s,l.immtype);if(!u)return!1;if(s=u.offset,!qb($b({opcode:l.opcode,
imm:u.imm,imm_obj:u.imm_obj},r,l.immtype),l))return!1;a.set(c,l)}if(s!=o.byteLength)return!1;n.didmatch=!0;for(let[t,n]of a){let r=new jb(t,n.opcode,[n.immtype]);e.mappings.set(t,r),e.decodedMappings.set(n.opcode,r)}return!0}
;for(let[e,r]of t.scripts.entries()){let e=n.get(r.id);e&&i(e,r.scriptops)}e.opidcounter=t.opidcounter,console.log(`copied ${e.mappings.size} opcodes from reference cache, idcount:${e.opidcounter}`)}(this,e),Jb(this),this.parseCandidateContents(),
Zb(this,this.candidates),Zb(this,this.candidates),Zb(this,this.candidates),Zb(this,this.candidates);try{Cb(this,this.candidates)}catch(e){console.log("subtype callibration failed, types info might not be accurate")}}setNonObbedMappings(){
this.foundEncodings=!0,this.isNonObbedCache=!0}getClientVarMeta(e){let t=e>>24&255,n=e>>8&65535,r=this.varmeta.get(t),i=r?.vars.get(n);if(!r||!i)return null;let a=i.type,s=Zy(a);return{name:r.name,varid:n,type:s,fulltype:a}}getNamedOp(e){
let t=this.decodedMappings.get(e);if(!t)throw new Error(`op with named id ${e} not found`);return t}}function Jb(e){let t=!1,n=!1;function*r(r,a,s,o){if(-1==o)return;if(r.opcodedata.length<a+2)return;let l=r.opcodedata.readUint16BE(a);if(0==l)return
;a+=2;let c=s;for(;c&&c.opid!=l;)c=c.parent;let u=e.mappings.get(l),h=c?[c.type]:u?[...u.possibleTypes]:Gb;for(let e of h){if("switch"==e&&t&&(!u||"unknown"==u.type))continue;if("tribyte"==e&&n&&(!u||"unknown"==u.type))continue
;let c=Xb(r.opcodedata,a,e);c&&(yield new i(r,l,c.offset,e,s,o))}}class i{constructor(e,t,n,r,i,a){this.children=[],this.script=e,this.opid=t,this.endoffset=n,this.type=r,this.parent=i,this.opsleft=a}}let a=[...e.candidates.values()]
;a.sort(((e,t)=>e.script.instructioncount-t.script.instructioncount||e.script.opcodedata.length-t.script.opcodedata.length));let s=(e,t)=>{let n=[],i=[],a=[],s=0;for(let i of t)n.push(...r(e.script,0,i,e.script.instructioncount-1));let o=!1
;for(;0!=n.length;){if(n.length>1e3){o=!0;break}let t;for(s+=n.length;t=n.pop();)0==t.opsleft&&t.endoffset==t.script.opcodedata.byteLength?a.push(t):i.push(...r(e.script,t.endoffset,t,t.opsleft-1))
;for(s+=i.length;t=i.pop();)0==t.opsleft&&t.endoffset==t.script.opcodedata.byteLength?a.push(t):n.push(...r(e.script,t.endoffset,t,t.opsleft-1))}return o?null:a},o=(t,n,r=10)=>{let i=0;if(n.length<=r){let r=n;for(t?.unknowns.clear();0!=r.length;){
let n=[],a=r[0].opid,s=new Set,o=!0;for(let e of r)e.opid==a?s.add(e.type):o=!1,e.parent&&n.push(e.parent),r=n;if(o){let n=e.mappings.get(a);n||(n=e.declareOp(a,Gb));for(let e of n.possibleTypes)s.has(e)||(n.possibleTypes.delete(e),i++)
;1==n.possibleTypes.size&&"unknown"==n.type&&(n.type=n.possibleTypes.values().next().value),"unknown"==n.type&&t&&t.unknowns.set(n.id,n)}}}return t&&(t.solutioncount=n.length),i};return(()=>{
for(let r of[10,10,10,20,30,40,50,100,1e10,1e10,1e10,1e10]){for(let i of a){if(1==i.solutioncount)continue;if(i.script.instructioncount>r)break;let a=0,l=0;for(let t of e.mappings.values())"switch"==t.type&&a++,"tribyte"==t.type&&l++
;if(t||1!=a||(t=!0,console.log("switch completed")),n||2!=l||(n=!0,console.log("tribyte completed")),a>1)throw new Error("");if(l>2)throw new Error("");let c=s(i,[null]);c&&o(i,c)}
let i=a.filter((e=>e.unknowns.size>=1)).sort(((e,t)=>e.unknowns.size-t.unknowns.size||tx(e.unknowns)-tx(t.unknowns))),l=()=>{if(h==u+1)return;let e=null;for(let t=u;t<h;t++){let n=i[t],r=s(n,e??[null]);if(!r)return;e=r}e&&o(null,e)},c=-1,u=-1,h=0
;for(;h<i.length;h++){let e=tx(i[h].unknowns);e!=c&&(l(),c=e,u=h)}l(),console.log(r,e.mappings.size)}})(),e.foundEncodings=!0,{test(e){let t=a.find((t=>t.id==e));s(t,[null])},getop:e=>a.filter((t=>t.unknowns.has(e))),candidates:a,runtheories:s,
evaluateSolution:o,testCascade(e){let t=[e];e:for(;;){let e=a.filter((e=>t.some((t=>e.unknowns.has(t)))));console.log(e);let n=null;for(let t of e)if(n=s(t,n??[null]),!n)return"too many states";console.log(n);let r=o(null,n,500);if(0!=r)return r
;for(let n of e)for(let e of n.unknowns.keys())if(!t.includes(e)){t.push(e);continue e}return"could not expand problem further"}}}}function Zb(e,t){let n=[];for(let r of t.values()){if(!r.scriptcontents)continue
;let{sections:t}=Ox(e,r.script,r.scriptcontents.opcodedata,r.id);n.push(...t)}n.sort(((e,t)=>e.children.length-t.children.length)),globalThis.allsections=n;let r=e=>{let{section:t,unknowns:n}=e,r=new _b,a=new gb;for(let e=0;e<t.children.length;e++){
let n=t.children[e];if(!(n instanceof Cx)||n.unknownstack)break;if(n.knownStackDiff)r.pop(n.knownStackDiff.in),r.push(n.knownStackDiff.out),a.popList(n.knownStackDiff.in),
null!=n.knownStackDiff.constout?a.pushOne(n.knownStackDiff.constout):a.pushList(n.knownStackDiff.out);else{let e=n.opinfo.stackinfo;if(e.initializedin){let t=r.tryPop(e.in);if(t>0){
if(e.initializedthrough&&0!=e.out.tryPopReverse(e.in,e.in.values.length-t))throw new Error("not compatible");e.in.values.splice(0,t)}a.popList(e.in)}else e.in=r.clone(),e.initializedin=!0;if(!e.initializedthrough||!e.initializedout)break
;r.push(e.out),a.pushList(e.out)}}let o=new _b;for(let e=0;e<t.children.length;e++){let n=t.children[t.children.length-1-e];if(!(n instanceof Cx)||n.unknownstack)break;if(n.knownStackDiff)o.pop(n.knownStackDiff.out),o.push(n.knownStackDiff.in);else{
let e=n.opinfo.stackinfo;if(e.initializedout){let t=o.tryPop(e.out);if(t>0){if(e.initializedthrough&&0!=e.in.tryPopReverse(e.out,e.out.values.length-t))throw new Error("not compatible");e.out.values.splice(0,t)}}else e.out=o.clone(),
e.initializedout=!0;if(!e.initializedthrough||!e.initializedin)break;o.push(e.in)}}let l=0,c=null,u=0,h=!1;n.clear();for(let e of t.children){if(!(e instanceof Cx)||e.unknownstack){h=!0;break}
e.knownStackDiff?u+=e.knownStackDiff.totalChange():e.opinfo.stackinfo.initializedthrough?u+=e.opinfo.stackinfo.totalChange():(c=e.opinfo,n.add(e.opinfo),l++)}if(!h&&!c&&0!=u)throw new Error("total stack doesn't add up to 0");if(!h&&c&&1==n.size){
if(0!=um(u,l))throw new Error("stack different is not evenly dividable between equal ops");let e=u/l+c.stackinfo.totalChange(),t=!0;e>0?t=c.stackinfo.out.tryShift(e):e<0&&(t=c.stackinfo.in.tryShift(-e)),t&&(c.stackinfo.initializedthrough=!0,
n.delete(c),s.add(c.id))}for(let t of n){let n=i.get(t.id);n||(n=new Set,n.add(e),i.set(t.id,n)),n.add(e)}},i=new Map,a=[],s=new Set;for(let e of n){let t={section:e,unknowns:new Set}
;for(let n of e.children)n instanceof Cx&&n.opinfo.stackChangeConstraints.add(t);r(t),a.push(t)}for(let t=0;t<3;t++){for(let e of a)r(e);let t=0,n=0,i=0,s=new Set
;for(let r of e.mappings.values())r.stackinfo.initializedthrough?i++:r.stackinfo.initializedin||r.stackinfo.initializedout?n++:s.add(r),t++;console.log("total",t,"done",i,"partial",n,"incomplete",s.size)}e.foundParameters=!0}function Qb(e){
let t=new bb;return t.int=e.intargcount,t.long=e.longargcount,t.string=e.stringargcount,t}function ex(e,t,n=t.length){let r=new _b;for(let i=n-2;i>=0;i--){let n=t[i],a=e.getNamedOp(n.opcode);if(a.id==Dy.pushconst)0==n.imm&&r.int(),1==n.imm&&r.long(),
2==n.imm&&r.string();else if(a.id==Dy.pushint)r.int();else if(a.id==Dy.pushlong)r.long();else{if(a.id!=Dy.pushstring)break;r.string()}}return r.values.reverse(),r}function tx(e){return e.keys().next().value}globalThis.getop=e=>{let t=-1
;if(e.startsWith("unk"))t=+e.slice(3);else for(let n in eb)eb[n]==e&&(t=+n);return globalThis.deob.decodedMappings.get(t)};const nx=65536;class rx{constructor(e){this.tempcounts=new bb,this.labels=new Map,this.namedLabels=new Map,
this.subfunctions=new Map,this.returntableLabel=null,this.returnsites=new Map,this.returnsiteidcounter=1,this.calli=e}makeReturnOp(){return this.returntableLabel||(this.returntableLabel=fb(Dy.jump,0),this.declareLabel(this.returntableLabel)),
mb(this.returntableLabel)}getSubfunctionLabel(e){return lm(this.namedLabels,e,(()=>{let e=fb(Dy.jump,0);return this.declareLabel(e),e}))}makeSubCallOps(e){let t=this.returnsiteidcounter++,n=[],r=this.getSubfunctionLabel(e)
;if(!r)throw new Error("subcall func does not exist");n.push(fb(Dy.pushconst,0,t)),n.push(mb(r));let i=fb(Dy.jump,0);return n.push(i),this.returnsites.set(t,i),this.declareLabel(i),n}declareLabel(e){this.labels.set(e,-1)}addSubfunction(e){
if(this.subfunctions.has(e.scriptname))throw new Error(`subfunction ${e.scriptname} already exists`);let t=this.getSubfunctionLabel(e.scriptname);this.subfunctions.set(e.scriptname,{label:t,func:e})}}function ix(e){
return[fb(Dy.pushconst,2,e),fb(Dy.popdiscardstring)]}const ax=new Map;function sx(e,t){return n=>{let r=[],i=[];n.tempcounts.int=Math.max(n.tempcounts.int,2),r.push(fb(Dy.poplocalint,nx+1));let a=r.length,s=fb(Dy.jump,0);n.declareLabel(s),
r.push(fb(Dy.pushconst,2,"no script matched")),r.push(fb(Dy.printmessage)),r.push(mb(s));for(let n=e;n<t;n++)i.push({value:n,jump:r.length-a}),r.push(fb(Dy.gosub,n)),r.push(mb(s));return r.push(s),n.tempcounts.int=Math.max(n.tempcounts.int,1),
r.splice(a,0,...lx(i,nx+0)),r.push(fb(Dy.pushlocalint,nx+1)),r.push(n.makeReturnOp()),r}}function ox(e,t,n){return r=>{let i=[],a=[],s=[];function o(e,n,i){let a=r.calli.varmeta.get(e)?.maxid??0;a=100*Math.ceil((a+200)/100),a=Math.min(a,n+i)
;for(let r=n;r<a;r++)s.push(e<<24|r<<8|t)}if(0==n)o(Ny.player.key,0,1e4);else if(1==n)o(Ny.client.key,0,1e4);else{if(2!=n)throw new Error("unexpected");for(let e of Object.values(Ny))e!=Ny.player&&e!=Ny.client&&o(e.key,0,1e4);o(Ny.player.key,1e4,1e4)
}r.tempcounts.int=Math.max(r.tempcounts.int,2),i.push(fb(Dy.poplocalint,nx+1));let l=i.length,c=fb(Dy.jump,0);r.declareLabel(c),i.push(fb(Dy.pushconst,2,"no var matched")),i.push(fb(Dy.printmessage)),i.push(mb(c));for(let t of s)a.push({value:t,
jump:i.length-l}),i.push(fb(e?Dy.popvar:Dy.pushvar,t)),i.push(mb(c));return i.push(c),r.tempcounts.int=Math.max(r.tempcounts.int,1),i.splice(l,0,...lx(a,nx+0)),i.push(fb(Dy.pushlocalint,nx+1)),i.push(r.makeReturnOp()),i}}function lx(e,t){
e.sort(((e,t)=>e.value-t.value));let n=[];n.push(fb(Dy.poplocalint,t));let r=(i,a)=>{let s=a-i;if(s<16){for(let r=0;r<s;r++){let a=e[i+r];n.push(fb(Dy.pushlocalint,t)),n.push(fb(Dy.pushconst,0,a.value)),n.push(fb(Dy.branch_eq,a.jump))}
n.push(fb(Dy.jump,0))}else{let o=i+Math.ceil(s/2),l=fb(Dy.branch_gteq,0);n.push(fb(Dy.pushlocalint,t)),n.push(fb(Dy.pushconst,0,e[o].value)),n.push(l);let c=n.length;r(i,o),l.imm=n.length-c,r(o,a)}};r(0,e.length);for(let e=0;e<n.length;e++){
let t=n[e];t.opcode!=Dy.branch_eq&&t.opcode!=Dy.jump||(t.imm+=n.length-e-1)}return n}function cx(e,t){let n=[],r=t.func.argtype.getStackdiff(),i=t.func.returntype.getStackdiff()
;e.tempcounts.int=Math.max(e.tempcounts.int,t.func.localCounts.int+1,i.int+1),e.tempcounts.long=Math.max(e.tempcounts.long,t.func.localCounts.long,i.long),e.tempcounts.string=Math.max(e.tempcounts.string,t.func.localCounts.string,i.string)
;let a=n.length,s=fb(Dy.pushconst,2,"");n.push(s);let o=n.length;n.push(t.label);let l=nx+t.func.localCounts.int;n.push(fb(Dy.poplocalint,l));for(let e=r.int-1;e>=0;e--)n.push(fb(Dy.poplocalint,nx+e))
;for(let e=r.long-1;e>=0;e--)n.push(fb(Dy.poplocallong,nx+e));for(let e=r.string-1;e>=0;e--)n.push(fb(Dy.poplocalstring,nx+e));let c=t.func.getOpcodes(e),u=fb(Dy.jump,0);e.declareLabel(u),c.forEach(((e,t)=>{
if(e.opcode==Dy.jump&&"object"==typeof e.imm_obj&&e.imm_obj&&"type"in e.imm_obj&&"jumplabel"==e.imm_obj.type)throw new Error("subcalls not allowed in rawstack subfunction");e.opcode==Dy.return&&(c[t]=mb(u)),ib.includes(e.opcode)&&(c[t]={...e,
imm:nx+e.imm})})),n.push(...ix(`subfunc ${t.func.scriptname} body`));let h=n.length;n.push(...c);let d=n.length;return n.push(u),n.push(...ix(`subfunc ${t.func.scriptname} footer`)),n.push(fb(Dy.pushlocalint,l)),n.push(e.makeReturnOp()),
n.push(...ix(`subfunc ${t.func.scriptname} end`)),s.imm_obj=`${hx("subfunc",o-a,n.length-a,r,i)} body=${h-a} foot=${d-a} rawstack=true`,n}function ux(e,t){
let n=[],r=t.func.argtype.getStackdiff(),i=t.func.returntype.getStackdiff(),a=t.func.localCounts.clone();e.tempcounts.int=Math.max(e.tempcounts.int,r.int+1,i.int+1),e.tempcounts.long=Math.max(e.tempcounts.long,r.long,i.long),
e.tempcounts.string=Math.max(e.tempcounts.string,r.string,i.string);let s=n.length,o=fb(Dy.pushconst,2,"");n.push(o);let l=n.length;n.push(t.label);let c=nx+Math.max(r.int,i.int);n.push(fb(Dy.poplocalint,c))
;for(let e=r.int-1;e>=0;e--)n.push(fb(Dy.poplocalint,nx+e));for(let e=r.long-1;e>=0;e--)n.push(fb(Dy.poplocallong,nx+e));for(let e=r.string-1;e>=0;e--)n.push(fb(Dy.poplocalstring,nx+e));for(let e=0;e<a.int;e++)n.push(fb(Dy.pushlocalint,e))
;for(let e=0;e<a.long;e++)n.push(fb(Dy.pushlocallong,e));for(let e=0;e<a.string;e++)n.push(fb(Dy.pushlocalstring,e));n.push(fb(Dy.pushlocalint,c));for(let e=0;e<r.int;e++)n.push(fb(Dy.pushlocalint,nx+e),fb(Dy.poplocalint,e))
;for(let e=0;e<r.long;e++)n.push(fb(Dy.pushlocallong,nx+e),fb(Dy.poplocallong,e));for(let e=0;e<r.string;e++)n.push(fb(Dy.pushlocalstring,nx+e),fb(Dy.poplocalstring,e));let u=t.func.getOpcodes(e),h=fb(Dy.jump,0);e.declareLabel(h),u.forEach(((e,t)=>{
e.opcode==Dy.return&&(u[t]=mb(h))})),n.push(...ix(`subfunc ${t.func.scriptname} body`));let d=n.length;n.push(...u);let p=n.length;n.push(h),n.push(...ix(`subfunc ${t.func.scriptname} footer`))
;for(let e=i.int-1;e>=0;e--)n.push(fb(Dy.poplocalint,nx+e));for(let e=i.long-1;e>=0;e--)n.push(fb(Dy.poplocallong,nx+e));for(let e=i.string-1;e>=0;e--)n.push(fb(Dy.poplocalstring,nx+e));n.push(fb(Dy.poplocalint,c))
;for(let e=a.int-1;e>=0;e--)n.push(fb(Dy.poplocalint,e));for(let e=a.long-1;e>=0;e--)n.push(fb(Dy.poplocallong,e));for(let e=a.string-1;e>=0;e--)n.push(fb(Dy.poplocalstring,e));for(let e=0;e<i.int;e++)n.push(fb(Dy.pushlocalint,nx+e))
;for(let e=0;e<i.long;e++)n.push(fb(Dy.pushlocallong,nx+e));for(let e=0;e<i.string;e++)n.push(fb(Dy.pushlocalstring,nx+e));return n.push(fb(Dy.pushlocalint,c)),n.push(e.makeReturnOp()),n.push(...ix(`subfunc ${t.func.scriptname} end`)),
o.imm_obj=`${hx("subfunc",l-s,n.length-s,r,i)} body=${d-s} foot=${p-s}`,n}function hx(e,t,n,r,i){return`type=${e} entry=${t} end=${n} in=${r.int},${r.long},${r.string} out=${i.int},${i.long},${i.string}`}function dx(e,t){
let n=new rx(e),r=[],i=t.getOpcodes(n),a=[];if(0!=n.subfunctions.size||0!=n.returnsites.size){let e=fb(Dy.jump,0);n.declareLabel(e),r.push(mb(e)),r.push(fb(Dy.pushconst,2,hx("returnjumps",1,6,new bb(1,0,0),new bb))),
r.push(n.makeReturnOp().imm_obj.value),r.push(fb(Dy.switch,0,{type:"switchvalues",value:a})),r.push(fb(Dy.pushconst,2,"unknown return address on stack (stack is corrupt)")),r.push(fb(Dy.printmessage)),r.push(fb(Dy.return))
;for(let e of n.namedLabels.keys()){let t=ax.get(e);if(t){let i=fb(Dy.pushconst,2),a=r.length;r.push(i),r.push(n.getSubfunctionLabel(e)),r.push(...t.write(n));let s=t.in.getStackdiff(),o=t.out.getStackdiff()
;i.imm_obj=`${hx("intrinsic",1,r.length-a,s,o)} name=${e}`}else{let t=n.subfunctions.get(e);if(!t)throw new Error(`func ${e} is not declared`);t.func.isRawStack?r.push(...cx(n,t)):r.push(...ux(n,t))}}r.push(e)}r.push(...i)
;let s=t.argtype.getStackdiff(),o=t.localCounts.clone().add(n.tempcounts),l={byte0:0,switchsize:-1,switches:[],longargcount:s.long,stringargcount:s.string,intargcount:s.int,locallongcount:o.long+n.tempcounts.long,
localstringcount:o.string+n.tempcounts.string,localintcount:o.int+n.tempcounts.int,instructioncount:r.length,opcodedata:r},c=n.labels;for(let e=0;e<r.length;e++){let t=r[e];void 0!==c.get(t)&&c.set(t,e)}for(let e=0;e<r.length;e++){let n=r[e]
;if("object"==typeof n.imm_obj&&n.imm_obj&&!Array.isArray(n.imm_obj)){if("switchvalues"==n.imm_obj.type)n.imm=l.switches.push(n.imm_obj.value)-1;else if("jumplabel"==n.imm_obj.type){let t=c.get(n.imm_obj.value)
;if("number"!=typeof t||-1==t)throw new Error("label not found");n.imm=t-(e+1)}n.imm_obj=null}ib.includes(n.opcode)&&n.imm&nx&&(n.opcode!=Dy.pushlocalint&&n.opcode!=Dy.poplocalint&&n.opcode!=Dy.popdiscardint||(n.imm=t.localCounts.int+(65535&n.imm)),
n.opcode!=Dy.pushlocallong&&n.opcode!=Dy.poplocallong&&n.opcode!=Dy.popdiscardlong||(n.imm=t.localCounts.long+(65535&n.imm)),
n.opcode!=Dy.pushlocalstring&&n.opcode!=Dy.poplocalstring&&n.opcode!=Dy.popdiscardstring||(n.imm=t.localCounts.string+(65535&n.imm)))}if(0!=n.returnsites.size){let e=c.get(n.makeReturnOp().imm_obj.value)
;if("number"!=typeof e)throw new Error("dynamicjump section not found");e+=2;for(let[t,r]of n.returnsites){let n=c.get(r);if(null==n)throw new Error("dynamicjump return address not found");a.push({jump:n-e,value:t})}}
if(l.switchsize=1+l.switches.reduce(((e,t)=>e+2+8*t.length),0),
l.switchsize>65535)throw new Error(`compiled script switch table size is larger than 65kb, this isn't supported by the binary format. This corresponds to a max of ~8k branches accross all switch statements, actual number: ${l.switches.reduce(((e,t)=>e+t.length),0)}`)
;if(l.opcodedata.length>65535)throw new Error(`compiled script is longer than max length of 0xffff, the Jagex VM will parse it incorrectly, actual length (${l.opcodedata.length})`);return l}function px(e,t){
return e&&1==e.children.length&&e.children[0]instanceof t?e.children[0]:null}function fx(e,t){return e instanceof Cx&&e.op.opcode==t}ax.set("varbittable",{in:new _b,out:new _b(["string"]),write(e){let t=[],n=","
;for(let[t,r]of e.calli.varbitmeta)n+=`${t}:${r.varid>>16}/${65535&r.varid}/${r.bits[0]}/${r.bits[1]},`;return t.push(fb(Dy.pushconst,2,n)),t.push(e.makeReturnOp()),t}}),ax.set("opnametoid",{in:new _b(["string"]),out:new _b(["int"]),write(e){let t=[]
;e.tempcounts.int=Math.max(e.tempcounts.int,1),e.tempcounts.string=Math.max(e.tempcounts.string,1),t.push(fb(Dy.poplocalint,nx+0)),t.push(fb(Dy.poplocalstring,nx+0));let n=fb(Dy.jump,0);e.declareLabel(n);for(let[r,i]of e.calli.decodedMappings){
let e=Wy(r).toLowerCase();t.push(fb(Dy.pushconst,2,e)),t.push(fb(Dy.pushlocalstring,nx+0)),t.push(fb(Dy.strcmp)),t.push(fb(Dy.pushconst,0,0)),t.push(fb(Dy.branch_eq,1)),t.push(fb(Dy.jump,2)),t.push(fb(Dy.pushconst,0,r)),t.push(mb(n))}
return t.push(fb(Dy.pushconst,2,"no opcode id found for : ")),t.push(fb(Dy.pushlocalstring,nx+0)),t.push(fb(Dy.joinstring,2)),t.push(fb(Dy.printmessage)),t.push(fb(Dy.pushconst,0,-1)),t.push(n),t.push(fb(Dy.pushlocalint,nx+0)),
t.push(e.makeReturnOp()),t}}),ax.set("call0",{in:new _b(["int"]),out:new _b,write:sx(0,1e4)}),ax.set("call1",{in:new _b(["int"]),out:new _b,write:sx(1e4,2e4)}),ax.set("getvar0",{in:new _b(["int"]),out:new _b,write:ox(!1,0,0)}),ax.set("getvar1",{
in:new _b(["int"]),out:new _b,write:ox(!1,0,1)}),ax.set("getvar2",{in:new _b(["int"]),out:new _b,write:ox(!1,0,2)}),ax.set("getvarother0",{in:new _b(["int"]),out:new _b,write:ox(!1,1,0)}),ax.set("getvarother1",{in:new _b(["int"]),out:new _b,
write:ox(!1,1,1)}),ax.set("getvarother2",{in:new _b(["int"]),out:new _b,write:ox(!1,1,2)}),ax.set("setvar0",{in:new _b(["int"]),out:new _b,write:ox(!0,0,0)}),ax.set("setvar1",{in:new _b(["int"]),out:new _b,write:ox(!0,0,1)}),ax.set("setvar2",{
in:new _b(["int"]),out:new _b,write:ox(!0,0,2)}),ax.set("op",{in:new _b(["int"]),out:new _b,write(e){let t=[];e.tempcounts.int=Math.max(e.tempcounts.int,1),t.push(fb(Dy.poplocalint,nx+0));let n={type:"switchvalues",value:[]},r=fb(Dy.switch,0,n)
;t.push(r);let i=t.length,a=fb(Dy.jump,0);e.declareLabel(a),t.push(fb(Dy.pushconst,2,"no opcodes matched")),t.push(fb(Dy.printmessage)),t.push(mb(a));for(let r of e.calli.decodedMappings.keys()){let e=+r
;hb.includes(e)||e!=Dy.switch&&e!=Dy.return&&e!=Dy.pushconst&&(n.value.push({value:e,jump:t.length-i}),t.push({opcode:e,imm:0,imm_obj:null}),t.push(mb(a)))}return t.push(a),t.push(fb(Dy.pushlocalint,nx+0)),t.push(e.makeReturnOp()),t}});class mx{
constructor(e){this.parent=null,this.knownStackDiff=null,this.children=[],this.originalindex=e}pushList(e){for(let t of e)t.parent!=this&&(t.parent=null,this.push(t))}push(e){if(e==this)throw new Error("tried to add self to ast children")
;e.parent?.remove(e),this.children.push(e),e.parent=this}clear(){this.children.forEach((e=>e.parent=null)),this.children.length=0}unshift(e){e.parent?.remove(e),this.children.unshift(e),e.parent=this}replaceChild(e,t){
if(t==this)throw new Error("tried to add self to ast children");t.parent?.remove(t);let n=this.children.indexOf(e);if(-1==n)throw new Error("tried to replace node that isn't a child");t.parent=this,e.parent=null,this.children[n]=t}remove(e){
let t=this.children.indexOf(e);if(-1==t)throw new Error("tried to remove node that isn't a child");this.children.splice(t,1),e.parent=null}}class gx extends mx{constructor(e,t,n,r){super(e),this.funcname=t;let i=n.clone();i.pushone("int"),
this.knownStackDiff=new yb(i,r)}getOpcodes(e){let t=this.children.slice(0,-1).flatMap((t=>t.getOpcodes(e)));return t.push(...e.makeSubCallOps(this.funcname)),t}}class _x extends mx{constructor(e,t){super(e),this.internalOps=[],this.type=t}
getOpcodes(e){if("stack"!=this.type&&0!=this.children.length)throw new Error("no children expected on composednode");return this.children.flatMap((t=>t.getOpcodes(e))).concat(this.internalOps.flatMap((t=>t.getOpcodes(e))))}}class vx extends mx{
constructor(){super(...arguments),this.varops=[],this.knownStackDiff=new yb(new _b,new _b)}getOpcodes(e){return this.children.flatMap((t=>t.getOpcodes(e))).concat(this.varops.flatMap((t=>t.getOpcodes(e))).reverse())}addVar(e){this.varops.unshift(e),
this.knownStackDiff.in.push(Rx(e))}}class yx extends mx{constructor(e,t,n,r){super(n),this.possibleSuccessors=[],this.firstPointer=null,this.lastPointer=null,this.branchEndNode=null,this.maxEndIndex=-1,this.knownStackDiff=new yb(new _b,new _b),
this.scriptid=e,this.subfuncid=t,r&&this.pushList(r)}addSuccessor(e){if(this.originalindex<e.originalindex&&(!e.firstPointer||this.originalindex<e.firstPointer.originalindex)&&(e.firstPointer=this),
this.originalindex>e.originalindex&&(!e.lastPointer||this.originalindex>e.lastPointer.originalindex)&&(e.lastPointer=this,e.maxEndIndex=this.originalindex),!e)throw new Error("added null successor");this.possibleSuccessors.push(e)}mergeBlock(e,t){
t?(this.pushList(e.children),e.children.length=0):this.push(e),this.possibleSuccessors=e.possibleSuccessors,this.branchEndNode=e.branchEndNode}findNext(){
if(!this.branchEndNode)if(0==this.possibleSuccessors.length)this.branchEndNode=null;else if(1==this.possibleSuccessors.length)this.possibleSuccessors[0].originalindex<this.originalindex?this.branchEndNode=null:this.branchEndNode=this.possibleSuccessors[0];else{
let e=this.possibleSuccessors.slice();for(;;){let t=null;for(let n of e)n&&(null==t||n.originalindex<t.originalindex)&&(t=n);if(!t){this.branchEndNode=null;break}if(e.every((e=>!e||e==t))){this.branchEndNode=t;break}e[e.indexOf(t)]=t.findNext()}}
return this.branchEndNode}getOpcodes(e){return this.children.flatMap((t=>t instanceof Nx?(e.addSubfunction(t),[]):t.getOpcodes(e)))}dump(){Fx(this)}}function bx(e,t,n,r){let i=t.at(-1),a=0;if(i&&i.opcode!=Dy.jump&&0==n){
let n=e.calli.getNamedOp(Dy.jump);t.push({opcode:n.id,imm:r-1,imm_obj:null}),a++}for(let e=0;e<t.length;e++){let i=t[e];if(hb.includes(i.opcode)){let s=e+1+i.imm;s>=t.length-a&&(s+=a),s==t.length+n&&(s=t.length+r),i.imm=s-e-1}}}class xx extends mx{
constructor(e,t){super(t),this.knownStackDiff=new yb(new _b(["int","int"]),new _b(["int"])),this.op=e}getOpcodes(e){if(this.op.opcode==Dy.shorting_or||this.op.opcode==Dy.shorting_and){if(2!=this.children.length)throw new Error("unexpected")
;let t=this.children[0].getOpcodes(e),n=this.children[1].getOpcodes(e);return this.op.opcode==Dy.shorting_or?bx(e,t,1,n.length+1):(bx(e,t,0,n.length),bx(e,t,1,0)),[...t,...n]}let t={opcode:this.op.opcode,imm:1,imm_obj:null}
;return this.children.flatMap((t=>t.getOpcodes(e))).concat(t)}}class Ex extends mx{constructor(e,t,n){super(e),this.knownStackDiff=new yb(new _b,new _b),this.statement=t,this.body=n,this.push(t),this.push(n)}static fromIfStatement(e,t){
if(t.falsebranch)throw new Error("cannot have else branch in loop");if(!t.parent)throw new Error("unexpected");return new Ex(e,t.statement,t.truebranch)}getOpcodes(e){
let t=this.statement.getOpcodes(e),n=this.body.getOpcodes(e),r=e.calli.getNamedOp(Dy.jump);return t.push({opcode:r.id,imm:n.length+1,imm_obj:null}),n.push({opcode:r.id,imm:-(n.length+1+t.length),imm_obj:null}),[...t,...n]}}class wx extends mx{
constructor(e,t){super(e),this.type=t}getOpcodes(e){throw new Error("break/continue statements failed to process. only break at end of switch case supported")}}class Sx extends mx{constructor(e,t,n,r){super(e),this.branches=[],
this.defaultbranch=null,this.knownStackDiff=new yb(new _b(["int"]),new _b),this.valueop=t,this.defaultbranch=n,this.branches=r,t&&this.push(t),this.pushList(r.map((e=>e.block))),n&&this.push(n)}static create(e,t,n,r){
let i=e.children[0]??null,a=[],s=t.switches[e.op.imm];if(!s)throw new Error("no matching cases in script");for(let t of s){let i=n.find((n=>n.originalindex==e.originalindex+1+t.jump));if(!i)throw new Error("switch case branch not found");if(a.push({
value:t.value,block:i}),i.maxEndIndex=r,i.originalindex!=e.originalindex+1+t.jump)throw new Error("switch branches don't match")}let o=n.find((t=>t.originalindex==e.originalindex+1))??null,l=px(o,Cx);if(o&&l&&l.opinfo.id==Dy.jump){
if(1!=o.possibleSuccessors.length)throw new Error("jump successor branch expected");o=o.possibleSuccessors[0],o.originalindex==r&&(o=null)}return o&&(o.maxEndIndex=r),new Sx(e.originalindex,i,o,a)}getOpcodes(e){let t=[]
;this.valueop&&t.push(...this.valueop.getOpcodes(e));let n=e.calli.getNamedOp(Dy.jump),r={opcode:e.calli.getNamedOp(Dy.switch).id,imm:-1,imm_obj:null},i={opcode:n.id,imm:-1,imm_obj:null};t.push(r);let a=t.length;t.push(i);let s=[],o={
type:"switchvalues",value:[]},l=null,c=0;for(let r=0;r<this.branches.length;r++){let i=this.branches[r];if(i.block!=l){if(l){let e={opcode:n.id,imm:-1,imm_obj:null};t.push(e),s.push(e)}l=i.block,c=t.length-a,o.value.push({value:i.value,jump:c}),
t.push(...i.block.getOpcodes(e))}else o.value.push({value:i.value,jump:c})}if(this.defaultbranch){if(l){let e={opcode:n.id,imm:-1,imm_obj:null};t.push(e),s.push(e)}i.imm=t.length-t.indexOf(i)-1,t.push(...this.defaultbranch.getOpcodes(e))
}else s.push(i);for(let e of s){let n=t.indexOf(e);e.imm=t.length-n-1}return r.imm_obj=o,t}}class Tx extends mx{constructor(e){super(e),this.knownStackDiff=new yb(new _b(["int"]),new _b)}setBranches(e,t,n,r){if(t==n)throw new Error("unexpected")
;this.ifEndIndex=r,this.statement=e,this.push(e),this.truebranch=t,t.maxEndIndex=this.ifEndIndex,this.falsebranch=n,n&&(n.maxEndIndex=this.ifEndIndex),n&&n.originalindex<t.originalindex&&this.push(n),this.push(t),
n&&n.originalindex>=t.originalindex&&this.push(n)}getOpcodes(e){let t=this.statement.getOpcodes(e),n=this.truebranch.getOpcodes(e),r=[];return this.falsebranch&&(r=this.falsebranch.getOpcodes(e),n.push({opcode:e.calli.getNamedOp(Dy.jump).id,
imm:r.length,imm_obj:null})),bx(e,t,0,1==n.length?2:n.length),bx(e,t,1,0),1==n.length&&bx(e,t,2,1),[...t,...n,...r]}}class Ax extends mx{constructor(e,t){super(e);let n=t.clone();n.values.unshift("int"),
this.knownStackDiff=new yb(n,new _b(["int","vararg"]))}getOpcodes(e){let t=this.children[0]?.knownStackDiff?.constout??-1;if("number"!=typeof t)throw new Error("unexpected");let n="";if(-1!=t){let r=e.calli.scriptargs.get(t)
;if(!r)throw new Error("unknown functionbind types");n=r.stack.in.toFunctionBindString()}let r=this.children.flatMap((t=>t.getOpcodes(e))).concat();return r.push({opcode:Dy.pushconst,imm:2,imm_obj:n}),r}}class Cx extends mx{constructor(e,t,n){
super(e),this.unknownstack=!1,this.op=t,this.opinfo=n}getOpcodes(e){let t=this.children.flatMap((t=>t.getOpcodes(e)));return t.push({...this.op}),t}}class Mx{constructor(e){this.cursorStack=[],this.stalled=!0,this.rootnode=e}current(){
return this.cursorStack.at(-1)??null}setFirstChild(e,t=!1){for(this.stalled=t,e!=this.cursorStack.at(-1)&&this.cursorStack.push(e);0!=e.children.length;)e=e.children[0],this.cursorStack.push(e);return this.cursorStack.at(-1)??null}remove(){
let e=this.current(),t=this.prev();if(!e)throw new Error("no node selected");if(!e.parent)throw new Error("cannot remove root node");return e.parent.remove(e),t}rebuildStack(){let e=this.current();this.cursorStack.length=0
;for(let t=e;t;t=t.parent)this.cursorStack.unshift(t)}replaceNode(e){let t=this.current();if(!t)throw new Error("no node selected");if(!t.parent)throw new Error("cannot replace root node");return t.parent.replaceChild(t,e),
this.cursorStack[this.cursorStack.length-1]=e,e}next(){if(this.stalled)return this.stalled=!1,0==this.cursorStack.length&&this.goToStart(),this.current();let e=this.cursorStack.at(-1),t=this.cursorStack.at(-2);if(!e)return null
;if(this.cursorStack.pop(),!t)return null;let n=t.children.indexOf(e);if(n==t.children.length-1)return t;let r=t.children[n+1];return this.setFirstChild(r)}prev(){if(this.stalled)return this.stalled=!1,this.current();let e=this.cursorStack.at(-1)
;if(!e)return null;if(0!=e.children.length){let t=e.children.at(-1);return this.cursorStack.push(t),t}for(;;){this.cursorStack.pop();let t=this.cursorStack.at(-1);if(!t||!e)return this.cursorStack.length=0,this.stalled=!0,null
;let n=t.children.indexOf(e);if(n>=1){let e=t.children[n-1];return this.cursorStack.push(e),e}e=t}}setNextNode(e){this.stalled=!0,this.cursorStack.length=0;for(let t=e;t;t=t.parent)this.cursorStack.unshift(t)}goToStart(){return this.stalled=!1,
this.cursorStack.length=0,this.setFirstChild(this.rootnode)}goToEnd(){return this.stalled=!1,this.cursorStack.length=0,null}}function Ix(e){
return e.knownStackDiff?e.knownStackDiff.out:e instanceof Cx&&e.opinfo.stackinfo?e.opinfo.stackinfo.out:(console.log("unknown stack out"),new _b)}function Rx(e){
return e.knownStackDiff?e.knownStackDiff.in:e instanceof Cx&&e.opinfo.stackinfo?e.opinfo.stackinfo.in:(console.log("unknown stack in"),new _b)}function kx(e){let t=new Mx(e);for(let t=0;t<e.children.length;t++){let n=e.children[t]
;fx(n,Dy.jump)&&0==n.op.imm&&(e.children.splice(t,1),t--)}for(let t=0;t<e.children.length-3;t++){let n=e.children[t-1],r=e.children[t],i=e.children[t+1],a=e.children[t+2],s=e.children[t+3],o=e.children[t+4]
;if(fx(r,Dy.pushlocalint)&&fx(i,Dy.pushconst)&&(fx(a,Dy.plus)||fx(a,Dy.minus))&&fx(s,Dy.poplocalint)&&r.op.imm==s.op.imm){let t=a.op.opcode==Dy.minus,l=fx(n,Dy.pushlocalint)&&n.op.imm==s.op.imm,c=!l&&fx(o,Dy.pushlocalint)&&o.op.imm==s.op.imm
;if(l||c){let c=new _x(s.originalindex,t?l?"x--":"--x":l?"x++":"++x");e.remove(r),e.remove(i),e.remove(a),e.replaceChild(s,c),c.internalOps.push(r),c.internalOps.push(i),c.internalOps.push(a),c.internalOps.push(s),l?(e.remove(n),
c.internalOps.unshift(n)):(e.remove(o),c.internalOps.push(o)),c.knownStackDiff=yb.fromExact([],[Ly.int])}}}let n=null
;for(let e=t.goToStart();e;e=t.next())if(e instanceof Cx&&(e.op.opcode==Dy.poplocalint||e.op.opcode==Dy.poplocallong||e.op.opcode==Dy.poplocalstring||e.op.opcode==Dy.popvar||e.op.opcode==Dy.popvarbit||e.op.opcode==Dy.popdiscardint||e.op.opcode==Dy.popdiscardlong||e.op.opcode==Dy.popdiscardstring)){
if(n&&n.parent!=e.parent)throw new Error("ast is expected to be flat at this stage");n?t.remove():(n=new vx(e.originalindex),t.replaceNode(n)),n.addVar(e)}else n=null;let r=e=>{if(!(e instanceof _x||e instanceof yx)){let t=Rx(e).clone()
;for(let n=e.children.length-1;n>=0;n--)t.pop(Ix(e.children[n]));for(;!t.isEmpty()&&0!=a.length;){let{stackel:n,stackconst:s}=a.at(-1),o=Ix(n);if(t.hasSimple(i)){if("string"!=typeof s)throw new Error("expected vararg string");let e;if(a.pop(),
1==o.values.length&&"vararg"==o.values[0]){if(!n.knownStackDiff)throw new Error("unexpected");e=new Ax(n.originalindex,n.knownStackDiff.in),e.pushList(n.children)}else{let t=a.at(-1)?.stackconst,r=Dx(s,t)
;if(!r)throw new Error("vararg const string expected");e=new Ax(n.originalindex,r)}r(e),n.parent.replaceChild(n,e),o=Ix(e),n=e}if(o.isEmpty()||0!=t.tryPop(o))break;e.unshift(n),a.pop()}t.isEmpty()||e.unshift(new _x(e.originalindex,"stack"))}
Ix(e).isEmpty()?(a.forEach((({stackel:e})=>{let t=new _x(e.originalindex,"stack");if(!e.parent)throw new Error("uncapped node without parent");e.parent.replaceChild(e,t),t.push(e)})),a.length=0):a.push({stackel:e,
stackconst:e.knownStackDiff?.constout??null})},i=new _b(["int","vararg"]),a=[];for(let e=t.goToStart();e;e=t.next())r(e);return e}class Nx extends mx{constructor(e,t,n,r){super(0),this.isRawStack=!1,this.scriptname=e,this.returntype=n,this.argtype=t,
this.localCounts=r,this.knownStackDiff=new yb(new _b,new _b)}getOpcodes(e){let t=this.children[0].getOpcodes(e);if(!this.returntype.isEmpty()||t.at(-1)?.opcode!=Dy.return){let e=this.returntype.clone(),n=e=>{
if("vararg"==e)throw new Error("unexpected");t.push({opcode:Dy.pushconst,imm:{int:0,long:1,string:2}[e],imm_obj:{int:0,long:[0,0],string:""}[e]})};for(;!e.isEmpty();){let t=e.values.pop();if(t instanceof bb){for(let e=0;e<t.int;e++)n("int")
;for(let e=0;e<t.long;e++)n("long");for(let e=0;e<t.string;e++)n("string");for(let e=0;e<t.vararg;e++)n("vararg")}else n(t)}t.push({opcode:Dy.return,imm:0,imm_obj:null})}return t}}function Dx(e,t){if("string"!=typeof e)return null
;let n=e.match(/^([ils]*)Y?$/);if(!n)return null;let r=new _b(n[1].split("").flatMap((e=>"i"==e?"int":"l"==e?"long":"s"==e?"string":null)));if(e.includes("Y")){
if("number"!=typeof t)throw new Error("parsing vararg array, but length type was not an int");for(let e=0;e<t;e++)r.int();r.int()}return r}function Lx(e,t,n){if(ab.includes(n.opinfo.id)){let e=jy.int++;n.knownStackDiff=yb.fromExact([e,e],[])
}else if(sb.includes(n.opinfo.id)){let e=jy.long++;n.knownStackDiff=yb.fromExact([e,e],[])}else if(n.opinfo.id==Dy.dbrow_getfield){let r=e?.values.at(-2);if("number"==typeof r){
let e=r>>12&65535,i=r>>4&255,a=15&r,s=t.dbtables.get(e),o=s?.unk01?.columndata.find((e=>e.id==i))??s?.unk02?.columndata.find((e=>e.id==i))
;o&&(n.knownStackDiff=yb.fromExact([Ly.dbrow,Ly.int,Ly.int],0!=a?[o.columns[a-1].type]:o.columns.map((e=>e.type))))}}else if(db.includes(n.opinfo.id)){let r=e?.values.at(-1);if("number"==typeof r){let e=t.parammeta.get(r);if(e){
let t=[e.type?e.type.vartype:0],r=new _b;n.opinfo.id!=Dy.cc_getparam&&r.pushone("int"),r.pushone("int"),n.knownStackDiff=new yb(r,new _b(t.map(Zy))),n.knownStackDiff.exactout=vb.fromList(t)}else console.log("unknown param "+r)}
}else if(n.opinfo.id==Dy.enum_getvalue){let t=e?.values.at(-3),r=e?.values.at(-4);"number"==typeof t&&"number"==typeof r&&(n.knownStackDiff=yb.fromExact([Ly.int,Ly.int,Ly.enum,r],[t]))}else if(n.opinfo.id==Dy.return){
if(!n.knownStackDiff)throw new Error("stackdiff or 'return' op should have been set at parser already")}else if(n.opinfo.id==Dy.gosub){let e=t.scriptargs.get(n.op.imm);n.knownStackDiff=e?e.stack:new yb
}else if(n.opinfo.id==Dy.joinstring)n.knownStackDiff=new yb(new _b(Array(n.op.imm).fill("string")),new _b(["string"]));else if(n.opinfo.id==Dy.pushvar||n.opinfo.id==Dy.popvar){let e=t.getClientVarMeta(n.op.imm);if(e){
let t=n.opinfo.id==Dy.popvar,r=[e.fulltype];n.knownStackDiff=yb.fromExact(t?r:[],t?[]:r)}}else if(n.opinfo.id==Dy.pushconst)if(0==n.op.imm){if("number"!=typeof n.op.imm_obj)throw new Error("unexpected");n.knownStackDiff=yb.fromExact([],[jy.int++]),
n.knownStackDiff.constout=n.op.imm_obj}else if(1==n.op.imm)n.knownStackDiff=yb.fromExact([],[jy.long++]),n.knownStackDiff.constout=n.op.imm_obj;else{if(2!=n.op.imm)throw new Error("unexpected");{let t=n.op.imm_obj
;n.knownStackDiff=yb.fromExact([],[jy.string++]),n.knownStackDiff.constout=n.op.imm_obj;let r=t.match(/^([ils]*)Y?$/);if(e&&r&&t.length>=3){let r=Dx(t,e.values.at(-1));if(!r)throw new Error("unexpected");n.knownStackDiff=new yb(r,new _b(["vararg"])),
n.knownStackDiff.constout=n.op.imm_obj,n.knownStackDiff.exactin=vb.fromList(r.toLooseSubtypes())}else r&&(n.unknownstack=!0)}}!n.knownStackDiff&&pb.includes(n.op.opcode)&&(n.unknownstack=!0)}function Ox(e,t,n,r){let i=(e,t)=>{
if(e>=n.length)throw new Error("tried to jump outside script");let i=l.find((t=>t.originalindex==e));return i||(i=new yx(r,t,e),l.push(i)),i},a=(r,a,s,o)=>{let h=i(r,o),d=s.localCounts;c.push(s);for(let t=r;t<a;t++){
let s=n[t],l=e.getNamedOp(s.opcode);if(hb.includes(l.id)){let e=t+1,n=e+s.imm;0!=s.imm&&n>=r&&n<a&&(i(e,o),i(n,o))}}for(let c=r;c<a;c++){let p=n[c],f=c+1;if(p.opcode!=Dy.poplocalint&&p.opcode!=Dy.pushlocalint||(d.int=Math.max(d.int,p.imm+1)),
p.opcode!=Dy.poplocallong&&p.opcode!=Dy.pushlocallong||(d.long=Math.max(d.long,p.imm+1)),p.opcode!=Dy.poplocalstring&&p.opcode!=Dy.pushlocalstring||(d.string=Math.max(d.string,p.imm+1)),p.opcode==Dy.jump){let t=c+1+p.imm;if(s&&t==a){
let t=new Cx(c,fb(Dy.return),e.getNamedOp(Dy.return));t.knownStackDiff=new yb(s.returntype,new _b),h.push(t),c!=n.length-1&&(h=i(f,o));continue}if(t<r||t>a){let e=u.find((e=>e.index==t));if(!e)throw new Error("couldn't find subcall function target")
;h.push(new gx(c,e.name,e.in,e.out));continue}}let m=e.getNamedOp(p.opcode),g=new Cx(c,p,m),_=l.find((e=>e.originalindex==c));if(_&&_!=h&&(h.addSuccessor(_),h=_),g.op.opcode==Dy.return&&(g.knownStackDiff=new yb(ex(e,n),new _b)),h.push(g),
hb.includes(m.id)){let e=f+p.imm;if(p.opcode==Dy.jump&&e==c+1);else{let t=i(f,o),n=i(e,o);m.id!=Dy.jump&&h.addSuccessor(t),h.addSuccessor(n),h=t}}else if(g.opinfo.id==Dy.return)c!=n.length-1&&(h=i(f,o));else if(g.opinfo.id==Dy.switch){
let e=t.switches[g.op.imm];if(!e)throw new Error("no matching cases in script");for(let t of e){let e=i(f+t.jump,o);h.possibleSuccessors.includes(e)||h.addSuccessor(e)}let n=i(f,o);h.addSuccessor(n),h=n}}
},s=new Nx(`script${-1==r?"_unk":r}`,new _b([Qb(t)]),ex(e,n),new bb),o=new yx(r,-1,0),l=[],c=[],u=[],h=0,d=0;if(n[d].opcode==Dy.jump){h=d+n[d].imm+1,d++;let t=0,s=[];for(;d<h;){let a=n[d]
;if(a.opcode!=Dy.pushconst||2!=a.imm||"string"!=typeof a.imm_obj)throw new Error("no header label text literal");let o={};for(let[,e,t]of a.imm_obj.matchAll(/(\S+)=(\S+)/g))o[e]=t
;let l=parseInt(o.end),c=parseInt(o.body),h=parseInt(o.foot),p=parseInt(o.entry),f="true"==o.rawstack,m=o.in?.match(/^\d+,\d+,\d+$/)?new bb(...o.in.split(",").map((e=>parseInt(e)))):new bb,g=o.out?.match(/^\d+,\d+,\d+$/)?new bb(...o.out.split(",").map((e=>parseInt(e)))):new bb
;if("returnjumps"==o.type);else if("subfunc"==o.type){if(isNaN(l)||isNaN(c)||isNaN(h)||isNaN(p))throw new Error("invalid subfunc header");let a=ex(e,n,d+h)
;if(!g.equals(a.getStackdiff()))throw new Error("detected subfunc return type not the same as declared return type");let o=t++,_=new Nx(`subfunc_${o}`,new _b([m]),a,new bb);_.isRawStack=f,_.originalindex=d+p,u.push({name:_.scriptname,
index:_.originalindex,in:_.argtype,out:_.returntype}),s.push([d+c,d+h,_,o]);let v=new yx(r,o,d+p);v.addSuccessor(i(d+c,o)),_.push(v)}else if("intrinsic"==o.type){let e=o.name;if("string"!=typeof e)throw new Error("intrinsic name not set")
;let t=ax.get(e);if(!t)throw new Error(`intrinsic ${e} was references in bytecode, but does not exists in the version of rsmv`);u.push({name:e,index:d+p,in:t.in,out:t.out})}else console.log(`unknown header type "${o.type}"`)
;if(isNaN(l))throw new Error("invalid subfunc header");d+=l}s.forEach((e=>a(...e))),o.pushList(c),o.push(new Cx(0,n[0],e.getNamedOp(n[0].opcode)))}return o.addSuccessor(i(h,-1)),s.push(o),c.push(s),a(h,n.length,s,-1),
l.sort(((e,t)=>e.originalindex-t.originalindex)),l.forEach((t=>function(e,t){let n=new gb,r=!1;for(let i of e){let e=i.knownStackDiff;if(i instanceof Cx)Lx(n,t,i),e??(e=i.knownStackDiff??i.opinfo.stackinfo),
r||(r=i.unknownstack);else if(i instanceof Nx);else if(!(i instanceof gx))throw new Error("unexpected");n&&(null!=i.knownStackDiff?.constout?n.pushOne(i.knownStackDiff.constout):e?.initializedthrough?n.applyInOut(e):n=null)}return r}(t.children,e))),
c.forEach((e=>{for(let t=e.children[0];t;t=t.findNext());})),{sections:l,rootfunc:s,subfuncs:c}}function Px(e,t,n=-1){let{sections:r,rootfunc:i}=Ox(e,t,t.opcodedata,n),a=new wb;return a.parseSections(r),a.addKnownFromCalli(e),a.solve(),r.forEach(kx),
function(e,t){let n=new Mx(e);e:for(let e=n.goToStart();e;e=n.next()){if(e instanceof Tx){let t=px(e.falsebranch,Tx);if(t&&t.truebranch==e.truebranch){let n=new xx({opcode:Dy.shorting_or,imm:0,imm_obj:null},e.statement.originalindex)
;n.push(e.statement),n.push(t.statement),e.setBranches(n,e.truebranch,t.falsebranch,t.ifEndIndex)}let n=px(e.truebranch,Tx);if(n&&n.falsebranch==e.falsebranch){let t=new xx({opcode:Dy.shorting_and,imm:0,imm_obj:null},e.statement.originalindex)
;t.push(e.statement),t.push(n.statement),e.setBranches(t,n.truebranch,n.falsebranch,e.ifEndIndex)}}if(e instanceof Cx&&ob.includes(e.opinfo.id)){let t=e.parent
;if(!(t instanceof yx)||2!=t.possibleSuccessors.length)throw new Error("if op parent is not compatible");if(t.children.at(-1)!=e)throw new Error("if op is not last op in codeblock")
;if(!t.branchEndNode)throw new Error("if statement parent end node expected");let r=t.possibleSuccessors[1],i=t.possibleSuccessors[0],a=i,s=px(i,Cx);if(s&&s.opinfo.id==Dy.jump){
if(1!=i.possibleSuccessors.length)throw new Error("jump successor branch expected");i=i.possibleSuccessors[0],i==t.branchEndNode&&(i=null)}if(r==t.branchEndNode&&(r=new yx(r.scriptid,r.subfuncid,r.originalindex)),
!(r instanceof yx))throw new Error("true branch isn't a codeblock");if(i&&!(i instanceof yx))throw new Error("false branch exists but is not a codeblock");if(r.lastPointer){let e=new yx(r.scriptid,r.subfuncid,r.originalindex);e.mergeBlock(r,!1),
e.maxEndIndex=r.maxEndIndex,r=e}if(i&&i.lastPointer){let e=new yx(i.scriptid,r.subfuncid,i.originalindex);e.mergeBlock(i,!1),e.maxEndIndex=i.maxEndIndex,i=e}let o=new xx(e.op,e.originalindex);o.pushList(e.children);let l=t?.parent
;if(t instanceof yx&&l instanceof Tx&&l.ifEndIndex==t.branchEndNode.originalindex){let n=l.truebranch==r,s=l.falsebranch==i||l.falsebranch==a,c=n&&l.falsebranch==t,u=s&&l.truebranch==t&&1==t.children.length;if(c||u){
for(t.remove(e);0!=t.children.length;)o.unshift(t.children[0]);let n=new xx({opcode:c?Dy.shorting_or:Dy.shorting_and,imm:0,imm_obj:null},l.originalindex);n.push(l.statement),n.push(o),l.setBranches(n,r,i,t.branchEndNode.originalindex);continue}}
let c=new Tx(o.originalindex);c.setBranches(o,r,i,t.branchEndNode.originalindex),n.replaceNode(c),n.setFirstChild(c,!0)}if(e instanceof Cx&&e.opinfo.id==Dy.switch){
if(!(e.parent instanceof yx&&e.parent.branchEndNode))throw new Error("code block expected");let r=Sx.create(e,t,e.parent.possibleSuccessors,e.parent.branchEndNode.originalindex);n.replaceNode(r),n.setFirstChild(r,!0)}
if(e instanceof Cx&&e.opinfo.id==Dy.jump){let t=e.originalindex+1+e.op.imm,r=e.parent;if(0==e.op.imm);else if(r instanceof yx&&r.maxEndIndex==t);else for(let r=e.parent;r;r=r.parent)if(r instanceof Tx){let e=r.parent
;if(!(e instanceof yx&&e.parent))throw new Error("unexpected");if(e.originalindex!=t)continue;if(e.children.at(-1)!=r)throw new Error("unexpected");for(let t=e.children.length-2;t>=0;t--)r.statement.unshift(e.children[t])
;let i=e.parent,a=Ex.fromIfStatement(e.originalindex,r);i.replaceChild(e,a),n.rebuildStack(),n.remove();continue e}n.remove()}else if(e instanceof yx&&e.branchEndNode&&(-1==e.maxEndIndex||e.branchEndNode.originalindex<e.maxEndIndex)){
let t=e.branchEndNode;n.prev(),t.lastPointer?e.mergeBlock(t,!1):e.mergeBlock(t,!0)}}}(i.children[0],t),{rootfunc:i,sections:r,typectx:a}}function Fx(e){let t=new Ux(globalThis.deob,new wb),n=""
;e instanceof yx&&(n+=`//[${e.scriptid},${e.originalindex}]\n`),n+=t.getCode(e),console.log(n)}globalThis.parseClientScriptIm=Px,globalThis.debugAst=Fx;class Ux{constructor(e,t){this.indents=[],this.declaredVars=[],this.compoffsets=new Map,
this.usecompoffset=!1,this.int32casts=!1,this.typescript=!0,this.calli=e,this.typectx=t}setCompOffsets(e){let t=new Mx(e);for(let e=t.goToStart();e;e=t.next()){if(!fx(e,Dy.pushconst))continue;if(!e.knownStackDiff?.exactout)continue
;let t=e.knownStackDiff.exactout.all();if(1!=t.length)throw new Error("unexpected");if("number"!=typeof this.typectx.knowntypes.get(t[0]))continue;if("number"!=typeof e.op.imm_obj)continue
;let n=e.op.imm_obj>>16,r=65535&e.op.imm_obj,i=lm(this.compoffsets,n,(()=>r));r<i&&this.compoffsets.set(n,r)}this.usecompoffset=!0}codeIndent(e=-1,t=!1){return"    ".repeat(this.indents.length)}pushIndent(e){this.indents.push(e),
e&&this.declaredVars.push(new Set)}popIndent(){let e=this.indents.pop();if(null==e)throw new Error("negative indent");e&&this.declaredVars.pop()}declareLocal(e){let t=this.declaredVars.at(-1);if(!t)throw new Error("no scope")
;return!!t.has(e)||(t.add(e),!1)}getCode(e){let t=jx.get(e.constructor);if(!t)throw new Error(`no writer defined for ${e.constructor.name} node`);return t(e,this)}}function Bx(e,t){
if(t.opcode==Dy.poplocalint||t.opcode==Dy.pushlocalint)return`int${t.imm}`;if(t.opcode==Dy.poplocalstring||t.opcode==Dy.pushlocalstring)return`string${t.imm}`;if(t.opcode==Dy.poplocallong||t.opcode==Dy.pushlocallong)return`long${t.imm}`
;if(t.opcode==Dy.popdiscardint||t.opcode==Dy.popdiscardlong||t.opcode==Dy.popdiscardstring)return"";if(t.opcode==Dy.popvar||t.opcode==Dy.pushvar){let n=e.getClientVarMeta(t.imm);return n?`var${n.name}_${n.varid}`:`varunk_${t.imm}`}
if(t.opcode==Dy.popvarbit||t.opcode==Dy.pushvarbit){let n=t.imm>>8,r=255&t.imm,i=e.varbitmeta.get(n);if("number"!=typeof i?.varid)return`varbitunk_${t.imm}`;{let t=e.varmeta.get(i.varid>>16);return`varbit${t?.name??"unk"}_${n}${0==r?"":`[${r}]`}`}}
return Wy(t.opcode)}function zx(e,t){return 1==t.length?e.getCode(t[0]):`[${t.map(e.getCode).join(", ")}]`}function Gx(e,t){return e.replace(/[`"'\\\n\r\t\b\f\x00-\x1F]|\$\{/g,(e=>{switch(e){case'"':return"double"==t?'\\"':'"';case"'":
return"single"==t?"\\'":"'";case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"${":return"template"==t?"\\${":"${";case"`":return"template"==t?"\\`":"`";default:
return`\\x${e.charCodeAt(0).toString(16).padStart(2,"0")}`}}))}function Vx(e,t,n){return`${t}(${n.map(e.getCode).join(", ")})`}function Hx(e,t,n,r){let i=lb.get(t.opcode)
;if(i)return 2==n.length?e.int32casts&&cb.has(t.opcode)?`(${e.getCode(n[0])} ${i} ${e.getCode(n[1])} | 0)`:`(${e.getCode(n[0])} ${i} ${e.getCode(n[1])})`:`operator("${i}", ${n.map(e.getCode).join(", ")})`
;if(t.opcode==Dy.return)return 0==n.length?"return":`return ${zx(e,n)}`;if(t.opcode==Dy.gosub)return Vx(e,`script${t.imm}`,n);let a="";return hb.includes(t.opcode)?a=`[${t.imm+r+1}]`:(t.opcode==Dy.gosub||0!=t.imm)&&(a=`[${t.imm}]`),
Vx(e,`${Bx(e.calli,t)}${a}`,n)}!function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);a>3&&s&&Object.defineProperty(t,n,s)}([Gm],Ux.prototype,"getCode",null)
;const jx=new Map;function Wx(e,t){jx.set(e,t)}function $x(e,t){let n,r=-1;const i=t[Symbol.iterator]();e:for(;;){const t=[];r+=1;const a=i.next(n);if(a.done)return a.value instanceof Error?{success:!1,remaining:e,failedOn:{iterationCount:r,
yielded:a.value}}:{success:!0,remaining:e,result:a.value};const s=a.value,o="string"!=typeof s&&s[Symbol.iterator]?s:[s];for(const r of o)if("string"==typeof r){let t=!1;const i=e.replace(r,((e,n)=>(t=0===n,"")));if(t){e=i,n=r;continue e}
}else if(r instanceof RegExp){if(!1===["^","$"].includes(r.source[0]))throw new Error(`Regex must be from start: ${r}`);const t=e.match(r);if(t){n=t,e=e.slice(t[0].length);continue e}}else if(r instanceof Function){const i=$x(e,r());if(i.success){
n=i.result,e=i.remaining;continue e}i.failedOn&&t.push(i.failedOn)}return{success:!1,remaining:e,failedOn:{iterationCount:r,yielded:s,nested:0===t.length?void 0:t}}}}function qx(e){return function*(){return""!==(yield[e,""])}}function*Xx(){
for(;""!==(yield[/^\/\/.*\n/,/^\/\*[\s\S]*?\*\//,/^\s+/,""]););}Wx(_x,((e,t)=>{if(["++x","--x","x++","x--"].includes(e.type)){if(0!=e.children.length)throw new Error("no children expected on composednode");let n=Bx(t.calli,e.internalOps[0].op)
;if(t.int32casts){if("++x"==e.type)return`(${n} = ${n} + 1 | 0)`;if("--x"==e.type)return`(${n} = ${n} - 1 | 0)`;if("x++"==e.type)return`(${n} = ${n} + 1 | 0, ${n} - 1 | 0)`;if("x--"==e.type)return`(${n} = ${n} - 1 | 0, ${n} + 1 | 0)`}else{
if("++x"==e.type)return`++${n}`;if("--x"==e.type)return`--${n}`;if("x++"==e.type)return`${n}++`;if("x--"==e.type)return`${n}--`}}if("stack"==e.type)return Vx(t,"stack",e.children);throw new Error("unknown composed op type")})),Wx(vx,((e,t)=>{let n=""
;if(!e.varops.every((e=>tb.includes(e.op.opcode)))){let r=!1,i=!1,a=[],s=[],o=[];for(let n of e.varops){let l=Bx(t.calli,n.op),c=-1;if(e.knownStackDiff?.exactin){let n=e.knownStackDiff.exactin.all();if(1!=n.length)throw new Error("unexpected")
;let r=t.typectx.knowntypes.get(n[0]);"number"==typeof r&&(c=r)}if(s.push(c),nb.includes(n.op.opcode)){let e=t.declareLocal(l);i||(i=!e),o.push(e)}else r=!0;a.push(l)}
if(i)if(r)for(let[e,r]of a.entries())o[e]||(n+=`var ${r}${t.typescript?":"+Xy(s[e]):""};`,n+=t.codeIndent());else n+="var ";1!=e.varops.length&&(n+="["),n+=`${a.join(", ")}`,1!=e.varops.length&&(n+="]"),n+=" = "}return n+=zx(t,e.children),n})),
Wx(yx,((e,t)=>{let n="";e.parent&&(n+="{\n",t.pushIndent(e.parent instanceof Nx));for(let r of e.children)n+=`${t.codeIndent(r.originalindex)}${t.getCode(r)};\n`
;return e.parent&&(e.parent instanceof Sx&&null!=e.branchEndNode&&(n+=`${t.codeIndent()}break;\n`),t.popIndent(),n+=`${t.codeIndent()}}`),n})),Wx(xx,((e,t)=>Hx(t,e.op,e.children,e.originalindex))),Wx(Ex,((e,t)=>{
let n=`while (${t.getCode(e.statement)}) `;return n+=t.getCode(e.body),n})),Wx(Sx,((e,t)=>{let n="";n+=`switch (${e.valueop?t.getCode(e.valueop):""}) {\n`,t.pushIndent(!1)
;for(let[r,i]of e.branches.entries())n+=`${t.codeIndent(i.block.originalindex)}case ${i.value}:`,r+1<e.branches.length&&e.branches[r+1].block==i.block||(n+=" "+t.getCode(i.block)),n+="\n";return e.defaultbranch&&(n+=`${t.codeIndent()}default: `,
n+=t.getCode(e.defaultbranch),n+="\n"),t.popIndent(),n+=`${t.codeIndent()}}`,n})),Wx(Tx,((e,t)=>{let n=`if (${t.getCode(e.statement)}) `;if(n+=t.getCode(e.truebranch),e.falsebranch){n+=" else ";let r=px(e.falsebranch,Tx)
;n+=r?t.getCode(r):t.getCode(e.falsebranch)}return n})),Wx(Cx,((e,t)=>{if(e.op.opcode==Dy.pushconst){let n=-1;if(e.knownStackDiff?.exactout){let r=e.knownStackDiff.exactout.all();if(1!=r.length)throw new Error("unexpected")
;let i=t.typectx.knowntypes.get(r[0]);"number"==typeof i&&(n=i)}let r=()=>t.typescript?-1==n||n==Ly.int||n==Ly.string||n==Ly.long||n==Ly.unknown_int||n==Ly.unknown_string||n==Ly.unknown_long?"":` as ${Xy(n)}`:""
;if("string"==typeof e.op.imm_obj)return`"${Gx(e.op.imm_obj,"double")}"${r()}`;if(Array.isArray(e.op.imm_obj))return`${$y(e.op.imm_obj)}n${r()}`;if("number"==typeof e.op.imm_obj){if(n==Ly.component){let n=e.op.imm_obj>>16,r=65535&e.op.imm_obj
;return t.usecompoffset&&t.compoffsets.has(n)?`comprel(${n},${r-t.compoffsets.get(n)})`:`comp(${n}, ${r})`}if(n==Ly.coordgrid&&-1!=e.op.imm_obj){let t=e.op.imm_obj;return`pos(${t>>28&3},${t>>20&255},${t>>6&255},${t>>12&63},${63&t})`}
return n==Ly.boolean?1==e.op.imm_obj?"true":"false":`${e.op.imm_obj}${r()}`}throw new Error("unexpected")}
if(e.op.opcode==Dy.pushlocalint||e.op.opcode==Dy.pushlocallong||e.op.opcode==Dy.pushlocalstring||e.op.opcode==Dy.pushvar||e.op.opcode==Dy.pushvarbit)return Bx(t.calli,e.op);if(e.op.opcode==Dy.joinstring){let n="`"
;for(let r of e.children)r instanceof Cx&&r.opinfo.id==Dy.pushconst&&"string"==typeof r.op.imm_obj?n+=Gx(r.op.imm_obj,"template"):n+=`\${${t.getCode(r)}}`;return n+="`",n}return Hx(t,e.op,e.children,e.originalindex)})),Wx(Nx,((e,t)=>{
let n=e.scriptname.match(/^script(\d+)$/),r=n?t.calli.scriptargs.get(+n[1]):null,i="";return i+=`//${r?.scriptname??"unknown name"}\n`,i+=`${t.codeIndent()}function ${e.scriptname}(${e.argtype.toTypeScriptVarlist(!0,t.typescript,r?.stack.exactin)})`,
t.typescript&&(i+=`: ${e.returntype.toTypeScriptReturnType(r?.stack.exactout)} `),i+=t.getCode(e.children[0]),i})),Wx(Ax,((e,t)=>{let n=e.children[0]?.knownStackDiff?.constout??-1
;return-1==n&&1==e.children.length?"callback()":`callback(script${n}${e.children.length>1?", ":""}${e.children.slice(1).map(t.getCode).join(", ")})`})),Wx(gx,((e,t)=>Vx(t,e.funcname,e.children.slice(0,-1))))
;const Yx=/$./,Kx="if,while,break,continue,else,switch,script,return,var".split(","),Jx="||,&&,>=,<=,==,!=,>,<".split(","),Zx=[...lb.values()].concat("");globalThis.prettyjson=Sv();class Qx{constructor(e,t){this.rootfuncname="",
this.vars=Object.create(null),this.scopefunctions=new Map,this.varcounts=new bb,this.deob=e,this.parent=t}getVarType(e){return Object.hasOwn(this.vars,e)?this.vars[e]:this.parent?this.parent.getVarType(e):null}declareVar(e,t){
if(Object.hasOwn(this.vars,e)){let n=this.vars[e];if(n.stacktype!=Zy(t))throw new Error(`tried to redeclare var ${e} with incompatible stack type (was: ${n.stacktype} new: ${Zy(t)})`)
;if(n.type!=t)if(n.type==Ly.unknown_int)n.type=t;else if(t==Ly.unknown_int);else if(n.type==Ly.unknown_int)n.type=t;else if(t==Ly.unknown_int);else if(n.type==Ly.unknown_int)n.type=t;else if(t!=Ly.unknown_int)throw new Error(`Tried to redeclare var ${e} with incompatible subtype (was: ${Xy(n.type)}, new: ${Xy(t)})`)
;return n}let n=Zy(t),r=this.varcounts.getSingle(n);return this.varcounts.setSingle(n,r+1),this.vars[e]={name:e,slot:r,stacktype:n,type:t}}declareFunction(e,t){this.parent||this.rootfuncname?this.scopefunctions.set(e,t):this.rootfuncname=t.scriptname
}getFunction(e){return this.scopefunctions.get(e)||(this.parent?this.parent.getFunction(e):null)}}function eE(e){let t=e.deob;function n(n,r=-1){let i=-1,a=!1,s=-1,o=-1,l=-1,c=n.match(/^(int|long|string|script|var(bit)?(\w+?)_)(\d+)$/);if(c){
if(c)if("script"==c[1])l=Ly.scriptref,i=+c[4];else if(c[3])if("bit"==c[2]){let e=0;i=+c[4]<<8|e,s=Dy.pushvarbit,o=Dy.popvarbit,l=Ly.unknown_int}else{let e=Ny[c[3]];if(!e)throw new Error("unknown var source");i=e.key<<24|+c[4]<<8
;let n=t.getClientVarMeta(i);if(!n)throw new Error("unknown clientvar "+i);s=Dy.pushvar,o=Dy.popvar,l=n.fulltype}else{if("int"!=c[1]&&"long"!=c[1]&&"string"!=c[1])throw new Error("unexpected");a=!0,r=Qy(c[1])}}else a=!0;if(a){let t=e.getVarType(n)
;if(!t){if(-1==r)throw new Error(`no known type while declaring var ${n}`);t=e.declareVar(n,r)}i=t.slot,l=t.type;let a=t.stacktype;-1==s&&"int"==a&&(s=Dy.pushlocalint),-1==s&&"long"==a&&(s=Dy.pushlocallong),-1==s&&"string"==a&&(s=Dy.pushlocalstring),
-1==o&&"int"==a&&(o=Dy.poplocalint),-1==o&&"long"==a&&(o=Dy.poplocallong),-1==o&&"string"==a&&(o=Dy.poplocalstring)}if(-1==l)throw new Error(`unkown var type for ${n}`);return{readopid:s,writeopid:o,vartype:l,varid:i,islocal:a}}function r(e,t){
let n=a(Dy.pushconst),r=new Cx(-1,{opcode:n.id,imm:2,imm_obj:e},n);return r.knownStackDiff=new yb(new _b([]),new _b(["string"])),r.knownStackDiff.constout=e,""!=t&&(r.knownStackDiff.exactout=new vb,r.knownStackDiff.exactout.string.push(Yy(t))),r}
function i(e,t){let n=a(Dy.pushconst),r=new Cx(-1,{opcode:n.id,imm:0,imm_obj:e},n);return r.knownStackDiff=new yb(new _b([]),new _b(["int"])),r.knownStackDiff.constout=e,""!=t&&(r.knownStackDiff.exactout=new vb,
r.knownStackDiff.exactout.int.push(Yy(t))),r}function a(e){return t.getNamedOp(e)}function*s(){let e=[];for(;;){let t=yield[p,""];if(!t)break;yield Xx;let n="";if((yield qx(":"))&&(yield Xx,[n]=yield/^\w+/),e.push({name:t,type:n}),yield Xx,
!(yield qx(",")))break;yield Xx}return e}function*o(){let e=yield[/^\w+/,"["];if("void"==e)return[];if("["!=e)return[e[0]];let t=[];for(;!(yield qx("]"));)yield Xx,t.push((yield/^\w+/)[0]),yield Xx,yield[",",/^(?=])/],yield Xx;return t}function*l(){
yield"`";let e=[],t="";for(;;){let n=yield["${","`",/^[\s\S]/];if("\\"==n){let e=(yield/^[\s\S]/)[0];t+="n"==e?"\n":"t"==e?"\t":"r"==e?"\r":"x"==e?String.fromCharCode(parseInt((yield/^[\da-fA-F]{2}/)[0],16)):e}else if("${"==n){""!=t&&e.push(r(t,"")),
t="",yield Xx;let n=yield T,i=Ix(n).getStackdiff();if(1!=i.total())throw new Error("string interpolation with more than on value at interpolant");if(1==i.string)e.push(n);else{
if(1!=i.int)throw new Error("string interpolation only supports strings or ints");{let t=new Cx(-1,fb(Dy.inttostring),a(Dy.inttostring)),r=new Cx(-1,fb(Dy.pushconst,0,10),a(Dy.pushconst));t.push(n),t.push(r),e.push(t)}}yield Xx,yield"}"}else{
if("`"==n){""!=t&&e.push(r(t,""));break}t+=n}}let n=a(Dy.joinstring),i=new Cx(-1,{opcode:n.id,imm:e.length,imm_obj:null},n);return i.knownStackDiff=new yb(new _b(new Array(e.length).fill("string")),new _b(["string"])),i.pushList(e),i}function*c(){
return(yield qx("as"))?(yield Xx,yield p):""}function*u(){yield'"';let e="";for(;!(yield qx('"'));){let t=yield["\\",/^[^"]/];if("\\"==t){let t=yield/^[\s\S]/
;e+="n"==t?"\n":"t"==t?"\t":"r"==t?"\r":"x"==t?String.fromCharCode(parseInt((yield/^[\da-fA-F]{2}/)[0],16)):t}else e+=t}return yield Xx,r(e,(yield c)||"string")}function*h(){let[e]=yield/^(-?\d+|0x[\da-fA-F]+)\b/;yield Xx;let t=yield c
;return i(0|parseInt(e),t||"int")}function*d(){let[e,t]=yield/^(-?\d+)n\b/,n=0xffffffffffffffffn&BigInt(t);return yield Xx,function(e,t){let n=a(Dy.pushconst),r=qy(e),i=new Cx(-1,{opcode:n.id,imm:1,imm_obj:r},n)
;return i.knownStackDiff=new yb(new _b([]),new _b(["long"])),i.knownStackDiff.constout=r,""!=t&&(i.knownStackDiff.exactout=new vb,i.knownStackDiff.exactout.long.push(Yy(t))),i}(n,(yield c)||"long")}function*p(){const[e]=yield/^[a-zA-Z$][\w$]*/
;return Kx.includes(e)&&(yield Yx),e}function*f(){let e=[];for(;e.push(yield T),yield Xx,yield qx(",");)yield Xx;return e}function*m(){let n,r=yield p,s=0;if(yield Xx,(yield qx("["))&&(s=parseInt(yield/^-?\d+/,10),yield Xx,yield"]",yield Xx),
yield"(",yield Xx,(yield qx(")"))?n=[]:(n=yield f,yield Xx,yield")"),"operator"==r){if(!fx(n[0],Dy.pushconst)||"string"!=typeof n[0].op.imm_obj)throw new Error("string literal expected as 1st argument on operator() call")
;let e=ub.get(n[0].op.imm_obj);if(!e)throw new Error(`unknown binary op '${n[0].op.imm_obj}'`);let t=a(e),r=new Cx(-1,{opcode:e,imm:0,imm_obj:null},t);return r.pushList(n.slice(1)),r}if("callback"==r){let e=new Ax(-1,new _b)
;return 0==n.length?e.push(i(-1,"int")):e.pushList(n),e}if("comprel"==r)throw new Error("cannot compile code that contains 'comprel' function, run decompiler withour comprel flag to get the correct code.");if("comp"==r){
if(2!=n.length||!fx(n[0],Dy.pushconst)||!fx(n[1],Dy.pushconst))throw new Error("raw opcode expected");if("number"!=typeof n[0].op.imm_obj||"number"!=typeof n[1].op.imm_obj)throw new Error("two int literals expected")
;return i(n[0].op.imm_obj<<16|n[1].op.imm_obj,"component")}if("pos"==r){if(5!=n.length)throw new Error("5 raw opcodes expected");if(!fx(n[0],Dy.pushconst)||"number"!=typeof n[0].op.imm_obj)throw new Error("5 int literals expected")
;if(!fx(n[1],Dy.pushconst)||"number"!=typeof n[1].op.imm_obj)throw new Error("5 int literals expected");if(!fx(n[2],Dy.pushconst)||"number"!=typeof n[2].op.imm_obj)throw new Error("5 int literals expected")
;if(!fx(n[3],Dy.pushconst)||"number"!=typeof n[3].op.imm_obj)throw new Error("5 int literals expected");if(!fx(n[4],Dy.pushconst)||"number"!=typeof n[4].op.imm_obj)throw new Error("5 int literals expected")
;return i(n[0].op.imm_obj<<28|n[1].op.imm_obj<<20|n[2].op.imm_obj<<6|n[3].op.imm_obj<<12|n[2].op.imm_obj,"coordgrid")}if("stack"==r){let e=new _x(-1,"stack");return e.pushList(n),e}let o=ax.get(r);if(o){let e=new gx(-1,r,o.in,o.out)
;return e.pushList(n),e.push(i(-1,"int")),e}let l=-1,c=r.match(/^(unk|script)(\d+)$/),u=e.getFunction(r);if(u){let e=new gx(-1,u.scriptname,u.argtype,u.returntype);return e.pushList(n),e.push(i(-1,"int")),e}if(c)"unk"==c[1]?l=+c[2]:(s=+c[2],
l=Dy.gosub);else for(let e in eb)r==eb[e]&&(l=+e);let h=new gb;for(let e of n)if(null!=e.knownStackDiff?.constout)h.pushOne(e.knownStackDiff.constout);else{let t=Ix(e);h.pushList(t)}let d=a(l),m=new Cx(-1,{opcode:l,imm:s,imm_obj:null},d)
;return Lx(h,t,m),m.pushList(n),m}function*g(){yield"return",yield Xx;let e=a(Dy.return),t=new Cx(-1,{opcode:e.id,imm:0,imm_obj:null},e);return t.pushList(yield A),t}function*_(){let t=yield[/^var\b/,""];yield Xx;let r=[],i=yield[p,"["]
;if("["==i)for(yield Xx;!(yield qx("]"));)0!=r.length&&(yield",",yield Xx),r.push(yield[p,""]),yield Xx;else r.push(i);yield Xx;let s=null;if(t&&":"==(yield[":",""])){if(yield Xx,s=yield o,
s.length!=r.length)throw new Error("var assign types of different length as var names");yield Xx}yield Xx,yield/^=(?!=)/,yield Xx;let l=yield A,c=new vx(-1),u=!1,h=new _b;for(let e of l)e instanceof _x&&"stack"==e.type?u=!0:h.push(Ix(e))
;if(!u&&h.total()!=r.length)throw new Error(`var assign output count does not match variable count, out=${h}, vars=${r.join(",")}`);for(let t=r.length-1;t>=0;t--){let i,o=r[t],l=""==o?null:e.getVarType(o)
;if(l)i=l.stacktype;else if(s)i=Zy(Yy(s[t]));else{if(u)throw new Error("can't infer var type when assigning from stack");let e=h.values.at(-1);if(e instanceof bb){let t=e.isMonoType()
;if("multi"==t)throw new Error(`ambiguous stack type order while assigning ${o}`);i=t}else{if(void 0===e)throw new Error(`input output count mismatch at while assigning ${o}`);if("vararg"==e)throw new Error("unexpected vararg");i=e}}
if(!u&&!h.tryPopSingle(i))throw new Error(`function output does not match variable type of ${o}, expected stack type ${i}`);if(""==o){let e="int"==i?Dy.popdiscardint:"long"==i?Dy.popdiscardlong:Dy.popdiscardstring;return new Cx(-1,fb(e),a(e))}{
let{writeopid:e,varid:t,vartype:r}=n(o,Qy(i));if(Zy(r)!=i)throw new Error(`type of value and target variable did not match for var ${o}:${Xy(r)}, ${Xy(Qy(i))}`);let s=a(e);c.varops.push(new Cx(-1,fb(e,t),s))}}return c.varops.reverse(),c.pushList(l),c
}function*v(){let e=0,t=yield["case","default"];return yield Xx,"case"==t&&(e=parseInt(yield/^-?\d+/,10),yield Xx),yield":",{type:t,value:e}}function*y(){yield"switch",yield Xx,yield"(",yield Xx;let e=yield T;yield Xx,yield")",yield Xx,yield"{",
yield Xx;let t=[],n=null;for(;!(yield qx("}"));){let e=[];for(;;){let t=yield[v,""];if(!t)break;yield Xx,e.push(t)}let r=yield[R],i=r.children.at(-1);i instanceof wx&&"break"==i.type&&r.remove(i),yield Xx
;for(let{type:i,value:a}of e)"case"==i?t.push({value:a,block:r}):n=r}return new Sx(-1,e,n,t)}function*b(){let e=yield["break","continue"];return yield Xx,new wx(-1,e)}function*x(){yield"if",yield Xx,yield"(",yield Xx;let e=yield T;yield Xx,yield")",
yield Xx;let t=yield R;yield Xx;let n=null;(yield qx("else"))&&(yield Xx,n=yield[x,R],n instanceof Tx&&(n=new yx(-1,-1,-1,[n])));let r=new Tx(-1);return r.setBranches(e,t,n,-1),r}function*E(){let e=yield["++","--",""];e&&(yield Xx);let t=yield p
;if("true"==t)return i(1,"boolean");if("false"==t)return i(0,"boolean");Kx.includes(t)&&(yield Yx),yield Xx;let{readopid:r,writeopid:s,vartype:o,varid:l}=n(t),c="";if(e||(c=yield["++","--",""]),o==Ly.scriptref)return i(l,"");let u=a(r);if(c||e){
let t=a(s),n=a("++"==c||"++"==e?Dy.plus:Dy.minus),r=new _x(-1,"--"==e?"--x":"++"==e?"++x":"--"==c?"x--":"x++");return r.knownStackDiff=yb.fromExact([],[Ly.int]),c&&r.internalOps.push(new Cx(-1,{opcode:u.id,imm:l,imm_obj:null},u)),
r.internalOps.push(new Cx(-1,{opcode:u.id,imm:l,imm_obj:null},u)),r.internalOps.push(i(1,"int")),r.internalOps.push(new Cx(-1,{opcode:n.id,imm:0,imm_obj:null},n)),r.internalOps.push(new Cx(-1,{opcode:t.id,imm:l,imm_obj:null},t)),
e&&r.internalOps.push(new Cx(-1,{opcode:u.id,imm:l,imm_obj:null},u)),r}{let e=new Cx(-1,{opcode:u.id,imm:l,imm_obj:null},u);return u.id==Dy.pushvar&&(e.knownStackDiff=yb.fromExact([],[o])),e}}function*w(){yield"(",yield Xx;let e=yield T
;return yield Xx,yield")",e}function*S(){yield"while",yield Xx,yield"(",yield Xx;let e=yield T;yield Xx,yield")",yield Xx;let t=yield R;return new Ex(-1,e,t)}function*T(){let t=yield[w,m,E,l,C];yield Xx;let n=yield Zx;if(""==n)return t;yield Xx
;let r,i=yield T,a=ub.get(n);if(!a)throw new Error("unexpected");return r=Jx.includes(n)?new xx({opcode:a,imm:0,imm_obj:null},-1):new Cx(-1,{opcode:a,imm:0,imm_obj:null},e.deob.getNamedOp(a)),r.children.push(t,i),r}function*A(){let e=yield[T,"[",""]
;if(e instanceof mx)return[e];if("["==e){yield Xx;let e=yield f;return yield Xx,yield"]",e}return[]}function*C(){return yield[h,u,d]}function*M(){return yield[k,x,S,y,g,b,_,T]}function*I(){let e=[];for(yield Xx;;){let t=yield[";",M,""];if(""==t)break
;if(";"!=t){let n=Ix(t);if(0!=n.total()){let r=new vx(-1);r.push(t);let i=n.toStackDiff();for(let e=0;e<i.int;e++)r.varops.push(new Cx(-1,fb(Dy.popdiscardint),a(Dy.popdiscardint)))
;for(let e=0;e<i.long;e++)r.varops.push(new Cx(-1,fb(Dy.popdiscardlong),a(Dy.popdiscardlong)));for(let e=0;e<i.string;e++)r.varops.push(new Cx(-1,fb(Dy.popdiscardstring),a(Dy.popdiscardstring)));e.push(r)}else e.push(t)}yield Xx}return e}
function*R(){yield"{";let e=yield I;if(!(yield["}",""]))throw new Error("closing bracket expected");return new yx(-1,-1,-1,e)}function*k(){yield Xx,yield"function",yield Xx;let t=yield p;yield Xx,yield"(",yield Xx;let n=yield s;yield Xx,yield")",
yield Xx,yield":",yield Xx;let r=yield o;yield Xx;let i=new Qx(e.deob,e);n.forEach((e=>i.declareVar(e.name,Yy(e.type))));let a=eE(i),l=new Nx(t,new _b(n.map((e=>Zy(Yy(e.type))))),new _b(r.map((e=>Zy(Yy(e))))),new bb);l.isRawStack=t.startsWith("$$"),
e.declareFunction(t,l);let c=yield a.codeBlock;l.localCounts=i.varcounts.clone();for(let e of i.scopefunctions.values())l.localCounts.max(e.localCounts);return l.push(c),l}return{functionStatement:k,codeBlock:R}}function tE(e,t){
return $x(t,eE(new Qx(e,null)).functionStatement())}function nE(e){let t="";t+="// Need to be defined for the typescript compiler\n",t+="interface Boolean { }\n",t+="interface Function { }\n",t+="interface Number { }\n",t+="interface Object { }\n",
t+="interface RegExp { }\n",t+="interface String { }\n",t+="interface IArguments { }\n",t+="interface BigInt { }\n",t+="interface Symbol { }\n",t+="interface Array<T> { [Symbol.iterator](): any; }\n",
t+="declare var Symbol: { readonly iterator: unique symbol };\n",t+="\n",t+="// Language constructs\n",t+="declare class BoundFunction { }\n",t+="declare function operator(op: string, ...values:any[]): any;\n",
t+="declare function callback(): BoundFunction;\n",t+="declare function callback<T extends (...args: any[]) => any>(fn: T, ...args: T extends (...args: (infer ARGS)[]) => any ? ARGS : never): BoundFunction;\n",
t+="declare function comp(interf: number, element: number): component;\n",t+="declare function comprel(interf: number, elementrel: number): component;\n",
t+="declare function pos(level: number, chunkx:number, chunkz:number, subx:number, subz:number): coordgrid;\n",t+="declare function stack(...args: any[]): any;\n",t+="\n",t+="// Compiler intrinsics\n"
;for(let[e,n]of ax)t+=`declare function ${e}(${n.in.toTypeScriptVarlist(!0,!0)}): ${n.out.toTypeScriptReturnType()};\n`;t+="\n",t+="// Clientscript types\n";for(let e of Object.values(Ly)){let n=Zy(e),r=Xy(e)
;"string"!=r&&"boolean"!=r&&(t+=`type ${r} = ${"int"==n?"number":"long"==n?"BigInt":"string"}\n`)}t+="\n",t+="// VM opcodes\n";for(let n of e.mappings.values()){let e=Wy(n.id)
;Kx.includes(e)||(n.id==Dy.enum_getvalue?t+=`declare function ${e}(int0: number, int1: number, int2: number, int3: number): any;\n`:n.id==Dy.dbrow_getfield?t+=`declare function ${e}(int0: number, int1: number, int2: number): any;\n`:!pb.includes(n.id)&&n.stackinfo.initializedthrough?t+=`declare function ${e}(${n.stackinfo.in.toTypeScriptVarlist(!0,!0,n.stackinfo.exactin)}): ${n.stackinfo.out.toTypeScriptReturnType(n.stackinfo.exactout)};\n`:t+=`declare function ${e}(...args: any[]): any;\n`)
}return t}async function rE(e){if(!e.decodeArgs.clientScriptDeob){let t=e,n=await Kb.create(t);e.decodeArgs.clientScriptDeob=n,await n.runAutoCallibrate(e),await n.save(),globalThis.deob=n}return e.decodeArgs.clientScriptDeob}
globalThis.testy=async(e="0-1999")=>{const t=n(6278)
;let r=await globalThis.cli(`extract -m clientscript -i ${e}`),i=[...r.extract.rootmemfsnode.files.entries()].filter((e=>e[0].startsWith("clientscript"))).map((e=>e[1].data.replace(/^\d+:/gm,(e=>" ".repeat(e.length))))),a=await globalThis.cli(`extract -m clientscriptops -i ${e}`),s=[...a.extract.rootmemfsnode.files.values()].filter((e=>!e.name.startsWith("."))),o=async(e,n,r=-1)=>{
const i=globalThis.deob;let a=tE(i,e);if(!a.success)return a;let s=dx(i,a.result),o=JSON.parse(n);delete o.$schema,s.opcodedata.forEach((e=>e.opname=Wy(e.opcode)));let l=globalThis.engine;await rE(l)
;let c=Qg.clientscript.write(s,l.getDecodeArgs()),u=Sv()(o.opcodedata),h=Sv()(o),d=Sv()(s);t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/binary.dat",c),t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/raw1.json",h),
t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/raw2.json",d),t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/json1.json",Sv()(o.opcodedata)),t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/json2.json",Sv()(s.opcodedata)),
t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/js1.ts",e);let{rootfunc:p,typectx:f}=Px(i,s,r),m=new Ux(i,f).getCode(p);return globalThis.cstest=p,t.writeFileSync("C:/Users/wilbe/tmp/clinetscript/js2.ts",m),{exact:h==d,exactts:e==m,roundtripped:s,
original:u}};return{subtest:e=>o(i[e],s[e].data,e),testinner:o,testknown:()=>{let e=t.readFileSync("C:/Users/wilbe/tmp/clinetscript/input.ts","utf8"),n=JSON.stringify({opcodedata:[]});return o(e,n)},codefiles:i,codefs:r,jsonfs:a,jsonfiles:s}},
n(8287).Buffer;class iE{constructor(e,t=null){this.intstack=[],this.longstack=[],this.stringstack=[],this.scopeStack=[],this.mockscripts=new Map,this.scope=null,this.activecompid=-1,this.clientcomps=[void 0,void 0],this.stalled=void 0,
this.uictx=null,this.calli=e,this.uictx=t}reset(){this.stalled&&console.log("resetting cs2 interpreter while an async op is running, everything is probably corrupt"),this.scopeStack.length=0,this.scope=null,this.intstack.length=0,
this.longstack.length=0,this.stringstack.length=0,this.activecompid=-1,this.clientcomps.fill(void 0)}popComponent(){return this.getComponent(this.popint())}getClientComp(e){let t=this.clientcomps[e];if(!t)throw new Error("clientcomp not set")
;return t}getComponent(e){(0|e)==cE&&(e=this.activecompid);let t=this.uictx?.comps.get(e);return t?t.api:new yE(null)}async callscriptid(e){let t=await this.calli.source.getFileById(xg.clientscript,e)
;this.callscript(Qg.clientscript.read(t,this.calli.source),e)}async runToEnd(){for(;;){let e=this.next();if(e instanceof Promise&&(e=await e),!e)break}}callscript(e,t){this.log(`calling script ${t}`),this.scope={scriptid:t,index:0,ops:e.opcodedata,
switches:e.switches,localints:new Array(e.localintcount).fill(0),locallongs:new Array(e.locallongcount).fill(0n),localstrings:new Array(e.localstringcount).fill("")};for(let t=e.intargcount-1;t>=0;t--)this.scope.localints[t]=this.popint()
;for(let t=e.longargcount-1;t>=0;t--)this.scope.locallongs[t]=this.poplong();for(let t=e.stringargcount-1;t>=0;t--)this.scope.localstrings[t]=this.popstring();this.scopeStack.push(this.scope)}log(e){
console.log(`CS2: ${"  ".repeat(this.scopeStack.length)} ${e}`)}pushStackdiff(e){if(0!=e.vararg)throw new Error("cannot push vararg");for(let t=0;t<e.int;t++)this.pushint(0);for(let t=0;t<e.long;t++)this.pushlong(0n)
;for(let t=0;t<e.string;t++)this.pushstring("")}popStacklist(e){for(let t=e.values.length-1;t>=0;t--){let n=e.values[t]
;if(n instanceof bb)this.popStackdiff(n);else if("int"==n)this.popint();else if("long"==n)this.poplong();else if("string"==n)this.popstring();else{if("vararg"!=n)throw new Error("unexpected");this.popvararg()}}}popvararg(){let e=this.popstring()
;for(let t=e.match(/Y/g)?.length??0;t>0;t--)for(let e=this.popint();e>0;e--)this.popint();for(let t=e.match(/i/g)?.length??0;t>0;t--)this.popint();for(let t=e.match(/l/g)?.length??0;t>0;t--)this.poplong()
;for(let t=e.match(/s/g)?.length??0;t>0;t--)this.popstring()}popStackdiff(e){if(0!=e.vararg)throw new Error("can't pop vararg since the order of pops is ambiguous");for(let t=0;t<e.int;t++)this.popint();for(let t=0;t<e.long;t++)this.poplong()
;for(let t=0;t<e.string;t++)this.popstring()}popdeep(e){if(this.intstack.length<e)throw new Error("tried to pop int while none are on stack at index "+((this.scope?.index??0)-1));return this.intstack.splice(this.intstack.length-1-e,1)[0]}
popdeeplong(e){if(this.longstack.length<e)throw new Error("tried to pop long while none are on stack at index "+((this.scope?.index??0)-1));return this.longstack.splice(this.longstack.length-1-e,1)[0]}popdeepstr(e){
if(this.stringstack.length<e)throw new Error("tried to pop string while none are on stack at index "+((this.scope?.index??0)-1));return this.stringstack.splice(this.stringstack.length-1-e,1)[0]}popint(){
if(0==this.intstack.length)throw new Error("tried to pop int while none are on stack at index "+((this.scope?.index??0)-1));return this.intstack.pop()}poplong(){
if(0==this.longstack.length)throw new Error("tried to pop long while none are on stack at index "+((this.scope?.index??0)-1));return this.longstack.pop()}popstring(){
if(0==this.stringstack.length)throw new Error("tried to pop string while none are on stack at index "+((this.scope?.index??0)-1));return this.stringstack.pop()}pushlist(e){
for(let t of e)if("number"==typeof t)this.pushint(t);else if("bigint"==typeof t)this.pushlong(t);else{if("string"!=typeof t)throw new Error("unexpected");this.pushstring(t)}}pushint(e){this.intstack.push(e)}pushlong(e){this.longstack.push(e)}
pushstring(e){this.stringstack.push(e)}next(){if(this.stalled)return this.stalled=this.stalled.then((e=>e&&this.next()));if(!this.scope)throw new Error("no script")
;if(this.scope.index<0||this.scope.index>=this.scope.ops.length)throw new Error("jumped out of bounds");let e,t=this.scope.ops[this.scope.index++],n=oE.get(t.opcode);if(!n)for(let[e,r]of Object.entries(ky))if(+e==t.opcode){n=lE.get(r);break}
if(t.opcode==Dy.return)return this.scopeStack.pop(),this.scope=this.scopeStack.at(-1)??null,!!this.scope;if(n)e=n(this,t);else{let e=this.calli.decodedMappings.get(t.opcode);if(!e)throw new Error(`Uknown op with opcode ${t.opcode}`)
;if(!e.stackinfo.initializedthrough)throw new Error(`Unknown params/returns for op ${t.opcode}`);this.popStacklist(e.stackinfo.in),this.pushStackdiff(e.stackinfo.out.toStackDiff())}
return!(e instanceof Promise)||(this.stalled=e.finally((()=>this.stalled=void 0)).then((e=>!0)).catch((e=>!1)),this.stalled)}dump(){let e="";if(e+="locals:\n",e+=`${this.scope?.localints.join(",")??"no scope"}\n`,
e+=`${this.scope?.locallongs.join(",")??"no scope"}\n`,e+=`${this.scope?.localstrings.map((e=>`"${e}"`)).join(",")??"no scope"}\n`,e+="stack:\n",e+=`${this.intstack.join(",")}\n`,e+=`${this.longstack.join(",")}\n`,
e+=`${this.stringstack.map((e=>`"${e}"`)).join(",")}\n`,this.scope){e+=`script stack ${this.scopeStack.map((e=>e.scriptid)).join(", ")}\n`;for(let t=-5;t<10;t++){let n=this.scope.index+t;if(n<0||n>=this.scope.ops.length)continue
;e+=`${n} ${n==this.scope.index?">>":"  "} `;let r=this.scope.ops[n];r?(this.calli.decodedMappings.get(r.opcode),e+=`${eb[r.opcode].padEnd(12," ").slice(0,12)} ${r.imm} ${r.imm_obj??""}\n`):e+="??\n"}}console.log(e)}}function aE(e,t){let n=!1
;if(t.opcode==Dy.branch_eq)n=e.popdeep(1)==e.popdeep(0);else if(t.opcode==Dy.branch_not)n=e.popdeep(1)!=e.popdeep(0);else if(t.opcode==Dy.branch_lt)n=e.popdeep(1)<e.popdeep(0);else if(t.opcode==Dy.branch_lteq)n=e.popdeep(1)<=e.popdeep(0);else if(t.opcode==Dy.branch_gt)n=e.popdeep(1)>e.popdeep(0);else{
if(t.opcode!=Dy.branch_gteq)throw new Error("unknown branch op (branch long not implemented)");n=e.popdeep(1)>=e.popdeep(0)}if(n){if(!e.scope)throw new Error("unexpected");e.scope.index+=t.imm}}function sE(e,t){
let n=e.popint(),r=e.calli.parammeta.get(n);if(!r)throw new Error(`unknown param ${n}`);{let n=r.type?r.type.vartype:0,i=(t.opcode==Dy.cc_getparam||e.popint(),Zy(n));"int"==i&&e.pushint(0),"long"==i&&e.pushlong(0n),"string"==i&&e.pushstring("")}}
const oE=new Map;ob.forEach((e=>oE.set(e,aE))),db.forEach((e=>oE.set(e,sE))),oE.set(Dy.gosub,((e,t)=>{let n=e.mockscripts.get(t.imm);if(!n)return e.callscriptid(t.imm);{let r=e.calli.scriptargs.get(t.imm)
;if(!r)throw new Error(`calling unknown clientscript ${t.imm}`);e.log(`CS2 - calling sub ${t.imm}${n?` with mocked return value: ${n}`:""}`),e.popStacklist(r.stack.in);for(let t of n)"number"==typeof t&&e.pushint(t),"bigint"==typeof t&&e.pushlong(t),
"string"==typeof t&&e.pushstring(t)}})),oE.set(Dy.enum_getvalue,(async e=>{let t=e.popint(),n=e.popint(),r=e.popint(),i=(e.popint(),Zy(r)),a=await Lb(e.calli.source,n);if("int"!=i)throw new Error("enum_getvalue can only look up int values")
;let s=Fb(a,t);e.pushint(s)})),oE.set(Dy.struct_getparam,(async e=>{let t=e.popint(),n=e.popint(),r=await Pb(e.calli.source,n).catch((e=>null)),i=Bb(e.calli.parammeta,r,t);e.pushint(i)})),oE.set(Dy.dbrow_getfield,(e=>{e.popint()
;let t=e.popint(),n=(e.popint(),t>>12&65535),r=t>>4&255,i=15&t,a=e.calli.dbtables.get(n),s=a?.unk01?.columndata.find((e=>e.id==r))??a?.unk02?.columndata.find((e=>e.id==r));if(!s)throw new Error(`couldn't find dbtable ${n}.${r}`)
;let o=0!=i?[s.columns[i-1].type]:s.columns.map((e=>e.type));e.pushStackdiff(new _b(o.map(Zy)).toStackDiff())})),oE.set(Dy.joinstring,((e,t)=>{e.pushstring(new Array(t.imm).fill("").map((t=>e.popstring())).reverse().join(""))})),
oE.set(Dy.pushconst,((e,t)=>{if(0==t.imm){if("number"!=typeof t.imm_obj)throw new Error("expected imm_obj to be number in pushconst int");e.pushint(t.imm_obj)}else if(1==t.imm){
if(!Array.isArray(t.imm_obj)||2!=t.imm_obj.length||"number"!=typeof t.imm_obj[0]||"number"!=typeof t.imm_obj[1])throw new Error("expected imm_obj to be [number,number] in pushconst long");e.pushlong($y(t.imm_obj))}else if(2==t.imm){
if("string"!=typeof t.imm_obj)throw new Error("expected imm_obj to be string in pushconst string");e.pushstring(t.imm_obj)}})),oE.set(Dy.switch,((e,t)=>{let n=e.scope.switches[t.imm]
;if(!n)throw new Error(`non-existant branches referenced switch at ${e.scope.index}`);let r=e.popint(),i=n.find((e=>e.value==r));i&&(e.scope.index+=i.jump)})),oE.set(Dy.jump,((e,t)=>{e.scope.index+=t.imm})),oE.set(Dy.pushlocalint,((e,t)=>{
if(t.imm>=e.scope.localints.length)throw new Error("invalid pushlocalint");e.pushint(e.scope.localints[t.imm])})),oE.set(Dy.pushlocallong,((e,t)=>{if(t.imm>=e.scope.locallongs.length)throw new Error("invalid pushlocallong")
;e.pushlong(e.scope.locallongs[t.imm])})),oE.set(Dy.pushlocalstring,((e,t)=>{if(t.imm>=e.scope.localstrings.length)throw new Error("invalid pushlocalstring");e.pushstring(e.scope.localstrings[t.imm])})),oE.set(Dy.poplocalint,((e,t)=>{
if(t.imm>=e.scope.localints.length)throw new Error("invalid poplocalint");e.scope.localints[t.imm]=e.popint()})),oE.set(Dy.poplocallong,((e,t)=>{if(t.imm>=e.scope.locallongs.length)throw new Error("invalid poplocallong")
;e.scope.locallongs[t.imm]=e.poplong()})),oE.set(Dy.poplocalstring,((e,t)=>{if(t.imm>=e.scope.localstrings.length)throw new Error("invalid poplocalstring");e.scope.localstrings[t.imm]=e.popstring()})),
oE.set(Dy.printmessage,(e=>e.log(`>> ${e.popstring()}`))),oE.set(Dy.inttostring,(e=>e.pushstring(e.popdeep(1).toString(e.popdeep(0))))),oE.set(Dy.strcmp,(e=>{let t=e.popstring(),n=e.popstring();e.pushint(n<t?-1:n>t?1:0)})),oE.set(Dy.pushvar,((e,t)=>{
let n=e.calli.getClientVarMeta(t.imm);if(!n)throw new Error(`unknown clientvar with id ${t.imm}`);e.pushStackdiff(new _b([n.type]).toStackDiff())})),oE.set(Dy.popvar,((e,t)=>{let n=e.calli.getClientVarMeta(t.imm)
;if(!n)throw new Error(`unknown clientvar with id ${t.imm}`);e.popStacklist(new _b([n.type]))}));const lE=new Map;lE.set("STRING_LENGTH",(e=>e.pushint(e.popstring().length))),
lE.set("SUBSTRING",(e=>e.pushstring(e.popstring().substring(e.popdeep(1),e.popdeep(0))))),lE.set("STRING_INDEXOF_STRING",(e=>e.pushint(e.popdeepstr(1).indexOf(e.popdeepstr(0),e.popint())))),
lE.set("STRING_INDEXOF_CHAR",(e=>e.pushint(e.popstring().indexOf(String.fromCharCode(e.popdeep(1)),e.popdeep(0))))),lE.set("MIN",(e=>e.pushint(Math.min(e.popint(),e.popint())))),lE.set("MAX",(e=>e.pushint(Math.max(e.popint(),e.popint())))),
lE.set("ADD",(e=>e.pushint(e.popint()+e.popint()|0))),lE.set("SUB",(e=>e.pushint(e.popdeep(1)-e.popint()|0))),lE.set("DIVIDE",(e=>e.pushint(e.popdeep(1)/e.popint()|0))),lE.set("MULTIPLY",(e=>e.pushint(Math.imul(e.popdeep(1),e.popint())))),
lE.set("AND",(e=>e.pushint(e.popint()&e.popint()))),lE.set("OR",(e=>e.pushint(e.popint()|e.popint()))),lE.set("LOWERCASE",(e=>e.pushstring(e.popstring().toLowerCase()))),lE.set("LONG_UNPACK",(e=>{let t=qy(e.poplong());e.pushint(t[0]|0),
e.pushint(t[1]|0)})),lE.set("MES_TYPED",(e=>e.log(`>> ${e.popint()} ${e.popint()} ${e.popstring()}`))),lE.set("LONG_ADD",(e=>e.pushlong(e.popdeeplong(1)+e.popdeeplong(0)))),lE.set("LONG_SUB",(e=>e.pushlong(e.popdeeplong(1)-e.popdeeplong(0)))),
lE.set("TOSTRING_LONG",(e=>e.pushstring(e.poplong().toString()))),lE.set("INT_TO_LONG",(e=>e.pushlong(BigInt(e.popint())))),lE.set("OPENURLRAW",(e=>e.log(`CS2 OPENURLRAW: ${e.popint()}, ${e.popstring()}`))),lE.set("ENUM_GETOUTPUTCOUNT",(async e=>{
let t=await Lb(e.calli.source,e.popint());e.pushint((t.intArrayValue1??t.intArrayValue2?.values??t.stringArrayValue1??t.stringArrayValue2?.values)?.length??0)})),lE.set("CC_CREATE",((e,t)=>{
e.clientcomps[t.imm]=e.getComponent(e.popdeep(2)).createChild(e.popint(),e.popint())})),lE.set("CC_FIND",((e,t)=>e.pushint(+!!(e.clientcomps[t.imm]=e.getComponent(e.popdeep(1)).findChild(e.popint()))))),lE.set("IF_GETLAYER",(e=>{e.popint(),
e.pushint(-1)})),lE.set("IF_GETPARENTLAYER",(e=>{e.popint(),e.pushint(-1)})),lE.set("IF_GETNEXTSUBID",(e=>e.pushint(e.popComponent().getNextChildId()))),lE.set("ACHIEVEMENT_FINDNEXT",(e=>e.pushint(-1))),
lE.set("IF_SETHIDE",(e=>e.popComponent().setHide(e.popint()))),lE.set("IF_GETHEIGHT",(e=>e.pushint(e.popComponent().getHeight()))),lE.set("IF_GETWIDTH",(e=>e.pushint(e.popComponent().getWidth()))),
lE.set("IF_GETX",(e=>e.pushint(e.popComponent().getX()))),lE.set("IF_GETY",(e=>e.pushint(e.popComponent().getY()))),lE.set("IF_SETOP",(e=>e.popComponent().setOp(e.popint(),e.popstring()))),
lE.set("IF_GETHIDE",(e=>e.pushint(e.popComponent().getHide()))),lE.set("IF_GETTEXT",(e=>e.pushstring(e.popComponent().getText()))),lE.set("IF_SETTEXT",(e=>e.popComponent().setText(e.popstring()))),
lE.set("IF_SETTEXTALIGN",(e=>e.popComponent().setTextAlign(e.popint(),e.popint(),e.popint()))),lE.set("IF_GETGRAPHIC",(e=>e.pushint(e.popComponent().getGraphic()))),lE.set("IF_GETHFLIP",(e=>e.pushint(+e.popComponent().getHFlip()))),
lE.set("IF_GETVFLIP",(e=>e.pushint(+e.popComponent().getVFlip()))),lE.set("IF_SETGRAPHIC",(e=>e.popComponent().setGraphic(e.popint()))),lE.set("IF_SETHFLIP",(e=>e.popComponent().setHFlip(!!e.popint()))),
lE.set("IF_SETVFLIP",(e=>e.popComponent().setVFlip(!!e.popint()))),lE.set("IF_SETMODEL",(e=>e.popComponent().setModel(e.popint()))),lE.set("IF_GETTRANS",(e=>e.pushint(e.popComponent().getTrans()))),
lE.set("IF_GETCOLOUR",(e=>e.pushint(e.popComponent().getColor()))),lE.set("IF_GETFILLED",(e=>e.pushint(e.popComponent().getFilled()))),lE.set("IF_SETTRANS",(e=>e.popComponent().setTrans(e.popint()))),
lE.set("IF_SETCOLOUR",(e=>e.popComponent().setColor(e.popint()))),lE.set("IF_SETFill",(e=>e.popComponent().setFilled(e.popint()))),lE.set("IF_SETSIZE",(e=>e.popComponent().setSize(e.popdeep(3),e.popdeep(2),e.popdeep(1),e.popdeep(0)))),
lE.set("IF_SETPOSITION",(e=>e.popComponent().setPosition(e.popdeep(3),e.popdeep(2),e.popdeep(1),e.popdeep(0)))),lE.set("IF_SETTILING",(e=>e.popComponent().setTiling(e.popint()))),lE.set("IF_GETTILING",(e=>e.pushint(e.popComponent().getTiling()))),
lE.set("CC_SETHIDE",((e,t)=>e.getClientComp(t.imm).setHide(e.popint()))),lE.set("CC_GETHEIGHT",((e,t)=>e.pushint(e.getClientComp(t.imm).getHeight()))),lE.set("CC_GETWIDTH",((e,t)=>e.pushint(e.getClientComp(t.imm).getWidth()))),
lE.set("CC_GETX",((e,t)=>e.pushint(e.getClientComp(t.imm).getX()))),lE.set("CC_GETY",((e,t)=>e.pushint(e.getClientComp(t.imm).getY()))),lE.set("CC_SETOP",((e,t)=>e.getClientComp(t.imm).setOp(e.popint(),e.popstring()))),
lE.set("CC_GETHIDE",((e,t)=>e.pushint(e.getClientComp(t.imm).getHide()))),lE.set("CC_GETTEXT",((e,t)=>e.pushstring(e.getClientComp(t.imm).getText()))),lE.set("CC_SETTEXT",((e,t)=>e.getClientComp(t.imm).setText(e.popstring()))),
lE.set("CC_SETTEXTALIGN",((e,t)=>e.getClientComp(t.imm).setTextAlign(e.popint(),e.popint(),e.popint()))),lE.set("CC_GETGRAPHIC",((e,t)=>e.pushint(e.getClientComp(t.imm).getGraphic()))),
lE.set("CC_GETHFLIP",((e,t)=>e.pushint(+e.getClientComp(t.imm).getHFlip()))),lE.set("CC_GETVFLIP",((e,t)=>e.pushint(+e.getClientComp(t.imm).getVFlip()))),lE.set("CC_SETGRAPHIC",((e,t)=>e.getClientComp(t.imm).setGraphic(e.popint()))),
lE.set("CC_SETHFLIP",((e,t)=>e.getClientComp(t.imm).setHFlip(!!e.popint()))),lE.set("CC_SETVFLIP",((e,t)=>e.getClientComp(t.imm).setVFlip(!!e.popint()))),lE.set("CC_SETMODEL",((e,t)=>e.getClientComp(t.imm).setModel(e.popint()))),
lE.set("CC_GETTRANS",((e,t)=>e.pushint(e.getClientComp(t.imm).getTrans()))),lE.set("CC_GETCOLOUR",((e,t)=>e.pushint(e.getClientComp(t.imm).getColor()))),lE.set("CC_GETFILLED",((e,t)=>e.pushint(e.getClientComp(t.imm).getFilled()))),
lE.set("CC_SETTRANS",((e,t)=>e.getClientComp(t.imm).setTrans(e.popint()))),lE.set("CC_SETCOLOUR",((e,t)=>e.getClientComp(t.imm).setColor(e.popint()))),lE.set("CC_SETFill",((e,t)=>e.getClientComp(t.imm).setFilled(e.popint()))),
lE.set("CC_SETSIZE",((e,t)=>e.getClientComp(t.imm).setSize(e.popdeep(3),e.popdeep(2),e.popdeep(1),e.popdeep(0)))),lE.set("CC_SETPOSITION",((e,t)=>e.getClientComp(t.imm).setPosition(e.popdeep(3),e.popdeep(2),e.popdeep(1),e.popdeep(0)))),
lE.set("CC_SETTILING",((e,t)=>e.getClientComp(t.imm).setTiling(e.popint()))),lE.set("CC_GETTILING",((e,t)=>e.pushint(e.getClientComp(t.imm).getTiling())));const cE=-2147483645;class uE extends xm{constructor(e){super(),this.sceneCache=null,
this.renderer=null,this.comps=new Map,this.highlightstack=[],this.interpreterprom=null,this.touchedComps=new Set,this.runOnloadScripts=!1,this.source=e}toggleHighLightComp(e,t){let n=this.comps.get(e)?.element
;n&&(t?(0!=this.highlightstack.length&&this.highlightstack.at(-1).classList.remove("rs-component--highlight"),n.classList.add("rs-component--highlight"),this.highlightstack.push(n)):(n.classList.remove("rs-component--highlight"),
this.highlightstack.pop()!=n&&console.log("wrong unlightlight order"),0!=this.highlightstack.length&&this.highlightstack.at(-1).classList.add("rs-component--highlight")))}async runClientScriptCallback(e,t){if(0==t.length)return
;let n=await(this.interpreterprom??(this.interpreterprom=rE(this.source).then((e=>new iE(e,this)))));if("number"!=typeof t[0])throw new Error("expected callback script id but got string");n.reset(),n.pushlist(t.slice(1)),n.activecompid=e,
await n.callscriptid(t[0]),await n.runToEnd(),this.updateInvalidatedComps()}updateInvalidatedComps(){this.touchedComps.forEach((e=>e.updateDom())),this.touchedComps.clear()}}function hE(){let e="";return e+="html{color:white;font-size:12px;}\n",
e+=".rs-component{position:absolute;pointer-events:none;}\n",e+=".rs-component--highlight{outline:1px solid red;}\n",e+=".rs-image{width:100%;height:100%;}\n",e+=".rs-image--cover{background-size:100% 100%; background-repeat:no-repeat;}",
e+=".rs-interface-container{position:absolute;top:0px;left:0px;right:0px;bottom:0px;display:flex;align-items:center;justify-content:center;}",e+=".rs-interface-container-sub{position:relative;outline:1px solid green;}",
e+=".rs-model{position:absolute;top:0px;left:0px;width:100%;height:100%;}",e+=".rs-componentmeta{}",e+=".rs-componentmeta--active{outline:1px solid red;}",e+=".rs-componentmeta-children{padding-left:15px;}",
"html{color:white;font-size:12px;}\n.rs-component{position:absolute;pointer-events:none;}\n.rs-component--highlight{outline:1px solid red;}\n.rs-image{width:100%;height:100%;}\n.rs-image--cover{background-size:100% 100%; background-repeat:no-repeat;}.rs-interface-container{position:absolute;top:0px;left:0px;right:0px;bottom:0px;display:flex;align-items:center;justify-content:center;}.rs-interface-container-sub{position:relative;outline:1px solid green;}.rs-model{position:absolute;top:0px;left:0px;width:100%;height:100%;}.rs-componentmeta{}.rs-componentmeta--active{outline:1px solid red;}.rs-componentmeta-children{padding-left:15px;}"
}function dE(e){let t=t=>e[t];return{getcomp:t,click:e=>{console.log(t(+e.target.dataset.compid)),e.stopPropagation()}}}async function pE(e,t){let n=await e.source.getArchiveById(xg.interfaces,t),r=new Map;for(let i of n)try{let n=t<<16|i.fileid
;if(e.comps.has(n))throw new Error("ui render context already had comp with same id");let a=new vE(e,Qg.interfaces.read(i.buffer,e.source),n);r.set(i.fileid,a),e.comps.set(n,a)}catch(e){console.log(`failed to parse interface ${t}:${i.fileid}`)}
for(let[e,t]of r)if(65535!=t.data.parentid){let e=r.get(t.data.parentid);if(!e){console.log("missing parent");continue}e.children.push(t)}let i=[];for(let e of r.values())65535!=e.data.parentid&&r.has(e.data.parentid)||i.push(e);return{comps:r,
rootcomps:i,basewidth:520,baseheight:340,id:t}}async function fE(e,t){let{comps:n,rootcomps:r,basewidth:i,baseheight:a}=await pE(e,t),s="";for(let t of r)s+=await t.toHtml(e);let o="<!DOCTYPE html>\n";return o+="<html>\n",o+="<head>\n",
o+="<style>\n",o+=hE(),o+="</style>\n",o+="<script>\n",o+=`var mod=(${dE+""})(${JSON.stringify(Object.fromEntries([...n].map((e=>[e[0],e[1].data]))))});\n`,o+="<\/script>\n",o+="</head>\n",o+="<body>\n",o+='<div class="rs-interface-container">\n',
o+=`<div style="width:${i}px; height:${a}px;">\n`,o+=s,o+="</div>\n",o+="</div>\n",o+="</body>\n",o+="</html>\n",o}function mE(e){return`#${(16777215&e).toString(16).padStart(6,"0")}`}function gE(e){let t=""
;return(e.hflip||e.vflip)&&(t+=`scale:${e.hflip?-1:1} ${e.vflip?-1:1};`),0!=e.rotation&&(t+=`rotate:${(-e.rotation/65536*360).toFixed(2)}deg;`),!!(16777215&~e.color)&&(t+=`background-color:${mE(e.color)};background-blend-mode:multiply;`),t}
async function _E(e,t){let n="none",r=16777215&t;if(16777215!=r){let i=t>>24;0!=i&&console.log("sprite flags",i);let a=K_(J_(await e.source.getFileById(xg.sprites,r))[0]);n=`url('${await Dm(a)}')`}return{imgcss:n,spriteid:t}}class vE{
constructor(e,t,n){this.parent=null,this.children=[],this.clientChildren=[],this.modelrenderer=null,this.spriteChild=null,this.textChild=null,this.loadingSprite=-1,this.element=null,this.ctx=e,this.data=t,this.compid=n,this.api=new yE(this)}
isCompType(e){return!("container"==e&&!this.data.containerdata||"model"==e&&!this.data.modeldata||"sprite"==e&&!this.data.spritedata||"text"==e&&!this.data.textdata||"figure"==e&&!this.data.figuredata)}async toHtml(e){
let{style:t,title:n}=this.getStyle(),r="";for(let t of this.children)r+=await t.toHtml(e);if(this.data.textdata&&(r+=dm(this.data.textdata.text)),this.data.modeldata&&(t+="background:rgba(0,255,0,0.5);outline:blue;",
r+=32767==this.data.modeldata.modelid||65535==this.data.modeldata.modelid?"placeholder":this.data.modeldata.modelid),this.data.spritedata){let t=gE(this.data.spritedata);t+=`background-image:${(await _E(e,this.data.spritedata.spriteid)).imgcss};`,
r+=`<div class="rs-image${this.data.spritedata.tiling?"":" rs-image--cover"}" style="${hm(t)}"></div>`}let i="";return i+=`<div class="rs-component" data-compid=${this.compid} style="${hm(t)}" onclick="mod.click(event)" title="${hm(n)}">\n`,i+=r,
i+="</div>\n",i}dispose(){this.ctx.comps.delete(this.compid),this.modelrenderer?.dispose(),this.element?.remove(),this.children.forEach((e=>e.dispose())),this.clientChildren.forEach((e=>e.dispose()))}initDom(){
return this.element??(this.element=document.createElement("div")),this.updateDom(),this.children.forEach((e=>{this.element.appendChild(e.initDom())})),this.clientChildren.forEach((e=>{this.element.appendChild(e.initDom())})),
this.element.classList.add("rs-component"),this.element.ui=this.data,this.element.compid=this.compid,this.element}updateDom(){if(!this.element)throw new Error("element not set");let{style:e,title:t}=this.getStyle();if(this.data.modeldata){
let t=32767==this.data.modeldata.modelid||65535==this.data.modeldata.modelid;!t&&this.ctx.renderer&&this.ctx.sceneCache?(this.modelrenderer??(this.modelrenderer=function(e,t,n){let r={rotx:n.rotate_x,roty:n.rotate_y,rotz:n.rotate_z,
translatex:n.translate_x/4,translatey:n.translate_y/4,zoom:8*n.zoom},i=document.createElement("canvas");i.classList.add("rs-model");let a=e.makeUIRenderer(),s=null,o=()=>{let e=i.clientWidth,t=i.clientHeight;if(0==e||0==t)return
;let n=a.takePicture(e,t,r);i.width=n.width,i.height=n.height,i.getContext("2d").putImageData(n,0,0),c&&!l&&requestAnimationFrame(o)},l=0,c=!1,u=new ResizeObserver(o);return u.observe(i),i.render=o,{dispose:()=>{cancelAnimationFrame(l),l=0,
u.disconnect(),a.dispose(),i.remove()},canvas:i,setmodel:e=>{s=new hy(t,[{modelid:e,mods:{}}],`model_${e}`),a.setmodel(s.getSceneElements(),0),s.model.then(o)},setanim:e=>{32767!=e&&65535!=e||(e=-1),s?.setAnimation(e),c=-1!=e,o()}}
}(this.ctx.renderer,this.ctx.sceneCache,this.data.modeldata.positiondata)),this.modelrenderer.setmodel(this.data.modeldata.modelid),this.modelrenderer.setanim(this.data.modeldata.animid),
this.element.appendChild(this.modelrenderer.canvas)):this.modelrenderer&&(this.modelrenderer.dispose(),this.modelrenderer=null,e+="background:rgba(0,255,0,0.5);outline:blue;",this.element.innerText=t?"placeholder":"")}
this.data.textdata?(this.textChild||(this.textChild=document.createElement("span"),this.element.appendChild(this.textChild)),this.textChild.innerHTML=dm(this.data.textdata.text)):this.textChild&&(this.textChild.remove(),this.textChild=null),
this.data.spritedata?this.loadingSprite!=this.data.spritedata.spriteid&&(this.spriteChild||(this.spriteChild=document.createElement("div"),this.element.appendChild(this.spriteChild),this.spriteChild.classList.add("rs-image")),
this.spriteChild.style.cssText=gE(this.data.spritedata),this.spriteChild.classList.toggle("rs-image--cover",!this.data.spritedata.tiling),_E(this.ctx,this.data.spritedata.spriteid).then((({imgcss:e,spriteid:t})=>{
this.spriteChild&&t==this.data.spritedata?.spriteid&&(this.spriteChild.style.backgroundImage=e)})),this.loadingSprite=this.data.spritedata.spriteid):this.spriteChild&&(this.spriteChild.remove(),this.spriteChild=null),this.element.style.cssText=e,
this.element.title=t}getStyle(){let e="";e+=function(e){let t="";const n="0px";let r=n,i=n;return 0==e.aspectxtype?t+=`left:${e.baseposx}px;`:1==e.aspectxtype?(t+=`left:50%;margin-left:${e.baseposx}px;`,
r="-50%"):2==e.aspectxtype?t+=`right:${e.baseposx}px;`:3==e.aspectxtype?t+=`left:${100*e.baseposx/16384}%;`:4==e.aspectxtype?(t+=`left:${50+100*e.baseposx/16384}%;`,r="-50%"):5==e.aspectxtype&&(t+=`right:${100*e.baseposx/16384}%;`),
0==e.aspectytype?t+=`top:${e.baseposy}px;`:1==e.aspectytype?(t+=`top:50%;margin-top:${e.baseposy}px;`,
i="-50%"):2==e.aspectytype?t+=`bottom:${e.baseposy}px;`:3==e.aspectytype?t+=`top:${100*e.baseposy/16384};`:4==e.aspectytype?(t+=`top:${50+100*e.baseposy/16384}%;`,i="-50%"):5==e.aspectytype&&(t+=`bottom:${100*e.baseposy/16384}%;`),
r==n&&i==n||(t+=`translate:${r} ${i};`),t}(this.data),e+=function(e){let t=""
;return 0==e.aspectwidthtype?t+=`width:${e.basewidth}px;`:1==e.aspectwidthtype?t+=`width:calc(100% - ${e.basewidth}px);`:2==e.aspectwidthtype&&(t+=`width:${100*e.basewidth/16384}%;`),
0==e.aspectheighttype?t+=`height:${e.baseheight}px;`:1==e.aspectheighttype?t+=`height:calc(100% - ${e.baseheight}px);`:2==e.aspectheighttype&&(t+=`height:${100*e.baseheight/16384}%;`),t}(this.data);let t=!1
;return this.data.figuredata?this.data.figuredata.filled?(e+=`background:${mE(this.data.figuredata.color)};`,t=!0):e+=`border:1px solid ${mE(this.data.figuredata.color)};`:this.data.textdata?(t=!0,e+="display:flex;",
e+=`color:${mE(this.data.textdata.color)};`,1==this.data.textdata.alignhor?(e+="justify-content:center;",e+="text-align:center;"):this.data.textdata.alignhor&&(e+="justify-content:right;",e+="text-align:right;"),
1==this.data.textdata.alignver?e+="align-items:center;":this.data.textdata.alignver&&(e+="align-items:bottom;"),t=!0):this.data.containerdata||this.data.spritedata||(this.data.modeldata||(e+="background:rgba(0,128,128,0.5);outline:red;"),t=!0),
t&&(e+="pointer-events:initial;"),{title:this.data.rightclickopts.filter((e=>e)).join("\n"),style:e}}}class yE{constructor(e){this.data=e?.data??null,this.comp=e}changed(){this.comp?.ctx.touchedComps.add(this.comp)}findChild(e){
return-2147483643==e?this:this.comp?.clientChildren.find((t=>t.compid==e))?.api}getNextChildId(){return this.comp?this.comp.clientChildren.reduce(((e,t)=>Math.max(e,t.compid)),-1)+1:0}createChild(e,t){let n,r={type:t,aspectxtype:0,aspectytype:0,
aspectwidthtype:0,aspectheighttype:0,basewidth:0,baseheight:0,baseposx:0,baseposy:0,bit4data:0,containerdata:null,spritedata:null,modeldata:null,figuredata:null,textdata:null,linedata:null,contenttype:-1,cursor:-1,hidden:0,menucounts:0,name:null,
name2:"",optmask:0,optmask1data_bit40:null,parentid:this.comp?.compid??-1,rightclickcursors:[],rightclickopts:[],scripts:{},unkdata:null,unk10data:null,unk11data:null,unk12data:null,unk15data:null,unk16data:null,unk2:0,unk3:[],unk4:0,unk5:0,unk6:0,
unkdatadata:null,unkffff:null,unkpre3:null,unkprepre3:null,unkstring1:null,unkstuff123:"",version:7};if(0==t?r.containerdata={layerwidth:0,layerheight:0,disablehover:null,layerheightextra:null,v6unk1:null,v6unk2:null}:3==t?r.figuredata={color:0,
filled:0,trans:0}:4==t?r.textdata={alignhor:0,alignver:0,color:0,fontid:0,multiline:null,shadow:!1,text:"",trans:0,unk1:0,unk2:0}:5==t?r.spritedata={spriteid:-1,aspectheightdata:0,aspectwidthdata:0,borderthickness:0,clickmask:null,color:16777215,
tiling:0,hflip:!1,vflip:!1,transparency:0,rotation:0,unk2:0,v6unk:0}:6==t?r.modeldata={modelid:-1,animid:-1,aspectheightdata:0,aspectwidthdata:0,mode:0,positiondata:{rotate_x:0,rotate_y:0,rotate_z:0,translate_x:0,translate_y:0,unkextra:null,zoom:0},
unkdata:null}:console.log(`creating unknown cc type, type=${t}, id=${e}`),this.comp){let t=new vE(this.comp.ctx,r,e);this.comp.clientChildren.push(t),this.changed(),t.api.changed(),this.comp?.element&&this.comp.initDom(),n=t.api}else n=new yE(null)
;return n}setSize(e,t,n,r){this.data&&(this.data.basewidth=e,this.data.baseheight=t,this.data.aspectwidthtype=n,this.data.aspectheighttype=r),this.changed()}setPosition(e,t,n,r){this.data&&(this.data.baseposx=e,this.data.baseposy=t,
this.data.aspectxtype=n,this.data.aspectytype=r),this.changed()}setHide(e){this.data&&(this.data.hidden=e)}setWidth(e){this.data&&(this.data.basewidth=e)}setHeight(e){this.data&&(this.data.basewidth=e)}setX(e){this.data&&(this.data.baseposx=e)}
setY(e){this.data&&(this.data.baseposy=e)}getHide(){return this.data?.hidden??0}getWidth(){return this.data?.basewidth??0}getHeight(){return this.data?.baseheight??0}getX(){return this.data?.baseposx??0}getY(){return this.data?.baseposy??0}
setOp(e,t){console.log(`setop ${this.comp?.compid??-1} ${e} ${t}`)}getOp(e){return this.data?.rightclickopts[e]??""}setText(e){this.data?.textdata&&(this.data.textdata.text=e)}getText(){return this.data?.textdata?.text??""}setTextAlign(e,t,n){
this.data?.textdata&&(this.data.textdata.alignhor=n,this.data.textdata.alignver=t,this.data.textdata.multiline=0|e)}getTextAlign(){return[this.data?.textdata?.alignhor??0,this.data?.textdata?.alignver??0,this.data?.textdata?.multiline??0]}
getGraphic(){return this.data?.spritedata?.spriteid??-1}getHFlip(){return this.data?.spritedata?.hflip??!1}getVFlip(){return this.data?.spritedata?.vflip??!1}getTiling(){return this.data?.spritedata?.tiling??0}getRotation(){
return this.data?.spritedata?.rotation??0}setGraphic(e){this.data?.spritedata&&(this.data.spritedata.spriteid=e),this.changed()}setHFlip(e){this.data?.spritedata&&(this.data.spritedata.hflip=e),this.changed()}setVFlip(e){
this.data?.spritedata&&(this.data.spritedata.vflip=e),this.changed()}setTiling(e){this.data?.spritedata&&(this.data.spritedata.tiling=e),this.changed()}setRotation(e){this.data?.spritedata&&(this.data.spritedata.rotation=e),this.changed()}
setModel(e){this.data?.modeldata&&(this.data.modeldata.modelid=e),this.changed()}getModel(){return this.data?.modeldata?.modelid??-1}getTrans(){return this.data?.figuredata?.trans??0}setTrans(e){this.data?.figuredata&&(this.data.figuredata.trans=e),
this.changed()}getFilled(){return this.data?.figuredata?.filled??0}setFilled(e){this.data?.figuredata&&(this.data.figuredata.filled=e),this.changed()}getColor(){return this.data?.figuredata?.color??0}setColor(e){
this.data?.figuredata&&(this.data.figuredata.color=e),this.changed()}}var bE=n(8287).Buffer;async function xE(e,t,n){if(t.major!=n.major)throw new Error("range must span one major");let r=[];if(e.getBuildNr()<=Cg){let i=0
;for(let a=t.minor;a<=n.minor&&!(i++>1e3);a++)try{let i=[];i=await e.getArchiveById(t.major,a);let s={major:t.major,minor:a,crc:0,name:null,subindexcount:i.length,subindices:i.map((e=>e.fileid)),subnames:i.map((e=>e.fileid)),version:0}
;for(let e of i)e.fileid>=t.subid&&e.fileid<=n.subid&&r.push({index:s,subindex:e.fileid})}catch{}}else{let i=await e.getCacheIndex(t.major);for(let e of i)if(e&&e.minor>=t.minor&&e.minor<=n.minor)for(let i=0;i<e.subindices.length;i++){
let a=e.subindices[i];e.minor==t.minor&&a<t.subid||e.minor==n.minor&&a>n.subid||r.push({index:e,subindex:i})}}return r}const EE={prepareDump(){},prepareWrite(){},write(e){throw new Error("write not supported")},combineSubs(e){
throw new Error("not supported")}};function wE(e){return{major:xg.mapsquares,minor:void 0,logicalDimensions:2,usesArchieves:!1,fileToLogical:(e,t,n,r)=>[255,n],logicalToFile(e,t){throw new Error("not implemented")},async logicalRangeToFiles(t,n,r){
let i=await t.getCacheIndex(xg.mapsquares),a=[];for(let s=n[0];s<=Math.min(r[0],100);s++)for(let o=n[1];o<=Math.min(r[1],200);o++){let n=am(`${e}${s}_${o}`,t.getBuildNr()<=Cg),r=i.find((e=>e.name==n));r&&a.push({index:r,subindex:0})}return a}}}
function SE(e){const t=xg.mapsquares,n=128;return{major:t,minor:void 0,logicalDimensions:2,usesArchieves:!0,fileToLogical:(e,t,r,i)=>[r%n,Math.floor(r/n)],logicalToFile:(r,i)=>({major:t,minor:i[0]+i[1]*n,subid:e}),async logicalRangeToFiles(r,i,a){
let s=await r.getCacheIndex(t),o=[];for(let t of s){if(!t)continue;let r=t.minor%n,s=Math.floor(t.minor/n);if(r>=i[0]&&r<=a[0]&&s>=i[1]&&s<=a[1])for(let n=0;n<t.subindices.length;n++)t.subindices[n]==e&&o.push({index:t,subindex:n})}return o}}}
function TE(e,t){return{major:e,minor:t,logicalDimensions:1,usesArchieves:!0,fileToLogical:(e,t,n,r)=>[r],logicalToFile:(n,r)=>({major:e,minor:t,subid:r[0]}),logicalRangeToFiles:async(n,r,i)=>xE(n,{major:e,minor:t,subid:r[0]},{major:e,minor:t,
subid:i[0]})}}function AE(e){return{major:e,minor:void 0,logicalDimensions:1,usesArchieves:!0,fileToLogical:(e,t,n,r)=>[vv(t,n,r)],logicalToFile:(t,n)=>_v(e,n[0],t.getBuildNr()),async logicalRangeToFiles(t,n,r){
let i=_v(e,n[0],t.getBuildNr()),a=_v(e,r[0],t.getBuildNr());return xE(t,i,a)}}}function CE(){return{major:void 0,minor:void 0,logicalDimensions:3,usesArchieves:!0,fileToLogical:(e,t,n,r)=>[t,n,r],logicalToFile:(e,t)=>({major:t[0],minor:t[1],
subid:t[2]}),async logicalRangeToFiles(e,t,n){if(t[0]!=n[0])throw new Error("can only do one major at a time");let r=t[0];return xE(e,{major:r,minor:t[1],subid:t[2]},{major:r,minor:n[1],subid:n[2]})}}}function ME(e){return{major:e,minor:void 0,
logicalDimensions:1,usesArchieves:!1,fileToLogical(e,t,n,r){if(0!=r)throw new Error("nonzero subfile in noarch index");return[n]},logicalToFile:(t,n)=>({major:e,minor:n[0],subid:0}),logicalRangeToFiles:async(t,n,r)=>xE(t,{major:e,minor:n[0],subid:0
},{major:e,minor:r[0],subid:0})}}function IE(e){return{major:e,minor:void 0,logicalDimensions:2,usesArchieves:!0,fileToLogical:(e,t,n,r)=>[n,r],logicalToFile:(t,n)=>({major:e,minor:n[0],subid:n[1]}),logicalRangeToFiles:async(t,n,r)=>xE(t,{major:e,
minor:n[0],subid:n[1]},{major:e,minor:r[0],subid:r[1]})}}function RE(e,t){return{...e,logicalRangeToFiles:async(n,r,i)=>(await e.logicalRangeToFiles(n,r,i)).filter((e=>!t.some((t=>t.major==e.index.major&&t.minor==e.index.minor))))}}
function kE(e,t,n,r){let i=a=>{let s="",o="";return{...t,ext:"json",parser:e,async prepareDump(t,l){await(r?.(l)),await(n?.(l));let c=Object.entries(HE).find((e=>e[1]==i));if(!c)throw new Error;let u=e.parser.getJsonSchema();if("true"==a.batched){
let e={type:"object",properties:{files:{type:"array",items:u}}},n=`.schema-${c[0]}_batch.json`;t.writeFile(n,Sv()(e)),o=n}else{let e=`.schema-${c[0]}.json`;t.writeFile(e,Sv()(u)),s=e}},prepareWrite:e=>r?.(e),read(t,n,r){let i=e.read(t,r,{
keepbuffers:a.keepbuffers});return a.batched?i.$fileid=1==n.length?n[0]:n:i.$schema=s,Sv()(i)},write:(t,n,r)=>e.write(JSON.parse(t.toString("utf8")),r.getDecodeArgs()),combineSubs:e=>`{"$schema":"${o}","files":[\n\n${e.join("\n,\n\n")}]}`,
description:"View the JSON representation of a file",flagtemplate:{keepbuffers:{text:"Keep binary buffers (can be very large)",type:"boolean"}}}};return i}const NE=(e,t)=>()=>({ext:"ogg",...ME(e),...EE,read:(n,r,i)=>Av(i,e,r[0],n,t),
description:"Extracts sound files from cache"}),DE=e=>()=>({ext:"png",...TE(Z_,e),...EE,read:async(t,n,r)=>Cm(Y_((await r.findSubfileByName(Z_,e,"INDEX.DAT")).buffer,t).img,"png",1),description:"Textures from the 'legacy' era, very early rs2"
}),LE=e=>()=>({ext:"png",...ME(e),prepareDump(){},prepareWrite(){},read:(e,t)=>new m_(e,!1,!0).toImageData().then((e=>Cm(e,"png",1))),write(e){throw new Error("write not supported")},combineSubs(e){if(1!=e.length)throw new Error("not supported")
;return e[0]},description:"Textures are images that are wrapped around models to display colors are fine details."}),OE={framemaps:{parser:Qg.framemaps,lookup:AE(xg.framemaps)},items:{parser:Qg.item,lookup:AE(xg.items)},enums:{parser:Qg.enums,
lookup:AE(xg.enums)},npcs:{parser:Qg.npc,lookup:AE(xg.npcs)},soundjson:{parser:Qg.audio,lookup:RE(IE(xg.sounds),[{major:xg.sounds,minor:0}])},musicjson:{parser:Qg.audio,lookup:RE(IE(xg.music),[{major:xg.music,minor:0}])},objects:{parser:Qg.object,
lookup:AE(xg.objects)},achievements:{parser:Qg.achievement,lookup:AE(xg.achievements)},structs:{parser:Qg.structs,lookup:AE(xg.structs)},sequences:{parser:Qg.sequences,lookup:AE(xg.sequences)},spotanims:{parser:Qg.spotAnims,lookup:AE(xg.spotanims)},
materials:{parser:Qg.materials,lookup:AE(xg.materials)},oldmaterials:{parser:Qg.oldmaterials,lookup:TE(xg.materials,0)},quickchatcats:{parser:Qg.quickchatCategories,lookup:TE(xg.quickchat,0)},quickchatlines:{parser:Qg.quickchatLines,
lookup:TE(xg.quickchat,1)},dbtables:{parser:Qg.dbtables,lookup:TE(xg.config,Ag.dbtables)},dbrows:{parser:Qg.dbrows,lookup:TE(xg.config,Ag.dbrows)},overlays:{parser:Qg.mapsquareOverlays,lookup:TE(xg.config,Ag.mapoverlays)},identitykit:{
parser:Qg.identitykit,lookup:TE(xg.config,Ag.identityKit)},params:{parser:Qg.params,lookup:TE(xg.config,Ag.params)},underlays:{parser:Qg.mapsquareUnderlays,lookup:TE(xg.config,Ag.mapunderlays)},mapscenes:{parser:Qg.mapscenes,
lookup:TE(xg.config,Ag.mapscenes)},environments:{parser:Qg.environments,lookup:TE(xg.config,Ag.environments)},animgroupconfigs:{parser:Qg.animgroupConfigs,lookup:TE(xg.config,Ag.animgroups)},maplabels:{parser:Qg.maplabels,
lookup:TE(xg.config,Ag.maplabels)},mapzones:{parser:Qg.mapZones,lookup:TE(xg.worldmap,0)},cutscenes:{parser:Qg.cutscenes,lookup:ME(xg.cutscenes)},particles0:{parser:Qg.particles_0,lookup:TE(xg.particles,0)},particles1:{parser:Qg.particles_1,
lookup:TE(xg.particles,1)},maptiles:{parser:Qg.mapsquareTiles,lookup:SE(wg)},maptiles_nxt:{parser:Qg.mapsquareTilesNxt,lookup:SE(Sg)},maplocations:{parser:Qg.mapsquareLocations,lookup:SE(Eg)},mapenvs:{parser:Qg.mapsquareEnvironment,lookup:SE(Tg)},
maptiles_old:{parser:Qg.mapsquareTiles,lookup:wE("m")},maplocations_old:{parser:Qg.mapsquareLocations,lookup:wE("l")},frames:{parser:Qg.frames,lookup:IE(xg.frames)},models:{parser:Qg.models,lookup:ME(xg.models)},oldmodels:{parser:Qg.oldmodels,
lookup:ME(xg.oldmodels)},skeletons:{parser:Qg.skeletalAnim,lookup:ME(xg.skeletalAnims)},proctextures:{parser:Qg.proctexture,lookup:ME(xg.texturesOldPng)},oldproctextures:{parser:Qg.oldproctexture,lookup:TE(xg.texturesOldPng,0)},interfaces:{
parser:Qg.interfaces,lookup:IE(xg.interfaces)},classicmodels:{parser:Qg.classicmodels,lookup:TE(0,Iv.models)},indices:{parser:Qg.cacheIndex,lookup:{major:xg.index,minor:void 0,logicalDimensions:1,usesArchieves:!1,fileToLogical:(e,t,n,r)=>[n],
logicalToFile:(e,t)=>({major:xg.index,minor:t[0],subid:0}),logicalRangeToFiles:async(e,t,n)=>(await e.getCacheIndex(xg.index)).filter((e=>e&&e.minor>=t[0]&&e.minor<=n[0])).map((e=>({index:e,subindex:0})))}},rootindex:{parser:Qg.rootCacheIndex,
lookup:{major:xg.index,minor:255,logicalDimensions:0,usesArchieves:!1,fileToLogical:(e,t,n,r)=>[],logicalToFile:(e,t)=>({major:xg.index,minor:255,subid:0}),logicalRangeToFiles:async(e,t,n)=>[{index:{major:255,minor:255,crc:0,size:0,version:0,
name:null,subindexcount:1,subindices:[0],subnames:null},subindex:0}]}},test:{parser:Zg.fromJson('["struct",\n  \n]'),lookup:CE()},clientscriptops:{parser:Qg.clientscript,lookup:ME(xg.clientscript),prepareParser:e=>rE(e).then((()=>{}))}},PE={
sprites:(FE=xg.sprites,()=>({ext:"png",...ME(FE),...EE,read:(e,t)=>Cm(J_(e)[0].img,"png",1),
description:"Sprites are all images that are used in ui. The client stores sprites are uncompressed bitmaps. Currently only the first frame for multi-frame sprites is extracted."})),textures_dds:LE(xg.texturesDds),textures_png:LE(xg.texturesPng),
textures_bmp:LE(xg.texturesBmp),textures_ktx:LE(xg.texturesKtx)};var FE;const UE={legacy_sprites:DE(nv),legacy_textures:DE(iv),textures_proc:()=>({ext:"png",...TE(xg.texturesOldPng,0),...EE,async read(e,t,n){
let r=Qg.oldproctexture.read(e,n),i=J_(await n.getFileById(xg.sprites,r.spriteid));if(1!=i.length)throw new Error("exactly one subsprite expected");return Cm(i[0].img,"png",1)},
description:"Procedural textures are highly compressed textures used in early rshd."}),textures_oldpng:LE(xg.texturesOldPng),textures_2015png:LE(xg.textures2015Png),textures_2015dds:LE(xg.textures2015Dds),
textures_2015pngmips:LE(xg.textures2015PngMips),textures_2015compoundpng:LE(xg.textures2015CompoundPng),textures_2015compounddds:LE(xg.textures2015CompoundDds),textures_2015compoundpngmips:LE(xg.textures2015CompoundPngMips)},BE={
sounds:NE(xg.sounds,!0),musicfragments:NE(xg.music,!1),music:()=>({ext:"ogg",major:xg.music,minor:void 0,logicalDimensions:1,usesArchieves:!1,fileToLogical:(e,t,n,r)=>[n],logicalToFile:(e,t)=>({major:xg.music,minor:t[0],subid:0}),
async logicalRangeToFiles(e,t,n){let r=await e.getFileById(xg.enums,1351),i=Qg.enums.read(r,e),a=await e.getCacheIndex(xg.music)
;return i.intArrayValue2.values.filter((e=>e[1]>=t[0]&&e[1]<=n[0])).sort(((e,t)=>e[1]-t[1])).filter(((e,t,n)=>0==t||n[t-1][1]!=e[1])).map((e=>({index:a[e[1]],subindex:0})))},...EE,read:(e,t,n)=>Av(n,xg.music,t[0],e,!0),
description:"Stitches child music fragments onto header fragments, only a small number of music fragments are header fragments, ids that lead to child fragments are ignored."})},zE={cutscenehtml:()=>({ext:"html",...ME(xg.cutscenes),...EE,
read:async(e,t,n)=>(await async function(e,t){let n=Qg.cutscenes.read(t,e),r=document.createElement("div");r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,console.log(n)
;let i="cutscene-"+(k_(t)>>>0),a="",s="",o=n.elements.reduce(((e,t)=>Math.max(e,t.end)),0),l=e=>`${Math.max(0,e/o*100).toFixed(2)}%`,c=new Map,u=function(e,t,n,r){return a+=`@keyframes ${t}{\n`,a+=`  from{${r(n[0])}}\n`,
a+=n.map((t=>`  ${l(e.start+t[0])}{${r(t)}}\n`)).join(""),a+=`  to{${r(n.at(-1))}}\n`,a+="}\n",`${o}s infinite ${t} linear`};a+=".subtitle{\n",a+="  position: absolute;\n",a+="  font-size: 50px;\n",a+="  bottom: 20px;\n",a+="  text-align: center;\n",
a+="  color: white;\n",a+="  padding: 5px;\n",a+="  left: 20px;\n",a+="  right: 20px;\n",a+="  font-family: sans-serif;\n",a+="  display:flex;\n",a+="}\n",a+=".subtitle>div{\n",a+="  background:rgba(0,0,0,0.3);\n",a+="  margin:0px auto;\n",
a+="  padding:12px;\n",a+="  border-radius:20px;\n",a+="}\n";for(let t=n.elements.length-1;t>=0;t--){let r=n.elements[t],h=`${i}-${t}-visibility`;if(a+=`@keyframes ${h}{\n`,a+="  0%{visibility:hidden}\n",a+=`  ${l(r.start)}{visibility:visible}\n`,
a+=`  ${l(r.end)}{visibility:hidden}\n`,a+="}\n",s+=`<div style="animation:${o}s step-end infinite ${h}">\n`,r.subtitle&&(s+=`<div class="subtitle"><div>${hm(r.subtitle)}</div></div>\n`),r.soundid)try{
s+=`<audio src="data:audio/ogg;base64,${(await Av(e,xg.sounds,r.soundid,null,!0)).toString("base64")}" data-timestart="${r.start}" data-timeend="${r.end}"></audio>\n`}catch(e){console.warn(`missing sound ${r.soundid} ${r.sound}`)}if(r.graphics){
if(0!=r.graphics.length)for(let n=r.graphics.length-1;n>=0;n--){let a=r.graphics[n],o=c.get(a.spriteid);if(!o){let t=await e.getFileById(xg.sprites,a.spriteid);o=await Dm(J_(t)[0].img),c.set(a.spriteid,o)}let l=[];if(0!=a.opacityframes.length){
let e=`${i}-${t}-${n}-opacity`;l.push(u(r,e,a.opacityframes,(e=>`opacity:${e[1].toFixed(2)}`)))}if(0!=a.rotateframes.length){let e=`${i}-${t}-${n}-rotate`;l.push(u(r,e,a.rotateframes,(e=>`rotate:${e[1].toFixed(2)}deg;`)))}
if(0!=a.translateframes.length){let e=`${i}-${t}-${n}-translate`;l.push(u(r,e,a.translateframes,(e=>`translate:${e[1].toFixed(2)}px ${e[2].toFixed(2)}px`)))}if(0!=a.scaleframes.length){let e=`${i}-${t}-${n}-scale`
;l.push(u(r,e,a.scaleframes,(e=>`scale:${e[1].toFixed(3)} ${e[2].toFixed(2)};`)))}let h=`position:absolute; top:0px; left:0px; transform-origin:center;margin-left:${-a.width/2}px; margin-top:${-a.height/2}px;`
;s+=`<img src="${o}" width="${a.width}" height="${a.height}" style="${h} animation:${l.join()};">\n`}s+="</div>"}}let h="<!DOCTYPE html>\n";return h+="<html>\n",h+="<head>\n",h+="<style>\n",h+=a,h+="</style>\n",h+="</head>\n",h+="<body>\n",
h+=`<input type="range" min="0" max="${o}" step="0.01" style="width:400px;" oninput="controls.onRangeChange(event)">\n`,h+='<input type="button" value="play" onclick="controls.play()">\n',
h+='<input type="button" value="pause" onclick="controls.pause()">\n',h+=`<div style="position:relative; width:${n.width}px; height:${n.height}px; overflow:hidden; zoom:0.5;">\n`,h+=s,h+="</div>\n",h+="<script>\n",h+=`var controls=(${function(e){
console.log("module init");let t=0,n=Date.now(),r=1,i=0;function a(){return t+(Date.now()-n)/1e3*r}function s(a,o=1){t=a,r=o,n=Date.now(),i&&(clearTimeout(i),i=0),0!=o&&(i=+setTimeout((()=>{s(0,o)}),1e3*(e-a/o)));let l=document.getAnimations()
;for(let e of l)e.currentTime=1e3*a,e.playbackRate=o,0!=o?e.play():e.pause();let c=Array.from(document.querySelectorAll("audio"));for(let e of c){let t=a-+(e.dataset.timestart??0);e.dataset.delaytimer&&(clearTimeout(+e.dataset.delaytimer),
e.dataset.delaytimer=void 0),0!=o?(e.playbackRate=o,t<0?e.dataset.delaytimer=""+ +setTimeout((()=>{e.currentTime=0,e.play()}),-t/o*1e3):(e.currentTime=t,e.play())):e.pause()}}return{seek:s,play:function(){s(a(),1)},pause:function(){s(a(),0)},
onRangeChange:function(e){s(e.currentTarget.valueAsNumber,0)}}}})(${o});\n`,h+="controls.play()\n",h+="<\/script>\n",h+="</body>\n",h+="</html>\n",{html:s,css:a,doc:h}}(n,e)).doc,
description:"Decodes and assembles 2d vector cutscenes (first added in 2023). These cutscenes are saved in cache without image compression so take a while to decode. Sounds effects might be missing if you use a local game cache since the game normally only downloads them on demand."
}),interfacehtml:()=>({ext:"html",major:xg.interfaces,minor:void 0,logicalDimensions:1,usesArchieves:!0,fileToLogical(e,t,n,r){if(0!=r)throw new Error("subfile 0 expected");return[n]},logicalToFile:(e,t)=>({major:xg.interfaces,minor:t[0],subid:0}),
logicalRangeToFiles:async(e,t,n)=>(await e.getCacheIndex(xg.interfaces)).filter((e=>e&&e.minor>=t[0]&&e.minor<=n[0])).map((e=>({index:e,subindex:0}))),...EE,read:async(e,t,n)=>await fE(new uE(n),t[0]),
description:"Extracts an interface and converts the template to a html file. Model and scripts will be missing and therefore the result might be incomplete."}),interfaceviewer:()=>({ext:"ui.json",major:xg.interfaces,minor:void 0,logicalDimensions:1,
usesArchieves:!0,fileToLogical(e,t,n,r){if(0!=r)throw new Error("subfile 0 expected");return[n]},logicalToFile:(e,t)=>({major:xg.interfaces,minor:t[0],subid:0}),
logicalRangeToFiles:async(e,t,n)=>(await e.getCacheIndex(xg.interfaces)).filter((e=>e&&e.minor>=t[0]&&e.minor<=n[0])).map((e=>({index:e,subindex:0}))),...EE,read:async(e,t,n)=>JSON.stringify({id:t[0]}),
description:"Doesn't extract anything but invokes the built-in RSMV interface viewer."}),clientscript:e=>({ext:"ts",...ME(xg.clientscript),...EE,async prepareDump(e,t){let n=await rE(t);e.writeFile("tsconfig.json",JSON.stringify({compilerOptions:{
lib:[],target:"ESNext"}},void 0,"\t")),e.writeFile("opcodes.d.ts",nE(n)),e.writeFile("clientvars.d.ts",function(e){let t="";for(let n of e.varmeta.values()){t+=`// ===== ${n.name} =====\n`
;for(let[e,r]of n.vars)t+=`declare var var${n.name}_${e}: ${Xy(r.type)};\n`}t+="// ===== varbits =====\n";for(let[n,r]of e.varbitmeta){let i=e.varmeta.get(r.varid>>16);t+=`declare var varbit${i?.name??"unk"}_${n}: number;\n`}return t}(n))},
read:(t,n,r)=>async function(e,t,n,r=!1,i=!1,a=!1){let s=await rE(e),o=Qg.clientscript.read(t,e),{rootfunc:l,sections:c,typectx:u}=Px(s,o,n),h=new Ux(s,u);return r&&h.setCompOffsets(l),h.typescript=!i,h.int32casts=a,h.getCode(l)
}(r,t,n[0],"true"==e.cs2relativecomps,"true"==e.cs2notypes,"true"==e.cs2intcasts),async write(e,t,n){let r=await async function(e,t){let n=await rE(e),r=tE(n,t);if(!r.success)throw new Error("failed to parse clientscript",{cause:r.failedOn})
;if(""!=r.remaining)throw new Error("failed to parse clientscript, left over: "+r.remaining.slice(0,100));return dx(n,r.result)}(n,e.toString("utf8"));return Qg.clientscript.write(r,n.getDecodeArgs())},
description:"Extracts clientscript VM code (cs2) and converts it to something that is typescript-compatible.",flagtemplate:{cs2relativecomps:{text:"Hide subcomponent ids (can't be compiled, but offers stable diffing)",type:"boolean"},cs2notypes:{
text:"Don't output TS types (can't be compiled)",type:"boolean"},cs2intcasts:{text:"Explicit JS int32 casts during math (can't be compiled)",type:"boolean"}}}),clientscriptviewer:()=>({ext:"cs2.json",...ME(xg.clientscript),...EE,
async prepareDump(e,t){await rE(t)},read:(e,t,n)=>JSON.stringify(Qg.clientscript.read(e,n)),description:"Basic implementation of the clientscript VM (cs2). Can be used to debug programs and step through code."})},GE={bin:()=>({...CE(),ext:"bin",
prepareDump(){},prepareWrite(){},read:e=>e,write:e=>e,combineSubs:e=>bE.concat(e),description:"Outputs the raw files as they are in the cache"}),spritehash:()=>({ext:"json",...ME(xg.sprites),...EE,async read(e,t){let n=J_(e),r=""
;for(let[e,i]of n.entries()){const n=i.img.data;for(let e=0;e<n.length;e+=4)0==n[e+2]&&(n[e+2]=1);let a=k_(i.img.data);r+=(""==r?"":",")+`{"id":${t[0]},"sub":${e},"hash":${a}}`}return r},combineSubs:e=>"["+e.join(",\n")+"]",
description:"Used to efficiently compare images."}),modelhash:()=>({ext:"json",...ME(xg.models),...EE,read(e,t,n){let r=function(e,t){let n=[];if(!e.meshes)throw new Error("model hash not supported for new model format")
;for(let[r,i]of e.meshes.entries()){let e=0,a=0,s=0,o=0,l=0,c=0;if(i.uvBuffer&&i.uvBuffer.length>=80){let t=!1;for(let e=0;e<80;e++)if(0!=i.uvBuffer[e]){t=!0;break}t&&(e=k_(Yw.from(i.uvBuffer.buffer,i.uvBuffer.byteOffset,80)),
a=k_(Yw.from(i.uvBuffer.buffer,i.uvBuffer.byteOffset,Math.min(4e3,i.uvBuffer.byteLength))))}i.normalBuffer&&i.normalBuffer.length>=60&&(s=k_(Yw.from(i.normalBuffer.buffer,i.normalBuffer.byteOffset,60)),
o=k_(Yw.from(i.normalBuffer.buffer,i.normalBuffer.byteOffset,Math.min(3e3,i.normalBuffer.byteLength)))),i.positionBuffer&&i.positionBuffer.length>=120&&(l=k_(Yw.from(i.positionBuffer.buffer,i.positionBuffer.byteOffset,120)),
c=k_(Yw.from(i.positionBuffer.buffer,i.positionBuffer.byteOffset,Math.min(6e3,i.positionBuffer.byteLength))));let u=[];if(i.positionBuffer)for(let e of i.indexBuffers){let n=e.length/3|0;if(n>=20){let r=new L_,a=0;for(let t=0;t<n;t++){
for(let n=0;n<3;n++){let a=e[3*t+n];r.addUint16(i.positionBuffer[3*a+0]),r.addUint16(i.positionBuffer[3*a+1]),r.addUint16(i.positionBuffer[3*a+2])}19==t&&(a=r.get())}u.push({id:t,head:a,full:r.get(),count:n})}}(e||l||s||0!=u.length)&&n.push({id:t,
sub:r,uvshead:e,uvsfull:a,normalshead:s,normalsfull:o,poshead:l,posfull:c,verts:i.vertexCount,indexpos:u})}}(Qg.models.read(e,n),t[0]);return JSON.stringify(r)},combineSubs:e=>"["+e.filter((e=>e)).join(",\n")+"]",
description:"Used to efficiently compare models."}),npcmodels:function(){return{...AE(xg.npcs),ext:"json",prepareDump(e){},prepareWrite(){},read(e,t,n){let r=Qg.npc.read(e,n);return Sv()({id:t[0],size:r.boundSize??1,name:r.name??"",
models:r.models??[]})},write(e){throw new Error("")},combineSubs:e=>`[${e.join(",\n")}]`,description:"Extract model metadata from npc configs."}}},VE={image:PE,legacyImage:UE,interactive:zE,sound:BE,other:GE,
json:Object.fromEntries(Object.entries(OE).map((([e,t])=>[e,kE(t.parser,t.lookup,t.prepareDump,t.prepareParser)])))
},HE=Object.fromEntries(Object.values(VE).flatMap((e=>Object.entries(e)))),jE=[255,255,255],WE=512,$E=256,qE=1024,XE=358.4,YE=768,KE=810.6666666666666;function JE(e,t,n){
let r=(n[1]-e[1])*(t[2]-e[2])-(t[1]-e[1])*(n[2]-e[2]),i=(n[2]-e[2])*(t[0]-e[0])-(t[2]-e[2])*(n[0]-e[0]),a=(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1]),s=1/Math.hypot(r,i,a);return[r*s,i*s,a*s]}class ZE{constructor(e){this.pos=[],this.color=[],
this.uvs=[],this.index=[],this.normals=[],this.vertindex=0,this.parent=e}addParallelogram(e,t,n,r){let i=[t[0]+r[0]-n[0],t[1]+r[1]-n[1],t[2]+r[2]-n[2]],a=JE(t,n,r);return this.pos.push(...t,...n,...r,...i),this.color.push(...e,...e,...e,...e),
this.normals.push(...a,...a,...a,...a),this.uvs.push(0,0,1,0,1,1,0,1),this.index.push(this.vertindex+0,this.vertindex+2,this.vertindex+1,this.vertindex+0,this.vertindex+3,this.vertindex+2),this.vertindex+=4,this}addTriangle(e,t,n,r){let i=JE(t,r,n)
;return this.color.push(...e,...e,...e),this.pos.push(...t,...n,...r),this.uvs.push(0,0,0,1,1,1),this.normals.push(...i,...i,...i),this.index.push(this.vertindex+0,this.vertindex+1,this.vertindex+2),this.vertindex+=3,this}addCube(e,[t,n,r],[i,a,s]){
let o=t-i/2,l=n-a/2,c=r-s/2,u=o+i,h=l+a,d=c+s;return this.addParallelogram(e,[o,l,c],[u,l,c],[u,h,c]),this.addParallelogram(e,[u,l,c],[u,l,d],[u,h,d]),this.addParallelogram(e,[u,l,d],[o,l,d],[o,h,d]),this.addParallelogram(e,[o,l,d],[o,l,c],[o,h,c]),
this.addParallelogram(e,[o,l,d],[u,l,d],[u,l,c]),this.addParallelogram(e,[o,h,c],[u,h,c],[u,h,d]),this}addExtrusion(e,t,n){let r=n[n.length-1];if(0!=Math.hypot(...t))for(let i=0;i<n.length;i++){let a=n[i]
;this.addParallelogram(e,r,a,[a[0]+t[0],a[1]+t[1],a[2]+t[2]]),r=a}if(n.length>2){let t=n[2][0]-n[1][0],r=n[2][1]-n[1][1],i=n[2][2]-n[1][2],a=n[0][0]-n[1][0],s=n[0][1]-n[1][1],o=n[0][2]-n[1][2],l=s*i-r*o,c=o*t-i*a,u=a*r-t*s,h=Math.hypot(l,c,u);l/=h,
c/=h,u/=h,this.index.length;let d=-1,p=-1;for(let t=0;t<n.length;t++){let r=n[t];this.pos.push(...r),this.color.push(...e),this.uvs.push(0,0),this.normals.push(l,c,u);let i=this.vertindex++;-1==d?d=i:(-1==p||this.index.push(d,p,i),p=i)}d=-1,p=-1
;for(let t=n.length;t>0;t--){let r=n[t%n.length];this.pos.push(...r),this.color.push(...e),this.uvs.push(0,0),this.normals.push(-l,-c,-u);let i=this.vertindex++;-1==d?d=i:(-1==p||this.index.push(d,p,i),p=i)}}return this}convertSubmesh(e){
let t=new ca(new Uint16Array(this.index),1);return{indices:t,vertexstart:0,vertexend:this.pos.length/3|0,attributes:{pos:new ca(new Float32Array(this.pos),3),color:new ca(new Uint8Array(this.color),3,!0),texuvs:new ca(new Float32Array(this.uvs),2),
normals:new ca(new Float32Array(this.normals),3)},indexLODs:[t],hasVertexAlpha:!1,materialId:e,needsNormalBlending:!1}}mat(e){return this.parent.mat(e)}convert(){return this.parent.convert()}}function QE(e){if(e instanceof oc){let t=e.data.array
;if(!ArrayBuffer.isView(t))throw new Error("typed array backing store expected");return[t,e.offset,e.data.stride]}{let t=e.array;if(!ArrayBuffer.isView(t))throw new Error("typed array backing store expected");return[t,0,e.itemSize]}}
function ew(e,t,n,r,i){const a=new Dr,s=new Dr,o=new Dr,l=new Dr;for(let c=r;c<i;c+=3){const r=e.getX(c+0),i=e.getX(c+1),u=e.getX(c+2);a.fromBufferAttribute(t,r),s.fromBufferAttribute(t,i),o.fromBufferAttribute(t,u),o.sub(s),a.sub(s),
l.crossVectors(o,a),a.fromBufferAttribute(n,r),s.fromBufferAttribute(n,i),o.fromBufferAttribute(n,u),a.add(l),s.add(l),o.add(l),n.setXYZ(r,a.x,a.y,a.z),n.setXYZ(i,s.x,s.y,s.z),n.setXYZ(u,o.x,o.y,o.z)}for(let e=r;e<i;e++)l.fromBufferAttribute(n,e),
l.normalize(),n.setXYZ(e,l.x,l.y,l.z)}class tw{constructor(){this.meshes=new Map}mat(e){let t=this.meshes.get(e);return t||(t=new ZE(this),this.meshes.set(e,t)),t}convert(){return function(e){let t=0,n=0,r=[];return e.forEach(((e,i)=>{
let a=e.convertSubmesh(i);r.push(a);let s=a.attributes.pos;for(let e=0;e<s.count;e++){let r=s.getY(e);t=Math.min(t,r),n=Math.max(n,r)}})),{miny:t,maxy:n,bonecount:0,skincount:0,meshes:r}}(this.meshes)}}
const nw=(new tw).mat(0).addCube(jE,[0,300,0],[600,600,600]).convert(),rw=(new tw).mat(0).addParallelogram(jE,[-256,0,$E],[-256,WE,$E],[-256,WE,-256]).mat(1).addParallelogram([255,0,0],[-256,0,-256],[-256,WE,-256],[-256,WE,$E]).convert(),iw=(new tw).mat(0).addParallelogram(jE,[$E,0,$E],[$E,WE,$E],[-256,WE,-256]).mat(1).addParallelogram(jE,[-256,0,-256],[-256,WE,-256],[$E,WE,$E]).convert(),aw=(new tw).mat(0).addParallelogram(jE,[-358.4,KE,-358.4],[XE,KE,-358.4],[XE,KE,XE]).convert(),sw=(new tw).mat(0).addParallelogram(jE,[-256,qE,$E],[-256,qE,-256],[XE,YE,-256]).convert(),ow=(new tw).mat(0).addTriangle(jE,[XE,YE,$E],[-256,YE,-358.4],[-256,qE,$E]).convert(),lw=(new tw).mat(0).addTriangle(jE,[-256,qE,-256],[-256,qE,$E],[$E,qE,$E]).mat(0).addTriangle(jE,[-256,qE,-256],[$E,qE,$E],[$E,KE,-256]).convert(),cw=(new tw).mat(0).addTriangle(jE,[$E,qE,$E],[-256,qE,-256],[-256,KE,$E]).mat(0).addTriangle(jE,[-256,qE,-256],[$E,qE,$E],[$E,KE,-256]).convert(),uw=(new tw).mat(0).addTriangle(jE,[XE,YE,-358.4],[-256,YE,-358.4],[-256,qE,$E]).mat(0).addTriangle(jE,[XE,YE,$E],[XE,YE,-358.4],[-256,qE,$E]).convert(),hw=(new tw).mat(0).addParallelogram(jE,[-256,qE,-256],[$E,qE,-256],[$E,qE,$E]).convert(),dw=function(){
const e=$E,t=192,n=[0,0,0];return{wall:(new tw).mat(-1).addExtrusion(jE,n,[[-256,0,-256],[-256,0,e],[-192,0,e],[-192,0,-256]]).convert(),shortcorner:(new tw).mat(-1).addExtrusion(jE,n,[[-256,0,e],[-192,0,e],[-192,0,t],[-256,0,t]]).convert(),
longcorner:(new tw).mat(-1).addExtrusion(jE,n,[[-192,0,t],[-192,0,-256],[-256,0,-256],[-256,0,e],[e,0,e],[e,0,t]]).convert(),pillar:(new tw).mat(-1).addExtrusion(jE,n,[[-256,0,e],[-192,0,e],[-192,0,t],[-256,0,t]]).convert(),
diagonal:(new tw).mat(-1).addExtrusion(jE,n,[[-256,0,-256],[-256,0,-192],[t,0,e],[e,0,e],[e,0,t],[-192,0,-256]]).convert()}}();var pw=n(8287).Buffer;const fw=48,mw=fw*fw,gw=1e6,_w=2e6;function vw(e){const t=fw-1;let n=t-(e/fw|0),r=t-e%fw;return{
rs2index:n*fw+r,x:n,z:r}}function yw(e,t){return(fw-1-e)*fw+(fw-1-t)}class bw{constructor(e,t){this.locs=[],this.config=e,this.levels=t,this.tiles=new Array(mw*t).fill(null).map(((e,t)=>({height:t>mw?96:0,hasbridge:!1,overlayobj:null,overlay:0,
underlay:0,locrotation:0})))}getTile(e,t,n){if(!(t<0||n<0||t>=fw||n>=fw||e<0||e>=this.levels))return this.tiles[e*mw+t*fw+n]}getTileClassic(e,t){const n=fw-1;let r=n-(t/fw|0),i=n-t%fw;return this.getTile(e,r,i)}placeLoc(e,t,n,r,i,a,s=null){
let o=this.getTile(r+1,i,a);if(o?.overlayobj?.type.bridge)r++;else if(0==t){let e=2==n?this.getTile(r+1,i+1,a):this.getTile(r+1,i,a+1);e?.overlayobj?.type.bridge&&r++}this.locs.push({id:e,uses:[{x:i,y:a,plane:r,rotation:n,type:t,extra:s}]})}
convertTiles(){return this.tiles.map(((e,t)=>{let n=Math.floor(t/mw),r=this.tiles[t-mw];return{height:e.hasbridge?1==n&&r.hasbridge?r.height/4:0:e.height/4,flags:0,settings:1==n&&e.hasbridge?2:0,overlay:e.overlay,underlay:e.underlay,
shape:e.overlay?0:null}}))}loadJmFile(e,t){let n=new pm(e),r=0,i=pw.alloc(mw);for(let e=0;e<mw;e++)r+=n.readUByte(),i[e]=255&r;let a=0,s=pw.alloc(mw);for(let e=0;e<mw;e++)a+=n.readUByte(),s[e]=255&a
;let o=n.readBuffer(mw),l=n.readBuffer(mw),c=pw.alloc(mw),u=pw.alloc(mw),h=new Uint32Array(mw);for(let e=0;e<mw;e++){let t=n.readUShort(!0);if(0!=t){let n=t/12e3|0,r=t%12e3,i=vw(e)
;0==n?c[e]=r:1==n?u[e]=r:2==n||3==n||(4==n?h[e]=r:console.log(i.x,i.z,e," type"+(t/12e3|0),t%12e3))}}let d=n.readBuffer(mw),p=n.readBuffer(mw),f=n.readBuffer(mw);if(!n.eof())throw new Error("didn't end reading map.jm at end of file")
;0==t&&this.addFloorBuffers(i,s,t,!1),this.addWallBuffers(o,l,c,u,d,p,f,t),this.addLocBuffer(h,t)}loadHeiFile(e,t){let n=new pm(e),r=0,i=pw.alloc(mw),a=pw.alloc(mw);for(let e=0;e<mw;){let t=n.readUByte();if(t<128&&(i[e++]=255&t,r=t),
t>=128)for(let n=0;n<t-128;n++)i[e++]=255&r}for(let e=0;e<mw;){let t=n.readUByte();if(t<128&&(a[e++]=255&t,r=t),t>=128)for(let n=0;n<t-128;n++)a[e++]=255&r}if(!n.eof())throw new Error("unexpected height file length");this.addFloorBuffers(i,a,t,!0)}
loadDatfile(e,t){let n=new pm(e),r=n.readBuffer(mw),i=n.readBuffer(mw),a=n.readBuffer(mw),s=n.readBuffer(mw),o=pw.alloc(mw);for(let e=0;e<mw;){let t=n.readUByte();t<128?(o[e]=t,e++):e+=t-128}let l=pw.alloc(mw),c=0;for(let e=0;e<mw;){
let t=n.readUByte(),r=1;t<128?c=t:r=t-128;for(let t=0;t<r;t++)l[e]=c,e++}let u=pw.alloc(mw);for(let e=0;e<mw;){let t=n.readUByte();t<128?(u[e]=t,e++):e+=t-128}if(!n.eof())throw new Error("didn't end reading map.dat at end of file")
;this.addWallBuffers(r,i,a,s,o,l,u,t)}addFloorBuffers(e,t,n,r){let i=64,a=35;for(let s=0;s<fw;s++)for(let o=0;o<fw;o++){let l=o*fw+s,c=e[l],u=t[l];r&&(i=c+(127&i),c=2*i&255,a=t[l]+a&127,u=2*a&255);let h=this.getTileClassic(n,l);h&&(h.height=c,
h.underlay=u+1)}}addWallBuffers(e,t,n,r,i,a,s,o){let l=(e,t,n)=>{let r=this.getTile(e,t,n),i=this.getTile(e,t-1,n),a=this.getTile(e,t,n-1),s=this.getTile(e,t-1,n-1);r&&(r.hasbridge=!0),i&&(i.hasbridge=!0),a&&(a.hasbridge=!0),s&&(s.hasbridge=!0)
},c=(e,t,n,r,i)=>{let a=this.getTile(e,t,n);if(a&&a.overlay!=i&&a.overlay!=r){let i=this.getTile(e+1,t,n);i&&(i.overlay=r,i.overlayobj=this.config.tiles[r-1]),l(e+1,t,n)}};for(let e=0;e<mw;e++){let t=a[e],n=this.getTileClassic(o,e);if(n&&0!=t){
let e=this.config.tiles[t-1];n.overlay=t,n.overlayobj=e}}for(let e=0;e<mw;e++){let t=this.getTileClassic(0,e);if(t?.overlayobj?.type.bridge){let n=12==t.overlay?11:2,r=vw(e),i=this.getTile(o+1,r.x,r.z);t.hasbridge=!0,l(o,r.x,r.z),l(o+1,r.x,r.z),
c(o,r.x+1,r.z,t.overlay,n),c(o,r.x-1,r.z,t.overlay,n),c(o,r.x,r.z+1,t.overlay,n),c(o,r.x,r.z-1,t.overlay,n),i&&(i.height=t.height,i.overlay=t.overlay,i.overlayobj=t.overlayobj);let a=this.config.tiles[n-1];t.overlay=n,t.overlayobj=a}}let u=e=>({
flags:0,rotation:null,scale:null,scaleX:null,scaleY:this.config.wallobjects[e-1].height,scaleZ:null,translateX:null,translateY:null,translateZ:null});for(let i=0;i<mw;i++){let a=e[i],s=t[i],l=n[i],c=r[i],h=vw(i)
;a&&this.placeLoc(gw+(a-1),0,2,o,h.x,h.z,u(a)),s&&this.placeLoc(gw+(s-1),0,1,o,h.x,h.z,u(s)),l&&this.placeLoc(gw+(l-1),9,0,o,h.x,h.z,u(l)),c&&this.placeLoc(gw+(c-1),9,1,o,h.x,h.z,u(c))}let h=(e,t)=>{if(e<0||e>=fw||t<0||t>=fw)return"none"
;let a=yw(e,t);return 0==i[a]?"none":0!=n[a]||0!=r[a]?"diagedge":"full"},d=(e,t)=>{let n=[h(e+1,t),h(e+1,t-1),h(e,t-1),h(e-1,t-1),h(e-1,t),h(e-1,t+1),h(e,t+1),h(e+1,t+1)],r=h(e,t);if(n.every(((e,t)=>t%2==0?"full"==e:"none"!=e)))return{type:17,rot:0}
;for(let e=0;e<4;e++){let t=n[(2*e+0)%8],i=n[(2*e+2)%8],a=n[(2*e+4)%8],s=n[(2*e+6)%8],o=n[(2*e+1)%8],l=n[(2*e+3)%8],c=n[(2*e+5)%8];if(n[(2*e+7)%8],"none"==t&&"none"==i&&"none"!=s&&"none"!=a&&"none"!=c)return{type:"diagedge"==r?13:16,rot:e}
;if("none"==t&&"none"!=i&&"none"!=s&&"none"!=a)return"none"==l?{type:16,rot:e}:"none"==c?{type:16,rot:(e+3)%4}:{type:12,rot:e};if("none"!=t&&"none"!=i&&"full"==s&&"full"==a&&"none"==o)return{type:14,rot:e}
;if("none"!=t&&"none"!=i&&"none"!=s&&"none"!=a&&"none"==o&&"none"==c)return{type:15,rot:e}}return{type:10,rot:0}};for(let e=0;e<i.length;e++){let t=i[e];if(0!=t){let n=vw(e),r=d(n.x,n.z);this.placeLoc(_w+t-1,r.type,r.rot,o,n.x,n.z)}}
for(let e=0;e<mw;e++){let t=this.getTileClassic(o,e);t&&(t.locrotation=s[e])}}loadLocFile(e,t){let n=new pm(e),r=new Uint32Array(mw);for(let e=0;e<mw;){let t=n.readUByte();t<128?r[e++]=t:e+=t-128}
if(!n.eof())throw new Error("didn't end reading map.loc at end of file");this.addLocBuffer(r,t)}addLocBuffer(e,t){for(let n=0;n<mw;n++){let r=e[n];if(r){let i=vw(n),a=this.config.objects[r-1];if(!a){console.warn(`loc for ${r-1} is missing`);continue}
let s=!1;for(let t=0;t<a.xsize;t++)for(let n=0;n<a.zsize;n++)0==t&&0==n||i.x+t>=fw||i.z+n>=fw||e[yw(i.x+t,i.z+n)]==r&&(s=!0);if(!s){let e=this.getTileClassic(t,n);if(e){let n=(4+e.locrotation)%8,s=n%2==0?10:11,o=i.x,l=i.z;n%4!=0?(o-=a.zsize-1,
l-=a.xsize-1):(o-=a.xsize-1,l-=a.zsize-1),this.placeLoc(r-1,s,Math.floor(n/2),t,o,l)}}}}}}function xw(e){let t=0,n=!1,r=[255,255,255];if(e>99999999&&(e=99999999-e),12345678==e)n=!0;else if(e<0){let t=-e-1;r=[t>>10&31,t>>5&31,31&t]}else t=e+1;return{
color:r,colorint:ym(...vm(...r)),material:t,invisible:n}}function Ew(...e){let t={color_replacements:[],material_replacements:[]};for(let[n,r]of e.entries()){let e=xw(r);t.color_replacements.push([n,e.colorint]),
t.material_replacements.push([n,e.material]),e.invisible&&(t.models=null)}return t}function ww(e,t,n,r){let i=t*fw,a=n*fw,s=i+fw,o=a+fw,l=new Uint32Array(mw),c=e.jsonlocs.filter((e=>e.level==r&&e.x>=i&&e.x<s&&e.z>=a&&e.z<o));for(let e of c){
let t=e.x-i,n=e.z-a;l[t*fw+n]=e.id+1}return l}var Sw=n(5872);class Tw{getTexture(e){let t=this.parent.textureIds.indexOf(e);if(-1!=t&&this.textures[t])return this.textures[t];throw new Error("texture not loaded")}getSprite(e){
let t=this.parent.spriteIds.indexOf(e);if(-1!=t&&this.sprites[t])return this.sprites[t];throw new Error("sprite not loaded")}constructor(e){this.textures=[],this.sprites=[],this.filesize=0,this.parent=e}static async create(e,t){let n=new Tw(t)
;for(let r of t.textureIds){let t=await Aw(e,r,void 0,!0);n.textures.push(t.img),n.filesize+=t.filesize}for(let r of t.spriteIds){let t=await e.getFileById(xg.sprites,r),i=J_(t);n.sprites.push(i[0].img),n.filesize+=t.byteLength}return n}}
async function Aw(e,t,n=256,r=!1){let i=await e.getFileById(xg.texturesOldPng,t),a=i.byteLength,s=new Sw.Buffer([...i]),o=new Sw.Texture(s),l=await Tw.create(e,o);return a+=l.filesize,{img:Cw(o,l,n,r),filesize:a,tex:o,deps:l}}function Cw(e,t,n,r=!1){
let i=e.getPixels(n,n,t,r?1:1/2.2,!1,!r),a=new ImageData(n,n);for(let e=0;e<i.length;e++)a.data[4*e+0]=i[e]>>16&255,a.data[4*e+1]=i[e]>>8&255,a.data[4*e+2]=255&i[e],a.data[4*e+3]=255;return a}let Mw={uModelMatrix:"#define uModelMatrix modelMatrix",
uViewProjMatrix:"#define uViewProjMatrix (projectionMatrix*viewMatrix)",uViewMatrix:"#define uViewMatrix viewMatrix",uProjectionMatrix:"#define uProjectionMatrix projectionMatrix",uCameraPosition:"#define uCameraPosition cameraPosition",
aWaterPosition_Depth:"#define aWaterPosition_Depth vec4(position,10.0)",aVertexPosition:"#define aVertexPosition position",aVertexPosition_BoneLabel:"#define aVertexPosition_BoneLabel vec4(position,0.0)",aTextureUV:"#define aTextureUV uv",
aVertexColour:"#define aVertexColour vec4(color.rgb,1.0)",aTextureWeight:["attribute vec3 color_1;","#define aTextureWeight vec4(color_1,1.0)"],
aMaterialProperties:["attribute vec3 color_2;","#define aMaterialProperties vec4(256.0-color_2*256.0,0.0)"],aVertexNormal_FogProportion:"#define aVertexNormal_FogProportion vec4(normal,0.0)",gl_FragColor:""},Iw={
UNIFORM_BUFFER_BEGIN:"#define UNIFORM_BUFFER_BEGIN(name)",UNIFORM_BUFFER_END:"#define UNIFORM_BUFFER_END",TEXTURE_GRAD:"",gl_FragColor:""},Rw={UNIFORM_BUFFER_BEGIN:"#define UNIFORM_BUFFER_BEGIN(name)",UNIFORM_BUFFER_END:"#define UNIFORM_BUFFER_END",
TEXTURE_GRAD:"",gl_FragColor:""};function kw(e,t){return e.replace(/void main\(\)[\s\r\n]*\{/,"$&\n"+t)}function Nw(e,t){return t+"\n"+e}function Dw(e,t){
return e.replace(/^((flat) )*(in|out|uniform|attribute|varying) ((highp|mediump|lowp) )*(float|vec\d|mat\d) ((\w|,\s*)+);$/gm,((e,n,r,i,a,s,o,l)=>l.split(/,\s*/g).map((r=>{let s=t[r];if(null!=s){let t="function"==typeof s?s():s
;return t=Array.isArray(t)?t.join("\n"):t+"\n",e.split("\n").map((e=>`// ${e}`)).join("\n")+"\n"+t}return`${n??""}${i} ${a??""}${o??""} ${r};`})).join("\n")))}function Lw(e,t){return e.replace(/^#define (\w+)(\(.*?\))?($| (\\\r?\n|.)*$)/gm,((e,n)=>{
let r=t[n];if(null!=r){let t="function"==typeof r?r():r;return t=Array.isArray(t)?t.join("\n"):t+"\n",e.split("\n").map((e=>`// ${e}`)).join("\n")+"\n"+t}return e}))}function Ow(e){
return["precision highp float;","precision mediump sampler3D;","#define fma(a,b,c) ((a)*(b)+(c))"].join("\n")+"\n\n"+e.replace(/^#version ([\w ]+)$/m,"//original version $1").replace(/\bprecise\b/g,"highp")}var Pw=n(8287).Buffer
;const Fw=Object.fromEntries(["material","model","item","loc","mapsquare","sequence","skeleton","frameset","animgroup","npc","framebase","texture","enum","overlay","underlay"].map(((e,t)=>[e,t])));function Uw(e,t,n){let r=e.mapsquarex+e.mapsquarez*SS
;n("mapsquare",r,e.chunkfilehash,e.chunkfileversion);for(let n of e.rawlocs)t("loc",n.id,"mapsquare",r);let i=new Set,a=new Set;for(let t of e.tiles)null!=t.overlay&&i.add(t.overlay),null!=t.underlay&&a.add(t.underlay)
;i.forEach((e=>t("overlay",e,"mapsquare",r))),a.forEach((e=>t("underlay",e,"mapsquare",r)))}const Bw=async(e,t,n,r)=>{await wm(20,(function*(){let t=r?.area??{x:0,z:0,xsize:100,zsize:200}
;for(let n=t.z;n<t.z+t.zsize;n++)for(let r=t.x;r<t.x+t.xsize;r++)yield HS(e,r,n)}),(e=>{e&&Uw(e,t,n)}))};function zw(e){return e?e[0]<<16|e[1]<<8|e[2]:16711935}function Gw(e,t){return t=D_(+!!e.bleedToUnderlay,t),t=D_(e.bleedpriority??-1,t),
t=D_(e.materialbyte??e.material??-1,t),t=D_(zw(e.color),t),t=D_(zw(e.secondary_colour),t),t=D_(zw(e.tertiary_colour),t),D_(e.material_tiling??-1,t)}const Vw=async(e,t,n)=>{for(let[r,i]of e.mapUnderlays.entries())i&&(n("underlay",r,Gw(i,0),0),
i.material&&t("material",i.material,"underlay",r))},Hw=async(e,t,n)=>{for(let[r,i]of e.mapOverlays.entries()){if(!i)continue;let e=Gw(i,0);i.material&&t("material",i.material,"overlay",r),n("overlay",r,e,0)}},jw=async(e,t,n)=>{
if(e.classicData)for(let[r,i]of e.classicData.objects.entries())n("loc",r,k_(Pw.from(JSON.stringify(i))),0),null!=i.model.id&&t("model",i.model.id,"loc",r);else for await(let{id:r,file:i}of Qw(e,xg.objects)){n("loc",r,k_(i),0)
;let a=Qg.object.read(i,e);if(a.probably_animation&&t("sequence",a.probably_animation,"loc",r),a.models)for(let e of a.models)for(let n of e.values)t("model",n,"loc",r)
;if(a.models_05)for(let e of a.models_05.models)for(let n of e.values)t("model",n,"loc",r);if(a.morphs_1||a.morphs_2){let e=$S(a);-1!=e&&t("loc",e,"loc",r)}}},Ww=async(e,t,n)=>{
if(e.classicData)for(let[t,r]of e.classicData.items.entries())n("item",t,k_(Pw.from(JSON.stringify(r))),0);else for await(let{id:r,file:i}of Qw(e,xg.items)){n("item",r,k_(i),0)
;let a=Qg.item.read(i,e),s=[].concat(a.baseModel,a.maleModels_0?.id,a.maleModels_1,a.maleModels_2,a.femaleModels_0?.id,a.femaleModels_1,a.femaleModels_2,a.maleHeads_0,a.maleHeads_1,a.femaleHeads_0,a.femaleHeads_1).filter((e=>"number"==typeof e))
;for(let e of s)t("model",e,"item",r);a.noteTemplate&&t("item",a.noteTemplate,"item",r)}},$w=async(e,t,n)=>{if(e.getBuildNr()<526)return;let r=await e.getArchiveById(xg.config,Ag.animgroups);for(let i of r){n("animgroup",i.fileid,k_(i.buffer),0)
;let r=Qg.animgroupConfigs.read(i.buffer,e),a=r.unknown_26??r.baseAnims?.idle;a&&t("sequence",a,"animgroup",i.fileid)}},qw=async(e,t,n)=>{if(e.getBuildNr()<=Cg){let r=await e.getArchiveById(Z_,iv)
;for(let e of r.map((e=>e.fileid)))n("material",e,0,0),t("texture",e,"material",e)}else if(e.getBuildNr()<=471){let r=await e.getArchiveById(xg.texturesOldPng,0);for(let i of r)n("material",i.fileid,k_(i.buffer),0),
t("texture",Qg.oldproctexture.read(i.buffer,e).spriteid,"material",i.fileid)}else if(e.getBuildNr()<759);else{let r=await e.getArchiveById(xg.materials,0);for(let i of r){n("material",i.fileid,k_(i.buffer),0);let r=A_(i.buffer,i.fileid,e)
;for(let e of Object.values(r.textures))"number"==typeof e&&t("texture",e,"material",i.fileid)}}},Xw=async(e,t,n)=>{
if(e.classicData)for(let[t,r]of e.classicData.npcs.entries())n("npc",t,k_(Pw.from(JSON.stringify(r))),0);else for await(let{id:r,file:i}of Qw(e,xg.npcs)){n("npc",r,k_(i),0);let a=Qg.npc.read(i,e)
;if(a.animation_group&&t("animgroup",a.animation_group,"npc",r),a.models)for(let e of a.models)t("model",e,"npc",r);if(a.headModels)for(let e of a.headModels)t("model",e,"npc",r)}};var Yw=n(8287).Buffer;const Kw={materialCube:1000001,
classicWall:1000002,classicWallDiag:1000003,classicRoof10:1000010,classicRoof12:1000012,classicRoof13:1000013,classicRoof14:1000014,classicRoof15:1000015,classicRoof16:1000016,classicRoof17:1000017
},Jw=new Map([[Kw.materialCube,Promise.resolve(nw)],[Kw.classicWall,Promise.resolve(rw)],[Kw.classicWallDiag,Promise.resolve(iw)],[Kw.classicRoof10,Promise.resolve(aw)],[Kw.classicRoof12,Promise.resolve(sw)],[Kw.classicRoof13,Promise.resolve(ow)],[Kw.classicRoof14,Promise.resolve(lw)],[Kw.classicRoof15,Promise.resolve(cw)],[Kw.classicRoof16,Promise.resolve(uw)],[Kw.classicRoof17,Promise.resolve(hw)]])
;class Zw extends Ev{static create(e){return new Zw(e).preload()}constructor(e){super(e),this.hasOldModels=!1,this.hasNewModels=!1,this.materialArchive=new Map,this.materialCache=new Map,this.mapUnderlays=[],this.mapOverlays=[],this.mapMapscenes=[],
this.mapMaplabels=[],this.legacyData=null,this.classicData=null,this.jsonSearchCache=new Map,this.dependencyGraph=null}async preload(){if(this.getBuildNr()>Cg){
for(let e of await this.getArchiveById(xg.config,Ag.mapunderlays))this.mapUnderlays[e.fileid]=Qg.mapsquareUnderlays.read(e.buffer,this.rawsource)
;for(let e of await this.getArchiveById(xg.config,Ag.mapoverlays))this.mapOverlays[e.fileid]=Qg.mapsquareOverlays.read(e.buffer,this.rawsource)
;if(this.getBuildNr()>=527)for(let e of await this.getArchiveById(xg.config,Ag.mapscenes))this.mapMapscenes[e.fileid]=Qg.mapscenes.read(e.buffer,this.rawsource)
;if(this.getBuildNr()>=548)for(let e of await this.getArchiveById(xg.config,Ag.maplabels))this.mapMaplabels[e.fileid]=Qg.maplabels.read(e.buffer,this.rawsource)
;if(this.getBuildNr()<=471)for(let e of await this.getArchiveById(xg.texturesOldPng,0))this.materialArchive.set(e.fileid,e.buffer);else if(this.getBuildNr()<=498);else if(this.getBuildNr()<=753){let e=await this.getFile(xg.materials,0)
;this.materialArchive.set(0,e)}else for(let e of await this.getArchiveById(xg.materials,0))this.materialArchive.set(e.fileid,e.buffer);let e=await this.getCacheIndex(xg.index);this.hasNewModels=!!e[xg.models],this.hasOldModels=!!e[xg.oldmodels]
}else if(this.getBuildNr()>Mg){this.legacyData=await async function(e){let t=await e.getArchiveById(Z_,rv),n=await e.getArchiveById(Z_,tv);return{items:ov(n,"OBJ"),objects:ov(n,"LOC"),overlays:ov(n,"FLO"),npcs:ov(n,"NPC"),underlays:[],spotanims:[],
mapmeta:sv(t)}}(this);let e=this.legacyData.overlays.map((e=>Qg.mapsquareOverlays.read(e,this)));this.mapOverlays=e,this.mapUnderlays=e,this.hasNewModels=!1,this.hasOldModels=!0}else{
if(!(this.rawsource instanceof Dv))throw new Error("can only load classic caches from a classic source");this.classicData=await async function(e,t){
let n=await e.getArchiveById(0,Iv.models),r=(await e.findSubfileByName(0,Iv.config,"STRING.DAT")).buffer,i=(await e.findSubfileByName(0,Iv.config,"INTEGER.DAT")).buffer,a=0,s=()=>{let e=a;for(;a<r.length&&0!=r[a++];);return r.toString("latin1",e,a-1)
},o=0,l=()=>{let e=i.readUint32BE(o);return o+=4,e},c=()=>{let e=i.readInt32BE(o);return o+=4,e},u=()=>{let e=i.readUint16BE(o);return o+=2,e},h=()=>i.readUint8(o++),d=()=>!!h(),p=Lv(u(),{name:s,examine:s,command:s,sprite:u,price:t<180?u:l,
stackable:d,special:d,equip:u,color:l,untradeable:t<180?()=>!1:d,member:t<180?()=>!1:d}),f=Lv(u(),{name:s,examine:s,command:t<180?()=>"":s,attack:h,strength:h,hits:h,defence:h,hostility:h,anims:()=>new Array(12).fill(null).map(h),haircolor:l,
topcolor:l,bottomcolor:l,skincolor:l,width:u,height:u,walkmodel:h,combatmodel:h,combatanim:h}),m=Lv(u(),{name:s,subname:s}),g=Lv(u(),{name:s,color:l,gendermodel:h,has_a:d,has_f:d,unk:h}),_=Lv(u(),{name:s,examine:s,command_0:s,command_1:s,model:()=>{
let e=s(),t=am(`${e}.ob3`,!0),r=n.find((e=>e.namehash==t))?.fileid;return{name:e,id:r}},xsize:h,zsize:h,type:h,item_height:h}),v=Lv(u(),{name:s,examine:s,command_0:s,command_1:s,height:u,frontdecor:c,backdecor:c,blocked:d,invisible:d}),y=Lv(u(),{
height:h,texture:h}),b=Lv(u(),{decor:l,type:()=>{let e=h();return{type:e,autoconnect:1==e||3==e,indoors:2==e,iswater:3==e,bridge:4==e}},blocked:d}),x=Lv(u(),{}),E=Lv(u(),{name:s,examine:s,level:h,num_runes:h,type:h,
runetypes:()=>new Array(h()).fill(null).map(u),runeamounts:()=>new Array(h()).fill(null).map(h)}),w=Lv(u(),{name:s,examine:s,level:h,drain:h});console.log(`decoded rsc config, ints ${o}/${i.length}, strings ${a}/${r.length}`);let S=[]
;if(e.usingversion.locsjson)try{let t=JSON.parse(await e.fs.readFileText(e.usingversion.locsjson)),n=944;S=t.sceneries.map((e=>({id:e.id,dir:e.direction,level:Math.floor(e.pos.Y/n),x:2304+e.pos.X,z:1776+e.pos.Y%n})))}catch(e){
console.warn("failed to load external classic locs")}return{items:p,npcs:f,textures:m,anims:g,objects:_,wallobjects:v,roofs:y,tiles:b,projectile:x,spells:E,prayers:w,jsonlocs:S}}(this.rawsource,this.getBuildNr()),this.mapUnderlays=function(){let e=[]
;for(let t=0;t<64;t+=1){const n=255-4*t,r=255-(1.75*t|0),i=255-4*t;e.push({color:[n,r,i]})}for(let t=0;t<64;t+=1){const n=3*t,r=144,i=0;e.push({color:[n,r,i]})}for(let t=0;t<64;t+=1){const n=192-(1.5*t|0),r=144-(1.5*t|0),i=0;e.push({color:[n,r,i]})}
for(let t=0;t<64;t++){const n=96-(1.5*t|0),r=48+(1.5*t|0),i=0;e.push({color:[n,r,i]})}return e.forEach((e=>{e.color[0]/=2,e.color[1]/=2,e.color[2]/=2})),e}(),this.mapOverlays=await async function(e){
let t=e.classicData,n=!await e.findSubfileByName(0,Iv.textures,"INDEX.DAT");return Promise.all(t.tiles.map((async r=>{let i=xw(r.decor),a=i.color;if(i.material){let r=t.textures[i.material-1],s=await uv(e,r.name,r.subname,n),o=0,l=0,c=0
;for(let e=0;e<s.img.data.length;e+=4)o+=s.img.data[e+0],l+=s.img.data[e+1],c+=s.img.data[e+2];let u=s.img.width*s.img.height;a=[o/u|0,l/u|0,c/u|0]}return{color:5==r.type.type?[255,0,255]:a,material:i.material}})))}(this),this.hasNewModels=!1,
this.hasOldModels=!0}return this}async getDependencyGraph(){return this.dependencyGraph??(this.dependencyGraph=async function(e,t){let n=new Map,r=new Map,i=new Map,a=(e,t,i,a)=>{let s=`${e}-${t}`,o=`${i}-${a}`,l=r.get(o);l||(l=[],r.set(o,l)),
-1==l.indexOf(s)&&l.push(s);let c=n.get(s);c||(c=[],n.set(s,c)),-1==c.indexOf(o)&&c.push(o)},s=(e,t,n,r)=>{let a=`${e}-${t}`;i.set(a,n)},o=async(t,n)=>{try{console.log(`starting ${t.name}`);let r=Date.now();await t(e,a,s,n),
console.log(`finished ${t.name}, duration ${((Date.now()-r)/1e3).toFixed(1)}`)}catch(e){throw e}},l=[jw,Ww,$w,qw,Xw,Hw,Vw];for(let e of l)await o(e,t);let c=(e,t)=>`${e}-${t}`,u=(e,t=[])=>{let n=`${e}-${i.get(e)??0}`;if(!t.includes(n)){t.push(n)
;let i=r.get(e);if(i)for(let e of i)u(e,t)}return t},h=(e,t=0)=>{let n=i.get(e)??0,[a,s]=e.split("-"),o=t;o=D_(Fw[a],o),o=D_(+s,o),o=D_(+n,o);let l=r.get(e);if(l)for(let e of l)o=h(e,o);return o};return{dependencyMap:r,dependentsMap:n,
cascadeDependencies:u,makeDeptName:c,hashDependencies:h,hasEntry:(e,t)=>i.has(c(e,t)),insertMapChunk:e=>{Uw(e,a,s);let t=e.mapsquarex+e.mapsquarez*SS;return c("mapsquare",t)},preloadChunkDependencies:e=>o(Bw,e)}}(this,{lazyMapChunks:!0})),
this.dependencyGraph}async getGameFile(e,t){return this.legacyData?this.legacyData[e][t]:this.getFileById(xg[e],t)}getMaterialData(e){let t=this.materialCache.get(e);if(!t){if(-1==e)t={textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,
baseColorFraction:0,baseColor:[1,1,1],alphamode:"opaque",alphacutoff:.1,stripDiffuseAlpha:!1,raw:null};else if(this.getBuildNr()<=Cg)t={textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,baseColor:[1,1,1],
alphamode:"opaque",alphacutoff:.1,stripDiffuseAlpha:!1,raw:null},t.textures.diffuse=e,t.baseColorFraction=1,t.texmodes="mirror",t.texmodet="mirror";else if(this.getBuildNr()<=471){let n=this.materialArchive.get(e)
;if(!n)throw new Error("material "+e+" not found");let r=Qg.oldproctexture.read(n,this);t={textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,baseColor:[1,1,1],alphamode:"opaque",alphacutoff:.1,stripDiffuseAlpha:!1,
raw:null},t.textures.diffuse=r.spriteid,t.baseColorFraction=1}else if(this.getBuildNr()<=753){if(t={textures:{},texmodes:"repeat",texmodet:"repeat",uvAnim:void 0,baseColorFraction:0,baseColor:[1,1,1],alphamode:"opaque",alphacutoff:.1,
stripDiffuseAlpha:!1,raw:null},this.getBuildNr()>=500){let n=Qg.oldmaterials.read(this.materialArchive.get(0),this).mats[e];null!=n.basecolorfraction&&null!=n.basecolor&&(t.baseColorFraction=n.basecolorfraction/255,t.baseColor=gm(bm(n.basecolor))),
t.textures.diffuse=n.id}}else{let n=this.materialArchive.get(e);if(!n)throw new Error("material "+e+" not found");t=A_(n,e,this.rawsource)}this.materialCache.set(e,t)}return t}getJsonSearchData(e){let t=this.jsonSearchCache.get(e);if(!t){let n=OE[e]
;if(!n)throw new Error("unknown decode mode "+e);t={files:(async()=>{await(n.prepareDump?.(this));let e=await n.lookup.logicalRangeToFiles(this,[0,0],[1/0,1/0]),t=null,r=[];for(let i of e){let e
;t&&t.index==i.index?e=t.subfiles:(e=await this.getFileArchive(i.index),t={index:i.index,subfiles:e});let a=e[i.subindex],s=n.lookup.fileToLogical(this,i.index.major,i.index.minor,a.fileid),o=n.parser.read(a.buffer,this.rawsource)
;o.$fileid=1==s.length?s[0]:s,r.push(o)}return r})(),schema:n.parser.parser.getJsonSchema()},this.jsonSearchCache.set(e,t)}return t}}async function*Qw(e,t){if(e.legacyData){let n=null
;if(t==xg.items?n=e.legacyData.items:t==xg.npcs?n=e.legacyData.npcs:t==xg.objects?n=e.legacyData.objects:t==xg.spotanims&&(n=e.legacyData.spotanims),!n)throw new Error(`cache major ${t} can not be iterated`);yield*n.map(((e,t)=>({id:t,file:e})))
}else if(e.getBuildNr()<=488){let n=await e.getArchiveById(xg.config,gv[t]);yield*n.map((e=>({id:e.fileid,file:e.buffer})))}else{let n=await e.getCacheIndex(t),r=mv[t];for(let t of n){if(!t)continue;let n=await e.getFileArchive(t);yield*n.map((e=>({
id:t.minor*r+e.fileid,file:e.buffer})))}}}class eS{constructor(e,t){this.modelCache=new Map,this.threejsTextureCache=new Map,this.threejsMaterialCache=new Map,this.textureType="dds",this.modelType="nxt",this.engine=e,
"auto"!=t?this.modelType=t:e.getBuildNr()<=Mg?this.modelType="classic":e.hasOldModels&&!e.hasNewModels?this.modelType="old":this.modelType="nxt"}static async create(e,t="auto",n="auto"){let r=new eS(e,n)
;return r.textureType="auto"==t?await async function(e){let t=async t=>{let n=-1;try{let r=await e.getCacheIndex(t),i=r[r.length-1];await e.getFile(i.major,i.minor,i.crc),n=i.minor}catch(e){}return n},n="none"
;if(e.getBuildNr()<=Mg)n=await e.findSubfileByName(0,Iv.textures,"INDEX.DAT")?"legacy":"legacytga";else if(e.getBuildNr()<=Cg)n="legacy";else if(e.getBuildNr()<=471)n="oldproc";else if(e.getBuildNr()<=736)n="fullproc";else{
let e=await t(xg.texturesBmp),r=await t(xg.texturesDds);if(e>0||r>0)n=e>r?"bmp":"dds";else{let e=await t(xg.textures2015Png),r=await t(xg.textures2015Dds);n=e>0||r>=0?r>e?"dds2014":"png2014":await t(xg.texturesOldPng)>0?"oldpng":"none"}}
return console.log(`detectedtexture mode. ${n}`),n}(e.rawsource):t,r}getTextureFile(e,t,n){let r=eS.textureIndices[e][this.textureType],i=(255|r)<<23|t,a=this.textureType;return this.engine.fetchCachedObject(this.threejsTextureCache,i,(async()=>{
if("fullproc"==a){let e=await Aw(this.engine,t),n=new m_(e.img,!1,!1);return n.filesize=e.filesize,n}if("legacytga"==a||"legacy"==a){let e;if(this.engine.classicData){let n=this.engine.classicData.textures[t-1]
;e=await uv(this.engine,n.name,n.subname,"legacytga"==a)}else{let n=await this.engine.getArchiveById(Z_,iv);e=await cv(this.engine,n[t].buffer)}return new m_(e.img,n,!1)}{let e=await this.engine.getFileById(r,t);if("oldproc"==a){let t=J_(e)
;return new m_(t[0].img,n,!1)}return new m_(e,n,!0)}}),(e=>2*e.filesize))}getModelData(e){if(e>=1e6){let t=Jw.get(e);if(!t)throw new Error(`constmodel ${e} does not exist`);return t}return this.engine.fetchCachedObject(this.modelCache,e,(async()=>{
if("nxt"==this.modelType)return function(e,t){let n=Qg.models.read(e,t),r=[];if(n.meshes)for(let e of n.meshes){if(e.isHidden)continue;let t=e.indexBuffers,n=t.map((e=>new ca(e,1))),i=t[0],a={pos:__(e.positionBuffer)};if(e.skin){
let t=new Uint16Array(4*e.vertexCount),n=new Uint8Array(4*e.vertexCount),r=e.skin.skinWeightBuffer,i=e.skin.skinBoneBuffer,s=0,o=0;for(let a=0;a<e.vertexCount;a++){let e=255;for(let l=0;l<4;l++){let c=r[o++],u=i[s++],h=0!=c?c:e;if(e-=c,
t[4*a+l]=65535==u?0:u,n[4*a+l]=h,0==c)break}}s==e.skin.skinWeightCount&&o==e.skin.skinWeightCount||console.log("model skin decode failed"),a.skinids=new ca(t,4),a.skinweights=new ca(n,4,!0)}if(e.colourBuffer){
if(!i)throw new Error("need index buf in order to read per-face colors");let t=new Uint8Array(4*e.vertexCount),n=e.alphaBuffer;for(let r=0;r<e.faceCount;r++){let[a,s,o]=_m(bm(e.colourBuffer[r]));for(let e=0;e<3;e++){let l=4*i[3*r+e];t[l+0]=a,
t[l+1]=s,t[l+2]=o,t[l+3]=n?n[r]:255}}a.color=new ca(t,4,!0)}e.boneidBuffer&&v_(a,e.boneidBuffer),e.uvBuffer&&y_(a,e.vertexCount,e.uvBuffer),e.normalBuffer&&b_(a,e.normalBuffer),r.push({indices:n[0],vertexstart:0,vertexend:a.pos.count,indexLODs:n,
materialId:e.materialArgument-1,hasVertexAlpha:!!e.alphaBuffer,needsNormalBlending:!1,attributes:a})}else if(n.meshdata){let e=n.meshdata,t={pos:__(e.positionBuffer)};if(e.vertexColours){let n=new Uint8Array(4*e.vertexCount),r=e.vertexAlpha
;for(let t=0;t<e.vertexColours.length;t++){let[i,a,s]=_m(bm(e.vertexColours[t])),o=r?r[t]:255,l=4*t;n[l+0]=i,n[l+1]=a,n[l+2]=s,n[l+3]=o}t.color=new ca(n,4,!0)}if(e.skin){let n=new Uint16Array(4*e.vertexCount),r=new Uint8Array(4*e.vertexCount)
;for(let t=0;t<e.skin.length;t++){let i=e.skin[t],a=255;if(i.ids.length!=i.weights.length)throw new Error("unexpected length difference in skin weights/ids");for(let e=0;e<i.ids.length;e++){let s=i.weights[e],o=i.ids[e],l=0!=s?s:a;if(a-=s,
n[4*t+e]=65535==o?0:o,r[4*t+e]=l,0==s)break}}t.skinids=new ca(n,4),t.skinweights=new ca(r,4,!0)}e.boneidBuffer&&v_(t,e.boneidBuffer),e.uvBuffer&&y_(t,e.vertexCount,e.uvBuffer),e.normalBuffer&&b_(t,e.normalBuffer);for(let n of e.renders){
if(n.isHidden)continue;if(0==n.buf.length)continue;let e=n.buf;if(4==e.BYTES_PER_ELEMENT){let t=new Uint32Array(e.length);for(let n=0;n<e.length;n++){let r=e[n];t[n]=r>>24&255|r>>8&65280|r<<8&16711680|r<<24&4278190080}e=t}let i=e[0],a=e[0]
;for(let t=0;t<e.length;t++){let n=e[t];n<i&&(i=n),n>a&&(a=n)}let s=new ca(e,1);r.push({indices:s,vertexstart:i,vertexend:a+1,indexLODs:[s],materialId:n.materialArgument-1,hasVertexAlpha:!!n.hasVertexAlpha,needsNormalBlending:!1,attributes:t})}}
return function(e){let t=0,n=0,r=0,i=0;for(let a of e){let e=a.attributes.pos;for(let r=0;r<e.count;r++){let i=e.getY(r);i>t&&(t=i),i<n&&(n=i)}let s=a.attributes.boneids;if(s){
for(let e=0;e<s.count;e++)r=Math.max(r,s.getX(e),s.getY(e),s.getZ(e),s.getW(e));r+=2}let o=a.attributes.skinids;if(o){for(let e=0;e<o.count;e++)i=Math.max(i,o.getX(e),o.getY(e),o.getZ(e),o.getW(e));i+=2}}return{maxy:t,miny:n,meshes:e,bonecount:r,
skincount:i}}(r)}(await this.engine.getFileById(xg.models,e),this.engine);if("old"==this.modelType){let t=this.engine.legacyData?Q_:xg.oldmodels;return function(e,t){let n=Qg.oldmodels.read(e,t),r=0,i=0,a=[],s=new na({wireframe:!0}),o=new na({
color:16711680}),l=new Int16Array(n.vertcount),c=new Int16Array(n.vertcount),u=new Int16Array(n.vertcount),h=0,d=0,p=0,f=new pm(n.posx),m=new pm(n.posy),g=new pm(n.posz);for(let e=0;e<n.vertcount;e++){let t=n.vertflags[e]
;1&t&&(h+=f.readShortSmartBias()),2&t&&(d+=-m.readShortSmartBias()),4&t&&(p+=g.readShortSmartBias()),l[e]=h,c[e]=d,u[e]=p,d>r&&(r=d),d<i&&(i=d)}if(!f.eof())throw new Error("stream not used to completion")
;if(!m.eof())throw new Error("stream not used to completion");if(!g.eof())throw new Error("stream not used to completion");let _=[];for(let e=0;e<n.texmapcount;e++){let t=n.texflags[e];_.push({texspace:new ci,vertexsum:new Dr,vertexcount:0,
vertexmin:new Dr(1e7,1e7,1e7),vertexmax:new Dr(-1e7,-1e7,-1e7),args:t})}let v,y=new Map,b=new Map,x=n.material,E=n.colors,w=[];if(n.modelversion>=16){v=32767;let e=new pm(n.uvs);for(;!e.eof();)w.push(e.readUShortSmart())
;if(!e.eof())throw new Error("stream not used to completion")}else v=255,w=Array.from(n.uvs);if(n.mode_2){x=new Uint16Array(n.facecount),E=E.slice();for(let e=0;e<n.facecount;e++){let t=n.mode_2[e];2&t&&(x[e]=fm(fm(E[e])+1),E[e]=fm(127),
w.push(1+(t>>2)))}}if(x)for(let e of x)y.set(e,(y.get(e)??0)+1);else y.set(0,n.facecount);for(let[e,t]of y){let r=3*t,i=E?n.alpha?4:3:0,a={pos:new ca(new Float32Array(3*r),3),normals:new ca(new Float32Array(3*r),3),
color:new ca(new Uint8Array(r*i),i,!0),texuvs:new ca(new Float32Array(2*r),2),index:new Uint16Array(3*t),currentface:0,matid:fm(e)-1};b.set(e,a)}let S=new Uint16Array(3*n.facecount),T=0,A=0,C=0,M=0,I=new pm(n.indexbuffer)
;for(let e=0;e<n.facecount;e++){let t=7&n.tritype[e];if(1==t)T=M+I.readShortSmartBias(),A=T+I.readShortSmartBias(),C=A+I.readShortSmartBias(),M=C;else if(2==t)A=C,C=M+I.readShortSmartBias(),M=C;else if(3==t)T=C,C=M+I.readShortSmartBias(),M=C;else{
if(4!=t)throw new Error("unkown face type");{let e=T;T=A,A=e,C=M+I.readShortSmartBias(),M=C}}S[3*e+0]=T,S[3*e+1]=A,S[3*e+2]=C}if(!I.eof())throw new Error("stream not used to completion");if(x){let e=new Dr,t=new Dr,r=new Dr,i=0
;for(let a=0;a<n.facecount;a++){if(0==x[a])continue;let n=i<w.length?w[i++]:0;if(0!=n&&n!=v){let i=_[n-1];T=S[3*a+0],A=S[3*a+1],C=S[3*a+2],e.set(l[T],c[T],u[T]),t.set(l[A],c[A],u[A]),r.set(l[C],c[C],u[C]),i.vertexsum.add(e).add(t).add(r),
i.vertexmin.min(e).min(t).min(r),i.vertexmax.max(e).max(t).max(r),i.vertexcount+=3}}}let R=!1;if(n.texflags){let e=new ci,t=new Dr,r=new Dr,i=new Dr,h=new Dr,d=n.texmap_verts_1??n.texmap_verts_2;for(let p=0;p<n.texflags.length;p++){let f=_[p]
;if(0==f.args.type){let[e,n,a]=d[f.args.vertindex];t.set(l[e],c[e],u[e]),r.set(l[n],c[n],u[n]),i.set(l[a],c[a],u[a]),r.sub(t),i.sub(t),h.copy(r).cross(i),f.texspace.set(r.x,i.x,h.x,t.x,r.y,i.y,h.y,t.y,r.z,i.z,h.z,t.z,0,0,0,1),f.texspace.invert()
}else if(f.args.type>=1){let r=n.texmap_projections[f.args.projection],i=1,a=1,s=1;if(1==f.args.type){let e=r.scale[0];e>0?(i=1,s=e/1024):e<0&&(i=-e/1024,s=1),i*=512,s*=512,a=64/(65535&r.scale[1])}else 2==f.args.type?(i=64/(65535&r.scale[0]),
a=64/(65535&r.scale[1]),s=64/(65535&r.scale[2])):(i=r.scale[0]/1024,a=r.scale[1]/1024,s=r.scale[2]/1024);isFinite(i)||(i=1,R=!0),isFinite(a)||(a=1,R=!0),isFinite(s)||(s=1,R=!0);let o=S_(r.normal[0],r.normal[1],r.normal[2],r.rotation,i,a,s)
;f.texspace.set(o[0],-o[1],o[2],0,o[3],-o[4],o[5],0,o[6],-o[7],o[8],0,0,0,0,1),t.copy(f.vertexmax).add(f.vertexmin).divideScalar(-2),e.makeTranslation(t.x,t.y,t.z),f.texspace.multiply(e)}if(globalThis.testmat>=0&&globalThis.testmat==p){
let e,t=new ah([new tr(.05,0),new tr(.05,1),new tr(.15,1),new tr(0,1.15)]);0==f.args.type?e=new gs(1,1):1==f.args.type?e=new lh(.5,.5,1,10):2==f.args.type?e=new $a(1,1,1):3==f.args.type&&(e=new Jh(1));let n=new ja(e,s),r=new ja(t,o)
;n.matrixAutoUpdate=!1,n.matrix.copy(f.texspace).invert(),r.matrixAutoUpdate=!1,r.matrix.copy(f.texspace).invert(),a.push(n,r)}}}R&&x_++<20&&console.warn("nonfinite texture scale");let k=null;if(n.texuvs){k=new Uint16Array(n.vertcount);let e=0
;for(let t=0;t<n.texuvs.vertex.length;t++)k[t]=e,e+=n.texuvs.vertex[t]}let N=0,D=new Dr,L=new Dr,O=new Dr,P=new Dr,F=new Dr,U=new Dr,B=new Dr,z=new nr;for(let e=0;e<n.facecount;e++){if(T=S[3*e+0],A=S[3*e+1],C=S[3*e+2],D.set(l[T],c[T],u[T]),
L.set(l[A],c[A],u[A]),O.set(l[C],c[C],u[C]),F.copy(L).sub(D),P.copy(O).sub(D).cross(F).normalize(),x&&0==x[e]&&!E||0==E[e])continue;let t=x?x[e]:0,r=b.get(t),i=r.currentface++,a=3*i,s=r.pos,o=r.texuvs,h=r.normals,d=r.index;if(Math.abs(1-P.length()),
s.setXYZ(a+0,D.x,D.y,D.z),s.setXYZ(a+1,L.x,L.y,L.z),s.setXYZ(a+2,O.x,O.y,O.z),h.setXYZ(a+0,P.x,P.y,P.z),h.setXYZ(a+1,P.x,P.y,P.z),h.setXYZ(a+2,P.x,P.y,P.z),E){let t=r.color,i=E[e],[s,o,l]=gm(bm(fm(i)));if(n.alpha){let r=(255-n.alpha[e])/255
;t.setXYZW(a+0,s,o,l,r),t.setXYZW(a+1,s,o,l,r),t.setXYZW(a+2,s,o,l,r)}else t.setXYZ(a+0,s,o,l),t.setXYZ(a+1,s,o,l),t.setXYZ(a+2,s,o,l)}if(t){let e=N<w.length?w[N++]:0
;if(0==e);else if(e==v)o.setXY(a+0,n.texuvs.udata[k[T]]/4096,n.texuvs.vdata[k[T]]/4096),o.setXY(a+1,n.texuvs.udata[k[A]]/4096,n.texuvs.vdata[k[A]]/4096),o.setXY(a+2,n.texuvs.udata[k[C]]/4096,n.texuvs.vdata[k[C]]/4096);else{let t=_[e-1]
;if(D.applyMatrix4(t.texspace),L.applyMatrix4(t.texspace),O.applyMatrix4(t.texspace),0==t.args.type)o.setXY(a+0,D.x,D.y),o.setXY(a+1,L.x,L.y),o.setXY(a+2,O.x,O.y);else if(1==t.args.type){
let e=Math.atan2(D.z,D.x)/Math.PI/2*3,t=Math.atan2(L.z,L.x)/Math.PI/2*3,n=Math.atan2(O.z,O.x)/Math.PI/2*3;o.setXY(a+0,e-.5,D.y-.5),o.setXY(a+1,t-.5,L.y-.5),o.setXY(a+2,n-.5,O.y-.5)}else if(2==t.args.type){F.copy(L).sub(D),U.copy(O).sub(D).cross(F),
z.setFromMatrix4(t.texspace),U.applyMatrix3(z);let e=Math.max(U.x,-U.x,U.y,-U.y,U.z,-U.z)
;if(U.x==e)z.set(0,0,1,0,-1,0,0,0,0);else if(U.x==-e)z.set(0,0,-1,0,-1,0,0,0,0);else if(U.z==e)z.set(1,0,0,0,-1,0,0,0,0);else if(U.z==-e)z.set(-1,0,0,0,-1,0,0,0,0);else if(U.y==e)z.set(1,0,0,0,0,1,0,0,0);else{if(U.y!=-e)throw new Error("unexpected")
;z.set(1,0,0,0,0,1,0,0,0)}F.copy(D).applyMatrix3(z).subScalar(.5),U.copy(L).applyMatrix3(z).subScalar(.5),B.copy(O).applyMatrix3(z).subScalar(.5),o.setXY(a+0,F.x,F.y),o.setXY(a+1,U.x,U.y),o.setXY(a+2,B.x,B.y)}else if(3==t.args.type){
let e=Math.atan2(D.z,D.x)/Math.PI/2,t=Math.atan2(L.z,L.x)/Math.PI/2,n=Math.atan2(O.z,O.x)/Math.PI/2,r=Math.atan2(D.y,Math.sqrt(D.x*D.x+D.z*D.z))/Math.PI/2,i=Math.atan2(L.y,Math.sqrt(L.x*L.x+L.z*L.z))/Math.PI/2,s=Math.atan2(O.y,Math.sqrt(O.x*O.x+O.z*O.z))/Math.PI/2
;o.setXY(a+0,e,r),o.setXY(a+1,t,i),o.setXY(a+2,n,s)}}if(globalThis.testmat>=0&&globalThis.testmat!=e-1){o.setXY(a+0,0,0),o.setXY(a+1,0,0),o.setXY(a+2,0,0);let e=r.color;e.setXYZ(a+0,0,0,0),e.setXYZ(a+1,0,0,0),e.setXYZ(a+2,0,0,0)}}d[3*i+0]=a+0,
d[3*i+1]=a+2,d[3*i+2]=a+1}let G=[...b.values()].map((e=>{let t=new ca(e.index,1);return{indices:t,vertexstart:0,vertexend:e.pos.count,indexLODs:[t],materialId:e.matid,hasVertexAlpha:!!n.alpha,needsNormalBlending:!0,attributes:{pos:e.pos,
color:e.color,texuvs:e.texuvs,normals:e.normals}}}));if(n.modelversion<=7){const e=4;r*=e,i*=e;for(let t of G){let n=t.attributes.pos.array;for(let t=0;t<n.length;t++)n[t]*=e}}return{maxy:r,miny:i,meshes:G,bonecount:0,skincount:0,debugmeshes:a}
}(await this.engine.getFileById(t,e),this.engine.rawsource)}if("classic"==this.modelType)return function(e,t){let n=Qg.classicmodels.read(e,t),r=new Map,i=(e,t)=>{if(32767==e)return;if(t<3)return;let n=32768&e?-1:e+1,i=r.get(n);i||(i={tris:0,verts:0
},r.set(n,i)),i.verts+=t,i.tris+=t-2};for(let e of n.faces)i(e.color,e.verts.length),i(e.backcolor,e.verts.length);let a=new Map;for(let[e,t]of r.entries())a.set(e,{pos:new ca(new Float32Array(3*t.verts),3),
normals:new ca(new Float32Array(3*t.verts),3),color:new ca(new Uint8Array(3*t.verts),3,!0),texuvs:new ca(new Float32Array(2*t.verts),2),index:new Uint16Array(3*t.tris),currentface:0,currentindex:0,matid:e});let s=(e,t,r,i)=>{let a=t[r]
;return-1==e.matid?e.color.setXYZ(e.currentface,(~i>>10&31)/31,(~i>>5&31)/31,(31&~i)/31):e.color.setXYZ(e.currentface,1,1,1),e.pos.setXYZ(e.currentface,4*n.xpos[a],4*-n.ypos[a],4*n.zpos[a]),e.normals.setXYZ(e.currentface,o.x,o.y,o.z),
e.texuvs.setXY(e.currentface,0==r||3==r?0:1,0==r||1==r?0:1),e.currentface++},o=new Dr,l=new Dr,c=new Dr,u=new Dr;for(let e of n.faces)if(!(e.verts.length<3)){if(32767!=e.color){let t=e.verts.at(-1),r=e.verts.at(-2),i=e.verts.at(-3)
;l.set(n.xpos[t],-n.ypos[t],n.zpos[t]),c.set(n.xpos[r],-n.ypos[r],n.zpos[r]),u.set(n.xpos[i],-n.ypos[i],n.zpos[i]),c.sub(l),u.sub(l),o.copy(c).cross(u).normalize()
;let h=a.get(32768&e.color?-1:e.color+1),d=s(h,e.verts,e.verts.length-1,e.color),p=s(h,e.verts,e.verts.length-2,e.color);for(let t=e.verts.length-3;t>=0;t--){let n=s(h,e.verts,t,e.color);h.index[h.currentindex++]=d,h.index[h.currentindex++]=p,
h.index[h.currentindex++]=n,p=n}}if(32767!=e.backcolor){let t=e.verts[0],r=e.verts[1],i=e.verts[2];l.set(n.xpos[t],-n.ypos[t],n.zpos[t]),c.set(n.xpos[r],-n.ypos[r],n.zpos[r]),u.set(n.xpos[i],-n.ypos[i],n.zpos[i]),c.sub(l),u.sub(l),
o.copy(c).cross(u).normalize();let h=a.get(32768&e.backcolor?-1:e.backcolor+1),d=s(h,e.verts,0,e.backcolor),p=s(h,e.verts,1,e.backcolor);for(let t=2;t<e.verts.length;t++){let n=s(h,e.verts,t,e.backcolor);h.index[h.currentindex++]=d,
h.index[h.currentindex++]=p,h.index[h.currentindex++]=n,p=n}}}return{bonecount:0,miny:0,maxy:0,skincount:0,meshes:[...a.values()].map((e=>{let t=new ca(e.index,1);return{indices:t,vertexstart:0,vertexend:e.pos.count,attributes:{pos:e.pos,
color:e.color,texuvs:e.texuvs,normals:e.normals},hasVertexAlpha:!1,indexLODs:[t],materialId:e.matid,needsNormalBlending:!0}}))}}((await this.engine.getArchiveById(0,Iv.models))[e].buffer,this.engine);throw new Error("unexpected")
}),(e=>30*e.meshes.reduce(((e,t)=>t.indices.count),0)))}getMaterial(e,t,r){let i=T_(e,t,r);return this.engine.fetchCachedObject(this.threejsMaterialCache,i,(async()=>async function(e,t,r,i){var a;let s=new od;s.alphaTest="cutoff"==t.alphamode?.5:.1,
s.transparent=r||"blend"==t.alphamode;const o="clamp"==t.texmodes?_e:"repeat"==t.texmodes?ge:ve,l="clamp"==t.texmodet?_e:"repeat"==t.texmodet?ge:ve;if(void 0!==t.textures.diffuse&&"none"!=e.textureType){
let n=await(await e.getTextureFile("diffuse",t.textures.diffuse,t.stripDiffuseAlpha)).toImageData(),r=new Uc(n.data,n.width,n.height,Ge);if(r.needsUpdate=!0,r.wrapS=o,r.wrapT=l,r.colorSpace=Xt,r.magFilter=Se,r.minFilter=xe,r.generateMipmaps=!0,
s.map=r,t.textures.normal){let r=await e.getTextureFile("normal",t.textures.normal,!1),i=await r.toImageData(),a=Am(null,i.width,i.height),c=Am(null,i.width,i.height);const u=i.data;for(let e=0;e<u.length;e+=4){let t=u[e+1]/127.5-1,r=u[e+3]/127.5-1
;a.data[e+0]=u[e+1],a.data[e+1]=u[e+3],a.data[e+2]=127.5*(Math.sqrt(Math.max(1-t*t-r*r,0))+1),a.data[e+3]=255;const i=u[e+0]/255;c.data[e+0]=n.data[e+0]*i,c.data[e+1]=n.data[e+1]*i,c.data[e+2]=n.data[e+2]*i,c.data[e+3]=255}
s.normalMap=new Uc(a.data,a.width,a.height,Ge),s.normalMap.needsUpdate=!0,s.normalMap.wrapS=o,s.normalMap.wrapT=l,s.normalMap.magFilter=Se,s.emissiveMap=new Uc(c.data,c.width,c.height,Ge),s.emissiveMap.needsUpdate=!0,s.emissiveMap.wrapS=o,
s.emissiveMap.wrapT=l,s.emissiveMap.magFilter=Se,s.emissive.setRGB(1,1,1)}if(t.textures.compound){let n=await(await e.getTextureFile("compound",t.textures.compound,!1)).toImageData(),r=Am(null,n.width,n.height)
;for(let e=0;e<n.data.length;e+=4)r.data[e+1]=n.data[e+1],r.data[e+2]=n.data[e+0],r.data[e+3]=255;let i=new Uc(r.data,r.width,r.height,Ge);i.needsUpdate=!0,i.wrapS=o,i.wrapT=l,i.colorSpace=Xt,i.magFilter=Se,s.metalnessMap=i,s.roughnessMap=i,
s.metalness=1}}return s.vertexColors=1!=t.baseColorFraction||!t.textures.diffuse||r,s.userData=t,t.uvAnim&&(((a=s.userData).gltfExtensions??(a.gltfExtensions={})).RA_materials_uvanim={uvAnim:[t.uvAnim.u,t.uvAnim.v]}),i&&(s=function(e,t,r){
let i=new Ja;i.uniforms={uAlphaTestThreshold:{value:[-1]},uAmbientColour:{value:[.6059895753860474,.5648590922355652,.5127604007720947]},uAtlasMeta:{value:[512,16,.0001220703125,4]},uCameraPosition:{value:[1638400,17248,1671168]},uDummy:{value:[1]},
uFade:{value:[0]},uFullScreenLookupScale:{value:[0,5.960465188081798e-8,1,0]},uInscatteringAmount:{value:[1,0,0]},uInvSunDirection:{value:[-.5391638875007629,.6469966173171997,-.5391638875007629]},uModelMatrix:{
value:[1,0,0,0,0,1,0,0,0,0,1,0,1630208,0,1654784,1]},uOutscatteringAmount:{value:[1638400,17248,1671168]},uProjectionMatrix:{value:[152587890625e-16,0,0,0,0,-152587890625e-16,0,0,0,0,-6200397183420137e-20,0,0,0,-1.0317461490631104,1]},
uScatteringParameters:{value:[0,-1,5.960465188081798e-8,0]},uScatteringTintColour:{value:[0,5.960465188081798e-8,1]},uSunColour:{value:[.8666666746139526,.8078431487083435,.7333333492279053]},uTextureAnimationTime:{value:[459.7019958496094]},
uTextureAtlas:{value:[5]},uTextureAtlasSettings:{value:[6]},uTint:{value:[0,0,0,0]},uVertexScale:{value:[1]},uViewMatrix:{value:[1,0,0,0,0,5.960465188081798e-8,1,0,0,-1,5.960465188081798e-8,0,-1638400,1671168,-17248.099609375,1]},uViewProjMatrix:{
value:[152587890625e-16,0,0,0,0,-9094948101931455e-28,-6200397183420137e-20,0,0,152587890625e-16,-3695725149521767e-27,0,-25,-25.5,.03770458698272705,1]},uViewportLookupScale:{value:[1638400,17248,1671168,0]},uViewportOffsetScale:{value:[1,0,0,0]},
uZBufferParams:{value:[16777248,32256,-32768,-512.0009765625]}},i.vertexColors=!0;let a=n(8977);a=Ow(a),a=Dw(a,Mw),a=Lw(a,Rw);let s=n(7274);return s=Ow(s),s=Dw(s,Mw),s=Lw(s,Rw),s=s.replace(/#undef gl_FragColor/,"// $&"),
s=s.replace(/void getTextureSettings\(/,"void getTextureSettings(vec2 s, out TextureSettings settings){\nsettings.textureMeta1 = vec3(0.0,0.0,8196.0);\nsettings.textureMeta2 = vec3(0.0,0.0,8196.0);\nsettings.uvAnim = vec2(0.0,0.0);\nsettings.wrapping = 0.0;\nsettings.specular = 0.0;\nsettings.normalScale = 0.0;\n}\nvoid getTextureSettingsOld("),
s=s.replace(/(?<!void )getTexel\(\w+,/gm,(()=>"getTexel(vTextureUV,")),s=function(e){
return(e=e.replace(/\bvoid main\(/,"void originalMain("))+"\n"+"\n        void main(){\n            super();\n            //pre-multiply alpha\n            // gl_FragColor.rgb *= gl_FragColor.a;\n            // gl_FragColor.rgb = vec3( gl_FragColor.a);\n            gl_FragColor.a=1.0;\n            \n        }\n    ".replace(/super\(/,"originalMain(")
}(s),i.vertexShader=a,i.fragmentShader=s,i.uniforms.uTextureAtlas={value:e},i.uniforms.uInvSunDirection.value[2]*=-1,i.uniforms.uAlphaTestThreshold={value:[r]},i.uniformsNeedUpdate=!0,"blend"==t&&(i.transparent=!0),e&&(e.colorSpace=Xt),i
}(s.map,t.alphamode,t.alphacutoff)),{mat:s,matmeta:t}}(this,this.engine.getMaterialData(e),t,r)),(e=>524288))}}function tS(e){return e>255?255:e<0?0:e}function nS(e,t,n,r=!1){let i=e.geometry.getAttribute("color"),a=!!i&&4==i.itemSize
;e.material=t.mat;let s=n&&1==t.matmeta.baseColorFraction?[.5,.5,.5]:t.matmeta.baseColor;if(1!=t.matmeta.baseColorFraction||s.some((e=>1!=e))||n||!t.matmeta.textures.diffuse||a){if(0!=t.matmeta.baseColorFraction){
let n=e.geometry.getAttribute("position").count,i=e.geometry.getAttribute("color"),o=1-t.matmeta.baseColorFraction,l=t.matmeta.baseColorFraction*s[0]*255,c=t.matmeta.baseColorFraction*s[1]*255,u=t.matmeta.baseColorFraction*s[2]*255,h=a?4:3,d=r&&i?i:new ca(new Uint8Array(h*n),h,!0)
;if(a&&!i)throw new Error("material has vertex alpha, but mesh doesn't have vertex colors");let[p,f,m]=QE(i),[g,_,v]=QE(d),y=!!i;for(let e=0;e<n;e++){let t=_+v*e,n=f+m*e,r=y?p[n+0]:255,i=y?p[n+1]:255,s=y?p[n+2]:255;g[t+0]=tS(r*o+l),g[t+1]=tS(i*o+c),
g[t+2]=tS(s*o+u),a&&(g[t+3]=y?p[n+3]:255)}e.geometry.setAttribute("color",d)}}else e.geometry.getAttribute("color")&&e.geometry.deleteAttribute("color")}async function rS(e,t){let n=new Pi,r=null;if(0!=t.bonecount||0!=t.skincount){
let e=[],i=Math.max(t.bonecount,t.skincount),a=new Fc;n.add(a);for(let t=0;t<i;t++)e.push(a);r=new Gc(e)}for(let i of t.meshes){let t,a=i.attributes,s=new Aa;if(s.setAttribute("position",a.pos),a.color&&s.setAttribute("color",a.color),
a.normals&&s.setAttribute("normal",a.normals),a.texuvs&&s.setAttribute("uv",a.texuvs),a.skinids&&s.setAttribute("RA_skinIndex_skin",a.skinids),a.skinweights&&s.setAttribute("RA_skinWeight_skin",a.skinweights),
a.boneids&&s.setAttribute("RA_skinIndex_bone",a.boneids),a.boneweights&&s.setAttribute("RA_skinWeight_bone",a.boneweights),s.index=i.indices,a.skinids||a.boneids){t=new Pc(s);let e=!!s.attributes.RA_skinIndex_bone
;s.attributes.skinIndex||(s.attributes.skinIndex=e?s.attributes.RA_skinIndex_bone:s.attributes.RA_skinIndex_skin,s.attributes.skinWeight=e?s.attributes.RA_skinWeight_bone:s.attributes.RA_skinWeight_skin),t.bind(r)}else t=new ja(s)
;nS(t,await e.getMaterial(i.materialId,i.hasVertexAlpha,!1),!1),n.add(t)}return t.debugmeshes&&0!=t.debugmeshes.length&&n.add(...t.debugmeshes),n}function iS(e,t){let n=t.location,r=n.width??1,i=n.length??1;t.rotation%2==1&&([r,i]=[i,r]);let a=[]
;for(let n=0;n<=1;n++)for(let i=0;i<=r;i++)for(let s=0;s<=r;s++)a.push(GS(e,t.x+s,t.z+i,t.plane+n));let s=GS(e,t.x,t.z,t.plane),o=vS(t);for(let e of a)o=D_(e-s,o);return o}eS.textureIndices={diffuse:{png:xg.texturesPng,dds:xg.texturesDds,
bmp:xg.texturesBmp,ktx:xg.texturesKtx,png2014:xg.textures2015Png,dds2014:xg.textures2015Dds,oldpng:xg.texturesOldPng,oldproc:xg.sprites,fullproc:xg.texturesOldPng,legacy:Z_,legacytga:0},normal:{png:xg.texturesPng,dds:xg.texturesDds,
bmp:xg.texturesBmp,ktx:xg.texturesKtx,png2014:xg.textures2015CompoundPng,dds2014:xg.textures2015CompoundDds,oldpng:xg.texturesOldCompoundPng,oldproc:0,fullproc:0,legacy:0,legacytga:0},compound:{png:xg.texturesPng,dds:xg.texturesDds,
bmp:xg.texturesBmp,ktx:xg.texturesKtx,png2014:xg.textures2015CompoundPng,dds2014:xg.textures2015CompoundDds,oldpng:xg.texturesOldCompoundPng,oldproc:0,fullproc:0,legacy:0,legacytga:0}};const aS=new ca(new Float32Array(3),3);function sS(e,t){
let n=t[0],r=new Dr,i=new Dr;r.set(0,0,0);let a=0;for(let e of t){for(let t=0;t<e.model.indices.count;t++){let n=e.model.indices.getX(t);i.fromBufferAttribute(e.model.attributes.pos,n),r.add(i)}a+=e.model.indices.count}r.divideScalar(a),
aS.setXYZ(0,r.x,r.y,r.z);let s=BS(aS,n.morph,e,n.maxy-n.miny,0,0);return i.fromBufferAttribute(s,0),i.divideScalar(bS),i}function oS(e,t,n){let r=new Map,i=[],a=new Map;for(let[s,o]of t){
if(s.x<n.x||s.z<n.z||s.x>=n.x+n.xsize||s.z>=n.z+n.zsize)continue;let t=r.get(s.locid);if(t||(t=s.location,r.set(s.locid,t)),!t.name)continue;let l=sS(e,o),c=iS(e,s);i.push({id:s.locid,x:s.x,z:s.z,l:s.plane,r:s.rotation,h:c,
center:[+l.x.toFixed(2),+l.y.toFixed(2),+l.z.toFixed(2)]}),l.x-=s.x,l.y-=GS(e,s.x,s.z,s.plane)/bS,l.z-=s.z,a.set(c,{center:[+l.x.toFixed(2),+l.y.toFixed(2),+l.z.toFixed(2)],locdata:s})}return{locs:i,
locdatas:Object.fromEntries([...r].filter((([e,t])=>t.name))),hashes:a}}function lS(e,t,n){let r=[];for(let i=0;i<n.tilerect.xsize;i+=2)for(let a=0;a<n.tilerect.zsize;a+=2){let s=new Array(e.levels).fill(0),o=0,l=[],c=[];for(let t=0;t<e.levels;t++){
let r=t;for(let u=0;u<2;u++)for(let h=0;h<2;h++){let d=0,p=e.getTile(n.tilerect.x+i+u,n.tilerect.z+a+h,t);if(!p||!p.underlayVisible&&!p.overlayVisible)continue;r=Math.min(r,p.effectiveVisualLevel);let f=p.debug_raw
;if(!f)throw new Error("can't calculate chunkhash since rawtile isn't set");d=D_(f.height??-1,d),d=D_(f.overlay??-1,d),d=D_(f.settings??-1,d),d=D_(f.shape??-1,d),d=D_(f.underlay??-1,d),d=D_(p.effectiveVisualLevel,d),
null!=f.overlay&&-1==l.indexOf(f.overlay)&&l.push(f.overlay),null!=f.underlay&&-1==c.indexOf(f.underlay)&&c.push(f.underlay),o=Math.max(o,p.y,p.y01,p.y10,p.y11);for(let t=p.effectiveVisualLevel;t<e.levels;t++)s[t]=D_(d,s[t])}}let u=0
;l.forEach((e=>u=t.hashDependencies(t.makeDeptName("overlay",e),u))),c.forEach((e=>u=t.hashDependencies(t.makeDeptName("underlay",e),u))),r.push({x:i,z:a,xzsize:2,maxy:o,dephash:u,tilehashes:s})}return r}function cS(e,t){
return e.plane-t.plane||e.x-t.x||e.z-t.z||e.rotation-t.rotation||e.type-t.type}function uS(e,t,n,r,i){const a=new ca(new Float32Array(24),3),s=new Dr,o=new Dr,l=new Dr;let c=new Map;for(let e of n.keys())lm(c,e.locid,(()=>[])).push(e);let u=[]
;for(let[h,d]of c){let c={id:h,dependencyhash:t.hashDependencies(t.makeDeptName("loc",h)),instances:[]};u.push(c);for(let t of d){let u=n.get(t);s.set(0,0,0),o.set(0,0,0);for(let e of u){let t=e.model.attributes.pos
;for(let e=0;e<t.count;e++)l.set(t.getX(e),t.getY(e),t.getZ(e)),s.min(l),o.max(l)}a.setXYZ(0,s.x,s.y,s.z),a.setXYZ(1,s.x,s.y,o.z),a.setXYZ(2,s.x,o.y,s.z),a.setXYZ(3,s.x,o.y,o.z),a.setXYZ(4,o.x,s.y,s.z),a.setXYZ(5,o.x,s.y,o.z),a.setXYZ(6,o.x,o.y,s.z),
a.setXYZ(7,o.x,o.y,o.z);let h=u[0],d=[...BS(a,h.morph,e,h.maxy,r*xS*bS,i*xS*bS).array].map((e=>0|e));c.instances.push({plane:t.plane,x:t.x,z:t.z,rotation:t.rotation,type:t.type,visualLevel:t.visualLevel,placementhash:vS(t),bounds:d})}
c.instances.sort(cS)}return u.sort(((e,t)=>e.id-t.id)),u}function hS(e){let t=e.x*bS,n=t+e.xzsize*bS,r=e.z*bS,i=r+e.xzsize*bS,a=e.maxy;return[t,0,r,t,0,i,t,a,r,t,a,i,n,0,r,n,0,i,n,a,r,n,a,i]}function dS(e,t,n,r){let i=[];for(let a=0;a<e.length;a++){
let s=e[a],o=t[a],l=Math.max(n,r),c=!1;(s.dephash!=o.dephash||s.tilehashes.length<=l||o.tilehashes.length<=l||s.tilehashes[n]!=o.tilehashes[r])&&(c=!0),c&&(i.push(hS(s)),i.push(hS(o)))}return i}function pS(e,t,n,r){let i=[],a=0,s=0;for(;;){
let o=a<e.length?e[a]:void 0,l=s<t.length?t[s]:void 0;if(!o&&!l)break;if(o&&l&&o.id==l.id){if(o.dependencyhash==l.dependencyhash)for(let e=0,t=0;;){let a=o.instances.at(e),s=l.instances.at(t);if(a&&a.visualLevel>n&&(a=void 0),
s&&s.visualLevel>r&&(s=void 0),!a&&!s){if(e>=o.instances.length&&t>=l.instances.length)break;e++,t++;continue}let c=a?s?cS(a,s):1:-1;0==c?(a.placementhash!=s.placementhash&&(i.push(a.bounds),i.push(s.bounds)),e++,t++):c<0?(i.push(s.bounds),
t++):(i.push(a.bounds),e++)}else i.push(...o.instances.map((e=>e.bounds))),i.push(...l.instances.map((e=>e.bounds)));a++,s++}else!o||l&&l.id<o.id?(i.push(...l.instances.map((e=>e.bounds))),
s++):(!l||o&&o.id<l.id)&&(i.push(...o.instances.map((e=>e.bounds))),a++)}return i}async function fS(e,t,n=[255,0,0]){let r=(e,t,r,i,a)=>e.mat(-1).addTriangle(n,t.slice(3*r,3*r+3),t.slice(3*i,3*i+3),t.slice(3*a,3*a+3)),i=new Wl;i.matrixAutoUpdate=!1,
i.updateMatrix();for(let n of t){let t=new tw;r(t,n,0,4,1),r(t,n,0,1,4),r(t,n,4,5,1),r(t,n,4,1,5),r(t,n,1,5,3),r(t,n,1,3,5),r(t,n,5,7,3),r(t,n,5,3,7),r(t,n,3,7,2),r(t,n,3,2,7),r(t,n,7,6,2),r(t,n,7,2,6),r(t,n,2,6,0),r(t,n,2,0,6),r(t,n,6,4,0),
r(t,n,6,0,4),r(t,n,0,1,2),r(t,n,0,2,1),r(t,n,1,3,2),r(t,n,1,2,3),r(t,n,4,6,7),r(t,n,4,7,6),r(t,n,4,7,5),r(t,n,4,5,7),i.add(await rS(e,t.convert()))}return i}async function mS(e,t,n,r,i,a){let s=await e.engine.getDependencyGraph()
;await s.preloadChunkDependencies({area:{x:r,z:i,xsize:1,zsize:1}});let o=uS(n,s,t,r,i),l=new Wl;for(let t of o)for(let n of t.instances){if(n.visualLevel!=a)continue;let r=t.dependencyhash^n.placementhash,i=[r>>16&255,r>>8&255,255&r]
;l.add(await fS(e,[n.bounds],i))}return l.userData={modeltype:"overlay",isclickable:!1,modelgroup:"hashbox_objects"+a,level:a},l}async function gS(e,t,n,r){let i=await e.engine.getDependencyGraph();await i.preloadChunkDependencies({area:{
x:n.mapsquarex,z:n.mapsquarez,xsize:1,zsize:1}});let a=lS(t,i,n),s=new Wl;for(let t of a){let n=0;n=D_(t.dephash,n),n=D_(t.tilehashes[r],n);let i=[n>>16&255,n>>8&255,255&n],a=hS(t);s.add(await fS(e,[a],i))}return s.userData={modeltype:"overlay",
isclickable:!1,modelgroup:"hashbox_floor"+r,level:r},s}function _S(e,t){const n=new Dr,r=new Dr,i=new Dr;for(let a of t){for(let t=0;t<a.length;t+=3)i.set(a[t+0],a[t+1],a[t+2]),i.applyMatrix4(e),0==t?(n.copy(i),r.copy(i)):(n.min(i),r.max(i))
;if(n.x<1&&r.x>-1&&n.y<1&&r.y>-1)return!0}return!1}function vS(e){let t=0;return t=D_(e.resolvedlocid,t),t=D_(e.rotation,t),t=D_(e.type,t),e.placement&&(e.placement.rotation&&(t=D_(e.placement.rotation[0],t),t=D_(e.placement.rotation[1],t),
t=D_(e.placement.rotation[2],t),t=D_(e.placement.rotation[3],t)),t=D_(e.placement.translateX??0,t),t=D_(e.placement.translateY??0,t),t=D_(e.placement.translateZ??0,t),t=D_(e.placement.scale??0,t),t=D_(e.placement.scaleX??0,t),
t=D_(e.placement.scaleY??0,t),t=D_(e.placement.scaleZ??0,t)),t}globalThis.test=async(e,t,n=0,r=e)=>{let i=await e.cache.engine.getDependencyGraph(),a=await r.cache.engine.getDependencyGraph();if(await i.preloadChunkDependencies({area:{x:e.chunkx,
z:e.chunkz,xsize:1,zsize:1}}),await a.preloadChunkDependencies({area:{x:r.chunkx,z:r.chunkz,xsize:1,zsize:1}}),await e.chunkdata,await r.chunkdata,!e.loaded||!r.loaded)return
;let s=pS(uS(e.loaded.grid,i,e.loaded.modeldata,e.chunkx,e.chunkz),uS(r.loaded.grid,a,r.loaded.modeldata,r.chunkx,r.chunkz),t,n),o=await fS(e.cache,s);e.rootnode.children[0].add(o),o.userData={modeltype:"overlay",isclickable:!1,
modelgroup:`cmplocs_${t}_${n}`,level:t};let l=dS(lS(e.loaded.grid,i,e.loaded.chunk),lS(r.loaded.grid,a,r.loaded.chunk),t,n),c=await fS(e.cache,l);return e.rootnode.children[0].add(c),c.userData={modeltype:"overlay",isclickable:!1,
modelgroup:`cmpfloor_${t}_${n}`,level:t},e.emit("changed",void 0),()=>{let t=globalThis.render.getCurrent2dCamera();if(!t)return;e.rootnode.updateWorldMatrix(!0,!1)
;let n=(new ci).makeTranslation(e.chunkx*bS*e.loaded.chunkSize,0,e.chunkz*bS*e.loaded.chunkSize).premultiply(e.rootnode.matrixWorld),r=t.projectionMatrix.clone().multiply(t.matrixWorldInverse).multiply(n),i=_S(r,s),a=_S(r,l);return{locschanged:i,
floorchanged:a,anychanged:i||a}}};class yS{constructor(e,t,n,r){this.cachedMetas=[],this.cacheSize=15,this.config=t,this.deps=n;let i=+e.getCacheMeta().timestamp
;this.targetversions=r.versions.slice().sort(((e,t)=>Math.abs(e.date-i)-Math.abs(t.date-i))).slice(0,10).map((e=>e.version))}getEntry(e,t){let n=this.cachedMetas.find((n=>n.x==e&&n.z==t));if(!n){let r=(async()=>{
if(!this.config.rendermetaLayer||!this.config.getRelatedFiles)return[];let n=`${this.config.rendermetaLayer.name}/${e}-${t}.${this.config.rendermetaLayer.usegzip?"json.gz":"json"}`,r=await this.config.getRelatedFiles([n],this.targetversions)
;r=r.filter((e=>e.buildnr!=this.config.version));let i=r.map((e=>this.config.getFileResponse(e.file,e.buildnr).then((async t=>({buildnr:e.buildnr,firstbuildnr:e.firstbuildnr,meta:await t.json()})))));return Promise.all(i)})();for(n={x:e,z:t,metas:r},
this.cachedMetas.push(n);this.cachedMetas.length>this.cacheSize;)this.cachedMetas.shift()}return n}getRect(e){let t=[];for(let n=e.z;n<e.z+e.zsize;n++)for(let r=e.x;r<e.x+e.xsize;r++)t.push(this.getEntry(r,n));return t}async forkDeps(e){
let t=await(this.config.getRelatedFiles?.(e,this.targetversions))??[],n=[],r=[];return{allFiles:t,findMatches:async(e,i)=>{let a=[],s=r.find((e=>e.file==i));if(s){let t=!0,o=[];for(let r=e.z;r<e.z+e.zsize;r++)for(let i=e.x;i<e.x+e.xsize;i++){
let e=n.find((e=>e.x==i&&e.z==r));e?o.push(e):t=!1}t&&r.some((e=>e.file==i))&&a.push({file:s,metas:o})}let o=this.getRect(e),l=await Promise.all(o.map((e=>e.metas))),c=t.filter((e=>e.file==i));e:for(let e of c){let t=[];for(let n of l){
let r=n.find((t=>t.buildnr>=e.firstbuildnr&&t.firstbuildnr<=e.buildnr));if(!r)continue e;t.push(r.meta)}a.push({file:e,metas:t})}return a},addLocalFile:e=>{r.push(e)},addLocalSquare:e=>{n.some((t=>t.x==e.x&&t.z==e.z))||n.push(e)}}}}
const bS=512,xS=64,ES=48,wS=4,SS=128,TS=1/16,AS=new Dr(0,1,0),CS={material:-1,materialTiling:128,materialBleedpriority:-1,color:[255,0,255]},{tileshapes:MS,defaulttileshape:IS,defaulttileshapeflipped:RS}=function(){let e=[{subvertex:0,nextx:!1,
nextz:!0,subx:0,subz:1},{subvertex:1,nextx:!1,nextz:!0,subx:.5,subz:1},{subvertex:0,nextx:!0,nextz:!0,subx:1,subz:1},{subvertex:2,nextx:!0,nextz:!1,subx:1,subz:.5},{subvertex:0,nextx:!0,nextz:!1,subx:1,subz:0},{subvertex:1,nextx:!1,nextz:!1,subx:.5,
subz:0},{subvertex:0,nextx:!1,nextz:!1,subx:0,subz:0},{subvertex:2,nextx:!1,nextz:!1,subx:0,subz:.5},{subvertex:3,nextx:!1,nextz:!1,subx:.5,subz:.5}];function t(t,n){return 8==t?e[8]:e[t=(t+2*n)%8]}let n=[];for(let e=0;e<48;e++){
let r=[],i=[],a=e%4,s=e-a;if(0==s)r.push(0,2,4,6);else if(4==s||36==s||40==s)r.push(0,4,6),i.push(0,2,4),36==s&&(a+=1),40==s&&(a+=3);else if(8==s)r.push(0,1,6),i.push(1,2,4,6);else if(12==s)r.push(1,2,4),i.push(0,1,4,6);else if(16==s)r.push(1,2,4,6),
i.push(0,1,6);else if(20==s)r.push(0,1,4,6),i.push(1,2,4);else if(24==s)r.push(0,1,5,6),i.push(1,2,4,5);else if(28==s)r.push(5,6,7),i.push(2,4,5,7,0);else if(32==s)r.push(2,4,5,7,0),i.push(5,6,7);else{if(44!=s)throw new Error("shouldnt happen")
;r.push(4,6,8),i.push(8,6,0,2,4)}n[e]={overlay:r.map((e=>t(e,a))),underlay:i.map((e=>t(e,a)))}}return{tileshapes:n,defaulttileshape:{overlay:[],underlay:[0,2,4,6].map((e=>t(e,0)))},defaulttileshapeflipped:{overlay:[],
underlay:[2,4,6,0].map((e=>t(e,0)))}}}();function kS(e,t,n){return!(t<e.x||t>=e.x+e.xsize||n<e.z||n>=e.z+e.zsize)}let NS=new Map,DS=new Set;function LS(e,t="default"){
DS.has(t)&&(console.error("scratchbuffer hasn't been returned since last use, leaking memory by creating new buffer."),DS.delete(t),NS.delete(t));let n=NS.get(t);return(!n||n&&n.byteLength<e)&&(n=new ArrayBuffer(e),NS.set(t,n),
console.log("allocating new scratchbuf mb:",(e/1e6).toFixed(2))),DS.add(t),[n,r=>{if(DS.delete(t),r>e)throw new Error("larger slice of scratchbuffer requested than was reserved");return n.slice(0,r)}]}class OS{addUnderlay(e,t){
let n=null!=t?e.mapUnderlays[t-1]:void 0;n&&(!n.color||255==n.color[0]&&0==n.color[1]&&255==n.color[2]||(this.underlayVisible=!0),this.underlayprops={material:n.material??-1,materialTiling:n.material_tiling??128,materialBleedpriority:-1,
color:n.color??[255,0,255]},this.rawUnderlay=n,this.originalUnderlayColor=this.underlayprops.color,this.vertexprops.fill(this.underlayprops))}addOverlay(e,t,n){let r=null!=t?e.mapOverlays[t-1]:void 0
;r&&(!r.color||255==r.color[0]&&0==r.color[1]&&255==r.color[2]||(this.overlayVisible=!0),this.overlayprops={material:r.materialbyte??r.material??-1,materialTiling:r.material_tiling??128,materialBleedpriority:r.bleedpriority??0,
color:r.color??(null!=r.materialbyte?[255,255,255]:[255,0,255])},this.bleedsOverlayMaterial=!!r.bleedToUnderlay,this.rawOverlay=r),null!=n&&(this.shape=MS[n])}addUnderWater(e,t,n,r){this.waterProps={y00:this.y,y01:this.y,y10:this.y,y11:this.y,
props:this.overlayprops,shape:this.shape.overlay,isoriginal:this.shape==IS||this.shape==RS,rawOverlay:this.rawOverlay};let i=this.underlayprops;this.underlayVisible=!1,this.overlayVisible=!1,this.bleedsOverlayMaterial=!1,this.rawOverlay=void 0,
this.addUnderlay(e,r),this.addOverlay(e,n,null),this.overlayVisible||(this.overlayVisible=!0,this.overlayprops=i,this.bleedsOverlayMaterial=!0),this.y=this.y01=this.y10=this.y11=this.y-t*bS*TS}constructor(e,t,n,r,i,a){this.debug_nxttile=null,
this.debug_raw=null,this.rawOverlay=void 0,this.rawUnderlay=void 0,this.next01=void 0,this.next10=void 0,this.next11=void 0,this.shape=IS,this.underlayVisible=!1,this.overlayVisible=!1,this.normalX=0,this.normalZ=0,this.bleedsOverlayMaterial=!1,
this.originalUnderlayColor=CS.color,this.rawCollision=void 0,this.effectiveCollision=void 0,this.waterProps=null;let s=e*bS*TS;this.settings=t,this.x=n,this.y=s,this.z=r,this.y01=s,this.y10=s,this.y11=s,this.playery00=s,this.playery01=s,
this.playery10=s,this.playery11=s,this.effectiveLevel=i,this.effectiveVisualLevel=0;let o,l={...CS};this.vertexprops=[l,l,l,l],this.underlayprops=l,this.overlayprops=l,a&&(o={settings:t??0,walk:[!!(1&(t??0)),!1,!1,!1,!1,!1,!1,!1,!1],
sight:[!1,!1,!1,!1,!1,!1,!1,!1,!1]}),this.rawCollision=o,this.effectiveCollision=o}}function PS(e){let t=e%4,n=(t+2)%4,r=e-t;if(0==r)return 0+n;if(4==r)return 4+n;if(8==r)return 16+t;if(12==r)return 20+t;if(16==r)return 8+t;if(20==r)return 12+t
;if(24==r)return 24+n;if(28==r)return 32+t;if(36==r)return 40+t;if(40==r)return 36+t;if(32==r)return 28+t;if(44==r)return console.log("unknown inverse shape"),0;throw new Error("unexpected")}function FS(e,t){
let n,r=t.replaceMaterials?.find((t=>t[0]==e.materialId))?.[1],i={...e};if(null!=r&&(i.materialId=65535==r?-1:r),"number"==typeof t.lodLevel&&-1!=t.lodLevel&&(i.indices=e.indexLODs[Math.min(t.lodLevel,e.indexLODs.length-1)]),
t.replaceColors&&0!=t.replaceColors.length&&e.attributes.color){let r=e.attributes.color,i=[];for(let e of t.replaceColors){let t=_m(bm(e[0])),n=_m(bm(e[1]));i.push([t[0]<<16|t[1]<<8|t[2],n])}for(let e=0;e<r.count;e++){
let t=255*r.getX(e)<<16|255*r.getY(e)<<8|255*r.getZ(e);for(let a of i)if(t==a[0]){n||(n=r.clone()),n.setXYZ(e,a[1][0]/255,a[1][1]/255,a[1][2]/255);break}}}return n&&(i.attributes={...e.attributes,color:n}),i}function US(e,t,n){
return(new ci).makeTranslation(e.translate.x-t,e.translate.y,e.translate.z-n).multiply((new ci).makeRotationFromQuaternion(e.rotation)).multiply((new ci).makeScale(e.scale.x,e.scale.y,e.scale.z))}function BS(e,t,n,r,i,a,s,o=0,l=0,c=e.count){
let u=US(t,i,a),h=GS(n,t.originx/bS,t.originz/bS,t.level),d=new Dr,p="followfloor"==t.placementMode||"followfloorceiling"==t.placementMode,f="followfloorceiling"==t.placementMode,m=f&&r>0?1/r:1,g=c-l;s??(s=new ca(new Float32Array(3*g),3))
;let[_,v,y]=QE(e),[b,x,E]=QE(s),w=x+o*E,S=v+l*y;for(let e=0;e<g;e++){let r=w+E*e,s=S+y*e;d.x=_[s+0],d.y=_[s+1],d.z=_[s+2];let o=d.y;if(d.applyMatrix4(u),p){let e=(d.x+i)/bS,r=(d.z+a)/bS;if(f){
let i=o*m,a=GS(n,e,r,t.level),s=GS(n,e,r,t.level+1)-t.scaleModelHeightOffset;d.y+=s*i-o+a*(1-i)}else d.y+=GS(n,e,r,t.level)}else d.y+=h;b[r+0]=d.x,b[r+1]=d.y,b[r+2]=d.z}return s}class zS{constructor(e){this.grids=e}getTile(e,t,n){
for(let r of this.grids)if(e>=r.rect.x&&e<r.rect.x+r.rect.xsize&&t>=r.rect.z&&t<r.rect.z+r.rect.zsize)return r.src.getTile(e,t,n)}}function GS(e,t,n,r){let i=Math.floor(t),a=Math.floor(n),s=e.getTile(i,a,r);if(!s)return 0
;if(s.waterProps)return s.waterProps.y00;let o=(1-(t-i))*(1-(n-a)),l=(t-i)*(1-(n-a)),c=(1-(t-i))*(n-a),u=(t-i)*(n-a);return s.y*o+s.y01*l+s.y10*c+s.y11*u}class VS{constructor(e,t,n){this.levels=4,this.area=t,this.tilemask=n?.filter((e=>{return r=t,
!((n=e).x>=r.x+r.xsize||n.x+n.xsize<=r.x||n.z>=r.z+r.zsize||n.z+n.zsize<=r.z);var n,r})),this.engine=e,this.xoffset=t.x,this.zoffset=t.z,this.xsize=t.xsize,this.zsize=t.zsize,this.xstep=1,this.zstep=this.xstep*t.xsize,
this.levelstep=this.zstep*t.zsize,this.tiles=new Array(this.levelstep*this.levels).fill(void 0)}getHeightCollisionFile(e,t,n,r,i){let a=new Uint16Array(r*i*2);for(let s=0;s<i;s++)for(let i=0;i<r;i++){let o=this.getTile(e+i,t+s,n);if(o){
let e=2*(i+s*r),t=(o.playery00+o.playery01+o.playery10+o.playery11)/4;a[e+0]=t/16;let n=0,l=o.effectiveCollision;for(let e=0;e<9;e++){let t=l.walk[e]?l.sight[e]?2:1:0;n+=Math.pow(3,e)*t}a[e+1]=n}}return a}getTile(e,t,n){if(e-=this.xoffset,
t-=this.zoffset,!(e<0||t<0||e>=this.xsize||t>=this.zsize))return this.tiles[this.levelstep*n+t*this.zstep+e*this.xstep]}blendUnderlays(){for(let e=this.zoffset;e<this.zoffset+this.zsize;e++)for(let t=this.xoffset;t<this.xoffset+this.xsize;t++){
let n=0,r=this.getTile(t,e,1),i=2&(r?.settings??0)?-1:0;for(let r=0;r<this.levels;r++){let a=this.getTile(t,e,r);if(!a)continue;if(!a.debug_nxttile){let n=0,i=0,s=0,o=0;for(let a=-4;a<=5;a++)for(let l=-4;l<=5;l++){let c=this.getTile(t+l,e+a,r)
;if(!c||!c.underlayVisible)continue;let u=c.originalUnderlayColor;n+=u[0],i+=u[1],s+=u[2],o++}o>0&&(a.underlayprops.color=[n/o,i/o,s/o])}this.getTile(t-1,e-1,r)
;let s=this.getTile(t,e-1,r),o=this.getTile(t+1,e-1,r),l=this.getTile(t+1,e,r),c=this.getTile(t+1,e+1,r),u=this.getTile(t,e+1,r),h=this.getTile(t-1,e+1,r),d=this.getTile(t-1,e,r),p=0,f=0;d&&l&&(p=(l.y-d.y)/(2*bS)),s&&u&&(f=(u.y-s.y)/(2*bS))
;let m=Math.hypot(p,f,1);a.normalZ=-p/m,a.normalX=-f/m,a.y01=l?.y??a.y,a.y10=u?.y??a.y,a.y11=c?.y??a.y,a.playery00=a.y,a.playery01=l?.y??a.y01,a.playery10=u?.y??a.y10,a.playery11=c?.y??a.y11,a.next01=l,a.next10=u,a.next11=c;let g=r+i
;8&(a.settings??0)&&(n=0);let _=this.getTile(t,e,g),v=!!(4&(_?.settings??0));_&&g!=r&&(_.effectiveCollision=a.rawCollision,_.playery00=a.playery00,_.playery01=a.playery01,_.playery10=a.playery10,_.playery11=a.playery11),a.effectiveLevel=g,
a.effectiveVisualLevel=Math.max(a.effectiveVisualLevel,n);for(let i=-1;i<=1;i++)for(let a=-1;a<=1;a++){let s=this.getTile(t+a,e+i,r);s&&!(8&(s.settings??0))&&(s.effectiveVisualLevel=Math.max(s.effectiveVisualLevel,n))}if(v&&(n=g+1),
a.waterProps)0==a.waterProps.shape.length&&(a.waterProps.shape=c?.waterProps||u?.waterProps||l?.waterProps?MS[0].overlay:MS[4].overlay);else{let e=u?.waterProps?.isoriginal||l?.waterProps?.isoriginal;c?.waterProps?.isoriginal&&e?a.waterProps={
...c.waterProps,isoriginal:!1,shape:MS[0].overlay}:c?.waterProps?.isoriginal?a.waterProps={...c.waterProps,isoriginal:!1,shape:MS[6].overlay}:h?.waterProps?.isoriginal&&u?.waterProps?.isoriginal?a.waterProps={...h.waterProps,isoriginal:!1,
shape:MS[5].overlay}:o?.waterProps?.isoriginal&&l?.waterProps?.isoriginal&&(a.waterProps={...o.waterProps,isoriginal:!1,shape:MS[7].overlay})}a.waterProps&&(l?.waterProps&&(a.waterProps.y01=l.waterProps.y00),
u?.waterProps&&(a.waterProps.y10=u.waterProps.y00),c?.waterProps?a.waterProps.y11=c.waterProps.y00:l?.waterProps?a.waterProps.y11=l.waterProps.y10:u?.waterProps&&(a.waterProps.y11=u.waterProps.y01))}}
for(let e=this.zoffset;e<this.zoffset+this.zsize;e++)for(let t=this.xoffset;t<this.xoffset+this.xsize;t++)for(let n=0;n<this.levels;n++){let r=this.getTile(t,e,n);if(r&&r.bleedsOverlayMaterial)for(let e of r.shape.overlay){let t=r
;e.nextx&&e.nextz?t=t.next11:e.nextx?t=t.next01:e.nextz&&(t=t.next10),t&&t.vertexprops[e.subvertex].materialBleedpriority<r.overlayprops.materialBleedpriority&&(t.vertexprops[e.subvertex]=r.overlayprops)}}}gatherMaterials(e,t,n,r){
let i=new Map,a=(e,t)=>{let n=1;const r=128;t<r?n=r/t+1:t%r!=0&&(n=1+r/t);let a=i.get(e);(!a||a<n)&&i.set(e,n)};for(let i=0;i<this.levels;i++)for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=this.getTile(e+r,t+s,i)
;n&&(-1!=n.underlayprops.material&&a(n.underlayprops.material,n.underlayprops.materialTiling),-1!=n.overlayprops.material&&a(n.overlayprops.material,n.overlayprops.materialTiling),
n.waterProps&&-1!=n.waterProps.props.material&&a(n.waterProps.props.material,n.waterProps.props.materialTiling))}return i}addMapsquare(e,t,n,r,i=!1){if(e.length!=n.xsize*n.zsize*r)throw new Error
;let a=(n.x-this.xoffset)*this.xstep+(n.z-this.zoffset)*this.zstep;for(let s=0;s<n.zsize;s++)for(let o=0;o<n.xsize;o++){if(!kS(this.area,n.x+o,n.z+s))continue;if(this.tilemask&&!this.tilemask.some((e=>kS(e,n.x+o,n.z+s))))continue
;let l=(n.x+o)*bS,c=(n.z+s)*bS,u=s+o*n.zsize,h=0;for(let d=0;d<this.levels;d++){let p,f=d<r?e[u]:{},m=null,g=f.height;if(t){let e=[t.level0,t.level1,t.level2,t.level3][d];e&&(m=e[66*(o+1)+s+1],g=16&m.flags?m.rest?.waterheight:m.height)}
if(h+=null!=g&&0!=g?1==g?0:g:30,m){let e=m.flags,t=!!(16&e),n=(2&e?1:0)|(4&e?2:0)|(8&e?4:0)|(32&e?8:0)|(64&e?16:0);t&&(n|=128),p=new OS(h,n,l,c,d,i)
;let r=m.rest?.overlay_under??m.rest?.overlay,a=m.rest?.underlay_under??m.rest?.underlay,s=t?PS(m.rest?.shape??0):m.rest?.shape;p.addUnderlay(this.engine,a),p.addOverlay(this.engine,r,s),
t&&p.addUnderWater(this.engine,m.height,m.rest?.overlay,m.rest?.underlay),p.debug_raw=f,p.debug_nxttile=m,p.originalUnderlayColor=_m(bm(m.rest?.underlaycolor??0)),p.underlayprops.color=p.originalUnderlayColor}else p=new OS(h,f.settings??0,l,c,d,i),
p.addUnderlay(this.engine,f.underlay),p.addOverlay(this.engine,f.overlay,f.shape),p.debug_raw=f;let _=a+this.xstep*o+this.zstep*s+this.levelstep*d;this.tiles[_]=p,u+=n.xsize*n.zsize}}}}async function HS(e,t,n){
let r,i,a=e.classicData?ES:xS,s=t+n*SS,o=null,l={},c=[],u=wS,h=0,d=0;if(e.getBuildNr()>Mg){let u=null,p=null,f=null;if(e.getBuildNr()>=759){let t=(await e.getCacheIndex(xg.mapsquares))[s];if(!t)return null;h=t.crc,d=t.version
;let n=await e.getFileArchive(t),r=t.subindices.indexOf(wg);if(-1==r)return null;u=n[r].buffer;let i=t.subindices.indexOf(Eg);if(-1!=i&&(f=n[i].buffer),e.getBuildNr()>=861){let e=t.subindices.indexOf(Sg);-1!=e&&(p=n[e].buffer)}
}else if(e.getBuildNr()>Cg){try{let r=await e.findFileByName(xg.mapsquares,`m${t}_${n}`);if(!r)return null;h=r.crc,d=r.version,u=await e.getFile(r.major,r.minor,r.crc)}catch(e){return null}try{let r=await e.findFileByName(xg.mapsquares,`l${t}_${n}`)
;r&&(h=D_(r.crc,h),d=Math.max(d,r.version),f=await e.getFile(r.major,r.minor,r.crc))}catch(e){}}else{let r=256*t+n,i=e.legacyData?.mapmeta.get(r);if(!i)return null;try{h=i.crc,d=i.version,u=await e.getFile(ev,i.map),f=await e.getFile(ev,i.loc)}catch{
console.warn(`map for ${t}_${n} declared but file did not exist`)}}if(!u)return null;let m=Qg.mapsquareTiles.read(u,e.rawsource);p&&(o=Qg.mapsquareTilesNxt.read(p,e.rawsource)),r=m.tiles,l=m.extra,
f&&(c=Qg.mapsquareLocations.read(f,e.rawsource).locations),i={x:t*a,z:n*a,xsize:a,zsize:a}}else{let a=await async function(e,t,n){let r=n>=100,i=0;const a=e.classicData
;let s=100-t,o=100-(r?n-100:n),l=`${s.toString().padStart(2,"0")}${o.toString().padStart(2,"0")}`,c=[],u=r?1:3;for(let t=0;t<u;t++){
let n=r?3:t,i=e.getBuildNr()<=115?void 0:await e.findSubfileByName(0,Iv.land,`m${n}${l}.hei`),a=await e.findSubfileByName(0,Iv.maps,`m${n}${l}.jm`);if(!i&&!a&&0==t)return null;c.push({sourcelevel:n,hei:i?.buffer,jm:a?.buffer,loc:void 0,dat:void 0})}
let h=new bw(a,u);for(let t=0;t<u;t++){let n=c[t];if(!n.jm){let t=await e.findSubfileByName(0,Iv.maps,`M${n.sourcelevel}${l}.DAT`),r=await e.findSubfileByName(0,Iv.maps,`M${n.sourcelevel}${l}.LOC`);n.dat=t?.buffer,n.loc=r?.buffer}}
for(let e=0;e<u;e++){let t=c[e];t.jm?(h.loadJmFile(t.jm,e),i=k_(t.jm,i)):t.hei&&(h.loadHeiFile(t.hei,e),i=k_(t.hei,i))}for(let e=0;e<u;e++){let t=c[e];if(!t.jm)if(t.dat&&(h.loadDatfile(t.dat,e),i=k_(t.dat,i)),t.loc)h.loadLocFile(t.loc,e),
i=k_(t.loc,i);else{let n=ww(a,s,o,t.sourcelevel);i=k_(pw.from(n.buffer),i),h.addLocBuffer(n,e)}}return{rect:{x:t*fw,z:n*fw,xsize:fw,zsize:fw},mapfilehash:i,tiles:h.convertTiles(),locs:h.locs,levels:u}}(e,t,n);if(!a)return null;r=a.tiles,i=a.rect,
u=a.levels,c=a.locs,h=a.mapfilehash}return{tilerect:i,levelcount:u,mapsquarex:t,mapsquarez:n,chunkfilehash:h,chunkfileversion:d,tiles:r,nxttiles:o,extra:l,rawlocs:c,locs:[]}}async function jS(e,t,n,r){
let i=r?.padfloor?20:0,a=e.classicData?ES:xS,s=Math.ceil(i/a),o=new VS(e,{x:t*a-i,z:n*a-i,xsize:a+2*i,zsize:a+2*i},r?.mask),l=null;for(let i=-s;i<=s;i++)for(let a=-s;a<=s;a++){let s=await HS(e,t+a,n+i)
;s&&(o.addMapsquare(s.tiles,s.nxttiles,s.tilerect,s.levelcount,!!r?.collision),s.mapsquarex==t&&s.mapsquarez==n&&(l=s))}return e.classicData&&function(e){for(let t=0;t<e.levels;t++)for(let n=e.zsize-1;n>=1;n--)for(let r=e.xsize-1;r>=1;r--){
let i=e.getTile(e.xoffset+r,e.zoffset+n,t),a=e.getTile(e.xoffset+r-1,e.zoffset+n-1,t);i&&a&&(i.y=a.y,i.underlayprops=a.underlayprops,i.effectiveLevel=t,i.effectiveVisualLevel=t)}
let t=t=>t?.debug_raw?.overlay?e.engine.classicData.tiles[t.debug_raw?.overlay-1]:void 0;for(let n=0;n<e.levels;n++)for(let r=e.zsize-1;r>=1;r--)for(let i=e.xsize-1;i>=1;i--){let a=e.getTile(e.xoffset+i,e.zoffset+r,n),s=t(a)
;if(a&&(s?.type.autoconnect||s?.type.indoors)){s.blocked&&(a.rawCollision&&(a.rawCollision.walk[0]=!0),a.effectiveCollision&&(a.effectiveCollision.walk[0]=!0))
;let o=t(e.getTile(e.xoffset+i,e.zoffset+r+1,n)),l=t(e.getTile(e.xoffset+i-1,e.zoffset+r,n)),c=t(e.getTile(e.xoffset+i+1,e.zoffset+r,n)),u=t(e.getTile(e.xoffset+i,e.zoffset+r-1,n)),h=s.type.indoors?o?.type.indoors:o?.type.autoconnect,d=s.type.indoors?l?.type.indoors:l?.type.autoconnect,p=s.type.indoors?c?.type.indoors:c?.type.autoconnect,f=s.type.indoors?u?.type.indoors:u?.type.autoconnect
;h&&d&&!f&&!p&&(a.shape=MS[5]),h&&!d&&!f&&p&&(a.shape=MS[6]),!h&&!d&&f&&p&&(a.shape=MS[7]),!h&&d&&f&&!p&&(a.shape=MS[4])}}}(o),o.blendUnderlays(),l&&(l.locs=await async function(e,t,n,r,i,a=!1){let s=[],o=await Promise.all(n.map((t=>qS(e,t.id))))
;for(let e=0;e<n.length;e++){let l=n[e],{morphedloc:c,rawloc:u,resolvedid:h}=o[e];if(c)for(let e of l.uses){let n=t.getTile(e.x+r,e.y+i,e.plane);if(!n)continue;let o=c.width??1,d=c.length??1;e.rotation%2==1&&([o,d]=[d,o]);let p=n.effectiveVisualLevel
;for(let n=0;n<d;n++)for(let a=0;a<o;a++){let s=t.getTile(e.x+r+a,e.y+i+n,e.plane);s&&s.effectiveVisualLevel>p&&(p=s.effectiveVisualLevel)}s.push({location:c,locid:l.id,resolvedlocid:h,placement:e.extra,sizex:o,sizez:d,x:e.x+r,z:e.y+i,type:e.type,
rotation:e.rotation,plane:e.plane,visualLevel:p,effectiveLevel:n.effectiveLevel,forceVisible:!!(8&n.settings)});const f=[9,10,11,12,13,14,15,16,17,18,19,20,21];if(a&&!u.probably_nocollision)for(let a=0;a<d;a++)for(let s=0;s<o;s++){
let o=t.getTile(e.x+r+s,e.y+i+a,n.effectiveLevel);if(o){let t=o.effectiveCollision;22==e.type&&u.maybe_blocks_movement&&(t.walk[0]=!0),0==e.type?(t.walk[1+e.rotation]=!0,
u.maybe_allows_lineofsight||(t.sight[1+e.rotation]=!0)):2==e.type?(t.walk[1+e.rotation]=!0,t.walk[1+(e.rotation+1)%4]=!0,u.maybe_allows_lineofsight||(t.sight[1+e.rotation]=!0,
t.sight[1+(e.rotation+1)%4]=!0)):1==e.type||3==e.type?(t.walk[5+e.rotation]=!0,u.maybe_allows_lineofsight||(t.sight[5+e.rotation]=!0)):f.includes(e.type)&&(t.walk[0]=!0,u.maybe_allows_lineofsight||(t.sight[0]=!0))}}}}return s
}(e,o,l.rawlocs,l.tilerect.x,l.tilerect.z,!!r?.collision)),{grid:o,chunk:l,chunkSize:a,chunkx:t,chunkz:n}}class WS{constructor(e,t){this.padsize=32,this.allocs=[],this.map=new Map,this.allocx=0,this.allocy=0,this.allocLineHeight=0,this.result=null,
this.resultSource=null,this.width=e,this.height=t}addTexture(e,t,n){null!=this.result&&(this.result=null,console.log("adding textures to atlas after creation of texture"))
;let r=Math.floor(t.width*n),i=Math.floor(t.height*n),a=r+2*this.padsize,s=i+2*this.padsize;if(this.allocx+a>this.width&&(this.allocx=0,this.allocy+=this.allocLineHeight,this.allocLineHeight=0),this.allocLineHeight=Math.max(this.allocLineHeight,s),
this.allocy+this.allocLineHeight>this.height)return!1;let o={u:(this.allocx+this.padsize)/this.width,v:(this.allocy+this.padsize)/this.height,usize:t.width/this.width,vsize:t.height/this.height,x:this.allocx+this.padsize,y:this.allocy+this.padsize,
repeatWidth:r,repeatHeight:i,totalpixels:(this.padsize+r+this.padsize)*(this.padsize+i+this.padsize),img:t};return this.allocs.push(o),this.allocx+=a,this.map.set(e,o),!0}convertToThreeTexture(){return this.resultSource??(this.resultSource=(()=>{
let e=new Pu(this.convert());return e.flipY=!1,e.magFilter=Se,e.minFilter=Ae,e.generateMipmaps=!0,e.colorSpace=Xt,e})())}convert(){if(this.result)return this.result;let e=document.createElement("canvas");e.width=this.width,e.height=this.height
;let t=e.getContext("2d",{willReadFrequently:!0}),n=(e,n,r,i=0,a=0,s=e.width,o=e.height)=>{t.drawImage(e,i,a,s,o,n,r,s,o)};for(let e of this.allocs){let t=-this.padsize,a=e.repeatWidth+this.padsize,s=-this.padsize,o=e.repeatHeight+this.padsize
;for(let l=s;l<o;l=r){var r=Math.min(o,Math.ceil((l+1)/e.img.height)*e.img.height);for(let s=t;s<a;s=i){var i=Math.min(a,Math.ceil((s+1)/e.img.width)*e.img.width);n(e.img,e.x+s,e.y+l,um(s,e.img.width),um(l,e.img.height),i-s,r-l)}}}
return this.result=e,e}}function $S(e){let t=-1;return e.morphs_1&&(t=e.morphs_1.unk2[0]??e.morphs_1.unk3),e.morphs_2&&(t=e.morphs_2.unk2),32767==t&&(t=-1),65535==t&&(t=-1),t}async function qS(e,t){let n=t;if(e.classicData){let r=function(e,t){
const n=e.classicData;let r={};if(t>=_w){let e=n.roofs[t-_w];r={name:"roof_"+(t-_w),models:[{type:10,values:[Kw.classicRoof10]},{type:12,values:[Kw.classicRoof12]},{type:13,values:[Kw.classicRoof13]},{type:14,values:[Kw.classicRoof14]},{type:15,
values:[Kw.classicRoof15]},{type:16,values:[Kw.classicRoof16]},{type:17,values:[Kw.classicRoof17]}],...Ew(e.texture)}}else if(t>=gw){let e=n.wallobjects[t-gw];r={name:e.name,probably_morphFloor:!0,models:[{type:0,values:[Kw.classicWall]},{type:9,
values:[Kw.classicWallDiag]}],...Ew(e.frontdecor,e.backdecor)}}else{let e=n.objects[t];null==e.model.id&&console.warn(`model for ${e.name} is missing`),r={name:e.name,width:e.xsize,length:e.zsize,models:[{type:10,
values:null==e.model.id?[]:[e.model.id]}]}}return r}(e,t);return{rawloc:r,morphedloc:r,resolvedid:n}}{let r=await e.getGameFile("objects",t),i=Qg.object.read(r,e),a=i;if(i.morphs_1||i.morphs_2){let t=$S(i);if(-1!=t){
let r=await e.getGameFile("objects",t);a={...i,...Qg.object.read(r,e)},n=t}}return{rawloc:i,morphedloc:a,resolvedid:n}}}function XS(e,t,n,r=!1){
let{color:i,indices:a,pos:s,coloroffset:o,colorstride:l,posoffset:c,posstride:u,extra:h}=function(e,t,n,r=!1){const i=t.xsize*t.zsize*5*6*2
;let[a,s]=LS(16*i*3),[o,l]=LS(3*i*4,"index"),c=new Uint32Array(o),u=new Float32Array(a),h=new Uint8Array(a),d=t.x*bS,p=t.z*bS,f=0,m=0,g=(e,t,n,i,a)=>{
const s=4*f+0,o=16*f+12,l=(r?e.y:e.playery00)*(1-t)*(1-i),c=(r?e.y01:e.playery01)*t*(1-i),m=(r?e.y10:e.playery10)*(1-t)*i,g=(r?e.y11:e.playery11)*t*i;return u[s+0]=e.x+t*bS-d,u[s+1]=l+c+m+g+n*bS,u[s+2]=e.z+i*bS-p,h[o+0]=a[0],h[o+1]=a[1],h[o+2]=a[2],
h[o+3]=a[3],f++},_=(e,t,n,r,i,a,s,o)=>{let l=g(e,t,n,r,o),u=g(e,t+i,n,r,o),h=g(e,t,n+a,r,o),d=g(e,t+i,n+a,r,o),p=g(e,t,n,r+s,o),f=g(e,t+i,n,r+s,o),_=g(e,t,n+a,r+s,o),v=g(e,t+i,n+a,r+s,o);c[m++]=l,c[m++]=d,c[m++]=u,c[m++]=l,c[m++]=h,c[m++]=d,c[m++]=u,
c[m++]=v,c[m++]=f,c[m++]=u,c[m++]=d,c[m++]=v,c[m++]=l,c[m++]=_,c[m++]=h,c[m++]=l,c[m++]=p,c[m++]=_,c[m++]=h,c[m++]=v,c[m++]=d,c[m++]=h,c[m++]=_,c[m++]=v,c[m++]=l,c[m++]=f,c[m++]=p,c[m++]=l,c[m++]=u,c[m++]=f,c[m++]=p,c[m++]=v,c[m++]=_,c[m++]=p,
c[m++]=f,c[m++]=v};for(let i=t.z;i<t.z+t.zsize;i++)for(let a=t.x;a<t.x+t.xsize;a++){let t=e.getTile(a,i,n),s=r?t?.rawCollision:t?.effectiveCollision;if(t&&s){if(s.walk[0]&&_(t,.05,0,.05,.9,s.sight[0]?1.8:.3,.9,[100,50,50,255]),r&&30&s.settings){
let e=0,n=0,r=0;2&s.settings&&(e+=0,n+=127,r+=127),4&s.settings&&(e+=0,n+=127,r+=0),8&s.settings&&(e+=127,n+=0,r+=0),-16&s.settings&&(e+=0,n+=0,r+=127),_(t,-.05,-.05,0,1.1,.25,1.1,[e,n,r,255])}for(let e=0;e<4;e++){if(s.walk[1+e]){
let n=s.sight[1+e]?2:.5,r=[255,60,60,255];0==e&&_(t,0,0,0,.15,n,1,r),1==e&&_(t,0,0,.85,1,n,.15,r),2==e&&_(t,.85,0,0,.15,n,1,r),3==e&&_(t,0,0,0,1,n,.15,r)}if(s.walk[5+e]){let n=s.sight[5+e]?2:.5,r=[255,60,60,255];0==e&&_(t,0,0,.85,.15,n,.15,r),
1==e&&_(t,.85,0,.85,.15,n,.15,r),2==e&&_(t,.85,0,0,.15,n,.15,r),3==e&&_(t,0,0,0,.15,n,.15,r)}}}}let v={modeltype:"overlay",isclickable:!1,modelgroup:(r?"collision-raw":"collision")+n,level:n},y=s(16*f),b=l(4*m);return{pos:new Float32Array(y),
color:new Uint8Array(y),indices:new Uint32Array(b),posstride:4,colorstride:16,posoffset:0,coloroffset:12,extra:v}}(e,t.tilerect,n,r);if(0==a.length)return;let d=new Aa;d.setAttribute("position",new oc(new ac(s,u),3,c,!1)),
d.setAttribute("color",new oc(new ac(i,l),4,o,!0)),d.index=new ca(a,1,!1);let p=new cd({shininess:0});p.flatShading=!0,p.vertexColors=!0;let f=new ja(d,p);return f.userData=h,f.name=`${r?"raw ":""}collision ${t.mapsquarex},${t.mapsquarez} (${n})`,f}
async function YS(e,t,n=!1){let r=new Map,i=new Map,a=new Map,s=t.map((t=>function(e,t,n=!1){let r=[],i=t.location,a=22==t.type&&!i.unknown_49,s={replaceColors:i.color_replacements??void 0,replaceMaterials:i.material_replacements??void 0,
lodLevel:n?100:void 0};e.getBuildNr()>Mg&&e.getBuildNr()<377&&(s.replaceMaterials=s.replaceColors);let o=new Dr(4*(i.translateX??0),4*-(i.translateY??0),4*(i.translateZ??0));const l=1/128
;let c=new Dr((i.scaleX??128)*l,(i.scaleY??128)*l,(i.scaleZ??128)*l),u=(t.x+t.sizex/2)*bS,h=(t.z+t.sizez/2)*bS,d=(new Nr).setFromAxisAngle(AS,t.rotation/2*Math.PI);if(t.rotation%2==1){let e=c.x;c.x=c.z,c.z=e}if(i.mirror&&(c.z*=-1),
o.add(new Dr(u,0,h)),n&&(o.y-=.2*bS),t.placement&&(o.add((new Dr).set(t.placement.translateX??0,-(t.placement.translateY??0),t.placement.translateZ??0)),t.placement.scale&&c.multiplyScalar((t.placement.scale??128)/128),
(t.placement.scaleX||t.placement.scaleY||t.placement.scaleZ)&&c.multiply((new Dr).set((t.placement.scaleX??128)/128,(t.placement.scaleY??128)/128,(t.placement.scaleZ??128)/128)),t.placement.rotation)){
let e=1/32768,n=new Nr(-t.placement.rotation[0]*e,t.placement.rotation[1]*e,-t.placement.rotation[2]*e,t.placement.rotation[3]*e);d.premultiply(n)}let p=void 0!==i.probably_morphCeilingOffset,f=p||!!i.probably_morphFloor,m={translate:o,rotation:d,
scale:c,level:t.plane,placementMode:p?"followfloorceiling":f?"followfloor":"simple",scaleModelHeightOffset:i.probably_morphCeilingOffset??0,originx:u,originz:h},g={modeltype:"location",isclickable:!1,
modelgroup:n?`mini_objects${t.resolvedlocid==t.locid&&null==t.location.probably_animation?t.visualLevel:0}`:`objects${t.visualLevel}`,locationid:t.locid,worldx:t.x,worldz:t.z,rotation:t.rotation,mirror:!!i.mirror,isGroundDecor:a,level:t.visualLevel,
locationInstance:t},_=(e,t)=>{if(!n||!a)if(i.models){for(let n of i.models)if(n.type==e)for(let e of n.values)r.push({model:e,morph:t})}else if(i.models_05)for(let n of i.models_05.models)if(n.type==e)for(let e of n.values)r.push({model:e,morph:t})}
;if(11==t.type)_(10,{...m,rotation:(new Nr).setFromAxisAngle(AS,Math.PI/4).premultiply(m.rotation)});else if(8==t.type||7==t.type||6==t.type){if(6==t.type||8==t.type){let e=.6*bS,t=Math.PI/4,n=(new Nr).setFromAxisAngle(AS,t).premultiply(m.rotation)
;_(4,{...m,rotation:n,translate:new Dr(e,0,0).applyQuaternion(n).add(m.translate)})}if(7==t.type||8==t.type){let e=.5*bS,t=Math.PI/4*5,n=(new Nr).setFromAxisAngle(AS,t).premultiply(m.rotation);_(4,{...m,rotation:n,
translate:new Dr(e,0,0).applyQuaternion(n).add(m.translate)})}}else if(2==t.type)_(2,{...m,scale:new Dr(1,1,-1).multiply(m.scale)}),_(2,{...m,rotation:(new Nr).setFromAxisAngle(AS,Math.PI/2).premultiply(m.rotation)});else if(5==t.type){let e=bS/6
;_(4,{...m,translate:new Dr(e,0,0).applyQuaternion(m.rotation).add(m.translate)})}else _(t.type,m);return{models:r,mods:s,extras:g}}(e.engine,t,n))),o=[],l=new Set;for(let t of s)for(let n of t.models)l.has(n.model)||(l.add(n.model),
o.push(e.getModelData(n.model).catch((e=>(console.warn("ignoring missing model",n.model,"in loc",t.extras.locationInstance.location.name??t.extras.locationid),{bonecount:0,skincount:0,miny:0,maxy:0,meshes:[]}))).then((e=>r.set(n.model,e)))))
;await Promise.all(o);for(let e=0;e<s.length;e++){let o=s[e],l=0,c=0;for(let e of o.models){let t=r.get(e.model);l=Math.min(t.miny,l),c=Math.max(t.maxy,c)}let u=[];for(let e of o.models){let t=r.get(e.model);for(let r of t.meshes){
let t=FS(r,o.mods),a=T_(t.materialId,t.hasVertexAlpha,n),s=i.get(o.extras.modelgroup);s||(s=new Map,i.set(o.extras.modelgroup,s));let h=lm(s,a,(()=>({materialId:t.materialId,material:null,hasVertexAlpha:t.hasVertexAlpha,minimapVariant:n,models:[],
groupid:o.extras.modelgroup,overlayIndex:0}))),d={model:t,morph:e.morph,miny:l,maxy:c,extras:o.extras};u.push(d),h.models.push(d)}}0!=u.length&&a.set(t[e],u)}let c=[];for(let e of i.values())c.push(...e.values());return{byMaterial:c,byLogical:a}}
class KS extends ja{constructor(e,t){super(e,t),this.renderSections=[]}cloneSection(e){let t=new Aa;for(let n in this.geometry.attributes){
let r=this.geometry.attributes[n],i=new ca(r.array.slice(e.startvertex*r.itemSize,e.endvertex*r.itemSize),r.itemSize,r.normalized);t.setAttribute(n,i)}let n=this.geometry.index.array.slice(e.startindex,e.endindex)
;for(let t=0;t<n.length;t++)n[t]-=e.startvertex;t.setIndex(new ca(n,1));let r=new KS(t,this.material),i={mesh:r,startindex:0,endindex:e.endindex-e.startindex,startvertex:0,endvertex:e.endvertex-e.startvertex,hidden:!1}
;return r.renderSections.push(i),i}setSectionHide(e,t){if(e.hidden==t)return;e.hidden=t;let n=this.geometry.drawRange.count;if(0!=this.geometry.drawRange.start)throw new Error("unexpected");if(!this.geometry.index)throw new Error("unexpected")
;isFinite(n)||(n=this.geometry.index.count);let r=e.endindex-e.startindex,i=t?n-r:n;if(t){let t=this.geometry.index.array.slice(e.startindex,e.endindex);this.geometry.index.array.copyWithin(e.startindex,e.endindex,n),
this.geometry.index.array.set(t,i)}else{let t=this.geometry.index.array.slice(e.startindex,e.endindex);this.geometry.index.array.copyWithin(n+r,n,e.startindex),this.geometry.index.array.set(t,i)}let a=t?e.startindex:i,s=t?n:e.endindex,o=t?-r:r
;for(let t=0;t<this.renderSections.length;t++){let n=this.renderSections[t];n!=e&&(n.startindex<a||n.startindex>=s||(n.startindex+=o,n.endindex+=o))}e.startindex=i,e.endindex=i+r,this.geometry.setDrawRange(0,n+o),this.geometry.index.needsUpdate=!0}}
function JS(e,t,n,r,i=!1,a="default",s=!1){const o="wireframe"==a,l="worldmap"==a,c="minimap"==a,u=t.tilerect.xsize*t.tilerect.zsize*e.levels
;let[h,d]=LS(52*u*8),[p,f]=LS(8*u*4,"index"),m=new Uint32Array(p),g=new Float32Array(h),_=new Float32Array(h),v=new Uint8Array(h),y=new Uint8Array(h),b=new Uint8Array(h),x=new Uint16Array(h),E=0,w=0;const S=t.tilerect.x*bS,T=t.tilerect.z*bS
;let A=[],C=[],M=1/0,I=1/0,R=1/0,k=-1/0,N=-1/0,D=-1/0;const L=(t,n,i,a,o)=>{
const l=13*E+0,u=13*E+3,h=52*E+24,d=52*E+32,p=52*E+28,f=26*E+18,m=(1-n)*(1-i),w=n*(1-i),A=(1-n)*i,C=n*i,L=t.x+n*bS-S,O=t.z+i*bS-T,P=s?t.waterProps.y00*m+t.waterProps.y01*w+t.waterProps.y10*A+t.waterProps.y11*C:t.y*m+t.y01*w+t.y10*A+t.y11*C,F=s?0:t.normalX*m+(t.next01??t).normalX*w+(t.next10??t).normalX*A+(t.next11??t).normalX*C,U=s?0:t.normalZ*m+(t.next01??t).normalZ*w+(t.next10??t).normalZ*A+(t.next11??t).normalZ*C
;M=Math.min(M,L),I=Math.min(I,P),R=Math.min(R,O),k=Math.max(k,L),N=Math.max(N,P),D=Math.max(D,O),g[l+0]=L,g[l+1]=P,g[l+2]=O,_[u+0]=F,_[u+1]=Math.sqrt(1-F*F-U*U),_[u+2]=U;let B=a[o].color[0],z=a[o].color[1],G=a[o].color[2];c&&(B=20+.656*B,z=28+.577*z,
G=23+.604*G,s&&(B=255*Math.pow(B/255,2.2),z=255*Math.pow(z/255,2.2),G=255*Math.pow(G/255,2.2))),v[h+0]=B,v[h+1]=z,v[h+2]=G,v[h+3]=255;for(let s=0;s<3;s++)if(x[f+2*s+0]=0,x[f+2*s+1]=0,b[d+s]=0,y[p+s]=0,s<a.length){const l=a[s];let c,u=0
;if(l&&-1!=l.material){let t=e.engine.getMaterialData(l.material);u=t.baseColorFraction,t.textures.diffuse&&(c=r.map.get(t.textures.diffuse))}if(c){let e=l.materialTiling/128,r=t.x/bS%e,a=t.z/bS%e;const h=65536;x[f+2*s+0]=(c.u+c.usize*(r+n)/e)*h,
x[f+2*s+1]=(c.v+c.vsize*(a+i)/e)*h,b[d+s]=s==o?255:0,y[p+s]=255-255*u}}return E++};for(let r=n;r<t.levelcount;r++)if(!o||r==n)for(let a=0;a<t.tilerect.zsize;a++)for(let c=0;c<t.tilerect.xsize;c++){let u=e.getTile(t.tilerect.x+c,t.tilerect.z+a,r)
;if(!u)continue;if(!o&&u.effectiveVisualLevel!=n)continue;let h=u.shape,d=u.next01&&u.next10&&u.next11
;if(h==IS&&d&&Math.abs(u.underlayprops.color[0]-u.next11.underlayprops.color[0])+Math.abs(u.underlayprops.color[1]-u.next11.underlayprops.color[1])+Math.abs(u.underlayprops.color[2]-u.next11.underlayprops.color[2])<Math.abs(u.next01.underlayprops.color[0]-u.next10.underlayprops.color[0])+Math.abs(u.next01.underlayprops.color[1]-u.next10.underlayprops.color[1])+Math.abs(u.next01.underlayprops.color[2]-u.next10.underlayprops.color[2])&&(h=RS),
i&&(A.push({tile:u.debug_raw,x:c,z:a,level:r,tilenxt:u.debug_nxttile,underlaycolor:u.originalUnderlayColor}),C.push(w)),s){if(u.waterProps){let e=u.waterProps.props,t=[e,e,e],n=u.waterProps.shape;for(let e=2;e<n.length;e++){let r=n[0],i=n[e-1],a=n[e]
;r&&i&&a&&(m[w++]=L(u,r.subx,r.subz,t,0),m[w++]=L(u,i.subx,i.subz,t,1),m[w++]=L(u,a.subx,a.subz,t,2))}}}else{if(d&&0!=h.overlay.length){let e=u.rawOverlay,t=e?.color??(e&&void 0!==e.materialbyte?[255,255,255]:[255,0,255]),n=u.overlayVisible
;if(l&&!n&&e?.secondary_colour&&(t=e.secondary_colour,n=!0),n||o){let e;if(l){let n={material:0,materialTiling:128,materialBleedpriority:0,color:t};e=Array(h.overlay.length).fill(n)}else e=h.overlay.map((e=>{
if(!u.bleedsOverlayMaterial)return u.overlayprops;{let t=u;if(e.nextx&&e.nextz?t=u.next11:e.nextx?t=u.next01:e.nextz&&(t=u.next10),t)return t.vertexprops[e.subvertex]}return CS}));for(let t=2;t<h.overlay.length;t++){
let n=h.overlay[0],r=h.overlay[t-1],i=h.overlay[t];if(!n||!r||!i)continue;let a=[e[0],e[t-1],e[t]];m[w++]=L(u,n.subx,n.subz,a,0),m[w++]=L(u,r.subx,r.subz,a,1),m[w++]=L(u,i.subx,i.subz,a,2)}}}if(d&&0!=h.underlay.length&&(u.underlayVisible||o)){let e
;if(l){let t={material:0,materialTiling:128,materialBleedpriority:-1,color:u.underlayprops.color};e=Array(h.underlay.length).fill(t)}else e=h.underlay.map((e=>{let t=u;if(e.nextx&&e.nextz?t=u.next11:e.nextx?t=u.next01:e.nextz&&(t=u.next10),t){
let n=t.vertexprops[e.subvertex];return-1==n.material?{...n,material:u.underlayprops.material}:n}return CS}));for(let t=2;t<h.underlay.length;t++){let n=h.underlay[0],r=h.underlay[t-1],i=h.underlay[t];if(!n||!r||!i)continue;let a=[e[0],e[t-1],e[t]]
;m[w++]=L(u,n.subx,n.subz,a,0),m[w++]=L(u,r.subx,r.subz,a,1),m[w++]=L(u,i.subx,i.subz,a,2)}}}}let O={modelgroup:("wireframe"==a?"floorhidden":"worldmap"==a?"map":"minimap"==a?"mini_floor":"floor")+n,modeltype:o?"floorhidden":"floor",
mapsquarex:t.mapsquarex,mapsquarez:t.mapsquarez,level:n,isclickable:!0,searchPeers:!1,subobjects:A,subranges:C},P=d(52*E),F=f(4*w),U=new Float32Array(P),B=new Uint8Array(P),z=new Uint16Array(P);return{chunk:t,level:n,tileinfos:A,mode:a,iswater:s,
vertexstride:52,indices:new Uint32Array(F),nvertices:E,atlas:r,pos:{src:U,offset:0,vecsize:3,normalized:!1},normal:{src:U,offset:3,vecsize:3,normalized:!1},color:{src:B,offset:24,vecsize:4,normalized:!0},_RA_FLOORTEX_UV0:{src:z,offset:18,vecsize:2,
normalized:!0},_RA_FLOORTEX_UV1:{src:z,offset:20,vecsize:2,normalized:!0},_RA_FLOORTEX_UV2:{src:z,offset:22,vecsize:2,normalized:!0},_RA_FLOORTEX_WEIGHTS:{src:B,offset:32,vecsize:3,normalized:!0},_RA_FLOORTEX_USESCOLOR:{src:B,offset:28,vecsize:3,
normalized:!0},posmax:[k,N,D],posmin:[M,I,R],extra:O}}var ZS=n(8559);class QS{constructor(){this.tiles=new Map,this.props={},this.updateDebounce=0,this.queuedUpdates=[],this.areas=[],this.grid=document.createElement("div"),
this.grid.style.display="grid",this.proproot=document.createElement("div");let e=document.createElement("div");e.style.display="grid",e.style.grid="'a b'/auto 1fr",e.appendChild(this.grid),e.appendChild(this.proproot),this.root=e}setAreas(e){
this.areas=e,this.grid.replaceChildren();let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let a of e){t=Math.min(t,a.x),n=Math.min(n,a.z),r=Math.max(r,a.x+a.xsize-1),i=Math.max(i,a.z+a.zsize-1);for(let e=0;e<a.zsize;e++)for(let t=0;t<a.xsize;t++){
let n=`${a.x+t}-${a.z+e}`;if(!this.tiles.has(n)){let r=document.createElement("div");this.tiles.set(n,{x:a.x+t,z:a.z+e,el:r,progress:"queued",loadstate:"unloaded"})}}}let a=Math.min(700/(r-t+1),930/(i-n+1));this.grid.style.width=(r-t+1)*a+"px",
this.grid.style.height=(i-n+1)*a+"px",this.grid.style.gridTemplateColumns=`repeat(${r-t+1},1fr)`,this.grid.style.gridTemplateRows=`repeat(${i-n+1},1fr)`,this.proproot.style.left=(r-t+1)*a+"px"
;for(let e of this.tiles.values())e.el.style.gridColumn=e.x-t+1+"",e.el.style.gridRow=i-n-(e.z-n)+1+"",e.el.style.background=QS.backgrounds.queued,this.grid.appendChild(e.el)}update(e,t,n,r=""){this.queuedUpdates.push({x:e,z:t,state:n,tilestate:r}),
this.updateDebounce||(this.updateDebounce=+setTimeout((()=>{this.queuedUpdates.forEach((e=>this.doupdate(e.x,e.z,e.state,e.tilestate))),this.queuedUpdates=[],this.updateDebounce=0}),400))}doupdate(e,t,n,r=""){let i=`${e}-${t}`,a=this.tiles.get(i)
;a&&(n&&(a.progress=n),
r&&(a.loadstate=r),"imaging"==a.progress||"saving"==a.progress?a.el.style.background=QS.backgrounds[a.progress]:"unloaded"!=a.loadstate?a.el.style.background=QS.renderBackgrounds[a.loadstate]:a.el.style.background=QS.backgrounds[a.progress])}
updateProp(e,t){let n=this.props[e];if(!t&&n)return this.proproot.removeChild(n.el),void delete this.props[e];if(t&&!n){let t=document.createElement("b"),r=document.createElement("span"),i=document.createElement("div");i.append(t,r),
t.innerText=e+": ",n={el:i,contentel:r,text:""},this.props[e]=n,this.proproot.appendChild(n.el)}n.text=t,n.contentel.innerText=t}}QS.renderBackgrounds={loaded:"lime",loading:"red",unloaded:"green"},QS.backgrounds={queued:"black",imaging:"orange",
saving:"yellow",done:"green",skipped:"darkgreen"};class eT{constructor(e,t){this.incompletes=new Map,this.render=e,this.progress=t,this.minzoom=Math.floor(Math.log2(e.config.tileimgsize/(64*Math.max(e.config.mapsizex,e.config.mapsizez))))}
addTask(e,t,n,r,i,a,s){if(t-1<this.minzoom)return;let o=this.render.makeFileName(e.name,t-1,Math.floor(r/2),Math.floor(i/2),e.format??"webp"),l=lm(this.incompletes,o,(()=>({layer:e,zoom:t-1,x:Math.floor(r/2),y:Math.floor(i/2),
files:[null,null,null,null]}))),c=(r%2!=0?1:0)+(i%2!=0?2:0);l.files[c]={name:a,hash:n,fshash:s}}async run(e=!1){let t=0,n=0,r=[],i=async()=>{let e=await this.render.getMetas(r.map((e=>({name:e.name,hash:e.fshash})))),i=[],a=[],s=[];for(let o of r){
let r=e.find((e=>e.file==o.name)),l=o.hash;0==o.hash||!r||r.fshash!=o.fshash&&r.hash!=o.hash?(i.push(o.run().catch((e=>console.warn("mipping",o.name,"failed",e)))),t++):(a.push({file:o.name,hash:o.hash,buildnr:this.render.version,symlink:r.file,
symlinkbuildnr:r.buildnr,symlinkfirstbuildnr:r.firstbuildnr}),l=o.fshash,n++),s.push((()=>{this.addTask(o.args.layer,o.args.zoom,o.hash,o.args.x,o.args.y,o.name,l)}))}i.push(this.render.symlinkBatch(a)),await Promise.all(i),s.forEach((e=>e())),r=[],
this.progress.updateProp("mipqueue",""+this.incompletes.size)};do{let t=-100;if(e)for(let e of this.incompletes.values())e.zoom>t&&(t=e.zoom);for(let[n,a]of this.incompletes.entries()){if(e&&a.zoom!=t)continue;if(!e&&a.files.some((e=>!e)))continue
;let s=0,o=0;for(let e of a.files)s=D_(e?.hash??0,s),o=D_(e?.fshash??0,o);r.push({name:n,hash:s,fshash:o,args:a,run:async()=>{let e=await tT(this.render,a.files,a.layer.format??"webp",.9,"avg"==a.layer.mipmode);await this.render.saveFile(n,s,e)}}),
this.incompletes.delete(n),r.length>=200&&await i()}await i()}while(e&&0!=this.incompletes.size);return console.log("mipped",t,"skipped",n,"left",this.incompletes.size),t}}async function tT(e,t,n,r,i){let a=document.createElement("canvas")
;a.width=e.config.tileimgsize,a.height=e.config.tileimgsize;let s=a.getContext("2d",{willReadFrequently:!0});const o=e.config.tileimgsize/2;return await Promise.all(t.map((async(t,n)=>{if(!t)return null
;let r=await e.getFileResponse(t.name),a=r.headers.get("content-type"),l=r.headers.get("x-amz-meta-mapfile-hash");if("string"==typeof l&&+l!=t.fshash)throw new Error("hash mismatch while creating mip file");let c=n%2*o,u=Math.floor(n/2)*o;if(i){
let e=await r.arrayBuffer(),t=function(e){if(e.width%2!=0||e.height%2!=0)throw new Error("can only use avg mip filter on textures with multiple of 2 size");let t=Am(null,e.width/2,e.height/2);const n=4*e.width
;for(let r=0;r<t.height;r++)for(let i=0;i<t.width;i++){
let a=2*i*4+2*r*n,s=2+e.data[a+0]+e.data[a+4+0]+e.data[a+n+0]+e.data[a+4+n+0],o=2+e.data[a+1]+e.data[a+4+1]+e.data[a+n+1]+e.data[a+4+n+1],l=2+e.data[a+2]+e.data[a+4+2]+e.data[a+n+2]+e.data[a+4+n+2],c=2+e.data[a+3]+e.data[a+4+3]+e.data[a+n+3]+e.data[a+4+n+3],u=4*i+r*t.width*4
;t.data[u+0]=s/4,t.data[u+1]=o/4,t.data[u+2]=l/4,t.data[u+3]=c/4}return t}(await Nm(new Uint8Array(e),a,!1));s.putImageData(t,c,u)}else{let e;if(!r.ok)throw new Error("image not found");if("image/svg+xml"!=a&&"undefined"!=typeof ImageDecoder){
let t=new ImageDecoder({data:r.body,type:a,desiredWidth:o,desiredHeight:o});e=(await t.decode()).image}else{let t=URL.createObjectURL(await r.blob());e=new Image(o,o),e.src=t,await e.decode(),URL.revokeObjectURL(t)}s.drawImage(e,c,u,o,o)}}))),
Lm(a,n,r)}var nT=n(8287).Buffer;async function rT(e,t,n,r){let i=t.getBuildNr();if(t.getBuildNr()>900){let e=0;for(let n of[xg.mapsquares,xg.items,xg.npcs,xg.objects,xg.config]){let r=await t.getCacheIndex(n)
;for(let t of r)t&&t.version>e&&(e=t.version)}i=e}if(await n.beginMapVersion(i),!r){let t=await n.getFileResponse("meta.json");if(t.ok){let r=await t.json(),i=new Date(r.rendertimestamp),a=r.workerid==n.workerid,s=(Date.now()-+i)/1e3/60/60
;if(r.running&&a)console.log(`continuing render ${n.version} which was locked by current worker`);else{if(!(r.running&&s>20))return e.log("skipping",n.version),()=>{}
;console.log(`continuing render ${n.version} which was locked by other worker and presumed abandoned. (locked ${0|s} hours ago)`)}}else console.log(`starting new render ${n.version}`)}let a=await Zw.create(t),s=new QS
;s.updateProp("source",t.getCacheMeta().name+"\n"+t.getCacheMeta().descr);let o=()=>s.root.remove();e.setUI(s.root);let{areas:l,mask:c}=await async function(e,t){let n,r=[];if(""==t||"full"==t)r=[{x:0,z:0,xsize:100,zsize:200
}];else if(t.match(/^\w+$/)){if("main"==t){let t=await e.getFileById(xg.enums,708),i=Qg.enums.read(t,e),a=await e.getArchiveById(xg.worldmap,0);n=i.intArrayValue2.values.map((t=>Qg.mapZones.read(a[t[1]].buffer,e))).flatMap((e=>e.bounds)).map((e=>{
let t=e.src.xstart,n=e.src.zstart;return{x:t,z:n,xsize:e.src.xend-t+1,zsize:e.src.zend-n+1}})),n.push({x:2176,z:3456,xsize:64,zsize:64}),n.push({x:2432,z:2624,xsize:128,zsize:128}),n.push({x:3776,z:6976,xsize:128,zsize:128}),n.push({x:3008,z:5952,
xsize:128,zsize:256}),n.push({x:896,z:256,xsize:192,zsize:256}),n.push({x:1472,z:1536,xsize:256,zsize:256}),n.push({x:4480,z:8960,xsize:320,zsize:320}),n.push({x:4864,z:8960,xsize:320,zsize:320}),n.push({x:5248,z:8960,xsize:320,zsize:320}),n.push({
x:4416,z:6144,xsize:384,zsize:256}),n.push({x:320,z:128,xsize:64,zsize:64}),n.push({x:2752,z:1728,xsize:192,zsize:192}),n.push({x:3200,z:10112,xsize:128,zsize:64}),r=n.map((e=>{let t=Math.floor(e.x/64),n=Math.floor(e.z/64);return{x:t,z:n,
xsize:Math.ceil((e.x+e.xsize)/64)-t+1,zsize:Math.ceil((e.z+e.zsize)/64)-n+1}}))}"test"==t&&(r=[{x:49,z:49,xsize:3,zsize:3}])}else{let e=om(t)
;if(!e||0==e.length)throw new Error("map area argument did not match a preset name and did not resolve to a rectangle");r=e.map((e=>({x:e.start[0],z:e.start[1],xsize:e.end[0]-e.start[0]+1,zsize:e.end[1]-e.start[1]+1})))}
if(0==r.length)throw new Error("no map area or map name");return{areas:r,mask:n}}(t,n.config.area);s.setAreas(l),s.updateProp("deps","starting dependency graph");try{let e;1==l.length&&(e={x:l[0].x-2,z:l[0].z-2,xsize:l[0].xsize+2,zsize:l[0].zsize+2})
;var u=await a.getDependencyGraph();await u.preloadChunkDependencies({area:e})}catch(e){return console.error(e),s.updateProp("deps","starting dependency graph"),o}s.updateProp("deps",`completed, ${u.dependencyMap.size} nodes`);let h={mask:c}
;return n.config.layers.some((e=>"minimap"==e.mode))&&(h.minimap=!0),n.config.layers.some((e=>"collision"==e.mode))&&(h.collision=!0),h=py.defaultopts(h),await async function(e,t,n,r,i,a,s){let o=[],l=[]
;for(let e of i)for(let t=e.z;t<e.z+e.zsize;t++)for(let n=e.x;n<e.x+e.xsize;n++)l.push({x:n,z:t});const c=4*a.config.mapsizex;l.sort(((e,t)=>4*e.x+Math.floor(e.z/4)*c+e.z%c-(4*t.x+Math.floor(t.z/4)*c+t.z%c)));let u=l.length
;l=l.filter(((e,t,n)=>0==t||e.x!=n[t-1].x||e.z!=n[t-1].z)),e.log("filtered out dupes",u-l.length);let h={buildnr:n.getBuildNr(),timestamp:isNaN(+n.getCacheMeta().timestamp)?"":n.getCacheMeta().timestamp.toISOString(),areas:i,version:a.version,
errorcount:0,running:!0,workerid:a.workerid,rendertimestamp:(new Date).toISOString()};await a.saveFile("meta.json",0,nT.from(JSON.stringify(h,void 0,"\t")));let d=await async function(e,t=null){let n,r=await e.getFileResponse("versions.json",0)
;return n=r.ok?await r.json():{versions:[]},t&&!n.versions.some((t=>t.version==e.version))&&(n.versions.push({version:e.version,build:t.getBuildNr(),date:+t.getCacheMeta().timestamp,source:t.getCacheMeta().name}),
n.versions.sort(((e,t)=>t.version-e.version)),console.log("updating versions file"),await e.saveFile("versions.json",0,nT.from(JSON.stringify(n)),0)),n}(a,n),p=new eT(a,s),f=new yS(n,a,r,d),m=null,g=Promise.resolve();await function(e,t,n){
Array.isArray(n)&&n.length,"function"==typeof n&&(n=n());let r=n[Symbol.iterator]();return new Promise((e=>{let t=0,n=()=>{let i=r.next();i.done?(t--,t<=0&&e()):i.value.finally(n)};for(let e=0;e<10;e++)t++,n()}))}(0,0,(function*(){let r=0
;for(let i of l){if("running"!=e.state)break;let l=cT(n,a,f,p,s,i.x,i.z),c=g,u=(async()=>{if("running"==e.state)for(let e=0;e<=1;e++)try{let e=c.then((()=>m??(m=t())));await l.runTasks(e);break}catch(e){console.warn(e.toString()),
o.push(e.toString()),m=null,e=null,await cm(1),globalThis.gc?.()}})();g=g.then((()=>u)),yield u,r++,r%20==0&&(yield p.run())}})),await p.run(!0),h.errorcount=o.length,h.running=!1,
await a.saveFile("meta.json",0,nT.from(JSON.stringify(h,void 0,"\t"))),e.log(o)}(e,(()=>{let e=document.createElement("canvas"),t=new iT(e,n,a,u,h);return t.loadcallback=(e,t,n)=>s.update(e,t,"",n),t}),a,u,l,n,s),e.log("done"),o}class iT{
constructor(e,t,n,r,i){this.scenecache=null,this.maxunused=11,this.minunused=8,this.idcounter=0,this.squares=[],this.loadcallback=null,this.engine=n,this.opts=i,this.deps=r,this.config=t,this.renderer=new hI(e,{alpha:!1}),
this.renderer.addSceneElement({getSceneElements:()=>({options:{autoFrames:"never",hideFog:!0}})}),e.addEventListener("webglcontextlost",(async()=>{let t=await new Promise(((t,n)=>{let r=n=>{e.removeEventListener("webglcontextrestored",i),
clearTimeout(a),t(n)},i=()=>r(!0);e.addEventListener("webglcontextrestored",i);let a=setTimeout(r,1e4,!1)}));console.log("context restore detection "+(t?"restored before trigger":"triggered and focusing window"))}))}async getChunk(e,t,n){
let r=this.squares.find((n=>n.x==e&&n.z==t));if(!r||n&&!r.model){if(this.loadcallback?.(e,t,"loading"),this.scenecache||(console.log("refreshing scenecache"),this.scenecache=await eS.create(this.engine)),!r){
let n=jS(this.scenecache.engine,e,t,this.opts),i=this.idcounter++;r={id:i,x:e,z:t,parseprom:n,model:null,loaded:null,loadprom:null},this.squares.push(r)}return n&&(r.model=new py(this.scenecache,r.parseprom,e,t,this.opts),r.loadprom=(async()=>{
let n=await r.model.chunkdata;return r.loaded={rendermeta:{x:n.chunkx,z:n.chunkz,version:this.config.version,floor:n.chunk?lS(n.grid,this.deps,n.chunk):[],locs:uS(n.grid,this.deps,n.modeldata,n.chunkx,n.chunkz)},grid:n.grid,chunkdata:n},
this.loadcallback?.(e,t,"loaded"),r.loaded})()),r}return r}async setArea(e,t,n,r,i){let a=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++)a.push(await this.getChunk(e+s,t+n,i));await Promise.all(a.map((e=>e.loadprom))),
a.forEach((e=>e.model?.addToScene(this.renderer)));let s=this.squares.filter((e=>!a.includes(e)));if(s.length>=this.maxunused){s.sort(((e,t)=>t.id-e.id));let e=s.slice(this.minunused);e.forEach((e=>{e.model?.cleanup(),
this.loadcallback?.(e.x,e.z,"unloaded")})),this.squares=this.squares.filter((t=>!e.includes(t)))}return a}}function aT(e,t){return{min:Math.floor(Math.log2(e.tileimgsize/(64*Math.max(e.mapsizex,e.mapsizez)))),max:Math.log2(t.pxpersquare),
base:Math.log2(e.tileimgsize/64)}}function sT(e,t,n,r){let i={};for(let e=0;e<4;e++)i["floor"+e]=!n&&e<=t,i["objects"+e]=!r&&!n&&e<=t,i["mini_floor"+e]=n&&e<=t,i["mini_objects"+e]=!r&&n&&e<=t,i["map"+e]=!1,i["mapscenes"+e]=!1,i["walls"+e]=!1,
i["floorhidden"+e]=!1,i["collision"+e]=!1,i["collision-raw"+e]=!1;for(let t of e)t.model?.setToggles(i)}class oT{constructor(e){this.subhashes=[],this.depstracker=e}getsubhash(e,t){let n=this.subhashes.find((n=>n.x==e&&n.z==t));if(n)return n.hash;{
let n=this.depstracker.deps.hashDependencies(this.depstracker.deps.makeDeptName("mapsquare",e+t*SS));return this.subhashes.push({x:e,z:t,hash:n}),n}}recthash(e){let t=0
;for(let n=e.z;n<e.z+e.zsize;n++)for(let r=e.x;r<e.x+e.xsize;r++)t=D_(this.getsubhash(r,n),t);return t}rectexists(e){let t=!1;for(let n=e.z;n<e.z+e.zsize;n++)for(let r=e.x;r<e.x+e.xsize;r++)t||(t=this.depstracker.deps.hasEntry("mapsquare",r+n*SS))
;return t}}function lT(e,t){const n=e.classicData?ES:xS,r=Math.round(n/4);return{worldrect:{x:t.x*n-r,z:t.z*n-r,xsize:n*t.xsize,zsize:n*t.zsize},loadedchunksrect:{x:t.x-1,z:t.z-1,xsize:t.xsize+1,zsize:t.zsize+1}}}function cT(e,t,n,r,i,a,s){let o={
x:a,y:t.config.mapsizez-1-s};i.update(a,s,"imaging");let l=new oT(n),c=[],u=[];for(let n of t.config.layers){let r=1;if(a%r!=0||s%r!=0)continue;let i={x:a,z:s,xsize:r,zsize:r},u=hT[n.mode];if(!u)throw new Error("unknown render mode")
;c.push(...u(e,t,n,l,o,i))}return{runTasks:async e=>{let o=[],h=[],d=c.filter((e=>l.rectexists(e.datarect))),p=await t.getMetas(d.filter((e=>0!=e.hash))),f=new Set
;for(let e of d)p.find((t=>t.file==e.name&&t.hash==e.hash))||e.dedupeDependencies?.forEach((e=>f.add(e)));let m=await n.forkDeps([...f]),g=null;for(let n of d){let i=p.find((e=>e.file==n.name&&e.hash==n.hash));if(!i){g||(g=await e)
;let r,a=!n.run,s=await g.setArea(n.datarect.x,n.datarect.z,n.datarect.xsize,n.datarect.zsize,!a),l=await Promise.all(s.map((e=>e.parseprom)));if(!l.some((e=>e.chunk)))continue;if(n.run)await Promise.all(s.map((e=>e.loadprom))),
r=await n.run(s,g,m);else{if(!n.run2d)throw new Error("task has no run and also no run2d method");r=await n.run2d(l)}r.symlink?i=r.symlink:r.file&&o.push(r.file().then((e=>t.saveFile(n.name,n.hash,e))))}i&&h.push({file:n.name,hash:n.hash,
buildnr:t.version,symlink:i.file,symlinkbuildnr:i.buildnr,symlinkfirstbuildnr:i.firstbuildnr}),n.mippable&&u.push((()=>{let e=n.mippable;r.addTask(n.layer,e.zoom,n.hash,e.outputx,e.outputy,n.name,i?.fshash??n.hash)}))}i.update(a,s,"done"),
await Promise.all(o),await t.symlinkBatch(h),u.forEach((e=>e())),i.update(a,s,0==o.length?"skipped":"done");let _=h.filter((e=>e.symlinkbuildnr==t.version&&e.file!=e.symlink)).length
;console.log("imaged",a,s,"files",o.length,"symlinks",_,"(unchanged)",h.length-_)}}}const uT=function(e,t,n,r,i,a){let s=aT(t.config,n),{loadedchunksrect:o,worldrect:l}=lT(e,a),c=n,u=[];for(let a=s.base;a<=s.max;a++){
let h=1<<a-s.base,d=c.pxpersquare>>s.max-a,p=l.xsize/h;for(let f=0;f<h;f++)for(let m=0;m<h;m++){let g=h-1-m,_=t.makeFileName(c.name,a,i.x*h+f,i.y*h+g,n.format??"webp"),v=[{name:_,level:c.level}];for(let e of c.subtractlayers??[]){
let r=t.config.layers.find((t=>t.name==e));r?v.push({name:t.makeFileName(r.name,a,i.x*h+f,i.y*h+g,n.format??"webp"),level:r.level}):console.warn("subtrack layer "+e+"missing")}let y=r.recthash(o);u.push({layer:c,name:_,hash:y,datarect:o,
dedupeDependencies:v.map((e=>e.name)),mippable:a==s.base?{outputx:i.x,outputy:i.y,zoom:a}:null,async run(n,r,i){sT(n,c.level,"minimap"==c.mode,!!c.hidelocs);let a,s=dT(l.x+p*f,l.z+p*m,p,c.dxdy,c.dzdy)
;e:for(let e of v)for(let t of await i.findMatches(this.datarect,e.name)){let r=!1;for(let i of n){let n=t.metas.find((e=>e.x==i.x&&e.z==i.z));if(!n)throw new Error("unexpected");i.model.rootnode.updateWorldMatrix(!0,!1)
;let a=(new ci).makeTranslation(i.model.chunkx*bS*i.model.loaded.chunkSize,0,i.model.chunkz*bS*i.model.loaded.chunkSize).premultiply(i.model.rootnode.matrixWorld),o=s.projectionMatrix.clone().multiply(s.matrixWorldInverse).multiply(a),l=pS(i.loaded.rendermeta.locs,n.locs,c.level,e.level),u=dS(i.loaded.rendermeta.floor,n.floor,c.level,e.level)
;if(r||(r=_S(o,l)),r||(r=_S(o,u)),r)break}if(!r){a=t.file;break e}}let o=null;if(a||(o=await r.renderer.takeMapPicture(s,p*d,p*d,"minimap"==c.mode),n.forEach((e=>i.addLocalSquare(e.loaded.rendermeta))),i.addLocalFile({file:this.name,fshash:y,
buildnr:t.version,firstbuildnr:t.version,hash:y,time:Date.now()})),c.overlayicons||c.overlaywalls){if(c.overlayicons&&!c.overlaywalls)throw new Error("overlayicons without overlaywalls currently not supported");let t=new zS(n.map((e=>({
src:e.loaded.grid,rect:{x:e.model.chunkx*e.loaded.chunkdata.chunkSize,z:e.model.chunkz*e.loaded.chunkdata.chunkSize,xsize:e.loaded.chunkdata.chunkSize,zsize:e.loaded.chunkdata.chunkSize}
})))),r=n.flatMap((e=>e.model.loaded.chunk?.locs??[])),i=await ny(e,t,r,l,c.level,c.pxpersquare,!!c.overlaywalls,!!c.overlayicons,!0),s=new Image;s.src=`data:image/svg+xml;base64,${btoa(i)}`,s.width=o.width,s.height=o.height,await s.decode()
;let u=document.createElement("canvas");u.width=o.width,u.height=o.height;let h=u.getContext("2d");return h.putImageData(o,0,0),h.drawImage(s,0,0),{file:()=>Lm(u,c.format??"webp",.9),symlink:a}}return{file:()=>Cm(o,c.format??"webp",.9),symlink:a}}})}
}return u},hT={"3d":uT,minimap:uT,interactions:function(e,t,n,r,i,a){let s=n,o=`${s.name}/${a.x}-${a.z}.${n.usegzip?"json.gz":"json"}`;return[{layer:s,name:o,hash:r.recthash(a),datarect:a,async run(e,t){let n=e[0].loaded.chunkdata
;if(!n)throw new Error("unexpected");let r={x:a.x*n.chunkSize,z:a.z*n.chunkSize,xsize:n.chunkSize,zsize:n.chunkSize},{hashes:i,locdatas:o,locs:l}=oS(n.grid,n.modeldata,r),c={};for(let[r,{center:a,locdata:o}]of i){
[o.location.actions_0,o.location.actions_1,o.location.actions_2,o.location.actions_3,o.location.actions_4].filter((e=>!!e));let i=n.locRenders.get(o);if(!i)continue;sT(e,o.plane,!1,!0);let l=i.map((e=>e.mesh.cloneSection(e)))
;i.map((e=>e.mesh.setSectionHide(e,!0)));let u=new Pi;u.add(...l.map((e=>e.mesh))),u.traverse((e=>e.layers.set(1))),n.chunkroot.add(u)
;let h=16,d=GS(n.grid,o.x,o.z,o.plane)/bS+a[1],p=dT(o.x+a[0]+d*s.dxdy-h/2,o.z+a[2]+d*s.dzdy-h/2,h,s.dxdy,s.dzdy),f=await t.renderer.takeMapPicture(p,h*s.pxpersquare,h*s.pxpersquare,!1,u);u.removeFromParent(),i.map((e=>e.mesh.setSectionHide(e,!1)))
;let m=Fm(f);if(0==m.width||0==m.height)continue;let g=s.format??"webp",_=Pm(f,m),v=await Cm(_,g,.9);c[r]={loc:o.locid,dx:m.x-f.width/2,dy:m.y-f.height/2,w:m.width,h:m.height,center:a,img:`data:image/${g};base64,${v.toString("base64")}`}}let u=Sv()({
locs:l,locdatas:o,rect:r,hashimgs:c,pxpertile:s.pxpersquare,dxdy:s.dxdy,dzdy:s.dzdy},{indent:"\t"}),h=nT.from(u,"utf8");return s.usegzip&&(h=ZS.gzipSync(h)),{file:()=>Promise.resolve(h)}}}]},collision:function(e,t,n,r,i,a){
let s=aT(t.config,n),{loadedchunksrect:o,worldrect:l}=lT(e,a),c=n,u=t.makeFileName(c.name,s.base,i.x,i.y,n.format??"webp"),h=r.recthash(o);return[{layer:c,name:u,hash:h,datarect:o,mippable:{outputx:i.x,outputy:i.y,zoom:s.base},async run2d(e){
let t=function(e,t,n,r){let i=document.createElement("canvas"),a=i.getContext("2d",{willReadFrequently:!0});i.width=t.xsize*r,i.height=t.zsize*r,a.scale(1,-1),a.translate(0,-t.zsize*r),a.translate(-t.x*r,-t.z*r);let s=(e,t,n,i,s,o)=>{let l=!1,c=!1
;for(let n of e)l||(l=!!n.effectiveCollision&&n.effectiveCollision.walk[t]),c||(c=!!n.effectiveCollision&&n.effectiveCollision.sight[t]);l&&(a.fillStyle=c?"red":"orange",a.fillRect(e[0].x/bS*r+(n?0:r-1),e[0].z/bS*r+(i?0:r-1),n&&s?r:1,i&&o?r:1))}
;for(let r=t.z;r<t.z+t.zsize;r++)for(let i=t.x;i<t.x+t.xsize;i++){let t=[];for(let a of e){let e=a.getTile(i,r,n);e&&t.push(e)}0!=t.length&&(s(t,0,!0,!0,!0,!0),s(t,1,!0,!0,!1,!0),s(t,2,!0,!1,!0,!0),s(t,3,!1,!0,!0,!0),s(t,4,!0,!0,!0,!1),
s(t,5,!0,!1,!1,!0),s(t,6,!1,!1,!0,!0),s(t,7,!1,!0,!0,!1),s(t,8,!0,!0,!1,!1))}return Lm(i,"png",1)}(e.map((e=>e.grid)),l,c.level,c.pxpersquare);return{file:()=>t}}}]},map:function(e,t,n,r,i,a){
let s=aT(t.config,n),{loadedchunksrect:o,worldrect:l}=lT(e,a),c=n,u=t.makeFileName(c.name,s.base,i.x,i.y,"svg"),h=r.recthash(o);return[{layer:c,name:u,hash:h,datarect:o,mippable:{outputx:i.x,outputy:i.y,zoom:s.base},async run2d(t){
let n=new zS(t.map((e=>({src:e.grid,rect:{x:e.chunkx*e.chunkSize,z:e.chunkz*e.chunkSize,xsize:e.chunkSize,zsize:e.chunkSize}})))),r=t.flatMap((e=>e.chunk?.locs??[])),i=await ny(e,n,r,l,c.level,c.pxpersquare,!!c.wallsonly,!!c.mapicons,!!c.thicklines)
;return{file:()=>Promise.resolve(nT.from(i,"utf8"))}}}]},height:function(e,t,n,r,i,a){let s=n,o=`${s.name}/${a.x}-${a.z}.${n.usegzip?"bin.gz":"bin"}`;return[{layer:s,name:o,hash:r.recthash(a),datarect:a,async run2d(e){
let t=e[0].grid.getHeightCollisionFile(64*a.x,64*a.z,s.level,64,64),n=nT.from(t.buffer,t.byteOffset,t.byteLength);return s.usegzip&&(n=ZS.gzipSync(n)),{file:()=>Promise.resolve(n)}}}]},locs:function(e,t,n,r,i,a){
let s=n,o=`${s.name}/${a.x}-${a.z}.${n.usegzip?"json.gz":"json"}`;return[{layer:s,name:o,hash:r.recthash(a),datarect:a,async run(e){let{grid:t,modeldata:n,chunkSize:r}=e[0].loaded.chunkdata,i={x:a.x*r,z:a.z*r,xsize:r,zsize:r
},{locdatas:o,locs:l}=oS(t,n,i),c=Sv()({locdatas:o,locs:l,rect:i},{indent:"\t"}),u=nT.from(c,"utf8");return s.usegzip&&(u=ZS.gzipSync(u)),{file:()=>Promise.resolve(u)}}}]},maplabels:function(e,t,n,r,i,a){
let s=n,o=`${s.name}/${a.x}-${a.z}.${n.usegzip?"json.gz":"json"}`;return[{layer:s,name:o,hash:r.recthash(a),datarect:a,async run2d(t){let n=t[0].chunkSize,r={x:a.x*n,z:a.z*n,xsize:n,zsize:n
},i=t.flatMap((e=>e.chunk?.locs??[])),o=await async function(e,t,n,r){let i=new Map
;for(let a of t)if(!(a.x<n.x-0||a.z<n.z-0)&&!(a.x>=n.x+n.xsize+0||a.z>=n.z+n.zsize+0)&&!(-1==a.effectiveLevel||!a.forceVisible&&a.effectiveLevel>r)&&a.location.mapFunction){let t=i.get(a.location.mapFunction);if(!t){
let n=e.mapMaplabels[a.location.mapFunction];n.legacy_switch&&(n=e.mapMaplabels[n.legacy_switch.default_ref]);let r="",s=0,o=0;if(null!=n.sprite){let t=J_(await e.getFileById(xg.sprites,n.sprite));r=await Dm(t[0].img),s=t[0].img.width,
o=t[0].img.height}t={src:r,width:s,height:o,uses:[]},i.set(a.location.mapFunction,t)}t.uses.push({x:a.x-n.x,z:a.z-n.z})}return[...i.entries()].map((([e,t])=>({id:e,...t})))}(e,i,r,s.level),l=Sv()(o,{indent:"\t"}),c=nT.from(l,"utf8")
;return s.usegzip&&(c=ZS.gzipSync(c)),{file:()=>Promise.resolve(c)}}}]},rendermeta:function(e,t,n,r,i,a){let s=n,o=`${s.name}/${a.x}-${a.z}.${n.usegzip?"json.gz":"json"}`;return[{layer:s,name:o,hash:r.recthash(a),datarect:a,async run(e){
let t=e[0].loaded.rendermeta,n=nT.from(JSON.stringify(t),"utf8");return s.usegzip&&(n=ZS.gzipSync(n)),{file:()=>Promise.resolve(n)}}}]}};function dT(e,t,n,r,i){let a=2/n,s=new Za
;return s.projectionMatrix.elements=[a,a*r,0,-e*a-1,0,a*i,-a,-t*a-1,0,-.01,0,0,0,0,0,1],s.projectionMatrix.transpose(),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s}class pT extends Is{constructor(e,t,n){
super(-e/2,e/2,e/2,-e/2,-500,500),this.skewMatrix=new ci,this.setSkew(t,n)}pointDown(){this.quaternion.setFromUnitVectors(new Dr(0,0,1),new Dr(0,1,0))}setSkew(e,t){this.skewMatrix.set(1,0,e,0,0,1,t,0,0,0,1,0,0,0,0,1),this.updateProjectionMatrix()}
updateProjectionMatrix(){this.skewMatrix&&(super.updateProjectionMatrix(),this.projectionMatrix.multiply(this.skewMatrix),this.projectionMatrixInverse.copy(this.projectionMatrix).invert())}}var fT=n(6540),mT=n(2485),gT=n.n(mT),_T=n(8287).Buffer
;function vT(e,t,n){return`${ET[e]?.name??`${e}`}-${vv(e,t,n)}`}function yT(e,t,n){return`${ET[e]?.name??`${e}`}-${e}_${t}${-1!=n?`_${n}`:""}`}function bT(e,t,n){return n+""}let xT={[Ag.mapoverlays]:{name:"overlays",comparesubfiles:!0,
parser:Qg.mapsquareOverlays,outputType:"json",getFileName:bT},[Ag.mapunderlays]:{name:"underlays",comparesubfiles:!0,parser:Qg.mapsquareUnderlays,outputType:"json",getFileName:bT},[Ag.mapscenes]:{name:"mapsscenes",comparesubfiles:!0,
parser:Qg.mapscenes,outputType:"json",getFileName:bT}},ET={[xg.objects]:{name:"loc",comparesubfiles:!0,parser:Qg.object,outputType:"json",getFileName:vT},[xg.items]:{name:"item",comparesubfiles:!0,parser:Qg.item,outputType:"json",getFileName:vT},
[xg.npcs]:{name:"npc",comparesubfiles:!0,parser:Qg.npc,outputType:"json",getFileName:vT},[xg.models]:{name:"model",comparesubfiles:!1,parser:Qg.models,outputType:"json",getFileName:yT},[xg.oldmodels]:{name:"oldmodel",comparesubfiles:!1,
parser:Qg.oldmodels,outputType:"json",getFileName:yT},[xg.mapsquares]:{name:"mapsquare",comparesubfiles:!1,parser:null,outputType:"bin",getFileName:function(e,t,n){return`mapsquare-${t%128}_${Math.floor(t/128)}`}},[xg.enums]:{name:"enum",
comparesubfiles:!0,parser:Qg.enums,outputType:"json",getFileName:vT},[xg.sequences]:{name:"sequence",comparesubfiles:!0,parser:Qg.sequences,outputType:"json",getFileName:vT},[xg.spotanims]:{name:"spotanim",comparesubfiles:!0,parser:Qg.spotAnims,
outputType:"json",getFileName:vT},[xg.achievements]:{name:"achievements",comparesubfiles:!0,parser:Qg.achievement,outputType:"json",getFileName:vT},[xg.materials]:{name:"material",comparesubfiles:!0,parser:Qg.materials,outputType:"json",
getFileName:vT},[xg.texturesBmp]:{name:"texturesBmp",comparesubfiles:!1,parser:null,outputType:"png",getFileName:yT},[xg.texturesDds]:{name:"texturesDds",comparesubfiles:!1,parser:null,outputType:"png",getFileName:yT},[xg.texturesPng]:{
name:"texturesPng",comparesubfiles:!1,parser:null,outputType:"png",getFileName:yT},[xg.texturesKtx]:{name:"texturesKtx",comparesubfiles:!1,parser:null,outputType:"png",getFileName:yT},[xg.sprites]:{name:"sprites",comparesubfiles:!1,parser:null,
outputType:"png",getFileName:yT},[xg.cutscenes]:{name:"cutscenes",comparesubfiles:!1,parser:Qg.cutscenes,outputType:"json",getFileName:yT},[xg.interfaces]:{name:"interfaces",comparesubfiles:!1,parser:null,outputType:"html",getFileName:yT},
[xg.config]:(e,t)=>xT[t]};function wT(e){return{name:Object.entries(xg).find((t=>t[1]==e))?.[0]??`unk_${e}`,comparesubfiles:!1,parser:null,outputType:"bin",getFileName:yT}}class ST{constructor(e,t,n,r){this.source=e,this.major=t,this.minor=n,
this.crc=r}load(){return this.source.getFile(this.major,this.minor,this.crc)}}class TT{constructor(e,t,n,r,i,a,s){this.action=e,this.type=t,this.major=n,this.minor=r,this.subfile=i,this.before=a,this.after=s}async getBefore(){try{
if(null==this.before)throw new Error("no before file");return _T.isBuffer(this.before)?this.before:await this.before.load()}catch(e){return null}}async getAfter(){try{if(null==this.after)throw new Error("no after file")
;return _T.isBuffer(this.after)?this.after:await this.after.load()}catch(e){return null}}}async function AT(e,t,n,r,i=0,a=1<<30){let s=[],o=[];try{t&&(s=await t.getCacheIndex(r))}catch(e){}try{n&&(o=await n.getCacheIndex(r))}catch(e){}
let l=Math.max(s.length,o.length),c=[],u=ET[r]??wT(r);i=Math.max(0,i),a=Math.min(l,a);for(let l=i;l<a&&"running"==e.state;l++){var h="function"==typeof u?u(r,l)??wT(r):u;let i=s[l],a=o[l]
;if((i||a)&&(!i||!a||i.version!=a.version))if(h.comparesubfiles){try{var d=i&&t?await t.getFileArchive(i):[],p=a&&n?await n.getFileArchive(a):[]}catch(t){e.log(t.message);continue}for(let t=0,n=0;;){let r=d[t],s=p[n]
;if(r&&(!s||r.fileid<s.fileid))t++,c.push(new TT(h,"delete",i.major,i.minor,r.fileid,r.buffer,null));else if(s&&(!r||s.fileid<r.fileid))n++,c.push(new TT(h,"add",a.major,a.minor,s.fileid,null,s.buffer));else{if(!r||!s||r.fileid!=s.fileid){
if(r||s)throw e.log(r,s),new Error("shouldnt happen");break}0!=_T.compare(r.buffer,s.buffer)&&c.push(new TT(h,"edit",i.major,i.minor,r.fileid,r.buffer,s.buffer)),t++,n++}}}else if(i)if(a){
let e=t?new ST(t,i.major,i.minor,i.crc):null,r=n?new ST(n,a.major,a.minor,a.crc):null;c.push(new TT(h,"add",i.major,i.minor,-1,e,r))}else{let e=t?new ST(t,i.major,i.minor,i.crc):null;c.push(new TT(h,"delete",i.major,i.minor,-1,e,null))}else{
let e=n?new ST(n,a.major,a.minor,a.crc):null;c.push(new TT(h,"add",a.major,a.minor,-1,null,e))}}return c}async function CT(e,t,n,r,i){let a=[],s=await n.getCacheIndex(xg.index),o=await r.getCacheIndex(xg.index),l=Math.max(s.length,o.length)
;for(let t=0;t<l;t++)(0==i.length||i.some((e=>e.end[0]>=t&&e.start[0]<=t)))&&(s[t]&&!o[t]&&e.log(`major ${t} removed`),!s[t]&&o[t]&&e.log(`major ${t} added`),s[t]&&o[t]&&a.push(t));let c=[];for(let s of a){if("running"!=e.state)break
;let a=i.find((e=>e.start[1]<=s&&e.end[0]>=s)),o=await AT(e,n,r,s,a?.start[1],a?.end[1]);c.push(...o);for(let e of o){let i=e.action.getFileName(e.major,e.minor,e.subfile),a=`${e.action.name}`;await t.mkDir(a)
;let s=await e.getBefore(),o=await e.getAfter(),l=async(e,n,r)=>{await t.writeFile(`${a}/${i}-${n?"after":"before"}.${e}`,r)};if("json"==e.action.outputType)s&&await l("json",!1,Sv()(e.action.parser.read(s,n))),
o&&await l("json",!0,Sv()(e.action.parser.read(o,r)));else if("bin"==e.action.outputType||"rstex"==e.action.outputType)s&&await l(e.action.outputType,!1,s),o&&await l(e.action.outputType,!0,o);else if("png"==e.action.outputType){if(s){
let t=e.major==xg.sprites?J_(s)[0].img:await new m_(s,!1,!1).toImageData(0);await l("png",!1,await Cm(t,"png",1))}if(o){let t=e.major==xg.sprites?J_(o)[0].img:await new m_(o,!1,!1).toImageData(0);await l("png",!0,await Cm(t,"png",1))}
}else if("html"==e.action.outputType){if(s){let t=await fE(new uE(n),e.minor);await l("html",!1,t)}if(o){let t=await fE(new uE(r),e.minor);await l("html",!0,t)}}}}return e.log("done",c.length,"total changes"),c}var MT=n(8287).Buffer
;async function IT(e,t,n,r="",i=0){let a=new Date(r),s=await Cy();s=s.filter((e=>e.timestamp&&(!r||new Date(e.timestamp)<a)));let o=[xg.config,xg.materials,xg.items,xg.npcs,xg.objects,xg.mapsquares,xg.models,xg.oldmodels],l=null,c=null
;for(let a of function*(){!r&&n&&(yield{source:n,info:"base cache",date:Date.now(),buildnr:n.getBuildNr()});for(let e of s){let t=new Iy(e),n=new Date(e.timestamp??"");yield{source:t,info:`${n.toDateString()}`,date:+n,buildnr:t.getBuildNr()}}
}())if(l=c,c=a,!r||l){
l?e.log(`starting cache diff check ${c.buildnr}->${l.buildnr} - ${c.source.getCacheMeta().name}->${l.source.getCacheMeta().name} - ${c.info}->${l.info})`):e.log(`starting cache check ${c.buildnr} (${c.source.getCacheMeta().name} - ${c.info})`)
;for(let n of o){let r=0,a=0,s=await AT(e,l?.source,c.source,n);for(let n of s){if("add"==n.type||"edit"==n.type){let i=await n.getAfter();if(!i){console.error(`After file expected, ${n.major}.${n.minor}`);continue}if(n.action.parser){
let s=kT(n.action.parser,i,c.source);if(a++,!s.success&&(r++,r<50)){let r=n.action.getFileName(n.major,n.minor,n.subfile),i=`${c.source.getCacheMeta().name.replace(/\W/g,"_")}_${r}`;e.log(`error in ${n.action.name} ${r}`)
;let a=s.getDebugFile("hextext"),o=[a],u=await n.getBefore();if(l&&u){let e=kT(n.action.parser,u,l.source);o.push(MT.alloc(80-a.length%16)),o.push(e.getDebugFile("hextext"))}t.writeFile(i,MT.concat(o))}}}if(0!=i&&a>=i)break}
e.log(`major ${n} - ${r}/${a} errors`)}}}async function RT(e,t,n,r,i,a){const{skipMinorAfterError:s,skipFilesizeAfterError:o,memlimit:l,orderBySize:c}=a;let u,h=0,d=[],p=[],f=0,m=0,g=Date.now();await(r.prepareDump?.(n))
;let _=(await Promise.all(i.map((e=>r.lookup.logicalRangeToFiles(n,e.start,e.end))))).flat();function v(i){if(s&&-1!=d.indexOf(i.minor))return!0;if(o&&-1!=p.indexOf(i.file.byteLength))return!0
;Date.now()-g>1e4&&(e.log("progress, file ",i.major,i.minor,i.subfile),g=Date.now());let l=kT(r.parser,i.file,n)
;if("running"==e.state&&(!globalThis.testDecodeOutputFilter||globalThis.testDecodeOutputFilter(l.state,l.debugdata.rootstate))&&(l.success?m++:(d.push(i.minor),p.push(i.file.byteLength),f++),a.dumpall||!l.success)){
let e=r.lookup.fileToLogical(n,i.major,i.minor,i.subfile),s=`${l.success?"pass":"fail"}-${i.name?`${i.name}`:`${e.join("_")}`}`;"json"==a.outmode&&t.writeFile(s+".hexerr.json",l.getDebugFile(a.outmode)),
"original"!=a.outmode&&"hextext"!=a.outmode||t.writeFile(s+".bin",l.getDebugFile(a.outmode))}return f<a.maxerrs}u=async function*(){let t=[],i=null;for(let a of _){let s=a.index;if(!i||s!=i.index){let e,t=null;try{e=await n.getFileArchive(s)
}catch(n){e=[],t=n}i={index:s,subfiles:e,error:t},h+=e.reduce(((e,t)=>e+t.size),0)}let o=i.subfiles[a.subindex];if(!o){if(i.error){let t=r.lookup.fileToLogical(n,a.index.major,a.index.minor,a.subindex)
;e.log(`skipped ${t.join(".")} due to error: ${i.error}`)}else e.log("subfile not found");continue}let u={major:s.major,minor:s.minor,subfile:a.subindex,file:o.buffer};if(!globalThis.testDecodeFilter||globalThis.testDecodeFilter(u))if(c){
if(t.push(u),h>l)return e.log("skipping file because of memory limit",_.indexOf(a),"/",_.length),!1}else yield u}0!=t.length&&(t.sort(((e,t)=>e.file.byteLength-t.file.byteLength)),e.log("starting files:",t.length),yield*t)};for await(let t of u()){
if("running"!=e.state)break;if(!v(t))break}e.log("completed files:",m),e.log(f,"errors")}function kT(e,t,n,r){Ng(!0);let i=null,a=!1,s=null,o={isWrite:!1,buffer:t,stack:[],hiddenstack:[],scan:0,endoffset:t.byteLength,args:{...n.getDecodeArgs(),...r}}
;try{s=e.readInternal(o),a=!0}catch(e){i=e}let l=Ng(!1);return{success:a,error:i,getDebugFile:function(e){let n="";if("original"==e&&(n=t),"json"==e||"hextext"==e){let r={originalFile:t.toString("hex"),chunks:[],state:null,error:i?.message??"success"
},a=0;for(let e=0;e<l.opcodes.length;e++){let t=l.opcodes[e],n=e+1<l.opcodes.length?l.opcodes[e+1]:null,i=n?.index??o.scan,s=i;if(t.jump&&(a=t.jump.to,a==i))continue;let c=" ".repeat(Math.max(0,t.stacksize-1))+t.op;r.chunks.push({offset:a,len:s-a,
label:c}),a=i}let s=o.endoffset-a,c={offset:a,len:s,label:`remainder: ${s}`};if(r.chunks.push(c),"json"==e&&(n=JSON.stringify(r)),"hextext"==e){let e=[],i=0;for(let n of r.chunks){if(n==c)continue;let r=t.slice(n.offset,n.offset+n.len);e.push(r),
i+=r.length;let a=n.label.slice(0,6).padStart(6,"\0"),s=a.length+1,o=0==i?0:16*Math.ceil((i+s)/16)-i;o>0&&(e.push(MT.alloc(1,221)),e.push(MT.alloc(o-1-a.length,255)),e.push(MT.from(a,"ascii"))),i+=o}if(c){let n=t.slice(c.offset,c.offset+c.len)
;e.push(n),i+=n.byteLength,e.push(MT.alloc(2,204)),i+=2}let a=0==i?0:16*Math.ceil((i+33)/16)-i;e.push(MT.alloc(a,255)),e.push(MT.from(r.error,"ascii")),e.push(MT.alloc(5)),e.push(MT.from(JSON.stringify(r.state),"ascii")),n=MT.concat(e)}}return n},
state:o,debugdata:l}}var NT=n(5338);function DT(e){return fT.createElement("div",{className:"mv-modal-container"},fT.createElement("div",{className:"mv-modal",style:{maxWidth:e.maxWidth}},fT.createElement("div",{className:"mv-modal-head"
},fT.createElement("span",null,e.title),fT.createElement("span",{onClick:e.onClose},"X")),fT.createElement("div",{className:"mv-modal-body"},e.children)))}function LT(e,t,n,r=[]){let i=OT({title:"Select item"},fT.createElement(PT,{
cache:e.sceneCache.engine,mode:t,onSelect:(e,t)=>{i.close(),n(e)},initialFilters:r}))}function OT(e,t){let n=document.createElement("div");n.classList.add("mv-style"),document.body.appendChild(n);let r=NT.H(n),i=()=>{r&&(r.unmount(),n.remove(),
r=null)};return r.render(fT.createElement(DT,{onClose:i,title:e.title,maxWidth:e.maxWidth??""},t)),{close:i}}function PT(e){let[t,n]=fT.useState(-1),[r,i]=fT.useState(null);return fT.createElement("div",{style:{display:"grid",
gridTemplateColumns:"40% 60%",height:"100%"}},fT.createElement("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden"}},fT.createElement(FT,{cache:e.cache,mode:e.mode,onSelect:(e,t)=>{n(e),i(t)},initialFilters:e.initialFilters
})),fT.createElement("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden"}},r&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Select",onClick:n=>e.onSelect(t,r)}),fT.createElement(WT,{obj:r})))}function FT(e){
let t=e.initialFilters;const[n,r]=fT.useState(t),{filtered:i,getprop:a,actualfilters:s,loaded:o}=UT(e.cache,e.mode,n),l=(e,t)=>{let i=n.map((e=>({path:e.path.slice(),search:e.search})));if(t){let n=i[e];n||(n={path:[],search:""},i[e]=n),t(n)
}else i.splice(e,1);r(i)};return fT.createElement(fT.Fragment,null,s.map(((e,t)=>fT.createElement(BT,{key:t,index:t,filter:e.filter,editFilters:l,optsthree:e.optsthree,searchtype:e.searchtype}))),fT.createElement("input",{type:"button",
className:"sub-btn",value:"extra filter",onClick:e=>l(s.length,(()=>{}))}),fT.createElement("div",null,o?`${i.length} Matches`:"Loading..."),fT.createElement("div",{style:{flex:"1",overflowY:"auto"}
},i.slice(0,500).map(((t,r)=>fT.createElement("div",{key:t.$fileid,onClick:n=>e.onSelect(t.$fileid,t)},t.$fileid," - ",n.map((e=>a(t,e.path,0).next().value+"")).join(", "))))))}function UT(e,t,n,r=!1){
const i=r?null:e.getJsonSearchData(t),[a,s]=fT.useState(null);fT.useEffect((()=>{!a&&i?.files.then(s)}),[i?.files]);const o=function*(e,t,n){if(Array.isArray(e)){for(let r of e)yield*o(r,t,n);return!1}if(n<t.length){let a=t[n]
;if("object"!=typeof e||(i=a,!(r=e)||!Object.prototype.hasOwnProperty.call(r,i)))return!1;yield*o(e[a],t,n+1)}else yield e;var r,i};let l=a??[],c=[];if(!r)for(let e of n){let t=[],n=i.schema,r="any",a=0,s=null;for(;s!=n;){let i=e.path[a];if(s=n,
"object"!=typeof n)break;if(n.oneOf)2==n.oneOf.length&&"object"==typeof n.oneOf[1]&&"null"==n.oneOf[1].type&&(n=n.oneOf["null"==i?1:0]);else if("object"==n.type)n.properties&&(t.push(Object.keys(n.properties)),i&&(n=n.properties[i],
a++));else if("array"==n.type){if(n.items){if("object"!=typeof n.items)throw new Error("only standard array props supported");Array.isArray(n.items)?(t.push(Object.keys(n.items)),i&&(n=n.items[i],a++)):n=n.items}
}else"string"==typeof n.type?r=n.type:console.log("unknown jsonschema type")}c.push({filter:e,optsthree:t,searchtype:r});const u=e.search.toLowerCase(),h=+e.search,d="true"==e.search;l=l.filter((t=>{for(let n of o(t,e.path,0)){let e=!1
;if("string"==r&&"string"==typeof n&&-1!=n.toLowerCase().indexOf(u)&&(e=!0),"integer"!=r&&"number"!=r||"number"!=typeof n||n!=h||(e=!0),"boolean"==r&&"boolean"==typeof n&&n==d&&(e=!0),e)return!0}return!1}))}return{filtered:l,getprop:o,
actualfilters:c,loaded:!!a}}function BT(e){return fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,auto)"}},e.optsthree.map(((t,n)=>fT.createElement("select",{key:n,value:e.filter.path[n],
onChange:t=>e.editFilters(e.index,(e=>e.path.splice(n,100,t.currentTarget.value)))},t.map(((e,t)=>fT.createElement("option",{key:e,value:e},e)))))),"string"==e.searchtype&&fT.createElement("input",{value:e.filter.search,
onChange:t=>e.editFilters(e.index,(e=>e.search=t.currentTarget.value)),type:"text"}),("number"==e.searchtype||"integer"==e.searchtype)&&fT.createElement("input",{value:e.filter.search,
onChange:t=>e.editFilters(e.index,(e=>e.search=t.currentTarget.value)),type:"number"}),"boolean"==e.searchtype&&fT.createElement("label",null,fT.createElement("input",{checked:"true"==e.filter.search,
onChange:t=>e.editFilters(e.index,(e=>e.search=t.currentTarget.checked+"")),type:"checkbox"}),"True"),fT.createElement("input",{type:"button",className:"sub-btn",value:"x",onClick:t=>e.editFilters(e.index)}))}var zT=function(e,t,n,r){
var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};function GT(e){
let t=fT.useCallback((t=>{e.canvas.classList.add("mv-image-preview-canvas"),t?t.appendChild(e.canvas):e.canvas.remove()}),[e.canvas]);return fT.createElement("div",{ref:t,className:"mv-image-preview",style:e.fillHeight?{height:"100%"}:{}})}
function VT(e){let t=fT.useRef(""),n=fT.useCallback((n=>{if(n){let r=new Blob([e.file],{type:`image/${"svg"==e.ext?"svg+xml":e.ext}`}),i=URL.createObjectURL(r);t.current=i,n.src=i,n.decode().finally((()=>URL.revokeObjectURL(i)))
}else URL.revokeObjectURL(t.current)}),[e.file]);return fT.createElement("div",{className:"mv-image-preview",style:e.fillHeight?{height:"100%"}:{}},fT.createElement("img",{ref:n,className:"mv-image-preview-canvas"}))}function HT(e){
let t=fT.useRef(""),n=fT.useCallback((n=>{if(n){let r=new Blob([e.file],{type:"audio/ogg"}),i=URL.createObjectURL(r);t.current=i,n.src=i}else URL.revokeObjectURL(t.current)}),[e.file]);return fT.createElement("div",{className:"mv-image-preview"
},fT.createElement("audio",{ref:n,controls:!0,autoPlay:e.autoplay}))}function jT(e){const t=`repeat(${Math.min(4,Object.keys(e.tabs).length)},minmax(0,1fr))`;return fT.createElement("div",{className:"mv-tab-strip mv-inset",style:{
gridTemplateColumns:t}},Object.entries(e.tabs).map((([t,n])=>fT.createElement("div",{key:t,className:gT()("mv-icon-button",{active:e.value==t}),onClick:()=>e.onChange(t)},n))))}function WT(e){return fT.createElement("pre",{className:"mv-json-block"
},Sv()(e.obj,{maxLength:32}))}function $T({initialid:e,onChange:t}){let[n,r]=fT.useState(e??0),i=fT.useRef(!1),a=i.current||void 0===e?n:e;return fT.createElement("form",{className:"mv-searchbar",onSubmit:e=>{t(a),e.preventDefault(),i.current=!1}
},fT.createElement("input",{type:"button",style:{width:"25px",height:"25px"},onClick:()=>{r(a-1),t(a-1),i.current=!1},value:"",className:"sub-btn sub-btn-minus"}),fT.createElement("input",{type:"button",style:{width:"25px",height:"25px"},
onClick:()=>{r(a+1),t(a+1),i.current=!1},value:"",className:"sub-btn sub-btn-plus"}),fT.createElement("input",{type:"text",className:"mv-searchbar-input",spellCheck:"false",value:a,onChange:e=>{r(+e.currentTarget.value),i.current=!0}
}),fT.createElement("input",{type:"submit",style:{width:"25px",height:"25px"},value:"",className:"sub-btn sub-btn-search"}))}function qT(e){let[t,n]=fT.useState(""+(e.initialid??"")),[r,i]=fT.useState(e.initialid??0),[a,s]=fT.useState(!1);const o=[{
path:["name"],search:t}];let{loaded:l,filtered:c,getprop:u}=UT(e.cache,e.mode,o,!a);const h=t=>{i(t),e.onChange(t)},d=e=>{let t=+e,r=!isNaN(t);n(e),s(!r),r&&i(t)};return fT.createElement(fT.Fragment,null,fT.createElement("form",{
className:"mv-searchbar",onSubmit:e=>{e.preventDefault(),h(r)}},fT.createElement("input",{type:"button",style:{width:"25px",height:"25px"},onClick:()=>{h(r-1),d(r-1+"")},value:"",className:"sub-btn sub-btn-minus"}),fT.createElement("input",{
type:"button",style:{width:"25px",height:"25px"},onClick:()=>{h(r+1),d(r+1+"")},value:"",className:"sub-btn sub-btn-plus"}),fT.createElement("input",{type:"text",className:"mv-searchbar-input",spellCheck:"false",value:t,
onChange:e=>d(e.currentTarget.value)}),fT.createElement("input",{type:"submit",style:{width:"25px",height:"25px"},value:"",className:"sub-btn sub-btn-search"})),a&&!l&&fT.createElement("div",null,"Loading..."),a&&l&&fT.createElement("div",{
className:"mv-sidebar-scroll"},c.slice(0,100).map(((e,t)=>fT.createElement("div",{key:e.$fileid,onClick:t=>h(e.$fileid)},e.$fileid," - ",u(e,["name"],0).next().value)))),a&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Close",
onClick:e=>d(r+"")}))}function XT({initialid:e,onChange:t}){let[n,r]=fT.useState(e??""),i=fT.useRef(!1),a=i.current||void 0===e?n:e;return fT.createElement("form",{className:"mv-searchbar",onSubmit:e=>{t(a),e.preventDefault(),i.current=!1}
},fT.createElement("input",{type:"text",className:"mv-searchbar-input",spellCheck:"false",value:a,onChange:e=>{r(e.currentTarget.value),i.current=!0}}),fT.createElement("input",{type:"submit",style:{width:"25px",height:"25px"},value:"",
className:"sub-btn sub-btn-search"}))}function YT(e){return fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},fT.createElement("div",null,e.label),e.children)}function KT(e){let[t,n]=fT.useState(!1)
;return fT.createElement("input",{type:"button",className:"sub-btn",onClick:async()=>{await navigator.clipboard.writeText("text"in e?e.text:e.getText()),n(!0),setTimeout((()=>n(!1)),2e3)},value:t?"copied!":"copy"})}function JT(e){
let[t,n]=fT.useState(!1);return fT.createElement("input",{type:"button",className:"sub-btn",onClick:async()=>{let t=await navigator.clipboard.readText();n(!0),setTimeout((()=>n(!1)),2e3),e.onPaste(t)},value:t?"pasted!":"paste"})}
class ZT extends fT.Component{constructor(){super(...arguments),this.el=null,this.stale=!1}onInput(){this.stale=!0}onChange(e){this.props.onChange?.(e),this.stale=!1}ref(e){this.el&&(this.el.removeEventListener("change",this.onChange),
this.el.removeEventListener("input",this.onInput)),e&&(e.addEventListener("change",this.onChange),e.addEventListener("input",this.onInput),this.el=e)}render(){!this.stale&&this.el&&this.props.value&&(this.el.value=this.props.value);let e={
...this.props,onChange:void 0,value:void 0,defaultValue:this.props.value};return fT.createElement("input",{ref:this.ref,...e})}}zT([Gm],ZT.prototype,"onInput",null),zT([Gm],ZT.prototype,"onChange",null),zT([Gm],ZT.prototype,"ref",null);class QT{
constructor(e){this.tex=null,this.cam={long:0,lat:0,longv:0,latv:0,lastUpdate:0,zoom:.6,dragging:!1},this.dragspeed=.1*Math.PI/180,this.pendingFrame=0,this.onScroll=e=>{this.updateZoom(-e.deltaY/350),e.preventDefault()},this.onMouseDown=e=>{
let t,n,r=-1,i=e=>{let t=0,n=0;for(let r=0;r<e.length;r++)t+=e[r].screenX,n+=e[r].screenY;return[t/e.length,n/e.length]};if(e instanceof TouchEvent){if(e.touches.length>1)return;[t,n]=i(e.touches)}else t=e.screenX,n=e.screenY;let a=performance.now()
;this.cam.dragging=!0;let s=(e,r)=>{let i=this.cam.long-(e-t)*this.dragspeed/this.cam.zoom,s=this.cam.lat+(r-n)*this.dragspeed/this.cam.zoom,o=performance.now(),l=Math.max(1,o-a),c=Math.min(1,l/140),u=1-c
;this.cam.latv=u*this.cam.latv+c*(s-this.cam.lat)/l,this.cam.longv=u*this.cam.longv+c*(i-this.cam.long)/l,this.cam.lat=s,this.cam.long=i,this.boundCamera(),t=e,n=r,a=o,this.draw()},o=e=>{s(e.screenX,e.screenY)},l=e=>{
if(e.touches.length>=1&&s(...i(e.touches)),e.touches.length>=2){let t=e.touches[0],n=e.touches[1],i=Math.hypot(t.screenX-n.screenX,t.screenY-n.screenY);r>0&&this.updateZoom((i-r)/100),r=i}},c=e=>{s(e.screenX,e.screenY),d()},u=e=>{r=-1,
0==e.touches.length?d():[t,n]=i(e.touches)},h=e=>{[t,n]=i(e.touches)},d=()=>{this.cam.dragging=!1,this.cam.lastUpdate=performance.now(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",c),
window.removeEventListener("touchmove",l),window.removeEventListener("touchend",u),window.removeEventListener("touchstart",h)};window.addEventListener("mouseup",c),window.addEventListener("mousemove",o),window.addEventListener("touchmove",l),
window.addEventListener("touchend",u),window.addEventListener("touchstart",h),e.preventDefault()},this.draw=()=>{this.pendingFrame&&(cancelAnimationFrame(this.pendingFrame),this.pendingFrame=0),this.animateCamera();const e=this.gl,t=this.prog
;let n=e.canvas.clientWidth,r=e.canvas.clientHeight;e.canvas.width==n&&e.canvas.height==r||(e.canvas.width=n,e.canvas.height=r,e.viewport(0,0,n,r)),e.useProgram(t.prog),e.bindBuffer(e.ARRAY_BUFFER,this.plane),
e.vertexAttribPointer(t.aPos,3,e.FLOAT,!1,12,0),e.enableVertexAttribArray(t.aPos),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.tex)
;const i=Math.cos(this.cam.long),a=Math.sin(this.cam.long),s=Math.cos(this.cam.lat),o=Math.sin(this.cam.lat),l=e.canvas.width,c=e.canvas.height,u=this.cam.zoom*Math.hypot(l,c);let h=[l*i,c*-a*o,u*a*s,0*l,c*s,u*o,l*-a,c*-i*o,u*i*s]
;e.uniformMatrix3fv(t.uViewmatrix,!0,h),e.uniform1i(t.uMap,0),e.drawArrays(e.TRIANGLES,0,6),0==this.cam.latv&&0==this.cam.longv||this.forceFrame()},this.cnv=document.createElement("canvas"),this.cnv.style.position="absolute",this.cnv.style.left="0",
this.cnv.style.top="0",this.cnv.style.width="100%",this.cnv.style.height="100%",this.gl=this.cnv.getContext("webgl2"),this.plane=function(e){let t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),
e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),e.STATIC_DRAW),t}(this.gl),this.prog=function(e){
let t=e.createProgram(),n=eA(e,e.VERTEX_SHADER,"\n\t\tattribute vec3 position;\n\t\tvarying vec2 vUv;\n\t\tvoid main()  {\n\t\t\tvUv = vec2(position.x,position.y);\n\t\t\tgl_Position = vec4(position, 1.0);\n\t\t}"),r=eA(e,e.FRAGMENT_SHADER,"\n\t\tprecision mediump float;\n\t\tuniform sampler2D map;\n\t\tuniform mat3 viewmatrix;\n\t\tvarying vec2 vUv;\n\t\t#define M_PI 3.1415926535897932384626433832795\n\t\tvoid main() {\n\t\t\tvec3 norm=viewmatrix*vec3(vUv,1.0);\n\t\t\tnorm=normalize(norm);\n\t\t\tfloat lat=asin(norm.y);\n\t\t\tfloat lon=atan(norm.x,norm.z);\n\t\t\tvec2 sample=vec2(lon/2.0/M_PI+0.5,lat/M_PI+0.5);\n\t\t\tgl_FragColor = texture2D(map,sample);\n\t\t}")
;if(e.attachShader(t,n),e.attachShader(t,r),e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+e.getProgramInfoLog(t));return{prog:t,aPos:e.getAttribLocation(t,"position"),
uViewmatrix:e.getUniformLocation(t,"viewmatrix"),uMap:e.getUniformLocation(t,"map")}}(this.gl),this.cnv.addEventListener("mousedown",this.onMouseDown),this.cnv.addEventListener("touchstart",this.onMouseDown),
this.cnv.addEventListener("wheel",this.onScroll),e&&this.setImage(e)}updateZoom(e){this.cam.zoom=Math.max(.45,Math.min(1.5,this.cam.zoom+e)),this.draw()}free(){this.cnv.removeEventListener("mousedown",this.onMouseDown),
this.cnv.removeEventListener("touchstart",this.onMouseDown),this.cnv.removeEventListener("wheel",this.onScroll)}forceFrame(){this.pendingFrame||(this.pendingFrame=requestAnimationFrame(this.draw))}boundCamera(){
this.cam.lat=Math.max(.6*-Math.PI,Math.min(.6*Math.PI,this.cam.lat))}animateCamera(){let e=performance.now(),t=Math.max(1,e-this.cam.lastUpdate);this.cam.dragging||(this.cam.lat+=this.cam.latv*t,this.cam.long+=this.cam.longv*t)
;let n=Math.hypot(this.cam.latv,this.cam.longv);if(0!=n){let e=this.cam.latv/n,r=this.cam.longv/n;n*=Math.pow(.5,t/200),n-=1e-6*t,n<1e-5&&(n=0),this.cam.latv=e*n,this.cam.longv=r*n,this.boundCamera()}this.cam.lastUpdate=e}async setImage(e){
let t=this.tex;this.tex=await async function(e,t){let n,r;"string"==typeof t?(n=new Image,n.src=t,await n.decode(),r=!0):t instanceof ImageData?(n=await createImageBitmap(t),r=!1):(n=t,r=!0);let i=e.createTexture()
;return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),
e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i}(this.gl,e),t&&this.gl.deleteTexture(t),this.forceFrame()}}function eA(e,t,n){const r=e.createShader(t)
;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+e.getShaderInfoLog(r));return r}var tA=n(9247),nA=n.n(tA),rA=n(1603),iA=n.n(rA);function aA(e){
return e.split("/").slice(0,-1).join("/")}class sA{constructor(e){this.copyOnSymlink=!0,this.dir=nA().resolve(e),e&&iA().mkdirSync(e,{recursive:!0})}convertPath(e){let t=nA().resolve(this.dir,e.replace(/^\//g,"")),n=nA().relative(this.dir,t)
;if(t!=this.dir&&(n.startsWith("..")||nA().isAbsolute(n)))throw new Error("Error while converting CLIScriptFS path");return t}mkDir(e){return iA().promises.mkdir(this.convertPath(e),{recursive:!0})}writeFile(e,t){
return iA().promises.writeFile(this.convertPath(e),t)}readFileBuffer(e){return iA().promises.readFile(this.convertPath(e))}readFileText(e){return iA().promises.readFile(this.convertPath(e),"utf-8")}async readDir(e){
return(await iA().promises.readdir(this.convertPath(e),{withFileTypes:!0})).map((e=>({name:e.name,kind:e.isDirectory()?"directory":"file"})))}unlink(e){return iA().promises.unlink(this.convertPath(e))}copyFile(e,t,n){
return!n||this.copyOnSymlink?iA().promises.copyFile(this.convertPath(e),this.convertPath(t)):iA().promises.symlink(this.convertPath(t),this.convertPath(e))}}class oA{constructor(){this.state="running",this.log=console.log.bind(console)}setUI(e){
e&&"undefined"!=typeof document&&document.body.appendChild(e)}setState(e){this.state=e}async run(e,...t){try{return await e(this,...t)}catch(e){return console.warn(e),"canceled"!=this.state&&(this.log(e),this.setState("error")),null}finally{
"running"==this.state&&this.setState("done")}}}var lA=n(9544),cA=n.n(lA),uA=n(8287).Buffer,hA=n(5606);let dA=(()=>{try{let e=n(6455);if(e?.ipcRenderer)return e}catch(e){}return null})();class pA{constructor(e){this.dirhandles=new Map,
this.roothandle=e,this.dirhandles.set("",e)}async getDir(e,t){let n=e.split("/"),r=this.roothandle,i="";for(let e of n){if(".."==e)throw new Error("unexpected");if("."==e||""==e)continue;i+=e+"/";let n=this.dirhandles.get(i)
;n||(n=await r.getDirectoryHandle(e,{create:t}),this.dirhandles.set(i,n)),r=n}return r}async getFile(e,t){let n=e.split("/"),r=n.pop();return(await this.getDir(n.join("/"),!1)).getFileHandle(r,{create:t})}async mkDir(e){await this.getDir(e,!0)}
async readDir(e){let t=await this.getDir(e,!1),n=[];for await(let[e,r]of t.entries())n.push({name:e,kind:r.kind});return n}async writeFile(e,t){let n=await this.getFile(e,!0),r=await n.createWritable({keepExistingData:!1});await r.write(t),
await r.close()}async unlink(e){throw new Error("not implemented")}async copyFile(e,t,n){await this.writeFile(t,await this.readFileBuffer(e))}async readFileBuffer(e){let t=await this.getFile(e,!1)
;return uA.from(await(await t.getFile()).arrayBuffer())}async readFileText(e){let t=await this.getFile(e,!1);return(await t.getFile()).text()}}function fA(e,t){if("directory"==e.kind){if(""==t||"."==t)return e
;if(".."==t)throw new Error("directory up (..) not allowed");return e.files.get(t)}}class mA extends xm{constructor(e,t=null){super(),this.rootmemfsnode={name:".",kind:"directory",files:new Map},this.stallmkdir=null,this.totalfiles=0,
this.totalbacksaved=0,this.output=e,this.backingfs=t,this.backingfsstarted=!!t}getFileNode(e,t){let n=e.split("/"),r=t?n.length-1:n.length,i=this.rootmemfsnode;for(let e=0;e<r;e++){let t=fA(i,n[e]);if(!t)return null;i=t}return i}async mkDir(e){
if(this.stallmkdir&&await this.stallmkdir,this.backingfs)await this.backingfs.mkDir(e);else{let t=this.rootmemfsnode,n=e.split("/");for(let e of n){if("directory"!=t.kind)throw new Error("trying to create directory where there is already a file")
;let n=fA(t,e);n||(n={name:e,kind:"directory",files:new Map},t.files.set(e,n)),t=n}}this.emit("mkdir",e)}async writeFile(e,t){if(this.backingfs)this.totalfiles++,this.totalbacksaved++,await this.backingfs.writeFile(e,t);else{
let n=this.getFileNode(e,!0);if(!n||"directory"!=n.kind)throw new Error("target directory doesn't exist");let r=e.split("/").at(-1),i={name:r,kind:"file",data:t};n.files.has(r)?this.output?.log(`overwriting file "${e}"`):this.totalfiles++,
n.files.set(r,i)}this.emit("writefile",e)}async readFileBuffer(e){let t=this.getFileNode(e);if(!t){if(this.backingfs)return this.backingfs.readFileBuffer(e);throw new Error("file not found")}
if("file"!=t.kind)throw new Error(`node for '${e}' is not a file`);return"string"==typeof t.data?uA.from(t.data,"utf8"):t.data}async readFileText(e){let t=this.getFileNode(e);if(!t){if(this.backingfs)return this.backingfs.readFileText(e)
;throw new Error("file not found")}if("file"!=t.kind)throw new Error(`node for '${e}' is not a file`);return"string"==typeof t.data?t.data:t.data.toString("utf8")}async readDir(e){let t=await(this.backingfs?.readDir(e))??[],n=this.getFileNode(e)
;if(n){if("directory"!=n.kind)throw new Error("directory expected");for(let e of n.files.values())t.push({name:e.name,kind:e.kind})}return t}unlink(e){throw new Error("not implemented")}async copyFile(e,t,n){if(this.totalfiles++,
this.backingfs)this.totalbacksaved++,await this.backingfs.copyFile(e,t,n);else{let n=this.getFileNode(e),r=this.getFileNode(t,!0);if(!n)throw new Error("file doesn't exist")
;if(!r||"directory"!=r.kind)throw new Error("symlink target directory doesn't exist");r.files.set(t.split("/").at(-1),n)}this.emit("writefile",t)}async lateBindBackingFs(e){
if(this.backingfsstarted)throw new Error("UIScriptFS already has a backingfs");this.backingfsstarted=!0;let t=async(n,r,i)=>{if(i||"file"!=n.kind||(this.totalbacksaved++,await e.writeFile(r,n.data),this.emit("download",r)),"directory"==n.kind){
await e.mkDir(r);for(let[e,a]of n.files)i&&"directory"!=a.kind||await t(a,`${r}/${a.name}`,i),i||n.files.delete(e)}};this.stallmkdir=t(this.rootmemfsnode,".",!0),await this.stallmkdir,this.backingfs=e,this.stallmkdir=null,t(this.rootmemfsnode,".",!1)
}}class gA extends xm{log(...e){let t=e.join(" ");this.logs.push(t),this.emit("log",t)}setState(e){this.state=e,this.emit("statechange",void 0)}setUI(e){this.outputui=e,this.emit("statechange",void 0)}constructor(){super(),this.state="running",
this.logs=[],this.outputui=null,this.fs={}}makefs(e){let t=new mA(this);return this.fs[e]=t,this.emit("statechange",void 0),t}async run(e,...t){try{return await e(this,...t)}catch(e){return console.warn(e),"canceled"!=this.state&&(this.log(e),
this.setState("error")),null}finally{"running"==this.state&&this.setState("done")}}}function _A(e){return e+1}function vA(){const[,e]=fT.useReducer(_A,0);return e}function yA(e=50){const t=vA();let n=fT.useRef((()=>{}));return fT.useMemo((()=>{
let r=0,i=()=>{r=0,t()};return n.current=()=>{r||(r=+setTimeout(i,e))},()=>{clearTimeout(r),r=0}}),[t,n]),n.current}function bA(e){let t=fT.useRef(null);t.current||(t.current=new QT(e.img),t.current.cnv.style.width="100%",
t.current.cnv.style.height="100%");let n=fT.useRef(e.img);e.img!=n.current&&(t.current.setImage(e.img),n.current=e.img),fT.useEffect((()=>()=>t.current?.free()),[]);let r=fT.useRef(null)
;return fT.createElement(fT.Fragment,null,fT.createElement("div",null,fT.createElement("input",{type:"button",className:"sub-btn",value:"Fullscreen",onClick:()=>r.current?.requestFullscreen()})),fT.createElement("div",{ref:e=>{
t.current?.cnv&&e&&e.appendChild(t.current?.cnv),r.current=e},style:{position:"relative",paddingBottom:"60%"}}))}function xA(e){let t=e.tagName??"div";return fT.createElement(t,{ref:t=>{e.el&&t&&t.replaceChildren(e.el)},style:e.style,
className:e.className})}function EA(e){let[t,n]=fT.useState("console"),r=yA();if(fT.useEffect((()=>(e.output?.on("statechange",r),()=>{e.output?.off("statechange",r)})),[e.output]),!e.output)return fT.createElement("div",null,"Waiting")
;let i=t.match(/^fs-(.*)$/),a=i&&e.output&&e.output.fs[i[1]],s={console:"Console"};for(let t in e.output?.fs)s["fs-"+t]=t
;return fT.createElement("div",null,fT.createElement("div",null,"Script state: ",e.output.state,"running"==e.output.state&&fT.createElement("input",{type:"button",className:"sub-btn",value:"cancel",onClick:t=>e.output?.setState("canceled")
})),e.output.outputui&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Script ui",onClick:t=>OT({title:"Script output"},fT.createElement(xA,{el:e.output?.outputui}))}),fT.createElement(jT,{value:t,onChange:n,tabs:s
}),"console"==t&&fT.createElement(SA,{output:e.output}),a&&fT.createElement(wA,{fs:a,ctx:e.ctx}))}function wA(e){let[t,n]=fT.useState(4e3),[r,i]=fT.useState(""),[a,s]=fT.useState(!1),o=yA(50),[l,c,u,h]=fT.useMemo((()=>{let t=new Set,n=new Set
;return(async()=>{if(e.fs){let i=await e.fs.readDir(r);for(let e of i)"file"==e.kind&&t.add(e.name),"directory"==e.kind&&n.add(e.name)}else t.clear(),n.clear();o()})(),[t,n,e=>{
e.startsWith(r)&&-1==e.indexOf("/",r.length+1)&&(t.add(e.slice(r.length)),o())},e=>{if(e.startsWith(r)){let t=e.slice(r.length).split("/")[0];if(""==t)return;n.has(t)||(n.add(t),o())}}]}),[e.fs,r,a]);fT.useEffect((()=>(e.fs?.on("writefile",u),
e.fs?.on("mkdir",h),e.fs?.on("download",o),()=>{e.fs?.off("writefile",o),e.fs?.off("mkdir",h),e.fs?.off("download",o)})),[e.fs,u,h]);let d=fT.useCallback((async t=>{let n=await e.fs.readFileBuffer(`${r}/${t}`);e.ctx.openFile({fs:e.fs,name:t,data:n})
}),[e.fs,e.ctx,r]),p=fT.useCallback((t=>{if(e.fs&&e.ctx.openedfile&&"ArrowDown"==t.key||"ArrowUp"==t.key){t.preventDefault();let n=null,r=null,i=!1;for(let a of l){if(i){r=a;break}if(a==e.ctx.openedfile?.name){if("ArrowUp"==t.key){r=n;break}i=!0}n=a}
r&&d(r)}}),[e.fs,l,d]);if((0,fT.useEffect)((()=>(globalThis.scriptfs=e.fs,()=>{globalThis.scriptfs=null}))),l){let a=[];""!=r&&a.push(fT.createElement("div",{key:"..",onClick:e=>i(r.split("/").slice(0,-1).join("/"))},"../"))
;for(let e of c)a.push(fT.createElement("div",{key:e,onClick:t=>i(`${r}/${e}`)},e,"/"));for(let n of l){if(a.length>t)break;a.push(fT.createElement("div",{key:n,onClick:e=>d(n),style:n==e.ctx.openedfile?.name?{background:"black"}:void 0},n))}
let o=async()=>{if(!e.fs)return;let t;if(dA){let e=await dA.ipcRenderer.invoke("openfolder",cA().resolve(hA.env.HOME,"downloads"));if(e.canceled||!e.filePaths[0])return;t=new sA(e.filePaths[0])}else{let e=await showDirectoryPicker({mode:"readwrite",
startIn:"downloads"});await e.requestPermission({mode:"readwrite"}),t=new pA(e)}await e.fs.lateBindBackingFs(t),s(!0)};return fT.createElement("div",null,e.fs&&!e.fs.backingfsstarted&&fT.createElement("input",{type:"button",className:"sub-btn",
value:"Save files "+e.fs.totalfiles,onClick:o
}),e.fs?.backingfsstarted&&fT.createElement("div",null,e.fs.totalbacksaved!=e.fs.totalfiles?`Saving to disk: ${e.fs.totalbacksaved}/${e.fs.totalfiles}`:`Saved to disk ${e.fs.totalbacksaved}`),""!=r&&fT.createElement("div",null,"Current folder: ",r.split("/").flatMap(((e,t)=>[fT.createElement("span",{
key:2*t,onClick:e=>i(r.split("/").slice(0,t+1).join("/"))},e),fT.createElement("span",{key:2*t+1},"/")]))),l.size>t&&fT.createElement("div",null,"Only showing first ",t," files"),fT.createElement("div",{tabIndex:0,onKeyDownCapture:p
},a,l.size>t&&fT.createElement("input",{type:"button",className:"sub-btn",onClick:e=>n(t+4e3),value:`Show more(${t} / ${l.size})`})))}return fT.createElement("div",null)}function SA(e){let[t,n]=fT.useState(null);return(0,fT.useEffect)((()=>{
if(t&&e.output){let n=e=>{let n=document.createElement("div");n.innerText=e,t.appendChild(n)};return e.output.on("log",n),e.output.logs.forEach(n),()=>{e.output.off("log",n),t.innerHTML=""}}}),[e.output,t]),fT.createElement("div",{ref:n})}
var TA=n(8287).Buffer;class AA extends yv{constructor(){super(),this.indices=new Map,this.dbfiles={},this.msgidcounter=1,this.callbacks=new Map,this.timestamp=new Date,this.worker=new Worker(new URL(n.p+n.u(850),n.b)),this.worker.onmessage=e=>{
let t=this.callbacks.get(e.data.id);if(e.data.error){if(t){let n=e.data.error
;"getfile"==t.reqpacket.type?n+=`\n in getfile ${t.reqpacket.major}.${t.reqpacket.minor}`:"getindex"==t.reqpacket.type?n+=`\n in getindex ${t.reqpacket.major}`:n+=`\n in other ${t.reqpacket.type}`,t.reject(new Error(n))}
}else t?.resolve(e.data.packet);this.callbacks.delete(e.data.id)}}getCacheMeta(){return{name:"sqlitewasm",descr:"Direclty loads NXT cache files from the disk, in browser compatible environment.",timestamp:this.timestamp}}async generateRootIndex(){
console.log("using generated cache index file meta, crc size and version missing");let e=[];for(let t of Object.keys(this.dbfiles)){let n=t.match(/js5-(\d+)\.jcache$/);n&&(e[n[1]]={major:xg.index,minor:+n[1],crc:0,size:0,subindexcount:1,
subindices:[0],version:0,uncompressed_crc:0,uncompressed_size:0})}return e}sendWorker(e){let t=this.msgidcounter++;return this.worker.postMessage({id:t,packet:e}),new Promise(((n,r)=>this.callbacks.set(t,{resolve:n,reject:r,reqpacket:e})))}
giveBlobs(e){Object.assign(this.dbfiles,e),this.sendWorker({type:"blobs",blobs:e})}async giveFsDirectory(e){let t={};if("granted"!=await e.queryPermission())return console.log("tried to open cache without permission"),null
;for await(let n of e.values())"file"==n.kind&&(t[n.name]=await n.getFile());this.giveBlobs(t)}async getFile(e,t,n){if(e==xg.index)return this.getIndexFile(t);let r=await this.sendWorker({type:"getfile",major:e,minor:t,crc:n})
;return TA.from(r.buffer,r.byteOffset,r.byteLength)}async getFileArchive(e){return dv(await this.getFile(e.major,e.minor,e.crc),e.subindices,e.subnames)}async getCacheIndex(e){if(e==xg.index)return this.generateRootIndex();let t=this.indices.get(e)
;return t||(t=this.getIndexFile(e).then((t=>fv(e,t,this))),this.indices.set(e,t)),t}async getIndexFile(e){let t=await this.sendWorker({type:"getindex",major:e});return TA.from(t.buffer,t.byteOffset,t.byteLength)}close(){this.worker.terminate()}}
var CA=n(9188),MA=n(8287).Buffer
;const IA=new Zg(["struct",["type","ubyte"],["length","ubyte"],["version1","uint"],["version2","uint"],["key","string"],["lang","ubyte"]]),RA=new Zg(["struct",["op","ubyte"],["tribyte","unsigned tribyte"],["short1","ushort"],["version","ushort"],["short2","ushort"]]),kA=new Zg(["struct",["mode","ubyte"],["major","ubyte"],["minor","uint"],["version","ushort"],["short2","ushort"]])
;function NA(e){var t=Object.values(e.param).find((e=>32==e.length));if(!t)throw new Error("client cache key not found in config");let n=parseInt(e.server_version);if(!n)throw new Error("client cache doesn't have a server_version");return{key:t,
serverVersionMajor:n,serverVersionMinor:1,endpoint:"content.runescape.com",port:43594,unknownshort1:0,unknownshort2:0}}var DA=0;function LA(e){Math.floor(DA/1e8)!=Math.floor((DA+e)/1e8)&&console.info(`loaded ${(DA+e)/1e6|0} mb from jagex server`),
DA+=e}class OA{constructor(e){this.pending=[],this.ready=new Em,this.packetPending=[],this.packetPendingError=null,this.packetCallback=null,this.config=e,this.socket=new CA.Socket,this.socket.on("connect",(()=>{
console.log("downloader connected "+this.socket.remoteAddress)})),this.socket.on("data",(e=>{this.packetPending.push(e),this.packetCallback?.(),LA(e.byteLength)})),this.socket.on("close",(()=>{console.log("closed"),
this.packetPendingError=new Error("connection closed"),this.packetCallback?.()})),this.socket.on("error",(e=>{this.packetPendingError=e,this.packetCallback?.()}))}async connect(){if(this.socket.connect(this.config.port,this.config.endpoint),
this.socket.write(IA.write({type:15,length:42,version1:this.config.serverVersionMajor,version2:this.config.serverVersionMinor,key:this.config.key,lang:0})),0!=(await this.getChunk(1)).readUint8(0))throw new Error("unexpected handshake response")
;this.socket.write(RA.write({op:6,tribyte:5,short1:this.config.unknownshort1,short2:this.config.unknownshort2,version:this.config.serverVersionMajor})),this.socket.write(RA.write({op:3,tribyte:5,short1:this.config.unknownshort1,
short2:this.config.unknownshort2,version:this.config.serverVersionMajor}))}async run(){for(await this.connect(),this.ready.done();;){let t=0;try{var e=await this.getChunk(5)}catch(e){return}t+=5
;let n=e.readUint8(0),r=2147483647&e.readUint32BE(1),i=this.pending.find((e=>e.major==n&&e.minor==r));if(!i)throw new Error("Received file which wasn't requested");if(-1==i.totalBytes){let e=await this.getChunk(5);t+=5
;let n=e.readUint8(0),r=e.readUint32BE(1);i.totalBytes=e.byteLength+(0==n?0:4)+r,i.result.push(e),i.currentBytes+=e.byteLength}let a=i.totalBytes-i.currentBytes,s=Math.min(102400-t,a),o=await this.getChunk(s);i.result.push(o),
i.currentBytes+=o.byteLength,i.currentBytes==i.totalBytes&&(this.pending.splice(this.pending.indexOf(i),1),i.done(MA.concat(i.result)))}}writeRequest(e,t){return new Promise(((n,r)=>{this.socket.write(kA.write({mode:255==e&&255==t?33:1,
version:this.config.serverVersionMajor,major:e,minor:t,short2:this.config.unknownshort2})),this.pending.push({major:e,minor:t,totalBytes:-1,pendingsocket:this.socket,result:[],currentBytes:0,done:n,err:r})}))}async getChunk(e){let t=MA.alloc(e),n=0
;for(;n<e;){if(0!=this.packetPending.length||this.packetPendingError||await new Promise((e=>this.packetCallback=e)),0==this.packetPending.length&&this.packetPendingError){for(let e of this.pending)e.err(this.packetPendingError)
;throw this.packetPendingError}let r=this.packetPending[0],i=Math.min(r.byteLength,e-n);r.copy(t,n,0,i),n+=i,i==r.byteLength?this.packetPending.shift():this.packetPending[0]=r.slice(i)}return t}}class PA extends bv{constructor(){super(!0),
this.socket=null,this.socketPromise=null,this.timestamp=new Date,this.configPromise=async function(){let e=(await iy()("http://world3.runescape.com/jav_config.ws?binaryType=2").then((e=>e.text()))).split(/(?:\r\n|\r|\n)/g)
;for(var t={},n=0;n<e.length;++n){let r=e[n].split(/(?:=)/g);2==r.length?t[r[0]]=r[1]:3==r.length&&(t[r[0]]=t[r[0]]||{},t[r[0]][r[1]]=r[2])}if("string"!=typeof t.server_version)throw new Error("server version not found in config");return t
}().then(NA)}getCacheMeta(){return{name:"live",descr:"Download live data from jagex server",timestamp:this.timestamp}}async getSocket(){return this.socketPromise||(this.socketPromise=(async()=>{let e=await this.configPromise,t=new OA(e)
;return t.run().catch().finally((()=>{this.socket=null,this.socketPromise=null})),await t.ready,this.socket=t,this.socket})()),this.socketPromise}async getFile(e,t,n){if(e==xg.music){
let n=await this.configPromise,r=(await this.getCacheIndex(e)).find((n=>n&&n.major==e&&n.minor==t));if(!r)throw new Error("requested file not found")
;let i=await iy()(`https://${n.endpoint}/ms?m=0&a=${e}&k=${n.serverVersionMajor}&g=${t}&c=${r.crc|0}&v=${r.version}`);if(!i.ok)throw new Error(`http cache request failed with code ${i.status}`);let a=await i.arrayBuffer();return LA(a.byteLength),
z_(MA.from(a))}let r=this.socket??await this.getSocket();for(let a=0;a<10;a++){try{var i=await r.writeRequest(e,t)}catch(e){a>=5&&await cm(500);continue}if("number"==typeof n&&(255!=e||255!=t)){let e=k_(i);if(e!=n){
console.log(`crc fail expected ${n}, got ${e}`),a>=5&&await cm(500);continue}}return z_(i)}throw new Error("Failed to download matching crc after 10 attemps")}close(){this.socket?.socket.end()}}var FA=n(5390),UA=n(5606),BA=n(8287).Buffer
;class zA extends yv{constructor(e,t){super(),this.opentables=new Map,this.timestamp=new Date,this.cachedir=e||yy.resolve(UA.env.ProgramData,"jagex/runescape"),this.writable=!!t}getCacheMeta(){return{name:`sqlite:${this.cachedir}`,
descr:"Directly reads NXT cache files.",timestamp:this.timestamp}}async generateRootIndex(){let e=FA.readdirSync(yy.resolve(this.cachedir));console.log("using generated cache index file meta, crc size and version missing");let t=[];for(let n of e){
let e=n.match(/js5-(\d+)\.jcache$/);e&&(t[e[1]]={major:xg.index,minor:+e[1],crc:0,size:0,subindexcount:1,subindices:[0],version:0,uncompressed_crc:0,uncompressed_size:0})}return t}openTable(e){let t=require("sqlite3");if(!this.opentables.get(e)){
let n,r,i,a,s,o=null;if(e==xg.index)n=this.generateRootIndex(),r=e=>this.openTable(e).readIndexFile(),a=()=>{throw new Error("root index file not accesible for sqlite cache")},i=(e,t)=>this.openTable(e).updateIndexFile(t),s=e=>{
throw new Error("cannot write root index")};else{let l=yy.resolve(this.cachedir,`js5-${e}.jcache`);if(!FA.existsSync(l))throw new Error(`cache index ${e} doesn't exist`);o=new t.Database(l,this.writable?t.OPEN_READWRITE:t.OPEN_READONLY)
;let c=new Promise((e=>o.once("open",e))),u=async(e,t)=>(await c,new Promise(((n,r)=>{o.get(e,t,((e,t)=>{e?r(e):n(t)}))}))),h=async(e,t)=>(await c,new Promise(((n,r)=>{o.run(e,t,((e,t)=>{e?r(e):n(t)}))})))
;r=e=>u("SELECT DATA,CRC FROM cache WHERE KEY=?",[e]),a=()=>u("SELECT DATA FROM cache_index",[]),i=(e,t)=>h("UPDATE cache SET DATA=? WHERE KEY=?",[t,e]),s=e=>h("UPDATE cache_index SET DATA=?",[e]),n=a().then((async t=>{
let n=z_(BA.from(t.DATA.buffer,t.DATA.byteOffset,t.DATA.byteLength));return fv(e,n,this)}))}this.opentables.set(e,{db:o,readFile:r,updateFile:i,readIndexFile:a,updateIndexFile:s,indices:n})}return this.opentables.get(e)}async getFile(e,t,n){
if(e==xg.index)return this.getIndexFile(t);let{readFile:r}=this.openTable(e),i=await r(t);return"number"==typeof n&&i.CRC,z_(BA.from(i.DATA.buffer,i.DATA.byteOffset,i.DATA.byteLength))}async getFileArchive(e){
return dv(await this.getFile(e.major,e.minor,e.crc),e.subindices,e.subnames)}writeFile(e,t,r){let i=this.openTable(e),a=function(e){return function(e){let t=n(8559).deflateSync(e),r=B_.alloc(8+t.byteLength);return r.write("5a4c4201",0,"hex"),
r.writeUInt32BE(e.byteLength,4),t.copy(r,8),r}(e)}(r);return i.updateFile(t,a)}writeFileArchive(e,t,n){let r=new pv(n).packSqlite();return this.writeFile(e,t,r)}async getCacheIndex(e){return this.openTable(e).indices}async getIndexFile(e){
let t=await this.openTable(e).readIndexFile();return z_(BA.from(t.DATA.buffer,t.DATA.byteOffset,t.DATA.byteLength))}close(){for(let e of this.opentables.values())e.db?.close()}}async function GA(e,t){let n=await e.readDir("."),r=0,i=0,a=0,s=0
;for(let e of n){let t=e.name.match(/\.(\w+)$/);"jcache"==t?.[1]&&r++,"dat2"==t?.[1]&&a++,"dat"==t?.[1]&&i++,"jag"==t?.[1]&&s++}let o=Math.max(r,i,a,s);if(0==o)throw new Error("no cache files found in selected directory");if(o==r){
if(e instanceof sA)return new zA(e.dir,!!t?.writable);if(e instanceof pA){if(!e.roothandle)throw new Error("need fs with hard disk backing");let t=new AA;return await t.giveFsDirectory(e.roothandle),t}}if(o==s)return await Dv.create(e)
;throw new Error("couldn't detect cache type")}function VA(e){let[t,n]=fT.useState(null),[r,i]=fT.useState(!0),[a,s]=fT.useReducer((e=>e+1),0),o=globalThis.sceneCache,l=globalThis.render,c=fT.useMemo((()=>{let e=new uE(o.engine)
;return e.sceneCache=o,e.renderer=l,e}),[o,l]);fT.useEffect((()=>{let t=!0,r=JSON.parse(e.data),i=()=>{};return pE(c,r.id).then((e=>{if(!t)return;let r=function(e,t){let n=document.createElement("div");n.classList.add("rs-interface-container")
;let r=document.createElement("style");r.innerHTML=hE();let i,a=document.createElement("div");a.classList.add("rs-interface-container-sub"),a.style.width=t.basewidth+"px",a.style.height=t.baseheight+"px",n.appendChild(r),n.appendChild(a)
;for(let e of t.rootcomps){let t=e.initDom();a.appendChild(t)}return globalThis.comp=t.rootcomps,globalThis.compctx=e,i=e.runOnloadScripts?(async()=>{
for(let n of t.comps.values())0!=n.data.scripts.load.length&&await e.runClientScriptCallback(n.compid,n.data.scripts.load).catch((e=>console.warn("comp load err",e)))})():Promise.resolve(),{el:n,container:a,rootcomps:t.rootcomps,interfaceid:t.id,
dispose:()=>{t.rootcomps.forEach((e=>e.dispose()))},loadprom:i}}(c,e);i=r.dispose,n(r)})),()=>{t=!1,i()}}),[c,e.data,a,c.runOnloadScripts]);let u=fT.useCallback((e=>{if(!e||!t)return;let n=(e,t)=>{let r=e.getBoundingClientRect()
;t.x1=Math.min(t.x1,r.left),t.x2=Math.max(t.x2,r.right),t.y1=Math.min(t.y1,r.top),t.y2=Math.max(t.y2,r.bottom);for(let r of Array.from(e.children))n(r,t)},r={x1:0,x2:0,y1:0,y2:0};n(t.el,r)
;let i=e.getBoundingClientRect(),a=Math.round(i.left-r.x1),s=Math.round(i.top-r.y1);t.container.style.left=`${a}px`,t.container.style.top=`${s}px`,e.scrollLeft=a,e.scrollTop=s}),[t]),h=fT.useCallback((e=>{let n=null,r=e.target;for(;r&&r!=t?.el;){
let e=r.compid;if("number"==typeof e){n=c.comps.get(e)??null;break}r=r.parentElement}"mouseout"==e.type?c.emit("hover",null):"mouseover"==e.type?c.emit("hover",n):"click"==e.type&&c.emit("select",n)}),[r,c,t]);return fT.createElement("div",{style:{
position:"absolute",inset:"0px",display:"grid",gridTemplate:'"a" 1fr "b" auto "c" 1fr / 1fr'}},fT.createElement("div",{style:{position:"relative",overflow:"auto"},ref:u,onMouseOver:h,onMouseOut:h,onClick:h},fT.createElement(xA,{el:t?.el
})),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:c.runOnloadScripts,onChange:e=>{c.runOnloadScripts=e.currentTarget.checked,s()}
}),"Run load scripts"),fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:r,onChange:e=>i(e.currentTarget.checked)}),"Hover"),fT.createElement("input",{type:"button",className:"sub-btn",onClick:s,value:"reload"
})),fT.createElement("div",{style:{overflowY:"auto"}},t?.rootcomps.map(((e,t)=>fT.createElement(HA,{ctx:c,key:t,source:o.engine,comp:e})))))}function HA(e){let t=e.comp.data,[n,r]=fT.useState(!1),[i,a]=fT.useState(!1),s=fT.useCallback((t=>{
e.ctx.toggleHighLightComp(e.comp.compid,"mouseenter"==t.type)}),[e.ctx,e.comp]);fT.useEffect((()=>{let t=t=>a(t==e.comp),n=t=>r(t==e.comp);return e.ctx.on("hover",t),e.ctx.on("select",n),()=>{e.ctx.off("hover",t),e.ctx.off("select",n)}
}),[e.ctx,e.comp]);let o=fT.useCallback((e=>{e&&n&&e.scrollIntoView()}),[n]);return fT.createElement("div",{className:"rs-componentmeta"+(n||i?" rs-componentmeta--active":""),ref:o,onMouseEnter:s,onMouseLeave:s,
onClick:t=>t.target==t.currentTarget&&console.log(e.comp)
},"id=",65535&e.comp.compid," t=",t.type," ",t.textdata?.text??"no text",fT.createElement("br",null),t.spritedata&&"sprite: "+t.spritedata.spriteid,t.modeldata&&"model: "+t.modeldata.modelid,fT.createElement(jA,{ctx:e.ctx,comp:e.comp,source:e.source
}),fT.createElement("hr",null),fT.createElement("div",{className:"rs-componentmeta-children"},e.comp.children.map(((t,n)=>fT.createElement(HA,{ctx:e.ctx,key:n,comp:t,source:e.source})))))}function jA(e){
return fT.createElement("div",null,Object.entries(e.comp.data.scripts).filter((e=>e[1]&&0!=e[1].length)).map((([t,n])=>{if(!n)throw new Error("unexpected");if("number"!=typeof n[0])throw new Error("unexpected");let r=n[0]
;return fT.createElement("div",{key:t,className:"rs-componentcallback",onClick:t=>e.ctx.runClientScriptCallback(e.comp.compid,n)},t," ",r,"(",n.slice(1).map((e=>"string"==typeof e?`"${e}"`:e)).join(","),")")})))}function WA(e){
let t=vA(),[n,r]=fT.useReducer((e=>e+1),0),[i,a]=fT.useState(null),s=globalThis.sceneCache;fT.useEffect((()=>{let e=!0;return rE(s.engine).then((t=>e&&a(t))),()=>{e=!1}}),[n,i]);let o=fT.useMemo((()=>{if(!i)return null
;let t=JSON.parse(e.data),n=new iE(i);try{n.callscript(t,-1)}catch(e){console.log(e)}return n}),[i,n,e.data]);if(!i||!o)return fT.createElement("div",null,"Callibrating...");globalThis.inter=o
;let l=o.scope?.index??0,c=Math.max(0,l-10),u=o.scope?.ops.slice(c,o.scope.index+600)??[];return fT.createElement("div",{style:{position:"absolute",inset:"0px",display:"grid",gridTemplate:'"a" fit-content "b" 1fr / 1fr'}},fT.createElement("div",{
style:{display:"grid",gridTemplate:'"a b c" / min-content 1fr 1fr'}},fT.createElement("div",null,fT.createElement("input",{type:"button",className:"sub-btn",value:"restart",onClick:e=>r()}),fT.createElement("input",{type:"button",className:"sub-btn",
value:"next",onClick:e=>{o.next(),t()}})),fT.createElement("div",{className:"cs-valuegroup"},fT.createElement("div",null,o.intstack.map(((e,t)=>fT.createElement($A,{key:t,index:t,inter:o,type:"stack"
})))),fT.createElement("div",null,o.longstack.map(((e,t)=>fT.createElement(qA,{key:t,index:t,inter:o,type:"stack"})))),fT.createElement("div",null,o.stringstack.map(((e,t)=>fT.createElement(XA,{key:t,index:t,inter:o,type:"stack"
}))))),fT.createElement("div",{className:"cs-valuegroup"},fT.createElement("div",null,o.scope?.localints.map(((e,t)=>fT.createElement($A,{key:t,index:t,inter:o,type:"local"
})))),fT.createElement("div",null,o.scope?.locallongs.map(((e,t)=>fT.createElement(qA,{key:t,index:t,inter:o,type:"local"})))),fT.createElement("div",null,o.scope?.localstrings.map(((e,t)=>fT.createElement(XA,{key:t,index:t,inter:o,type:"local"
})))))),fT.createElement("div",{style:{overflowY:"auto",whiteSpace:"pre"}},u.map(((e,t)=>fT.createElement("div",{key:t+c},t+c==l?">>":"  ",t+c," ",Wy(e.opcode)," ",e.imm," ",(e.imm_obj??"")+"")))))}function $A(e){
let t="stack"==e.type?e.inter.intstack[e.index]:e.inter.scope?.localints[e.index]??0;return fT.createElement("div",{className:"cs2-value"},"int",e.index," = ",t)}function qA(e){
let t="stack"==e.type?e.inter.longstack[e.index]:e.inter.scope?.locallongs[e.index]??0n;return fT.createElement("div",{className:"cs2-value"},"long",e.index," = ",t.toString())}function XA(e){
let t="stack"==e.type?e.inter.stringstack[e.index]:e.inter.scope?.localstrings[e.index]??"";return fT.createElement("div",{className:"cs2-value"},"string",e.index,' = "',t,'"')}var YA=n(5606),KA=n(8287).Buffer,JA=function(e,t,n,r){
var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};let ZA=(()=>{try{
let e=n(6455);if(e?.ipcRenderer)return e}catch(e){}return null})();async function QA(e,t){let n=document.createElement("a"),r=URL.createObjectURL(t);n.download=e,n.href=r,n.click(),setTimeout((()=>URL.revokeObjectURL(r)),1)}function eC(e){
let[t,n]=fT.useState(null),[r,i]=fT.useState(!1),[a,s]=fT.useState(!0),[o,l]=fT.useState("runescape"),[c,u]=fT.useState(""),[h,d]=fT.useState("en"),p=fT.useCallback((async()=>{i(!0),n(await Cy())}),[]),f=[],m=[],g=[];for(let e of t??[]){
if(e.timestamp){let t=""+new Date(e.timestamp??0).getUTCFullYear();-1==m.indexOf(t)&&m.push(t)}-1==f.indexOf(e.game)&&f.push(e.game),-1==g.indexOf(e.language)&&g.push(e.language)}m.sort(((e,t)=>+t-+e))
;let _=(t??[]).filter((e=>!(o&&e.game!=o||h&&e.language!=h||c&&new Date(e.timestamp??0).getUTCFullYear()!=+c)));return _.sort(((e,t)=>+new Date(t.timestamp??0)-+new Date(e.timestamp??0))),fT.createElement(fT.Fragment,null,fT.createElement(XT,{
initialid:e.initialid+"",onChange:async t=>{let n=+t;n<=0&&(n=(await Iy.getRecentCache(-n)).id),e.onSelect(n)}}),!r&&!t&&fT.createElement("input",{type:"button",className:"sub-btn",onClick:p,value:"More options..."
}),t&&fT.createElement(fT.Fragment,null,fT.createElement("div",{style:{overflowY:"auto"}
},fT.createElement("table",null,fT.createElement("thead",null,fT.createElement("tr",null,fT.createElement("td",null),fT.createElement("td",null,fT.createElement("select",{value:c,onChange:e=>u(e.currentTarget.value)},fT.createElement("option",{
value:""},"Date"),m.map((e=>fT.createElement("option",{key:e,value:e},e))))),fT.createElement("td",null,"Build"))),fT.createElement("tbody",null,_.map((t=>fT.createElement("tr",{key:t.language+t.id
},fT.createElement("td",null,fT.createElement("input",{type:"button",value:t.id,className:"sub-btn",onClick:e.onSelect.bind(null,t.id)
})),fT.createElement("td",null,t.timestamp?new Date(t.timestamp).toDateString():""),fT.createElement("td",null,t.builds.map((e=>e.major+(e.minor?"."+e.minor:""))).join(","))))))))))}class tC extends fT.Component{constructor(e){super(e),this.state={
lastFolderOpen:null},this.props.noReopen||kb("lastfolderopen").then((e=>{e&&this.setState({lastFolderOpen:e})}))}componentDidMount(){document.body.addEventListener("dragover",this.onDragOver),document.body.addEventListener("drop",this.onFileDrop)}
componentWillUnmount(){document.body.removeEventListener("dragover",this.onDragOver),document.body.removeEventListener("drop",this.onFileDrop)}onDragOver(e){e.preventDefault()}async clickOpen(){let e=await showDirectoryPicker();this.props.onOpen({
type:"autohandle",handle:e})}async clickOpenNative(){if(!ZA)return;let e=await ZA.ipcRenderer.invoke("openfolder",lA.resolve(YA.env.ProgramData,"jagex/runescape"));e.canceled||this.props.onOpen({type:"autofs",location:e.filePaths[0],
writable:!!globalThis.writecache})}async clickOpenLive(){this.props.onOpen({type:"live"})}async clickReopen(){this.state.lastFolderOpen&&"granted"==await this.state.lastFolderOpen.requestPermission()&&this.props.onOpen({type:"autohandle",
handle:this.state.lastFolderOpen})}async onFileDrop(e){if(e.preventDefault(),e.dataTransfer){let t={},n=[],r=[],i=[];for(let t=0;t<e.dataTransfer.items.length;t++)n.push(e.dataTransfer.items[t]);await Promise.all(n.map((async e=>{
if(e.getAsFileSystemHandle){let n=await e.getAsFileSystemHandle();if("file"==n.kind){let e=n;i.push(e),t[n.name]=await e.getFile()}else{let e=n;r.push(e);for await(let n of e.values())"file"==n.kind&&(t[n.name]=await n.getFile())}
}else if("file"==e.kind){let n=e.getAsFile();t[n.name]=n}}))),1==r.length&&0==i.length?(console.log("stored folder "+r[0].name),Nb("lastfolderopen",r[0]),this.props.onOpen({type:"autohandle",handle:r[0]
})):(console.log(`added ${Object.keys(t).length} files`),this.props.onOpen({type:"sqliteblobs",blobs:t}))}}openOpenrs2Cache(e){this.props.onOpen({type:"openrs2",cachename:e+""})}render(){
return fT.createElement(fT.Fragment,null,ZA&&fT.createElement(fT.Fragment,null,fT.createElement("h2",null,"Native local RS3 cache"),fT.createElement("p",null,"Only works when running in electron"),fT.createElement("input",{type:"button",
className:"sub-btn",onClick:this.clickOpenNative,value:"Open native cache"
})),ZA&&fT.createElement(fT.Fragment,null,fT.createElement("h2",null,"Jagex Servers"),fT.createElement("p",null,"Download directly from content servers. Only works when running in electron"),fT.createElement("input",{type:"button",
className:"sub-btn",onClick:this.clickOpenLive,value:"Stream from Jagex"})),fT.createElement("h2",null,"Local Cache"),fT.createElement(nC,null),!this.props.noReopen&&this.state.lastFolderOpen&&fT.createElement("input",{type:"button",
className:"sub-btn",onClick:this.clickReopen,value:`Reopen ${this.state.lastFolderOpen.name}`}),fT.createElement("h2",null,"Historical caches"),fT.createElement("p",null,"Enter any valid cache id from ",fT.createElement("a",{target:"_blank",
href:"https://archive.openrs2.org/"},"OpenRS2"),". Entering 0 will load the latest RS3 cache, negative values will load previous caches."),fT.createElement(eC,{initialid:0,onSelect:this.openOpenrs2Cache}))}}function nC(){
const e="undefined"!=typeof FileSystemHandle;let[t,r]=fT.useState(!1),[i,a]=fT.useState(e?"fsapi":"blob")
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,e&&"Drag a folder containing the RS3 cache files here in order to view it.",!e&&"Drag the RS3 cache files you wish to view",fT.createElement("a",{style:{float:"right"},
onClick:e=>r(!t)},t?"Close":"More info")),t&&fT.createElement("div",{style:{display:"flex",flexDirection:"column"}},fT.createElement(jT,{value:i,tabs:{fsapi:"Full folder",blob:"Files"},onChange:a
}),"fsapi"==i&&fT.createElement(fT.Fragment,null,!e&&fT.createElement("p",{className:"mv-errortext"
},"You browser does not support full folder loading!"),fT.createElement("p",null,"Drop the RuneScape folder into this window."),fT.createElement("input",{type:"text",onFocus:e=>e.target.select(),readOnly:!0,value:"C:\\ProgramData\\Jagex"
}),fT.createElement("video",{src:new URL(n(9638),n.b).href,autoPlay:!0,loop:!0,style:{aspectRatio:"352/292"}
})),"blob"==i&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Drop and drop the cache files into this window."),fT.createElement("input",{type:"text",onFocus:e=>e.target.select(),readOnly:!0,value:"C:\\ProgramData\\Jagex"
}),fT.createElement("video",{src:new URL(n(3447),n.b).href,autoPlay:!0,loop:!0,style:{aspectRatio:"458/380"}}))))}JA([Gm],tC.prototype,"onDragOver",null),JA([Gm],tC.prototype,"clickOpen",null),JA([Gm],tC.prototype,"clickOpenNative",null),
JA([Gm],tC.prototype,"clickOpenLive",null),JA([Gm],tC.prototype,"clickReopen",null),JA([Gm],tC.prototype,"onFileDrop",null),JA([Gm],tC.prototype,"openOpenrs2Cache",null);class rC extends xm{constructor(e,t){super(),this.source=null,
this.sceneCache=null,this.renderer=null,this.openedfile=null,this.rootElement=e,this.useServiceWorker=t,t&&navigator.serviceWorker?.register(new URL(n(8592),n.b).href,{scope:"./"})}setCacheSource(e){this.source=e,this.emit("statechange",void 0)}
setSceneCache(e){this.sceneCache=e,this.emit("statechange",void 0)}setRenderer(e){this.renderer=e,this.emit("statechange",void 0)}canRender(){return!!this.source&&!!this.sceneCache&&!!this.renderer}openFile(e){this.openedfile=e,
this.emit("openfile",e)}}async function iC(e,t){let n=null;if("sqliteblobs"==e.type||"autohandle"==e.type)if("autohandle"==e.type){if("granted"==await e.handle.queryPermission({mode:"read"})){let t=new AA;await t.giveFsDirectory(e.handle),
navigator.serviceWorker?.ready.then((t=>t.active?.postMessage({type:"sethandle",handle:e.handle}))),n=t}}else{let t=new AA;t.giveBlobs(e.blobs),n=t}if("openrs2"==e.type&&(n=await Iy.fromId(+e.cachename)),ZA&&"autofs"==e.type){let t=new sA(e.location)
;n=await GA(t,{writable:e.writable})}return"live"==e.type&&(n=new PA),t&&(Nb("openedcache",e),localStorage.rsmv_openedcache=JSON.stringify(e)),n}function aC(e){let t="",n="";e:for(let r=0;;r+=16){0!=r&&(t+="\n",n+="\n");for(let i=0;i<16;i+=8){
0!=i&&(t+="  ",n+=" ");for(let a=0;a<8;a++){let s=r+i+a;if(s>=e.length)break e;let o=e[s];0!=a&&(t+=" "),t+=o.toString(16).padStart(2,"0"),n+=o<32?".":String.fromCharCode(o)}}}return{resulthex:t,resultchrs:n}}function sC(e){
let t=e.ext.split(".").at(-1),n=["json","jsonc","ts","js"].includes(t),[r,i]=fT.useState(null);return r?.ext==e.ext&&(n=r.istext),fT.createElement(fT.Fragment,null,fT.createElement("input",{type:"button",className:"sub-btn",
value:n?"View hex":"View text",onClick:t=>i({ext:e.ext,istext:!n})}),fT.createElement(KT,{getText:()=>n?e.data.toString("utf8"):e.data.toString("hex")}),n&&fT.createElement(uC,{file:e.data.toString("utf8")}),!n&&fT.createElement(oC,{data:e.data}))}
function oC(e){let{resulthex:t,resultchrs:n}=aC(e.data);return fT.createElement("table",null,fT.createElement("tbody",null,fT.createElement("tr",null,fT.createElement("td",{className:"mv-hexrow"},t),fT.createElement("td",{className:"mv-hexrow"},n))))
}function lC(e){let{hexels:t,textels:n,labelel:r}=fT.useMemo((()=>function(e,t){let n="",r="",i=document.createDocumentFragment(),a=document.createDocumentFragment(),s=document.createElement("span"),o={offset:0,len:0,label:"start"},l=[],c=e=>{
let t=+e.currentTarget.dataset.index;if(isNaN(t))return;let n=l[t];n.hexel.classList.add("mv-hex--select"),n.textel.classList.add("mv-hex--select"),s.innerText=`0x${n.chunk.offset.toString(16)} - ${n.chunk.len} ${t}\n${n.chunk.label}`},u=e=>{
let t=+e.currentTarget.dataset.index;if(isNaN(t))return;let n=l[t];n.hexel.classList.remove("mv-hex--select"),n.textel.classList.remove("mv-hex--select"),s.innerText=""},h=()=>{if(""!=n&&""!=r){
let e=document.createTextNode(n),t=document.createTextNode(r);if(o){let n=l.length,r=document.createElement("span"),s=document.createElement("span");r.dataset.index=""+n,s.dataset.index=""+n,r.onmouseenter=c,r.onmouseleave=u,s.onmouseenter=c,
s.onmouseleave=u,r.appendChild(e),s.appendChild(t),i.appendChild(r),a.appendChild(s),l.push({chunk:o,hexel:r,textel:s})}else i.appendChild(e),a.appendChild(t)}o=void 0,n="",r=""};for(let i=0;i<e.length;i++){
let a=0==i?"":i%16==0?"\n":i%8==0?"  ":" ",s=0==i?"":i%16==0?"\n":i%8==0?" ":"";if(o&&(i<o.offset||i>=o.offset+o.len))h(),o=t.find((e=>e.offset<=i&&e.offset+e.len>i));else if(!o){let e=t.find((e=>e.offset<=i&&e.offset+e.len>i));e&&h(),o=e}let l=e[i]
;n+=a+l.toString(16).padStart(2,"0"),r+=s+(l<32?".":String.fromCharCode(l))}return h(),{hexels:i,textels:a,labelel:s}}(e.data,e.chunks)),[e.data,e.chunks])
;return fT.createElement("table",null,fT.createElement("tbody",null,fT.createElement("tr",null,fT.createElement(xA,{tagName:"td",el:t,className:"mv-hexrow"}),fT.createElement(xA,{tagName:"td",el:n,className:"mv-hexrow"
}),fT.createElement("td",null,fT.createElement(xA,{el:r,className:"mv-hexlabel"})))))}function cC(e){let[t,n]=fT.useState("split"),[r,i]=fT.useMemo((()=>{let t=JSON.parse(e.file);return[t,KA.from(t.originalFile,"hex")]}),[e.file]),a=e=>{
let t=Sm(e.currentTarget,(e=>"TR"==e.tagName)),n=Sm(e.currentTarget,(e=>["auto","scroll"].includes(window.getComputedStyle(e).overflowY)));if(!t||!n)return
;let r=n.getBoundingClientRect(),i=t.getBoundingClientRect(),a=(i.top+i.bottom)/2>(r.top+r.bottom)/2,s=r.height/4;n.scrollTop+=a?i.bottom-s:i.top-r.height+s};return fT.createElement("div",{className:"mv-hexrow"
},fT.createElement("div",null,fT.createElement("input",{type:"button",className:gT()("sub-btn",{active:"split"==t}),onClick:e=>n("split"),value:"split"}),fT.createElement("input",{type:"button",className:gT()("sub-btn",{active:"full"==t}),
onClick:e=>n("full"),value:"full"}),fT.createElement("input",{type:"button",className:"sub-btn",onClick:e=>QA("file.bin",new Blob([i],{type:"application/octet-stream"})),value:"download original"}),fT.createElement(KT,{getText:()=>aC(i).resulthex
})),r.error,"full"==t&&fT.createElement(lC,{data:i,chunks:r.chunks}),"split"==t&&fT.createElement(fT.Fragment,null,fT.createElement("div",null,"Chunks"),fT.createElement("table",null,fT.createElement("tbody",null,r.chunks.map(((e,t)=>{
let n=aC(i.slice(e.offset,e.offset+e.len));return fT.createElement("tr",{key:e.offset+"-"+t},fT.createElement("td",null,n.resulthex),fT.createElement("td",null,n.resultchrs),fT.createElement("td",null,e.len>320?fT.createElement("span",{
className:"mv-hexstickylabel",onClick:a},e.label):e.label))}))))),fT.createElement("div",null,"State"),Sv()(r.state))}function uC(e){return fT.createElement("div",{className:"mv-hexrow"},e.file)}function hC(e){
let t=null,n=fT.useRef(null),r=(e.file.name.match(/\.([\w\.]+)$/i)?.[1]??"").toLowerCase(),i=()=>"string"==typeof e.file.data?KA.from(e.file.data,"utf8"):e.file.data,a=()=>"string"==typeof e.file.data?e.file.data:e.file.data.toString("utf8")
;if("hexerr.json"==r)t=fT.createElement(cC,{file:a()});else if("ui.json"==r)t=fT.createElement(VA,{data:a()});else if("cs2.json"==r)t=fT.createElement(WA,{data:a()});else if("html"==r)t=fT.createElement("iframe",{srcDoc:a(),sandbox:"allow-scripts",
style:{width:"95%",height:"95%"}});else if("rstex"==r){let e=new m_(i(),!1,!1);n.current??(n.current=document.createElement("canvas"));const r=n.current;e.toWebgl().then((e=>Bm(r.getContext("2d"),e))),t=fT.createElement(GT,{canvas:n.current,
fillHeight:!0})}else if(["png","jpg","jpeg","webp","svg"].includes(r))t=fT.createElement(VT,{file:i(),ext:r,fillHeight:!0});else if("jaga"==r||"ogg"==r){let e=i(),n=e.readUint32BE(0);if(1245792065==n){let n=Qg.audio.read(e,new xv((()=>{
throw new Error("dummy cache")}),!1));t=fT.createElement(fT.Fragment,null,n.chunks.map(((e,t)=>e.data?fT.createElement(HT,{key:t,file:e.data,autoplay:0==t}):fT.createElement("div",{key:t},e.fileid))))}else 1332176723==n?t=fT.createElement(HT,{
file:i(),autoplay:!0}):console.log("unexpected header",n,n.toString(16))}else t=fT.createElement(sC,{data:i(),ext:r});return t}function dC(e){return fT.createElement("div",{style:{display:"grid",gridTemplateRows:"auto 1fr"}},fT.createElement("div",{
className:"mv-modal-head"},fT.createElement("span",null,e.file.name),fT.createElement("span",{style:{float:"right",marginLeft:"10px"},onClick:t=>QA(e.file.name,new Blob([e.file.data]))},"download"),fT.createElement("span",{style:{float:"right",
marginLeft:"10px"},onClick:t=>e.onSelectFile(null)},"x")),fT.createElement("div",{style:{overflow:"auto",flex:"1",position:"relative"}},fT.createElement(hC,{file:e.file})))}JA([Gm],rC.prototype,"openFile",null);var pC=n(5543);function fC(e,t){(0,
pC.mustBeValid)((0,pC.validate)(e,t))}const mC={type:"integer"},gC={type:"number"},_C={type:"string"},vC={type:"boolean"},yC={properties:{replaceMaterials:{type:"array",minLength:2,maxLength:2,items:mC},replaceColors:{type:"array",minLength:2,
maxLength:2,items:mC}}},bC={type:"array",items:{properties:{modelid:mC,mods:yC},required:["modelid","mods"]}},xC={properties:{type:{const:"custom"},modelkey:_C,name:_C,simpleModel:bC,globalMods:yC,basecomp:_C},
required:["type","modelkey","name","simplemodel","globalMods","basecomp"]},EC={properties:{components:{type:"object",additionalProperties:{oneOf:[{properties:{type:{const:"simple"},modelkey:_C,name:_C,simpleModel:bC},
required:["type","modelkey","name","simplemodel"]},{properties:{type:{const:"map"},modelkey:_C,name:_C,mapRect:{properties:{x:mC,z:mC,xsize:mC,zsize:mC},required:["x","z","xsize","zsize"]}},required:["type","modelkey","name","mapRect"]},xC]}},
actions:{type:"array",items:{oneOf:[{properties:{type:{const:"location"},target:mC,x:gC,z:gC,level:mC,dy:gC,rotation:gC},required:["type","target","x","z","level","dy"]},{properties:{type:{const:"transform"},target:mC,flip:vC,scalex:gC,scaley:gC,
scalez:gC},required:["type","target","flip","scalex","scaley","scalez"]},{properties:{type:{const:"anim"},target:mC,animid:mC},required:["type","target","animid"]},{properties:{type:{const:"animset"},target:mC,animid:mC,anims:{type:"object",
additionalProperties:mC}},required:["type","target","animid","anims"]},{properties:{type:{const:"delay"},target:{const:-1},duration:gC},required:["type","target","duration"]},{properties:{type:{const:"visibility"},target:mC,visibility:vC},
required:["type","target","visibility"]},{properties:{type:{const:"scale"},target:mC,scalex:gC,scaley:gC,scalez:gC},required:["type","target","scalex","scaley","scalez"]}]}}}},wC={properties:{tileimgsize:gC,mapsizex:gC,mapsizez:gC,area:{
default:"full",description:"A string representing the the map area to render. Either one of the named presets (main, full, test ...), or one or more chunk ranges. eg: 50.50,20.20-70.70",anyOf:[{type:"string",
pattern:/^\d+\.\d+(-\d+\.\d+)?(,\d+\.\d+(-\d+\.\d+)?)*$/.source},{type:"string",enum:["main","full","test"]},{type:"string",pattern:/^\w+$/.source}]},layers:{items:{properties:{mode:_C,pxpersquare:gC,name:_C,level:gC,usegzip:vC,subtractlayers:{
items:_C},format:{type:"string",enum:["png","webp"]},mipmode:{enum:["default","avg"]}},required:["mode","name","pxpersquare","level"],oneOf:[{properties:{mode:{enum:["3d","minimap","interactions"]},dxdy:gC,dzdy:gC,hidelocs:vC,overlaywalls:vC,
overlayicons:vC},required:["mode","dxdy","dzdy"]},{properties:{mode:{const:"map"},wallsonly:vC,mapicons:vC,thicklines:vC},required:["mode"]},{properties:{mode:{enum:["height","collision","locs","maplabels","rendermeta"]}},required:["mode"]}]}}},
required:["layers","tileimgsize","mapsizex","mapsizez","area"]};var SC=n(8287).Buffer;async function TC(e,t,n,r,i,a){let s=await Cy();a&&(s=s.filter((e=>{let t=My(e);return a.some((e=>t>=e.start[0]&&t<=e.end[0]))})));let o=HE[n]({}),l=null,c=[]
;for(let n of function*(){i&&(yield i);for(let e of s)yield new Iy(e)}()){if("canceled"==e.state)break;try{
let e=`${n.getCacheMeta().name.replace(/:/g,"-")}-${n.getBuildNr()}`,i=!1,a=o.logicalToFile(n,r),s=(await n.getCacheIndex(a.major)).at(a.minor),u=null,h=null,d=!0,p="bin";if(s){let e=await n.getFileArchive(s);if(u=e[a.subid]?.buffer,
!u)throw new Error("invalid subid");if(!l?.file||0!=SC.compare(u,l.file))if(l&&s.crc==l.hash&&console.log("file change detected without crc change"),i=!0,o.parser){let e=kT(o.parser,u,n);h=e.getDebugFile("json"),d=e.success,p="hexerr.json"}else try{
h=await o.read(u,r,n),d=!0,p=o.ext}catch{h=u,d=!1,p="bin"}}else l&&l.file&&(i=!0);if(i){h||(h="",p="")
;let n=`${h?d?"pass":"fail":"empty"}-${Object.entries(xg).find((([e,t])=>t==a.major))?.[0]??`unkown-${a.major}`}-${a.minor}-${a.subid}-${e}${p&&"."}${p}`;l={cacheids:[],buildnr:[],hash:s?.crc??0,decoded:h,decodedname:n,file:u},c.push(l),
await t.writeFile(n,h??"")}l.buildnr.push(n.getBuildNr()),l.cacheids.push(n.getCacheMeta().name)}catch(t){e.log(`error while decoding diffing file ${r} in "${n.getCacheMeta().name}, ${n.getCacheMeta().descr}"`)}finally{n!=i&&n.close()}}return c}
var AC=n(5606);async function CC(e,t,n,r,i){let a=HE[r.mode];if(!a)throw new Error("unknown mode");let s={...i};(r.batched||-1!=r.batchlimit)&&(s.batched="true");let o=a(s);await o.prepareDump(t,n)
;let l=r.batchlimit,c=r.batched,u=r.files,h=(await Promise.all(u.map((e=>o.logicalRangeToFiles(n,e.start,e.end))))).flat().sort(((e,t)=>e.index.major!=t.index.major?e.index.major-t.index.major:e.index.minor!=t.index.minor?e.index.minor-t.index.minor:e.subindex-t.subindex))
;if(!r.skipread){let i=null,a=null,s=()=>{if(a)return(async()=>{let e=`${r.mode}-${a.startIndex.major}_${a.startIndex.minor}.batch`;-1!=l&&(e+="."+a.batchchunknr),e+=`.${o.ext}`,t.writeFile(e,o.combineSubs(a.outputs)),a=null})()};for(let u of h){
if("running"!=e.state)break;let h;if(i&&i.index==u.index)h=i.subfiles;else{let e=null;try{h=await n.getFileArchive(u.index)}catch(t){e=t,h=[]}i={index:u.index,subfiles:h,error:e}}let p=h[u.subindex];if(!p){
e.log(`skipped ${o.fileToLogical(n,u.index.major,u.index.minor,u.subindex).join(".")} due to error: ${i.error}`);continue}let f=o.fileToLogical(n,u.index.major,u.index.minor,p.fileid);try{var d=o.read(p.buffer,f,n);d instanceof Promise&&(d=await d)
}catch(t){e.log(`file ${f.join(".")}: ${t}`);continue}if(c||-1!=l){let e=a&&-1!=l&&a.outputs.length>=l,t=a&&a.arch!=h;if(!a||e||c&&t){let n=!t&&e&&a?a.batchchunknr+1:0,r=s();r&&await r,a={name:"",startIndex:u.index,arch:h,outputs:[],batchchunknr:n}}
a.outputs.push(d)}else{let e=`${r.mode}${0==f.length?"":"-"+f.join("_")}.${o.ext}`;await t.writeFile(e,d)}}s()}if(r.edit){e.log("press enter to save edits"),await new Promise((e=>AC.stdin.once("data",e)));let i=null,a=()=>{
if(!(n instanceof zA))throw new Error("can only do this on file source of type gamecacheloader");if(i)return console.log("writing archive",i.index.major,i.index.minor,"files",i.subfiles.length),console.log(i.index),
n.writeFileArchive(i.index.major,i.index.minor,i.subfiles.map((e=>e.buffer)))};for(let e of h){let s;i&&i.index==e.index?s=i.subfiles:(await a(),s=await n.getFileArchive(e.index),i={index:e.index,subfiles:s,error:null})
;let l=o.fileToLogical(n,e.index.major,e.index.minor,s[e.subindex].fileid),c=await t.readFileBuffer(`${r.mode}-${l.join("_")}.${o.ext}`);s[e.subindex].buffer=await o.write(c,l,n)}await a()}e.log("done")}async function MC(e,t,n,r){
let i={},a=new Map,s=async e=>{let n=i[e];if(!n){if(!HE[e])throw new Error(`cache decode mode "${e}" not recognized`);n=HE[e]({}),i[e]=n,await n.prepareWrite(t)}return n},o=(e,t,n,r=n.usesArchieves)=>{let i=lm(a,e,(()=>new Map));return lm(i,t,(()=>({
fetchsiblings:r,files:[]})))},l=async(n,r)=>{let i=n.match(/(^|\/)(\w+)-([\d_]+)\.(\w+)$/);if(i){let e=i[3].split(/_/g).map((e=>+e)),n=await s(i[2]),a=n.logicalToFile(t,e),l=o(a.major,a.minor,n),c=await n.write(r,e,t);return void l.files.push({
subid:a.subid,file:c})}let a=n.match(/(^|\/)(\w+)-([\d_]+)\.batch\.json$/);if(a){let e=await s(a[2]),n=JSON.parse(r.toString("utf-8"))
;if(!e.parser)throw new Error(`batch files only supported for json based modes, mode ${a[2]} does not have a json parser`);for(let r of n.files){let n=e.logicalToFile(t,r.$fileid),i=o(n.major,n.minor,e),a=e.parser.write(r,t.getDecodeArgs())
;i.files.push({subid:n.subid,file:a})}}else e.log("can't interpret file: "+n)},c=async(e,t)=>{let n=await e.readDir(t),r="."==t?"":t+"/";for(let t of n){if(t.name.match(/(^|\/)\.[^\/]*$/))continue;let n=r+t.name
;"file"==t.kind&&await l(n,await e.readFileBuffer(n)),"directory"==t.kind&&await c(e,n)}};n&&await c(n,".");for(let e of r)await l(e.name,e.file);for(let[n,r]of a){let i=await t.getCacheIndex(n);for(let[a,s]of r){let r=i[a],o=[]
;r&&s.fetchsiblings&&(o=await t.getFileArchive(r));let l=s.files;l.sort(((e,t)=>e.subid-t.subid));let c=0,u=0,h=[],d=[];for(;;){let e=c<o.length;if(u<l.length&&(!e||l[u].subid<=o[c].fileid))h.push(l[u].subid),d.push(l[u].file),
e&&o[c].fileid==l[u].subid&&c++,u++;else{if(!e)break;h.push(o[c].fileid),d.push(o[c].buffer),c++}}let p=!0
;if(r)if(d.length!=r.subindices.length)p=!1;else for(let e=0;e<d.length;e++)h[e]!=r.subindices[e]&&(p=!1);else e.log(`group ${n}.${a} does not have an index entry, writing anyway`)
;if(!p)throw new Error("tried to replace archive with different subfile ids, need to rewrite index file to make this work");console.log("writing",n,a,h),await t.writeFileArchive(n,a,d)}}}class IC{constructor(e){this.version=0,this.workerid="default",
this.rendermetaLayer=void 0,this.config=e}async symlinkBatch(e){await Promise.all(e.map((e=>this.symlink(e.file,e.hash,e.symlink,e.symlinkbuildnr))))}async beginMapVersion(e){this.version=e}async getRelatedFiles(e,t){return[]}async getMetas(e){
return[]}}class RC extends IC{constructor(e,t){super(t),this.fs=e}makeFileName(e,t,n,r,i){return`${e}/${t}/${n}-${r}.${i}`}assertVersion(e=this.version){if(0!=e&&e!=this.version)throw new Error("versions not supported")}async saveFile(e,t,n,r){
this.assertVersion(r),await this.fs.mkDir(aA(e)),await this.fs.writeFile(e,n)}async getFileResponse(e,t){this.assertVersion(t);try{let t=e.match(/\.(\w+)$/),n=t?"svg"==t[1]?"image/svg+xml":`image/${t[1]}`:"";await this.fs.mkDir(aA(e))
;let r=await this.fs.readFileBuffer(e);return new Response(r,{headers:{"content-type":n}})}catch{return new Response(null,{status:404})}}async symlink(e,t,n,r){this.assertVersion(r),await this.fs.mkDir(aA(e)),await this.fs.copyFile(n,e,!0)}}
const kC='\n{\n\t"$schema": "../generated/maprenderconfig.schema.json",\n\t//test gives a 3x3 area around lumby, "main" for the main world map, "full" for everything, a list of rectangles is also accepted eg: "50.50,20.20-70.70"\n\t"area": "test",//"45.45-55.55", //"50.45-51.46",\n\t//the size of the output images, usually 256 or 512\n\t"tileimgsize": 512,\n\t//list of layers to render\n\t"layers": [\n\t\t{\n\t\t\t"name": "level-0", //name of the layer, this will be the folder name\n\t\t\t"mode": "3d", //3d world render\n\t\t\t"format": "webp", //currently only png and webp. jpeg in theory supported but not implemented or tested\n\t\t\t"level": 0, //floor level of the render, 0 means ground floor and all roofs are hidden, highest level is 3 which makes all roofs visible\n\t\t\t"pxpersquare": 64, //the level of detail for highest zoom level measured in pixels per map tile (1x1 meter). Subject to pxpersquare*64>tileimgsize, because it is currently not possible to render less than one image per mapchunk\n\t\t\t"dxdy": 0.15, //dxdy and dzdy to determine the view angle, 0,0 for straight down, something like 0.15,0.25 for birds eye\n\t\t\t"dzdy": 0.25\n\t\t},\n\t\t{\n\t\t\t"name": "topdown-0", //name of the layer, this will be the folder name\n\t\t\t"mode": "3d", //3d world render\n\t\t\t"format": "webp", //currently only png and webp. jpeg in theory supported but not implemented or tested\n\t\t\t"level": 0, //floor level of the render, 0 means ground floor and all roofs are hidden, highest level is 3 which makes all roofs visible\n\t\t\t"pxpersquare": 64, //the level of detail for highest zoom level measured in pixels per map tile (1x1 meter). Subject to pxpersquare*64>tileimgsize, because it is currently not possible to render less than one image per mapchunk\n\t\t\t"dxdy": 0, //dxdy and dzdy to determine the view angle, 0,0 for straight down, something like 0.15,0.25 for birds eye\n\t\t\t"dzdy": 0\n\t\t},\n\t\t{\n\t\t\t"name": "map",\n\t\t\t"mode": "map", //old style 2d map render\n\t\t\t"format": "png",\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 64,\n\t\t\t"mapicons": true,\n\t\t\t"wallsonly": false //can be turned on to create a walls overlay layer to use on top of an existing 3d layer\n\t\t},\n\t\t{\n\t\t\t"name": "minimap",\n\t\t\t"mode": "minimap", //minimap style render, similar to 3d but uses different shaders and emulates several rs bugs.\n\t\t\t"format": "webp",\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 64,\n\t\t\t"hidelocs": false, //can be turned on to emulate partially loaded minimap\n\t\t\t"mipmode": "avg", //results in every pixel of a mip image being exactly the mean of 4 zoomed pixels without any other filtering steps, required for minimap localization\n\t\t\t"dxdy": 0,\n\t\t\t"dzdy": 0\n\t\t},\n\t\t{\n\t\t\t"name": "collision",\n\t\t\t"mode": "collision", //pathing/line of sight as overlay image layer to use on "map" or "3d"\n\t\t\t"format": "png",\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 64\n\t\t},\n\t\t{\n\t\t\t"name": "height",\n\t\t\t"mode": "height", //binary file per chunk containing 16bit height data and 16 bits of collision data in base3 per tile\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 1, //unused but required\n\t\t\t"usegzip": true //gzips the resulting file, need some server config to serve the compressed file\n\t\t},\n\t\t{\n\t\t\t"name": "locs",\n\t\t\t"mode": "locs", //json file with locs per chunk\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 1, //unused but required\n\t\t\t"usegzip": false\n\t\t},\n\t\t{\n\t\t\t"name": "maplabels",\n\t\t\t"mode": "maplabels", //json file per chunk containing maplabel images and uses\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 1,\n\t\t\t"usegzip": false\n\t\t},\n\t\t{\n\t\t\t"name": "rendermeta",\n\t\t\t"mode": "rendermeta", //advanced - json file containing metadata about the chunk render, used to dedupe historic renders\n\t\t\t"level": 0,\n\t\t\t"pxpersquare": 1\n\t\t},\n\t\t{\n\t\t\t"name": "interactions",\n\t\t\t"mode": "interactions",\n\t\t\t"pxpersquare": 64, //same arguments as mode="3d"\n\t\t\t"dxdy": 0.15,\n\t\t\t"dzdy": 0.25,\n\t\t\t"format": "webp",\n\t\t\t"level": 0,\n\t\t\t"usegzip": true\n\t\t}\n\t],\n\t//used to determine lowest scaling mip level, should generally always be 100,200 which ensures the lowest mip level contains the entire rs world in one image\n\t"mapsizex": 100,\n\t"mapsizez": 200\n}'
;var NC=n(8287).Buffer;async function DC(e,t,n,r=10){let i=await n.getCacheIndex(xg.index);for(let[o,l]of Object.entries(HE)){if("running"!=e.state)break;let c=o;if("bin"==c)continue;let u=l({});try{await u.prepareDump(t,n)}catch(t){
e.log(`failed to prepare extraction for ${c}, ${t}`);continue}if(void 0===u.major)continue;if(!i[u.major]){e.log(`skipped ${c} because major ${u.major} is missing from the cache`);continue}let h=await n.getCacheIndex(u.major),d=0,p=0
;e:for(let i=h.length-1;i>=0;i--){let o=h[i];if("running"!=e.state)break;if(p>=20){e.log(`stopped mode ${c} after ${p} errors.`);break}if(o&&("number"!=typeof u.minor||u.minor==o.minor)){try{var a=await n.getFileArchive(o)}catch(t){
e.log(`failed to load ${o.major}.${o.minor}`),p++;continue}for(let{buffer:i,fileid:l}of a){let a=u.fileToLogical(n,o.major,o.minor,l),h=`${c}_${a.join(".")}.${u.ext}`;try{var s=await u.read(i,a,n)
;if("string"!=typeof s&&!NC.isBuffer(s))throw new Error("decoder didn't return a valid file");t.writeFile(h,s)}catch(t){e.log(`failed to decode ${h}`),p++;continue e}if(d++>=r)break e}}}}}function LC(e,t){const n=[]
;for(const r of e)if("longOption"===r.type&&t.longNames.includes(r.key))n.push(r);else if("shortOptions"===r.type&&t.shortNames.length)for(const e of r.options)t.shortNames.includes(e.key)&&n.push(e);return n}var OC=n(5248),PC=n.n(OC);function FC(e){
return{_tag:"ok",value:e}}function UC(e){return{_tag:"error",error:e}}function BC(e){return"error"===e._tag}async function zC(e){try{return FC(await e)}catch(e){return UC(e)}}const GC={async from(e){const t=parseFloat(e)
;if(Number.isNaN(t))throw new Error("Not a number");return t},displayName:"number",description:"a number"},VC={from:async e=>e,description:"a string",displayName:"str"},HC={from:async e=>e,description:"a boolean",displayName:"true/false",
defaultValue:()=>!1};var jC=n(5606);function WC(e){return function(e){var t;return{description:null!==(t=e.description)&&void 0!==t?t:e.type.description,helpTopics(){var t,n,r,i,a;const s=null!==(t=e.type.displayName)&&void 0!==t?t:"value"
;let o=`--${e.long}`;e.short&&(o+=`, -${e.short}`),o+=` <${s}>`;const l=[];if(e.env){const t=void 0===jC.env[e.env]?"":`=${PC().italic(jC.env[e.env])}`;l.push(`env: ${e.env}${t}`)}const c=null!==(n=e.defaultValue)&&void 0!==n?n:e.type.defaultValue
;if(c)try{const t=c();(null!==(r=e.defaultValueIsSerializable)&&void 0!==r?r:e.type.defaultValueIsSerializable)?l.push("default: "+PC().italic(t)):l.push("optional")}catch(e){}return[{category:"options",usage:o,defaults:l,
description:null!==(a=null!==(i=e.description)&&void 0!==i?i:e.type.description)&&void 0!==a?a:"self explanatory"}]},register(t){t.forceOptionLongNames.add(e.long),e.short&&t.forceOptionShortNames.add(e.short)},async parse({nodes:t,visitedNodes:n}){
var r,i;const a=LC(t,{longNames:[e.long],shortNames:e.short?[e.short]:[]}).filter((e=>!n.has(e)));if(a.forEach((e=>n.add(e))),a.length>1)return UC({errors:[{message:"Too many times provided. Expected 1, got: "+a.length,nodes:a}]})
;const s=e.env?jC.env[e.env]:void 0,o=a[0];let l,c="";const u=null!==(r=e.defaultValue)&&void 0!==r?r:e.type.defaultValue;if(null==o?void 0:o.value)l=o.value.node.raw;else if(void 0!==s)l=s,c=`env[${PC().italic(e.env)}]: `;else{
if(o||"function"!=typeof u)return UC({errors:[{nodes:a,message:"No value provided for "+("shortOption"===(null==o?void 0:o.type)?`-${null==o?void 0:o.key}`:`--${null!==(i=null==o?void 0:o.key)&&void 0!==i?i:e.long}`)}]});try{return FC(u())}catch(t){
return UC({errors:[{nodes:[],message:`Default value not found for '--${e.long}': ${t.message}`}]})}}const h=await zC(e.type.from(l));return BC(h)?UC({errors:[{nodes:a,message:c+h.error.message}]}):FC(h.value)}}}({type:VC,...e})}class $C extends yv{
constructor(e,t=0){super(),this.files=new Map,this.cachedir=e,this.virtualMajor=t;let n=FA.readdirSync(e);this.index=n.map(((e,n)=>(this.files.set(n,e),{major:t,minor:n,crc:0,subindexcount:1,subindices:[0],subnames:null,version:0,size:0,name:null,
uncompressed_crc:0,uncompressed_size:0})))}getCacheMeta(){return{name:`files:${this.cachedir}`,descr:`Only index ${this.virtualMajor}, loaded from unpacked cache files in ${this.cachedir}.`,timestamp:new Date(0)}}getFile(e,t,n){
let r=this.files.get(t);if(!r)throw new Error(`virtual minor ${t} does not have a corresponding file`);return FA.promises.readFile(yy.join(this.cachedir,r))}async getFileArchive(e){let t=await this.getFile(e.major,e.minor,e.crc);return[{fileid:0,
offset:0,size:t.byteLength,buffer:t,namehash:null}]}async getCacheIndex(e){return this.index}}function qC(e){let[t,...n]=e.split(":"),r=n.join(":");return async e=>{switch(t){case"live":return new PA;case"auto":return GA(new sA(r),e);case"nxt":
case"cache":return new zA(r,e?.writable??!1);case"cache-write":return new zA(r,!0);case"openrs":case"openrs2":return Iy.fromId(+r);case"openrslast":case"openrs2last":let t=await Iy.getRecentCache(+(r??"0"))
;if(!t)throw new Error(`cache index ${r} not found`);return console.log(`opening openrs2:${t.id}`),new Iy(t);case"extracted":return new $C(r,0);case"global":let n=globalThis[r]
;if("function"!=typeof n)throw new Error("the 'global' cache source requires a callback function with name <arg> to be exposed on the global scope");return new xv(n,!1);default:throw new Error("unknown cache mode")}}}n(5606);const XC={
from:async e=>qC(e),defaultValue:()=>qC("cache"),description:"Where to get game files from, can be 'live', 'cache[:rscachedir]', openrs2[:ors2cacheid] or openrs2last[:skipcount]"},YC={from:async e=>om(e),
description:"A file range with possible multiple components. '10', '10-20', '10,12' or '5.10-5.20' etc"},KC={async from(e){let t=sm(e);if(!t)throw new Error("expected maprect format: x,y,xsize,zsize");return t},
description:"A square of map coordinates as 'x,y', 'x,y,size' or 'x,y,w,h'"};WC({long:"source",short:"o",type:XC});var JC={files:WC({long:"ids",short:"i",type:YC,defaultValue:()=>[{start:[0,0,0],end:[1/0,1/0,1/0]}]})};WC({long:"area",short:"a",
type:KC}),WC({long:"area",short:"a",defaultValue:()=>null,type:KC});var ZC=n(6231),QC=n.n(ZC);function eM(e,t,n){const r=QC()(e);if(t<r.length)return e;const i=Array(t-r.length+1).join(" ");return"end"===n?e+i:i+e}function tM(e){
return Object.entries(e)}function*nM(e){for(let t=0;t<e.length;t++)yield[t,e[t]]}var rM=n(5606);const iM={async from(e){if("true"===e)return!0;if("false"===e)return!1;throw new Error(`expected value to be either "true" or "false". got: "${e}"`)},
displayName:"true/false",defaultValue:()=>!1};function aM(e){return function(e){var t;const n=function(e,t){const{defaultValue:n,from:r,...i}=e,a="function"==typeof(s=t)?{}:s;var s;const o="function"==typeof(l=t)?l:l.from;var l;return{...i,...a,
async from(t){const n=await e.from(t);return await o(n)}}}(iM,e.type);return{description:null!==(t=e.description)&&void 0!==t?t:e.type.description,helpTopics(){var t,n,r,i;let a=`--${e.long}`;e.short&&(a+=`, -${e.short}`);const s=[];if(e.env){
const t=void 0===rM.env[e.env]?"":`=${PC().italic(rM.env[e.env])}`;s.push(`env: ${e.env}${t}`)}try{
const r=null!==(t=e.defaultValue)&&void 0!==t?t:e.type.defaultValue,i=null!==(n=e.defaultValueIsSerializable)&&void 0!==n?n:e.type.defaultValueIsSerializable;if(r&&i){const e=r();s.push("default: "+PC().italic(e))}}catch(e){}return[{category:"flags",
usage:a,defaults:s,description:null!==(i=null!==(r=e.description)&&void 0!==r?r:e.type.description)&&void 0!==i?i:"self explanatory"}]},register(t){t.forceFlagLongNames.add(e.long),e.short&&t.forceFlagShortNames.add(e.short)},
async parse({nodes:t,visitedNodes:r}){var i,a;const s=LC(t,{longNames:[e.long],shortNames:e.short?[e.short]:[]}).filter((e=>!r.has(e)));if(s.forEach((e=>r.add(e))),s.length>1)return UC({errors:[{nodes:s,message:"Expected 1 occurence, got "+s.length}]
});const o=e.env?rM.env[e.env]:void 0;let l,c="";if(0===s.length&&void 0!==o)l=o,c=`env[${PC().italic(e.env)}]: `;else if(0===s.length&&"function"==typeof e.type.defaultValue)try{return FC(e.type.defaultValue())}catch(t){return UC({errors:[{
message:`Default value not found for '--${e.long}': ${t.message}`,nodes:[]}]})}else{if(1!==s.length)return UC({errors:[{nodes:[],message:`No value provided for --${e.long}`}]})
;l=null!==(a=null===(i=s[0].value)||void 0===i?void 0:i.node.raw)&&void 0!==a?a:"true"}const u=await zC(n.from(l));return BC(u)?UC({errors:[{nodes:s,message:c+u.error.message}]}):u}}}({type:HC,...e})}var sM=n(5606);class oM{constructor(e){
this.config=e}run(){this.output()(this.config.message),sM.exit(this.config.exitCode)}dryRun(){const{into:e,message:t,exitCode:n}=this.config;return`${t}\n\n${PC().dim(`process exited with status ${n} (${e})`)}`}output(){
return"stderr"===this.config.into?console.error:console.log}}const lM=aM({long:"help",short:"h",type:HC,description:"show help"}),cM=aM({long:"version",short:"v",type:HC,description:"print the version"});function uM(e,t,n){if(!BC(n)){
if("help"===n.value){const n=t.printHelp(e);throw new oM({exitCode:1,message:n,into:"stdout"})}if("version"===n.value){const e=t.version||"0.0.0";throw new oM({exitCode:0,message:e,into:"stdout"})}}}function hM(e){return{register(t){lM.register(t),
e&&cM.register(t)},helpTopics(){const t=lM.helpTopics();return e&&t.push(...cM.helpTopics()),t},async parse(t){const n=await lM.parse(t),r=e?await cM.parse(t):void 0;return BC(n)||r&&BC(r)?UC({
errors:[...BC(n)?n.error.errors:[],...r&&BC(r)?r.error.errors:[]]}):n.value?FC("help"):(null==r?void 0:r.value)?FC("version"):UC({errors:[{nodes:[],message:"Neither help nor version"}]})}}}function dM(e){const t=tM(e.args),n=hM(!!e.version);return{
name:e.name,aliases:e.aliases,handler:e.handler,description:e.description,version:e.version,helpTopics:()=>function(e,t){const n=[];for(const r of e)n.push(...t(r));return n}(Object.values(e.args).concat([n]),(e=>{var t,n
;return null!==(n=null===(t=e.helpTopics)||void 0===t?void 0:t.call(e))&&void 0!==n?n:[]})),printHelp(t){var n,r;const i=[];let a=null!==(r=null===(n=t.hotPath)||void 0===n?void 0:n.join(" "))&&void 0!==r?r:"";a||(a=e.name),a=PC().bold(a),
e.version&&(a+=" "+PC().dim(e.version)),i.push(a),e.description&&i.push(PC().dim("> ")+e.description);const s=function(e){var t;const n={};for(const r of e){const e=r.category;n[e]=null!==(t=n[e])&&void 0!==t?t:[],n[e].push(r)}return n
}(this.helpTopics());for(const[e,t]of tM(s)){i.push(""),i.push(e.toUpperCase()+":");const n=t.reduce(((e,t)=>Math.max(e,t.usage.length)),0);for(const e of t){let t="";t+="  "+eM(e.usage,n,"end"),t+=" - ",t+=e.description
;for(const n of e.defaults)t+=PC().dim(` [${n}]`);i.push(t)}}return i.join("\n")},register(e){var n;for(const[,r]of t)null===(n=r.register)||void 0===n||n.call(r,e)},async parse(n){var r
;0===(null===(r=n.hotPath)||void 0===r?void 0:r.length)&&n.hotPath.push(e.name);const i={},a=[];for(const[e,r]of t){const t=await r.parse(n);BC(t)?a.push(...t.error.errors):i[e]=t.value}const s=[]
;for(const e of n.nodes)if(!n.visitedNodes.has(e)&&"forcePositional"!==e.type)if("shortOptions"===e.type)for(const t of e.options)n.visitedNodes.has(t)||s.push(t);else s.push(e);return s.length>0&&a.push({message:"Unknown arguments",nodes:s}),
a.length>0?UC({errors:a,partialValue:i}):FC(i)},async run(e){const t=await this.parse(e);return uM(e,this,await n.parse(e)),BC(t)?UC(t.error):FC(await this.handler(t.value))}}}var pM=n(1492),fM=n.n(pM);async function mM(e,t,n){
let r=await n.getCacheIndex(xg.index),i=[];for(let e of r){if(!e)continue
;let t=await n.getCacheIndex(e.minor),r=t.reduce(((e,t)=>e+1),0),a=t.reduce(((e,t)=>e+t.subindexcount),0),s=t.reduce(((e,t)=>Math.max(e,t.subindexcount)),0),o=t.reduce(((e,t)=>Math.min(e,t.subindexcount)),1/0),l=0
;for(let e of t)e&&e.size&&(l+=e.size);let c=t[t.length-1]?.minor??-1,u=c+1-r,h=+(a/r).toFixed(2),d=Math.round(l/r),p=Math.round(l/a),f=Math.round(l/1e3)/1e3,m=Object.entries(xg).find((([t,n])=>n==e.minor))?.[0]??"unknown";i.push({major:e.minor,
name:m,minorcount:r,subfilecount:a,highestindex:c,missingminors:u,avgsubfiles:h,maxsubfiles:s,minsubfiles:o,totalsizemb:f,avgsize:d,avgsubsize:p})}let a=[],s=await n.getCacheIndex(xg.config);for(let e in s){let t=s[e];a.push({minor:t.minor,
subindices:t.subindexcount,minindex:Math.min(...t.subindices),maxindex:Math.max(...t.subindices),missingindices:t.subindices[t.subindices.length-1]+1-t.subindexcount})}t.writeFile("indexoverview.json",Sv()({majors:i,configs:a}))}
async function gM(e,t,n){let r=await n.getArchiveById(xg.quickchat,0),i=await n.getArchiveById(xg.quickchat,1),a=[];for(let e of r)a[e.fileid]=Qg.quickchatCategories.read(e.buffer,n);let s=[]
;for(let e of i)s[e.fileid]=Qg.quickchatLines.read(e.buffer,n);let o={},l=new Map,c=(e,t)=>{if(l.has(e))return;l.set(e,!0);let n=1,r=e=>0!=e?t+String.fromCharCode(e):t+(n+++"").slice(-1);for(let t of e.subcategories??[])c(a[t.id],r(t.hotkey))
;for(let t of e.lines??[]){let e=s[t.id];o[r(t.hotkey)]=e}};c(a[85],""),await t.writeFile("quickchat.json",Sv()(o))}async function _M(e,t,n){let r=await iy()(`https://secure.runescape.com/m=hiscore/ranking?category_type=${e}&table=${t}&page=${n+1}`)
;if(!r.ok)throw new Error(`getplayernames fetch failed ${r.status}, ${r.statusText}`);return[...(await r.text()).matchAll(/\/m=avatar-rs\/([\w+\-]{2,12})\/chat.png\b/g)].map((e=>Fv(e[1])))}async function vM(e){
let t=await iy()(`https://secure.runescape.com/m=avatar-rs/${encodeURIComponent(e)}/appearance.dat`);if(!t.ok){if(404==t.status)return null;throw new Error(`getplayeravatar fetch ${t.url} failed ${t.status}, ${t.statusText}`)}
return Pv(await t.text())}async function yM(e,t,n,r,i,a){let s=null;if(a){if(!n)throw new Error("need file source when extracting avatar data");let e=await Zw.create(n);s=await eS.create(e)}for await(let n of async function*(e,t){let n=0
;for(let r=Math.floor(e/25);n<t;r++){let e=await _M(0,0,r);for(let t of e){let e=await vM(t);e&&(n++,yield{name:Fv(t),buf:e})}}}(r,i)){if("running"!=e.state)break;if(a){let e=await jv(s.engine,n.buf,!1)
;await t.writeFile(`playerdata_${n.name}.json`,Sv()(e.info.avatar))}else t.writeFile(`playerdata_${n.name}.bin`,n.buf)}}async function bM(e,t,n,r){let i=await Cy();if(t){let e=new Date(""),n=new Date("");if(t.match(/^\d{4}$/))e=new Date(t),
n=new Date(+t+1+"");else if(t.match(/-/)){let r=t.split("-");e=new Date(r[0]),n=new Date(r[1])}isNaN(+n)&&(n=new Date("2100")),isNaN(+e)&&(e=new Date("1900")),i=i.filter((t=>t.timestamp&&new Date(t.timestamp)>=e&&new Date(t.timestamp)<=n))}if(n){
let e=i.findIndex((e=>e.id==+n));if(-1==e)throw new Error("cache id not found");let t=10,r=Math.min(e,t);i=i.slice(e-r,e+1+t)}let a=0;for(let s of i){let i=`id ${s.id.toString().padStart(4)}, build ${s.builds[0]?.major??"???"}`
;if(i+=` - ${(s.timestamp?new Date(s.timestamp).toDateString():"unknown date").padEnd(12)}`,n&&(i+=+n==s.id?" <--":"    "),r){if(a%10==0){let t="-".repeat(38);for(let e=0;e<60;e++)t+=`+-${` ${e} `.padStart(6,"-")}--`;e.log(t)}let n=new Iy(s);try{
let e=await n.getCacheIndex(xg.index);for(let r=0;r<e.length;r++){let a=e[r];if(a){let e=0;if(0!=a.crc&&0==a.subindexcount)try{e=(await n.getCacheIndex(a.minor)).reduce(((e,t)=>e+(t?1:0)),0)}catch(t){e=NaN}else e=a.subindexcount
;i+=` ${e.toString().padStart(9)}`}else i+=" ".repeat(10)}}catch(e){i+=`  Error ${e}`}finally{n.close()}}e.log(i),a++}}async function xM(e,t,n){let r=[],i=await n.getCacheIndex(xg.items);for(let e of i){let t=await n.getFileArchive(e)
;for(let e of t){let t=Qg.item.read(e.buffer,n),i=t.extra?.find((e=>235==e.prop));i&&r.push(i.intvalue)}}let a=[];for(let e of r){let r=await n.getFileById(xg.enums,e),i=Qg.enums.read(r,n).intArrayValue2.values.map((e=>({x:e[1]>>14&16383,
z:16383&e[1],level:e[1]>>28&3})));t.writeFile(`${e}.json`,JSON.stringify(i,void 0,"\t")),a.push(i)}let s=[4,3,11,2,10,23,6,8,22,21,7,5,16,20,15,17,14,12,18,9,13,0,24,25,27,26,50],o=a.flatMap(((e,t)=>{let n=s[t];return e.map((e=>({...e,clueid:n})))}))
;await t.writeFile("allcoords.json",JSON.stringify(o,void 0,"\t")),e.log("done")}async function EM(e,t,n){let r=new Map,i=await n.getCacheIndex(xg.frames);for(let e of i){if(!e)continue;let t=(await n.getArchiveById(xg.frames,e.minor))[0];if(t){
let i=Qg.frames.read(t.buffer,n);r.set(e.minor,i.probably_framemap_id)}}e.log("completed frames");let a=new Map,s=await n.getCacheIndex(xg.skeletalAnims);for(let e of s){if(!e)continue
;let t=await n.getFileById(xg.skeletalAnims,e.minor),r=Qg.skeletalAnim.read(t,n);a.set(e.minor,r.framebase)}e.log("completed skeletals");let o=new Map,l=await n.getCacheIndex(xg.sequences);for(let e of l){if(!e)continue
;let t=await n.getArchiveById(e.major,e.minor);for(let i of t){let t=vv(e.major,e.minor,i.fileid),s=Qg.sequences.read(i.buffer,n),l=null;s.frames&&0!=s.frames.length&&(l=r.get(s.frames[0].frameidhi)),
null!=s.skeletal_animation&&(l=a.get(s.skeletal_animation)),null!=l&&lm(o,l,(()=>[])).push(t)}}e.log("completed sequences");let c=Object.fromEntries(o);t.writeFile("sequences.json",Sv()(c)),e.log("done")}async function wM(e,t,n){
let r=await Db(n),i=[],a=Ob(await Lb(n,7717)).map((e=>""+e[1])),s=Ob(await Lb(n,7718)).map((e=>""+e[1])),o=await Lb(n,7709),l=await Lb(n,7711),c=null,u={};for(let[e,t]of Ob(o)){let i={},a=Ub(l,e);a&&"null"!=a||(a=`default_${e}`),u[a]=i,1==e&&(c=i)
;let s=Ob(await Lb(n,t));for(let[e,t]of s){let a=await Pb(n,t);i[e]={x:Bb(r,a,3482),y:Bb(r,a,3483),xmode:Bb(r,a,3380),ymode:Bb(r,a,6832),width:Bb(r,a,3484),height:Bb(r,a,3485),prevtab:Bb(r,a,3486),nexttab:Bb(r,a,3487),visible:!!Bb(r,a,3488)}}}
let h=await Lb(n,7716),d={};for(let e of a){let t=c?.[e],a=Fb(h,+e);if(-1==a)continue;let s=await Pb(n,a),o=Bb(r,s,3494),l=-1!=o?await Pb(n,o):null,u=Bb(r,s,3527),p=Bb(r,s,3495);i.push(p),d[e]={id:e,defaultwidth:t?.width??0,
defaultheight:t?.height??0,minimumwidth:l?Bb(r,l,3541):t?.width??0,minimumheight:l?Bb(r,l,3542):t?.height??0,fixedwidth:!(2&u),fixedheight:!(1&u),iconid:p,parentcomp:Bb(r,s,3503),ignorecollision:!!Bb(r,s,3529),style:Bb(r,s,3518),name:zb(r,s,3493)}}
let p={panelids:a,panelcollisionorder:s,defaultlayouts:u,rootdefault:Object.entries(u).find((e=>e[1]==c))[0],panelmeta:d};await t.writeFile("interfaces.json",JSON.stringify(p)),e.log("completed json"),await t.mkDir("imgs");for(let e of i){
if(-1==(0|e))continue;let r=K_(J_(await n.getFileById(xg.sprites,e))[0]),i=await Cm(r,"png",1);await t.writeFile(`imgs/${e}.png`,i)}}var SM,TM=n(6840),AM=n.n(TM);async function CM(e,t,n,r){let i=await MM.fromSource(n);globalThis.cs2mod=i
;let a=await i.run(r);t.writeFile("module.ts",a)}!function(e){var t=new Map,n=new Map,r=new Map;e.struct_getparam=function(e,r){let i=t.get(r);if(!i)throw new Error(`unknown param id ${r}`);let a=n.get(e);return a?.get(r)??i.defaultValue},
e.enum_getvalue=function(e,t,n,i){let a=r.get(n);if(!a)throw new Error(`unknown enum id ${n}`);let s=a.from.indexOf(i);return-1==s?a.defaultTo:a.to[s]},e.ENUM_GETOUTPUTCOUNT=function(e){let t=r.get(e);if(!t)throw new Error(`unknown enum id ${e}`)
;return t.from.length}}(SM||(SM={}));class MM{constructor(e){this.scripts=new Map,this.enums=new Map,this.params=new Map,this.structs=new Map,this.mockscripts=new Set,this.entrypoints=[],this.source=e.source,this.deob=e}static async fromSource(e){
let t=await rE(e);return new MM(t)}async run(e){this.entrypoints=e;let t=e.slice();for(;0!=t.length;){let e=t.pop(),n=await this.addscript(e);this.scripts.size%100==0&&console.log(`script count: ${this.scripts.size}, queue: ${t.length}`),
n&&t.push(...[...n.scripts].filter((e=>!this.scripts.has(e))))}let n="";return n+=nE(this.deob),n+=this.writeVars(),n+=await this.writeStructsParamsEnums(),n+=SM.enum_getvalue+"\n",n+=SM.struct_getparam+"\n",n+=SM.ENUM_GETOUTPUTCOUNT+"\n",
n+=this.writeScripts(),n}async addscript(e){if(this.scripts.has(e))return null;if(this.mockscripts.has(e))return null
;let t=await this.source.getFileById(xg.clientscript,e),n=Qg.clientscript.read(t,this.source),{rootfunc:r,sections:i,typectx:a}=Px(this.deob,n,e),s={func:r,ctx:a,sections:i,enums:new Set,params:new Set,structs:new Set,scripts:new Set,vars:new Set,
varbits:new Set};return function(e,t){let n=new gb,r=!1,i=new Mx(t.func);for(let e=i.goToStart();e;e=i.next()){if(fx(e,Dy.enum_getvalue)){let e=n?.values.at(-2);"number"==typeof e&&t.enums.add(e)}if(fx(e,Dy.struct_getparam)){
let e=n?.values.at(-1),r=n?.values.at(-2);"number"==typeof e&&t.params.add(e),"number"==typeof r&&t.structs.add(r)}if(fx(e,Dy.enum_getreverseindex)){let e=n?.values.at(-3);"number"==typeof e&&t.enums.add(e)}fx(e,Dy.gosub)&&t.scripts.add(e.op.imm),
(fx(e,Dy.popvarbit)||fx(e,Dy.pushvarbit))&&t.varbits.add(e.op.imm),(fx(e,Dy.popvar)||fx(e,Dy.pushvar))&&t.vars.add(e.op.imm),e instanceof Ax&&e.children[0];let i=e.knownStackDiff;e instanceof Cx&&(i??(i=e.opinfo.stackinfo),r||(r=e.unknownstack)),
n&&(null!=e.knownStackDiff?.constout?n.pushOne(e.knownStackDiff.constout):i?.initializedthrough?n.applyInOut(i):n=null)}}(0,s),this.scripts.set(e,s),s}writeScripts(){let e=""
;for(let t of[...this.mockscripts])e+=`var script${t} = function(...args[]){};\n`;e+="\n";let t=[...this.scripts].sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));for(let n of t)e+=new Ux(this.deob,n.ctx).getCode(n.func)+"\n\n";return e}
async writeStructsParamsEnums(){let e="",t=new Set,n=new Set,r=new Set;for(let e of this.scripts.values())e.structs.forEach((e=>t.add(e))),e.params.forEach((e=>n.add(e))),e.enums.forEach((e=>r.add(e)))
;e+="type Param = { defaultValue: number | string | bigint };\n",e+="type Struct = Map<number, string | number | bigint>;\n",e+="type Enum = { defaultFrom: number, defaultTo: string | number, from: number[] | string[], to: number[] | string[] };\n",
e+="\n",e+="var paramtable = new Map<number, Param>();\n";for(let t of n){let n=this.deob.parammeta.get(t);e+=`paramtable.set(${t},${JSON.stringify({defaultValue:n?.type?.defaultint??n?.type?.defaultstring})});\n`}e+="\n",
e+="var structatble = new Map<number, Struct>();\n";for(let n of t){let t=await Pb(this.source,n);e+=`structtable.set(${n}, new Map([\n`
;for(let n of t.extra??[])e+=`\t[${n.prop}, ${n.intvalue??`"${(n.stringvalue??"").replace(/\\/g,"\\\\").replace(/"/,'\\"')}"`}],\n`;e+="]))\n"}e+="\n",e+="var enumtable = new Map<number, Enum>();\n";for(let t of r){
let n=await Lb(this.source,t),r=n.intArrayValue1??n.intArrayValue2?.values,i=n.stringArrayValue1??n.stringArrayValue2?.values,a=r??i,s=a?.map((e=>e[0]))??[],o=a?.map((e=>e[1]))??[],l=-1,c=i?"":-1;e+=`enumtable.set(${t}, ${JSON.stringify({
defaultFrom:l,defaultTo:c,from:s,to:o})})\n`}return e+="\n",e}writeVars(){let e="",t=new Set,n=new Set;for(let e of this.scripts.values())e.vars.forEach((e=>t.add(e))),e.varbits.forEach((e=>n.add(e)));for(let n of[...t].sort(((e,t)=>e-t))){
let t=this.deob.getClientVarMeta(n);e+="var "+(t?`var${t.name}_${t.varid}`:`varunk_${n}`),e+=`: ${t?Xy(t.fulltype):"any"}`,e+="\n"}e+="\n";for(let t of[...n].sort(((e,t)=>e-t))){let n=t>>8,r=255&t,i=this.deob.varbitmeta.get(n),a="",s="unknown"
;if("number"!=typeof i?.varid)a=`varbitunk_${t}`;else{let e=this.deob.varmeta.get(i.varid>>16);a=`varbit${e?.name??"unk"}_${n}${0==r?"":`[${r}]`}`,s=""+(i.bits[1]-i.bits[0]+1)}e+=`var ${a}`,e+=": int",e+=`; //${s}\n`}return e+="\n",e}}
function IM(e,t){return{from:async e=>new sA(e),defaultValue:()=>e.getFs(t),description:`Where to save files (${t})`}}function RM(e){const t={source:WC({long:"source",short:"o",type:XC,
defaultValue:e.getDefaultCache?()=>async()=>e.getDefaultCache():void 0})};function n(t){return{save:WC({long:"save",short:"s",type:IM(e,t)})}}const r=dM({name:"testdecode",args:{...t,...JC,...n("save"),mode:WC({long:"mode",short:"m",
description:`A json decode mode ${Object.keys(OE).join(", ")}`})},handler:async t=>{let n=t.save,r=await n.readDir(".");if(r.find((e=>!e.name.match(/^(err|pass|fail)-/))))throw new Error("file not starting with 'err' in error dir")
;await Promise.all(r.map((e=>n.unlink(e.name))));let i=e.getConsole(),a=await t.source(),s=OE[t.mode];if(!s)throw new Error(`mode ${t.mode} not found, possible modes: ${Object.keys(OE).join(", ")}`);await i.run(RT,n,a,s,t.files,{
skipMinorAfterError:!1,skipFilesizeAfterError:!1,memlimit:2e8,maxerrs:500,orderBySize:!1,outmode:"hextext",dumpall:!1})}}),i=dM({name:"download",args:{...t,...n("extract")},handler:async t=>{let n=e.getConsole()
;await n.run(xM,t.save,await t.source())}}),a=dM({name:"historicdecode",args:{...t,...n("cache-histerr"),skipcurrent:aM({long:"skipcurrent",short:"p",description:"skip current cache"}),before:WC({long:"before",short:"t",defaultValue:()=>""}),
maxchecks:WC({long:"maxchecks",short:"n",type:GC,defaultValue:()=>0})},async handler(t){let n=await t.source(),r=e.getConsole();await r.run(IT,t.save,n,t.before,t.maxchecks)}}),s=dM({name:"extract",args:{...t,...JC,...n("extract"),mode:WC({
long:"mode",short:"m",type:VC,defaultValue:()=>"bin",description:`A decode mode ${Object.keys(HE).join(", ")}`}),edit:aM({long:"edit",short:"e"}),skipread:aM({long:"noread",short:"n"}),fixhash:aM({long:"fixhash",short:"h"}),batched:aM({
long:"batched",short:"b"}),batchlimit:WC({long:"batchsize",type:GC,defaultValue:()=>-1}),keepbuffers:aM({long:"keepbuffers"}),cs2relativecomps:aM({long:"cs2relativecomps"}),cs2notypes:aM({long:"cs2notypes"}),cs2intcasts:aM({long:"cs2intcasts"})},
async handler(t){let n=e.getConsole(),r=await t.source({writable:t.edit}),i={};t.keepbuffers&&(i.keepbuffers="true"),t.cs2relativecomps&&(i.cs2relativecomps="true"),t.cs2notypes&&(i.cs2notypes="true"),t.cs2intcasts&&(i.cs2intcasts="true"),
await n.run(CC,t.save,r,t,i)}}),o=dM({name:"filehist",args:{...n("extract"),id:WC({long:"id",short:"i",type:VC}),mode:WC({long:"mode",short:"m",type:VC,defaultValue:()=>"bin",description:`A decode mode ${Object.keys(HE).join(", ")}`})},
async handler(t){let n=e.getConsole();if(!HE[t.mode])throw new Error("unkown mode");let r=t.id.split(".").map((e=>+e));if(0==r.length||r.some((e=>isNaN(e))))throw new Error("invalid id");await n.run(TC,t.save,t.mode,r,null,null)}}),l=dM({name:"edit",
args:{...t,save:WC({long:"load",short:"s",type:{from:async e=>new sA(e),defaultValue(){},description:"Where to load files from"}}),files:WC({long:"files",type:VC,defaultValue:()=>""})},async handler(t){let n=e.getConsole(),r=await t.source({
writable:!0}),i=await Promise.all(t.files.split(",").filter((e=>e)).flatMap((async e=>({name:e,file:await AM().readFile(e)}))));await n.run(MC,r,t.save,i)}}),c=dM({name:"run",args:{...t,...n("save")},handler:async t=>{
let n=await t.source(),r=e.getConsole();await r.run(mM,t.save,n)}}),u=dM({name:"run",args:{...JC,...n("out"),a:WC({long:"cache1",short:"a",type:XC}),b:WC({long:"cache2",short:"b",type:XC})},handler:async t=>{
let n=await t.a(),r=await t.b(),i=e.getConsole();await i.run(CT,t.save,n,r,t.files),n.close(),r.close()}}),h=dM({name:"run",args:{...t,...n("extract")},handler:async t=>{let n=e.getConsole(),r=await t.source();n.run(gM,t.save,r)}}),d=dM({name:"run",
args:{...t,...n("extract"),skip:WC({long:"skip",short:"i",type:GC,defaultValue:()=>0}),max:WC({long:"max",short:"m",type:GC,defaultValue:()=>500}),json:aM({long:"json",short:"j"})},handler:async t=>{let n=e.getConsole(),r=t.json?await t.source():null
;await n.run(yM,t.save,r,t.skip,t.max,t.json)}}),p=dM({name:"openrs2ids",args:{date:WC({long:"year",short:"d",defaultValue:()=>""}),near:WC({long:"near",short:"n",defaultValue:()=>""}),full:aM({long:"full",short:"f"})},async handler(t){
let n=e.getConsole();await n.run(bM,t.date,t.near,t.full)}}),f=dM({name:"sequencegroups",args:{...t,...n("extract")},async handler(t){let n=e.getConsole(),r=await t.source();await n.run(EM,t.save,r)}}),m=dM({name:"gameinterfaces",args:{...t,
...n("extract")},async handler(t){let n=e.getConsole(),r=await t.source();await n.run(wM,t.save,r)}}),g=dM({name:"clientscriptmodule",args:{...t,...n("module"),entry:(_={short:"i",long:"entry",type:(v=GC,{...v,
from:async e=>Promise.all(e.map((e=>v.from(e))))})},{helpTopics(){var e,t;const n=null!==(e=_.type.displayName)&&void 0!==e?e:"value";let r=`--${_.long} <${n}>`;return _.short&&(r+=`, -${_.short}=<${n}>`),[{category:"options",usage:r,defaults:[],
description:null!==(t=_.description)&&void 0!==t?t:"self explanatory"}]},register(e){e.forceOptionLongNames.add(_.long),_.short&&e.forceOptionShortNames.add(_.short)},async parse({nodes:e,visitedNodes:t}){var n;const r=LC(e,{longNames:[_.long],
shortNames:_.short?[_.short]:[]}).filter((e=>!t.has(e)));for(const e of r)t.add(e);const i=[],a=[],s=[];for(const e of r){const t=null===(n=e.value)||void 0===n?void 0:n.node.raw;void 0!==t?i.push(t):s.push(e)}if(s.length>0&&a.push({nodes:s,
message:"Expected to get a value, found a flag"}),a.length>0)return UC({errors:a});const o=await zC(_.type.from(i));return BC(o)?UC({errors:[{nodes:r,message:o.error.message}]}):o}})},async handler(t){let n=e.getConsole(),r=await t.source()
;await n.run(CM,t.save,r,t.entry)}});var _,v;let y=function(e){const t=hM(!!e.version),n={async from(t){const n=Object.entries(e.cmds).map((([e,t])=>{var n;return{cmdName:e,names:[e,...null!==(n=t.aliases)&&void 0!==n?n:[]]}
})),r=n.find((e=>e.names.includes(t)));if(r)return r.cmdName;let i="Not a valid subcommand name";const a=fM()(t,function(e){const t=[];for(const r of e)t.push(...(n=r,n.names));var n;return t}(n));if(a){const e=Array.isArray(a)?a[0]:a
;i+=`\nDid you mean ${PC().italic(e)}?`}throw new Error(i)}},r=function(e){return function(e){var t,n,r;const i=null!==(n=null!==(t=e.displayName)&&void 0!==t?t:e.type.displayName)&&void 0!==n?n:"arg";return{
description:null!==(r=e.description)&&void 0!==r?r:e.type.description,helpTopics(){var t,n;return[{category:"arguments",usage:`<${i}>`,description:null!==(n=null!==(t=e.description)&&void 0!==t?t:e.type.description)&&void 0!==n?n:"self explanatory",
defaults:[]}]},register(e){},async parse({nodes:t,visitedNodes:n}){const r=t.filter((e=>"positionalArgument"===e.type&&!n.has(e)))[0];if(!r)return UC({errors:[{nodes:[],message:`No value provided for ${i}`}]});n.add(r)
;const a=await zC(e.type.from(r.raw));return BC(a)?UC({errors:[{nodes:[r],message:a.error.message}]}):FC(a.value)}}}({type:VC,...e})}({displayName:"subcommand",description:"one of "+Object.keys(e.cmds).join(", "),type:n});return{version:e.version,
description:e.description,name:e.name,handler:t=>e.cmds[t.command].handler(t.args),register(n){for(const t of Object.values(e.cmds))t.register(n);t.register(n)},printHelp(t){var n,r,i,a
;const s=[],o=null!==(r=null===(n=t.hotPath)||void 0===n?void 0:n.join(" "))&&void 0!==r?r:"cli";s.push(PC().bold(o+PC().italic(" <subcommand>"))),e.description&&s.push(PC().dim("> ")+e.description),s.push(""),
s.push(`where ${PC().italic("<subcommand>")} can be one of:`),s.push("");for(const t of Object.keys(e.cmds)){const n=e.cmds[t];let r=null!==(i=n.description)&&void 0!==i?i:"";if(r=r&&" - "+r+" ",null===(a=n.aliases)||void 0===a?void 0:a.length){
const e=1===n.aliases.length?"alias":"aliases",t=n.aliases.join(", ");r+=PC().dim(`[${e}: ${t}]`)}const o=PC().dim("- ")+t+r;s.push(o.trim())}const l=PC().yellow(`${o} <subcommand> --help`);return s.push(""),
s.push(PC().dim(`For more help, try running \`${l}\``)),s.join("\n")},async parse(t){var n,i;0===(null===(n=t.hotPath)||void 0===n?void 0:n.length)&&t.hotPath.push(e.name);const a=await r.parse(t);if(BC(a))return UC({errors:a.error.errors,
partialValue:{}});null===(i=t.hotPath)||void 0===i||i.push(a.value);const s=e.cmds[a.value],o=await s.parse(t);return BC(o)?UC({errors:o.error.errors,partialValue:{command:a.value,args:o.error.partialValue}}):FC({args:o.value,command:a.value})},
async run(n){var i,a;0===(null===(i=n.hotPath)||void 0===i?void 0:i.length)&&n.hotPath.push(e.name);const s=await r.parse(n);if(BC(s))return uM(n,this,await t.parse(n)),UC({...s.error,partialValue:{}})
;null===(a=n.hotPath)||void 0===a||a.push(s.value);const o=e.cmds[s.value],l=await o.run(n);return"ok"===l._tag?FC({command:s.value,value:l.value}):UC({...l.error,partialValue:{command:s.value,value:l.error.partialValue}})}}}({name:"",cmds:{
extract:s,indexoverview:c,testdecode:r,diff:u,quickchat:h,scrapeavatars:d,edit:l,historicdecode:a,openrs2ids:p,filehist:o,cluecoords:i,sequencegroups:f,gameinterfaces:m,clientscriptmodule:g}});return{subcommands:y}}globalThis.IsolatedCS2Module=MM,
globalThis.analizeCallGraph=function(e){let t=new Map,n=e=>{for(;e;e=e.parent);return 0},r=(i,a)=>{let s=e.scripts.get(a);if(!s)return;let o=t.get(a),l=!1;if(o?n(o)>n(i)+1&&(o.parent?.children.delete(a),o.parent=i,l=!0):(o={id:a,parent:i,
children:new Set},i.children.add(a),t.set(a,o),l=!0),l)for(let e of s.scripts)r(o,e)},i={id:-1,parent:null,children:new Set};for(let t of e.entrypoints)r(i,t);let a="from,to\n";for(let[e,n]of t)for(let e of n.children)a+=`${n.id},${e}\n`;return a},
globalThis.alanyzeFull=function(e){let t="from,to\n";for(let[n,r]of e.scripts)for(let e of r.scripts)t+=`${n},${e}\n`;return t};var kM=n(7833);const NM=n.n(kM)()("cmd-ts:parser");function DM(e){var t
;let{getToken:n,delimiterToken:r,forceFlag:i,key:a,forceOption:s}=e;const o=!s.has(a)&&(i.has(a)||"char"!==(null===(t=e.peekToken())||void 0===t?void 0:t.type));if(!r||"="!==r.raw&&o)return;const l="="===r.raw?"=":" ",c=r.index;let u=n();if(!u)return
;let h="";const d=u.index;for(;u&&"argumentDivider"!==(null==u?void 0:u.type);)h+=u.raw,u=n();return{type:"optionValue",index:r.index,delimiter:{type:"delimiter",raw:l,index:c},node:{type:"value",raw:h,index:d},raw:`${l}${h}`}}function LM(e,t){
const n=[];let r;function i(){void 0===r&&(r=QC()(n.join(" ")).length)}if(0!==t.nodes.length)return e.forEach((e=>{if(t.nodes.includes(e))return i(),n.push(PC().red(e.raw));if("shortOptions"===e.type){let r=!1,a=""
;for(const n of e.options)t.nodes.includes(n)?(a+=PC().red(n.raw),r=!0):a+=PC().dim(n.raw);const s=r?PC().red("-"):PC().dim("-");return r&&i(),n.push(s+a)}return n.push(PC().dim(e.raw))})),{colorized:n.join(" "),errorIndex:null!=r?r:0}}
function OM(e,t,n){let r=[],i=[];for(const n of t){const t=LM(e,n);r.push({message:n.message,highlighted:t})}let a=1;const s=String(r.length).length;i.push(PC().red.bold("error: ")+"found "+PC().yellow(r.length)+" error"+(r.length>1?"s":"")),
i.push(""),r.filter((e=>e.highlighted)).forEach((e=>{if(!e.highlighted)throw new Error("WELP");const t="".padStart(e.highlighted.errorIndex);i.push(`  ${e.highlighted.colorized}`);for(const[n,r]of nM(e.message.split("\n"))){
const e=0===n?PC().bold("^"):" ",a=PC().red(`  ${t} ${e} ${r}`);i.push(a)}i.push(""),a++}));const o=r.filter((e=>!e.highlighted));a>1&&(1===o.length?i.push("Along the following error:"):o.length>1&&i.push("Along the following errors:")),
o.forEach((({message:e})=>{const t=PC().red.bold(`${eM(a.toString(),s,"start")}.`);i.push(`  ${t} ${PC().red(e)}`),a++}));const l=PC().yellow(n.join(" ")+" --help");return i.push(""),i.push(PC().red.bold("hint: ")+`for more information, try '${l}'`),
i.join("\n")}async function PM(e,t){const n=new Set,r=new Set,i=new Set,a=[],s={forceFlagShortNames:r,forceFlagLongNames:n,forceOptionShortNames:new Set,forceOptionLongNames:i};e.register(s);const o=function(e){let t=[],n=0;const r=e=>{t.push(e),
n+=e.raw.length};for(const[t,i]of nM(e)){const a=[...i];for(let e=0;e<a.length;e++)"-"===a[e]&&"-"===a[e+1]?(r({type:"longPrefix",raw:"--",index:n}),e++):"-"===a[e]?r({type:"shortPrefix",raw:"-",index:n}):r({type:"char",raw:a[e],index:n})
;t+1!==e.length&&r({type:"argumentDivider",raw:" ",index:n})}return t}(t),l=function(e,t){if(NM.enabled){const e={shortFlags:[...t.forceFlagShortNames],longFlags:[...t.forceFlagLongNames],shortOptions:[...t.forceOptionShortNames],
longOptions:[...t.forceOptionLongNames]};NM("Registered:",JSON.stringify(e))}const n=[];let r=0,i=!1;function a(){return e[r++]}function s(){return e[r]}for(;r<e.length;){const e=a();if(!e)break;if("argumentDivider"!==e.type)if(i){let t=e.raw,r=a()
;for(;r&&"argumentDivider"!==(null==r?void 0:r.type);)t+=r.raw,r=a();n.push({type:"positionalArgument",index:e.index,raw:t})}else if("char"!==e.type)if("longPrefix"!==e.type)if("shortPrefix"!==e.type)r++;else{let r=[],i=a()
;if("argumentDivider"===(null==i?void 0:i.type)||!i){n.push({type:"positionalArgument",index:e.index,raw:"-"});continue}for(;i&&"argumentDivider"!==(null==i?void 0:i.type)&&"="!==(null==i?void 0:i.raw);)r.push(i),i=a();const o=r.pop(),l=DM({
key:o.raw,delimiterToken:i,forceFlag:t.forceFlagShortNames,forceOption:t.forceOptionShortNames,getToken:a,peekToken:s}),c=[];for(const e of r)c.push({type:"shortOption",index:e.index,raw:e.raw,key:e.raw});let u=o.raw;l&&(u+=l.raw),c.push({
type:"shortOption",index:o.index,raw:u,value:l,key:o.raw});let h=`-${r.map((e=>e.raw)).join("")}${o.raw}`;l&&(h+=l.raw);const d={type:"shortOptions",index:e.index,raw:h,options:c};n.push(d)}else{let r=a()
;if("argumentDivider"===(null==r?void 0:r.type)){n.push({type:"forcePositional",index:e.index,raw:"--"}),i=!0;continue}let o="";for(;r&&"="!==(null==r?void 0:r.raw)&&"argumentDivider"!==(null==r?void 0:r.type);)o+=r.raw,r=a();const l=DM({key:o,
delimiterToken:r,forceFlag:t.forceFlagLongNames,getToken:a,peekToken:s,forceOption:t.forceOptionLongNames});let c=`--${o}`;l&&(c+=l.raw),n.push({type:"longOption",key:o,index:e.index,raw:c,value:l})}else{let t=e.raw,r=a()
;for(;r&&"argumentDivider"!==(null==r?void 0:r.type);)t+=r.raw,r=a();n.push({type:"positionalArgument",index:e.index,raw:t})}}if(NM.enabled){const e=n.map((e=>({[e.type]:e.raw})));NM("Parsed items:",JSON.stringify(e))}return n}(o,s);try{
const t=await e.run({nodes:l,visitedNodes:new Set,hotPath:a});if(BC(t))throw new oM({message:OM(l,t.error.errors,a),exitCode:1,into:"stderr"});return FC(t.value)}catch(e){if(e instanceof oM)return UC(e);throw e}}var FM=function(e,t,n,r){
var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};function UM(e){
let[t,n]=fT.useReducer(((e,t)=>(localStorage.rsmv_lastmode=t,{search:null,mode:t})),null,(()=>{let e=null;try{e=JSON.parse(localStorage.rsmv_lastsearch??"")}catch(e){}return{search:e,mode:localStorage.rsmv_lastmode}})),r=cI[t.mode]
;return fT.createElement(fT.Fragment,null,fT.createElement(jT,{value:t.mode,tabs:{item:"Item",npc:"Npc",object:"Loc",avatar:"Player",model:"Model",map:"Map",material:"Material",spotanim:"Spotanim",scenario:"Scenario",scripts:"Scripts"},onChange:n
}),r&&fT.createElement(r,{initialId:t.search,ctx:e.ctx.canRender()?e.ctx:null,partial:e.ctx}))}function BM(e){const t=e.action;let n=e.comp?.name??"??",r=fT.createElement("input",{type:"button",className:"sub-btn",value:"x",
onClick:()=>e.onChange(null)}),i=e=>({display:"grid",gridTemplateColumns:e<=0?"1fr min-content":`${e}fr repeat(${e},1fr) min-content`,alignItems:"baseline"}),a={minWidth:"0",overflow:"hidden",whiteSpace:"nowrap"};switch(t.type){case"anim":
return fT.createElement("div",{style:i(1)},fT.createElement("span",{style:a},e.action.type," ",n),fT.createElement(ZT,{type:"number",value:t.animid,onChange:n=>e.onChange({...t,animid:+n.currentTarget.value})}),r);case"animset":
return fT.createElement("div",{style:i(1)},fT.createElement("span",{style:a},e.action.type," ",n),fT.createElement("select",{value:t.animid,onChange:n=>e.onChange({...t,animid:+n.currentTarget.value})
},Object.entries(t.anims).map((([e,t])=>fT.createElement("option",{key:e,value:t},e)))),r);case"delay":return fT.createElement("div",{style:i(1)},fT.createElement("span",{style:a},e.action.type," (ms)"),fT.createElement(ZT,{type:"number",
value:t.duration,onChange:n=>e.onChange({...t,duration:+n.currentTarget.value})}),r);case"location":return fT.createElement(fT.Fragment,null,fT.createElement("div",{style:i(0)},fT.createElement("span",{style:a
},e.action.type," ",n),r),fT.createElement("div",{style:{...i(0),gridTemplateColumns:"1em 2fr repeat(2,minmax(0,1fr))"}},fT.createElement("span",{style:{gridColumn:"2"}},"Floor+offset"),fT.createElement(ZT,{type:"number",value:t.level,step:1,
onChange:n=>e.onChange({...t,level:+n.currentTarget.value})}),fT.createElement(ZT,{type:"number",value:t.dy,onChange:n=>e.onChange({...t,dy:+n.currentTarget.value})}),fT.createElement("span",{style:{gridColumn:"2"}
},"Position x,z"),fT.createElement(ZT,{type:"number",value:t.x,onChange:n=>e.onChange({...t,x:+n.currentTarget.value})}),fT.createElement(ZT,{type:"number",value:t.z,onChange:n=>e.onChange({...t,z:+n.currentTarget.value})}),fT.createElement("span",{
style:{gridColumn:"2"}},"Rotation"),fT.createElement(ZT,{type:"number",style:{gridColumn:"span 2"},value:t.rotation,onChange:n=>e.onChange({...t,rotation:+n.currentTarget.value})})));case"scale":return fT.createElement("div",{style:i(3)
},fT.createElement("span",{style:a},e.action.type," ",n),fT.createElement(ZT,{type:"number",value:t.scalex,onChange:n=>e.onChange({...t,scalex:+n.currentTarget.value})}),fT.createElement(ZT,{type:"number",value:t.scalez,onChange:n=>e.onChange({...t,
scalez:+n.currentTarget.value})}),fT.createElement(ZT,{type:"number",value:t.scaley,onChange:n=>e.onChange({...t,scaley:+n.currentTarget.value})}),r);case"visibility":return fT.createElement("div",{style:i(1)},fT.createElement("span",{style:a
},e.action.type," ",n),fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:t.visible,onChange:n=>e.onChange({...t,visible:n.currentTarget.checked})})),r)}}function zM(e){let[t,n]=fT.useState(0),r=(t,n)=>{
let r=e.cols.slice()??[];null==n?r.splice(t,1):r[t]=[r[t][0],n],e.onChange(r)};return e.showAdd||0!=e.cols.length?fT.createElement("div",{className:"mv-overridegroup"},fT.createElement("div",{style:{gridColumn:"1/-1",textAlign:"center"}
},"Color overrides"),e.cols.flatMap(((e,t)=>[fT.createElement("div",{key:`${t}a`},e[0]),fT.createElement(ZT,{key:`${t}b`,type:"color",value:YM(e[1]),onChange:e=>r(t,KM(e.currentTarget.value))}),fT.createElement("input",{key:`${t}c`,type:"button",
className:"sub-btn",value:"x",onClick:e=>r(t,null)})])),fT.createElement("input",{type:"number",value:t,onChange:e=>n(+e.currentTarget.value)}),fT.createElement("input",{type:"button",value:"add color",className:"sub-btn",
onClick:n=>e.onChange(e.cols.concat([[t,0]]))})):null}function GM(e){let[t,n]=fT.useState(0),r=(t,n)=>{let r=e.mats.slice()??[];null==n?r.splice(t,1):r[t]=[r[t][0],n],e.onChange(r)};return e.showAdd||0!=e.mats.length?fT.createElement("div",{
className:"mv-overridegroup"},fT.createElement("div",{style:{gridColumn:"1/-1",textAlign:"center"}},"Material overrides"),e.mats.flatMap(((e,t)=>[fT.createElement("div",{key:`${t}a`},e[0]),fT.createElement(ZT,{key:`${t}b`,type:"number",value:e[1],
onChange:e=>r(t,+e.currentTarget.value)}),fT.createElement("input",{key:`${t}c`,type:"button",className:"sub-btn",value:"x",onClick:e=>r(t,null)})])),fT.createElement("input",{type:"number",value:t,onChange:e=>n(+e.currentTarget.value)
}),fT.createElement("input",{type:"button",value:"add material",className:"sub-btn",onClick:n=>e.onChange(e.mats.concat([[t,0]]))})):null}function VM(e){
let[t,n]=fT.useState(!1),r=(e.comp.mods.replaceColors?.length??0)+(e.comp.mods.replaceMaterials?.length??0);return fT.createElement(fT.Fragment,null,fT.createElement("div",{style:{clear:"both",overflow:"hidden"}
},"modelid: ",e.comp.modelid,fT.createElement("input",{type:"button",className:"sub-btn",value:"x",onClick:t=>e.onChange(e.index,null),style:{float:"right"}}),fT.createElement("input",{type:"button",className:"sub-btn",
value:t?"collapse":`overrides (${r})`,onClick:e=>n(!t),style:{float:"right"}})),t&&fT.createElement("div",{className:"mv-overridegroup__border"},fT.createElement(zM,{cols:e.comp.mods.replaceColors??[],onChange:t=>{e.onChange(e.index,{...e.comp,mods:{
...e.comp.mods,replaceColors:t}})},showAdd:t}),fT.createElement(GM,{mats:e.comp.mods.replaceMaterials??[],onChange:t=>{e.onChange(e.index,{...e.comp,mods:{...e.comp.mods,replaceMaterials:t}})},showAdd:t})))}function HM(e){
let[t,n]=fT.useState(0),r=(t,n)=>{let r=e.comp.simpleModel.slice();n?r[t]=n:r.splice(t,1),e.onChange({...e.comp,modelkey:WM(r,e.comp.globalMods),simpleModel:r})}
;return fT.createElement(fT.Fragment,null,e.comp.simpleModel.map(((e,t)=>fT.createElement(VM,{index:t,key:t,comp:e,onChange:r}))),fT.createElement("div",{className:"mv-overridegroup"},fT.createElement("input",{type:"number",value:t,
onChange:e=>n(+e.currentTarget.value)}),fT.createElement("input",{type:"button",value:"add model",className:"sub-btn",onClick:()=>{let n=e.comp.simpleModel.concat({modelid:t,mods:{}});e.onChange({...e.comp,modelkey:WM(n,e.comp.globalMods),
simpleModel:n})}})),e.showOpts&&fT.createElement("div",{className:"mv-overridegroup__border"},fT.createElement(zM,{cols:e.comp.globalMods.replaceColors??[],onChange:t=>{let n={...e.comp.globalMods,replaceColors:t};e.onChange({...e.comp,
modelkey:WM(e.comp.simpleModel,n),globalMods:n})},showAdd:!0}),fT.createElement(GM,{mats:e.comp.globalMods.replaceMaterials??[],onChange:t=>{let n={...e.comp.globalMods,replaceMaterials:t};e.onChange({...e.comp,modelkey:WM(e.comp.simpleModel,n),
globalMods:n})},showAdd:!0})))}function jM(e){let[t,n]=fT.useState(!1);return fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr min-content min-content min-content",alignItems:"baseline"}},fT.createElement("div",{style:{
maxWidth:"100%",overflow:"hidden"}},e.comp.name),"custom"==e.comp.type&&fT.createElement("input",{type:"button",className:"sub-btn",value:t?"-":"+",onClick:e=>n(!t)}),"simple"==e.comp.type&&fT.createElement("input",{type:"button",className:"sub-btn",
value:"edit",onClick:()=>{"simple"==e.comp.type&&(e.onChange(function(e){let t={replaceColors:[],replaceMaterials:[],lodLevel:-1};if(0!=e.simpleModel.length){let n=e.simpleModel[0]
;for(let r of n.mods.replaceColors??[])e.simpleModel.every((e=>e.mods.replaceColors?.some((e=>e[0]==r[0]&&e[1]==r[1]))))&&t.replaceColors.push(r)
;for(let r of n.mods.replaceMaterials??[])e.simpleModel.every((e=>e.mods.replaceMaterials?.some((e=>e[0]==r[0]&&e[1]==r[1]))))&&t.replaceMaterials.push(r)}let n=e.simpleModel.map((e=>({...e,mods:{
replaceColors:e.mods.replaceColors?.filter((e=>!t.replaceColors.some((t=>t[0]==e[0]&&t[1]==e[1]))))??[],replaceMaterials:e.mods.replaceMaterials?.filter((e=>!t.replaceMaterials.some((t=>t[0]==e[0]&&t[1]==e[1]))))??[]}})));return{type:"custom",
modelkey:WM(n,t),name:e.name+"*",simpleModel:n,globalMods:t,basecomp:e.modelkey}}(e.comp)),n(!0))}}),"custom"==e.comp.type&&fT.createElement("input",{type:"button",className:"sub-btn",value:"revert",onClick:async()=>{
if("custom"!=e.comp.type||!e.ctx)return;let t=await $M(e.ctx.sceneCache,e.comp.basecomp);e.onChange({type:"simple",modelkey:e.comp.basecomp,name:e.comp.name.replace(/\*$/,""),simpleModel:t.models})}}),fT.createElement("input",{type:"button",
className:"sub-btn",value:"x",onClick:t=>e.onChange(null)}),"custom"==e.comp.type&&t&&fT.createElement("div",{style:{gridColumn:"1/-1"}},fT.createElement(HM,{comp:e.comp,onChange:e.onChange,showOpts:t})))}function WM(e,t){return JSON.stringify({
models:e,globalMods:t})}async function $M(e,t){let[n]=t.split(":",1),r=t.slice(n.length+1);if("model"==n)return ay(e,+r);if("item"==n)return uy(e,+r);if("npc"==n)return async function(e,t){return oy(e,{id:t,head:!1})}(e,+r)
;if("loc"==n)return cy(e,+r);if("spotanim"==n)return ly(e,+r);if("player"==n)return async function(e,t){let n="";if(t.length<=20){let e=qv(t),r=await iy()(e).then((e=>e.text()))
;if(-1!=r.indexOf("404 - Page not found"))throw new Error("player avatar not found");n=r}else n=t;return{...await jv(e.engine,Pv(n),!1),id:t,name:t}}(e,r);if("custom"==n)return i=r,fC(JSON.parse(i),xC),{id:i,info:null,models:[],anims:{},name:"custom"
};throw new Error("unknown modelinit type");var i}class qM extends fT.Component{constructor(e){super(e),this.models=new Map,this.idcounter=0,this.mapoffset=null,this.mapgrid=new zS([]),this.hadctx=!1,this.state={actions:[],components:{},
addModelType:"model",addActionType:"anim",addActionTarget:-1},this.loadFromJson(e.initialId,!0)}loadFromJson(e,t=!1){let n=function(e,t,n){try{if("string"!=typeof e)throw new Error("json string expected");let n=JSON.parse(e);return fC(n,t),n}catch{
return n()}}(e,EC,(()=>{if(!t)throw new Error("invalid state json");return{actions:[],components:{}}})),r=Object.keys(n.components);this.idcounter=0==r.length?0:Math.max.apply(null,r)+1,this.hadctx=!1,
t?Object.assign(this.state,n):this.setSceneState(n.components,n.actions)}componentWillUnmount(){for(let e of this.models.values())e.cleanup()}async addComp(e){if(this.props.ctx)if("map"==this.state.addModelType){let t=sm(e)
;if(!t)throw new Error("invalid map rect");let n=this.idcounter++;this.editComp(n,{type:"map",modelkey:`${this.state.addModelType}:${e}`,name:`map${e}`,mapRect:t})}else{
let t=await $M(this.props.ctx.sceneCache,`${this.state.addModelType}:${e}`),n=this.idcounter++;this.editComp(n,{type:"simple",modelkey:`${this.state.addModelType}:${e}`,name:`${this.state.addModelType}:${e}`,simpleModel:t.models}),
0!=Object.keys(t.anims).length&&this.editAction(this.state.actions.length,{type:"animset",target:n,animid:t.anims.default??Object.keys(t.anims)[0],anims:t.anims})}}addAction(){let e;switch(this.state.addActionType){case"anim":e={type:"anim",
target:this.state.addActionTarget,animid:0};break;case"delay":e={type:"delay",target:-1,duration:0};break;case"location":e={type:"location",target:this.state.addActionTarget,level:0,x:0,z:0,dy:0,rotation:0};break;case"visibility":e={
type:"visibility",target:this.state.addActionTarget,visible:!0};break;case"scale":e={type:"scale",target:this.state.addActionTarget,scalex:1,scaley:1,scalez:1};break;default:throw new Error("unknown action "+this.state.addActionType)}
this.editAction(this.state.actions.length,e)}getSceneJson(e=this.state){return JSON.stringify({components:e.components,actions:e.actions})}setSceneState(e,t){this.setState((n=>{let r={components:e??n.components,actions:t??n.actions}
;return localStorage.rsmv_lastsearch=JSON.stringify(this.getSceneJson(r)),r}))}ensureComp(e,t,n){let r;if(n){let e=this.models.get(n);t&&n.modelkey==t.modelkey?r=e:(this.models.delete(n),e?.cleanup())}if(t){if(!r){
if("simple"==t.type)r=new hy(e.sceneCache,t.simpleModel,t.name);else if("custom"==t.type){let n=t.simpleModel.map((e=>({...e,mods:{replaceColors:(e.mods.replaceColors??[]).concat(t.globalMods.replaceColors),
replaceMaterials:(e.mods.replaceMaterials??[]).concat(t.globalMods.replaceMaterials)}})));r=new hy(e.sceneCache,n,t.name)}else{if("map"!=t.type)throw new Error("invalid model init");r=new dy(e.sceneCache,t.mapRect,{collision:!1,invisibleLayers:!1,
map2d:!1,skybox:!0}),r.on("loaded",this.updateGrids),Object.values(this.state.components).some((e=>"map"==e.type))&&this.mapoffset||(this.mapoffset={x:(t.mapRect.x+t.mapRect.xsize/2)*xS,z:(t.mapRect.z+t.mapRect.zsize/2)*xS}),
r.chunks.forEach((e=>e.rootnode.position.set(-this.mapoffset.x*bS,0,-this.mapoffset.z*bS)))}r.addToScene(e.renderer)}this.models.set(t,r)}}editComp(e,t){if(!this.props.ctx)return;let n={...this.state.components},r=this.state.components[e]
;if(this.ensureComp(this.props.ctx,t,r),t?n[e]=t:(delete n[e],this.setSceneState(null,this.state.actions.filter((t=>t.target!=e)))),this.setSceneState(n,null),!n[this.state.addActionTarget]){let e=Object.keys(n);this.setState({
addActionTarget:0==e.length?0:+e[e.length-1]})}this.restartAnims()}editAction(e,t){let n=this.state.actions.slice();if("anim"==t?.type||"animset"==t?.type){let e=this.modelIdToModel(t.target);e instanceof hy&&e.loadAnimation(t.animid)}
t?n[e]=t:n.splice(e,1),this.setSceneState(null,n),this.restartAnims()}modelIdToModel(e){let t=this.state.components[e];return this.models.get(t)}updateGrids(){let e=[];for(let t of Object.values(this.state.components)){if("map"!=t.type)continue
;let n=this.models.get(t),r=[];if(n instanceof py)r.push(n);else{if(!(n instanceof dy))continue;r.push(...n.chunks)}for(let t of r)t.loaded&&e.push({src:t.loaded.grid,rect:{x:t.chunkx*xS,z:t.chunkz*xS,xsize:xS,zsize:xS}})}this.mapgrid=new zS(e),
this.restartAnims()}async restartAnims(){await cm(1);let e=0;for(let e of this.models.values())e.mixer.setTime(0);for(const t of this.state.actions)switch(t.type){case"animset":case"anim":{let e=this.modelIdToModel(t.target)
;e instanceof hy&&e.setAnimation(t.animid);break}case"location":{let e=this.modelIdToModel(t.target),n=GS(this.mapgrid,t.x+(this.mapoffset?.x??0),t.z+(this.mapoffset?.z??0),t.level);e?.rootnode.position.set(t.x*bS,n+t.dy*bS,t.z*bS),
e?.rootnode.rotation.set(0,(t.rotation??0)*Math.PI/4,0);break}case"scale":{let e=this.modelIdToModel(t.target);e?.rootnode.scale.set(t.scalex,t.scaley,t.scalez);break}case"delay":e+=t.duration,await cm(t.duration);break;case"visibility":{
let e=this.modelIdToModel(t.target);e&&(e.rootnode.visible=t.visible);break}}}advancedIdSelect(){this.props.ctx&&("npc"==this.state.addModelType?LT(this.props.ctx,"npcs",(e=>this.addComp(""+e)),[{path:["name"],search:""
}]):"item"==this.state.addModelType?LT(this.props.ctx,"items",(e=>this.addComp(""+e)),[{path:["name"],search:""}]):"loc"==this.state.addModelType&&LT(this.props.ctx,"objects",(e=>this.addComp(""+e)),[{path:["name"],search:""}]))}render(){
!this.hadctx&&this.props.ctx&&(this.hadctx=!0,Object.entries(this.state.components).forEach((([e,t])=>this.ensureComp(this.props.ctx,t,this.state.components[e]))),this.restartAnims())
;const e=0!=Object.keys(this.state.components).length,t="item"==this.state.addModelType||"loc"==this.state.addModelType||"npc"==this.state.addModelType;return fT.createElement(fT.Fragment,null,fT.createElement("div",{className:"mv-sidebar-scroll"
},fT.createElement("h2",null,"Models"),fT.createElement("div",null,fT.createElement(KT,{getText:this.getSceneJson}),fT.createElement(JT,{onPaste:e=>this.loadFromJson(e,!1)})),fT.createElement("div",{style:{display:"flex",flexDirection:"column"}
},fT.createElement("select",{value:this.state.addModelType,onChange:e=>this.setState({addModelType:e.currentTarget.value})},fT.createElement("option",{value:"model"},"model"),fT.createElement("option",{value:"npc"},"npc"),fT.createElement("option",{
value:"spotanim"},"spotanim"),fT.createElement("option",{value:"loc"},"location"),fT.createElement("option",{value:"player"},"player"),fT.createElement("option",{value:"item"},"item"),fT.createElement("option",{value:"map"
},"map")),fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"minmax(0,1fr) min-content"}},fT.createElement(XT,{onChange:this.addComp}),t&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Lookup",
onClick:this.advancedIdSelect}))),!e&&fT.createElement("p",null,"Select a model type and id to add to the scene."),e&&fT.createElement("br",null),e&&fT.createElement("div",{className:"mv-inset"
},Object.entries(this.state.components).map((([e,t])=>fT.createElement(jM,{key:e,ctx:this.props.ctx,comp:t,onChange:t=>this.editComp(+e,t)})))),fT.createElement("h2",null,"Action sequence"),fT.createElement("div",{style:{display:"grid",
gridTemplateColumns:"1fr 1fr min-content"}},fT.createElement("select",{value:this.state.addActionType,onChange:e=>this.setState({addActionType:e.currentTarget.value})},fT.createElement("option",{value:"location"
},"Location"),fT.createElement("option",{value:"scale"},"Scale"),fT.createElement("option",{value:"anim"},"Anim"),fT.createElement("option",{value:"delay"},"Delay"),fT.createElement("option",{value:"visibility"
},"Visibility")),fT.createElement("select",{disabled:"delay"==this.state.addActionType,value:"delay"==this.state.addActionType?-1:this.state.addActionTarget,onChange:e=>this.setState({addActionTarget:+e.currentTarget.value})
},Object.entries(this.state.components).map((([e,t])=>fT.createElement("option",{key:e,value:e},t.name))),"delay"==this.state.addActionType&&fT.createElement("option",{value:"-1"})),fT.createElement("input",{type:"button",className:"sub-btn",
value:"add",onClick:this.addAction})),fT.createElement("div",{onClick:this.restartAnims},"restart"),0!=this.state.actions.length&&fT.createElement("br",null),0!=this.state.actions.length&&fT.createElement("div",{className:"mv-inset"
},this.state.actions.map(((e,t)=>{let n=this.state.components[e.target];return fT.createElement(BM,{key:t,comp:n,action:e,onChange:e=>this.editAction(t,e)})})))))}}function XM({index:e,slot:t,cust:n,custChanged:r,equipChanged:i,ctx:a,female:s}){
let o=t=>{if(t){let i={color:null,flag2:null,material:null,model:null,...n};t(i),i.color||i.flag2||i.material||i.model?r(e,i):r(e,null)}else r(e,null)};return fT.createElement("div",null,t&&fT.createElement("div",{style:{display:"grid",
gridTemplateColumns:"auto repeat(10,min-content)"}},fT.createElement("span",null,t.name),!n?.color?.col2&&!n?.color?.col4&&0!=t.replaceColors.length&&fT.createElement("input",{type:"button",className:"sub-btn",value:"C",
title:"Recolor using predefined recolor slots",onClick:e=>o((e=>e.color={col4:null,col2:t.replaceColors.map((e=>e[1]))}))}),!n?.color?.col2&&!n?.color?.col4&&fT.createElement("input",{type:"button",className:"sub-btn",value:"C4",
title:"Force recolor 4 colors",onClick:e=>o((e=>e.color={col4:[[0,0],[0,0],[0,0],[0,0]],col2:null}))}),!n?.material&&0!=t.replaceMaterials.length&&fT.createElement("input",{type:"button",className:"sub-btn",value:"T",
title:"Replace material in predefined material slots",onClick:e=>o((e=>e.material={header:0,materials:t.replaceMaterials.map((e=>e[1]))}))}),!n?.model&&fT.createElement("input",{type:"button",className:"sub-btn",value:"M",title:"Replace models",
onClick:e=>o((e=>e.model=t.models.slice()))}),fT.createElement("input",{type:"button",className:"sub-btn",value:"x",onClick:t=>i(e,"none",0)})),!t&&fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"auto repeat(10,min-content)"}
},Uv[e],fT.createElement("input",{type:"button",className:"sub-btn",value:"Item",onClick:()=>{LT(a,"items",(t=>i(e,"item",t)),[{path:["equipSlotId"],search:e+""},{path:["name"],search:""}])}}),fT.createElement("input",{type:"button",
className:"sub-btn",value:"Kit",onClick:()=>{let t=(s?zv:Bv)[e]??-1;LT(a,"identitykit",(t=>i(e,"kit",t)),[{path:["bodypart"],search:t+""}])}})),t&&n?.color?.col2&&fT.createElement("div",{style:{display:"grid",
gridTemplateColumns:`repeat(${t.replaceColors.length},1fr) min-content`}},t.replaceColors.map(((e,t)=>fT.createElement(ZT,{key:t,type:"color",value:YM(n.color.col2[t]),onChange:e=>o((n=>n.color.col2[t]=KM(e.currentTarget.value)))
}))),fT.createElement("input",{type:"button",className:"sub-btn",value:"x",onClick:e=>o((e=>e.color=null))})),t&&n?.color?.col4&&fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,minmax(0,1fr)) min-content",
gridTemplateRows:"auto auto",gridAutoFlow:"column"}},n.color.col4.map((([e,t],n)=>fT.createElement(fT.Fragment,{key:n},fT.createElement(ZT,{type:"number",value:e,onChange:e=>o((t=>t.color.col4[n][0]=+e.currentTarget.value))}),fT.createElement(ZT,{
type:"color",value:YM(t),onChange:e=>o((t=>t.color.col4[n][1]=KM(e.currentTarget.value)))})))),fT.createElement("input",{type:"button",style:{gridRow:"1/span 2"},className:"sub-btn",value:"x",onClick:e=>o((e=>e.color=null))
})),t&&n?.material&&fT.createElement("div",{style:{display:"grid",gridTemplateColumns:`repeat(${t.replaceMaterials.length},1fr) min-content`}},t.replaceMaterials.map(((e,t)=>fT.createElement(ZT,{key:t,type:"number",value:n.material.materials[t],
onChange:e=>o((n=>n.material.materials[t]=+e.currentTarget.value))}))),fT.createElement("input",{type:"button",className:"sub-btn",value:"x",onClick:e=>o((e=>e.material=null))})),t&&n?.model&&fT.createElement("div",{style:{display:"grid",
gridTemplateColumns:`repeat(${t.models.length},1fr) min-content`}},t.models.map(((e,t)=>fT.createElement(ZT,{key:t,type:"number",value:e,onChange:e=>o((n=>n.model[t]=+e.currentTarget.value))}))),fT.createElement("input",{type:"button",
className:"sub-btn",value:"x",onClick:e=>o((e=>e.model=null))})))}function YM(e){let t=_m(bm(e));return`#${(t[0]<<16|t[1]<<8|t[2]).toString(16).padStart(6,"0")}`}function KM(e){let t=parseInt(e.replace(/^#/,""),16)
;return ym(...vm(t>>16&255,t>>8&255,255&t))}FM([Gm],qM.prototype,"addComp",null),FM([Gm],qM.prototype,"addAction",null),FM([Gm],qM.prototype,"getSceneJson",null),FM([Gm],qM.prototype,"updateGrids",null),FM([Gm],qM.prototype,"restartAnims",null),
FM([Gm],qM.prototype,"advancedIdSelect",null);const JM=[{w:0,h:0,mode:"standard",name:"View"},{w:1920,h:1080,mode:"standard",name:"1080p"},{w:2560,h:1440,mode:"standard",name:"1440p"},{w:3840,h:2160,mode:"standard",name:"4K"},{w:0,h:0,mode:"vr360",
name:"View"},{w:2048,h:1024,mode:"vr360",name:"2:1K"},{w:4096,h:2048,mode:"vr360",name:"4:2K"},{w:0,h:0,mode:"topdown",name:"View"},{w:512,h:512,mode:"topdown",name:""},{w:1024,h:1024,mode:"topdown",name:""},{w:2048,h:2048,mode:"topdown",name:""}]
;function ZM(e){let[t,n]=fT.useState("none"),[r,i]=fT.useState(null),[a,s]=fT.useState(JM.find((t=>t.mode==e.renderopts.camMode))??JM[0]),[o,l]=fT.useState(!0),c=async(t=o,r=a)=>{"vr360"==e.renderopts.camMode&&(t=!1)
;let c=await e.ctx.renderer.takeScenePicture(r.w||void 0,r.h||void 0),u=Am(c.data,c.width,c.height),h=document.createElement("canvas"),d=h.getContext("2d");if(t){let e=Fm(u);h.width=e.width,h.height=e.height,d.putImageData(u,-e.x,-e.y)
}else h.width=u.width,h.height=u.height,d.putImageData(u,0,0);n("img"),l(t),s(r),i({cnv:h,data:u})};return"img"==t&&"vr360"==e.renderopts.camMode&&o&&c(),fT.createElement("div",{className:"mv-inset"},fT.createElement(jT,{value:t,tabs:{gltf:"GLTF",
stl:"STL",img:"image"},onChange:e=>{n(e),"img"==e&&c(o)}}),"img"==t&&fT.createElement(fT.Fragment,null,fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr minmax(0,1fr)"}},"Export image size",fT.createElement("select",{
value:JM.indexOf(a),onChange:e=>c(void 0,JM[e.currentTarget.value])},JM.map(((t,n)=>t.mode==e.renderopts.camMode&&fT.createElement("option",{key:n,value:n
},t.name,0!=t.w?` ${t.w}x${t.h}`:""))))),"vr360"!=e.renderopts.camMode&&fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:o,onChange:e=>c(e.currentTarget.checked)
}),"Crop image"),"vr360"==e.renderopts.camMode&&fT.createElement("input",{type:"button",className:"sub-btn",onClick:()=>{const e=r.cnv;OT({title:"360 preview of render"},fT.createElement(fT.Fragment,null,fT.createElement(bA,{img:e})))},
value:"Preview 360"}),r&&fT.createElement(GT,{canvas:r.cnv}),fT.createElement("div",{style:{display:"grid",grid:"'a b' / 1fr 1fr"}},fT.createElement("input",{type:"button",className:"sub-btn",value:"Save",onClick:async()=>{if(!r)return
;let e=await new Promise((e=>r.cnv.toBlob(e)));e&&QA("runeapps_image_export.png",e)}}),fT.createElement("input",{type:"button",className:"sub-btn",value:"Clipboard",onClick:async()=>{navigator.clipboard.write([new ClipboardItem({
"image/png":await new Promise((e=>r.cnv.toBlob(e)))})])}
}))),"gltf"==t&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"GLTF is a lightweight 3d format designed for modern but simple model exports. Colors, textures and animations will be included, but advanced lighting effects are lost."),fT.createElement("input",{
style:{width:"100%"},type:"button",className:"sub-btn",value:"Save",onClick:async()=>{let t=await async function(e){let t=new jm,n=[],r=[],i=["RA_skinIndex_bone","RA_skinIndex_skin","RA_skinWeight_bone","RA_skinWeight_skin"];e.traverseVisible((e=>{
if(e.animations&&n.push(...e.animations.filter((e=>0!=e.duration))),e instanceof ja&&e.geometry instanceof Aa){let t=e.geometry.attributes,n=e.geometry.attributes.normal;if(n&&n.array instanceof Int8Array){
let i=new Dr,a=new ca(new Float32Array(3*n.count),3);for(let e=0;e<n.count;e++)i.fromBufferAttribute(n,e),i.normalize(),a.setXYZ(e,i.x,i.y,i.z);let s=t.normal;r.push((()=>t.normal=s)),e.geometry.attributes.normal=a}for(let e of i)if(t[e]){
let n=e,i=t[e];delete t[e],r.push((()=>t[n]=i))}}}));let a=await new Promise(((r,i)=>{t.parse(e,(e=>r(e)),i,{binary:!0,animations:n})}));return r.forEach((e=>e())),a}(e.ctx.renderer.getModelNode());QA("model.glb",new Blob([t]))}
})),"stl"==t&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"STL is used mostly for 3d printing, this file format only exports the shape of the model. Colors, textures animations will be lost."),fT.createElement("input",{style:{
width:"100%"},type:"button",className:"sub-btn",value:"Save",onClick:async()=>{let t=await function(e){let t=(new vg).parse(e,{binary:!0});return Promise.resolve(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e.ctx.renderer.getModelNode())
;QA("model.stl",new Blob([t]))}})),"none"==t&&fT.createElement("p",null,"Select an export type"))}function QM(e){const t=fT.useRef({options:{}}),n=fT.useRef({getSceneElements:()=>t.current})
;let[r,i]=fT.useState("true"==localStorage.rsmv_showsettings),[a,s]=fT.useState(!1),[o,l]=fT.useState(!0),[c,u]=fT.useState(!1),[h,d]=fT.useState("standard"),[p,f]=fT.useState("free");const m=e.ctx?.renderer;let g={hideFog:o,hideFloor:c,camMode:h,
camControls:p},_=t.current.options;t.current.options=g,JSON.stringify(_)!=JSON.stringify(g)&&m?.sceneElementsChanged(),fT.useEffect((()=>{if(m)return m.addSceneElement(n.current),()=>{m.removeSceneElement(n.current)}}),[m])
;const v=fT.useCallback((()=>{localStorage.rsmv_showsettings=""+!r,i(!r)}),[r]);return fT.createElement(fT.Fragment,null,fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},fT.createElement("input",{type:"button",
className:gT()("sub-btn",{active:a}),onClick:e=>s(!a),value:"Export"}),fT.createElement("input",{type:"button",className:gT()("sub-btn",{active:r}),onClick:v,value:"Settings"})),r&&fT.createElement("div",{className:"mv-inset",style:{display:"grid",
gridTemplateColumns:"1fr 1fr"}},fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:o,onChange:e=>l(e.currentTarget.checked)}),"Hide fog"),fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:c,
onChange:e=>u(e.currentTarget.checked)}),"Hide floor"),fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:"world"==p,onChange:e=>f(e.currentTarget.checked?"world":"free")
}),"Flat panning"),fT.createElement("label",null,fT.createElement("select",{value:h,onChange:e=>d(e.currentTarget.value)},fT.createElement("option",{value:"standard"},"Standard camera"),fT.createElement("option",{value:"topdown"
},"Orthogonal camera"),fT.createElement("option",{value:"vr360"},"360 Camera")))),a&&e.ctx.canRender()&&fT.createElement(ZM,{ctx:e.ctx,renderopts:g}))}function eI(e){let t=fT.useCallback((t=>{t&&Bm(t.getContext("2d"),e.img)}),[e.img])
;return fT.createElement("canvas",{ref:t,className:"mv-image-preview-canvas"})}function tI(e,t){let n=fT.useRef(null),[r,i]=fT.useState(null),[a,s]=fT.useState(null),[o,l]=fT.useState(null),c=fT.useCallback((async r=>{if(e){n.current=r;try{
let i=await t(e.sceneCache,r);n.current==r&&(localStorage.rsmv_lastsearch=JSON.stringify(r),s(i),l(r))}catch(e){n.current==r&&(localStorage.rsmv_lastsearch=JSON.stringify(r),s(null),l(r),console.error(e))}}}),[e]);return fT.useLayoutEffect((()=>{
if(a&&e){let t=new hy(e.sceneCache,a.models,a.name);return a.anims.default&&t.setAnimation(a.anims.default),t.addToScene(e.renderer),t.model.then((e=>{a&&n.current==a.id&&i(t)})),()=>{t.cleanup()}}}),[a,e]),[a,r,o,c]}async function nI(e,t){
let n=-1,r=[255,0,255],i=null,a={},s=[],o=async(t,n,r,i)=>{let s=await e.getTextureFile(t,r,i),o=await s.toWebgl();a[n]={texid:r,filesize:s.filesize,img0:o}},l=null,c=null;if("overlay"==t.mode)l=e.engine.mapOverlays[t.id],l.material&&(n=l.material),
l.color&&(r=l.color);else if("underlay"==t.mode)c=e.engine.mapUnderlays[t.id],c.material&&(n=c.material),c.color&&(r=c.color);else if("material"==t.mode)n=t.id;else{if("texture"!=t.mode)throw new Error("invalid materialish mode")
;await o("diffuse","original",t.id,!1),await o("diffuse","opaque",t.id,!0)}let u=Kw.materialCube,h={replaceMaterials:[[0,n]],replaceColors:[[ym(...vm(255,255,255)),ym(...vm(...r))]]},d=e.engine.getMaterialData(n)
;for(let e in d.textures)0!=d.textures[e]&&await o(e,e,d.textures[e],d.stripDiffuseAlpha&&"diffuse"==e);return i=d,s.push({modelid:u,mods:h}),{models:s,anims:{},info:{overlay:l,underlay:c,texs:a,obj:i},id:t,name:`${t.mode}:${t.id}`}}
function rI(e,t,n,r,i){e.fov=Math.atan(1/32)/(Math.PI/180)*2,e.aspect=t/n,e.updateProjectionMatrix()
;let a=(new Nr).setFromEuler(new yi(-i.rotx/2048*2*Math.PI,i.roty/2048*2*Math.PI,-i.rotz/2048*2*Math.PI,"ZYX")),s=new Dr(6,0,4*-i.zoom),o=(new Nr).setFromAxisAngle(new Dr(1,0,0),i.rotx/2048*2*Math.PI),l=(new Nr).setFromAxisAngle(new Dr(0,1,0),-i.roty/2048*2*Math.PI),c=(new Nr).setFromAxisAngle(new Dr(0,0,1),-i.rotz/2048*2*Math.PI)
;return s.applyQuaternion(o),s.add(new Dr(4*-i.translatex,4*i.translatey,4*-i.translatey)),s.applyQuaternion(l),s.applyQuaternion(c),s.y+=r,s.divideScalar(512),s.z=-s.z,e.position.copy(s),e.quaternion.copy(a),e.updateProjectionMatrix(),
e.updateMatrixWorld(!0),e}function iI({ctx:e,meta:t,centery:n}){
let[r,i]=fT.useState(t?.modelTranslate_0??0),[a,s]=fT.useState(t?.modelTranslate_1??0),[o,l]=fT.useState(t?.rotation_0??0),[c,u]=fT.useState(t?.rotation_1??0),[h,d]=fT.useState(t?.rotation_2??0),[p,f]=fT.useState(t?.model_zoom??2048),[m,g]=fT.useState(t),_={
rotx:o,roty:c,rotz:h,translatex:r,translatey:a,zoom:p},v=()=>{i(t?.modelTranslate_0??0),s(t?.modelTranslate_1??0),l(t?.rotation_0??0),u(t?.rotation_1??0),d(t?.rotation_2??0),f(t?.model_zoom??2048),g(t)};t!=m&&v()
;let y=rI(e.renderer.getItemCamera(),36,32,n,_);return fT.useEffect((()=>{let t={getSceneElements:()=>({options:{camMode:"item"}})};return e.renderer.addSceneElement(t),()=>e.renderer.removeSceneElement(t)}),[y]),e.renderer.forceFrame(),
fT.createElement(fT.Fragment,null,fT.createElement("input",{type:"button",className:"sub-btn",value:"reset",onClick:v}),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:o,
onChange:e=>l(+e.currentTarget.value),min:0,max:2048,step:1}),"Rotate x: ",o)),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:c,onChange:e=>u(+e.currentTarget.value),min:0,max:2048,step:1
}),"Rotate y: ",c)),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:h,onChange:e=>d(+e.currentTarget.value),min:0,max:2048,step:1
}),"Rotate z: ",h)),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:p,onChange:e=>f(+e.currentTarget.value),min:10,max:1e4,step:1
}),"Zoom: ",p)),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:r,onChange:e=>i(+e.currentTarget.value),min:-200,max:208,step:1
}),"Translate x: ",r)),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"range",value:a,onChange:e=>s(+e.currentTarget.value),min:-200,max:200,step:1}),"Translate y: ",a)))}class aI extends fT.Component{
constructor(e){super(e),this.selectCleanup=[],this.state={chunkgroups:[],center:{x:0,z:0},toggles:Object.create(null),selectionData:void 0,versions:[],extramodels:!1}}clear(){this.selectCleanup.forEach((e=>e())),
this.state.chunkgroups.forEach((e=>e.models.forEach((e=>e.cleanup())))),this.setState({chunkgroups:[],toggles:Object.create(null)})}viewmap(){OT({title:"Map view"},fT.createElement(sI,{
chunks:this.state.chunkgroups.map((e=>e.models.get(this.props.ctx.sceneCache))).filter((e=>e)),gridsize:512,mapscenes:!0}))}async diffCaches(e=3,t=3){let n=this.state.chunkgroups[0];if(!this.props.ctx||!n)return;let r=[...n.models.entries()]
;if(1!=r.length&&2!=r.length)return void console.log("//TODO can currenly only diff with 1 or 2 caches loaded");let[i,a]=1==r.length?[r[0],r[0]]:r,s=await i[1].chunkdata,o=await a[1].chunkdata,l=i[0],c=a[0]
;if(!s.chunk||!o.chunk)throw new Error("unexpected");let u=await l.engine.getDependencyGraph();u.insertMapChunk(s.chunk);let h=await c.engine.getDependencyGraph();h.insertMapChunk(o.chunk)
;let d=lS(s.grid,u,s.chunk),p=uS(s.grid,u,s.modeldata,s.chunk.mapsquarex,s.chunk.mapsquarez),f=lS(o.grid,h,o.chunk),m=uS(o.grid,h,o.modeldata,o.chunk.mapsquarex,o.chunk.mapsquarez),g=dS(d,f,e,t),_=pS(p,m,e,t),v=await fS(globalThis.sceneCache,g,[255,0,0]),y=await fS(globalThis.sceneCache,_,[0,255,0]),b={
a:l,b:c,info:{floordepsa:d,floordepsb:f,locdepsa:p,locdepsb:m},floora:e,floorb:t,visible:!0,floormesh:{getSceneElements:()=>({modelnode:b.visible?v:void 0})},locsmesh:{getSceneElements:()=>({modelnode:b.visible?y:void 0})},remove:()=>{
n.diffs=n.diffs.filter((e=>e!=b)),this.props.ctx?.renderer.removeSceneElement(b.floormesh),this.props.ctx?.renderer.removeSceneElement(b.locsmesh),this.forceUpdate()}};this.props.ctx.renderer.addSceneElement(b.floormesh),
this.props.ctx.renderer.addSceneElement(b.locsmesh),n.diffs.push(b),this.forceUpdate()}async meshSelected(e){let t;if(this.selectCleanup.forEach((e=>e())),e){this.selectCleanup=function(e){let t=[];for(let n of e){
let e=n.mesh.geometry.getAttribute("color");if(!e)continue;let r=n.mesh.geometry.getAttribute("color_2"),i=[],a=[],s=[];for(let t=n.start;t<n.end;t++){let o=n.mesh.geometry.index?.getX(t)??t;i.push(o),a.push([e.getX(o),e.getY(o),e.getZ(o)]),
r&&s.push([r.getX(o),r.getY(o),r.getZ(o),r.getW(o)])}for(let t=n.start;t<n.end;t++){let a=n.mesh.geometry.index?.getX(t)??t;i.push(a),e.setXYZ(a,1,0,0),r&&r.setXYZW(a,1,1,1,1)}t.push((()=>{for(let t=n.start;t<n.end;t++){let o=i[t-n.start]
;e.setXYZ(o,...a[t-n.start]),e.needsUpdate=!0,r&&(r.setXYZW(o,...s[t-n.start]),r.needsUpdate=!0)}})),e.needsUpdate=!0,r&&(r.needsUpdate=!0)}return t}(e.vertexgroups);let n=e.meshdata;if("locationgroup"==n.modeltype){let n=e.match
;"location"==n.modeltype&&(t=n)}if("floor"==n.modeltype){let n=e.match;t={...e.meshdata,x:n.x,z:n.z,subobjects:void 0,subranges:void 0,tile:{...n.tile,next01:void 0,next10:void 0,next11:void 0},tilenxt:n.tilenxt,originalcolor:n.underlaycolor}}}
this.setState({selectionData:t}),this.props.ctx?.renderer.forceFrame()}componentDidMount(){this.props.partial.renderer?.on("select",this.meshSelected)}componentWillUnmount(){this.clear(),this.props.partial.renderer?.off("select",this.meshSelected)}
async addChunk(e,t){for(let n of this.state.versions)this.loadChunk(e,t,n.cache);this.fixVisibility()}loadChunk(e,t,n){this.setState((r=>{const i=this.props.ctx?.renderer;if(!n||!i)return;let a=py.create(n,e,t,{skybox:!0,map2d:this.state.extramodels,
hashboxes:this.state.extramodels,minimap:this.state.extramodels});a.on("changed",(()=>{let e=this.state.toggles,t=!1,r=new Set;a.rootnode.traverse((e=>{e.userData.modelgroup&&r.add(e.userData.modelgroup)})),
[...r].sort(((e,t)=>e.localeCompare(t))).forEach((n=>{"boolean"!=typeof e[n]&&(e[n]=!!n.match(/^(floor|objects)\d+/),t=!0)}));let i=this.state.versions.find((e=>e.cache==n));a.setToggles(e,i&&!i.visible),t&&(this.setState({toggles:e}),
this.fixVisibility(e))}));let s=r.center;if(0==r.chunkgroups.length){let r=n.engine.classicData?ES:xS;s={x:(e+.5)*r*512,z:(t+.5)*r*512}}a.rootnode.position.add(new Dr(-s.x,0,-s.z)),a.addToScene(i)
;let o=r.chunkgroups.find((n=>n.chunkx==e&&n.chunkz==t)),l={};return l.center=s,o||(o={chunkx:e,chunkz:t,models:new Map,diffs:[]},l.chunkgroups=[...r.chunkgroups,o]),o.models.set(n,a),l}))}onSubmit(e){localStorage.rsmv_lastsearch=JSON.stringify(e)
;let t=sm(e);if(t)for(let e=t.z;e<t.z+t.zsize;e++)for(let n=t.x;n<t.x+t.xsize;n++)this.addChunk(n,e)}fixVisibility(e=this.state.toggles){this.state.chunkgroups.forEach((t=>t.models.forEach(((t,n)=>{let r=this.state.versions.find((e=>e.cache==n))
;t.setToggles(e,r&&!r.visible)}))))}setToggle(e,t){this.setState((n=>{let r=Object.create(null);for(let i in n.toggles)r[i]=i==e?t:n.toggles[i];return this.fixVisibility(r),{toggles:r}}))}selectSecondCache(){let e=OT({title:"Select a cache"
},fT.createElement(tC,{onOpen:async t=>{e.close();let n=await iC(t,!1);if(!n)return;let r=await Zw.create(n),i=await eS.create(r);for(let e of this.state.chunkgroups)this.loadChunk(e.chunkx,e.chunkz,i);this.setState({
versions:[...this.state.versions,{cache:i,visible:!0}]})},noReopen:!0}))}removeCache(e){for(let t of this.state.chunkgroups){let n=t.models.get(e);n&&this.props.ctx?.renderer.removeSceneElement(n)}this.setState({
versions:this.state.versions.filter((t=>t.cache!=e))})}toggleCache(){let e=(this.state.versions.findIndex((e=>e.visible))+1)%this.state.versions.length;this.state.versions.forEach(((t,n)=>this.toggleVisible(t.cache,n==e)))}toggleVisible(e,t){
let n=this.state.versions.find((t=>t.cache==e));n&&(n.visible=t,this.forceUpdate(),this.fixVisibility())}static getDerivedStateFromProps(e,t){return e.ctx&&!t.versions.find((t=>t.cache==e.ctx?.sceneCache))?{versions:[{cache:e.ctx.sceneCache,
visible:!0},...t.versions]}:null}render(){this.props.ctx?.renderer.forceFrame();let e={};for(let t of Object.keys(this.state.toggles)){let n=t.match(/^(\D+?)(\d.*)?$/);if(!n)throw new Error("???");e[n[1]]=e[n[1]]??[],e[n[1]].push(n[2]??"")}
let t=1/0,n=-1/0,r=1/0,i=-1/0;for(let e of this.state.chunkgroups)t=Math.min(t,e.chunkx),n=Math.max(n,e.chunkx+1),r=Math.min(r,e.chunkz),i=Math.max(i,e.chunkz+1);let a=n-t+2,s=i-r+2;t--,r--;let o=[];for(let e=t;e<t+a;e++)for(let n=r;n<r+s;n++){
let i={gridColumn:""+(e-t+1),gridRow:""+(r+s-n),border:"1px solid rgba(255,255,255,0.2)"};o.push(fT.createElement("div",{key:`${e}-${n}`,onClick:()=>this.addChunk(e,n),style:i}))}
let l="string"==typeof this.props.initialId?this.props.initialId:"50,50,1,1",c=this.state.chunkgroups.reduceRight(((e,t)=>e??t.models.get(this.props.ctx.sceneCache)?.loaded?.sky),void 0)
;return fT.createElement(fT.Fragment,null,0==this.state.chunkgroups.length&&fT.createElement(fT.Fragment,null,fT.createElement(XT,{onChange:this.onSubmit,initialid:l}),fT.createElement("label",null,fT.createElement("input",{type:"checkbox",
checked:this.state.extramodels,onChange:e=>this.setState({extramodels:e.currentTarget.checked})
}),"Load extra modes"),fT.createElement("p",null,"Input format: x,z[,xsize=1,[zsize=xsize]]"),fT.createElement("p",null,"Coordinates are in so-called mapsquare coordinates, each mapsquare is 64x64 tiles in size. The entire RuneScape map is laid out in one plane and is 100x200 mapsquares in size.")),0!=this.state.chunkgroups.length&&fT.createElement("div",{
className:"mv-sidebar-scroll"},fT.createElement(sI,{chunks:this.state.chunkgroups.map((e=>e.models.get(this.props.ctx.sceneCache))).filter((e=>e)),addArea:this.addChunk,gridsize:40,mapscenes:!1}),fT.createElement("input",{type:"button",
className:"sub-btn",onClick:this.clear,value:"Clear"}),fT.createElement("input",{type:"button",className:"sub-btn",onClick:this.viewmap,value:"View Map"}),fT.createElement("input",{type:"button",className:"sub-btn",value:"Add other version",
onClick:this.selectSecondCache}),c&&fT.createElement("div",null,"Skybox model: ",fT.createElement("span",{className:"mv-copy-text"},c.skyboxModelid),", fog: ",fT.createElement("span",{className:"mv-copy-text"
},c.fogColor[0],",",c.fogColor[1],",",c.fogColor[2])),fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,max-content)"}},Object.entries(e).map((([e,t])=>{let n=!0,r=!0;return t.forEach((t=>{let i=this.state.toggles[e+t]
;n&&(n=i),r&&(r=!i)})),fT.createElement(fT.Fragment,{key:e},fT.createElement("label",{style:{gridColumn:1}},fT.createElement("input",{type:"checkbox",checked:n,onChange:n=>t.forEach((t=>this.setToggle(e+t,n.currentTarget.checked))),
ref:e=>e&&(e.indeterminate=!n&&!r)}),e),t.map(((t,n)=>{let r=e+t,i=this.state.toggles[r];return fT.createElement("label",{key:t,style:{gridColumn:2+n}},fT.createElement("input",{type:"checkbox",checked:i,
onChange:e=>this.setToggle(r,e.currentTarget.checked)}),t)})))
}))),(this.state.versions.length>1||!this.state.versions[0].visible)&&"Versions",(this.state.versions.length>1||!this.state.versions[0].visible)&&this.state.versions.map(((e,t)=>fT.createElement("div",{key:t,style:{clear:"both"}
},fT.createElement("label",{title:e.cache.engine.getCacheMeta().descr},fT.createElement("input",{type:"checkbox",checked:e.visible,onChange:t=>this.toggleVisible(e.cache,t.currentTarget.checked)
}),e.cache.engine.getCacheMeta().name),fT.createElement("input",{type:"button",className:"sub-btn",value:"x",style:{float:"right"},onClick:t=>this.removeCache(e.cache)})))),this.state.versions.length>1&&fT.createElement("input",{type:"button",
className:"sub-btn",value:"Toggle",onClick:this.toggleCache}),this.state.chunkgroups.flatMap(((e,t)=>e.diffs.map(((e,n)=>{let r=e.a.engine.getCacheMeta(),i=e.a==e.b?r:e.b.engine.getCacheMeta();return fT.createElement("div",{key:t+"-"+n,style:{
clear:"both"}},fT.createElement("label",{title:e.a==e.b?r.descr:`cache a:${r.descr}\n\n${i.descr}`},fT.createElement("input",{type:"checkbox",checked:e.visible,onChange:t=>{e.visible=t.currentTarget.checked,
this.props.ctx?.renderer.sceneElementsChanged(),this.forceUpdate()}}),e.a.engine.getBuildNr(),", floor: ",e.floora,"-",e.b.engine.getBuildNr(),", floor: ",e.floorb),fT.createElement("input",{type:"button",className:"sub-btn",onClick:e.remove,style:{
float:"right"},value:"x"}))})))),fT.createElement(WT,{obj:this.state.selectionData})))}}FM([Gm],aI.prototype,"clear",null),FM([Gm],aI.prototype,"viewmap",null),FM([Gm],aI.prototype,"meshSelected",null),FM([Gm],aI.prototype,"addChunk",null),
FM([Gm],aI.prototype,"onSubmit",null),FM([Gm],aI.prototype,"selectSecondCache",null),FM([Gm],aI.prototype,"toggleCache",null);class sI extends fT.Component{constructor(e){super(e),this.state={cache:new Map}}render(){let e=1/0,t=-1/0,n=1/0,r=-1/0
;for(let i of this.props.chunks)e=Math.min(e,i.chunkx),t=Math.max(t,i.chunkx+1),n=Math.min(n,i.chunkz),r=Math.max(r,i.chunkz+1);let i=t-e+2,a=r-n+2;e--,n--;let s=[];for(let t=e;t<e+i;t++)for(let r=n;r<n+a;r++){let i={gridColumn:""+(t-e+1),
gridRow:""+(n+a-r),border:"1px solid rgba(255,255,255,0.2)"};s.push(fT.createElement("div",{key:`${t}-${r}`,onClick:()=>this.props.addArea?.(t,r),style:i}))}let o=this.props.gridsize;return fT.createElement("div",{className:"map-grid-container"
},fT.createElement("div",{className:"map-grid-root",style:{gridTemplateColumns:`20px repeat(${i-2},${o}px) 20px`,gridTemplateRows:`20px repeat(${a-2},${o}px) 20px`}},this.props.chunks.flatMap(((t,r)=>{let i={gridColumn:t.chunkx-e+1+"/span 1",
gridRow:a-(t.chunkz-n)+"/span 1"},o=this.state.cache.get(t);if(o?.src)i.backgroundImage=o.src;else if(!o){let e=t.renderSvg(0,!1);o={render:e,src:null},this.state.cache.set(t,o),e.then((e=>{o.src=`url("data:image/svg+xml;base64,${btoa(e)}")`,
this.forceUpdate()}))}return s[(t.chunkx-e)*a+(t.chunkz-n)]=null,fT.createElement("div",{key:r,className:gT()("map-grid-area",{"map-grid-area-loading":!o?.src}),style:i},t.chunkx,",",t.chunkz)})),s))}}function oI(){
return fT.createElement(fT.Fragment,null,Object.entries(VE).map((([e,t])=>fT.createElement("optgroup",{key:e,label:e},Object.keys(t).map((e=>fT.createElement("option",{key:e,value:e},e)))))))}const lI={test:function(e){
let[t,n,r,i]=e.initialArgs.split(":"),[a,s]=fT.useState(t||""),[o,l]=fT.useState(n||""),[c,u]=fT.useState("false"!=r),[h,d]=fT.useState("true"==i),[p,f]=fT.useState(""),m=fT.useCallback((()=>{let e=p||OE[a].parser.originalSource,t=OT({
title:"Edit parser"},fT.createElement("form",{style:{display:"flex",flexDirection:"column",height:"100%"}},fT.createElement("textarea",{name:"parsertext",defaultValue:e,style:{flex:"1000px 1 1",resize:"none",whiteSpace:"nowrap"}
}),fT.createElement("input",{type:"button",className:"sub-btn",value:"Confirm",onClick:e=>{f(e.currentTarget.form.parsertext.value),t.close()}})))}),[p,a])
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Run this script to test if the current cache parser is compatible with the loaded cache. Generates readable errors if not."),fT.createElement(YT,{label:"Mode"
},fT.createElement("select",{value:a,onChange:e=>s(e.currentTarget.value)},Object.keys(OE).map((e=>fT.createElement("option",{key:e,value:e},e))))),fT.createElement(YT,{label:"file range"},fT.createElement("input",{type:"text",
onChange:e=>l(e.currentTarget.value),value:o})),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:h,onChange:e=>d(e.currentTarget.checked)
}),"Order by size (puts everything in mem)")),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:c,onChange:e=>u(e.currentTarget.checked)
}),"Output successes as well")),fT.createElement("br",null),fT.createElement("input",{type:"button",className:"sub-btn",value:"Edit parser",onClick:m}),p&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Reset",onClick:()=>f("")
}),fT.createElement("br",null),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:()=>{let t=OE[a];if(!t)return;let n=new gA,r=n.makefs("output"),i={skipMinorAfterError:!1,skipFilesizeAfterError:!1,memlimit:2e8,
maxerrs:5e4,orderBySize:!1,outmode:"json",dumpall:!1};i.orderBySize=h,i.dumpall=c,p&&(t={...t},t.parser=Zg.fromJson(p)),n.run(RT,r,e.source,t,om(o),i),e.onRun(n,`${a}:${o}:${c}:${h}`)}}))},extract:function(e){
let[t,n,r,i]=e.initialArgs.split(":"),[a,s]=fT.useState(i??""),[o,l]=fT.useState(t||"items"),[c,u]=fT.useState("true"==n),[h,d]=fT.useState(r?Object.fromEntries(r.split(",").map((e=>[e.split("=")[0],e.split("=")[1]??""]))):{}),p=fT.useMemo((()=>HE[o]?.({})),[o])
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Extract files from the cache.",fT.createElement("br",null),"The ranges field uses logical file id's for JSON based files, ","<major>.<minor>"," notation for bin mode, or ","<x>.<z>"," for map based files."),fT.createElement(YT,{
label:"Mode"},fT.createElement("select",{value:o,onChange:e=>l(e.currentTarget.value)},fT.createElement(oI,null))),fT.createElement(YT,{label:"File ranges"},fT.createElement(ZT,{type:"text",onChange:e=>s(e.currentTarget.value),value:a
})),fT.createElement("div",null,p?.description??""),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:c,onChange:e=>u(e.currentTarget.checked)
}),"Concatenate group files")),Object.entries(p?.flagtemplate??{}).map((([e,t])=>fT.createElement("div",{key:e},fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:"true"==h[e],onChange:t=>((e,t)=>{let n={...h}
;t?n[e]="true":delete n[e],d(n)})(e,t.currentTarget.checked)}),t.text)))),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:()=>{let t=new gA,n=t.makefs("out"),r=om(a);t.run(CC,n,e.source,{files:r,mode:o,batched:c,
batchlimit:-1,edit:!1,skipread:!1},h),e.onRun(t,`${o}:${c}:${Object.entries(h).map((([e,t])=>`${e}=${t}`)).join(",")}:${a}`)}}))},preview:function(e){let[]=e.initialArgs.split(":")
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Extracts a couple example files for each known extraction mode."),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:()=>{let t=new gA,n=t.makefs("out")
;t.run(DC,n,e.source),e.onRun(t,"")}}))},historic:function(e){let[t,n,r]=e.initialArgs.split(":"),[i,a]=fT.useState(n??""),[s,o]=fT.useState(r??""),[l,c]=fT.useState(t||"items")
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Tracks a single file's update history using openrs2 caches. Each known cache will be compared and all changes are shown. ","<major>.<minor>"," notation for bin mode, or ","<x>.<z>"," for map based files."),fT.createElement(YT,{
label:"Mode"},fT.createElement("select",{value:l,onChange:e=>c(e.currentTarget.value)},fT.createElement(oI,null))),fT.createElement(YT,{label:"File ranges"},fT.createElement(ZT,{type:"text",onChange:e=>a(e.currentTarget.value),value:i
})),fT.createElement(YT,{label:"Build numbers (empty for all)"},fT.createElement("input",{type:"text",value:s,onChange:e=>o(e.currentTarget.value)})),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:()=>{
let t=new gA,n=t.makefs("out"),r=om(s),a=om(i);t.run(TC,n,l,a[0].start,null,r),e.onRun(t,`${l}:${i}:${s}`)}}))},maprender:function(e){let[t,n]=fT.useState(localStorage.rsmv_script_map_lastconfig||kC)
;return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Render 3d world map. (there is a CLI version of this command which is much more performant)"),fT.createElement("div",null,fT.createElement("input",{type:"button",
className:"sub-btn",value:"Edit Config",onClick:()=>{let e=OT({title:"Map render config"},fT.createElement("form",{style:{display:"flex",flexDirection:"column",height:"100%"}},fT.createElement("textarea",{name:"parsertext",defaultValue:t,style:{
flex:"1000px 1 1",resize:"none",whiteSpace:"nowrap"}}),fT.createElement("input",{type:"button",className:"sub-btn",value:"Confirm",onClick:t=>{n(t.currentTarget.form.parsertext.value),e.close()}})))}}),t!=kC&&fT.createElement("input",{type:"button",
className:"sub-btn",value:"Reset",onClick:e=>n(kC)})),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:async()=>{localStorage.rsmv_script_map_lastconfig=t==kC?"":t
;let n=new gA,r=n.makefs("render"),i=new RC(r,function(e){let t=$g.parse(e);return delete t.$schema,fC(t,wC),t}(t));await r.writeFile("mapconfig.jsonc",t),n.run(rT,e.source,i,!0),e.onRun(n,"")}}))},diff:function(e){
let[t,n]=fT.useState(null),[r,i]=fT.useState(!1),[a,s]=fT.useState(null),[o,l]=fT.useState(""),[c,u]=fT.useState(!1),h=async e=>{i(!1),n(await iC(e,!1))};return fT.useEffect((()=>()=>t?.close()),[t]),fT.useEffect((()=>{if(a&&c&&t&&e.ctx.sceneCache){
let n=Zw.create(t).then((async t=>{let n=await eS.create(t),r=[],i=0;for(let t of a)if(t.major==xg.models){if(t.before){let a=new hy(n,[{modelid:t.minor,mods:{}}],`before ${t.minor}`);a.rootnode.position.set(2560*i,0,2560),r.push(a),
a.addToScene(e.ctx.renderer)}if(t.after){let n=new hy(e.ctx.sceneCache,[{modelid:t.minor,mods:{}}],`after ${t.minor}`);n.rootnode.position.set(2560*i,0,0),r.push(n),n.addToScene(e.ctx.renderer)}i++}return r}));return()=>{
n.then((e=>e.forEach((e=>e.cleanup()))))}}}),[a,c]),fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Shows all changes between the current cache and a second cache."),!t&&!r&&fT.createElement("input",{type:"button",className:"sub-btn",
value:"Select second cache",onClick:e=>(()=>{let e=OT({title:"Select a cache"},fT.createElement(tC,{onOpen:t=>{h(t),e.close()},noReopen:!0}))})()}),!t&&r&&fT.createElement("div",{style:{backgroundColor:"rgba(0,0,0,0.3)"}},fT.createElement("input",{
type:"button",className:"sub-btn",value:"Cancel select cache",onClick:e=>i(!1)}),fT.createElement(tC,{onOpen:h})),t&&fT.createElement("input",{type:"button",className:"sub-btn",value:`Close ${t.getCacheMeta().name}`,onClick:e=>n(null)
}),fT.createElement(YT,{label:"file range"},fT.createElement("input",{type:"text",onChange:e=>l(e.currentTarget.value),value:o})),fT.createElement("input",{type:"button",className:"sub-btn",value:"Run",onClick:async()=>{if(!t)return
;let n=new gA,r=n.makefs("diff"),i=om(o);e.onRun(n,""),n.run(CT,r,t,e.source,i).then(s)}}),a&&fT.createElement("label",null,fT.createElement("input",{checked:c,onChange:e=>u(e.currentTarget.checked),type:"checkbox"}),"View changed models"))},
cli:function(e){let[t,n]=fT.useState(e.initialArgs);return fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Run CLI code"),fT.createElement("input",{type:"text",value:t,onInput:e=>n(e.currentTarget.value)}),fT.createElement("input",{
type:"button",className:"sub-btn",value:"Run",onClick:async()=>{let n=new gA,r={getConsole:()=>n,getFs:e=>n.makefs(e),getDefaultCache:()=>e.source};e.onRun(n,t);let i=RM(r),a=await PM(i.subcommands,t.split(/\s+/g))
;"running"==n.state&&n.setState("error"==a._tag?"error":"done"),"error"==a._tag?n.log(a.error.config.message):n.log("script done")}}))}},cI={model:function(e){let[t,n,r,i]=tI(e.ctx,ay),a="number"==typeof e.initialId?e.initialId:0
;return fT.createElement(fT.Fragment,null,fT.createElement($T,{onChange:i,initialid:r??a
}),null==r&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Enter a model id."),fT.createElement("p",null,"This lookup shows raw models on their own.")),t&&fT.createElement("div",{className:"mv-sidebar-scroll"},fT.createElement(WT,{obj:{
...t?.info.modeldata,meshes:void 0}}),fT.createElement(WT,{obj:t?.info.info})))},item:function(e){
let[t,n,r,i]=tI(e.ctx,uy),a=r??("number"==typeof e.initialId?e.initialId:0),[s,o]=fT.useState(!1),l=n?.loaded?(n.loaded.modeldata.maxy+n.loaded.modeldata.miny)/2:0;return fT.createElement(fT.Fragment,null,e.ctx&&fT.createElement(qT,{
cache:e.ctx.sceneCache.engine,mode:"items",onChange:i,initialid:a}),null==r&&fT.createElement("p",null,"Enter an item id or search by name."),fT.createElement("div",{className:"mv-sidebar-scroll"},fT.createElement("input",{type:"button",
className:"sub-btn",value:s?"exit":"Icon Camera",onClick:e=>o(!s)}),s&&e.ctx&&fT.createElement(iI,{ctx:e.ctx,meta:t?.info,centery:l}),fT.createElement(WT,{obj:t?.info})))},avatar:function(e){
const[t,n,r,i]=tI(e.ctx,sy),[a,s]=fT.useState(""),o=vA(),l=r?.player??(e.initialId&&"object"==typeof e.initialId&&"string"==typeof e.initialId.player?e.initialId.player:""),c=r?.head??(!(!e.initialId||"object"!=typeof e.initialId||"boolean"!=typeof e.initialId.head)&&e.initialId.head),u=(e,n,r)=>{
let a=t?.info.avatar;if(!a)return void console.trace("unexpected");let s={...a};s.slots=a.slots.slice(),s.slots[e]="none"==n?{slot:null,cust:null}:{slot:{type:n,id:r},cust:null};let o=Wv(s,t?.info.gender??0,null);i({player:l,data:o,head:c})
},h=(e,n)=>{let r=t?.info.avatar;if(!r)return void console.trace("unexpected");let a={...r};a.slots=r.slots.slice(),a.slots[e]={...r.slots[e],cust:n};let s=Wv(a,t?.info.gender??0,null);i({player:l,data:s,head:c})},d=e=>{
if(!t?.info.avatar)return void console.trace("unexpected");let n=Wv(t.info.avatar,e,null);i({player:l,data:n,head:c})},p=(e,n,r)=>fT.createElement(YT,{label:e},fT.createElement("select",{value:n,onChange:n=>((e,n)=>{let r=t?.info.avatar
;if(!r)return void console.trace("unexpected");let a={...r};a[e]=n;let s=Wv(a,t?.info.gender??0,null);i({player:l,data:s,head:c})})(e,+n.currentTarget.value),style:{backgroundColor:YM(r[n])}
},Object.entries(r).map((([e,t])=>fT.createElement("option",{key:e,value:e,style:{backgroundColor:YM(t)}},e)))));return fT.createElement(fT.Fragment,null,fT.createElement(XT,{onChange:async e=>{if(e.length<=20){
let t=qv(e),n=await iy()(t).then((e=>e.text()));if(-1!=n.indexOf("404 - Page not found"))return void s(`Player avatar not found for '${e}'.`);let r=Pv(n);i({player:e,data:r,head:c}),s("")}else try{let t=Pv(e);i({player:"",data:t,head:c}),s("")
}catch(e){s("invalid avatar base64 string")}},initialid:l}),a&&fT.createElement("div",{className:"mv-errortext",onClick:e=>s("")
},a),null==r&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Type a player name to view their 3d avatar. You can then customize the avatar appearance."),fT.createElement("p",null,"You can update your avatar by going to the photo booth southwest of falador in-game")),t&&fT.createElement(YT,{
label:"Animation"},fT.createElement("select",{onChange:e=>{n?.setAnimation(+e.currentTarget.value),o()},value:n?.targetAnimId??-1},Object.entries(t.anims).map((([e,t])=>fT.createElement("option",{key:e,value:t
},e))))),t&&fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:c,onChange:e=>{r&&i({player:r.player,data:r.data,head:e.currentTarget.checked})}}),"Head"),fT.createElement("div",{className:"mv-sidebar-scroll"
},t&&fT.createElement("h2",null,"Slots"),fT.createElement("div",{style:{userSelect:"text"}},e.ctx&&t?.info.avatar?.slots.map(((n,r)=>fT.createElement(XM,{key:r,index:r,slot:n.slot,cust:n.cust,ctx:e.ctx,custChanged:h,female:1==t.info.gender,
equipChanged:u})))),t&&fT.createElement("h2",null,"Settings"),t&&fT.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},fT.createElement("input",{type:"button",className:gT()("sub-btn",{active:0==t.info.gender}),
onClick:e=>d(0),value:"Male"}),fT.createElement("input",{type:"button",className:gT()("sub-btn",{active:1==t.info.gender}),onClick:e=>d(1),value:"Female"
})),t?.info.avatar&&p("haircol0",t.info.avatar.haircol0,t.info.kitcolors.hair),t?.info.avatar&&p("haircol1",t.info.avatar.haircol1,t.info.kitcolors.hair),t?.info.avatar&&p("bodycol",t.info.avatar.bodycol,t.info.kitcolors.clothes),t?.info.avatar&&p("legscol",t.info.avatar.legscol,t.info.kitcolors.clothes),t?.info.avatar&&p("bootscol",t.info.avatar.bootscol,t.info.kitcolors.feet),t?.info.avatar&&p("skincol0",t.info.avatar.skincol0,t.info.kitcolors.skin),t?.info.avatar&&p("skincol1",t.info.avatar.skincol1,t.info.kitcolors.skin),t&&fT.createElement(fT.Fragment,null,fT.createElement("h2",null,"Export"),fT.createElement("p",null,"Use the export button at the top of the sidebar to export the model."),fT.createElement("p",null,"Use this button to copy the customized avatar for later use. You can paste it in the name field"),fT.createElement(KT,{
text:(f=t.info.buffer,f.toString("base64").replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,""))}))));var f},material:function(e){let[t,n,r,i]=tI(e.ctx,nI),a=r??im(e.initialId,{mode:"string",id:"number"})??{mode:"material",id:0},s=e=>i({
mode:e.currentTarget.value,id:a.id}),o="fullproc"==e.ctx?.sceneCache.textureType;return fT.createElement(fT.Fragment,null,fT.createElement($T,{onChange:e=>i({...a,id:e}),initialid:a.id
}),fT.createElement("div",null,fT.createElement("label",null,fT.createElement("input",{type:"radio",name:"mattype",value:"material",checked:"material"==a.mode,onChange:s}),"Material"),fT.createElement("label",null,fT.createElement("input",{
type:"radio",name:"mattype",value:"underlay",checked:"underlay"==a.mode,onChange:s}),"Underlay"),fT.createElement("label",null,fT.createElement("input",{type:"radio",name:"mattype",value:"overlay",checked:"overlay"==a.mode,onChange:s
}),"Overlay"),fT.createElement("label",null,fT.createElement("input",{type:"radio",name:"mattype",value:"texture",checked:"texture"==a.mode,onChange:s
}),"Texture")),null==r&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Enter a material id."),fT.createElement("p",null,"Materials define how a piece of geometry looks, besides the color texture they also define how the model interacts with light to create highlights and reflections.")),fT.createElement("div",{
className:"mv-sidebar-scroll"},t&&Object.entries(t.info.texs).map((([n,r])=>fT.createElement("div",{key:n},o&&t&&e.ctx&&fT.createElement("input",{type:"button",className:"sub-btn",value:"Debug proc",onClick:async()=>{
let t=await async function(e,t,n=128){let{tex:r,deps:i}=await Aw(e,t,n),a=(e,t)=>{let s=r.colorOp;r.colorOp=e;let o=Cw(r,i,n);r.colorOp=s;let l=Um(o);if(t.append(l),l.style.position="initial",l.style.width="fit-content",l.title=e.constructor.name,
l.onclick=()=>console.log(e),e.childOps.length>1){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="row",e.style.backgroundColor="rgba(0,0,0,0.2)",e.style.border="solid green",e.style.borderWidth="10px 2px 0px",
t.append(e),t=e}for(let n of e.childOps){let r=t;if(e.childOps.length>1){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",t.append(e),r=e}a(n,r)}},s=document.createElement("div")
;return s.style.position="absolute",s.style.top="5px",s.style.left="5px",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.width="fit-content",a(r.colorOp,s),s}(e.ctx.sceneCache.engine,r.texid)
;t.style.position="initial",OT({title:"proc texture "+r.texid,maxWidth:"unset"},fT.createElement(xA,{el:t}))}
}),fT.createElement("div",null,n," - ",r.texid," - ",r.filesize>1e4?(r.filesize/1024|0)+"kb":`${r.filesize} bytes`," - ",r.img0.width,"x",r.img0.height),fT.createElement(eI,{img:r.img0})))),t?.info.overlay&&fT.createElement(WT,{obj:t?.info.overlay
}),t?.info.underlay&&fT.createElement(WT,{obj:t?.info.underlay}),fT.createElement(WT,{obj:t?.info.obj})))},npc:function(e){const[t,n,r,i]=tI(e.ctx,oy),a=vA(),s=r??im(e.initialId,{id:"number",head:"boolean"})??{id:0,head:!1}
;return fT.createElement(fT.Fragment,null,e.ctx&&fT.createElement(qT,{cache:e.ctx.sceneCache.engine,mode:"npcs",onChange:e=>i({id:e,head:s.head}),initialid:s.id
}),null==r&&fT.createElement("p",null,"Enter an NPC id or search by name."),n&&t&&fT.createElement("label",null,fT.createElement("input",{type:"checkbox",checked:s.head,onChange:e=>i({id:s.id,head:e.currentTarget.checked})
}),"Head"),n&&t&&fT.createElement(YT,{label:"Animation"},fT.createElement("select",{onChange:e=>{n.setAnimation(+e.currentTarget.value),a()},value:n.targetAnimId},Object.entries(t.anims).map((([e,t])=>fT.createElement("option",{key:e,value:t
},e))))),fT.createElement("div",{className:"mv-sidebar-scroll"},fT.createElement(WT,{obj:t?.info})))},object:function(e){const[t,n,r,i]=tI(e.ctx,cy),a=vA(),s=t?.anims.default??-1;let o=r??("number"==typeof e.initialId?e.initialId:0)
;return fT.createElement(fT.Fragment,null,e.ctx&&fT.createElement(qT,{cache:e.ctx.sceneCache.engine,mode:"objects",onChange:i,initialid:o
}),null==r&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Enter a location id or search by name."),fT.createElement("p",null,"Locations make up just about everything in the world that isn't a player or NPC.")),-1!=s&&fT.createElement("label",null,fT.createElement("input",{
type:"checkbox",checked:!n||n.targetAnimId==s,onChange:e=>{n?.setAnimation(e.currentTarget.checked?s:-1),a()}}),"Animate"),fT.createElement("div",{className:"mv-sidebar-scroll"},fT.createElement(WT,{obj:t?.info})))},spotanim:function(e){
let[t,n,r,i]=tI(e.ctx,ly),a=r??("number"==typeof e.initialId?e.initialId:0);return fT.createElement(fT.Fragment,null,fT.createElement($T,{onChange:i,initialid:a
}),null==r&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Enter a spotanim id."),fT.createElement("p",null,"Spotanims are visual effects that are usually temporary and require an extra model that is not part of any loc, npc or player.")),fT.createElement("div",{
className:"mv-sidebar-scroll"},fT.createElement(WT,{obj:t?.info})))},map:aI,scenario:qM,scripts:function(e){let t="test",n="";"string"==typeof e.initialId&&([t,n]=e.initialId.split(/(?<=^[^:]*):/))
;let[r,i]=fT.useState(t),[a,s]=fT.useState(null),o=fT.useCallback(((e,t)=>{localStorage.rsmv_lastsearch=JSON.stringify(r+":"+t),s(e)}),[r]);const l=e.partial.source;if(!l)throw new Error("trying to render modelbrowser without source loaded")
;const c=lI[r];return fT.createElement(fT.Fragment,null,fT.createElement("div",{className:"mv-sidebar-scroll"},fT.createElement("h2",null,"Script runner"),fT.createElement(jT,{value:r,tabs:Object.fromEntries(Object.keys(lI).map((e=>[e,e]))),
onChange:e=>i(e)}),!c&&fT.createElement(fT.Fragment,null,fT.createElement("p",null,"Select a script"),fT.createElement("p",null,"The script runner allows you to run some of the CLI scripts directly from the browser.")),c&&fT.createElement(c,{
source:l,onRun:o,initialArgs:t==r?n??"":"",ctx:e.partial}),fT.createElement("h2",null,"Script output"),fT.createElement(EA,{output:a,ctx:e.partial})))}};var uI=function(e,t,n,r){
var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};globalThis.THREE=e,
globalThis.logclicks=!1,globalThis.speed=100;class hI extends xm{constructor(e,t){super(),this.skybox=null,this.queuedFrameId=0,this.autoFrameMode="forced",this.contextLossCount=0,this.contextLossCountLastRender=0,this.clock=new Ip(!0),
this.sceneElements=new Set,this.animationCallbacks=new Set,this.vr360cam=null,this.forceAspectRatio=null,this.camMode="standard",this.itemcam=new ns,globalThis.render=this,this.canvas=e,this.renderer=new ec({canvas:e,alpha:!0,
powerPreference:"high-performance",antialias:!0,preserveDrawingBuffer:!0,...t});const n=this.renderer;e.addEventListener("webglcontextlost",(()=>this.contextLossCount++)),e.onmousedown=this.mousedown,this.camera=new ns(45,2,.1,1e3),
this.camera.position.set(0,10,20),this.standardControls=new rm(this.camera,e),this.standardControls.target.set(0,5,0),this.standardControls.update(),this.standardControls.addEventListener("change",this.forceFrame),this.topdowncam=new pT(10,0,0),
this.topdowncam.position.copy(this.camera.position),this.orthoControls=new rm(this.topdowncam,e),this.orthoControls.target.set(0,5,0),this.orthoControls.screenSpacePanning=!1,this.orthoControls.update(),
this.orthoControls.addEventListener("change",this.forceFrame);const r=new ic;this.scene=r,r.add(this.camera),r.add(this.topdowncam),n.useLegacyLights=!1,n.outputColorSpace=Xt
;let i=Am(new Uint8ClampedArray([128,128,128,255,192,192,192,255,192,192,192,255,128,128,128,255]),2,2);const a=new Sr(i);a.needsUpdate=!0,a.wrapS=ge,a.wrapT=ge,a.magFilter=ye,a.repeat.set(5.5,5.5);const s=new gs(11,11),o=new cd({map:a,side:g
}),l=new ja(s,o);l.rotation.x=-.5*Math.PI,l.position.y=-.01,r.add(l),this.floormesh=l,this.modelnode=new Wl,this.modelnode.scale.set(1/512,1/512,-1/512),this.scene.add(this.modelnode),this.standardLights=new Wl;let c=new cp(16777215,.7)
;var u=new lp(16777215);u.position.set(75,300,-75);let h=new Yd(16777215,8947780);c.layers.enableAll(),u.layers.enableAll(),h.layers.enableAll(),this.standardLights.add(c),this.standardLights.add(u),this.standardLights.add(h),
r.add(this.standardLights),this.scene.fog=new rc("#FFFFFF",1e4,1e4),this.sceneElementsChanged()}getCurrent2dCamera(){
return"standard"==this.camMode?this.getStandardCamera():"item"==this.camMode?this.getItemCamera():"topdown"==this.camMode?this.getTopdownCamera():null}getStandardCamera(){return this.camera}getVr360Camera(){
return this.vr360cam||(this.vr360cam=new bg(this.renderer,512,.1,1e3),this.camera.add(this.vr360cam.cubeCamera)),this.vr360cam}getItemCamera(){return this.itemcam}getTopdownCamera(){return this.topdowncam}getModelNode(){return this.modelnode}
addSceneElement(e){this.sceneElements.add(e),this.sceneElementsChanged()}removeSceneElement(e){this.sceneElements.delete(e),this.sceneElementsChanged()}sceneElementsChanged(){
let e=null,t=null,n="standard",r="free",i=!1,a=!0,s="auto",o=new Set(this.modelnode.children);this.animationCallbacks.clear();for(let l of this.sceneElements){let c=l.getSceneElements();Array.isArray(c)||(c=[c]);for(let l of c)l.sky&&(e=l.sky),
l.updateAnimation&&this.animationCallbacks.add(l.updateAnimation),l.options?.hideFog&&(i=!0),l.options?.hideFloor&&(a=!1),l.options?.camMode&&(n=l.options.camMode),l.options?.camControls&&(r=l.options.camControls),
l.options?.aspect&&(t=l.options.aspect),l.options?.autoFrames&&(s=l.options.autoFrames),l.modelnode&&(o.delete(l.modelnode),l.modelnode.parent!=this.modelnode&&this.modelnode.add(l.modelnode))}o.forEach((e=>this.modelnode.remove(e))),
this.autoFrameMode="auto"==s?0==this.animationCallbacks.size?"forced":"continuous":s,this.floormesh.visible=a,"topdown"==this.camMode&&"standard"==n&&(this.camera.position.copy(this.topdowncam.position),
this.camera.rotation.copy(this.topdowncam.rotation),this.standardControls.update()),"standard"==this.camMode&&"topdown"==n&&(this.topdowncam.position.copy(this.camera.position),this.topdowncam.rotation.copy(this.camera.rotation),
this.orthoControls.update()),this.camMode=n,this.standardControls.enabled="topdown"!=this.camMode,this.orthoControls.enabled="topdown"==this.camMode,this.standardControls.screenSpacePanning="free"==r,this.orthoControls.screenSpacePanning="free"==r,
this.forceAspectRatio=t;let l=this.scene.fog;if(e?.fogColor?l.color.setRGB(e.fogColor[0]/255,e.fogColor[1]/255,e.fogColor[2]/255):l.color.setRGB(1,1,1),i?(l.far=1e5,l.near=1e5):(l.far=250,l.near=80),e?.skybox){
let t=this.skybox?.scene??new ic,n=this.skybox?.camera??(new ns).copy(this.camera,!1),r=new Pi;r.scale.set(1/512,1/512,-1/512),r.add(e.skybox),t.clear(),t.add(r,n,new cp(16777215)),t.background=e.fogColor?l.color.clone():null,this.skybox={scene:t,
camera:n}}else this.skybox=null;this.forceFrame()}resizeRendererToDisplaySize(){const e=this.renderer.domElement;if(!e.isConnected)return;let t=e.clientWidth,n=e.clientHeight;this.forceAspectRatio&&(n=Math.min(n,Math.floor(t/this.forceAspectRatio)),
t=Math.min(t,Math.floor(n*this.forceAspectRatio)));const r=e.width!==t||e.height!==n;return r&&(this.renderer.setSize(t,n,!1),this.resizeViewToRendererSize()),r}resizeViewToRendererSize(){
let e=this.renderer.getRenderTarget(),t=(e?.width??this.canvas.width)/(e?.height??this.canvas.height)*(this.topdowncam.top-this.topdowncam.bottom)/(this.topdowncam.right-this.topdowncam.left);this.topdowncam.left*=t,this.topdowncam.right*=t,
this.topdowncam.updateProjectionMatrix()}async guaranteeGlCalls(e){let t=()=>{if(this.renderer.getContext().isContextLost())return console.log("frame stalled since context is lost"),new Promise((e=>{
this.renderer.domElement.addEventListener("webglcontextrestored",(()=>{console.log("context restored"),setTimeout(e,1)}),{once:!0})}))};for(let n=0;n<5;n++){await t();let n=this.contextLossCountLastRender,r=await e();if(await cm(1),
this.renderer.getContext().isContextLost())console.log("lost context during render "+new Date);else{if(n==this.contextLossCount)return r;console.log("lost and regained context during render "+new Date)}}
throw new Error("Failed to render frame after 5 retries")}render(e){var t;t=this.queuedFrameId,"undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame(t):clearTimeout(t),this.queuedFrameId=0;let n=this.clock.getDelta()
;if(n*=(globalThis.speed??100)/100,this.animationCallbacks.forEach((e=>e(n,this.clock.elapsedTime))),this.resizeRendererToDisplaySize(),e)this.renderScene(e);else if("vr360"==this.camMode){let e=this.getVr360Camera();this.renderCube(e),
this.renderer.clearColor(),e.render(this.renderer)}else this.renderScene(this.getCurrent2dCamera());"continuous"==this.autoFrameMode&&this.forceFrame()}renderScene(e){
let t=this.renderer.getRenderTarget()??this.renderer.getContext().canvas??this.canvas,n=t.width/t.height;e instanceof ns&&e.aspect!=n&&(e.aspect=n,e.updateProjectionMatrix());let r=this.renderer.autoClear
;e==this.camera&&this.skybox&&(this.skybox.camera.matrixAutoUpdate=!1,this.camera.updateWorldMatrix(!0,!0),this.skybox.camera.matrix.copy(this.camera.matrixWorld),this.skybox.camera.matrix.setPosition(0,0,0),
this.skybox.camera.projectionMatrix.copy(this.camera.projectionMatrix),this.renderer.render(this.skybox.scene,this.skybox.camera),this.renderer.clearDepth(),this.renderer.autoClear=!1),this.renderer.render(this.scene,e),this.renderer.autoClear=r,
this.contextLossCountLastRender=this.contextLossCount}renderCube(e){e.cubeRenderTarget.clear(this.renderer,!0,!0,!1),this.skybox&&(e.skyCubeCamera.matrixAutoUpdate=!1,e.cubeCamera.updateWorldMatrix(!0,!0),
e.skyCubeCamera.matrix.copy(e.cubeCamera.matrixWorld),e.skyCubeCamera.matrix.setPosition(0,0,0),e.skyCubeCamera.updateMatrixWorld(!0),e.skyCubeCamera.update(this.renderer,this.skybox.scene),e.cubeRenderTarget.clear(this.renderer,!1,!0,!1)),
e.cubeCamera.update(this.renderer,this.scene)}forceFrame(){var e;this.queuedFrameId||"never"==this.autoFrameMode||(this.queuedFrameId=(e=()=>this.render(),
"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):+setTimeout(e,50,Date.now()+50)))}async takeScenePicture(e=this.canvas.width,t=this.canvas.height){let n=null;if(e!=this.canvas.width||t!=this.canvas.height){
let r=this.renderer.getContext();n=new Cr(e,t,{minFilter:Se,magFilter:Se,format:Ge,colorSpace:"vr360"!=this.camMode?this.renderer.outputColorSpace:Yt,samples:r.getParameter(r.SAMPLES)})}return this.guaranteeGlCalls((()=>{
let t=this.renderer.getRenderTarget();if(this.renderer.setRenderTarget(n),this.resizeViewToRendererSize(),"vr360"!=this.camMode){let e=this.getCurrent2dCamera();this.renderScene(e)}else{let t=new bg(this.renderer,e>2e3?2048:1024,.1,1e3)
;this.camera.add(t.cubeCamera),this.renderCube(t),this.renderer.clearColor(),t.render(this.renderer),t.cubeCamera.removeFromParent()}let r=this.getFrameBufferPixels();return this.renderer.setRenderTarget(t),this.resizeViewToRendererSize(),r}))}
getFrameBufferPixels(){let e=this.renderer.getRenderTarget(),t=e?.width??this.canvas.width,n=e?.height??this.canvas.height,r=new Uint8Array(t*n*4);if(e)this.renderer.readRenderTargetPixels(e,0,0,t,n,r),e.dispose();else{
let e=this.renderer.getContext();e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,r)}let i=Am(r,t,n);return Om(i),i}takeMapPicture(e,t=-1,n=-1,r=!1,i=null){return-1!=t&&-1!=n&&this.renderer.setSize(t,n),this.guaranteeGlCalls((()=>{
let t=!i,n=this.renderer.outputColorSpace;if(this.renderer.outputColorSpace=r?Yt:Xt,this.renderer.setClearColor(new Zi(0,0,0),t?255:0),this.scene.background=t?new Zi(0,0,0):null,i){this.renderer.clearDepth(),this.renderer.clearColor()
;let t=e.layers.mask;e.layers.set(1),this.renderer.render(this.scene,e),e.layers.mask=t}else this.renderScene(e);let a=this.getFrameBufferPixels();return this.renderer.outputColorSpace=n,this.renderer.setClearColor(new Zi(0,0,0),0),
this.scene.background=null,a}))}setCameraPosition(e){this.camera.position.copy(e)}setCameraLimits(e){if(!e){const t=(new Pr).setFromObject(this.modelnode);t.getSize(new Dr).length(),e=t.getCenter(new Dr)}this.standardControls.target.copy(e),
this.standardControls.update(),this.standardControls.screenSpacePanning=!0}async mousedown(e){let t=e.screenX,n=e.screenY,r=e.clientX,i=e.clientY;window.addEventListener("mouseup",(e=>{Math.abs(e.screenX-t)+Math.abs(e.screenY-n)<10&&this.click(r,i),
e.preventDefault()}),{once:!0})}async click(e,t){
let n=new lf,r=this.canvas.getBoundingClientRect(),i=new tr((e-r.x)/r.width*2-1,-(t-r.y)/r.height*2+1),a="standard"==this.camMode?this.getStandardCamera():"topdown"==this.camMode?this.getTopdownCamera():null;if(!a)return;n.setFromCamera(i,a)
;let s=n.intersectObjects(this.scene.children),o=!0;for(let e of s){let t=e.object;if(!t.visible)continue;let n,r=t.userData;if(o&&(globalThis.model=e.object,o=!1,globalThis.logclicks&&e.object instanceof ja&&e.object.geometry instanceof Aa)){
let t=[e.face.a,e.face.b,e.face.c];console.log("Click intersect");for(let[n,r]of Object.entries(e.object.geometry.attributes)){let e=[];for(let n of t){let t=[];e.push(t),r.itemSize>=1&&t.push(r.getX(n)),r.itemSize>=2&&t.push(r.getY(n)),
r.itemSize>=3&&t.push(r.getZ(n)),r.itemSize>=4&&t.push(r.getW(n))}console.log(`${n} = ${e.map((e=>`[${e.map((e=>e.toFixed(2))).join(",")}]`))}`)}}if(!(t instanceof ja&&r.isclickable))continue
;let i=t.geometry.index?.count??t.geometry.attributes.position.count,a=0,s=e.faceIndex;if(void 0===s)throw new Error("???");for(let e=0;e<r.subranges.length;e++){if(3*s<r.subranges[e]){i=r.subranges[e];break}a=r.subranges[e],n=r.subobjects[e]}
if(!n)continue;let l=[];if(r.searchPeers){let e=t;for(;e.parent;)e=e.parent;e.traverseVisible((e=>{let t=e.userData;if(e instanceof ja&&t.isclickable&&t.searchPeers)for(let r=0;r<t.subobjects.length;r++)t.subobjects[r]==n&&l.push({
start:t.subranges[r],end:t.subranges[r+1]??e.geometry.index.count,mesh:e})}))}else l.push({start:a,end:i,mesh:t});return void this.emit("select",{obj:t,meshdata:r,match:n,vertexgroups:l})}this.emit("select",null)}makeUIRenderer(){let e=new ic
;e.add(new cp(16777215,.7));let t=new Yd(16777215,8947780);var n=new lp(16777215);n.position.set(75,300,-75);let r=new Wl;r.scale.set(1/512,1/512,-1/512),e.add(n),e.add(t),e.add(r);let i=new Ip,a=null,s=null,o=0;return{takePicture:(t,n,r)=>{
let l=this.renderer.getContext();a&&t==a.width&&n==a.height||(a?.dispose(),a=new Cr(t,n,{minFilter:Se,magFilter:Se,format:Ge,colorSpace:this.renderer.outputColorSpace,samples:l.getParameter(l.SAMPLES)}));let c=i.getDelta()
;s?.updateAnimation?.(c,i.elapsedTime);let u=this.renderer.getRenderTarget();this.renderer.setRenderTarget(a);let h=new ns;rI(h,t,n,o,r),this.renderer.clearColor(),this.renderer.clearDepth(),this.renderer.render(e,h);let d=this.getFrameBufferPixels()
;return this.renderer.setRenderTarget(u),d},dispose:()=>a?.dispose(),setmodel:(e,t)=>{s?.modelnode&&(r.remove(s.modelnode),s=null),e?.modelnode&&(r.add(e.modelnode),s=e),o=t}}}dispose(){this.renderer.dispose(),function(e){if(!e)return;const t=e=>{
n++,e.dispose();for(const t of Object.keys(e)){const r=e[t];r&&"object"==typeof r&&"minFilter"in r&&(r.dispose(),n++)}};let n=0;e.traverse((e=>{if(e.isMesh)if(n++,e.geometry.dispose(),
e.material.isMaterial)t(e.material);else for(const n of e.material)t(n)})),console.log("disposed scene objects",n)}(this.scene)}}uI([Gm],hI.prototype,"guaranteeGlCalls",null),uI([Gm],hI.prototype,"render",null),
uI([Gm],hI.prototype,"forceFrame",null),uI([Gm],hI.prototype,"mousedown",null);var dI=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};function pI(e){e.unmount()
}function fI(e,t){window.addEventListener("keydown",(e=>{"F5"==e.key&&document.location.reload()}));let n=new rC(e,t??!1),r=NT.H(e);return r.render(fT.createElement(mI,{ctx:n})),globalThis.cli=async e=>{let t=new oA,r={},i=RM({getConsole:()=>t,
getFs:e=>r[e]??(r[e]=new mA(null)),getDefaultCache:()=>n.source}),a=await PM(i.subcommands,e.split(/\s+/g));return"running"==t.state&&t.setState("error"==a._tag?"error":"done"),"error"==a._tag?(console.error(a.error.config.message),
r.code=a.error.config.exitCode):r.code=0,r},r}class mI extends fT.Component{constructor(e){super(e),this.state={openedFile:this.props.ctx.openedfile},(async()=>{try{let e=await Promise.race([kb("openedcache"),new Promise(((e,t)=>setTimeout(t,1e3)))])
;e&&this.openCache(e)}catch(e){console.log("failed to open indexedDB openedcache, fallback to localStorage (without webfs support)");try{let e=JSON.parse(localStorage.rsmv_openedcache);this.openCache(e)}catch(e){}}})()}async openCache(e){
let t=await iC(e,!0);if(t){globalThis.source=t,this.props.ctx.setCacheSource(t);try{let e=await Zw.create(t);console.log("engine loaded",t.getBuildNr());let n=await eS.create(e);this.props.ctx.setSceneCache(n),globalThis.sceneCache=n,
globalThis.engine=e}catch(e){console.log("failed to create scenecache"),console.error(e)}}}initCnv(e){this.props.ctx.setRenderer(e?new hI(e):null)}closeCache(){!function(e,t=Rb()){t("readwrite",(t=>(t.delete(e),Mb(t.transaction))))}("openedcache"),
localStorage.rsmv_openedcache="",navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({type:"sethandle",handle:null}))),this.props.ctx.source?.close(),this.props.ctx.setCacheSource(null),this.props.ctx.setSceneCache(null)}stateChanged(){
this.forceUpdate()}resized(){this.forceUpdate()}componentDidMount(){this.props.ctx.on("openfile",this.openFile),this.props.ctx.on("statechange",this.stateChanged),window.addEventListener("resize",this.resized)}componentWillUnmount(){
this.props.ctx.off("openfile",this.openFile),this.props.ctx.off("statechange",this.stateChanged),window.removeEventListener("resize",this.resized),this.closeCache()}openFile(e){this.setState({openedFile:e})}render(){
let e=this.props.ctx.rootElement.clientWidth<550,t=this.props.ctx.source?.getCacheMeta();return fT.createElement("div",{className:gT()("mv-root","mv-style",{"mv-root--vertical":e})},fT.createElement("canvas",{className:"mv-canvas",ref:this.initCnv,
style:{display:this.state.openedFile?"none":"block"}}),this.state.openedFile&&fT.createElement(dC,{file:this.state.openedFile,onSelectFile:this.props.ctx.openFile}),fT.createElement("div",{className:"mv-sidebar"
},!this.props.ctx.source&&fT.createElement(fT.Fragment,null,fT.createElement(tC,{onOpen:this.openCache}),fT.createElement("div",{style:{flex:"1"}}),fT.createElement("div",{style:{textAlign:"center"}},"Go to ",fT.createElement("a",{
href:"https://runeapps.org/modelviewer_about"},"RuneApps")," for more info. Source code hosted at ",fT.createElement("a",{href:"https://github.com/skillbert/rsmv",target:"_blank"
},"github.com/skillbert/rsmv"))),t&&fT.createElement(fT.Fragment,null,fT.createElement("input",{type:"button",className:"sub-btn",onClick:this.closeCache,value:`Close ${t.name}`,title:t.descr}),fT.createElement(QM,{ctx:this.props.ctx
}),fT.createElement(UM,{ctx:this.props.ctx}))))}}dI([Gm],mI.prototype,"openCache",null),dI([Gm],mI.prototype,"initCnv",null),dI([Gm],mI.prototype,"closeCache",null),dI([Gm],mI.prototype,"stateChanged",null),dI([Gm],mI.prototype,"resized",null),
dI([Gm],mI.prototype,"openFile",null)})(),r})()));